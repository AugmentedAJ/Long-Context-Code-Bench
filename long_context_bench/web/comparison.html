<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Long-Context-Bench - Agent Comparison</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>Long-Context-Bench</h1>
            <nav>
                <a href="index.html">Leaderboard</a>
                <a href="summary.html">Run Details</a>
                <a href="comparison.html" class="active">Compare</a>
            </nav>
        </header>

        <main>
            <section class="controls">
                <div class="control-group">
                    <label for="comparison-mode">Comparison Mode:</label>
                    <select id="comparison-mode">
                        <option value="test-label">By Test Label</option>
                        <option value="manual">Manual Selection</option>
                    </select>
                </div>
                <div class="control-group" id="test-label-group">
                    <label for="test-label-selector">Test Label:</label>
                    <select id="test-label-selector">
                        <option value="">Select label...</option>
                    </select>
                </div>
                <div class="control-group hidden" id="manual-selection-group">
                    <label>Select Runs to Compare:</label>
                    <div id="run-checkboxes"></div>
                </div>
                <div class="control-group">
                    <button id="compare-btn">Compare</button>
                    <button id="refresh-btn">Refresh Data</button>
                </div>
            </section>

            <section class="comparison-summary" id="comparison-summary" style="display: none;">
                <h2>Comparison Summary</h2>
                <div class="comparison-grid">
                    <div class="comparison-stat">
                        <span class="stat-label">Agents Compared:</span>
                        <span class="stat-value" id="agents-compared">-</span>
                    </div>
                    <div class="comparison-stat">
                        <span class="stat-label">Test Label:</span>
                        <span class="stat-value" id="comparison-test-label">-</span>
                    </div>
                    <div class="comparison-stat">
                        <span class="stat-label">Total Samples:</span>
                        <span class="stat-value" id="comparison-samples">-</span>
                    </div>
                </div>
            </section>

            <section class="comparison-table" id="comparison-table-section" style="display: none;">
                <h2>Head-to-Head Metrics</h2>
                <div class="table-container">
                    <table id="comparison-table">
                        <thead>
                            <tr>
                                <th>Metric</th>
                                <!-- Agent columns will be added dynamically -->
                            </tr>
                        </thead>
                        <tbody id="comparison-body">
                        </tbody>
                    </table>
                </div>
            </section>

            <section class="charts" id="comparison-charts" style="display: none;">
                <div class="chart-container">
                    <h3>Radar Chart Comparison</h3>
                    <canvas id="radar-chart"></canvas>
                </div>
                <div class="chart-container">
                    <h3>Score Comparison</h3>
                    <canvas id="bar-comparison-chart"></canvas>
                </div>
            </section>

            <section class="pr-comparison" id="pr-comparison-section" style="display: none;">
                <h2>Per-PR Comparison</h2>
                <div class="table-container">
                    <table id="pr-comparison-table">
                        <thead>
                            <tr>
                                <th>PR #</th>
                                <th>Repository</th>
                                <!-- Agent columns will be added dynamically -->
                            </tr>
                        </thead>
                        <tbody id="pr-comparison-body">
                        </tbody>
                    </table>
                </div>
            </section>

            <section class="win-loss-matrix" id="win-loss-section" style="display: none;">
                <h2>Win/Loss/Tie Matrix</h2>
                <div class="table-container">
                    <table id="win-loss-table">
                        <thead>
                            <tr>
                                <th>Agent</th>
                                <!-- Agent columns will be added dynamically -->
                            </tr>
                        </thead>
                        <tbody id="win-loss-body">
                        </tbody>
                    </table>
                </div>
            </section>
        </main>

        <footer>
            <p>Last updated: <span id="last-updated">-</span></p>
        </footer>
    </div>

    <script src="lib/chart.min.js"></script>
    <script src="data-loader.js"></script>
    <script src="charts.js"></script>
    <script src="app.js"></script>
    <script>
        // Initialize comparison page
        document.addEventListener('DOMContentLoaded', async () => {
            await loadComparisonOptions();
            
            // Check URL params for test_label
            const urlParams = new URLSearchParams(window.location.search);
            const testLabel = urlParams.get('test_label');
            if (testLabel) {
                document.getElementById('comparison-mode').value = 'test-label';
                document.getElementById('test-label-selector').value = testLabel;
                await loadComparison();
            }
        });

        document.getElementById('comparison-mode').addEventListener('change', (e) => {
            const mode = e.target.value;
            if (mode === 'test-label') {
                document.getElementById('test-label-group').classList.remove('hidden');
                document.getElementById('manual-selection-group').classList.add('hidden');
            } else {
                document.getElementById('test-label-group').classList.add('hidden');
                document.getElementById('manual-selection-group').classList.remove('hidden');
            }
        });

        document.getElementById('compare-btn').addEventListener('click', async () => {
            await loadComparison();
        });

        document.getElementById('refresh-btn').addEventListener('click', async () => {
            await loadComparisonOptions();
        });
    </script>
</body>
</html>

