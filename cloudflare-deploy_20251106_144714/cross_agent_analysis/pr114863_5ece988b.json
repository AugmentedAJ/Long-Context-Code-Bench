{
  "repo_url": "https://github.com/elastic/elasticsearch.git",
  "pr_number": 114863,
  "base_commit": "4fa8485a26d5d57e52117ae8d9f89491853703d9",
  "head_commit": "c719d3b87e8d7cc1f20d704983146cb366f3fb0d",
  "task_instructions": "You are working on a codebase. Your task is to make the necessary code changes to accomplish the following:\n\nBetter DataType string checks\n\nWhile I was adding support for `semantic_text` to behave just like any other `string` type, I noticed there a few things we could refactor outside of support for `semantic_text`:\r\n\r\n- instead of doing checks such as `type == DataType.KEYWORD || type == DataType.TEXT` we can rely on the existing `DataType.isString` which does the same thing.\r\n- in multiple places we do  `DataType.types().stream().filter(DataType::isString).toList();` - I added a `DataType.stringTypes` function and replaced such occurrences\r\n\r\n\n\nPlease make all necessary code changes to complete this task.",
  "ground_truth_diff": "diff --git a/muted-tests.yml b/muted-tests.yml\nindex 86585ebc5daf..b105c77b3452 100644\n--- a/muted-tests.yml\n+++ b/muted-tests.yml\n@@ -325,6 +325,9 @@ tests:\n - class: org.elasticsearch.xpack.inference.services.cohere.CohereServiceTests\n   method: testInfer_StreamRequest_ErrorResponse\n   issue: https://github.com/elastic/elasticsearch/issues/114327\n+- class: org.elasticsearch.xpack.rank.rrf.RRFRankClientYamlTestSuiteIT\n+  method: test {yaml=rrf/700_rrf_retriever_search_api_compatibility/rrf retriever with top-level collapse}\n+  issue: https://github.com/elastic/elasticsearch/issues/114331\n - class: org.elasticsearch.xpack.security.CoreWithSecurityClientYamlTestSuiteIT\n   method: test {yaml=cluster.stats/30_ccs_stats/cross-cluster search stats search}\n   issue: https://github.com/elastic/elasticsearch/issues/114371\ndiff --git a/x-pack/plugin/esql-core/src/main/java/org/elasticsearch/xpack/esql/core/type/DataType.java b/x-pack/plugin/esql-core/src/main/java/org/elasticsearch/xpack/esql/core/type/DataType.java\nindex b23703c6d8b6..cb1a7b2eb6fe 100644\n--- a/x-pack/plugin/esql-core/src/main/java/org/elasticsearch/xpack/esql/core/type/DataType.java\n+++ b/x-pack/plugin/esql-core/src/main/java/org/elasticsearch/xpack/esql/core/type/DataType.java\n@@ -266,6 +266,8 @@ public enum DataType {\n         .sorted(Comparator.comparing(DataType::typeName))\n         .toList();\n \n+    private static final Collection<DataType> STRING_TYPES = DataType.types().stream().filter(DataType::isString).toList();\n+\n     private static final Map<String, DataType> NAME_TO_TYPE = TYPES.stream().collect(toUnmodifiableMap(DataType::typeName, t -> t));\n \n     private static final Map<String, DataType> ES_TO_TYPE;\n@@ -292,6 +294,10 @@ public enum DataType {\n         return TYPES;\n     }\n \n+    public static Collection<DataType> stringTypes() {\n+        return STRING_TYPES;\n+    }\n+\n     /**\n      * Resolve a type from a name. This name is sometimes user supplied,\n      * like in the case of {@code ::<typename>} and is sometimes the name\ndiff --git a/x-pack/plugin/esql-core/src/main/java/org/elasticsearch/xpack/esql/core/type/DataTypeConverter.java b/x-pack/plugin/esql-core/src/main/java/org/elasticsearch/xpack/esql/core/type/DataTypeConverter.java\nindex 78b395503e70..7c91a506697c 100644\n--- a/x-pack/plugin/esql-core/src/main/java/org/elasticsearch/xpack/esql/core/type/DataTypeConverter.java\n+++ b/x-pack/plugin/esql-core/src/main/java/org/elasticsearch/xpack/esql/core/type/DataTypeConverter.java\n@@ -30,11 +30,9 @@ import static org.elasticsearch.xpack.esql.core.type.DataType.DOUBLE;\n import static org.elasticsearch.xpack.esql.core.type.DataType.FLOAT;\n import static org.elasticsearch.xpack.esql.core.type.DataType.INTEGER;\n import static org.elasticsearch.xpack.esql.core.type.DataType.IP;\n-import static org.elasticsearch.xpack.esql.core.type.DataType.KEYWORD;\n import static org.elasticsearch.xpack.esql.core.type.DataType.LONG;\n import static org.elasticsearch.xpack.esql.core.type.DataType.NULL;\n import static org.elasticsearch.xpack.esql.core.type.DataType.SHORT;\n-import static org.elasticsearch.xpack.esql.core.type.DataType.TEXT;\n import static org.elasticsearch.xpack.esql.core.type.DataType.UNSIGNED_LONG;\n import static org.elasticsearch.xpack.esql.core.type.DataType.VERSION;\n import static org.elasticsearch.xpack.esql.core.type.DataType.isDateTime;\n@@ -62,7 +60,7 @@ public final class DataTypeConverter {\n             return DefaultConverter.TO_NULL;\n         }\n         // proper converters\n-        if (to == KEYWORD || to == TEXT) {\n+        if (isString(to)) {\n             return conversionToString(from);\n         }\n         if (to == LONG) {\ndiff --git a/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/aggregate/CountDistinct.java b/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/aggregate/CountDistinct.java\nindex 2550e5bdcf51..756000dfbb18 100644\n--- a/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/aggregate/CountDistinct.java\n+++ b/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/aggregate/CountDistinct.java\n@@ -209,7 +209,7 @@ public class CountDistinct extends AggregateFunction implements OptionalArgument\n         if (type == DataType.DOUBLE) {\n             return new CountDistinctDoubleAggregatorFunctionSupplier(inputChannels, precision);\n         }\n-        if (type == DataType.KEYWORD || type == DataType.IP || type == DataType.VERSION || type == DataType.TEXT) {\n+        if (DataType.isString(type) || type == DataType.IP || type == DataType.VERSION) {\n             return new CountDistinctBytesRefAggregatorFunctionSupplier(inputChannels, precision);\n         }\n         throw EsqlIllegalArgumentException.illegalDataType(type);\ndiff --git a/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/aggregate/Max.java b/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/aggregate/Max.java\nindex 47d74c71d9cc..6119b2ce5846 100644\n--- a/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/aggregate/Max.java\n+++ b/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/aggregate/Max.java\n@@ -128,7 +128,7 @@ public class Max extends AggregateFunction implements ToAggregator, SurrogateExp\n         if (type == DataType.IP) {\n             return new MaxIpAggregatorFunctionSupplier(inputChannels);\n         }\n-        if (type == DataType.VERSION || type == DataType.KEYWORD || type == DataType.TEXT) {\n+        if (type == DataType.VERSION || DataType.isString(type)) {\n             return new MaxBytesRefAggregatorFunctionSupplier(inputChannels);\n         }\n         throw EsqlIllegalArgumentException.illegalDataType(type);\ndiff --git a/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/aggregate/Min.java b/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/aggregate/Min.java\nindex ce69decca8e8..a1492f79da39 100644\n--- a/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/aggregate/Min.java\n+++ b/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/aggregate/Min.java\n@@ -128,7 +128,7 @@ public class Min extends AggregateFunction implements ToAggregator, SurrogateExp\n         if (type == DataType.IP) {\n             return new MinIpAggregatorFunctionSupplier(inputChannels);\n         }\n-        if (type == DataType.VERSION || type == DataType.KEYWORD || type == DataType.TEXT) {\n+        if (type == DataType.VERSION || DataType.isString(type)) {\n             return new MinBytesRefAggregatorFunctionSupplier(inputChannels);\n         }\n         throw EsqlIllegalArgumentException.illegalDataType(type);\ndiff --git a/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/scalar/conditional/Greatest.java b/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/scalar/conditional/Greatest.java\nindex 9d815d15accd..d47ebeab4ca6 100644\n--- a/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/scalar/conditional/Greatest.java\n+++ b/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/scalar/conditional/Greatest.java\n@@ -155,11 +155,7 @@ public class Greatest extends EsqlScalarFunction implements OptionalArgument {\n         if (dataType == DataType.LONG || dataType == DataType.DATETIME) {\n             return new GreatestLongEvaluator.Factory(source(), factories);\n         }\n-        if (dataType == DataType.KEYWORD\n-            || dataType == DataType.TEXT\n-            || dataType == DataType.IP\n-            || dataType == DataType.VERSION\n-            || dataType == DataType.UNSUPPORTED) {\n+        if (DataType.isString(dataType) || dataType == DataType.IP || dataType == DataType.VERSION || dataType == DataType.UNSUPPORTED) {\n \n             return new GreatestBytesRefEvaluator.Factory(source(), factories);\n         }\ndiff --git a/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/scalar/conditional/Least.java b/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/scalar/conditional/Least.java\nindex 435a14d0fef3..81c1419dcf78 100644\n--- a/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/scalar/conditional/Least.java\n+++ b/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/scalar/conditional/Least.java\n@@ -154,11 +154,7 @@ public class Least extends EsqlScalarFunction implements OptionalArgument {\n         if (dataType == DataType.LONG || dataType == DataType.DATETIME) {\n             return new LeastLongEvaluator.Factory(source(), factories);\n         }\n-        if (dataType == DataType.KEYWORD\n-            || dataType == DataType.TEXT\n-            || dataType == DataType.IP\n-            || dataType == DataType.VERSION\n-            || dataType == DataType.UNSUPPORTED) {\n+        if (DataType.isString(dataType) || dataType == DataType.IP || dataType == DataType.VERSION || dataType == DataType.UNSUPPORTED) {\n \n             return new LeastBytesRefEvaluator.Factory(source(), factories);\n         }\ndiff --git a/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/scalar/convert/AbstractConvertFunction.java b/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/scalar/convert/AbstractConvertFunction.java\nindex 5401fcf188d4..06815d738e82 100644\n--- a/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/scalar/convert/AbstractConvertFunction.java\n+++ b/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/scalar/convert/AbstractConvertFunction.java\n@@ -48,7 +48,6 @@ public abstract class AbstractConvertFunction extends UnaryScalarFunction {\n \n     // the numeric types convert functions need to handle; the other numeric types are converted upstream to one of these\n     private static final List<DataType> NUMERIC_TYPES = List.of(DataType.INTEGER, DataType.LONG, DataType.UNSIGNED_LONG, DataType.DOUBLE);\n-    public static final List<DataType> STRING_TYPES = DataType.types().stream().filter(DataType::isString).toList();\n \n     protected AbstractConvertFunction(Source source, Expression field) {\n         super(source, field);\n@@ -90,9 +89,9 @@ public abstract class AbstractConvertFunction extends UnaryScalarFunction {\n             NUMERIC_TYPES.forEach(supportTypes::remove);\n         }\n \n-        if (types.containsAll(STRING_TYPES)) {\n+        if (types.containsAll(DataType.stringTypes())) {\n             supportedTypesNames.add(\"string\");\n-            STRING_TYPES.forEach(supportTypes::remove);\n+            DataType.stringTypes().forEach(supportTypes::remove);\n         }\n \n         supportTypes.forEach(t -> supportedTypesNames.add(t.nameUpper().toLowerCase(Locale.ROOT)));\ndiff --git a/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/predicate/operator/comparison/InsensitiveEqualsMapper.java b/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/predicate/operator/comparison/InsensitiveEqualsMapper.java\nindex d11f5c9b6853..f5704239993f 100644\n--- a/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/predicate/operator/comparison/InsensitiveEqualsMapper.java\n+++ b/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/predicate/operator/comparison/InsensitiveEqualsMapper.java\n@@ -34,7 +34,7 @@ public class InsensitiveEqualsMapper extends ExpressionMapper<InsensitiveEquals>\n \n         var leftEval = toEvaluator(bc.left(), layout);\n         var rightEval = toEvaluator(bc.right(), layout);\n-        if (leftType == DataType.KEYWORD || leftType == DataType.TEXT) {\n+        if (DataType.isString(leftType)) {\n             if (bc.right().foldable() && DataType.isString(rightType)) {\n                 BytesRef rightVal = BytesRefs.toBytesRef(bc.right().fold());\n                 Automaton automaton = InsensitiveEquals.automaton(rightVal);\ndiff --git a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/AbstractFunctionTestCase.java b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/AbstractFunctionTestCase.java\nindex ca9950a4bfe7..84a41ef040c8 100644\n--- a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/AbstractFunctionTestCase.java\n+++ b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/AbstractFunctionTestCase.java\n@@ -1283,13 +1283,6 @@ public abstract class AbstractFunctionTestCase extends ESTestCase {\n         }\n     }\n \n-    /**\n-     * All string types (keyword, text, match_only_text, etc).\n-     */\n-    protected static DataType[] strings() {\n-        return DataType.types().stream().filter(DataType::isString).toArray(DataType[]::new);\n-    }\n-\n     /**\n      * Validate that we know the types for all the test cases already created\n      * @param suppliers - list of suppliers before adding in the illegal type combinations\n@@ -1316,10 +1309,9 @@ public abstract class AbstractFunctionTestCase extends ESTestCase {\n      */\n     private static boolean shouldHideSignature(List<DataType> argTypes, DataType returnType) {\n         for (DataType dt : DataType.UNDER_CONSTRUCTION.keySet()) {\n-            if (returnType == dt) {\n+            if (returnType == dt || argTypes.contains(dt)) {\n                 return true;\n             }\n-            return argTypes.contains(dt);\n         }\n         return false;\n     }\ndiff --git a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/TestCaseSupplier.java b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/TestCaseSupplier.java\nindex b3942a71edad..2ba175657b6c 100644\n--- a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/TestCaseSupplier.java\n+++ b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/TestCaseSupplier.java\n@@ -21,7 +21,6 @@ import org.elasticsearch.xpack.esql.core.expression.Literal;\n import org.elasticsearch.xpack.esql.core.tree.Source;\n import org.elasticsearch.xpack.esql.core.type.DataType;\n import org.elasticsearch.xpack.esql.core.util.NumericUtils;\n-import org.elasticsearch.xpack.esql.expression.function.scalar.convert.AbstractConvertFunction;\n import org.elasticsearch.xpack.versionfield.Version;\n import org.hamcrest.Matcher;\n \n@@ -91,7 +90,7 @@ public record TestCaseSupplier(String name, List<DataType> types, Supplier<TestC\n         List<TypedDataSupplier> lhsSuppliers = new ArrayList<>();\n         List<TypedDataSupplier> rhsSuppliers = new ArrayList<>();\n         List<TestCaseSupplier> suppliers = new ArrayList<>();\n-        for (DataType type : AbstractConvertFunction.STRING_TYPES) {\n+        for (DataType type : DataType.stringTypes()) {\n             lhsSuppliers.addAll(stringCases(type));\n             rhsSuppliers.addAll(stringCases(type));\n             casesCrossProduct(\n@@ -760,7 +759,7 @@ public record TestCaseSupplier(String name, List<DataType> types, Supplier<TestC\n         Function<BytesRef, Object> expectedValue,\n         Function<BytesRef, List<String>> expectedWarnings\n     ) {\n-        for (DataType type : AbstractConvertFunction.STRING_TYPES) {\n+        for (DataType type : DataType.stringTypes()) {\n             unary(\n                 suppliers,\n                 expectedEvaluatorToString,\ndiff --git a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/fulltext/MatchTests.java b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/fulltext/MatchTests.java\nindex d37bc89635c1..967b4d854c32 100644\n--- a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/fulltext/MatchTests.java\n+++ b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/fulltext/MatchTests.java\n@@ -20,7 +20,6 @@ import org.elasticsearch.xpack.esql.expression.function.FunctionName;\n import org.elasticsearch.xpack.esql.expression.function.TestCaseSupplier;\n import org.hamcrest.Matcher;\n \n-import java.util.Arrays;\n import java.util.LinkedList;\n import java.util.List;\n import java.util.Set;\n@@ -40,8 +39,8 @@ public class MatchTests extends AbstractFunctionTestCase {\n         Set<DataType> supported = Set.of(DataType.KEYWORD, DataType.TEXT);\n         List<Set<DataType>> supportedPerPosition = List.of(supported, supported);\n         List<TestCaseSupplier> suppliers = new LinkedList<>();\n-        for (DataType fieldType : validStringDataTypes()) {\n-            for (DataType queryType : validStringDataTypes()) {\n+        for (DataType fieldType : DataType.stringTypes()) {\n+            for (DataType queryType : DataType.stringTypes()) {\n                 suppliers.add(\n                     new TestCaseSupplier(\n                         \"<\" + fieldType + \"-ES field, \" + queryType + \">\",\n@@ -67,10 +66,6 @@ public class MatchTests extends AbstractFunctionTestCase {\n         return \"[] cannot operate on [\" + types.getFirst().typeName() + \"], which is not a field from an index mapping\";\n     }\n \n-    private static List<DataType> validStringDataTypes() {\n-        return Arrays.stream(DataType.values()).filter(DataType::isString).toList();\n-    }\n-\n     private static TestCaseSupplier.TestCase testCase(\n         DataType fieldType,\n         String field,\ndiff --git a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/fulltext/QueryStringTests.java b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/fulltext/QueryStringTests.java\nindex 2dfdb05ec8ec..b4b4ebcaacde 100644\n--- a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/fulltext/QueryStringTests.java\n+++ b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/fulltext/QueryStringTests.java\n@@ -19,7 +19,6 @@ import org.elasticsearch.xpack.esql.expression.function.FunctionName;\n import org.elasticsearch.xpack.esql.expression.function.TestCaseSupplier;\n import org.hamcrest.Matcher;\n \n-import java.util.Arrays;\n import java.util.LinkedList;\n import java.util.List;\n import java.util.function.Supplier;\n@@ -36,7 +35,7 @@ public class QueryStringTests extends AbstractFunctionTestCase {\n     @ParametersFactory\n     public static Iterable<Object[]> parameters() {\n         List<TestCaseSupplier> suppliers = new LinkedList<>();\n-        for (DataType strType : Arrays.stream(DataType.values()).filter(DataType::isString).toList()) {\n+        for (DataType strType : DataType.stringTypes()) {\n             suppliers.add(\n                 new TestCaseSupplier(\n                     \"<\" + strType + \">\",\ndiff --git a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/convert/ToVersionTests.java b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/convert/ToVersionTests.java\nindex 46a8086f9479..57f11331818d 100644\n--- a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/convert/ToVersionTests.java\n+++ b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/convert/ToVersionTests.java\n@@ -49,7 +49,7 @@ public class ToVersionTests extends AbstractScalarFunctionTestCase {\n         );\n \n         // But strings that are shaped like versions do parse to valid versions\n-        for (DataType inputType : AbstractConvertFunction.STRING_TYPES) {\n+        for (DataType inputType : DataType.stringTypes()) {\n             TestCaseSupplier.unary(\n                 suppliers,\n                 read,\ndiff --git a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/AbstractTrimTests.java b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/AbstractTrimTests.java\nindex f77a892d8682..d069f7ffe229 100644\n--- a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/AbstractTrimTests.java\n+++ b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/AbstractTrimTests.java\n@@ -21,7 +21,7 @@ import static org.hamcrest.Matchers.equalTo;\n public abstract class AbstractTrimTests extends AbstractScalarFunctionTestCase {\n     static Iterable<Object[]> parameters(String name, boolean trimLeading, boolean trimTrailing) {\n         List<TestCaseSupplier> suppliers = new ArrayList<>();\n-        for (DataType type : strings()) {\n+        for (DataType type : DataType.stringTypes()) {\n             suppliers.add(new TestCaseSupplier(\"no whitespace/\" + type, List.of(type), () -> {\n                 String text = randomAlphaOfLength(8);\n                 return testCase(name, type, text, text);\ndiff --git a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/ConcatTests.java b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/ConcatTests.java\nindex bbe92ae4a661..2ad953c9296b 100644\n--- a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/ConcatTests.java\n+++ b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/ConcatTests.java\n@@ -58,9 +58,7 @@ public class ConcatTests extends AbstractScalarFunctionTestCase {\n                 if (rhs == DataType.NULL || DataType.isRepresentable(rhs) == false) {\n                     continue;\n                 }\n-                boolean lhsIsString = lhs == DataType.KEYWORD || lhs == DataType.TEXT;\n-                boolean rhsIsString = rhs == DataType.KEYWORD || rhs == DataType.TEXT;\n-                if (lhsIsString && rhsIsString) {\n+                if (DataType.isString(lhs) && DataType.isString(rhs)) {\n                     continue;\n                 }\n \ndiff --git a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/EndsWithTests.java b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/EndsWithTests.java\nindex 6d086e2626cb..1b2e9c41cb25 100644\n--- a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/EndsWithTests.java\n+++ b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/EndsWithTests.java\n@@ -18,7 +18,6 @@ import org.elasticsearch.xpack.esql.expression.function.AbstractScalarFunctionTe\n import org.elasticsearch.xpack.esql.expression.function.TestCaseSupplier;\n import org.hamcrest.Matcher;\n \n-import java.util.Arrays;\n import java.util.LinkedList;\n import java.util.List;\n import java.util.function.Supplier;\n@@ -33,8 +32,8 @@ public class EndsWithTests extends AbstractScalarFunctionTestCase {\n     @ParametersFactory\n     public static Iterable<Object[]> parameters() {\n         List<TestCaseSupplier> suppliers = new LinkedList<>();\n-        for (DataType strType : Arrays.stream(DataType.values()).filter(DataType::isString).toList()) {\n-            for (DataType suffixType : Arrays.stream(DataType.values()).filter(DataType::isString).toList()) {\n+        for (DataType strType : DataType.stringTypes()) {\n+            for (DataType suffixType : DataType.stringTypes()) {\n                 suppliers.add(\n                     new TestCaseSupplier(\n                         \"<\" + strType + \">, empty <\" + suffixType + \">\",\ndiff --git a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/LocateTests.java b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/LocateTests.java\nindex 207125bed2a1..a10f97c45aa0 100644\n--- a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/LocateTests.java\n+++ b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/LocateTests.java\n@@ -35,13 +35,11 @@ public class LocateTests extends AbstractScalarFunctionTestCase {\n         this.testCase = testCaseSupplier.get();\n     }\n \n-    private static final DataType[] STRING_TYPES = new DataType[] { DataType.KEYWORD, DataType.TEXT };\n-\n     @ParametersFactory\n     public static Iterable<Object[]> parameters() {\n         List<TestCaseSupplier> suppliers = new ArrayList<>();\n-        for (DataType strType : STRING_TYPES) {\n-            for (DataType substrType : STRING_TYPES) {\n+        for (DataType strType : DataType.stringTypes()) {\n+            for (DataType substrType : DataType.stringTypes()) {\n                 suppliers.add(\n                     supplier(\n                         \"\",\ndiff --git a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/RLikeTests.java b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/RLikeTests.java\nindex 5a34d850cffe..dab2fca212ff 100644\n--- a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/RLikeTests.java\n+++ b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/RLikeTests.java\n@@ -69,7 +69,7 @@ public class RLikeTests extends AbstractScalarFunctionTestCase {\n         casesForString(cases, \"6 bytes, 2 code points\", () -> \"❗️\", false, escapeString, optionalPattern);\n         casesForString(cases, \"100 random code points\", () -> randomUnicodeOfCodepointLength(100), true, escapeString, optionalPattern);\n         for (DataType type : DataType.types()) {\n-            if (type == DataType.KEYWORD || type == DataType.TEXT || type == DataType.NULL) {\n+            if (DataType.isString(type) || type == DataType.NULL) {\n                 continue;\n             }\n             if (DataType.isRepresentable(type) == false) {\ndiff --git a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/StartsWithTests.java b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/StartsWithTests.java\nindex 8bc8cf3184a7..60ed3b05ad64 100644\n--- a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/StartsWithTests.java\n+++ b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/StartsWithTests.java\n@@ -18,7 +18,6 @@ import org.elasticsearch.xpack.esql.expression.function.AbstractScalarFunctionTe\n import org.elasticsearch.xpack.esql.expression.function.TestCaseSupplier;\n \n import java.util.ArrayList;\n-import java.util.Arrays;\n import java.util.List;\n import java.util.function.Supplier;\n \n@@ -32,8 +31,8 @@ public class StartsWithTests extends AbstractScalarFunctionTestCase {\n     @ParametersFactory\n     public static Iterable<Object[]> parameters() {\n         List<TestCaseSupplier> suppliers = new ArrayList<>();\n-        for (DataType strType : Arrays.stream(DataType.values()).filter(DataType::isString).toList()) {\n-            for (DataType prefixType : Arrays.stream(DataType.values()).filter(DataType::isString).toList()) {\n+        for (DataType strType : DataType.stringTypes()) {\n+            for (DataType prefixType : DataType.stringTypes()) {\n                 suppliers.add(new TestCaseSupplier(List.of(strType, prefixType), () -> {\n                     String str = randomAlphaOfLength(5);\n                     String prefix = randomAlphaOfLength(5);\ndiff --git a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/type/EsqlDataTypeConverterTests.java b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/type/EsqlDataTypeConverterTests.java\nindex 8ad083683f69..babb9fc8c0bd 100644\n--- a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/type/EsqlDataTypeConverterTests.java\n+++ b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/type/EsqlDataTypeConverterTests.java\n@@ -62,8 +62,7 @@ public class EsqlDataTypeConverterTests extends ESTestCase {\n     }\n \n     public void testCommonTypeStrings() {\n-        List<DataType> STRINGS = Arrays.stream(DataType.values()).filter(DataType::isString).toList();\n-        for (DataType dataType1 : STRINGS) {\n+        for (DataType dataType1 : DataType.stringTypes()) {\n             for (DataType dataType2 : DataType.values()) {\n                 if (dataType2 == NULL) {\n                     assertEqualsCommonType(dataType1, NULL, dataType1);\ndiff --git a/x-pack/plugin/rank-rrf/src/yamlRestTest/resources/rest-api-spec/test/rrf/700_rrf_retriever_search_api_compatibility.yml b/x-pack/plugin/rank-rrf/src/yamlRestTest/resources/rest-api-spec/test/rrf/700_rrf_retriever_search_api_compatibility.yml\nindex f3914843b80e..517c162c33e9 100644\n--- a/x-pack/plugin/rank-rrf/src/yamlRestTest/resources/rest-api-spec/test/rrf/700_rrf_retriever_search_api_compatibility.yml\n+++ b/x-pack/plugin/rank-rrf/src/yamlRestTest/resources/rest-api-spec/test/rrf/700_rrf_retriever_search_api_compatibility.yml\n@@ -11,8 +11,6 @@ setup:\n         body:\n           mappings:\n             properties:\n-              id:\n-                type: integer\n               text:\n                 type: text\n               text_to_highlight:\n@@ -41,7 +39,6 @@ setup:\n         index: test\n         id: \"1\"\n         body:\n-          id: 1\n           text: \"term1\"\n           vector: [1.0]\n \n@@ -50,7 +47,6 @@ setup:\n         index: test\n         id: \"2\"\n         body:\n-          id: 2\n           text: \"term2\"\n           text_to_highlight: \"search for the truth\"\n           keyword: \"biology\"\n@@ -61,7 +57,6 @@ setup:\n         index: test\n         id: \"3\"\n         body:\n-          id: 3\n           text: \"term3\"\n           text_to_highlight: \"nothing related\"\n           keyword: \"technology\"\n@@ -72,7 +67,6 @@ setup:\n         index: test\n         id: \"4\"\n         body:\n-          id: 4\n           text: \"term4\"\n           vector: [4.0]\n   - do:\n@@ -80,7 +74,6 @@ setup:\n         index: test\n         id: \"5\"\n         body:\n-          id: 5\n           text: \"term5\"\n           text_to_highlight: \"You know, for Search!\"\n           keyword: \"technology\"\n@@ -88,10 +81,9 @@ setup:\n           vector: [5.0]\n   - do:\n       index:\n-        id: 6\n         index: test\n+        id: \"6\"\n         body:\n-          id: 6\n           text: \"term6\"\n           keyword: \"biology\"\n           integer: 6\n@@ -101,7 +93,6 @@ setup:\n         index: test\n         id: \"7\"\n         body:\n-          id: 7\n           text: \"term7\"\n           keyword: \"astronomy\"\n           vector: [77.0]\n@@ -111,7 +102,6 @@ setup:\n         index: test\n         id: \"8\"\n         body:\n-          id: 8\n           text: \"term8\"\n           keyword: \"technology\"\n           nested: { views: 100}\n@@ -120,7 +110,6 @@ setup:\n         index: test\n         id: \"9\"\n         body:\n-          id: 9\n           text: \"term9\"\n           integer: 2\n           keyword: \"technology\"\n@@ -450,19 +439,7 @@ setup:\n               rank_window_size: 5\n               rank_constant: 10\n           size: 3\n-          collapse: {\n-            field: keyword,\n-            inner_hits: {\n-              name: sub_hits,\n-              size: 2,\n-              sort:\n-                {\n-                  id: {\n-                    order: desc\n-                  }\n-                }\n-            }\n-          }\n+          collapse: { field: keyword, inner_hits: { name: sub_hits, size: 2 } }\n \n   - match: { hits.total : 9 }\n \n@@ -479,8 +456,8 @@ setup:\n \n   - match: { hits.hits.1.inner_hits.sub_hits.hits.total : 4 }\n   - length: { hits.hits.1.inner_hits.sub_hits.hits.hits : 2 }\n-  - match: { hits.hits.1.inner_hits.sub_hits.hits.hits.0._id: \"9\" }\n-  - match: { hits.hits.1.inner_hits.sub_hits.hits.hits.1._id: \"8\" }\n+  - match: { hits.hits.1.inner_hits.sub_hits.hits.hits.0._id: \"5\" }\n+  - match: { hits.hits.1.inner_hits.sub_hits.hits.hits.1._id: \"3\" }\n \n   - length: { hits.hits.2.inner_hits.sub_hits.hits.hits: 2 }\n   - match: { hits.hits.2.inner_hits.sub_hits.hits.hits.0._id: \"6\" }",
  "judge_mode": "comparative",
  "judge_model": "openai/claude-sonnet-4-5-20250929",
  "test_label": "v0",
  "agent_results": [
    {
      "runner": "auggie",
      "model": "sonnet4.5",
      "edit_run_id": "a9463435",
      "status": "success",
      "elapsed_ms": 456139,
      "patch_unified": "diff --git a/x-pack/plugin/esql-core/src/main/java/org/elasticsearch/xpack/esql/core/type/DataType.java b/x-pack/plugin/esql-core/src/main/java/org/elasticsearch/xpack/esql/core/type/DataType.java\nindex b23703c6..2021d11a 100644\n--- a/x-pack/plugin/esql-core/src/main/java/org/elasticsearch/xpack/esql/core/type/DataType.java\n+++ b/x-pack/plugin/esql-core/src/main/java/org/elasticsearch/xpack/esql/core/type/DataType.java\n@@ -292,6 +292,13 @@ public enum DataType {\n         return TYPES;\n     }\n \n+    /**\n+     * Returns all string types (KEYWORD, TEXT, etc).\n+     */\n+    public static Collection<DataType> stringTypes() {\n+        return types().stream().filter(DataType::isString).toList();\n+    }\n+\n     /**\n      * Resolve a type from a name. This name is sometimes user supplied,\n      * like in the case of {@code ::<typename>} and is sometimes the name\ndiff --git a/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/scalar/conditional/Greatest.java b/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/scalar/conditional/Greatest.java\nindex 9d815d15..43b7ecce 100644\n--- a/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/scalar/conditional/Greatest.java\n+++ b/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/scalar/conditional/Greatest.java\n@@ -155,8 +155,7 @@ public class Greatest extends EsqlScalarFunction implements OptionalArgument {\n         if (dataType == DataType.LONG || dataType == DataType.DATETIME) {\n             return new GreatestLongEvaluator.Factory(source(), factories);\n         }\n-        if (dataType == DataType.KEYWORD\n-            || dataType == DataType.TEXT\n+        if (DataType.isString(dataType)\n             || dataType == DataType.IP\n             || dataType == DataType.VERSION\n             || dataType == DataType.UNSUPPORTED) {\ndiff --git a/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/scalar/conditional/Least.java b/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/scalar/conditional/Least.java\nindex 435a14d0..b9acf2da 100644\n--- a/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/scalar/conditional/Least.java\n+++ b/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/scalar/conditional/Least.java\n@@ -154,8 +154,7 @@ public class Least extends EsqlScalarFunction implements OptionalArgument {\n         if (dataType == DataType.LONG || dataType == DataType.DATETIME) {\n             return new LeastLongEvaluator.Factory(source(), factories);\n         }\n-        if (dataType == DataType.KEYWORD\n-            || dataType == DataType.TEXT\n+        if (DataType.isString(dataType)\n             || dataType == DataType.IP\n             || dataType == DataType.VERSION\n             || dataType == DataType.UNSUPPORTED) {\ndiff --git a/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/predicate/operator/comparison/InsensitiveEqualsMapper.java b/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/predicate/operator/comparison/InsensitiveEqualsMapper.java\nindex d11f5c9b..f5704239 100644\n--- a/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/predicate/operator/comparison/InsensitiveEqualsMapper.java\n+++ b/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/predicate/operator/comparison/InsensitiveEqualsMapper.java\n@@ -34,7 +34,7 @@ public class InsensitiveEqualsMapper extends ExpressionMapper<InsensitiveEquals>\n \n         var leftEval = toEvaluator(bc.left(), layout);\n         var rightEval = toEvaluator(bc.right(), layout);\n-        if (leftType == DataType.KEYWORD || leftType == DataType.TEXT) {\n+        if (DataType.isString(leftType)) {\n             if (bc.right().foldable() && DataType.isString(rightType)) {\n                 BytesRef rightVal = BytesRefs.toBytesRef(bc.right().fold());\n                 Automaton automaton = InsensitiveEquals.automaton(rightVal);\ndiff --git a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/AbstractFunctionTestCase.java b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/AbstractFunctionTestCase.java\nindex ca9950a4..8a00eac4 100644\n--- a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/AbstractFunctionTestCase.java\n+++ b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/AbstractFunctionTestCase.java\n@@ -1287,7 +1287,7 @@ public abstract class AbstractFunctionTestCase extends ESTestCase {\n      * All string types (keyword, text, match_only_text, etc).\n      */\n     protected static DataType[] strings() {\n-        return DataType.types().stream().filter(DataType::isString).toArray(DataType[]::new);\n+        return DataType.stringTypes().toArray(DataType[]::new);\n     }\n \n     /**\ndiff --git a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/fulltext/QueryStringTests.java b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/fulltext/QueryStringTests.java\nindex 2dfdb05e..926a4b96 100644\n--- a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/fulltext/QueryStringTests.java\n+++ b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/fulltext/QueryStringTests.java\n@@ -36,7 +36,7 @@ public class QueryStringTests extends AbstractFunctionTestCase {\n     @ParametersFactory\n     public static Iterable<Object[]> parameters() {\n         List<TestCaseSupplier> suppliers = new LinkedList<>();\n-        for (DataType strType : Arrays.stream(DataType.values()).filter(DataType::isString).toList()) {\n+        for (DataType strType : DataType.stringTypes()) {\n             suppliers.add(\n                 new TestCaseSupplier(\n                     \"<\" + strType + \">\",\ndiff --git a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/EndsWithTests.java b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/EndsWithTests.java\nindex 6d086e26..98d0db0d 100644\n--- a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/EndsWithTests.java\n+++ b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/EndsWithTests.java\n@@ -33,8 +33,8 @@ public class EndsWithTests extends AbstractScalarFunctionTestCase {\n     @ParametersFactory\n     public static Iterable<Object[]> parameters() {\n         List<TestCaseSupplier> suppliers = new LinkedList<>();\n-        for (DataType strType : Arrays.stream(DataType.values()).filter(DataType::isString).toList()) {\n-            for (DataType suffixType : Arrays.stream(DataType.values()).filter(DataType::isString).toList()) {\n+        for (DataType strType : DataType.stringTypes()) {\n+            for (DataType suffixType : DataType.stringTypes()) {\n                 suppliers.add(\n                     new TestCaseSupplier(\n                         \"<\" + strType + \">, empty <\" + suffixType + \">\",\ndiff --git a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/RLikeTests.java b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/RLikeTests.java\nindex 5a34d850..4f8adf3a 100644\n--- a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/RLikeTests.java\n+++ b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/RLikeTests.java\n@@ -69,7 +69,7 @@ public class RLikeTests extends AbstractScalarFunctionTestCase {\n         casesForString(cases, \"6 bytes, 2 code points\", () -> \"❗️\", false, escapeString, optionalPattern);\n         casesForString(cases, \"100 random code points\", () -> randomUnicodeOfCodepointLength(100), true, escapeString, optionalPattern);\n         for (DataType type : DataType.types()) {\n-            if (type == DataType.KEYWORD || type == DataType.TEXT || type == DataType.NULL) {\n+            if (DataType.isString(type) || type == DataType.NULL) {\n                 continue;\n             }\n             if (DataType.isRepresentable(type) == false) {\n@@ -125,7 +125,7 @@ public class RLikeTests extends AbstractScalarFunctionTestCase {\n     }\n \n     private static void cases(List<TestCaseSupplier> cases, String title, Supplier<TextAndPattern> textAndPattern, boolean expected) {\n-        for (DataType type : new DataType[] { DataType.KEYWORD, DataType.TEXT }) {\n+        for (DataType type : DataType.stringTypes()) {\n             cases.add(new TestCaseSupplier(title + \" with \" + type.esType(), List.of(type, type, DataType.BOOLEAN), () -> {\n                 TextAndPattern v = textAndPattern.get();\n                 return new TestCaseSupplier.TestCase(\ndiff --git a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/StartsWithTests.java b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/StartsWithTests.java\nindex 8bc8cf31..bcee1559 100644\n--- a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/StartsWithTests.java\n+++ b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/StartsWithTests.java\n@@ -32,8 +32,8 @@ public class StartsWithTests extends AbstractScalarFunctionTestCase {\n     @ParametersFactory\n     public static Iterable<Object[]> parameters() {\n         List<TestCaseSupplier> suppliers = new ArrayList<>();\n-        for (DataType strType : Arrays.stream(DataType.values()).filter(DataType::isString).toList()) {\n-            for (DataType prefixType : Arrays.stream(DataType.values()).filter(DataType::isString).toList()) {\n+        for (DataType strType : DataType.stringTypes()) {\n+            for (DataType prefixType : DataType.stringTypes()) {\n                 suppliers.add(new TestCaseSupplier(List.of(strType, prefixType), () -> {\n                     String str = randomAlphaOfLength(5);\n                     String prefix = randomAlphaOfLength(5);\ndiff --git a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/WildcardLikeTests.java b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/WildcardLikeTests.java\nindex 53b3a99f..737ccd4e 100644\n--- a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/WildcardLikeTests.java\n+++ b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/WildcardLikeTests.java\n@@ -53,7 +53,7 @@ public class WildcardLikeTests extends AbstractScalarFunctionTestCase {\n     }\n \n     private static void addCases(List<TestCaseSupplier> suppliers) {\n-        for (DataType type : new DataType[] { DataType.KEYWORD, DataType.TEXT }) {\n+        for (DataType type : DataType.stringTypes()) {\n             suppliers.add(new TestCaseSupplier(\" with \" + type.esType(), List.of(type, type), () -> {\n                 BytesRef str = new BytesRef(randomAlphaOfLength(5));\n                 String patternString = randomAlphaOfLength(2);\ndiff --git a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/type/EsqlDataTypeConverterTests.java b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/type/EsqlDataTypeConverterTests.java\nindex 8ad08368..a9dfc834 100644\n--- a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/type/EsqlDataTypeConverterTests.java\n+++ b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/type/EsqlDataTypeConverterTests.java\n@@ -62,7 +62,7 @@ public class EsqlDataTypeConverterTests extends ESTestCase {\n     }\n \n     public void testCommonTypeStrings() {\n-        List<DataType> STRINGS = Arrays.stream(DataType.values()).filter(DataType::isString).toList();\n+        List<DataType> STRINGS = DataType.stringTypes().stream().toList();\n         for (DataType dataType1 : STRINGS) {\n             for (DataType dataType2 : DataType.values()) {\n                 if (dataType2 == NULL) {",
      "scores": {
        "correctness": 0.7,
        "completeness": 0.3,
        "code_reuse": 0.8,
        "best_practices": 0.6,
        "unsolicited_docs": 0.0
      },
      "aggregate": 0.48,
      "rationale": "The agent correctly added the DataType.stringTypes() method and replaced many instances of type == DataType.KEYWORD || type == DataType.TEXT with DataType.isString(type). However, it missed several critical changes: (1) did not add the static STRING_TYPES field for caching, (2) did not update DataTypeConverter.java, (3) did not update CountDistinct.java, Max.java, Min.java, (4) did not update AbstractConvertFunction.java and its usages, (5) did not update TestCaseSupplier.java, (6) did not update several test files like MatchTests.java, ToVersionTests.java, AbstractTrimTests.java, ConcatTests.java, LocateTests.java, (7) did not update muted-tests.yml or the YAML test file. The agent also added unsolicited JavaDoc comments to the stringTypes() method. The changes made are correct but represent only about 30-40% of the required work.",
      "llm_rating": 0.42,
      "llm_summary": "Added DataType.stringTypes() method and replaced some type == DataType.KEYWORD || type == DataType.TEXT checks with DataType.isString() in Greatest, Least, InsensitiveEqualsMapper, and several test files, but missed the static STRING_TYPES caching field, DataTypeConverter, aggregate functions, AbstractConvertFunction, TestCaseSupplier, and multiple test files from ground truth.",
      "errors": []
    },
    {
      "runner": "claude-code",
      "model": "claude-sonnet-4-5",
      "edit_run_id": "c7a3f90a",
      "status": "success",
      "elapsed_ms": 259012,
      "patch_unified": "diff --git a/x-pack/plugin/esql-core/src/main/java/org/elasticsearch/xpack/esql/core/type/DataType.java b/x-pack/plugin/esql-core/src/main/java/org/elasticsearch/xpack/esql/core/type/DataType.java\nindex b23703c6..f2f3bec6 100644\n--- a/x-pack/plugin/esql-core/src/main/java/org/elasticsearch/xpack/esql/core/type/DataType.java\n+++ b/x-pack/plugin/esql-core/src/main/java/org/elasticsearch/xpack/esql/core/type/DataType.java\n@@ -24,6 +24,7 @@ import java.util.Arrays;\n import java.util.Collection;\n import java.util.Collections;\n import java.util.Comparator;\n+import java.util.List;\n import java.util.Locale;\n import java.util.Map;\n import java.util.Optional;\n@@ -292,6 +293,10 @@ public enum DataType {\n         return TYPES;\n     }\n \n+    public static List<DataType> stringTypes() {\n+        return TYPES.stream().filter(DataType::isString).toList();\n+    }\n+\n     /**\n      * Resolve a type from a name. This name is sometimes user supplied,\n      * like in the case of {@code ::<typename>} and is sometimes the name\ndiff --git a/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/aggregate/CountDistinct.java b/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/aggregate/CountDistinct.java\nindex 2550e5bd..756000df 100644\n--- a/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/aggregate/CountDistinct.java\n+++ b/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/aggregate/CountDistinct.java\n@@ -209,7 +209,7 @@ public class CountDistinct extends AggregateFunction implements OptionalArgument\n         if (type == DataType.DOUBLE) {\n             return new CountDistinctDoubleAggregatorFunctionSupplier(inputChannels, precision);\n         }\n-        if (type == DataType.KEYWORD || type == DataType.IP || type == DataType.VERSION || type == DataType.TEXT) {\n+        if (DataType.isString(type) || type == DataType.IP || type == DataType.VERSION) {\n             return new CountDistinctBytesRefAggregatorFunctionSupplier(inputChannels, precision);\n         }\n         throw EsqlIllegalArgumentException.illegalDataType(type);\ndiff --git a/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/aggregate/Max.java b/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/aggregate/Max.java\nindex 47d74c71..6119b2ce 100644\n--- a/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/aggregate/Max.java\n+++ b/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/aggregate/Max.java\n@@ -128,7 +128,7 @@ public class Max extends AggregateFunction implements ToAggregator, SurrogateExp\n         if (type == DataType.IP) {\n             return new MaxIpAggregatorFunctionSupplier(inputChannels);\n         }\n-        if (type == DataType.VERSION || type == DataType.KEYWORD || type == DataType.TEXT) {\n+        if (type == DataType.VERSION || DataType.isString(type)) {\n             return new MaxBytesRefAggregatorFunctionSupplier(inputChannels);\n         }\n         throw EsqlIllegalArgumentException.illegalDataType(type);\ndiff --git a/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/aggregate/Min.java b/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/aggregate/Min.java\nindex ce69decc..a1492f79 100644\n--- a/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/aggregate/Min.java\n+++ b/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/aggregate/Min.java\n@@ -128,7 +128,7 @@ public class Min extends AggregateFunction implements ToAggregator, SurrogateExp\n         if (type == DataType.IP) {\n             return new MinIpAggregatorFunctionSupplier(inputChannels);\n         }\n-        if (type == DataType.VERSION || type == DataType.KEYWORD || type == DataType.TEXT) {\n+        if (type == DataType.VERSION || DataType.isString(type)) {\n             return new MinBytesRefAggregatorFunctionSupplier(inputChannels);\n         }\n         throw EsqlIllegalArgumentException.illegalDataType(type);\ndiff --git a/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/scalar/convert/AbstractConvertFunction.java b/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/scalar/convert/AbstractConvertFunction.java\nindex 5401fcf1..2cae4bb5 100644\n--- a/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/scalar/convert/AbstractConvertFunction.java\n+++ b/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/scalar/convert/AbstractConvertFunction.java\n@@ -48,7 +48,7 @@ public abstract class AbstractConvertFunction extends UnaryScalarFunction {\n \n     // the numeric types convert functions need to handle; the other numeric types are converted upstream to one of these\n     private static final List<DataType> NUMERIC_TYPES = List.of(DataType.INTEGER, DataType.LONG, DataType.UNSIGNED_LONG, DataType.DOUBLE);\n-    public static final List<DataType> STRING_TYPES = DataType.types().stream().filter(DataType::isString).toList();\n+    public static final List<DataType> STRING_TYPES = DataType.stringTypes();\n \n     protected AbstractConvertFunction(Source source, Expression field) {\n         super(source, field);\ndiff --git a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/RLikeTests.java b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/RLikeTests.java\nindex 5a34d850..dab2fca2 100644\n--- a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/RLikeTests.java\n+++ b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/RLikeTests.java\n@@ -69,7 +69,7 @@ public class RLikeTests extends AbstractScalarFunctionTestCase {\n         casesForString(cases, \"6 bytes, 2 code points\", () -> \"❗️\", false, escapeString, optionalPattern);\n         casesForString(cases, \"100 random code points\", () -> randomUnicodeOfCodepointLength(100), true, escapeString, optionalPattern);\n         for (DataType type : DataType.types()) {\n-            if (type == DataType.KEYWORD || type == DataType.TEXT || type == DataType.NULL) {\n+            if (DataType.isString(type) || type == DataType.NULL) {\n                 continue;\n             }\n             if (DataType.isRepresentable(type) == false) {",
      "scores": {
        "correctness": 0.3,
        "completeness": -0.4,
        "code_reuse": 0.8,
        "best_practices": 0.7,
        "unsolicited_docs": 1.0
      },
      "aggregate": 0.48,
      "rationale": "The agent correctly added the DataType.stringTypes() method and replaced some occurrences of type == DataType.KEYWORD || type == DataType.TEXT with DataType.isString(type). However, it missed the majority of required changes: it only modified 4 files (CountDistinct.java, Max.java, Min.java, RLikeTests.java) out of approximately 20 files that needed changes in the ground truth. Critical omissions include DataTypeConverter.java, Greatest.java, Least.java, InsensitiveEqualsMapper.java, and numerous test files. The agent also failed to replace DataType.types().stream().filter(DataType::isString).toList() with DataType.stringTypes() in most locations, only doing so in AbstractConvertFunction.java. The implementation approach is correct where applied, but the scope is severely incomplete.",
      "llm_rating": 0.32,
      "llm_summary": "Added DataType.stringTypes() method and replaced type equality checks with DataType.isString() in CountDistinct, Max, Min, and RLikeTests, but missed approximately 16 other files requiring similar refactoring including DataTypeConverter, Greatest, Least, and multiple test files.",
      "errors": []
    },
    {
      "runner": "factory",
      "model": "claude-sonnet-4-5-20250929",
      "edit_run_id": "074538b9",
      "status": "success",
      "elapsed_ms": 1210419,
      "patch_unified": "diff --git a/x-pack/plugin/esql-core/src/main/java/org/elasticsearch/xpack/esql/core/type/DataType.java b/x-pack/plugin/esql-core/src/main/java/org/elasticsearch/xpack/esql/core/type/DataType.java\nindex b23703c6..6001bda0 100644\n--- a/x-pack/plugin/esql-core/src/main/java/org/elasticsearch/xpack/esql/core/type/DataType.java\n+++ b/x-pack/plugin/esql-core/src/main/java/org/elasticsearch/xpack/esql/core/type/DataType.java\n@@ -266,6 +266,8 @@ public enum DataType {\n         .sorted(Comparator.comparing(DataType::typeName))\n         .toList();\n \n+    private static final Collection<DataType> STRING_TYPES = TYPES.stream().filter(DataType::isString).toList();\n+\n     private static final Map<String, DataType> NAME_TO_TYPE = TYPES.stream().collect(toUnmodifiableMap(DataType::typeName, t -> t));\n \n     private static final Map<String, DataType> ES_TO_TYPE;\n@@ -292,6 +294,10 @@ public enum DataType {\n         return TYPES;\n     }\n \n+    public static Collection<DataType> stringTypes() {\n+        return STRING_TYPES;\n+    }\n+\n     /**\n      * Resolve a type from a name. This name is sometimes user supplied,\n      * like in the case of {@code ::<typename>} and is sometimes the name\ndiff --git a/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/aggregate/CountDistinct.java b/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/aggregate/CountDistinct.java\nindex 2550e5bd..756000df 100644\n--- a/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/aggregate/CountDistinct.java\n+++ b/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/aggregate/CountDistinct.java\n@@ -209,7 +209,7 @@ public class CountDistinct extends AggregateFunction implements OptionalArgument\n         if (type == DataType.DOUBLE) {\n             return new CountDistinctDoubleAggregatorFunctionSupplier(inputChannels, precision);\n         }\n-        if (type == DataType.KEYWORD || type == DataType.IP || type == DataType.VERSION || type == DataType.TEXT) {\n+        if (DataType.isString(type) || type == DataType.IP || type == DataType.VERSION) {\n             return new CountDistinctBytesRefAggregatorFunctionSupplier(inputChannels, precision);\n         }\n         throw EsqlIllegalArgumentException.illegalDataType(type);\ndiff --git a/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/aggregate/Max.java b/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/aggregate/Max.java\nindex 47d74c71..6119b2ce 100644\n--- a/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/aggregate/Max.java\n+++ b/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/aggregate/Max.java\n@@ -128,7 +128,7 @@ public class Max extends AggregateFunction implements ToAggregator, SurrogateExp\n         if (type == DataType.IP) {\n             return new MaxIpAggregatorFunctionSupplier(inputChannels);\n         }\n-        if (type == DataType.VERSION || type == DataType.KEYWORD || type == DataType.TEXT) {\n+        if (type == DataType.VERSION || DataType.isString(type)) {\n             return new MaxBytesRefAggregatorFunctionSupplier(inputChannels);\n         }\n         throw EsqlIllegalArgumentException.illegalDataType(type);\ndiff --git a/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/aggregate/Min.java b/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/aggregate/Min.java\nindex ce69decc..a1492f79 100644\n--- a/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/aggregate/Min.java\n+++ b/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/aggregate/Min.java\n@@ -128,7 +128,7 @@ public class Min extends AggregateFunction implements ToAggregator, SurrogateExp\n         if (type == DataType.IP) {\n             return new MinIpAggregatorFunctionSupplier(inputChannels);\n         }\n-        if (type == DataType.VERSION || type == DataType.KEYWORD || type == DataType.TEXT) {\n+        if (type == DataType.VERSION || DataType.isString(type)) {\n             return new MinBytesRefAggregatorFunctionSupplier(inputChannels);\n         }\n         throw EsqlIllegalArgumentException.illegalDataType(type);\ndiff --git a/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/scalar/convert/AbstractConvertFunction.java b/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/scalar/convert/AbstractConvertFunction.java\nindex 5401fcf1..b3dc5882 100644\n--- a/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/scalar/convert/AbstractConvertFunction.java\n+++ b/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/scalar/convert/AbstractConvertFunction.java\n@@ -48,7 +48,7 @@ public abstract class AbstractConvertFunction extends UnaryScalarFunction {\n \n     // the numeric types convert functions need to handle; the other numeric types are converted upstream to one of these\n     private static final List<DataType> NUMERIC_TYPES = List.of(DataType.INTEGER, DataType.LONG, DataType.UNSIGNED_LONG, DataType.DOUBLE);\n-    public static final List<DataType> STRING_TYPES = DataType.types().stream().filter(DataType::isString).toList();\n+    public static final List<DataType> STRING_TYPES = DataType.stringTypes().stream().toList();\n \n     protected AbstractConvertFunction(Source source, Expression field) {\n         super(source, field);\ndiff --git a/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/predicate/operator/comparison/InsensitiveEqualsMapper.java b/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/predicate/operator/comparison/InsensitiveEqualsMapper.java\nindex d11f5c9b..f5704239 100644\n--- a/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/predicate/operator/comparison/InsensitiveEqualsMapper.java\n+++ b/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/predicate/operator/comparison/InsensitiveEqualsMapper.java\n@@ -34,7 +34,7 @@ public class InsensitiveEqualsMapper extends ExpressionMapper<InsensitiveEquals>\n \n         var leftEval = toEvaluator(bc.left(), layout);\n         var rightEval = toEvaluator(bc.right(), layout);\n-        if (leftType == DataType.KEYWORD || leftType == DataType.TEXT) {\n+        if (DataType.isString(leftType)) {\n             if (bc.right().foldable() && DataType.isString(rightType)) {\n                 BytesRef rightVal = BytesRefs.toBytesRef(bc.right().fold());\n                 Automaton automaton = InsensitiveEquals.automaton(rightVal);\ndiff --git a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/AbstractFunctionTestCase.java b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/AbstractFunctionTestCase.java\nindex ca9950a4..dd44e79b 100644\n--- a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/AbstractFunctionTestCase.java\n+++ b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/AbstractFunctionTestCase.java\n@@ -1287,7 +1287,7 @@ public abstract class AbstractFunctionTestCase extends ESTestCase {\n      * All string types (keyword, text, match_only_text, etc).\n      */\n     protected static DataType[] strings() {\n-        return DataType.types().stream().filter(DataType::isString).toArray(DataType[]::new);\n+        return DataType.stringTypes().stream().toArray(DataType[]::new);\n     }\n \n     /**\ndiff --git a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/fulltext/MatchTests.java b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/fulltext/MatchTests.java\nindex d37bc896..bd29ccc8 100644\n--- a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/fulltext/MatchTests.java\n+++ b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/fulltext/MatchTests.java\n@@ -21,6 +21,7 @@ import org.elasticsearch.xpack.esql.expression.function.TestCaseSupplier;\n import org.hamcrest.Matcher;\n \n import java.util.Arrays;\n+import java.util.HashSet;\n import java.util.LinkedList;\n import java.util.List;\n import java.util.Set;\n@@ -37,7 +38,7 @@ public class MatchTests extends AbstractFunctionTestCase {\n \n     @ParametersFactory\n     public static Iterable<Object[]> parameters() {\n-        Set<DataType> supported = Set.of(DataType.KEYWORD, DataType.TEXT);\n+        Set<DataType> supported = new HashSet<>(DataType.stringTypes());\n         List<Set<DataType>> supportedPerPosition = List.of(supported, supported);\n         List<TestCaseSupplier> suppliers = new LinkedList<>();\n         for (DataType fieldType : validStringDataTypes()) {\n@@ -68,7 +69,7 @@ public class MatchTests extends AbstractFunctionTestCase {\n     }\n \n     private static List<DataType> validStringDataTypes() {\n-        return Arrays.stream(DataType.values()).filter(DataType::isString).toList();\n+        return DataType.stringTypes().stream().toList();\n     }\n \n     private static TestCaseSupplier.TestCase testCase(\ndiff --git a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/fulltext/QueryStringTests.java b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/fulltext/QueryStringTests.java\nindex 2dfdb05e..926a4b96 100644\n--- a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/fulltext/QueryStringTests.java\n+++ b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/fulltext/QueryStringTests.java\n@@ -36,7 +36,7 @@ public class QueryStringTests extends AbstractFunctionTestCase {\n     @ParametersFactory\n     public static Iterable<Object[]> parameters() {\n         List<TestCaseSupplier> suppliers = new LinkedList<>();\n-        for (DataType strType : Arrays.stream(DataType.values()).filter(DataType::isString).toList()) {\n+        for (DataType strType : DataType.stringTypes()) {\n             suppliers.add(\n                 new TestCaseSupplier(\n                     \"<\" + strType + \">\",\ndiff --git a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/grouping/CategorizeTests.java b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/grouping/CategorizeTests.java\nindex f93389d5..23245ce4 100644\n--- a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/grouping/CategorizeTests.java\n+++ b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/grouping/CategorizeTests.java\n@@ -31,7 +31,7 @@ public class CategorizeTests extends AbstractScalarFunctionTestCase {\n     @ParametersFactory\n     public static Iterable<Object[]> parameters() {\n         List<TestCaseSupplier> suppliers = new ArrayList<>();\n-        for (DataType dataType : List.of(DataType.KEYWORD, DataType.TEXT)) {\n+        for (DataType dataType : DataType.stringTypes()) {\n             suppliers.add(\n                 new TestCaseSupplier(\n                     \"text with \" + dataType.typeName(),\ndiff --git a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/convert/ToCartesianPointTests.java b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/convert/ToCartesianPointTests.java\nindex 9548b047..bd9b3d98 100644\n--- a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/convert/ToCartesianPointTests.java\n+++ b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/convert/ToCartesianPointTests.java\n@@ -55,7 +55,7 @@ public class ToCartesianPointTests extends AbstractScalarFunctionTestCase {\n             }\n         );\n         // strings that are cartesian point representations\n-        for (DataType dt : List.of(DataType.KEYWORD, DataType.TEXT)) {\n+        for (DataType dt : DataType.stringTypes()) {\n             TestCaseSupplier.unary(\n                 suppliers,\n                 evaluatorName.apply(\"FromString\"),\ndiff --git a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/convert/ToCartesianShapeTests.java b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/convert/ToCartesianShapeTests.java\nindex 5784c355..cdaf0e8c 100644\n--- a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/convert/ToCartesianShapeTests.java\n+++ b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/convert/ToCartesianShapeTests.java\n@@ -56,7 +56,7 @@ public class ToCartesianShapeTests extends AbstractScalarFunctionTestCase {\n             }\n         );\n         // strings that are cartesian_shape representations\n-        for (DataType dt : List.of(DataType.KEYWORD, DataType.TEXT)) {\n+        for (DataType dt : DataType.stringTypes()) {\n             TestCaseSupplier.unary(\n                 suppliers,\n                 evaluatorName.apply(\"FromString\"),\ndiff --git a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/convert/ToGeoPointTests.java b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/convert/ToGeoPointTests.java\nindex 445c4b8f..6e97451d 100644\n--- a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/convert/ToGeoPointTests.java\n+++ b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/convert/ToGeoPointTests.java\n@@ -49,7 +49,7 @@ public class ToGeoPointTests extends AbstractScalarFunctionTestCase {\n             );\n         });\n         // strings that are geo point representations\n-        for (DataType dt : List.of(DataType.KEYWORD, DataType.TEXT)) {\n+        for (DataType dt : DataType.stringTypes()) {\n             TestCaseSupplier.unary(\n                 suppliers,\n                 evaluatorName.apply(\"FromString\"),\ndiff --git a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/convert/ToGeoShapeTests.java b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/convert/ToGeoShapeTests.java\nindex 38d871b1..e32457e9 100644\n--- a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/convert/ToGeoShapeTests.java\n+++ b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/convert/ToGeoShapeTests.java\n@@ -50,7 +50,7 @@ public class ToGeoShapeTests extends AbstractScalarFunctionTestCase {\n             );\n         });\n         // strings that are geo_shape representations\n-        for (DataType dt : List.of(DataType.KEYWORD, DataType.TEXT)) {\n+        for (DataType dt : DataType.stringTypes()) {\n             TestCaseSupplier.unary(\n                 suppliers,\n                 evaluatorName.apply(\"FromString\"),\ndiff --git a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/ConcatTests.java b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/ConcatTests.java\nindex bbe92ae4..72ffff25 100644\n--- a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/ConcatTests.java\n+++ b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/ConcatTests.java\n@@ -23,6 +23,7 @@ import org.elasticsearch.xpack.esql.expression.function.TestCaseSupplier;\n \n import java.util.ArrayList;\n import java.util.HashMap;\n+import java.util.HashSet;\n import java.util.List;\n import java.util.Map;\n import java.util.Objects;\n@@ -48,7 +49,8 @@ public class ConcatTests extends AbstractScalarFunctionTestCase {\n         for (int length = 4; length < 100; length++) {\n             suppliers(suppliers, length);\n         }\n-        Set<DataType> supported = Set.of(DataType.NULL, DataType.KEYWORD, DataType.TEXT);\n+        Set<DataType> supported = new HashSet<>(DataType.stringTypes());\n+        supported.add(DataType.NULL);\n         List<Set<DataType>> supportedPerPosition = List.of(supported, supported);\n         for (DataType lhs : DataType.types()) {\n             if (lhs == DataType.NULL || DataType.isRepresentable(lhs) == false) {\n@@ -58,8 +60,8 @@ public class ConcatTests extends AbstractScalarFunctionTestCase {\n                 if (rhs == DataType.NULL || DataType.isRepresentable(rhs) == false) {\n                     continue;\n                 }\n-                boolean lhsIsString = lhs == DataType.KEYWORD || lhs == DataType.TEXT;\n-                boolean rhsIsString = rhs == DataType.KEYWORD || rhs == DataType.TEXT;\n+                boolean lhsIsString = DataType.isString(lhs);\n+                boolean rhsIsString = DataType.isString(rhs);\n                 if (lhsIsString && rhsIsString) {\n                     continue;\n                 }\n@@ -101,8 +103,8 @@ public class ConcatTests extends AbstractScalarFunctionTestCase {\n \n     private static void add(List<TestCaseSupplier> suppliers, String name, int length, Supplier<String> valueSupplier) {\n         Map<Integer, List<List<DataType>>> permutations = new HashMap<Integer, List<List<DataType>>>();\n-        List<DataType> supportedDataTypes = List.of(DataType.KEYWORD, DataType.TEXT);\n-        permutations.put(0, List.of(List.of(DataType.KEYWORD), List.of(DataType.TEXT)));\n+        List<DataType> supportedDataTypes = DataType.stringTypes().stream().toList();\n+        permutations.put(0, supportedDataTypes.stream().map(List::of).toList());\n         for (int v = 0; v < length - 1; v++) {\n             List<List<DataType>> current = permutations.get(v);\n             List<List<DataType>> next = new ArrayList<>();\ndiff --git a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/EndsWithTests.java b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/EndsWithTests.java\nindex 6d086e26..98d0db0d 100644\n--- a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/EndsWithTests.java\n+++ b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/EndsWithTests.java\n@@ -33,8 +33,8 @@ public class EndsWithTests extends AbstractScalarFunctionTestCase {\n     @ParametersFactory\n     public static Iterable<Object[]> parameters() {\n         List<TestCaseSupplier> suppliers = new LinkedList<>();\n-        for (DataType strType : Arrays.stream(DataType.values()).filter(DataType::isString).toList()) {\n-            for (DataType suffixType : Arrays.stream(DataType.values()).filter(DataType::isString).toList()) {\n+        for (DataType strType : DataType.stringTypes()) {\n+            for (DataType suffixType : DataType.stringTypes()) {\n                 suppliers.add(\n                     new TestCaseSupplier(\n                         \"<\" + strType + \">, empty <\" + suffixType + \">\",\ndiff --git a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/LocateTests.java b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/LocateTests.java\nindex 207125be..5c6beaa5 100644\n--- a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/LocateTests.java\n+++ b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/LocateTests.java\n@@ -35,7 +35,7 @@ public class LocateTests extends AbstractScalarFunctionTestCase {\n         this.testCase = testCaseSupplier.get();\n     }\n \n-    private static final DataType[] STRING_TYPES = new DataType[] { DataType.KEYWORD, DataType.TEXT };\n+    private static final Collection<DataType> STRING_TYPES = DataType.stringTypes();\n \n     @ParametersFactory\n     public static Iterable<Object[]> parameters() {\ndiff --git a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/RLikeTests.java b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/RLikeTests.java\nindex 5a34d850..4f8adf3a 100644\n--- a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/RLikeTests.java\n+++ b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/RLikeTests.java\n@@ -69,7 +69,7 @@ public class RLikeTests extends AbstractScalarFunctionTestCase {\n         casesForString(cases, \"6 bytes, 2 code points\", () -> \"❗️\", false, escapeString, optionalPattern);\n         casesForString(cases, \"100 random code points\", () -> randomUnicodeOfCodepointLength(100), true, escapeString, optionalPattern);\n         for (DataType type : DataType.types()) {\n-            if (type == DataType.KEYWORD || type == DataType.TEXT || type == DataType.NULL) {\n+            if (DataType.isString(type) || type == DataType.NULL) {\n                 continue;\n             }\n             if (DataType.isRepresentable(type) == false) {\n@@ -125,7 +125,7 @@ public class RLikeTests extends AbstractScalarFunctionTestCase {\n     }\n \n     private static void cases(List<TestCaseSupplier> cases, String title, Supplier<TextAndPattern> textAndPattern, boolean expected) {\n-        for (DataType type : new DataType[] { DataType.KEYWORD, DataType.TEXT }) {\n+        for (DataType type : DataType.stringTypes()) {\n             cases.add(new TestCaseSupplier(title + \" with \" + type.esType(), List.of(type, type, DataType.BOOLEAN), () -> {\n                 TextAndPattern v = textAndPattern.get();\n                 return new TestCaseSupplier.TestCase(\ndiff --git a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/ReverseTests.java b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/ReverseTests.java\nindex 2873f18d..58d52cc0 100644\n--- a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/ReverseTests.java\n+++ b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/ReverseTests.java\n@@ -33,7 +33,7 @@ public class ReverseTests extends AbstractScalarFunctionTestCase {\n     public static Iterable<Object[]> parameters() {\n         List<TestCaseSupplier> suppliers = new ArrayList<>();\n \n-        for (DataType stringType : new DataType[] { DataType.KEYWORD, DataType.TEXT }) {\n+        for (DataType stringType : DataType.stringTypes()) {\n             for (var supplier : TestCaseSupplier.stringCases(stringType)) {\n                 suppliers.add(makeSupplier(supplier));\n             }\ndiff --git a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/SplitTests.java b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/SplitTests.java\nindex b5560f37..414412fa 100644\n--- a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/SplitTests.java\n+++ b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/SplitTests.java\n@@ -42,7 +42,7 @@ public class SplitTests extends AbstractScalarFunctionTestCase {\n     @ParametersFactory\n     public static Iterable<Object[]> parameters() {\n         List<TestCaseSupplier> suppliers = new ArrayList<>();\n-        List<DataType> supportedDataTyes = List.of(DataType.KEYWORD, DataType.TEXT);\n+        List<DataType> supportedDataTyes = DataType.stringTypes().stream().toList();\n         for (DataType sType : supportedDataTyes) {\n             for (DataType dType : supportedDataTyes) {\n                 suppliers.add(new TestCaseSupplier(\"split test \" + sType.toString() + \" \" + dType.toString(), List.of(sType, dType), () -> {\ndiff --git a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/StartsWithTests.java b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/StartsWithTests.java\nindex 8bc8cf31..bcee1559 100644\n--- a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/StartsWithTests.java\n+++ b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/StartsWithTests.java\n@@ -32,8 +32,8 @@ public class StartsWithTests extends AbstractScalarFunctionTestCase {\n     @ParametersFactory\n     public static Iterable<Object[]> parameters() {\n         List<TestCaseSupplier> suppliers = new ArrayList<>();\n-        for (DataType strType : Arrays.stream(DataType.values()).filter(DataType::isString).toList()) {\n-            for (DataType prefixType : Arrays.stream(DataType.values()).filter(DataType::isString).toList()) {\n+        for (DataType strType : DataType.stringTypes()) {\n+            for (DataType prefixType : DataType.stringTypes()) {\n                 suppliers.add(new TestCaseSupplier(List.of(strType, prefixType), () -> {\n                     String str = randomAlphaOfLength(5);\n                     String prefix = randomAlphaOfLength(5);\ndiff --git a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/WildcardLikeTests.java b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/WildcardLikeTests.java\nindex 53b3a99f..737ccd4e 100644\n--- a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/WildcardLikeTests.java\n+++ b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/WildcardLikeTests.java\n@@ -53,7 +53,7 @@ public class WildcardLikeTests extends AbstractScalarFunctionTestCase {\n     }\n \n     private static void addCases(List<TestCaseSupplier> suppliers) {\n-        for (DataType type : new DataType[] { DataType.KEYWORD, DataType.TEXT }) {\n+        for (DataType type : DataType.stringTypes()) {\n             suppliers.add(new TestCaseSupplier(\" with \" + type.esType(), List.of(type, type), () -> {\n                 BytesRef str = new BytesRef(randomAlphaOfLength(5));\n                 String patternString = randomAlphaOfLength(2);\ndiff --git a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/predicate/operator/comparison/InTests.java b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/predicate/operator/comparison/InTests.java\nindex 2a1dfb09..a39cea30 100644\n--- a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/predicate/operator/comparison/InTests.java\n+++ b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/predicate/operator/comparison/InTests.java\n@@ -187,8 +187,8 @@ public class InTests extends AbstractFunctionTestCase {\n             );\n         }));\n \n-        for (DataType type1 : new DataType[] { DataType.KEYWORD, DataType.TEXT }) {\n-            for (DataType type2 : new DataType[] { DataType.KEYWORD, DataType.TEXT }) {\n+        for (DataType type1 : DataType.stringTypes()) {\n+            for (DataType type2 : DataType.stringTypes()) {\n                 if (type1 == type2 || items > 1) continue;\n                 suppliers.add(new TestCaseSupplier(type1 + \" \" + type2, List.of(type1, type2), () -> {\n                     List<Object> inlist = randomList(items, items, () -> randomLiteral(type1).value());\ndiff --git a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/type/EsqlDataTypeConverterTests.java b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/type/EsqlDataTypeConverterTests.java\nindex 8ad08368..a9dfc834 100644\n--- a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/type/EsqlDataTypeConverterTests.java\n+++ b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/type/EsqlDataTypeConverterTests.java\n@@ -62,7 +62,7 @@ public class EsqlDataTypeConverterTests extends ESTestCase {\n     }\n \n     public void testCommonTypeStrings() {\n-        List<DataType> STRINGS = Arrays.stream(DataType.values()).filter(DataType::isString).toList();\n+        List<DataType> STRINGS = DataType.stringTypes().stream().toList();\n         for (DataType dataType1 : STRINGS) {\n             for (DataType dataType2 : DataType.values()) {\n                 if (dataType2 == NULL) {",
      "scores": {
        "correctness": 0.7,
        "completeness": 0.6,
        "code_reuse": 0.9,
        "best_practices": 0.8,
        "unsolicited_docs": 1.0
      },
      "aggregate": 0.8,
      "rationale": "The agent correctly added the DataType.stringTypes() method and replaced most occurrences of DataType.types().stream().filter(DataType::isString) with calls to the new method. It also replaced many type == DataType.KEYWORD || type == DataType.TEXT checks with DataType.isString(). However, there are several issues: (1) In AbstractConvertFunction.java, the agent used DataType.stringTypes().stream().toList() instead of just DataType.stringTypes() (which already returns a Collection), creating unnecessary overhead. (2) The agent missed several key files from the ground truth including DataTypeConverter.java, Greatest.java, and Least.java where type checks should have been replaced with DataType.isString(). (3) In MatchTests.java, the agent unnecessarily changed Set.of() to new HashSet<>() and added an import. (4) The agent removed the strings() helper method from AbstractFunctionTestCase.java but then had to add .stream() calls in multiple test files, whereas the ground truth kept the helper method. (5) In LocateTests.java, the agent changed STRING_TYPES from an array to a Collection, which is inconsistent with the ground truth. (6) The agent missed the muted-tests.yml changes entirely, though these appear unrelated to the main task. Overall, the agent understood the task and made most of the required changes, but missed some files and made suboptimal implementation choices in others.",
      "llm_rating": 0.68,
      "llm_summary": "Added DataType.stringTypes() method and replaced most string type checks with DataType.isString() calls, but missed DataTypeConverter.java, Greatest.java, and Least.java files, removed the strings() helper method unnecessarily, and used inefficient DataType.stringTypes().stream().toList() pattern in AbstractConvertFunction.java.",
      "errors": []
    }
  ],
  "comparative_analysis": {
    "summary": "All three agents successfully implemented the core refactoring task, but with varying levels of completeness. factory:claude-sonnet-4-5-20250929 provided the most comprehensive solution by implementing both the stringTypes() method with proper caching and replacing all occurrences of type checks with DataType.isString(). auggie:sonnet4.5 and claude-code:claude-sonnet-4-5 both implemented the stringTypes() method but missed several important refactoring opportunities in other files.",
    "best_agent": "factory:claude-sonnet-4-5-20250929",
    "best_agent_reasoning": "factory:claude-sonnet-4-5-20250929 achieved the highest completeness score (0.60) and best practices score (0.80) by implementing the stringTypes() method with proper static caching (avoiding repeated stream operations) and successfully refactoring more files to use DataType.isString() instead of explicit type checks. The agent also made changes to DataTypeConverter.java and test files that the other agents missed, demonstrating a more thorough understanding of the task requirements.",
    "approach_differences": "The key difference lies in implementation strategy and thoroughness. factory:claude-sonnet-4-5-20250929 used a cached static field (STRING_TYPES) for the stringTypes() method, which is more efficient than computing it on each call. auggie:sonnet4.5 computed the list dynamically in the stringTypes() method and added unnecessary documentation, while claude-code:claude-sonnet-4-5 also computed it dynamically but with a different return type (List vs Collection). In terms of refactoring coverage, factory:claude-sonnet-4-5-20250929 modified more files including DataTypeConverter.java and AbstractConvertFunction.java, while the other two agents focused primarily on aggregate functions and conditional expressions.",
    "ranking": [
      "factory:claude-sonnet-4-5-20250929",
      "auggie:sonnet4.5",
      "claude-code:claude-sonnet-4-5"
    ]
  },
  "timestamp": "2025-11-06T21:39:12.921592",
  "analysis_run_id": "5ece988b"
}