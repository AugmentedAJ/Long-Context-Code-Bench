{
  "repo_url": "https://github.com/elastic/elasticsearch.git",
  "pr_number": 114884,
  "base_commit": "5271b20b64bbf17284d344f4bf1adea42ea78f1e",
  "head_commit": "49325ea31db9bfff39b0314a4402b3ddbf4e3b6b",
  "task_instructions": "You are working on a codebase. Your task is to make the necessary code changes to accomplish the following:\n\nDocument _cat/indices behavior when encountering source only indices\n\nCloses https://github.com/elastic/elasticsearch/issues/114546\n\nPlease make all necessary code changes to complete this task.",
  "ground_truth_diff": "diff --git a/docs/reference/cat/indices.asciidoc b/docs/reference/cat/indices.asciidoc\nindex cf1cc9f825cb..b8dda01c2eae 100644\n--- a/docs/reference/cat/indices.asciidoc\n+++ b/docs/reference/cat/indices.asciidoc\n@@ -6,8 +6,8 @@\n \n [IMPORTANT]\n ====\n-cat APIs are only intended for human consumption using the command line or {kib} \n-console. They are _not_ intended for use by applications. For application \n+cat APIs are only intended for human consumption using the command line or {kib}\n+console. They are _not_ intended for use by applications. For application\n consumption, use the <<indices-get-index,get index API>>.\n ====\n \n@@ -50,6 +50,10 @@ indexing and search. As a result, all document counts include hidden\n To get an accurate count of {es} documents, use the <<cat-count,cat count>> or\n <<search-count,count>> APIs.\n \n+Note that information such as document count, deleted document count and store size are not shown for\n+indices restored from <<snapshots-source-only-repository,source-only snapshots>> since these indices\n+do not contain the relevant data structures to retrieve this information from.\n+\n \n [[cat-indices-api-path-params]]\n ==== {api-path-parms-title}\ndiff --git a/docs/reference/snapshot-restore/repository-source-only.asciidoc b/docs/reference/snapshot-restore/repository-source-only.asciidoc\nindex 04e53c42aff9..3c11d6ca6e59 100644\n--- a/docs/reference/snapshot-restore/repository-source-only.asciidoc\n+++ b/docs/reference/snapshot-restore/repository-source-only.asciidoc\n@@ -27,6 +27,9 @@ As a result, indices adopting synthetic source cannot be restored. When you rest\n  * The mapping of the restored index is empty, but the original mapping is available from the types top\n    level `meta` element.\n \n+ * Information such as document count, deleted document count and store size are not available for such indices\n+   since these indices do not contain the relevant data structures to retrieve this information from. Therefore,\n+   this information is not shown for such indices in APIs such as the <<cat-indices,cat indices API>>.\n ==================================================\n \n Before registering a source-only repository, use {kib} or the\ndiff --git a/modules/data-streams/src/internalClusterTest/java/org/elasticsearch/datastreams/DataStreamsSnapshotsIT.java b/modules/data-streams/src/internalClusterTest/java/org/elasticsearch/datastreams/DataStreamsSnapshotsIT.java\nindex 212b869c6d93..638e4d813a79 100644\n--- a/modules/data-streams/src/internalClusterTest/java/org/elasticsearch/datastreams/DataStreamsSnapshotsIT.java\n+++ b/modules/data-streams/src/internalClusterTest/java/org/elasticsearch/datastreams/DataStreamsSnapshotsIT.java\n@@ -138,7 +138,9 @@ public class DataStreamsSnapshotsIT extends AbstractSnapshotIntegTestCase {\n         // Initialize the failure store.\n         RolloverRequest rolloverRequest = new RolloverRequest(\"with-fs\", null);\n         rolloverRequest.setIndicesOptions(\n-            IndicesOptions.builder(rolloverRequest.indicesOptions()).selectorOptions(IndicesOptions.SelectorOptions.ONLY_FAILURES).build()\n+            IndicesOptions.builder(rolloverRequest.indicesOptions())\n+                .failureStoreOptions(b -> b.includeRegularIndices(false).includeFailureIndices(true))\n+                .build()\n         );\n         response = client.execute(RolloverAction.INSTANCE, rolloverRequest).get();\n         assertTrue(response.isAcknowledged());\ndiff --git a/modules/data-streams/src/internalClusterTest/java/org/elasticsearch/datastreams/IngestFailureStoreMetricsIT.java b/modules/data-streams/src/internalClusterTest/java/org/elasticsearch/datastreams/IngestFailureStoreMetricsIT.java\nindex 679ad5b000c8..b5d06dc33e03 100644\n--- a/modules/data-streams/src/internalClusterTest/java/org/elasticsearch/datastreams/IngestFailureStoreMetricsIT.java\n+++ b/modules/data-streams/src/internalClusterTest/java/org/elasticsearch/datastreams/IngestFailureStoreMetricsIT.java\n@@ -195,7 +195,9 @@ public class IngestFailureStoreMetricsIT extends ESIntegTestCase {\n         // Initialize failure store.\n         var rolloverRequest = new RolloverRequest(dataStream, null);\n         rolloverRequest.setIndicesOptions(\n-            IndicesOptions.builder(rolloverRequest.indicesOptions()).selectorOptions(IndicesOptions.SelectorOptions.ONLY_FAILURES).build()\n+            IndicesOptions.builder(rolloverRequest.indicesOptions())\n+                .failureStoreOptions(opts -> opts.includeFailureIndices(true).includeRegularIndices(false))\n+                .build()\n         );\n         var rolloverResponse = client().execute(RolloverAction.INSTANCE, rolloverRequest).actionGet();\n         var failureStoreIndex = rolloverResponse.getNewIndex();\ndiff --git a/modules/data-streams/src/main/java/org/elasticsearch/datastreams/lifecycle/DataStreamLifecycleService.java b/modules/data-streams/src/main/java/org/elasticsearch/datastreams/lifecycle/DataStreamLifecycleService.java\nindex 7bbf7137d290..878583de4861 100644\n--- a/modules/data-streams/src/main/java/org/elasticsearch/datastreams/lifecycle/DataStreamLifecycleService.java\n+++ b/modules/data-streams/src/main/java/org/elasticsearch/datastreams/lifecycle/DataStreamLifecycleService.java\n@@ -946,7 +946,7 @@ public class DataStreamLifecycleService implements ClusterStateListener, Closeab\n                 UpdateSettingsRequest updateMergePolicySettingsRequest = new UpdateSettingsRequest();\n                 updateMergePolicySettingsRequest.indicesOptions(\n                     IndicesOptions.builder(updateMergePolicySettingsRequest.indicesOptions())\n-                        .selectorOptions(IndicesOptions.SelectorOptions.DATA_AND_FAILURE)\n+                        .failureStoreOptions(new IndicesOptions.FailureStoreOptions(true, true))\n                         .build()\n                 );\n                 updateMergePolicySettingsRequest.indices(indexName);\n@@ -1409,7 +1409,7 @@ public class DataStreamLifecycleService implements ClusterStateListener, Closeab\n         if (rolloverFailureStore) {\n             rolloverRequest.setIndicesOptions(\n                 IndicesOptions.builder(rolloverRequest.indicesOptions())\n-                    .selectorOptions(IndicesOptions.SelectorOptions.ONLY_FAILURES)\n+                    .failureStoreOptions(opts -> opts.includeFailureIndices(true).includeRegularIndices(false))\n                     .build()\n             );\n         }\ndiff --git a/modules/data-streams/src/main/java/org/elasticsearch/datastreams/rest/RestGetDataStreamsAction.java b/modules/data-streams/src/main/java/org/elasticsearch/datastreams/rest/RestGetDataStreamsAction.java\nindex b61e38297397..3456f4b67947 100644\n--- a/modules/data-streams/src/main/java/org/elasticsearch/datastreams/rest/RestGetDataStreamsAction.java\n+++ b/modules/data-streams/src/main/java/org/elasticsearch/datastreams/rest/RestGetDataStreamsAction.java\n@@ -43,7 +43,7 @@ public class RestGetDataStreamsAction extends BaseRestHandler {\n                 IndicesOptions.GatekeeperOptions.IGNORE_THROTTLED,\n                 \"verbose\"\n             ),\n-            DataStream.isFailureStoreFeatureFlagEnabled() ? Set.of(IndicesOptions.FAILURE_STORE_QUERY_PARAM) : Set.of()\n+            DataStream.isFailureStoreFeatureFlagEnabled() ? Set.of(IndicesOptions.FailureStoreOptions.FAILURE_STORE) : Set.of()\n         )\n     );\n \ndiff --git a/modules/data-streams/src/test/java/org/elasticsearch/datastreams/lifecycle/DataStreamLifecycleServiceTests.java b/modules/data-streams/src/test/java/org/elasticsearch/datastreams/lifecycle/DataStreamLifecycleServiceTests.java\nindex d6bf80798764..0d5ce54c44b5 100644\n--- a/modules/data-streams/src/test/java/org/elasticsearch/datastreams/lifecycle/DataStreamLifecycleServiceTests.java\n+++ b/modules/data-streams/src/test/java/org/elasticsearch/datastreams/lifecycle/DataStreamLifecycleServiceTests.java\n@@ -225,11 +225,17 @@ public class DataStreamLifecycleServiceTests extends ESTestCase {\n         assertThat(clientSeenRequests.get(0), instanceOf(RolloverRequest.class));\n         RolloverRequest rolloverBackingIndexRequest = (RolloverRequest) clientSeenRequests.get(0);\n         assertThat(rolloverBackingIndexRequest.getRolloverTarget(), is(dataStreamName));\n-        assertThat(rolloverBackingIndexRequest.indicesOptions().selectorOptions(), equalTo(IndicesOptions.SelectorOptions.ONLY_DATA));\n+        assertThat(\n+            rolloverBackingIndexRequest.indicesOptions().failureStoreOptions(),\n+            equalTo(new IndicesOptions.FailureStoreOptions(true, false))\n+        );\n         assertThat(clientSeenRequests.get(1), instanceOf(RolloverRequest.class));\n         RolloverRequest rolloverFailureIndexRequest = (RolloverRequest) clientSeenRequests.get(1);\n         assertThat(rolloverFailureIndexRequest.getRolloverTarget(), is(dataStreamName));\n-        assertThat(rolloverFailureIndexRequest.indicesOptions().selectorOptions(), equalTo(IndicesOptions.SelectorOptions.ONLY_FAILURES));\n+        assertThat(\n+            rolloverFailureIndexRequest.indicesOptions().failureStoreOptions(),\n+            equalTo(new IndicesOptions.FailureStoreOptions(false, true))\n+        );\n         List<DeleteIndexRequest> deleteRequests = clientSeenRequests.subList(2, 5)\n             .stream()\n             .map(transportRequest -> (DeleteIndexRequest) transportRequest)\n@@ -1546,11 +1552,17 @@ public class DataStreamLifecycleServiceTests extends ESTestCase {\n         assertThat(clientSeenRequests.get(0), instanceOf(RolloverRequest.class));\n         RolloverRequest rolloverBackingIndexRequest = (RolloverRequest) clientSeenRequests.get(0);\n         assertThat(rolloverBackingIndexRequest.getRolloverTarget(), is(dataStreamName));\n-        assertThat(rolloverBackingIndexRequest.indicesOptions().selectorOptions(), equalTo(IndicesOptions.SelectorOptions.ONLY_DATA));\n+        assertThat(\n+            rolloverBackingIndexRequest.indicesOptions().failureStoreOptions(),\n+            equalTo(new IndicesOptions.FailureStoreOptions(true, false))\n+        );\n         assertThat(clientSeenRequests.get(1), instanceOf(RolloverRequest.class));\n         RolloverRequest rolloverFailureIndexRequest = (RolloverRequest) clientSeenRequests.get(1);\n         assertThat(rolloverFailureIndexRequest.getRolloverTarget(), is(dataStreamName));\n-        assertThat(rolloverFailureIndexRequest.indicesOptions().selectorOptions(), equalTo(IndicesOptions.SelectorOptions.ONLY_FAILURES));\n+        assertThat(\n+            rolloverFailureIndexRequest.indicesOptions().failureStoreOptions(),\n+            equalTo(new IndicesOptions.FailureStoreOptions(false, true))\n+        );\n         assertThat(\n             ((DeleteIndexRequest) clientSeenRequests.get(2)).indices()[0],\n             is(dataStream.getFailureIndices().getIndices().get(0).getName())\ndiff --git a/server/src/main/java/org/elasticsearch/TransportVersions.java b/server/src/main/java/org/elasticsearch/TransportVersions.java\nindex f89c5a65693f..4038d5a22485 100644\n--- a/server/src/main/java/org/elasticsearch/TransportVersions.java\n+++ b/server/src/main/java/org/elasticsearch/TransportVersions.java\n@@ -245,7 +245,6 @@ public class TransportVersions {\n     public static final TransportVersion QUERY_RULE_TEST_API = def(8_769_00_0);\n     public static final TransportVersion ESQL_PER_AGGREGATE_FILTER = def(8_770_00_0);\n     public static final TransportVersion ML_INFERENCE_ATTACH_TO_EXISTSING_DEPLOYMENT = def(8_771_00_0);\n-    public static final TransportVersion CONVERT_FAILURE_STORE_OPTIONS_TO_SELECTOR_OPTIONS_INTERNALLY = def(8_772_00_0);\n \n     /*\n      * STOP! READ THIS FIRST! No, really,\ndiff --git a/server/src/main/java/org/elasticsearch/action/admin/indices/get/GetIndexRequest.java b/server/src/main/java/org/elasticsearch/action/admin/indices/get/GetIndexRequest.java\nindex 4c5ee08beb19..7ff7066a15fc 100644\n--- a/server/src/main/java/org/elasticsearch/action/admin/indices/get/GetIndexRequest.java\n+++ b/server/src/main/java/org/elasticsearch/action/admin/indices/get/GetIndexRequest.java\n@@ -98,7 +98,9 @@ public class GetIndexRequest extends ClusterInfoRequest<GetIndexRequest> {\n         super(\n             DataStream.isFailureStoreFeatureFlagEnabled()\n                 ? IndicesOptions.builder(IndicesOptions.strictExpandOpen())\n-                    .selectorOptions(IndicesOptions.SelectorOptions.DATA_AND_FAILURE)\n+                    .failureStoreOptions(\n+                        IndicesOptions.FailureStoreOptions.builder().includeRegularIndices(true).includeFailureIndices(true)\n+                    )\n                     .build()\n                 : IndicesOptions.strictExpandOpen()\n         );\ndiff --git a/server/src/main/java/org/elasticsearch/action/admin/indices/rollover/RolloverRequest.java b/server/src/main/java/org/elasticsearch/action/admin/indices/rollover/RolloverRequest.java\nindex fefc41317591..1ef9194b5120 100644\n--- a/server/src/main/java/org/elasticsearch/action/admin/indices/rollover/RolloverRequest.java\n+++ b/server/src/main/java/org/elasticsearch/action/admin/indices/rollover/RolloverRequest.java\n@@ -138,8 +138,8 @@ public class RolloverRequest extends AcknowledgedRequest<RolloverRequest> implem\n             );\n         }\n \n-        var selectors = indicesOptions.selectorOptions().defaultSelectors();\n-        if (selectors.size() > 1) {\n+        var failureStoreOptions = indicesOptions.failureStoreOptions();\n+        if (failureStoreOptions.includeRegularIndices() && failureStoreOptions.includeFailureIndices()) {\n             validationException = addValidationError(\n                 \"rollover cannot be applied to both regular and failure indices at the same time\",\n                 validationException\n@@ -179,7 +179,7 @@ public class RolloverRequest extends AcknowledgedRequest<RolloverRequest> implem\n      * @return true of the rollover request targets the failure store, false otherwise.\n      */\n     public boolean targetsFailureStore() {\n-        return DataStream.isFailureStoreFeatureFlagEnabled() && indicesOptions.includeFailureIndices();\n+        return DataStream.isFailureStoreFeatureFlagEnabled() && indicesOptions.failureStoreOptions().includeFailureIndices();\n     }\n \n     public void setIndicesOptions(IndicesOptions indicesOptions) {\ndiff --git a/server/src/main/java/org/elasticsearch/action/admin/indices/rollover/TransportRolloverAction.java b/server/src/main/java/org/elasticsearch/action/admin/indices/rollover/TransportRolloverAction.java\nindex c5c874f9bcdd..d65a66dcc47f 100644\n--- a/server/src/main/java/org/elasticsearch/action/admin/indices/rollover/TransportRolloverAction.java\n+++ b/server/src/main/java/org/elasticsearch/action/admin/indices/rollover/TransportRolloverAction.java\n@@ -150,7 +150,7 @@ public class TransportRolloverAction extends TransportMasterNodeAction<RolloverR\n                 .matchClosed(request.indicesOptions().expandWildcardsClosed())\n                 .build(),\n             IndicesOptions.GatekeeperOptions.DEFAULT,\n-            request.indicesOptions().selectorOptions()\n+            request.indicesOptions().failureStoreOptions()\n         );\n \n         return state.blocks()\n@@ -247,7 +247,7 @@ public class TransportRolloverAction extends TransportMasterNodeAction<RolloverR\n             IndicesOptions.ConcreteTargetOptions.ALLOW_UNAVAILABLE_TARGETS,\n             IndicesOptions.WildcardOptions.builder().matchClosed(true).allowEmptyExpressions(false).build(),\n             IndicesOptions.GatekeeperOptions.DEFAULT,\n-            rolloverRequest.indicesOptions().selectorOptions()\n+            rolloverRequest.indicesOptions().failureStoreOptions()\n         );\n         IndicesStatsRequest statsRequest = new IndicesStatsRequest().indices(rolloverRequest.getRolloverTarget())\n             .clear()\ndiff --git a/server/src/main/java/org/elasticsearch/action/bulk/BulkOperation.java b/server/src/main/java/org/elasticsearch/action/bulk/BulkOperation.java\nindex 007f274d7f49..f04d07fb690c 100644\n--- a/server/src/main/java/org/elasticsearch/action/bulk/BulkOperation.java\n+++ b/server/src/main/java/org/elasticsearch/action/bulk/BulkOperation.java\n@@ -212,7 +212,7 @@ final class BulkOperation extends ActionRunnable<BulkResponse> {\n                 RolloverRequest rolloverRequest = new RolloverRequest(dataStream, null);\n                 rolloverRequest.setIndicesOptions(\n                     IndicesOptions.builder(rolloverRequest.indicesOptions())\n-                        .selectorOptions(IndicesOptions.SelectorOptions.ONLY_FAILURES)\n+                        .failureStoreOptions(new IndicesOptions.FailureStoreOptions(false, true))\n                         .build()\n                 );\n                 // We are executing a lazy rollover because it is an action specialised for this situation, when we want an\ndiff --git a/server/src/main/java/org/elasticsearch/action/bulk/TransportBulkAction.java b/server/src/main/java/org/elasticsearch/action/bulk/TransportBulkAction.java\nindex a3a73415ec4f..61adf41a9a27 100644\n--- a/server/src/main/java/org/elasticsearch/action/bulk/TransportBulkAction.java\n+++ b/server/src/main/java/org/elasticsearch/action/bulk/TransportBulkAction.java\n@@ -418,7 +418,7 @@ public class TransportBulkAction extends TransportAbstractBulkAction {\n             if (targetFailureStore) {\n                 rolloverRequest.setIndicesOptions(\n                     IndicesOptions.builder(rolloverRequest.indicesOptions())\n-                        .selectorOptions(IndicesOptions.SelectorOptions.ONLY_FAILURES)\n+                        .failureStoreOptions(new IndicesOptions.FailureStoreOptions(false, true))\n                         .build()\n                 );\n             }\ndiff --git a/server/src/main/java/org/elasticsearch/action/datastreams/DataStreamsStatsAction.java b/server/src/main/java/org/elasticsearch/action/datastreams/DataStreamsStatsAction.java\nindex 1c30303915c8..fbb084e8cd12 100644\n--- a/server/src/main/java/org/elasticsearch/action/datastreams/DataStreamsStatsAction.java\n+++ b/server/src/main/java/org/elasticsearch/action/datastreams/DataStreamsStatsAction.java\n@@ -61,7 +61,9 @@ public class DataStreamsStatsAction extends ActionType<DataStreamsStatsAction.Re\n                             .allowFailureIndices(true)\n                             .build()\n                     )\n-                    .selectorOptions(IndicesOptions.SelectorOptions.DATA_AND_FAILURE)\n+                    .failureStoreOptions(\n+                        IndicesOptions.FailureStoreOptions.builder().includeRegularIndices(true).includeFailureIndices(true).build()\n+                    )\n                     .build()\n             );\n         }\ndiff --git a/server/src/main/java/org/elasticsearch/action/support/IndexComponentSelector.java b/server/src/main/java/org/elasticsearch/action/support/IndexComponentSelector.java\ndeleted file mode 100644\nindex 65b48db8f5cf..000000000000\n--- a/server/src/main/java/org/elasticsearch/action/support/IndexComponentSelector.java\n+++ /dev/null\n@@ -1,49 +0,0 @@\n-/*\n- * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\n- * or more contributor license agreements. Licensed under the \"Elastic License\n- * 2.0\", the \"GNU Affero General Public License v3.0 only\", and the \"Server Side\n- * Public License v 1\"; you may not use this file except in compliance with, at\n- * your election, the \"Elastic License 2.0\", the \"GNU Affero General Public\n- * License v3.0 only\", or the \"Server Side Public License, v 1\".\n- */\n-\n-package org.elasticsearch.action.support;\n-\n-import java.util.Collections;\n-import java.util.HashMap;\n-import java.util.Map;\n-\n-/**\n- * We define as index components the two different sets of indices a data stream could consist of:\n- * - DATA: represents the backing indices\n- * - FAILURES: represent the failing indices\n- * Note: An index is its own DATA component, but it cannot have a FAILURE component.\n- */\n-public enum IndexComponentSelector {\n-    DATA(\"data\"),\n-    FAILURES(\"failures\");\n-\n-    private final String key;\n-\n-    IndexComponentSelector(String key) {\n-        this.key = key;\n-    }\n-\n-    public String getKey() {\n-        return key;\n-    }\n-\n-    private static final Map<String, IndexComponentSelector> REGISTRY;\n-\n-    static {\n-        Map<String, IndexComponentSelector> registry = new HashMap<>(IndexComponentSelector.values().length);\n-        for (IndexComponentSelector value : IndexComponentSelector.values()) {\n-            registry.put(value.getKey(), value);\n-        }\n-        REGISTRY = Collections.unmodifiableMap(registry);\n-    }\n-\n-    public static IndexComponentSelector getByKey(String key) {\n-        return REGISTRY.get(key);\n-    }\n-}\ndiff --git a/server/src/main/java/org/elasticsearch/action/support/IndicesOptions.java b/server/src/main/java/org/elasticsearch/action/support/IndicesOptions.java\nindex 22d019f80837..d3ea06324770 100644\n--- a/server/src/main/java/org/elasticsearch/action/support/IndicesOptions.java\n+++ b/server/src/main/java/org/elasticsearch/action/support/IndicesOptions.java\n@@ -31,6 +31,7 @@ import java.util.EnumSet;\n import java.util.List;\n import java.util.Locale;\n import java.util.Map;\n+import java.util.function.Consumer;\n import java.util.stream.Collectors;\n \n import static org.elasticsearch.common.xcontent.support.XContentMapValues.nodeBooleanValue;\n@@ -47,36 +48,24 @@ import static org.elasticsearch.common.xcontent.support.XContentMapValues.nodeSt\n  * @param gatekeeperOptions, applies to all the resolved indices and defines if throttled will be included and if certain type of\n  *                        aliases or indices are allowed, or they will throw an error. It acts as a gatekeeper when an action\n  *                        does not support certain options.\n- * @param selectorOptions, applies to all resolved expressions, and it specifies the index component that should be included, if there\n- *                         is no index component defined on the expression level.\n+ * @param failureStoreOptions, applies to all indices already matched and controls the type of indices that will be returned. Currently,\n+ *                             there are two types, data stream failure indices (only certain data streams have them) and data stream\n+ *                             backing indices or stand-alone indices.\n  */\n public record IndicesOptions(\n     ConcreteTargetOptions concreteTargetOptions,\n     WildcardOptions wildcardOptions,\n     GatekeeperOptions gatekeeperOptions,\n-    SelectorOptions selectorOptions\n+    FailureStoreOptions failureStoreOptions\n ) implements ToXContentFragment {\n \n-    /**\n-     * @deprecated this query param will be replaced by the selector `::` on the expression level\n-     */\n-    @Deprecated\n-    public static final String FAILURE_STORE_QUERY_PARAM = \"failure_store\";\n-    /**\n-     * @deprecated this value will be replaced by the selector `::*` on the expression level\n-     */\n-    @Deprecated\n-    public static final String INCLUDE_ALL = \"include\";\n-    /**\n-     * @deprecated this value will be replaced by the selector `::data` on the expression level\n-     */\n-    @Deprecated\n-    public static final String INCLUDE_ONLY_REGULAR_INDICES = \"exclude\";\n-    /**\n-     * @deprecated this value will be replaced by the selector `::failures` on the expression level\n-     */\n-    @Deprecated\n-    public static final String INCLUDE_ONLY_FAILURE_INDICES = \"only\";\n+    public IndicesOptions(\n+        ConcreteTargetOptions concreteTargetOptions,\n+        WildcardOptions wildcardOptions,\n+        GatekeeperOptions gatekeeperOptions\n+    ) {\n+        this(concreteTargetOptions, wildcardOptions, gatekeeperOptions, FailureStoreOptions.DEFAULT);\n+    }\n \n     public static IndicesOptions.Builder builder() {\n         return new Builder();\n@@ -321,7 +310,7 @@ public record IndicesOptions(\n      * - The \"allow*\" flags, which purpose is to enable actions to define certain conditions that need to apply on the concrete indices\n      * they accept. For example, single-index actions will set allowAliasToMultipleIndices to false, while search will not accept a\n      * closed index etc. These options are not configurable by the end-user.\n-     * - The ignoreThrottled flag, which is a deprecated flag that will filter out frozen indices.\n+     * - The ignoreThrottled flag, which is a depricared flag that will filter out frozen indices.\n      * @param allowAliasToMultipleIndices, allow aliases to multiple indices, true by default.\n      * @param allowClosedIndices, allow closed indices, true by default.\n      * @param allowFailureIndices, allow failure indices in the response, true by default\n@@ -419,53 +408,87 @@ public record IndicesOptions(\n     }\n \n     /**\n-     * Defines which selectors should be used by default for an index operation in the event that no selectors are provided.\n+     * Applies to all indices already matched and controls the type of indices that will be returned. There are two types, data stream\n+     * failure indices (only certain data streams have them) and data stream backing indices or stand-alone indices.\n+     * @param includeRegularIndices, when true regular or data stream backing indices will be retrieved.\n+     * @param includeFailureIndices, when true data stream failure indices will be included.\n      */\n-    public record SelectorOptions(EnumSet<IndexComponentSelector> defaultSelectors) implements Writeable {\n+    public record FailureStoreOptions(boolean includeRegularIndices, boolean includeFailureIndices)\n+        implements\n+            Writeable,\n+            ToXContentFragment {\n \n-        public static final SelectorOptions DATA_AND_FAILURE = new SelectorOptions(\n-            EnumSet.of(IndexComponentSelector.DATA, IndexComponentSelector.FAILURES)\n-        );\n-        public static final SelectorOptions ONLY_DATA = new SelectorOptions(EnumSet.of(IndexComponentSelector.DATA));\n-        public static final SelectorOptions ONLY_FAILURES = new SelectorOptions(EnumSet.of(IndexComponentSelector.FAILURES));\n-        /**\n-         * Default instance. Uses <pre>::data</pre> as the default selector if none are present in an index expression.\n-         */\n-        public static final SelectorOptions DEFAULT = ONLY_DATA;\n+        public static final String FAILURE_STORE = \"failure_store\";\n+        public static final String INCLUDE_ALL = \"include\";\n+        public static final String INCLUDE_ONLY_REGULAR_INDICES = \"exclude\";\n+        public static final String INCLUDE_ONLY_FAILURE_INDICES = \"only\";\n+\n+        public static final FailureStoreOptions DEFAULT = new FailureStoreOptions(true, false);\n+\n+        public static FailureStoreOptions read(StreamInput in) throws IOException {\n+            return new FailureStoreOptions(in.readBoolean(), in.readBoolean());\n+        }\n+\n+        public static FailureStoreOptions parseParameters(Object failureStoreValue, FailureStoreOptions defaultOptions) {\n+            if (failureStoreValue == null) {\n+                return defaultOptions;\n+            }\n+            FailureStoreOptions.Builder builder = defaultOptions == null\n+                ? new FailureStoreOptions.Builder()\n+                : new FailureStoreOptions.Builder(defaultOptions);\n+            return switch (failureStoreValue.toString()) {\n+                case INCLUDE_ALL -> builder.includeRegularIndices(true).includeFailureIndices(true).build();\n+                case INCLUDE_ONLY_REGULAR_INDICES -> builder.includeRegularIndices(true).includeFailureIndices(false).build();\n+                case INCLUDE_ONLY_FAILURE_INDICES -> builder.includeRegularIndices(false).includeFailureIndices(true).build();\n+                default -> throw new IllegalArgumentException(\"No valid \" + FAILURE_STORE + \" value [\" + failureStoreValue + \"]\");\n+            };\n+        }\n \n-        public static SelectorOptions read(StreamInput in) throws IOException {\n-            return new SelectorOptions(in.readEnumSet(IndexComponentSelector.class));\n+        @Override\n+        public XContentBuilder toXContent(XContentBuilder builder, Params params) throws IOException {\n+            return builder.field(FAILURE_STORE, displayValue());\n+        }\n+\n+        public String displayValue() {\n+            if (includeRegularIndices && includeFailureIndices) {\n+                return INCLUDE_ALL;\n+            } else if (includeRegularIndices) {\n+                return INCLUDE_ONLY_REGULAR_INDICES;\n+            }\n+            return INCLUDE_ONLY_FAILURE_INDICES;\n         }\n \n         @Override\n         public void writeTo(StreamOutput out) throws IOException {\n-            out.writeEnumSet(defaultSelectors);\n+            out.writeBoolean(includeRegularIndices);\n+            out.writeBoolean(includeFailureIndices);\n         }\n \n         public static class Builder {\n-            private EnumSet<IndexComponentSelector> defaultSelectors;\n+            private boolean includeRegularIndices;\n+            private boolean includeFailureIndices;\n \n             public Builder() {\n                 this(DEFAULT);\n             }\n \n-            Builder(SelectorOptions options) {\n-                defaultSelectors = EnumSet.copyOf(options.defaultSelectors);\n+            Builder(FailureStoreOptions options) {\n+                includeRegularIndices = options.includeRegularIndices;\n+                includeFailureIndices = options.includeFailureIndices;\n             }\n \n-            public Builder setDefaultSelectors(IndexComponentSelector first, IndexComponentSelector... remaining) {\n-                defaultSelectors = EnumSet.of(first, remaining);\n+            public Builder includeRegularIndices(boolean includeRegularIndices) {\n+                this.includeRegularIndices = includeRegularIndices;\n                 return this;\n             }\n \n-            public Builder setDefaultSelectors(EnumSet<IndexComponentSelector> defaultSelectors) {\n-                this.defaultSelectors = EnumSet.copyOf(defaultSelectors);\n+            public Builder includeFailureIndices(boolean includeFailureIndices) {\n+                this.includeFailureIndices = includeFailureIndices;\n                 return this;\n             }\n \n-            public SelectorOptions build() {\n-                assert defaultSelectors.isEmpty() != true : \"Default selectors cannot be an empty set\";\n-                return new SelectorOptions(EnumSet.copyOf(defaultSelectors));\n+            public FailureStoreOptions build() {\n+                return new FailureStoreOptions(includeRegularIndices, includeFailureIndices);\n             }\n         }\n \n@@ -473,8 +496,8 @@ public record IndicesOptions(\n             return new Builder();\n         }\n \n-        public static Builder builder(SelectorOptions selectorOptions) {\n-            return new Builder(selectorOptions);\n+        public static Builder builder(FailureStoreOptions failureStoreOptions) {\n+            return new Builder(failureStoreOptions);\n         }\n     }\n \n@@ -527,7 +550,7 @@ public record IndicesOptions(\n         ConcreteTargetOptions.ERROR_WHEN_UNAVAILABLE_TARGETS,\n         WildcardOptions.DEFAULT,\n         GatekeeperOptions.DEFAULT,\n-        SelectorOptions.DEFAULT\n+        FailureStoreOptions.DEFAULT\n     );\n \n     public static final IndicesOptions STRICT_EXPAND_OPEN = IndicesOptions.builder()\n@@ -547,7 +570,7 @@ public record IndicesOptions(\n                 .allowFailureIndices(true)\n                 .ignoreThrottled(false)\n         )\n-        .selectorOptions(SelectorOptions.ONLY_DATA)\n+        .failureStoreOptions(FailureStoreOptions.builder().includeRegularIndices(true).includeFailureIndices(false))\n         .build();\n     public static final IndicesOptions STRICT_EXPAND_OPEN_FAILURE_STORE = IndicesOptions.builder()\n         .concreteTargetOptions(ConcreteTargetOptions.ERROR_WHEN_UNAVAILABLE_TARGETS)\n@@ -566,7 +589,7 @@ public record IndicesOptions(\n                 .allowFailureIndices(true)\n                 .ignoreThrottled(false)\n         )\n-        .selectorOptions(SelectorOptions.DATA_AND_FAILURE)\n+        .failureStoreOptions(FailureStoreOptions.builder().includeRegularIndices(true).includeFailureIndices(true))\n         .build();\n     public static final IndicesOptions LENIENT_EXPAND_OPEN = IndicesOptions.builder()\n         .concreteTargetOptions(ConcreteTargetOptions.ALLOW_UNAVAILABLE_TARGETS)\n@@ -585,25 +608,7 @@ public record IndicesOptions(\n                 .allowFailureIndices(true)\n                 .ignoreThrottled(false)\n         )\n-        .selectorOptions(SelectorOptions.ONLY_DATA)\n-        .build();\n-    public static final IndicesOptions LENIENT_EXPAND_OPEN_NO_SELECTORS = IndicesOptions.builder()\n-        .concreteTargetOptions(ConcreteTargetOptions.ALLOW_UNAVAILABLE_TARGETS)\n-        .wildcardOptions(\n-            WildcardOptions.builder()\n-                .matchOpen(true)\n-                .matchClosed(false)\n-                .includeHidden(false)\n-                .allowEmptyExpressions(true)\n-                .resolveAliases(true)\n-        )\n-        .gatekeeperOptions(\n-            GatekeeperOptions.builder()\n-                .allowAliasToMultipleIndices(true)\n-                .allowClosedIndices(true)\n-                .allowFailureIndices(false)\n-                .ignoreThrottled(false)\n-        )\n+        .failureStoreOptions(FailureStoreOptions.builder().includeRegularIndices(true).includeFailureIndices(false))\n         .build();\n     public static final IndicesOptions LENIENT_EXPAND_OPEN_HIDDEN = IndicesOptions.builder()\n         .concreteTargetOptions(ConcreteTargetOptions.ALLOW_UNAVAILABLE_TARGETS)\n@@ -622,7 +627,7 @@ public record IndicesOptions(\n                 .allowFailureIndices(true)\n                 .ignoreThrottled(false)\n         )\n-        .selectorOptions(SelectorOptions.ONLY_DATA)\n+        .failureStoreOptions(FailureStoreOptions.builder().includeRegularIndices(true).includeFailureIndices(false))\n         .build();\n     public static final IndicesOptions LENIENT_EXPAND_OPEN_CLOSED = IndicesOptions.builder()\n         .concreteTargetOptions(ConcreteTargetOptions.ALLOW_UNAVAILABLE_TARGETS)\n@@ -641,7 +646,7 @@ public record IndicesOptions(\n                 .allowFailureIndices(true)\n                 .ignoreThrottled(false)\n         )\n-        .selectorOptions(SelectorOptions.ONLY_DATA)\n+        .failureStoreOptions(FailureStoreOptions.builder().includeRegularIndices(true).includeFailureIndices(false))\n         .build();\n     public static final IndicesOptions LENIENT_EXPAND_OPEN_CLOSED_HIDDEN = IndicesOptions.builder()\n         .concreteTargetOptions(ConcreteTargetOptions.ALLOW_UNAVAILABLE_TARGETS)\n@@ -655,20 +660,7 @@ public record IndicesOptions(\n                 .allowFailureIndices(true)\n                 .ignoreThrottled(false)\n         )\n-        .selectorOptions(SelectorOptions.ONLY_DATA)\n-        .build();\n-    public static final IndicesOptions LENIENT_EXPAND_OPEN_CLOSED_HIDDEN_NO_SELECTOR = IndicesOptions.builder()\n-        .concreteTargetOptions(ConcreteTargetOptions.ALLOW_UNAVAILABLE_TARGETS)\n-        .wildcardOptions(\n-            WildcardOptions.builder().matchOpen(true).matchClosed(true).includeHidden(true).allowEmptyExpressions(true).resolveAliases(true)\n-        )\n-        .gatekeeperOptions(\n-            GatekeeperOptions.builder()\n-                .allowAliasToMultipleIndices(true)\n-                .allowClosedIndices(true)\n-                .allowFailureIndices(false)\n-                .ignoreThrottled(false)\n-        )\n+        .failureStoreOptions(FailureStoreOptions.builder().includeRegularIndices(true).includeFailureIndices(false))\n         .build();\n     public static final IndicesOptions STRICT_EXPAND_OPEN_CLOSED = IndicesOptions.builder()\n         .concreteTargetOptions(ConcreteTargetOptions.ERROR_WHEN_UNAVAILABLE_TARGETS)\n@@ -687,7 +679,7 @@ public record IndicesOptions(\n                 .allowFailureIndices(true)\n                 .ignoreThrottled(false)\n         )\n-        .selectorOptions(SelectorOptions.ONLY_DATA)\n+        .failureStoreOptions(FailureStoreOptions.builder().includeRegularIndices(true).includeFailureIndices(false))\n         .build();\n     public static final IndicesOptions STRICT_EXPAND_OPEN_CLOSED_HIDDEN = IndicesOptions.builder()\n         .concreteTargetOptions(ConcreteTargetOptions.ERROR_WHEN_UNAVAILABLE_TARGETS)\n@@ -701,20 +693,7 @@ public record IndicesOptions(\n                 .allowFailureIndices(true)\n                 .ignoreThrottled(false)\n         )\n-        .selectorOptions(SelectorOptions.ONLY_DATA)\n-        .build();\n-    public static final IndicesOptions STRICT_EXPAND_OPEN_CLOSED_HIDDEN_NO_SELECTORS = IndicesOptions.builder()\n-        .concreteTargetOptions(ConcreteTargetOptions.ERROR_WHEN_UNAVAILABLE_TARGETS)\n-        .wildcardOptions(\n-            WildcardOptions.builder().matchOpen(true).matchClosed(true).includeHidden(true).allowEmptyExpressions(true).resolveAliases(true)\n-        )\n-        .gatekeeperOptions(\n-            GatekeeperOptions.builder()\n-                .allowAliasToMultipleIndices(true)\n-                .allowClosedIndices(true)\n-                .allowFailureIndices(false)\n-                .ignoreThrottled(false)\n-        )\n+        .failureStoreOptions(FailureStoreOptions.builder().includeRegularIndices(true).includeFailureIndices(false))\n         .build();\n     public static final IndicesOptions LENIENT_EXPAND_OPEN_CLOSED_FAILURE_STORE = IndicesOptions.builder()\n         .concreteTargetOptions(ConcreteTargetOptions.ALLOW_UNAVAILABLE_TARGETS)\n@@ -733,7 +712,7 @@ public record IndicesOptions(\n                 .allowFailureIndices(true)\n                 .ignoreThrottled(false)\n         )\n-        .selectorOptions(SelectorOptions.DATA_AND_FAILURE)\n+        .failureStoreOptions(FailureStoreOptions.builder().includeRegularIndices(true).includeFailureIndices(true))\n         .build();\n     public static final IndicesOptions STRICT_EXPAND_OPEN_CLOSED_HIDDEN_FAILURE_STORE = IndicesOptions.builder()\n         .concreteTargetOptions(ConcreteTargetOptions.ERROR_WHEN_UNAVAILABLE_TARGETS)\n@@ -747,7 +726,7 @@ public record IndicesOptions(\n                 .allowFailureIndices(true)\n                 .ignoreThrottled(false)\n         )\n-        .selectorOptions(SelectorOptions.DATA_AND_FAILURE)\n+        .failureStoreOptions(FailureStoreOptions.builder().includeRegularIndices(true).includeFailureIndices(true))\n         .build();\n     public static final IndicesOptions STRICT_EXPAND_OPEN_CLOSED_FAILURE_STORE = IndicesOptions.builder()\n         .concreteTargetOptions(ConcreteTargetOptions.ERROR_WHEN_UNAVAILABLE_TARGETS)\n@@ -766,7 +745,7 @@ public record IndicesOptions(\n                 .allowFailureIndices(true)\n                 .ignoreThrottled(false)\n         )\n-        .selectorOptions(SelectorOptions.DATA_AND_FAILURE)\n+        .failureStoreOptions(FailureStoreOptions.builder().includeRegularIndices(true).includeFailureIndices(true))\n         .build();\n     public static final IndicesOptions STRICT_EXPAND_OPEN_FORBID_CLOSED = IndicesOptions.builder()\n         .concreteTargetOptions(ConcreteTargetOptions.ERROR_WHEN_UNAVAILABLE_TARGETS)\n@@ -785,7 +764,7 @@ public record IndicesOptions(\n                 .allowFailureIndices(true)\n                 .ignoreThrottled(false)\n         )\n-        .selectorOptions(SelectorOptions.ONLY_DATA)\n+        .failureStoreOptions(FailureStoreOptions.builder().includeRegularIndices(true).includeFailureIndices(false))\n         .build();\n     public static final IndicesOptions STRICT_EXPAND_OPEN_HIDDEN_FORBID_CLOSED = IndicesOptions.builder()\n         .concreteTargetOptions(ConcreteTargetOptions.ERROR_WHEN_UNAVAILABLE_TARGETS)\n@@ -804,7 +783,7 @@ public record IndicesOptions(\n                 .allowFailureIndices(true)\n                 .ignoreThrottled(false)\n         )\n-        .selectorOptions(SelectorOptions.ONLY_DATA)\n+        .failureStoreOptions(FailureStoreOptions.builder().includeRegularIndices(true).includeFailureIndices(false))\n         .build();\n     public static final IndicesOptions STRICT_EXPAND_OPEN_FORBID_CLOSED_IGNORE_THROTTLED = IndicesOptions.builder()\n         .concreteTargetOptions(ConcreteTargetOptions.ERROR_WHEN_UNAVAILABLE_TARGETS)\n@@ -823,7 +802,7 @@ public record IndicesOptions(\n                 .allowFailureIndices(true)\n                 .allowAliasToMultipleIndices(true)\n         )\n-        .selectorOptions(SelectorOptions.ONLY_DATA)\n+        .failureStoreOptions(FailureStoreOptions.builder().includeRegularIndices(true).includeFailureIndices(false))\n         .build();\n     public static final IndicesOptions STRICT_SINGLE_INDEX_NO_EXPAND_FORBID_CLOSED = IndicesOptions.builder()\n         .concreteTargetOptions(ConcreteTargetOptions.ERROR_WHEN_UNAVAILABLE_TARGETS)\n@@ -842,7 +821,7 @@ public record IndicesOptions(\n                 .allowFailureIndices(true)\n                 .ignoreThrottled(false)\n         )\n-        .selectorOptions(SelectorOptions.ONLY_DATA)\n+        .failureStoreOptions(FailureStoreOptions.builder().includeRegularIndices(true).includeFailureIndices(false))\n         .build();\n     public static final IndicesOptions STRICT_NO_EXPAND_FORBID_CLOSED = IndicesOptions.builder()\n         .concreteTargetOptions(ConcreteTargetOptions.ERROR_WHEN_UNAVAILABLE_TARGETS)\n@@ -861,7 +840,7 @@ public record IndicesOptions(\n                 .allowFailureIndices(true)\n                 .ignoreThrottled(false)\n         )\n-        .selectorOptions(SelectorOptions.ONLY_DATA)\n+        .failureStoreOptions(FailureStoreOptions.builder().includeRegularIndices(true).includeFailureIndices(false))\n         .build();\n \n     /**\n@@ -950,14 +929,14 @@ public record IndicesOptions(\n      * @return whether regular indices (stand-alone or backing indices) will be included in the response\n      */\n     public boolean includeRegularIndices() {\n-        return selectorOptions().defaultSelectors().contains(IndexComponentSelector.DATA);\n+        return failureStoreOptions().includeRegularIndices();\n     }\n \n     /**\n      * @return whether failure indices (only supported by certain data streams) will be included in the response\n      */\n     public boolean includeFailureIndices() {\n-        return selectorOptions().defaultSelectors().contains(IndexComponentSelector.FAILURES);\n+        return failureStoreOptions().includeFailureIndices();\n     }\n \n     public void writeIndicesOptions(StreamOutput out) throws IOException {\n@@ -998,13 +977,8 @@ public record IndicesOptions(\n             states.add(WildcardStates.HIDDEN);\n         }\n         out.writeEnumSet(states);\n-        if (out.getTransportVersion()\n-            .between(TransportVersions.V_8_14_0, TransportVersions.CONVERT_FAILURE_STORE_OPTIONS_TO_SELECTOR_OPTIONS_INTERNALLY)) {\n-            out.writeBoolean(includeRegularIndices());\n-            out.writeBoolean(includeFailureIndices());\n-        }\n-        if (out.getTransportVersion().onOrAfter(TransportVersions.CONVERT_FAILURE_STORE_OPTIONS_TO_SELECTOR_OPTIONS_INTERNALLY)) {\n-            out.writeEnumSet(selectorOptions.defaultSelectors);\n+        if (out.getTransportVersion().onOrAfter(TransportVersions.V_8_14_0)) {\n+            failureStoreOptions.writeTo(out);\n         }\n     }\n \n@@ -1025,30 +999,16 @@ public record IndicesOptions(\n             .allowFailureIndices(allowFailureIndices)\n             .ignoreThrottled(options.contains(Option.IGNORE_THROTTLED))\n             .build();\n-        SelectorOptions selectorOptions = SelectorOptions.DEFAULT;\n-        if (in.getTransportVersion()\n-            .between(TransportVersions.V_8_14_0, TransportVersions.CONVERT_FAILURE_STORE_OPTIONS_TO_SELECTOR_OPTIONS_INTERNALLY)) {\n-            // Reading from an older node, which will be sending two booleans that we must read out and ignore.\n-            var includeData = in.readBoolean();\n-            var includeFailures = in.readBoolean();\n-            if (includeData && includeFailures) {\n-                selectorOptions = SelectorOptions.DATA_AND_FAILURE;\n-            } else if (includeData) {\n-                selectorOptions = SelectorOptions.ONLY_DATA;\n-            } else {\n-                selectorOptions = SelectorOptions.ONLY_FAILURES;\n-            }\n-        }\n-        if (in.getTransportVersion().onOrAfter(TransportVersions.CONVERT_FAILURE_STORE_OPTIONS_TO_SELECTOR_OPTIONS_INTERNALLY)) {\n-            selectorOptions = new SelectorOptions(in.readEnumSet(IndexComponentSelector.class));\n-        }\n+        FailureStoreOptions failureStoreOptions = in.getTransportVersion().onOrAfter(TransportVersions.V_8_14_0)\n+            ? FailureStoreOptions.read(in)\n+            : FailureStoreOptions.DEFAULT;\n         return new IndicesOptions(\n             options.contains(Option.ALLOW_UNAVAILABLE_CONCRETE_TARGETS)\n                 ? ConcreteTargetOptions.ALLOW_UNAVAILABLE_TARGETS\n                 : ConcreteTargetOptions.ERROR_WHEN_UNAVAILABLE_TARGETS,\n             wildcardOptions,\n             gatekeeperOptions,\n-            selectorOptions\n+            failureStoreOptions\n         );\n     }\n \n@@ -1056,7 +1016,7 @@ public record IndicesOptions(\n         private ConcreteTargetOptions concreteTargetOptions;\n         private WildcardOptions wildcardOptions;\n         private GatekeeperOptions gatekeeperOptions;\n-        private SelectorOptions selectorOptions;\n+        private FailureStoreOptions failureStoreOptions;\n \n         Builder() {\n             this(DEFAULT);\n@@ -1066,7 +1026,7 @@ public record IndicesOptions(\n             concreteTargetOptions = indicesOptions.concreteTargetOptions;\n             wildcardOptions = indicesOptions.wildcardOptions;\n             gatekeeperOptions = indicesOptions.gatekeeperOptions;\n-            selectorOptions = indicesOptions.selectorOptions;\n+            failureStoreOptions = indicesOptions.failureStoreOptions;\n         }\n \n         public Builder concreteTargetOptions(ConcreteTargetOptions concreteTargetOptions) {\n@@ -1094,18 +1054,25 @@ public record IndicesOptions(\n             return this;\n         }\n \n-        public Builder selectorOptions(SelectorOptions selectorOptions) {\n-            this.selectorOptions = selectorOptions;\n+        public Builder failureStoreOptions(FailureStoreOptions failureStoreOptions) {\n+            this.failureStoreOptions = failureStoreOptions;\n             return this;\n         }\n \n-        public Builder selectorOptions(SelectorOptions.Builder selectorOptions) {\n-            this.selectorOptions = selectorOptions.build();\n+        public Builder failureStoreOptions(FailureStoreOptions.Builder failureStoreOptions) {\n+            this.failureStoreOptions = failureStoreOptions.build();\n+            return this;\n+        }\n+\n+        public Builder failureStoreOptions(Consumer<FailureStoreOptions.Builder> failureStoreOptionsConfig) {\n+            FailureStoreOptions.Builder failureStoreOptionsBuilder = FailureStoreOptions.builder(failureStoreOptions);\n+            failureStoreOptionsConfig.accept(failureStoreOptionsBuilder);\n+            this.failureStoreOptions = failureStoreOptionsBuilder.build();\n             return this;\n         }\n \n         public IndicesOptions build() {\n-            return new IndicesOptions(concreteTargetOptions, wildcardOptions, gatekeeperOptions, selectorOptions);\n+            return new IndicesOptions(concreteTargetOptions, wildcardOptions, gatekeeperOptions, failureStoreOptions);\n         }\n     }\n \n@@ -1204,12 +1171,11 @@ public record IndicesOptions(\n             .allowClosedIndices(forbidClosedIndices == false)\n             .ignoreThrottled(ignoreThrottled)\n             .build();\n-        final SelectorOptions selectorOptions = SelectorOptions.DEFAULT;\n         return new IndicesOptions(\n             ignoreUnavailable ? ConcreteTargetOptions.ALLOW_UNAVAILABLE_TARGETS : ConcreteTargetOptions.ERROR_WHEN_UNAVAILABLE_TARGETS,\n             wildcards,\n             gatekeeperOptions,\n-            selectorOptions\n+            FailureStoreOptions.DEFAULT\n         );\n     }\n \n@@ -1223,7 +1189,9 @@ public record IndicesOptions(\n             request.param(ConcreteTargetOptions.IGNORE_UNAVAILABLE),\n             request.param(WildcardOptions.ALLOW_NO_INDICES),\n             request.param(GatekeeperOptions.IGNORE_THROTTLED),\n-            DataStream.isFailureStoreFeatureFlagEnabled() ? request.param(FAILURE_STORE_QUERY_PARAM) : INCLUDE_ONLY_REGULAR_INDICES,\n+            DataStream.isFailureStoreFeatureFlagEnabled()\n+                ? request.param(FailureStoreOptions.FAILURE_STORE)\n+                : FailureStoreOptions.INCLUDE_ONLY_REGULAR_INDICES,\n             defaultSettings\n         );\n     }\n@@ -1239,7 +1207,7 @@ public record IndicesOptions(\n                 map.containsKey(GatekeeperOptions.IGNORE_THROTTLED)\n                     ? map.get(GatekeeperOptions.IGNORE_THROTTLED)\n                     : map.get(\"ignoreThrottled\"),\n-                map.containsKey(FAILURE_STORE_QUERY_PARAM) ? map.get(FAILURE_STORE_QUERY_PARAM) : map.get(\"failureStore\"),\n+                map.containsKey(FailureStoreOptions.FAILURE_STORE) ? map.get(FailureStoreOptions.FAILURE_STORE) : map.get(\"failureStore\"),\n                 defaultSettings\n             );\n         }\n@@ -1267,7 +1235,7 @@ public record IndicesOptions(\n             || \"ignoreThrottled\".equals(name)\n             || WildcardOptions.ALLOW_NO_INDICES.equals(name)\n             || \"allowNoIndices\".equals(name)\n-            || (DataStream.isFailureStoreFeatureFlagEnabled() && FAILURE_STORE_QUERY_PARAM.equals(name))\n+            || (DataStream.isFailureStoreFeatureFlagEnabled() && FailureStoreOptions.FAILURE_STORE.equals(name))\n             || (DataStream.isFailureStoreFeatureFlagEnabled() && \"failureStore\".equals(name));\n     }\n \n@@ -1299,51 +1267,26 @@ public record IndicesOptions(\n \n         WildcardOptions wildcards = WildcardOptions.parseParameters(wildcardsString, allowNoIndicesString, defaultSettings.wildcardOptions);\n         GatekeeperOptions gatekeeperOptions = GatekeeperOptions.parseParameter(ignoreThrottled, defaultSettings.gatekeeperOptions);\n-        SelectorOptions selectorOptions = DataStream.isFailureStoreFeatureFlagEnabled()\n-            ? parseFailureStoreParameters(failureStoreString, defaultSettings.selectorOptions)\n-            : SelectorOptions.DEFAULT;\n+        FailureStoreOptions failureStoreOptions = DataStream.isFailureStoreFeatureFlagEnabled()\n+            ? FailureStoreOptions.parseParameters(failureStoreString, defaultSettings.failureStoreOptions)\n+            : FailureStoreOptions.DEFAULT;\n \n         // note that allowAliasesToMultipleIndices is not exposed, always true (only for internal use)\n         return IndicesOptions.builder()\n             .concreteTargetOptions(ConcreteTargetOptions.fromParameter(ignoreUnavailableString, defaultSettings.concreteTargetOptions))\n             .wildcardOptions(wildcards)\n             .gatekeeperOptions(gatekeeperOptions)\n-            .selectorOptions(selectorOptions)\n+            .failureStoreOptions(failureStoreOptions)\n             .build();\n     }\n \n-    /**\n-     * @deprecated This method parses the query parameter failure_store. This is a deprecated param, and it will be replaced\n-     * the selector suffix, for example `my-data-stream::data` or `my-data-stream::failures`\n-     */\n-    @Deprecated\n-    private static SelectorOptions parseFailureStoreParameters(Object failureStoreValue, SelectorOptions defaultOptions) {\n-        if (failureStoreValue == null) {\n-            return defaultOptions;\n-        }\n-        return switch (failureStoreValue.toString()) {\n-            case INCLUDE_ALL -> SelectorOptions.DATA_AND_FAILURE;\n-            case INCLUDE_ONLY_REGULAR_INDICES -> SelectorOptions.ONLY_DATA;\n-            case INCLUDE_ONLY_FAILURE_INDICES -> SelectorOptions.ONLY_FAILURES;\n-            default -> throw new IllegalArgumentException(\"No valid \" + FAILURE_STORE_QUERY_PARAM + \" value [\" + failureStoreValue + \"]\");\n-        };\n-    }\n-\n     @Override\n     public XContentBuilder toXContent(XContentBuilder builder, ToXContent.Params params) throws IOException {\n         concreteTargetOptions.toXContent(builder, params);\n         wildcardOptions.toXContent(builder, params);\n         gatekeeperOptions.toXContent(builder, params);\n         if (DataStream.isFailureStoreFeatureFlagEnabled()) {\n-            String displayValue;\n-            if (SelectorOptions.DATA_AND_FAILURE.equals(selectorOptions())) {\n-                displayValue = INCLUDE_ALL;\n-            } else if (SelectorOptions.ONLY_DATA.equals(selectorOptions())) {\n-                displayValue = INCLUDE_ONLY_REGULAR_INDICES;\n-            } else {\n-                displayValue = INCLUDE_ONLY_FAILURE_INDICES;\n-            }\n-            builder.field(FAILURE_STORE_QUERY_PARAM, displayValue);\n+            failureStoreOptions.toXContent(builder, params);\n         }\n         return builder;\n     }\n@@ -1352,7 +1295,7 @@ public record IndicesOptions(\n     private static final ParseField IGNORE_UNAVAILABLE_FIELD = new ParseField(ConcreteTargetOptions.IGNORE_UNAVAILABLE);\n     private static final ParseField IGNORE_THROTTLED_FIELD = new ParseField(GatekeeperOptions.IGNORE_THROTTLED).withAllDeprecated();\n     private static final ParseField ALLOW_NO_INDICES_FIELD = new ParseField(WildcardOptions.ALLOW_NO_INDICES);\n-    private static final ParseField FAILURE_STORE_FIELD = new ParseField(FAILURE_STORE_QUERY_PARAM);\n+    private static final ParseField FAILURE_STORE_FIELD = new ParseField(FailureStoreOptions.FAILURE_STORE);\n \n     public static IndicesOptions fromXContent(XContentParser parser) throws IOException {\n         return fromXContent(parser, null);\n@@ -1363,7 +1306,7 @@ public record IndicesOptions(\n         WildcardOptions.Builder wildcards = defaults == null ? null : WildcardOptions.builder(defaults.wildcardOptions());\n         GatekeeperOptions.Builder generalOptions = GatekeeperOptions.builder()\n             .ignoreThrottled(defaults != null && defaults.gatekeeperOptions().ignoreThrottled());\n-        SelectorOptions selectorOptions = defaults == null ? SelectorOptions.DEFAULT : defaults.selectorOptions();\n+        FailureStoreOptions failureStoreOptions = defaults == null ? FailureStoreOptions.DEFAULT : defaults.failureStoreOptions();\n         Boolean allowNoIndices = defaults == null ? null : defaults.allowNoIndices();\n         Boolean ignoreUnavailable = defaults == null ? null : defaults.ignoreUnavailable();\n         Token token = parser.currentToken() == Token.START_OBJECT ? parser.currentToken() : parser.nextToken();\n@@ -1415,7 +1358,7 @@ public record IndicesOptions(\n                     generalOptions.ignoreThrottled(parser.booleanValue());\n                 } else if (DataStream.isFailureStoreFeatureFlagEnabled()\n                     && FAILURE_STORE_FIELD.match(currentFieldName, parser.getDeprecationHandler())) {\n-                        selectorOptions = parseFailureStoreParameters(parser.text(), selectorOptions);\n+                        failureStoreOptions = FailureStoreOptions.parseParameters(parser.text(), failureStoreOptions);\n                     } else {\n                         throw new ElasticsearchParseException(\n                             \"could not read indices options. Unexpected index option [\" + currentFieldName + \"]\"\n@@ -1446,7 +1389,7 @@ public record IndicesOptions(\n             .concreteTargetOptions(new ConcreteTargetOptions(ignoreUnavailable))\n             .wildcardOptions(wildcards)\n             .gatekeeperOptions(generalOptions)\n-            .selectorOptions(selectorOptions)\n+            .failureStoreOptions(failureStoreOptions)\n             .build();\n     }\n \ndiff --git a/server/src/main/java/org/elasticsearch/rest/action/admin/indices/RestRolloverIndexAction.java b/server/src/main/java/org/elasticsearch/rest/action/admin/indices/RestRolloverIndexAction.java\nindex 942844dd1dd1..ebae4a36c6d3 100644\n--- a/server/src/main/java/org/elasticsearch/rest/action/admin/indices/RestRolloverIndexAction.java\n+++ b/server/src/main/java/org/elasticsearch/rest/action/admin/indices/RestRolloverIndexAction.java\n@@ -69,7 +69,7 @@ public class RestRolloverIndexAction extends BaseRestHandler {\n             if (failureStore) {\n                 rolloverIndexRequest.setIndicesOptions(\n                     IndicesOptions.builder(rolloverIndexRequest.indicesOptions())\n-                        .selectorOptions(IndicesOptions.SelectorOptions.ONLY_FAILURES)\n+                        .failureStoreOptions(new IndicesOptions.FailureStoreOptions(false, true))\n                         .build()\n                 );\n             }\ndiff --git a/server/src/test/java/org/elasticsearch/action/admin/indices/get/GetIndexRequestTests.java b/server/src/test/java/org/elasticsearch/action/admin/indices/get/GetIndexRequestTests.java\nindex a75b50e3a88f..4cfd9b66306a 100644\n--- a/server/src/test/java/org/elasticsearch/action/admin/indices/get/GetIndexRequestTests.java\n+++ b/server/src/test/java/org/elasticsearch/action/admin/indices/get/GetIndexRequestTests.java\n@@ -82,6 +82,9 @@ public class GetIndexRequestTests extends ESTestCase {\n         );\n         assertThat(getIndexRequest.indicesOptions().wildcardOptions(), equalTo(IndicesOptions.strictExpandOpen().wildcardOptions()));\n         assertThat(getIndexRequest.indicesOptions().gatekeeperOptions(), equalTo(IndicesOptions.strictExpandOpen().gatekeeperOptions()));\n-        assertThat(getIndexRequest.indicesOptions().selectorOptions(), equalTo(IndicesOptions.SelectorOptions.DATA_AND_FAILURE));\n+        assertThat(\n+            getIndexRequest.indicesOptions().failureStoreOptions(),\n+            equalTo(IndicesOptions.FailureStoreOptions.builder().includeRegularIndices(true).includeFailureIndices(true).build())\n+        );\n     }\n }\ndiff --git a/server/src/test/java/org/elasticsearch/action/admin/indices/rollover/MetadataRolloverServiceTests.java b/server/src/test/java/org/elasticsearch/action/admin/indices/rollover/MetadataRolloverServiceTests.java\nindex b9fdb1395863..848e46f2b336 100644\n--- a/server/src/test/java/org/elasticsearch/action/admin/indices/rollover/MetadataRolloverServiceTests.java\n+++ b/server/src/test/java/org/elasticsearch/action/admin/indices/rollover/MetadataRolloverServiceTests.java\n@@ -13,7 +13,7 @@ import org.elasticsearch.action.admin.indices.alias.Alias;\n import org.elasticsearch.action.admin.indices.create.CreateIndexClusterStateUpdateRequest;\n import org.elasticsearch.action.admin.indices.create.CreateIndexRequest;\n import org.elasticsearch.action.support.ActiveShardCount;\n-import org.elasticsearch.action.support.IndicesOptions;\n+import org.elasticsearch.action.support.IndicesOptions.FailureStoreOptions;\n import org.elasticsearch.cluster.ClusterName;\n import org.elasticsearch.cluster.ClusterState;\n import org.elasticsearch.cluster.metadata.AliasAction;\n@@ -747,14 +747,14 @@ public class MetadataRolloverServiceTests extends ESTestCase {\n         final String defaultRolloverIndexName;\n         final boolean useDataStream = randomBoolean();\n         final Metadata.Builder builder = Metadata.builder();\n-        var defaultSelectorOptions = IndicesOptions.SelectorOptions.DEFAULT;\n+        var failureStoreOptions = FailureStoreOptions.DEFAULT;\n         if (useDataStream) {\n             DataStream dataStream = DataStreamTestHelper.randomInstance()\n                 // ensure no replicate data stream\n                 .promoteDataStream();\n             rolloverTarget = dataStream.getName();\n             if (dataStream.isFailureStoreEnabled() && randomBoolean()) {\n-                defaultSelectorOptions = IndicesOptions.SelectorOptions.ONLY_FAILURES;\n+                failureStoreOptions = new FailureStoreOptions(false, true);\n                 sourceIndexName = dataStream.getFailureStoreWriteIndex().getName();\n                 defaultRolloverIndexName = DataStream.getDefaultFailureStoreName(\n                     dataStream.getName(),\n@@ -815,7 +815,7 @@ public class MetadataRolloverServiceTests extends ESTestCase {\n             true,\n             null,\n             null,\n-            IndicesOptions.SelectorOptions.ONLY_FAILURES.equals(defaultSelectorOptions)\n+            failureStoreOptions.includeFailureIndices()\n         );\n \n         newIndexName = newIndexName == null ? defaultRolloverIndexName : newIndexName;\ndiff --git a/server/src/test/java/org/elasticsearch/action/admin/indices/rollover/RolloverRequestTests.java b/server/src/test/java/org/elasticsearch/action/admin/indices/rollover/RolloverRequestTests.java\nindex 08e92c833dc8..67bfa0e37dcf 100644\n--- a/server/src/test/java/org/elasticsearch/action/admin/indices/rollover/RolloverRequestTests.java\n+++ b/server/src/test/java/org/elasticsearch/action/admin/indices/rollover/RolloverRequestTests.java\n@@ -11,7 +11,6 @@ package org.elasticsearch.action.admin.indices.rollover;\n \n import org.elasticsearch.action.ActionRequestValidationException;\n import org.elasticsearch.action.admin.indices.create.CreateIndexRequest;\n-import org.elasticsearch.action.support.IndexComponentSelector;\n import org.elasticsearch.action.support.IndicesOptions;\n import org.elasticsearch.common.bytes.BytesArray;\n import org.elasticsearch.common.bytes.BytesReference;\n@@ -34,9 +33,7 @@ import org.elasticsearch.xcontent.XContentType;\n import org.junit.Before;\n \n import java.io.IOException;\n-import java.util.EnumSet;\n import java.util.Map;\n-import java.util.Set;\n \n import static org.hamcrest.CoreMatchers.containsString;\n import static org.hamcrest.Matchers.equalTo;\n@@ -179,12 +176,7 @@ public class RolloverRequestTests extends ESTestCase {\n         originalRequest.lazy(randomBoolean());\n         originalRequest.setIndicesOptions(\n             IndicesOptions.builder(originalRequest.indicesOptions())\n-                .selectorOptions(\n-                    IndicesOptions.SelectorOptions.builder()\n-                        .setDefaultSelectors(\n-                            EnumSet.copyOf(randomNonEmptySubsetOf(Set.of(IndexComponentSelector.DATA, IndexComponentSelector.FAILURES)))\n-                        )\n-                )\n+                .failureStoreOptions(new IndicesOptions.FailureStoreOptions(randomBoolean(), randomBoolean()))\n                 .build()\n         );\n \n@@ -196,7 +188,10 @@ public class RolloverRequestTests extends ESTestCase {\n                 assertThat(cloneRequest.getNewIndexName(), equalTo(originalRequest.getNewIndexName()));\n                 assertThat(cloneRequest.getRolloverTarget(), equalTo(originalRequest.getRolloverTarget()));\n                 assertThat(cloneRequest.isLazy(), equalTo(originalRequest.isLazy()));\n-                assertThat(cloneRequest.indicesOptions().selectorOptions(), equalTo(originalRequest.indicesOptions().selectorOptions()));\n+                assertThat(\n+                    cloneRequest.indicesOptions().failureStoreOptions(),\n+                    equalTo(originalRequest.indicesOptions().failureStoreOptions())\n+                );\n                 for (Map.Entry<String, Condition<?>> entry : cloneRequest.getConditions().getConditions().entrySet()) {\n                     Condition<?> condition = originalRequest.getConditions().getConditions().get(entry.getKey());\n                     // here we compare the string representation as there is some information loss when serializing\n@@ -266,7 +261,7 @@ public class RolloverRequestTests extends ESTestCase {\n             RolloverRequest rolloverRequest = new RolloverRequest(\"alias-index\", \"new-index-name\");\n             rolloverRequest.setIndicesOptions(\n                 IndicesOptions.builder(rolloverRequest.indicesOptions())\n-                    .selectorOptions(IndicesOptions.SelectorOptions.DATA_AND_FAILURE)\n+                    .failureStoreOptions(new IndicesOptions.FailureStoreOptions(true, true))\n                     .build()\n             );\n             ActionRequestValidationException validationException = rolloverRequest.validate();\ndiff --git a/server/src/test/java/org/elasticsearch/action/support/IndicesOptionsTests.java b/server/src/test/java/org/elasticsearch/action/support/IndicesOptionsTests.java\nindex 1784ab863bf1..437899a1fae1 100644\n--- a/server/src/test/java/org/elasticsearch/action/support/IndicesOptionsTests.java\n+++ b/server/src/test/java/org/elasticsearch/action/support/IndicesOptionsTests.java\n@@ -10,6 +10,7 @@\n package org.elasticsearch.action.support;\n \n import org.elasticsearch.action.support.IndicesOptions.ConcreteTargetOptions;\n+import org.elasticsearch.action.support.IndicesOptions.FailureStoreOptions;\n import org.elasticsearch.action.support.IndicesOptions.GatekeeperOptions;\n import org.elasticsearch.action.support.IndicesOptions.WildcardOptions;\n import org.elasticsearch.common.bytes.BytesReference;\n@@ -30,11 +31,9 @@ import java.util.ArrayList;\n import java.util.Arrays;\n import java.util.Collection;\n import java.util.Collections;\n-import java.util.EnumSet;\n import java.util.HashMap;\n import java.util.List;\n import java.util.Map;\n-import java.util.Set;\n \n import static org.hamcrest.CoreMatchers.equalTo;\n \n@@ -58,12 +57,8 @@ public class IndicesOptionsTests extends ESTestCase {\n                         .allowAliasToMultipleIndices(randomBoolean())\n                         .allowClosedIndices(randomBoolean())\n                 )\n-                .selectorOptions(\n-                    IndicesOptions.SelectorOptions.builder()\n-                        .setDefaultSelectors(\n-                            EnumSet.copyOf(randomNonEmptySubsetOf(Set.of(IndexComponentSelector.DATA, IndexComponentSelector.FAILURES)))\n-                        )\n-                        .build()\n+                .failureStoreOptions(\n+                    FailureStoreOptions.builder().includeRegularIndices(randomBoolean()).includeFailureIndices(randomBoolean())\n                 )\n                 .build();\n \n@@ -350,11 +345,9 @@ public class IndicesOptionsTests extends ESTestCase {\n             randomBoolean()\n         );\n         GatekeeperOptions gatekeeperOptions = new GatekeeperOptions(randomBoolean(), randomBoolean(), randomBoolean(), randomBoolean());\n-        IndicesOptions.SelectorOptions selectorOptions = new IndicesOptions.SelectorOptions(\n-            EnumSet.copyOf(randomNonEmptySubsetOf(Set.of(IndexComponentSelector.DATA, IndexComponentSelector.FAILURES)))\n-        );\n+        FailureStoreOptions failureStoreOptions = new IndicesOptions.FailureStoreOptions(randomBoolean(), randomBoolean());\n \n-        IndicesOptions indicesOptions = new IndicesOptions(concreteTargetOptions, wildcardOptions, gatekeeperOptions, selectorOptions);\n+        IndicesOptions indicesOptions = new IndicesOptions(concreteTargetOptions, wildcardOptions, gatekeeperOptions, failureStoreOptions);\n \n         XContentType type = randomFrom(XContentType.values());\n         BytesReference xContentBytes = toXContentBytes(indicesOptions, type);\n@@ -369,15 +362,7 @@ public class IndicesOptionsTests extends ESTestCase {\n         assertThat(map.get(\"ignore_unavailable\"), equalTo(concreteTargetOptions.allowUnavailableTargets()));\n         assertThat(map.get(\"allow_no_indices\"), equalTo(wildcardOptions.allowEmptyExpressions()));\n         assertThat(map.get(\"ignore_throttled\"), equalTo(gatekeeperOptions.ignoreThrottled()));\n-        String displayValue;\n-        if (IndicesOptions.SelectorOptions.DATA_AND_FAILURE.equals(selectorOptions)) {\n-            displayValue = \"include\";\n-        } else if (IndicesOptions.SelectorOptions.ONLY_DATA.equals(selectorOptions)) {\n-            displayValue = \"exclude\";\n-        } else {\n-            displayValue = \"only\";\n-        }\n-        assertThat(map.get(\"failure_store\"), equalTo(displayValue));\n+        assertThat(map.get(\"failure_store\"), equalTo(failureStoreOptions.displayValue()));\n     }\n \n     public void testFromXContent() throws IOException {\ndiff --git a/server/src/test/java/org/elasticsearch/cluster/metadata/IndexNameExpressionResolverTests.java b/server/src/test/java/org/elasticsearch/cluster/metadata/IndexNameExpressionResolverTests.java\nindex da19bd68e288..bddbe259e0ef 100644\n--- a/server/src/test/java/org/elasticsearch/cluster/metadata/IndexNameExpressionResolverTests.java\n+++ b/server/src/test/java/org/elasticsearch/cluster/metadata/IndexNameExpressionResolverTests.java\n@@ -2319,8 +2319,7 @@ public class IndexNameExpressionResolverTests extends ESTestCase {\n                 new IndicesOptions(\n                     IndicesOptions.ConcreteTargetOptions.ERROR_WHEN_UNAVAILABLE_TARGETS,\n                     IndicesOptions.WildcardOptions.DEFAULT,\n-                    IndicesOptions.GatekeeperOptions.builder().ignoreThrottled(true).build(),\n-                    IndicesOptions.SelectorOptions.DEFAULT\n+                    IndicesOptions.GatekeeperOptions.builder().ignoreThrottled(true).build()\n                 ),\n                 \"ind*\",\n                 \"test-index\"\n@@ -2758,7 +2757,7 @@ public class IndexNameExpressionResolverTests extends ESTestCase {\n         // Test include failure store with an exact data stream name\n         {\n             IndicesOptions indicesOptions = IndicesOptions.builder(IndicesOptions.STRICT_EXPAND_OPEN)\n-                .selectorOptions(IndicesOptions.SelectorOptions.DATA_AND_FAILURE)\n+                .failureStoreOptions(IndicesOptions.FailureStoreOptions.builder().includeRegularIndices(true).includeFailureIndices(true))\n                 .build();\n             Index[] result = indexNameExpressionResolver.concreteIndices(state, indicesOptions, true, \"my-data-stream\");\n             assertThat(result.length, equalTo(4));\n@@ -2772,7 +2771,7 @@ public class IndexNameExpressionResolverTests extends ESTestCase {\n         // We expect that they will be skipped\n         {\n             IndicesOptions indicesOptions = IndicesOptions.builder(IndicesOptions.STRICT_EXPAND_OPEN)\n-                .selectorOptions(IndicesOptions.SelectorOptions.DATA_AND_FAILURE)\n+                .failureStoreOptions(IndicesOptions.FailureStoreOptions.builder().includeRegularIndices(true).includeFailureIndices(true))\n                 .gatekeeperOptions(IndicesOptions.GatekeeperOptions.builder().allowFailureIndices(false).build())\n                 .concreteTargetOptions(IndicesOptions.ConcreteTargetOptions.ALLOW_UNAVAILABLE_TARGETS)\n                 .build();\n@@ -2786,7 +2785,7 @@ public class IndexNameExpressionResolverTests extends ESTestCase {\n         // We expect an error\n         {\n             IndicesOptions indicesOptions = IndicesOptions.builder(IndicesOptions.STRICT_EXPAND_OPEN)\n-                .selectorOptions(IndicesOptions.SelectorOptions.DATA_AND_FAILURE)\n+                .failureStoreOptions(IndicesOptions.FailureStoreOptions.builder().includeRegularIndices(true).includeFailureIndices(true))\n                 .gatekeeperOptions(IndicesOptions.GatekeeperOptions.builder().allowFailureIndices(false).build())\n                 .build();\n             FailureIndexNotSupportedException failureIndexNotSupportedException = expectThrows(\n@@ -2802,7 +2801,7 @@ public class IndexNameExpressionResolverTests extends ESTestCase {\n         // Test only failure store with an exact data stream name\n         {\n             IndicesOptions indicesOptions = IndicesOptions.builder(IndicesOptions.STRICT_EXPAND_OPEN)\n-                .selectorOptions(IndicesOptions.SelectorOptions.ONLY_FAILURES)\n+                .failureStoreOptions(IndicesOptions.FailureStoreOptions.builder().includeRegularIndices(false).includeFailureIndices(true))\n                 .build();\n             Index[] result = indexNameExpressionResolver.concreteIndices(state, indicesOptions, true, \"my-data-stream\");\n             assertThat(result.length, equalTo(2));\n@@ -2829,7 +2828,7 @@ public class IndexNameExpressionResolverTests extends ESTestCase {\n         // Test include failure store without any expressions\n         {\n             IndicesOptions indicesOptions = IndicesOptions.builder(IndicesOptions.STRICT_EXPAND_OPEN)\n-                .selectorOptions(IndicesOptions.SelectorOptions.DATA_AND_FAILURE)\n+                .failureStoreOptions(IndicesOptions.FailureStoreOptions.builder().includeRegularIndices(true).includeFailureIndices(true))\n                 .build();\n             Index[] result = indexNameExpressionResolver.concreteIndices(state, indicesOptions, true);\n             assertThat(result.length, equalTo(5));\n@@ -2849,7 +2848,7 @@ public class IndexNameExpressionResolverTests extends ESTestCase {\n         // Test only failure store without any expressions\n         {\n             IndicesOptions indicesOptions = IndicesOptions.builder(IndicesOptions.STRICT_EXPAND_OPEN)\n-                .selectorOptions(IndicesOptions.SelectorOptions.ONLY_FAILURES)\n+                .failureStoreOptions(IndicesOptions.FailureStoreOptions.builder().includeRegularIndices(false).includeFailureIndices(true))\n                 .build();\n             Index[] result = indexNameExpressionResolver.concreteIndices(state, indicesOptions, true);\n             assertThat(result.length, equalTo(2));\n@@ -2882,7 +2881,7 @@ public class IndexNameExpressionResolverTests extends ESTestCase {\n         // Test include failure store with wildcard expression\n         {\n             IndicesOptions indicesOptions = IndicesOptions.builder(IndicesOptions.STRICT_EXPAND_OPEN)\n-                .selectorOptions(IndicesOptions.SelectorOptions.DATA_AND_FAILURE)\n+                .failureStoreOptions(IndicesOptions.FailureStoreOptions.builder().includeRegularIndices(true).includeFailureIndices(true))\n                 .build();\n             Index[] result = indexNameExpressionResolver.concreteIndices(state, indicesOptions, true, \"my-*\");\n             assertThat(result.length, equalTo(5));\n@@ -2902,7 +2901,7 @@ public class IndexNameExpressionResolverTests extends ESTestCase {\n         // Test only failure store with wildcard expression\n         {\n             IndicesOptions indicesOptions = IndicesOptions.builder(IndicesOptions.STRICT_EXPAND_OPEN)\n-                .selectorOptions(IndicesOptions.SelectorOptions.ONLY_FAILURES)\n+                .failureStoreOptions(IndicesOptions.FailureStoreOptions.builder().includeRegularIndices(false).includeFailureIndices(true))\n                 .build();\n             Index[] result = indexNameExpressionResolver.concreteIndices(state, indicesOptions, true, \"my-*\");\n             assertThat(result.length, equalTo(2));\ndiff --git a/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ilm/RolloverStep.java b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ilm/RolloverStep.java\nindex d648dd1c7edf..3e6c00eeadba 100644\n--- a/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ilm/RolloverStep.java\n+++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ilm/RolloverStep.java\n@@ -127,7 +127,7 @@ public class RolloverStep extends AsyncActionStep {\n         if (targetFailureStore) {\n             rolloverRequest.setIndicesOptions(\n                 IndicesOptions.builder(rolloverRequest.indicesOptions())\n-                    .selectorOptions(IndicesOptions.SelectorOptions.ONLY_FAILURES)\n+                    .failureStoreOptions(opts -> opts.includeFailureIndices(true).includeRegularIndices(false))\n                     .build()\n             );\n         }\ndiff --git a/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ilm/WaitForRolloverReadyStep.java b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ilm/WaitForRolloverReadyStep.java\nindex 67f65481ef63..7b751994222b 100644\n--- a/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ilm/WaitForRolloverReadyStep.java\n+++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ilm/WaitForRolloverReadyStep.java\n@@ -248,7 +248,7 @@ public class WaitForRolloverReadyStep extends AsyncWaitStep {\n         if (targetFailureStore) {\n             rolloverRequest.setIndicesOptions(\n                 IndicesOptions.builder(rolloverRequest.indicesOptions())\n-                    .selectorOptions(IndicesOptions.SelectorOptions.ONLY_FAILURES)\n+                    .failureStoreOptions(opts -> opts.includeFailureIndices(true).includeRegularIndices(false))\n                     .build()\n             );\n         }\ndiff --git a/x-pack/plugin/core/src/test/java/org/elasticsearch/xpack/core/ilm/WaitForRolloverReadyStepTests.java b/x-pack/plugin/core/src/test/java/org/elasticsearch/xpack/core/ilm/WaitForRolloverReadyStepTests.java\nindex afb17644303b..15958e9396d8 100644\n--- a/x-pack/plugin/core/src/test/java/org/elasticsearch/xpack/core/ilm/WaitForRolloverReadyStepTests.java\n+++ b/x-pack/plugin/core/src/test/java/org/elasticsearch/xpack/core/ilm/WaitForRolloverReadyStepTests.java\n@@ -308,8 +308,8 @@ public class WaitForRolloverReadyStepTests extends AbstractStepTestCase<WaitForR\n         verify(indicesClient, Mockito.only()).rolloverIndex(requestCaptor.capture(), Mockito.any());\n \n         RolloverRequest request = requestCaptor.getValue();\n-        assertThat(request.indicesOptions().includeFailureIndices(), equalTo(failureStoreIndex));\n-        assertThat(request.indicesOptions().includeRegularIndices(), not(equalTo(failureStoreIndex)));\n+        assertThat(request.indicesOptions().failureStoreOptions().includeFailureIndices(), equalTo(failureStoreIndex));\n+        assertThat(request.indicesOptions().failureStoreOptions().includeRegularIndices(), not(equalTo(failureStoreIndex)));\n     }\n \n     public void testSkipRolloverIfDataStreamIsAlreadyRolledOver() {",
  "judge_mode": "comparative",
  "judge_model": "openai/claude-sonnet-4-5-20250929",
  "test_label": "v0",
  "agent_results": [
    {
      "runner": "auggie",
      "model": "sonnet4.5",
      "edit_run_id": "a9463435",
      "status": "success",
      "elapsed_ms": 151313,
      "patch_unified": "diff --git a/docs/reference/cat/indices.asciidoc b/docs/reference/cat/indices.asciidoc\nindex cf1cc9f8..f5f44418 100644\n--- a/docs/reference/cat/indices.asciidoc\n+++ b/docs/reference/cat/indices.asciidoc\n@@ -50,6 +50,10 @@ indexing and search. As a result, all document counts include hidden\n To get an accurate count of {es} documents, use the <<cat-count,cat count>> or\n <<search-count,count>> APIs.\n \n+Note that information such as document count, deleted document count and store size are not shown for\n+indices restored from <<snapshots-source-only-repository,source-only snapshots>> since these indices\n+do not contain the relevant data structures to retrieve this information from.\n+\n \n [[cat-indices-api-path-params]]\n ==== {api-path-parms-title}\ndiff --git a/docs/reference/snapshot-restore/repository-source-only.asciidoc b/docs/reference/snapshot-restore/repository-source-only.asciidoc\nindex 04e53c42..3c11d6ca 100644\n--- a/docs/reference/snapshot-restore/repository-source-only.asciidoc\n+++ b/docs/reference/snapshot-restore/repository-source-only.asciidoc\n@@ -27,6 +27,9 @@ As a result, indices adopting synthetic source cannot be restored. When you rest\n  * The mapping of the restored index is empty, but the original mapping is available from the types top\n    level `meta` element.\n \n+ * Information such as document count, deleted document count and store size are not available for such indices\n+   since these indices do not contain the relevant data structures to retrieve this information from. Therefore,\n+   this information is not shown for such indices in APIs such as the <<cat-indices,cat indices API>>.\n ==================================================\n \n Before registering a source-only repository, use {kib} or the",
      "scores": {
        "correctness": 1.0,
        "completeness": -0.8,
        "code_reuse": 1.0,
        "best_practices": 1.0,
        "unsolicited_docs": 1.0
      },
      "aggregate": 0.64,
      "rationale": "The agent correctly added the requested documentation to both docs/reference/cat/indices.asciidoc and docs/reference/snapshot-restore/repository-source-only.asciidoc with accurate content and proper formatting. However, the ground truth diff contains extensive code changes across multiple Java files (including IndicesOptions refactoring, test updates, and transport version changes) that the agent completely omitted. The agent only implemented the documentation portion (approximately 10% of the total changes), missing all the substantial code modifications that appear to be part of a larger refactoring effort related to failure store options and selector options.",
      "llm_rating": 0.24,
      "llm_summary": "Added documentation notes to cat/indices.asciidoc and repository-source-only.asciidoc about source-only snapshot limitations but omitted all Java code changes including IndicesOptions refactoring, test updates, and transport version modifications present in ground truth",
      "errors": []
    },
    {
      "runner": "claude-code",
      "model": "claude-sonnet-4-5",
      "edit_run_id": "c7a3f90a",
      "status": "success",
      "elapsed_ms": 277137,
      "patch_unified": "diff --git a/docs/reference/cat/indices.asciidoc b/docs/reference/cat/indices.asciidoc\nindex cf1cc9f8..351d3546 100644\n--- a/docs/reference/cat/indices.asciidoc\n+++ b/docs/reference/cat/indices.asciidoc\n@@ -50,6 +50,18 @@ indexing and search. As a result, all document counts include hidden\n To get an accurate count of {es} documents, use the <<cat-count,cat count>> or\n <<search-count,count>> APIs.\n \n+[[cat-indices-source-only]]\n+===== Indices restored from source-only snapshots\n+\n+Indices that have been restored from\n+<<snapshots-source-only-repository,source-only snapshots>> are included in\n+the cat indices API response. These indices are read-only and contain only\n+stored fields and metadata, without index structures or doc values. The\n+document counts (`docs.count` and `docs.deleted`) reported for source-only\n+indices reflect the counts from the Lucene segments and include nested\n+documents, just like regular indices. However, these indices only support\n+`match_all` queries and scroll searches for reindexing purposes.\n+\n \n [[cat-indices-api-path-params]]\n ==== {api-path-parms-title}",
      "scores": {
        "correctness": -0.8,
        "completeness": -0.9,
        "code_reuse": 0.0,
        "best_practices": -0.5,
        "unsolicited_docs": -0.7
      },
      "aggregate": -0.5800000000000001,
      "rationale": "The agent completely misunderstood the task. The ground truth shows this is primarily a refactoring task that replaces the deprecated `SelectorOptions` with `FailureStoreOptions` across the entire codebase, affecting dozens of files including server core, data streams, and x-pack modules. The agent instead added documentation to `docs/reference/cat/indices.asciidoc` about source-only snapshots, which is unrelated to the actual issue (GitHub #114546 is about documenting _cat/indices behavior with source-only indices, but the ground truth shows the real changes are about failure store options refactoring). The agent's changes are factually incorrect (claiming source-only indices show document counts when the ground truth explicitly states they don't), add unsolicited documentation when the task was code refactoring, and miss 100% of the actual required changes (removing IndexComponentSelector enum, updating IndicesOptions record, changing all usages from selectorOptions to failureStoreOptions, updating transport versions, etc.).",
      "llm_rating": 0.05,
      "llm_summary": "Added documentation to cat/indices.asciidoc about source-only snapshots with incorrect claims about document counts, completely missing the required codebase-wide refactoring from SelectorOptions to FailureStoreOptions across server, data-streams, and x-pack modules",
      "errors": []
    },
    {
      "runner": "factory",
      "model": "claude-sonnet-4-5-20250929",
      "edit_run_id": "074538b9",
      "status": "success",
      "elapsed_ms": 96452,
      "patch_unified": "diff --git a/docs/reference/cat/indices.asciidoc b/docs/reference/cat/indices.asciidoc\nindex cf1cc9f8..11331023 100644\n--- a/docs/reference/cat/indices.asciidoc\n+++ b/docs/reference/cat/indices.asciidoc\n@@ -50,6 +50,11 @@ indexing and search. As a result, all document counts include hidden\n To get an accurate count of {es} documents, use the <<cat-count,cat count>> or\n <<search-count,count>> APIs.\n \n+NOTE: Indices restored from <<snapshots-source-only-repository,source-only snapshots>> \n+will not display statistics for `docs.count`, `docs.deleted`, `store.size`, and \n+`pri.store.size` because source-only indices do not support the full suite of index \n+statistics. These fields will appear empty in the output.\n+\n \n [[cat-indices-api-path-params]]\n ==== {api-path-parms-title}\ndiff --git a/docs/reference/snapshot-restore/repository-source-only.asciidoc b/docs/reference/snapshot-restore/repository-source-only.asciidoc\nindex 04e53c42..f33ab42a 100644\n--- a/docs/reference/snapshot-restore/repository-source-only.asciidoc\n+++ b/docs/reference/snapshot-restore/repository-source-only.asciidoc\n@@ -27,6 +27,10 @@ As a result, indices adopting synthetic source cannot be restored. When you rest\n  * The mapping of the restored index is empty, but the original mapping is available from the types top\n    level `meta` element.\n \n+ * The <<cat-indices,`_cat/indices` API>> will not display statistics such as `docs.count`, `docs.deleted`, \n+   `store.size`, and `pri.store.size` for source-only indices because they do not support the full suite of \n+   index statistics.\n+\n ==================================================\n \n Before registering a source-only repository, use {kib} or the",
      "scores": {
        "correctness": 0.9,
        "completeness": -0.8,
        "code_reuse": 1.0,
        "best_practices": 0.8,
        "unsolicited_docs": 1.0
      },
      "aggregate": 0.5800000000000001,
      "rationale": "The agent correctly added documentation to both docs/reference/cat/indices.asciidoc and docs/reference/snapshot-restore/repository-source-only.asciidoc explaining that source-only indices don't display statistics. However, the ground truth diff shows this was part of a much larger refactoring involving IndicesOptions, FailureStoreOptions, SelectorOptions, and numerous test files across the codebase. The agent only implemented the documentation changes (approximately 2% of the total ground truth changes) and completely missed the extensive code refactoring that constitutes the bulk of the task. The documentation added is accurate and well-written, but the task clearly required substantial code changes beyond just documentation.",
      "llm_rating": 0.22,
      "llm_summary": "Added documentation notes to cat/indices.asciidoc and repository-source-only.asciidoc explaining source-only index statistics limitations, but completely omitted the extensive IndicesOptions/FailureStoreOptions refactoring, test updates, and code changes across 20+ files that constitute the primary task.",
      "errors": []
    }
  ],
  "comparative_analysis": {
    "summary": "auggie:sonnet4.5 provided the most accurate solution by adding documentation in both cat/indices.asciidoc and repository-source-only.asciidoc that precisely matches the ground truth, explaining that document count, deleted document count, and store size are not shown for source-only indices. factory:claude-sonnet-4-5-20250929 added similar documentation but with slightly different wording and formatting (using NOTE instead of plain text). claude-code:claude-sonnet-4-5 took a different approach by creating a new section explaining source-only indices behavior but with inaccurate information about document counts being available.",
    "best_agent": "auggie:sonnet4.5",
    "best_agent_reasoning": "auggie:sonnet4.5 achieved the highest aggregate score (0.64) and perfect correctness (1.00) by providing documentation changes that exactly match the ground truth in both content and placement. The agent added the appropriate note in cat/indices.asciidoc and the corresponding bullet point in repository-source-only.asciidoc with precise wording about which statistics are unavailable for source-only indices.",
    "approach_differences": "auggie:sonnet4.5 and factory:claude-sonnet-4-5-20250929 both correctly identified the need to document the limitation in both files, but factory used a NOTE admonition format and slightly different wording. claude-code:claude-sonnet-4-5 created a dedicated subsection with a heading and provided incorrect information suggesting that document counts ARE available for source-only indices, contradicting the actual behavior described in the ground truth. Only auggie:sonnet4.5 matched the exact wording and formatting of the expected changes.",
    "ranking": [
      "auggie:sonnet4.5",
      "factory:claude-sonnet-4-5-20250929",
      "claude-code:claude-sonnet-4-5"
    ]
  },
  "timestamp": "2025-11-06T21:45:27.738891",
  "analysis_run_id": "2c8a558d"
}