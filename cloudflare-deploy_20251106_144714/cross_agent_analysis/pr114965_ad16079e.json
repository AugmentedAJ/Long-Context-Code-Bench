{
  "repo_url": "https://github.com/elastic/elasticsearch.git",
  "pr_number": 114965,
  "base_commit": "64ae0aea45036be62aec076717816a27aa006437",
  "head_commit": "066dade7bbe75631639bdae59dd3f4ebb07b801f",
  "task_instructions": "You are working on a codebase. Your task is to make the necessary code changes to accomplish the following:\n\nDocument ?_tstart and ?_tend in Kibana\n\n[Preview](https://elasticsearch_bk_114965.docs-preview.app.elstc.co/guide/en/elasticsearch/reference/master/esql-kibana.html#esql-kibana-time-filter)\r\n\r\nNotes for reviewers:\r\n* Not sold on the subheadings ðŸ¤” \r\n* Initially I had \"auto-incrementing time buckets\" as a last subsection (separated out instead of folded under the custom section); I can redo it that way if we want to highlight `BUCKET`s.\r\n\r\nFix for [this issue](https://github.com/elastic/search-docs-team/issues/153)\n\nPlease make all necessary code changes to complete this task.",
  "ground_truth_diff": "diff --git a/docs/reference/esql/esql-kibana.asciidoc b/docs/reference/esql/esql-kibana.asciidoc\nindex 5da8b9323cc2..9850e012fc04 100644\n--- a/docs/reference/esql/esql-kibana.asciidoc\n+++ b/docs/reference/esql/esql-kibana.asciidoc\n@@ -171,14 +171,44 @@ FROM kibana_sample_data_logs\n [[esql-kibana-time-filter]]\n === Time filtering\n \n-To display data within a specified time range, use the\n-{kibana-ref}/set-time-filter.html[time filter]. The time filter is only enabled\n-when the indices you're querying have a field called `@timestamp`.\n+To display data within a specified time range, you can use the standard time filter, \n+custom time parameters, or a WHERE command.\n \n-If your indices do not have a timestamp field called `@timestamp`, you can limit\n-the time range using the <<esql-where>> command and the <<esql-now>> function.\n+[discrete]\n+==== Standard time filter\n+The standard {kibana-ref}/set-time-filter.html[time filter] is enabled\n+when the indices you're querying have a field named `@timestamp`.\n+\n+[discrete]\n+==== Custom time parameters\n+If your indices do not have a field named `@timestamp`, you can use\n+the `?_tstart` and `?_tend` parameters to specify a time range. These parameters \n+work with any timestamp field and automatically sync with the {kibana-ref}/set-time-filter.html[time filter].\n+\n+[source,esql]\n+----\n+FROM my_index\n+| WHERE custom_timestamp >= ?_tstart AND custom_timestamp < ?_tend\n+----\n+\n+You can also use the `?_tstart` and `?_tend` parameters with the <<esql-bucket>> function \n+to create auto-incrementing time buckets in {esql} <<esql-kibana-visualizations,visualizations>>. \n+For example:\n+\n+[source,esql]\n+----\n+FROM kibana_sample_data_logs\n+| STATS average_bytes = AVG(bytes) BY BUCKET(@timestamp, 50, ?_tstart, ?_tend)\n+----\n+\n+This example uses `50` buckets, which is the maximum number of buckets.\n+\n+[discrete]\n+==== WHERE command\n+You can also limit the time range using the <<esql-where>> command and the <<esql-now>> function.\n For example, if the timestamp field is called `timestamp`, to query the last 15\n minutes of data:\n+\n [source,esql]\n ----\n FROM kibana_sample_data_logs",
  "judge_mode": "comparative",
  "judge_model": "openai/claude-sonnet-4-5-20250929",
  "test_label": "v0",
  "agent_results": [
    {
      "runner": "auggie",
      "model": "sonnet4.5",
      "edit_run_id": "a9463435",
      "status": "success",
      "elapsed_ms": 162546,
      "patch_unified": "diff --git a/docs/reference/esql/esql-kibana.asciidoc b/docs/reference/esql/esql-kibana.asciidoc\nindex 5da8b932..04805131 100644\n--- a/docs/reference/esql/esql-kibana.asciidoc\n+++ b/docs/reference/esql/esql-kibana.asciidoc\n@@ -171,14 +171,48 @@ FROM kibana_sample_data_logs\n [[esql-kibana-time-filter]]\n === Time filtering\n \n-To display data within a specified time range, use the\n-{kibana-ref}/set-time-filter.html[time filter]. The time filter is only enabled\n-when the indices you're querying have a field called `@timestamp`.\n-\n-If your indices do not have a timestamp field called `@timestamp`, you can limit\n-the time range using the <<esql-where>> command and the <<esql-now>> function.\n-For example, if the timestamp field is called `timestamp`, to query the last 15\n-minutes of data:\n+To display data within a specified time range, you can use the standard time\n+filter, custom time parameters, or a <<esql-where>> command.\n+\n+[discrete]\n+==== Standard time filter\n+\n+The standard time filter is enabled when the indices you're querying have a\n+field named `@timestamp`. To display data within a specified time range, use the\n+{kibana-ref}/set-time-filter.html[time filter].\n+\n+[discrete]\n+==== Custom time parameters\n+\n+If your indices do not have a field named `@timestamp`, you can use the\n+`?_tstart` and `?_tend` parameters to specify a time range. These parameters\n+work with any timestamp field and automatically sync with the time filter.\n+\n+[source,esql]\n+----\n+FROM my_index\n+| WHERE custom_timestamp >= ?_tstart AND custom_timestamp < ?_tend\n+----\n+\n+You can also use the `?_tstart` and `?_tend` parameters with the\n+<<esql-bucket>> function to create auto-incrementing time buckets in {esql}\n+visualizations. For example:\n+\n+[source,esql]\n+----\n+FROM kibana_sample_data_logs\n+| STATS average_bytes = AVG(bytes) BY BUCKET(@timestamp, 50, ?_tstart, ?_tend)\n+----\n+\n+This example uses 50 buckets, which is the maximum number of buckets.\n+\n+[discrete]\n+==== WHERE command\n+\n+You can also limit the time range using the <<esql-where>> command and the\n+<<esql-now>> function. For example, if the timestamp field is called\n+`timestamp`, to query the last 15 minutes of data:\n+\n [source,esql]\n ----\n FROM kibana_sample_data_logs",
      "scores": {
        "correctness": 0.9,
        "completeness": 0.95,
        "code_reuse": 1.0,
        "best_practices": 0.9,
        "unsolicited_docs": 1.0
      },
      "aggregate": 0.95,
      "rationale": "The agent's diff successfully implements all major changes from the ground truth: restructures time filtering section with three subsections (Standard time filter, Custom time parameters, WHERE command), documents ?_tstart and ?_tend parameters with examples, and includes the BUCKET function example. Minor differences include: (1) slightly different wording in the Standard time filter section ('To display data within a specified time range, use the time filter' moved to second sentence vs integrated in first), (2) missing link markup around 'time filter' in Custom time parameters section (ground truth has {kibana-ref}/set-time-filter.html[time filter], agent has plain 'time filter'), (3) missing link markup around 'visualizations' (ground truth has <<esql-kibana-visualizations,visualizations>>, agent has plain 'visualizations'), and (4) formatting difference in the last example ('50' vs '`50`'). These are very minor presentation differences that don't affect functionality or comprehension significantly.",
      "llm_rating": 0.93,
      "llm_summary": "Agent restructured esql-kibana.asciidoc time filtering section into three subsections documenting ?_tstart and ?_tend parameters with BUCKET examples, but omitted two cross-reference links (time filter and visualizations) and one backtick formatting around '50' compared to ground truth",
      "errors": []
    },
    {
      "runner": "claude-code",
      "model": "claude-sonnet-4-5",
      "edit_run_id": "c7a3f90a",
      "status": "success",
      "elapsed_ms": 139877,
      "patch_unified": "diff --git a/docs/reference/esql/esql-kibana.asciidoc b/docs/reference/esql/esql-kibana.asciidoc\nindex 5da8b932..81a42a37 100644\n--- a/docs/reference/esql/esql-kibana.asciidoc\n+++ b/docs/reference/esql/esql-kibana.asciidoc\n@@ -175,16 +175,64 @@ To display data within a specified time range, use the\n {kibana-ref}/set-time-filter.html[time filter]. The time filter is only enabled\n when the indices you're querying have a field called `@timestamp`.\n \n-If your indices do not have a timestamp field called `@timestamp`, you can limit\n-the time range using the <<esql-where>> command and the <<esql-now>> function.\n-For example, if the timestamp field is called `timestamp`, to query the last 15\n-minutes of data:\n+[discrete]\n+[[esql-kibana-time-filter-params]]\n+==== Using the Kibana time filter\n+\n+When you select a time range in Kibana's time filter, Kibana automatically\n+applies the filter to your {esql} query by adding two named parameters:\n+`?_tstart` and `?_tend`. These parameters represent the start and end of the\n+selected time range.\n+\n+You can reference these parameters in your query using the <<esql-where>>\n+command. For example:\n+\n+[source,esql]\n+----\n+FROM kibana_sample_data_logs\n+| WHERE @timestamp >= ?_tstart AND @timestamp < ?_tend\n+----\n+\n+This is useful when you want to:\n+\n+* Apply additional time-based filters beyond the standard time filter\n+* Use the time filter values in calculations or aggregations\n+* Filter on the `@timestamp` field in combination with other conditions\n+\n+[discrete]\n+[[esql-kibana-time-filter-custom]]\n+==== Custom time filtering\n+\n+If your indices do not have a timestamp field called `@timestamp`, you can use\n+the `?_tstart` and `?_tend` parameters with your custom timestamp field:\n+\n+[source,esql]\n+----\n+FROM kibana_sample_data_logs\n+| WHERE timestamp >= ?_tstart AND timestamp < ?_tend\n+----\n+\n+Alternatively, you can limit the time range using the <<esql-where>> command and\n+the <<esql-now>> function. For example, to query the last 15 minutes of data:\n+\n [source,esql]\n ----\n FROM kibana_sample_data_logs\n | WHERE timestamp > NOW() - 15minutes\n ----\n \n+You can also use the `?_tstart` and `?_tend` parameters with the <<esql-bucket>>\n+function to create time buckets that align with the selected time range:\n+\n+[source,esql]\n+----\n+FROM kibana_sample_data_logs\n+| WHERE @timestamp >= ?_tstart AND @timestamp < ?_tend\n+| STATS count = COUNT(*) BY bucket = BUCKET(@timestamp, 50, ?_tstart, ?_tend)\n+----\n+\n+This creates 50 auto-incrementing time buckets spanning the selected time range.\n+\n [discrete]\n [[esql-kibana-visualizations]]\n === Analyze and visualize data",
      "scores": {
        "correctness": 0.6,
        "completeness": 0.7,
        "code_reuse": 0.8,
        "best_practices": 0.5,
        "unsolicited_docs": 0.9
      },
      "aggregate": 0.7,
      "rationale": "The agent successfully documents ?_tstart and ?_tend parameters and restructures the time filtering section with subsections. However, there are key differences: 1) The agent adds an extra subsection 'Using the Kibana time filter' that explains automatic parameter injection, which isn't in ground truth; 2) The agent adds an anchor ID [[esql-kibana-time-filter-params]] not present in ground truth; 3) The ground truth's introductory sentence is more concise ('you can use the standard time filter, custom time parameters, or a WHERE command') while the agent keeps the original intro; 4) The agent's BUCKET example includes an unnecessary WHERE clause and uses different variable naming (count vs average_bytes); 5) The agent's custom time filtering section is more verbose with additional explanatory text. The core functionality is documented correctly, but the structure and content differ significantly from the expected ground truth.",
      "llm_rating": 0.65,
      "llm_summary": "Added documentation for ?_tstart and ?_tend parameters with three subsections including an extra 'Using the Kibana time filter' section not in ground truth, modified BUCKET example to include WHERE clause, and retained original intro text instead of ground truth's concise version",
      "errors": []
    },
    {
      "runner": "factory",
      "model": "claude-sonnet-4-5-20250929",
      "edit_run_id": "074538b9",
      "status": "success",
      "elapsed_ms": 460129,
      "patch_unified": "diff --git a/docs/reference/esql/esql-kibana.asciidoc b/docs/reference/esql/esql-kibana.asciidoc\nindex 5da8b932..5a371fbc 100644\n--- a/docs/reference/esql/esql-kibana.asciidoc\n+++ b/docs/reference/esql/esql-kibana.asciidoc\n@@ -185,6 +185,54 @@ FROM kibana_sample_data_logs\n | WHERE timestamp > NOW() - 15minutes\n ----\n \n+[discrete]\n+[[esql-kibana-time-filter-params]]\n+==== Using time filter parameters\n+\n+When working with the Kibana time filter, you can reference the selected time\n+range in your {esql} queries using named parameters `?_tstart` and `?_tend`.\n+These parameters are automatically populated with the start and end times from\n+the time filter.\n+\n+For example, to explicitly filter data using the time range:\n+[source,esql]\n+----\n+FROM kibana_sample_data_logs\n+| WHERE @timestamp >= ?_tstart AND @timestamp < ?_tend\n+----\n+\n+This is particularly useful when:\n+\n+* You want to use the time range for calculations or comparisons beyond simple filtering\n+* You need to reference the time boundaries in aggregations or functions\n+* You're working with multiple timestamp fields and want to apply the time filter to a specific field\n+\n+[discrete]\n+[[esql-kibana-time-filter-custom-buckets]]\n+==== Custom time buckets\n+\n+You can combine time filter parameters with the <<esql-bucket>> function to\n+create time-based histograms that align with the selected time range:\n+\n+[source,esql]\n+----\n+FROM kibana_sample_data_logs\n+| STATS count = COUNT(*) BY bucket = BUCKET(@timestamp, 25, ?_tstart, ?_tend)\n+| SORT bucket\n+----\n+\n+This query automatically divides the selected time range into approximately 25\n+buckets, making it easy to create visualizations that adapt to different time\n+ranges without modifying the query.\n+\n+For fixed-size time buckets, you can specify a time span directly:\n+[source,esql]\n+----\n+FROM kibana_sample_data_logs\n+| STATS count = COUNT(*) BY bucket = BUCKET(@timestamp, 1 hour)\n+| SORT bucket\n+----\n+\n [discrete]\n [[esql-kibana-visualizations]]\n === Analyze and visualize data",
      "scores": {
        "correctness": 0.6,
        "completeness": 0.4,
        "code_reuse": 0.8,
        "best_practices": 0.7,
        "unsolicited_docs": 0.3
      },
      "aggregate": 0.5599999999999999,
      "rationale": "The agent added documentation for ?_tstart and ?_tend parameters but placed it after the existing WHERE/NOW example instead of restructuring the entire section. Ground truth reorganizes the section with three subsections (Standard time filter, Custom time parameters, WHERE command) and modifies the introductory text. Agent's approach documents the parameters correctly with good examples including BUCKET usage, but misses the structural reorganization, doesn't update the intro paragraph, and doesn't create the 'Standard time filter' subsection. The agent adds more explanatory content than ground truth (e.g., 'This is particularly useful when:' bullets, fixed-size bucket example) which wasn't requested. The BUCKET example uses 25 buckets vs ground truth's 50, and includes additional sorting and a fixed-size alternative.",
      "llm_rating": 0.54,
      "llm_summary": "Added two new subsections documenting ?_tstart and ?_tend parameters with BUCKET examples after the existing WHERE command section, but did not restructure the entire Time filtering section into three subsections or update the introductory paragraph as specified in ground truth.",
      "errors": []
    }
  ],
  "comparative_analysis": {
    "summary": "auggie:sonnet4.5 produced the most accurate solution, closely matching the ground truth with proper restructuring and all required content. claude-code:claude-sonnet-4-5 added excessive explanatory content not present in the ground truth, including detailed usage scenarios and multiple examples. factory:claude-sonnet-4-5-20250929 placed new sections at the end rather than restructuring the existing content, missing the key reorganization of the opening paragraph.",
    "best_agent": "auggie:sonnet4.5",
    "best_agent_reasoning": "auggie:sonnet4.5 achieved the highest aggregate score (0.95) by most accurately implementing the ground truth changes. It correctly restructured the opening paragraph to introduce three filtering methods, added all three required subsections with proper discrete headers, included both required examples with correct syntax, and maintained the proper flow. The only minor deviation was slightly different wording in the standard time filter section, but the structure and content were nearly identical to the expected output.",
    "approach_differences": "auggie:sonnet4.5 focused on restructuring the existing content by replacing the opening paragraph and inserting new subsections in the correct order. claude-code:claude-sonnet-4-5 kept the original opening paragraph intact and added new sections with different anchor IDs and extensive explanatory text not in the ground truth. factory:claude-sonnet-4-5-20250929 appended new sections at the end without restructuring the beginning, missing the critical reorganization of the introduction and the three-method framework that was central to the task.",
    "ranking": [
      "auggie:sonnet4.5",
      "claude-code:claude-sonnet-4-5",
      "factory:claude-sonnet-4-5-20250929"
    ]
  },
  "timestamp": "2025-11-06T22:01:02.056432",
  "analysis_run_id": "ad16079e"
}