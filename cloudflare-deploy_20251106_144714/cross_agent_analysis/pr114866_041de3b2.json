{
  "repo_url": "https://github.com/elastic/elasticsearch.git",
  "pr_number": 114866,
  "base_commit": "d3ab379df5b5fb588e9071923ff0d4b6c20096af",
  "head_commit": "5714edca310450303e932f8a5fa0d843ad83f438",
  "task_instructions": "You are working on a codebase. Your task is to make the necessary code changes to accomplish the following:\n\n[8.x] Allow synthetic source and disabled source for standard indices (#114817)\n\n# Backport\n\nThis is an automatic backport to `8.x` of:\n - #114817\n\n### Questions ?\nPlease refer to the [Backport tool documentation](https://github.com/sqren/backport)\n\nPlease make all necessary code changes to complete this task.",
  "ground_truth_diff": "diff --git a/server/src/main/java/org/elasticsearch/index/mapper/SourceFieldMapper.java b/server/src/main/java/org/elasticsearch/index/mapper/SourceFieldMapper.java\nindex 834a04f9a2ca..ea7fbfd8f6f6 100644\n--- a/server/src/main/java/org/elasticsearch/index/mapper/SourceFieldMapper.java\n+++ b/server/src/main/java/org/elasticsearch/index/mapper/SourceFieldMapper.java\n@@ -92,6 +92,42 @@ public class SourceFieldMapper extends MetadataFieldMapper {\n         true\n     );\n \n+    private static final SourceFieldMapper DEFAULT_DISABLED = new SourceFieldMapper(\n+        Mode.DISABLED,\n+        Explicit.IMPLICIT_TRUE,\n+        Strings.EMPTY_ARRAY,\n+        Strings.EMPTY_ARRAY,\n+        null,\n+        true\n+    );\n+\n+    private static final SourceFieldMapper DEFAULT_DISABLED_NO_RECOVERY_SOURCE = new SourceFieldMapper(\n+        Mode.DISABLED,\n+        Explicit.IMPLICIT_TRUE,\n+        Strings.EMPTY_ARRAY,\n+        Strings.EMPTY_ARRAY,\n+        null,\n+        false\n+    );\n+\n+    private static final SourceFieldMapper DEFAULT_SYNTHETIC = new SourceFieldMapper(\n+        Mode.SYNTHETIC,\n+        Explicit.IMPLICIT_TRUE,\n+        Strings.EMPTY_ARRAY,\n+        Strings.EMPTY_ARRAY,\n+        null,\n+        true\n+    );\n+\n+    private static final SourceFieldMapper DEFAULT_SYNTHETIC_NO_RECOVERY_SOURCE = new SourceFieldMapper(\n+        Mode.SYNTHETIC,\n+        Explicit.IMPLICIT_TRUE,\n+        Strings.EMPTY_ARRAY,\n+        Strings.EMPTY_ARRAY,\n+        null,\n+        false\n+    );\n+\n     private static final SourceFieldMapper DEFAULT_NO_RECOVERY_SOURCE = new SourceFieldMapper(\n         null,\n         Explicit.IMPLICIT_TRUE,\n@@ -301,7 +337,7 @@ public class SourceFieldMapper extends MetadataFieldMapper {\n                 ? INDEX_MAPPER_SOURCE_MODE_SETTING.get(settings)\n                 : mode.get();\n             if (isDefault(sourceMode)) {\n-                return resolveSourceMode(indexMode, sourceMode, enableRecoverySource);\n+                return resolveSourceMode(indexMode, sourceMode == null ? Mode.STORED : sourceMode, enableRecoverySource);\n \n             }\n             if (supportsNonDefaultParameterValues == false) {\n@@ -344,27 +380,38 @@ public class SourceFieldMapper extends MetadataFieldMapper {\n     }\n \n     private static SourceFieldMapper resolveSourceMode(final IndexMode indexMode, final Mode sourceMode, boolean enableRecoverySource) {\n-        if (indexMode == IndexMode.STANDARD) {\n-            return enableRecoverySource ? DEFAULT : DEFAULT_NO_RECOVERY_SOURCE;\n-        }\n-        final SourceFieldMapper syntheticWithoutRecoverySource = indexMode == IndexMode.TIME_SERIES\n-            ? TSDB_DEFAULT_NO_RECOVERY_SOURCE\n-            : LOGSDB_DEFAULT_NO_RECOVERY_SOURCE;\n-        final SourceFieldMapper syntheticWithRecoverySource = indexMode == IndexMode.TIME_SERIES ? TSDB_DEFAULT : LOGSDB_DEFAULT;\n-        final SourceFieldMapper storedWithoutRecoverySource = indexMode == IndexMode.TIME_SERIES\n-            ? TSDB_DEFAULT_NO_RECOVERY_SOURCE_STORED\n-            : LOGSDB_DEFAULT_NO_RECOVERY_SOURCE_STORED;\n-        final SourceFieldMapper storedWithRecoverySource = indexMode == IndexMode.TIME_SERIES ? TSDB_DEFAULT_STORED : LOGSDB_DEFAULT_STORED;\n-\n-        switch (sourceMode) {\n-            case SYNTHETIC:\n-                return enableRecoverySource ? syntheticWithRecoverySource : syntheticWithoutRecoverySource;\n-            case STORED:\n-                return enableRecoverySource ? storedWithRecoverySource : storedWithoutRecoverySource;\n-            case DISABLED:\n-                throw new IllegalArgumentException(\"_source cannot be disabled in index using [\" + indexMode + \"] index mode\");\n+        switch (indexMode) {\n+            case STANDARD:\n+                switch (sourceMode) {\n+                    case SYNTHETIC:\n+                        return enableRecoverySource ? DEFAULT_SYNTHETIC : DEFAULT_SYNTHETIC_NO_RECOVERY_SOURCE;\n+                    case STORED:\n+                        return enableRecoverySource ? DEFAULT : DEFAULT_NO_RECOVERY_SOURCE;\n+                    case DISABLED:\n+                        return enableRecoverySource ? DEFAULT_DISABLED : DEFAULT_DISABLED_NO_RECOVERY_SOURCE;\n+                    default:\n+                        throw new IllegalArgumentException(\"Unsupported source mode: \" + sourceMode);\n+                }\n+            case TIME_SERIES:\n+            case LOGSDB:\n+                switch (sourceMode) {\n+                    case SYNTHETIC:\n+                        return enableRecoverySource\n+                            ? (indexMode == IndexMode.TIME_SERIES ? TSDB_DEFAULT : LOGSDB_DEFAULT)\n+                            : (indexMode == IndexMode.TIME_SERIES ? TSDB_DEFAULT_NO_RECOVERY_SOURCE : LOGSDB_DEFAULT_NO_RECOVERY_SOURCE);\n+                    case STORED:\n+                        return enableRecoverySource\n+                            ? (indexMode == IndexMode.TIME_SERIES ? TSDB_DEFAULT_STORED : LOGSDB_DEFAULT_STORED)\n+                            : (indexMode == IndexMode.TIME_SERIES\n+                                ? TSDB_DEFAULT_NO_RECOVERY_SOURCE_STORED\n+                                : LOGSDB_DEFAULT_NO_RECOVERY_SOURCE_STORED);\n+                    case DISABLED:\n+                        throw new IllegalArgumentException(\"_source can not be disabled in index using [\" + indexMode + \"] index mode\");\n+                    default:\n+                        throw new IllegalArgumentException(\"Unsupported source mode: \" + sourceMode);\n+                }\n             default:\n-                throw new IllegalStateException(\"Unexpected value: \" + sourceMode);\n+                throw new IllegalArgumentException(\"Unsupported index mode: \" + indexMode);\n         }\n     }\n \n@@ -378,7 +425,7 @@ public class SourceFieldMapper extends MetadataFieldMapper {\n                 return enableRecoverySource ? TSDB_LEGACY_DEFAULT : TSDB_LEGACY_DEFAULT_NO_RECOVERY_SOURCE;\n             }\n         }\n-        return resolveSourceMode(indexMode, settingSourceMode, enableRecoverySource);\n+        return resolveSourceMode(indexMode, settingSourceMode == null ? Mode.STORED : settingSourceMode, enableRecoverySource);\n     },\n         c -> new Builder(\n             c.getIndexSettings().getMode(),\n@@ -548,4 +595,12 @@ public class SourceFieldMapper extends MetadataFieldMapper {\n     public boolean isSynthetic() {\n         return mode == Mode.SYNTHETIC;\n     }\n+\n+    public boolean isDisabled() {\n+        return mode == Mode.DISABLED;\n+    }\n+\n+    public boolean isStored() {\n+        return mode == null || mode == Mode.STORED;\n+    }\n }\ndiff --git a/server/src/test/java/org/elasticsearch/index/mapper/SourceFieldMapperTests.java b/server/src/test/java/org/elasticsearch/index/mapper/SourceFieldMapperTests.java\nindex 2f417e688cb9..df6d9380fd14 100644\n--- a/server/src/test/java/org/elasticsearch/index/mapper/SourceFieldMapperTests.java\n+++ b/server/src/test/java/org/elasticsearch/index/mapper/SourceFieldMapperTests.java\n@@ -443,6 +443,167 @@ public class SourceFieldMapperTests extends MetadataMapperTestCase {\n         }\n     }\n \n+    public void testStandardIndexModeWithSourceModeSetting() throws IOException {\n+        // Test for IndexMode.STANDARD\n+        {\n+            final XContentBuilder mappings = topMapping(b -> {});\n+            final Settings settings = Settings.builder()\n+                .put(IndexSettings.MODE.getKey(), IndexMode.STANDARD.name())\n+                .put(SourceFieldMapper.INDEX_MAPPER_SOURCE_MODE_SETTING.getKey(), SourceFieldMapper.Mode.SYNTHETIC)\n+                .build();\n+            final MapperService mapperService = createMapperService(settings, mappings);\n+            DocumentMapper docMapper = mapperService.documentMapper();\n+            assertTrue(docMapper.sourceMapper().isSynthetic());\n+        }\n+        {\n+            final XContentBuilder mappings = topMapping(b -> {});\n+            final Settings settings = Settings.builder()\n+                .put(IndexSettings.MODE.getKey(), IndexMode.STANDARD.name())\n+                .put(SourceFieldMapper.INDEX_MAPPER_SOURCE_MODE_SETTING.getKey(), SourceFieldMapper.Mode.STORED)\n+                .build();\n+            final MapperService mapperService = createMapperService(settings, mappings);\n+            final DocumentMapper docMapper = mapperService.documentMapper();\n+            assertTrue(docMapper.sourceMapper().isStored());\n+        }\n+        {\n+            final XContentBuilder mappings = topMapping(b -> {});\n+            final Settings settings = Settings.builder()\n+                .put(IndexSettings.MODE.getKey(), IndexMode.STANDARD.name())\n+                .put(SourceFieldMapper.INDEX_MAPPER_SOURCE_MODE_SETTING.getKey(), SourceFieldMapper.Mode.DISABLED)\n+                .build();\n+            final MapperService mapperService = createMapperService(settings, mappings);\n+            final DocumentMapper docMapper = mapperService.documentMapper();\n+            assertTrue(docMapper.sourceMapper().isDisabled());\n+        }\n+\n+        // Test for IndexMode.LOGSDB\n+        {\n+            final XContentBuilder mappings = topMapping(b -> {});\n+            final Settings settings = Settings.builder()\n+                .put(IndexSettings.MODE.getKey(), IndexMode.LOGSDB.name())\n+                .put(SourceFieldMapper.INDEX_MAPPER_SOURCE_MODE_SETTING.getKey(), SourceFieldMapper.Mode.SYNTHETIC)\n+                .build();\n+            final MapperService mapperService = createMapperService(settings, mappings);\n+            DocumentMapper docMapper = mapperService.documentMapper();\n+            assertTrue(docMapper.sourceMapper().isSynthetic());\n+        }\n+        {\n+            final XContentBuilder mappings = topMapping(b -> {});\n+            final Settings settings = Settings.builder()\n+                .put(IndexSettings.MODE.getKey(), IndexMode.LOGSDB.name())\n+                .put(SourceFieldMapper.INDEX_MAPPER_SOURCE_MODE_SETTING.getKey(), SourceFieldMapper.Mode.STORED)\n+                .build();\n+            final MapperService mapperService = createMapperService(settings, mappings);\n+            final DocumentMapper docMapper = mapperService.documentMapper();\n+            assertTrue(docMapper.sourceMapper().isStored());\n+        }\n+        {\n+            final XContentBuilder mappings = topMapping(b -> {});\n+            final Settings settings = Settings.builder()\n+                .put(IndexSettings.MODE.getKey(), IndexMode.LOGSDB.name())\n+                .put(SourceFieldMapper.INDEX_MAPPER_SOURCE_MODE_SETTING.getKey(), SourceFieldMapper.Mode.DISABLED)\n+                .build();\n+            var ex = expectThrows(MapperParsingException.class, () -> createMapperService(settings, mappings));\n+            assertEquals(\"Failed to parse mapping: _source can not be disabled in index using [logsdb] index mode\", ex.getMessage());\n+        }\n+\n+        // Test for IndexMode.TIME_SERIES\n+        {\n+            final String mappings = \"\"\"\n+                    {\n+                        \"_doc\" : {\n+                            \"properties\": {\n+                                \"routing_field\": {\n+                                    \"type\": \"keyword\",\n+                                    \"time_series_dimension\": true\n+                                }\n+                            }\n+                        }\n+                    }\n+                \"\"\";\n+            final Settings settings = Settings.builder()\n+                .put(IndexSettings.MODE.getKey(), IndexMode.TIME_SERIES.name())\n+                .put(SourceFieldMapper.INDEX_MAPPER_SOURCE_MODE_SETTING.getKey(), SourceFieldMapper.Mode.SYNTHETIC)\n+                .put(IndexMetadata.INDEX_ROUTING_PATH.getKey(), \"routing_field\")\n+                .build();\n+            final MapperService mapperService = createMapperService(settings, mappings);\n+            DocumentMapper docMapper = mapperService.documentMapper();\n+            assertTrue(docMapper.sourceMapper().isSynthetic());\n+        }\n+        {\n+            final String mappings = \"\"\"\n+                    {\n+                        \"_doc\" : {\n+                            \"properties\": {\n+                                \"routing_field\": {\n+                                    \"type\": \"keyword\",\n+                                    \"time_series_dimension\": true\n+                                }\n+                            }\n+                        }\n+                    }\n+                \"\"\";\n+            final Settings settings = Settings.builder()\n+                .put(IndexSettings.MODE.getKey(), IndexMode.TIME_SERIES.name())\n+                .put(SourceFieldMapper.INDEX_MAPPER_SOURCE_MODE_SETTING.getKey(), SourceFieldMapper.Mode.STORED)\n+                .put(IndexMetadata.INDEX_ROUTING_PATH.getKey(), \"routing_field\")\n+                .build();\n+            final MapperService mapperService = createMapperService(settings, mappings);\n+            final DocumentMapper docMapper = mapperService.documentMapper();\n+            assertTrue(docMapper.sourceMapper().isStored());\n+        }\n+        {\n+            final String mappings = \"\"\"\n+                    {\n+                        \"_doc\" : {\n+                            \"properties\": {\n+                                \"routing_field\": {\n+                                    \"type\": \"keyword\",\n+                                    \"time_series_dimension\": true\n+                                }\n+                            }\n+                        }\n+                    }\n+                \"\"\";\n+            final Settings settings = Settings.builder()\n+                .put(IndexSettings.MODE.getKey(), IndexMode.TIME_SERIES.name())\n+                .put(SourceFieldMapper.INDEX_MAPPER_SOURCE_MODE_SETTING.getKey(), SourceFieldMapper.Mode.DISABLED)\n+                .put(IndexMetadata.INDEX_ROUTING_PATH.getKey(), \"routing_field\")\n+                .build();\n+            var ex = expectThrows(MapperParsingException.class, () -> createMapperService(settings, mappings));\n+            assertEquals(\"Failed to parse mapping: _source can not be disabled in index using [time_series] index mode\", ex.getMessage());\n+        }\n+\n+        // Test cases without IndexMode (default to standard)\n+        {\n+            final XContentBuilder mappings = topMapping(b -> {});\n+            final Settings settings = Settings.builder()\n+                .put(SourceFieldMapper.INDEX_MAPPER_SOURCE_MODE_SETTING.getKey(), SourceFieldMapper.Mode.SYNTHETIC)\n+                .build();\n+            final MapperService mapperService = createMapperService(settings, mappings);\n+            DocumentMapper docMapper = mapperService.documentMapper();\n+            assertTrue(docMapper.sourceMapper().isSynthetic());\n+        }\n+        {\n+            final XContentBuilder mappings = topMapping(b -> {});\n+            final Settings settings = Settings.builder()\n+                .put(SourceFieldMapper.INDEX_MAPPER_SOURCE_MODE_SETTING.getKey(), SourceFieldMapper.Mode.STORED)\n+                .build();\n+            final MapperService mapperService = createMapperService(settings, mappings);\n+            final DocumentMapper docMapper = mapperService.documentMapper();\n+            assertTrue(docMapper.sourceMapper().isStored());\n+        }\n+        {\n+            final XContentBuilder mappings = topMapping(b -> {});\n+            final Settings settings = Settings.builder()\n+                .put(SourceFieldMapper.INDEX_MAPPER_SOURCE_MODE_SETTING.getKey(), SourceFieldMapper.Mode.DISABLED)\n+                .build();\n+            final MapperService mapperService = createMapperService(settings, mappings);\n+            final DocumentMapper docMapper = mapperService.documentMapper();\n+            assertTrue(docMapper.sourceMapper().isDisabled());\n+        }\n+    }\n+\n     public void testRecoverySourceWithLogsCustom() throws IOException {\n         XContentBuilder mappings = topMapping(b -> b.startObject(SourceFieldMapper.NAME).field(\"mode\", \"synthetic\").endObject());\n         {\ndiff --git a/x-pack/plugin/logsdb/src/yamlRestTest/resources/rest-api-spec/test/40_source_mode_setting.yml b/x-pack/plugin/logsdb/src/yamlRestTest/resources/rest-api-spec/test/40_source_mode_setting.yml\nindex 4f885590695b..3d1a32a6bdcb 100644\n--- a/x-pack/plugin/logsdb/src/yamlRestTest/resources/rest-api-spec/test/40_source_mode_setting.yml\n+++ b/x-pack/plugin/logsdb/src/yamlRestTest/resources/rest-api-spec/test/40_source_mode_setting.yml\n@@ -559,7 +559,7 @@ create an index with time_series index mode and disabled source:\n                 time_series_dimension: true\n \n   - match: { error.type: \"mapper_parsing_exception\" }\n-  - match: { error.reason: \"Failed to parse mapping: _source cannot be disabled in index using [time_series] index mode\" }\n+  - match: { error.reason: \"Failed to parse mapping: _source can not be disabled in index using [time_series] index mode\" }\n \n ---\n create an index with logsdb index mode and disabled source:\n@@ -574,7 +574,7 @@ create an index with logsdb index mode and disabled source:\n               mapping.source.mode: disabled\n \n   - match: { error.type: \"mapper_parsing_exception\" }\n-  - match: { error.reason: \"Failed to parse mapping: _source cannot be disabled in index using [logsdb] index mode\" }\n+  - match: { error.reason: \"Failed to parse mapping: _source can not be disabled in index using [logsdb] index mode\" }\n \n ---\n modify final setting after index creation:",
  "judge_mode": "comparative",
  "judge_model": "openai/claude-sonnet-4-5-20250929",
  "test_label": "v0",
  "agent_results": [
    {
      "runner": "auggie",
      "model": "sonnet4.5",
      "edit_run_id": "a9463435",
      "status": "success",
      "elapsed_ms": 709197,
      "patch_unified": "diff --git a/server/src/main/java/org/elasticsearch/index/mapper/SourceFieldMapper.java b/server/src/main/java/org/elasticsearch/index/mapper/SourceFieldMapper.java\nindex 834a04f9..ea7fbfd8 100644\n--- a/server/src/main/java/org/elasticsearch/index/mapper/SourceFieldMapper.java\n+++ b/server/src/main/java/org/elasticsearch/index/mapper/SourceFieldMapper.java\n@@ -92,6 +92,42 @@ public class SourceFieldMapper extends MetadataFieldMapper {\n         true\n     );\n \n+    private static final SourceFieldMapper DEFAULT_DISABLED = new SourceFieldMapper(\n+        Mode.DISABLED,\n+        Explicit.IMPLICIT_TRUE,\n+        Strings.EMPTY_ARRAY,\n+        Strings.EMPTY_ARRAY,\n+        null,\n+        true\n+    );\n+\n+    private static final SourceFieldMapper DEFAULT_DISABLED_NO_RECOVERY_SOURCE = new SourceFieldMapper(\n+        Mode.DISABLED,\n+        Explicit.IMPLICIT_TRUE,\n+        Strings.EMPTY_ARRAY,\n+        Strings.EMPTY_ARRAY,\n+        null,\n+        false\n+    );\n+\n+    private static final SourceFieldMapper DEFAULT_SYNTHETIC = new SourceFieldMapper(\n+        Mode.SYNTHETIC,\n+        Explicit.IMPLICIT_TRUE,\n+        Strings.EMPTY_ARRAY,\n+        Strings.EMPTY_ARRAY,\n+        null,\n+        true\n+    );\n+\n+    private static final SourceFieldMapper DEFAULT_SYNTHETIC_NO_RECOVERY_SOURCE = new SourceFieldMapper(\n+        Mode.SYNTHETIC,\n+        Explicit.IMPLICIT_TRUE,\n+        Strings.EMPTY_ARRAY,\n+        Strings.EMPTY_ARRAY,\n+        null,\n+        false\n+    );\n+\n     private static final SourceFieldMapper DEFAULT_NO_RECOVERY_SOURCE = new SourceFieldMapper(\n         null,\n         Explicit.IMPLICIT_TRUE,\n@@ -301,7 +337,7 @@ public class SourceFieldMapper extends MetadataFieldMapper {\n                 ? INDEX_MAPPER_SOURCE_MODE_SETTING.get(settings)\n                 : mode.get();\n             if (isDefault(sourceMode)) {\n-                return resolveSourceMode(indexMode, sourceMode, enableRecoverySource);\n+                return resolveSourceMode(indexMode, sourceMode == null ? Mode.STORED : sourceMode, enableRecoverySource);\n \n             }\n             if (supportsNonDefaultParameterValues == false) {\n@@ -344,27 +380,38 @@ public class SourceFieldMapper extends MetadataFieldMapper {\n     }\n \n     private static SourceFieldMapper resolveSourceMode(final IndexMode indexMode, final Mode sourceMode, boolean enableRecoverySource) {\n-        if (indexMode == IndexMode.STANDARD) {\n-            return enableRecoverySource ? DEFAULT : DEFAULT_NO_RECOVERY_SOURCE;\n-        }\n-        final SourceFieldMapper syntheticWithoutRecoverySource = indexMode == IndexMode.TIME_SERIES\n-            ? TSDB_DEFAULT_NO_RECOVERY_SOURCE\n-            : LOGSDB_DEFAULT_NO_RECOVERY_SOURCE;\n-        final SourceFieldMapper syntheticWithRecoverySource = indexMode == IndexMode.TIME_SERIES ? TSDB_DEFAULT : LOGSDB_DEFAULT;\n-        final SourceFieldMapper storedWithoutRecoverySource = indexMode == IndexMode.TIME_SERIES\n-            ? TSDB_DEFAULT_NO_RECOVERY_SOURCE_STORED\n-            : LOGSDB_DEFAULT_NO_RECOVERY_SOURCE_STORED;\n-        final SourceFieldMapper storedWithRecoverySource = indexMode == IndexMode.TIME_SERIES ? TSDB_DEFAULT_STORED : LOGSDB_DEFAULT_STORED;\n-\n-        switch (sourceMode) {\n-            case SYNTHETIC:\n-                return enableRecoverySource ? syntheticWithRecoverySource : syntheticWithoutRecoverySource;\n-            case STORED:\n-                return enableRecoverySource ? storedWithRecoverySource : storedWithoutRecoverySource;\n-            case DISABLED:\n-                throw new IllegalArgumentException(\"_source cannot be disabled in index using [\" + indexMode + \"] index mode\");\n+        switch (indexMode) {\n+            case STANDARD:\n+                switch (sourceMode) {\n+                    case SYNTHETIC:\n+                        return enableRecoverySource ? DEFAULT_SYNTHETIC : DEFAULT_SYNTHETIC_NO_RECOVERY_SOURCE;\n+                    case STORED:\n+                        return enableRecoverySource ? DEFAULT : DEFAULT_NO_RECOVERY_SOURCE;\n+                    case DISABLED:\n+                        return enableRecoverySource ? DEFAULT_DISABLED : DEFAULT_DISABLED_NO_RECOVERY_SOURCE;\n+                    default:\n+                        throw new IllegalArgumentException(\"Unsupported source mode: \" + sourceMode);\n+                }\n+            case TIME_SERIES:\n+            case LOGSDB:\n+                switch (sourceMode) {\n+                    case SYNTHETIC:\n+                        return enableRecoverySource\n+                            ? (indexMode == IndexMode.TIME_SERIES ? TSDB_DEFAULT : LOGSDB_DEFAULT)\n+                            : (indexMode == IndexMode.TIME_SERIES ? TSDB_DEFAULT_NO_RECOVERY_SOURCE : LOGSDB_DEFAULT_NO_RECOVERY_SOURCE);\n+                    case STORED:\n+                        return enableRecoverySource\n+                            ? (indexMode == IndexMode.TIME_SERIES ? TSDB_DEFAULT_STORED : LOGSDB_DEFAULT_STORED)\n+                            : (indexMode == IndexMode.TIME_SERIES\n+                                ? TSDB_DEFAULT_NO_RECOVERY_SOURCE_STORED\n+                                : LOGSDB_DEFAULT_NO_RECOVERY_SOURCE_STORED);\n+                    case DISABLED:\n+                        throw new IllegalArgumentException(\"_source can not be disabled in index using [\" + indexMode + \"] index mode\");\n+                    default:\n+                        throw new IllegalArgumentException(\"Unsupported source mode: \" + sourceMode);\n+                }\n             default:\n-                throw new IllegalStateException(\"Unexpected value: \" + sourceMode);\n+                throw new IllegalArgumentException(\"Unsupported index mode: \" + indexMode);\n         }\n     }\n \n@@ -378,7 +425,7 @@ public class SourceFieldMapper extends MetadataFieldMapper {\n                 return enableRecoverySource ? TSDB_LEGACY_DEFAULT : TSDB_LEGACY_DEFAULT_NO_RECOVERY_SOURCE;\n             }\n         }\n-        return resolveSourceMode(indexMode, settingSourceMode, enableRecoverySource);\n+        return resolveSourceMode(indexMode, settingSourceMode == null ? Mode.STORED : settingSourceMode, enableRecoverySource);\n     },\n         c -> new Builder(\n             c.getIndexSettings().getMode(),\n@@ -548,4 +595,12 @@ public class SourceFieldMapper extends MetadataFieldMapper {\n     public boolean isSynthetic() {\n         return mode == Mode.SYNTHETIC;\n     }\n+\n+    public boolean isDisabled() {\n+        return mode == Mode.DISABLED;\n+    }\n+\n+    public boolean isStored() {\n+        return mode == null || mode == Mode.STORED;\n+    }\n }\ndiff --git a/server/src/test/java/org/elasticsearch/index/mapper/SourceFieldMapperTests.java b/server/src/test/java/org/elasticsearch/index/mapper/SourceFieldMapperTests.java\nindex 2f417e68..df6d9380 100644\n--- a/server/src/test/java/org/elasticsearch/index/mapper/SourceFieldMapperTests.java\n+++ b/server/src/test/java/org/elasticsearch/index/mapper/SourceFieldMapperTests.java\n@@ -443,6 +443,167 @@ public class SourceFieldMapperTests extends MetadataMapperTestCase {\n         }\n     }\n \n+    public void testStandardIndexModeWithSourceModeSetting() throws IOException {\n+        // Test for IndexMode.STANDARD\n+        {\n+            final XContentBuilder mappings = topMapping(b -> {});\n+            final Settings settings = Settings.builder()\n+                .put(IndexSettings.MODE.getKey(), IndexMode.STANDARD.name())\n+                .put(SourceFieldMapper.INDEX_MAPPER_SOURCE_MODE_SETTING.getKey(), SourceFieldMapper.Mode.SYNTHETIC)\n+                .build();\n+            final MapperService mapperService = createMapperService(settings, mappings);\n+            DocumentMapper docMapper = mapperService.documentMapper();\n+            assertTrue(docMapper.sourceMapper().isSynthetic());\n+        }\n+        {\n+            final XContentBuilder mappings = topMapping(b -> {});\n+            final Settings settings = Settings.builder()\n+                .put(IndexSettings.MODE.getKey(), IndexMode.STANDARD.name())\n+                .put(SourceFieldMapper.INDEX_MAPPER_SOURCE_MODE_SETTING.getKey(), SourceFieldMapper.Mode.STORED)\n+                .build();\n+            final MapperService mapperService = createMapperService(settings, mappings);\n+            final DocumentMapper docMapper = mapperService.documentMapper();\n+            assertTrue(docMapper.sourceMapper().isStored());\n+        }\n+        {\n+            final XContentBuilder mappings = topMapping(b -> {});\n+            final Settings settings = Settings.builder()\n+                .put(IndexSettings.MODE.getKey(), IndexMode.STANDARD.name())\n+                .put(SourceFieldMapper.INDEX_MAPPER_SOURCE_MODE_SETTING.getKey(), SourceFieldMapper.Mode.DISABLED)\n+                .build();\n+            final MapperService mapperService = createMapperService(settings, mappings);\n+            final DocumentMapper docMapper = mapperService.documentMapper();\n+            assertTrue(docMapper.sourceMapper().isDisabled());\n+        }\n+\n+        // Test for IndexMode.LOGSDB\n+        {\n+            final XContentBuilder mappings = topMapping(b -> {});\n+            final Settings settings = Settings.builder()\n+                .put(IndexSettings.MODE.getKey(), IndexMode.LOGSDB.name())\n+                .put(SourceFieldMapper.INDEX_MAPPER_SOURCE_MODE_SETTING.getKey(), SourceFieldMapper.Mode.SYNTHETIC)\n+                .build();\n+            final MapperService mapperService = createMapperService(settings, mappings);\n+            DocumentMapper docMapper = mapperService.documentMapper();\n+            assertTrue(docMapper.sourceMapper().isSynthetic());\n+        }\n+        {\n+            final XContentBuilder mappings = topMapping(b -> {});\n+            final Settings settings = Settings.builder()\n+                .put(IndexSettings.MODE.getKey(), IndexMode.LOGSDB.name())\n+                .put(SourceFieldMapper.INDEX_MAPPER_SOURCE_MODE_SETTING.getKey(), SourceFieldMapper.Mode.STORED)\n+                .build();\n+            final MapperService mapperService = createMapperService(settings, mappings);\n+            final DocumentMapper docMapper = mapperService.documentMapper();\n+            assertTrue(docMapper.sourceMapper().isStored());\n+        }\n+        {\n+            final XContentBuilder mappings = topMapping(b -> {});\n+            final Settings settings = Settings.builder()\n+                .put(IndexSettings.MODE.getKey(), IndexMode.LOGSDB.name())\n+                .put(SourceFieldMapper.INDEX_MAPPER_SOURCE_MODE_SETTING.getKey(), SourceFieldMapper.Mode.DISABLED)\n+                .build();\n+            var ex = expectThrows(MapperParsingException.class, () -> createMapperService(settings, mappings));\n+            assertEquals(\"Failed to parse mapping: _source can not be disabled in index using [logsdb] index mode\", ex.getMessage());\n+        }\n+\n+        // Test for IndexMode.TIME_SERIES\n+        {\n+            final String mappings = \"\"\"\n+                    {\n+                        \"_doc\" : {\n+                            \"properties\": {\n+                                \"routing_field\": {\n+                                    \"type\": \"keyword\",\n+                                    \"time_series_dimension\": true\n+                                }\n+                            }\n+                        }\n+                    }\n+                \"\"\";\n+            final Settings settings = Settings.builder()\n+                .put(IndexSettings.MODE.getKey(), IndexMode.TIME_SERIES.name())\n+                .put(SourceFieldMapper.INDEX_MAPPER_SOURCE_MODE_SETTING.getKey(), SourceFieldMapper.Mode.SYNTHETIC)\n+                .put(IndexMetadata.INDEX_ROUTING_PATH.getKey(), \"routing_field\")\n+                .build();\n+            final MapperService mapperService = createMapperService(settings, mappings);\n+            DocumentMapper docMapper = mapperService.documentMapper();\n+            assertTrue(docMapper.sourceMapper().isSynthetic());\n+        }\n+        {\n+            final String mappings = \"\"\"\n+                    {\n+                        \"_doc\" : {\n+                            \"properties\": {\n+                                \"routing_field\": {\n+                                    \"type\": \"keyword\",\n+                                    \"time_series_dimension\": true\n+                                }\n+                            }\n+                        }\n+                    }\n+                \"\"\";\n+            final Settings settings = Settings.builder()\n+                .put(IndexSettings.MODE.getKey(), IndexMode.TIME_SERIES.name())\n+                .put(SourceFieldMapper.INDEX_MAPPER_SOURCE_MODE_SETTING.getKey(), SourceFieldMapper.Mode.STORED)\n+                .put(IndexMetadata.INDEX_ROUTING_PATH.getKey(), \"routing_field\")\n+                .build();\n+            final MapperService mapperService = createMapperService(settings, mappings);\n+            final DocumentMapper docMapper = mapperService.documentMapper();\n+            assertTrue(docMapper.sourceMapper().isStored());\n+        }\n+        {\n+            final String mappings = \"\"\"\n+                    {\n+                        \"_doc\" : {\n+                            \"properties\": {\n+                                \"routing_field\": {\n+                                    \"type\": \"keyword\",\n+                                    \"time_series_dimension\": true\n+                                }\n+                            }\n+                        }\n+                    }\n+                \"\"\";\n+            final Settings settings = Settings.builder()\n+                .put(IndexSettings.MODE.getKey(), IndexMode.TIME_SERIES.name())\n+                .put(SourceFieldMapper.INDEX_MAPPER_SOURCE_MODE_SETTING.getKey(), SourceFieldMapper.Mode.DISABLED)\n+                .put(IndexMetadata.INDEX_ROUTING_PATH.getKey(), \"routing_field\")\n+                .build();\n+            var ex = expectThrows(MapperParsingException.class, () -> createMapperService(settings, mappings));\n+            assertEquals(\"Failed to parse mapping: _source can not be disabled in index using [time_series] index mode\", ex.getMessage());\n+        }\n+\n+        // Test cases without IndexMode (default to standard)\n+        {\n+            final XContentBuilder mappings = topMapping(b -> {});\n+            final Settings settings = Settings.builder()\n+                .put(SourceFieldMapper.INDEX_MAPPER_SOURCE_MODE_SETTING.getKey(), SourceFieldMapper.Mode.SYNTHETIC)\n+                .build();\n+            final MapperService mapperService = createMapperService(settings, mappings);\n+            DocumentMapper docMapper = mapperService.documentMapper();\n+            assertTrue(docMapper.sourceMapper().isSynthetic());\n+        }\n+        {\n+            final XContentBuilder mappings = topMapping(b -> {});\n+            final Settings settings = Settings.builder()\n+                .put(SourceFieldMapper.INDEX_MAPPER_SOURCE_MODE_SETTING.getKey(), SourceFieldMapper.Mode.STORED)\n+                .build();\n+            final MapperService mapperService = createMapperService(settings, mappings);\n+            final DocumentMapper docMapper = mapperService.documentMapper();\n+            assertTrue(docMapper.sourceMapper().isStored());\n+        }\n+        {\n+            final XContentBuilder mappings = topMapping(b -> {});\n+            final Settings settings = Settings.builder()\n+                .put(SourceFieldMapper.INDEX_MAPPER_SOURCE_MODE_SETTING.getKey(), SourceFieldMapper.Mode.DISABLED)\n+                .build();\n+            final MapperService mapperService = createMapperService(settings, mappings);\n+            final DocumentMapper docMapper = mapperService.documentMapper();\n+            assertTrue(docMapper.sourceMapper().isDisabled());\n+        }\n+    }\n+\n     public void testRecoverySourceWithLogsCustom() throws IOException {\n         XContentBuilder mappings = topMapping(b -> b.startObject(SourceFieldMapper.NAME).field(\"mode\", \"synthetic\").endObject());\n         {",
      "scores": {
        "correctness": 1.0,
        "completeness": 0.9,
        "code_reuse": 1.0,
        "best_practices": 1.0,
        "unsolicited_docs": 1.0
      },
      "aggregate": 0.9800000000000001,
      "rationale": "The agent's implementation is functionally correct and matches the ground truth almost perfectly. All core changes to SourceFieldMapper.java are present: added DEFAULT_DISABLED, DEFAULT_DISABLED_NO_RECOVERY_SOURCE, DEFAULT_SYNTHETIC, and DEFAULT_SYNTHETIC_NO_RECOVERY_SOURCE constants; refactored resolveSourceMode() to use nested switch statements for STANDARD, TIME_SERIES, and LOGSDB index modes; added null checks for sourceMode; added isDisabled() and isStored() helper methods; and updated error message from 'cannot' to 'can not'. The test file SourceFieldMapperTests.java is also correctly implemented with comprehensive test coverage. The only missing piece is the YAML test file update (40_source_mode_setting.yml) which updates error message assertions, but this is a minor omission that doesn't affect core functionality. The code follows best practices with proper switch statement structure, appropriate error handling, and clear test organization.",
      "llm_rating": 0.98,
      "llm_summary": "Agent correctly implemented all core changes to SourceFieldMapper.java including new constants for DISABLED and SYNTHETIC modes, refactored resolveSourceMode() with nested switch statements, added helper methods isDisabled() and isStored(), and created comprehensive tests in SourceFieldMapperTests.java, but omitted the YAML test file error message updates.",
      "errors": []
    },
    {
      "runner": "claude-code",
      "model": "claude-sonnet-4-5",
      "edit_run_id": "c7a3f90a",
      "status": "success",
      "elapsed_ms": 324635,
      "patch_unified": "diff --git a/modules/data-streams/src/javaRestTest/java/org/elasticsearch/datastreams/logsdb/LogsIndexModeCustomSettingsIT.java b/modules/data-streams/src/javaRestTest/java/org/elasticsearch/datastreams/logsdb/LogsIndexModeCustomSettingsIT.java\nindex 3a4d9e96..311e999f 100644\n--- a/modules/data-streams/src/javaRestTest/java/org/elasticsearch/datastreams/logsdb/LogsIndexModeCustomSettingsIT.java\n+++ b/modules/data-streams/src/javaRestTest/java/org/elasticsearch/datastreams/logsdb/LogsIndexModeCustomSettingsIT.java\n@@ -142,7 +142,7 @@ public class LogsIndexModeCustomSettingsIT extends LogsIndexModeRestTestIT {\n         Exception e = assertThrows(ResponseException.class, () -> putComponentTemplate(client, \"logs@custom\", storedSourceMapping));\n         assertThat(\n             e.getMessage(),\n-            containsString(\"Failed to parse mapping: _source can not be disabled in index using [logsdb] index mode\")\n+            containsString(\"Failed to parse mapping: _source cannot be disabled in index using [logsdb] index mode\")\n         );\n         assertThat(e.getMessage(), containsString(\"mapper_parsing_exception\"));\n     }\n@@ -167,7 +167,7 @@ public class LogsIndexModeCustomSettingsIT extends LogsIndexModeRestTestIT {\n         Exception e = assertThrows(ResponseException.class, () -> putComponentTemplate(client, \"logs@custom\", storedSourceMapping));\n         assertThat(\n             e.getMessage(),\n-            containsString(\"Failed to parse mapping: _source can not be disabled in index using [logsdb] index mode\")\n+            containsString(\"Failed to parse mapping: _source cannot be disabled in index using [logsdb] index mode\")\n         );\n         assertThat(e.getMessage(), containsString(\"mapper_parsing_exception\"));\n     }\n@@ -206,7 +206,7 @@ public class LogsIndexModeCustomSettingsIT extends LogsIndexModeRestTestIT {\n \n         assertOK(putComponentTemplate(client, \"logs@custom\", disabledModeMapping));\n         ResponseException e = expectThrows(ResponseException.class, () -> createDataStream(client, \"logs-custom-dev\"));\n-        assertThat(e.getMessage(), containsString(\"_source can not be disabled in index using [logsdb] index mode\"));\n+        assertThat(e.getMessage(), containsString(\"_source cannot be disabled in index using [logsdb] index mode\"));\n     }\n \n     public void testConfigureDisabledSourceModeWhenIndexIsCreated() throws IOException {\n@@ -223,7 +223,7 @@ public class LogsIndexModeCustomSettingsIT extends LogsIndexModeRestTestIT {\n \n         assertOK(putComponentTemplate(client, \"logs@custom\", disabledModeMapping));\n         ResponseException e = expectThrows(ResponseException.class, () -> createDataStream(client, \"logs-custom-dev\"));\n-        assertThat(e.getMessage(), containsString(\"_source can not be disabled in index using [logsdb] index mode\"));\n+        assertThat(e.getMessage(), containsString(\"_source cannot be disabled in index using [logsdb] index mode\"));\n     }\n \n     public void testOverrideIndexCodec() throws IOException {\ndiff --git a/rest-api-spec/src/yamlRestTest/resources/rest-api-spec/test/logsdb/20_source_mapping.yml b/rest-api-spec/src/yamlRestTest/resources/rest-api-spec/test/logsdb/20_source_mapping.yml\nindex 03c8def9..db1e0fcd 100644\n--- a/rest-api-spec/src/yamlRestTest/resources/rest-api-spec/test/logsdb/20_source_mapping.yml\n+++ b/rest-api-spec/src/yamlRestTest/resources/rest-api-spec/test/logsdb/20_source_mapping.yml\n@@ -40,7 +40,7 @@ disabled _source is not supported:\n \n   - match: { error.type: \"mapper_parsing_exception\" }\n   - match: { error.root_cause.0.type: \"mapper_parsing_exception\" }\n-  - match: { error.reason: \"Failed to parse mapping: _source can not be disabled in index using [logsdb] index mode\" }\n+  - match: { error.reason: \"Failed to parse mapping: _source cannot be disabled in index using [logsdb] index mode\" }\n \n   - do:\n       catch: bad_request\n@@ -56,4 +56,4 @@ disabled _source is not supported:\n \n   - match: { error.type: \"mapper_parsing_exception\" }\n   - match: { error.root_cause.0.type: \"mapper_parsing_exception\" }\n-  - match: { error.reason: \"Failed to parse mapping: _source can not be disabled in index using [logsdb] index mode\" }\n+  - match: { error.reason: \"Failed to parse mapping: _source cannot be disabled in index using [logsdb] index mode\" }\ndiff --git a/rest-api-spec/src/yamlRestTest/resources/rest-api-spec/test/tsdb/20_mapping.yml b/rest-api-spec/src/yamlRestTest/resources/rest-api-spec/test/tsdb/20_mapping.yml\nindex 6a59c7bf..8dd83ffd 100644\n--- a/rest-api-spec/src/yamlRestTest/resources/rest-api-spec/test/tsdb/20_mapping.yml\n+++ b/rest-api-spec/src/yamlRestTest/resources/rest-api-spec/test/tsdb/20_mapping.yml\n@@ -526,7 +526,7 @@ disabled source is not supported:\n \n   - match: { error.type: \"mapper_parsing_exception\" }\n   - match: { error.root_cause.0.type: \"mapper_parsing_exception\" }\n-  - match: { error.reason: \"Failed to parse mapping: _source can not be disabled in index using [time_series] index mode\" }\n+  - match: { error.reason: \"Failed to parse mapping: _source cannot be disabled in index using [time_series] index mode\" }\n \n ---\n source include/exclude:\ndiff --git a/server/src/main/java/org/elasticsearch/index/IndexMode.java b/server/src/main/java/org/elasticsearch/index/IndexMode.java\nindex 2d9e8922..ff743803 100644\n--- a/server/src/main/java/org/elasticsearch/index/IndexMode.java\n+++ b/server/src/main/java/org/elasticsearch/index/IndexMode.java\n@@ -218,7 +218,7 @@ public enum IndexMode {\n         @Override\n         public void validateSourceFieldMapper(SourceFieldMapper sourceFieldMapper) {\n             if (sourceFieldMapper.enabled() == false) {\n-                throw new IllegalArgumentException(\"_source can not be disabled in index using [\" + IndexMode.TIME_SERIES + \"] index mode\");\n+                throw new IllegalArgumentException(\"_source cannot be disabled in index using [\" + IndexMode.TIME_SERIES + \"] index mode\");\n             }\n         }\n \n@@ -293,7 +293,7 @@ public enum IndexMode {\n         @Override\n         public void validateSourceFieldMapper(SourceFieldMapper sourceFieldMapper) {\n             if (sourceFieldMapper.enabled() == false) {\n-                throw new IllegalArgumentException(\"_source can not be disabled in index using [\" + IndexMode.LOGSDB + \"] index mode\");\n+                throw new IllegalArgumentException(\"_source cannot be disabled in index using [\" + IndexMode.LOGSDB + \"] index mode\");\n             }\n         }\n \ndiff --git a/x-pack/plugin/logsdb/src/yamlRestTest/resources/rest-api-spec/test/40_source_mode_setting.yml b/x-pack/plugin/logsdb/src/yamlRestTest/resources/rest-api-spec/test/40_source_mode_setting.yml\nindex 4f885590..122337e1 100644\n--- a/x-pack/plugin/logsdb/src/yamlRestTest/resources/rest-api-spec/test/40_source_mode_setting.yml\n+++ b/x-pack/plugin/logsdb/src/yamlRestTest/resources/rest-api-spec/test/40_source_mode_setting.yml\n@@ -70,7 +70,7 @@ create an index with disabled source mode and logsdb index mode without setting:\n               mode: disabled\n \n   - match: { error.type: \"mapper_parsing_exception\" }\n-  - match: { error.reason: \"Failed to parse mapping: _source can not be disabled in index using [logsdb] index mode\" }\n+  - match: { error.reason: \"Failed to parse mapping: _source cannot be disabled in index using [logsdb] index mode\" }\n \n ---\n create an index with stored source mode and logsdb index mode without setting:\n@@ -133,7 +133,7 @@ create an index with disabled source mode and time series index mode without set\n                 time_series_dimension: true\n \n   - match: { error.type: \"mapper_parsing_exception\" }\n-  - match: { error.reason: \"Failed to parse mapping: _source can not be disabled in index using [time_series] index mode\" }\n+  - match: { error.reason: \"Failed to parse mapping: _source cannot be disabled in index using [time_series] index mode\" }\n \n ---\n create an index with stored source mode and time series index mode without setting:\n@@ -750,7 +750,7 @@ modify logsdb index source mode to disabled after index creation:\n           _source:\n             mode: disabled\n   - match: { error.type: \"mapper_parsing_exception\" }\n-  - match: { error.reason: \"Failed to parse mapping: _source can not be disabled in index using [logsdb] index mode\" }\n+  - match: { error.reason: \"Failed to parse mapping: _source cannot be disabled in index using [logsdb] index mode\" }\n \n ---\n modify logsdb index source mode to stored after index creation:\n@@ -799,7 +799,7 @@ modify time_series index source mode to disabled after index creation:\n           _source:\n             mode: disabled\n   - match: { error.type: \"mapper_parsing_exception\" }\n-  - match: { error.reason: \"Failed to parse mapping: _source can not be disabled in index using [time_series] index mode\" }\n+  - match: { error.reason: \"Failed to parse mapping: _source cannot be disabled in index using [time_series] index mode\" }\n \n ---\n modify time_series index source mode to stored after index creation:",
      "scores": {
        "correctness": -1.0,
        "completeness": -1.0,
        "code_reuse": 0.0,
        "best_practices": 0.0,
        "unsolicited_docs": 1.0
      },
      "aggregate": -0.2,
      "rationale": "The agent completely misunderstood the task. The ground truth implements new functionality to allow synthetic source and disabled source for standard indices by: (1) adding new DEFAULT_DISABLED, DEFAULT_SYNTHETIC constants and their no-recovery variants in SourceFieldMapper.java, (2) refactoring resolveSourceMode() to use nested switch statements supporting all three modes (SYNTHETIC, STORED, DISABLED) for STANDARD index mode, (3) adding helper methods isDisabled() and isStored(), and (4) adding comprehensive tests in SourceFieldMapperTests.java. Instead, the agent only changed error message text from 'can not' to 'cannot' across multiple test files and validation code. This is a trivial cosmetic change that doesn't implement any of the required functionality. The agent made no changes to SourceFieldMapper.java core logic, added no new constants, didn't refactor resolveSourceMode(), and didn't add the required test cases. This represents a complete failure to understand or implement the task.",
      "llm_rating": 0.0,
      "llm_summary": "Agent only changed error message text from 'can not' to 'cannot' in validation code and test files across IndexMode.java and YAML tests, completely missing the core SourceFieldMapper.java refactoring to support synthetic and disabled source modes for standard indices.",
      "errors": []
    },
    {
      "runner": "factory",
      "model": "claude-sonnet-4-5-20250929",
      "edit_run_id": "074538b9",
      "status": "success",
      "elapsed_ms": 444276,
      "patch_unified": "diff --git a/server/src/main/java/org/elasticsearch/index/mapper/SourceFieldMapper.java b/server/src/main/java/org/elasticsearch/index/mapper/SourceFieldMapper.java\nindex 834a04f9..063f5bb5 100644\n--- a/server/src/main/java/org/elasticsearch/index/mapper/SourceFieldMapper.java\n+++ b/server/src/main/java/org/elasticsearch/index/mapper/SourceFieldMapper.java\n@@ -101,6 +101,42 @@ public class SourceFieldMapper extends MetadataFieldMapper {\n         false\n     );\n \n+    private static final SourceFieldMapper DEFAULT_DISABLED = new SourceFieldMapper(\n+        Mode.DISABLED,\n+        Explicit.IMPLICIT_TRUE,\n+        Strings.EMPTY_ARRAY,\n+        Strings.EMPTY_ARRAY,\n+        null,\n+        true\n+    );\n+\n+    private static final SourceFieldMapper DEFAULT_DISABLED_NO_RECOVERY_SOURCE = new SourceFieldMapper(\n+        Mode.DISABLED,\n+        Explicit.IMPLICIT_TRUE,\n+        Strings.EMPTY_ARRAY,\n+        Strings.EMPTY_ARRAY,\n+        null,\n+        false\n+    );\n+\n+    private static final SourceFieldMapper DEFAULT_SYNTHETIC = new SourceFieldMapper(\n+        Mode.SYNTHETIC,\n+        Explicit.IMPLICIT_TRUE,\n+        Strings.EMPTY_ARRAY,\n+        Strings.EMPTY_ARRAY,\n+        null,\n+        true\n+    );\n+\n+    private static final SourceFieldMapper DEFAULT_SYNTHETIC_NO_RECOVERY_SOURCE = new SourceFieldMapper(\n+        Mode.SYNTHETIC,\n+        Explicit.IMPLICIT_TRUE,\n+        Strings.EMPTY_ARRAY,\n+        Strings.EMPTY_ARRAY,\n+        null,\n+        false\n+    );\n+\n     private static final SourceFieldMapper TSDB_DEFAULT = new SourceFieldMapper(\n         Mode.SYNTHETIC,\n         Explicit.IMPLICIT_TRUE,\n@@ -301,7 +337,7 @@ public class SourceFieldMapper extends MetadataFieldMapper {\n                 ? INDEX_MAPPER_SOURCE_MODE_SETTING.get(settings)\n                 : mode.get();\n             if (isDefault(sourceMode)) {\n-                return resolveSourceMode(indexMode, sourceMode, enableRecoverySource);\n+                return resolveSourceMode(indexMode, sourceMode == null ? Mode.STORED : sourceMode, enableRecoverySource);\n \n             }\n             if (supportsNonDefaultParameterValues == false) {\n@@ -344,27 +380,38 @@ public class SourceFieldMapper extends MetadataFieldMapper {\n     }\n \n     private static SourceFieldMapper resolveSourceMode(final IndexMode indexMode, final Mode sourceMode, boolean enableRecoverySource) {\n-        if (indexMode == IndexMode.STANDARD) {\n-            return enableRecoverySource ? DEFAULT : DEFAULT_NO_RECOVERY_SOURCE;\n-        }\n-        final SourceFieldMapper syntheticWithoutRecoverySource = indexMode == IndexMode.TIME_SERIES\n-            ? TSDB_DEFAULT_NO_RECOVERY_SOURCE\n-            : LOGSDB_DEFAULT_NO_RECOVERY_SOURCE;\n-        final SourceFieldMapper syntheticWithRecoverySource = indexMode == IndexMode.TIME_SERIES ? TSDB_DEFAULT : LOGSDB_DEFAULT;\n-        final SourceFieldMapper storedWithoutRecoverySource = indexMode == IndexMode.TIME_SERIES\n-            ? TSDB_DEFAULT_NO_RECOVERY_SOURCE_STORED\n-            : LOGSDB_DEFAULT_NO_RECOVERY_SOURCE_STORED;\n-        final SourceFieldMapper storedWithRecoverySource = indexMode == IndexMode.TIME_SERIES ? TSDB_DEFAULT_STORED : LOGSDB_DEFAULT_STORED;\n-\n-        switch (sourceMode) {\n-            case SYNTHETIC:\n-                return enableRecoverySource ? syntheticWithRecoverySource : syntheticWithoutRecoverySource;\n-            case STORED:\n-                return enableRecoverySource ? storedWithRecoverySource : storedWithoutRecoverySource;\n-            case DISABLED:\n-                throw new IllegalArgumentException(\"_source cannot be disabled in index using [\" + indexMode + \"] index mode\");\n+        switch (indexMode) {\n+            case STANDARD:\n+                switch (sourceMode) {\n+                    case SYNTHETIC:\n+                        return enableRecoverySource ? DEFAULT_SYNTHETIC : DEFAULT_SYNTHETIC_NO_RECOVERY_SOURCE;\n+                    case STORED:\n+                        return enableRecoverySource ? DEFAULT : DEFAULT_NO_RECOVERY_SOURCE;\n+                    case DISABLED:\n+                        return enableRecoverySource ? DEFAULT_DISABLED : DEFAULT_DISABLED_NO_RECOVERY_SOURCE;\n+                    default:\n+                        throw new IllegalArgumentException(\"Unsupported source mode: \" + sourceMode);\n+                }\n+            case TIME_SERIES:\n+            case LOGSDB:\n+                switch (sourceMode) {\n+                    case SYNTHETIC:\n+                        return enableRecoverySource\n+                            ? (indexMode == IndexMode.TIME_SERIES ? TSDB_DEFAULT : LOGSDB_DEFAULT)\n+                            : (indexMode == IndexMode.TIME_SERIES ? TSDB_DEFAULT_NO_RECOVERY_SOURCE : LOGSDB_DEFAULT_NO_RECOVERY_SOURCE);\n+                    case STORED:\n+                        return enableRecoverySource\n+                            ? (indexMode == IndexMode.TIME_SERIES ? TSDB_DEFAULT_STORED : LOGSDB_DEFAULT_STORED)\n+                            : (indexMode == IndexMode.TIME_SERIES\n+                                ? TSDB_DEFAULT_NO_RECOVERY_SOURCE_STORED\n+                                : LOGSDB_DEFAULT_NO_RECOVERY_SOURCE_STORED);\n+                    case DISABLED:\n+                        throw new IllegalArgumentException(\"_source cannot be disabled in index using [\" + indexMode + \"] index mode\");\n+                    default:\n+                        throw new IllegalArgumentException(\"Unsupported source mode: \" + sourceMode);\n+                }\n             default:\n-                throw new IllegalStateException(\"Unexpected value: \" + sourceMode);\n+                throw new IllegalArgumentException(\"Unsupported index mode: \" + indexMode);\n         }\n     }\n \n@@ -378,7 +425,7 @@ public class SourceFieldMapper extends MetadataFieldMapper {\n                 return enableRecoverySource ? TSDB_LEGACY_DEFAULT : TSDB_LEGACY_DEFAULT_NO_RECOVERY_SOURCE;\n             }\n         }\n-        return resolveSourceMode(indexMode, settingSourceMode, enableRecoverySource);\n+        return resolveSourceMode(indexMode, settingSourceMode == null ? Mode.STORED : settingSourceMode, enableRecoverySource);\n     },\n         c -> new Builder(\n             c.getIndexSettings().getMode(),\n@@ -548,4 +595,12 @@ public class SourceFieldMapper extends MetadataFieldMapper {\n     public boolean isSynthetic() {\n         return mode == Mode.SYNTHETIC;\n     }\n+\n+    public boolean isDisabled() {\n+        return mode == Mode.DISABLED;\n+    }\n+\n+    public boolean isStored() {\n+        return mode == null || mode == Mode.STORED;\n+    }\n }\ndiff --git a/server/src/test/java/org/elasticsearch/index/mapper/SourceFieldMapperTests.java b/server/src/test/java/org/elasticsearch/index/mapper/SourceFieldMapperTests.java\nindex 2f417e68..ce2bedd8 100644\n--- a/server/src/test/java/org/elasticsearch/index/mapper/SourceFieldMapperTests.java\n+++ b/server/src/test/java/org/elasticsearch/index/mapper/SourceFieldMapperTests.java\n@@ -443,6 +443,167 @@ public class SourceFieldMapperTests extends MetadataMapperTestCase {\n         }\n     }\n \n+    public void testStandardIndexModeWithSourceModeSetting() throws IOException {\n+        // Test for IndexMode.STANDARD\n+        {\n+            final XContentBuilder mappings = topMapping(b -> {});\n+            final Settings settings = Settings.builder()\n+                .put(IndexSettings.MODE.getKey(), IndexMode.STANDARD.name())\n+                .put(SourceFieldMapper.INDEX_MAPPER_SOURCE_MODE_SETTING.getKey(), SourceFieldMapper.Mode.SYNTHETIC)\n+                .build();\n+            final MapperService mapperService = createMapperService(settings, mappings);\n+            DocumentMapper docMapper = mapperService.documentMapper();\n+            assertTrue(docMapper.sourceMapper().isSynthetic());\n+        }\n+        {\n+            final XContentBuilder mappings = topMapping(b -> {});\n+            final Settings settings = Settings.builder()\n+                .put(IndexSettings.MODE.getKey(), IndexMode.STANDARD.name())\n+                .put(SourceFieldMapper.INDEX_MAPPER_SOURCE_MODE_SETTING.getKey(), SourceFieldMapper.Mode.STORED)\n+                .build();\n+            final MapperService mapperService = createMapperService(settings, mappings);\n+            final DocumentMapper docMapper = mapperService.documentMapper();\n+            assertTrue(docMapper.sourceMapper().isStored());\n+        }\n+        {\n+            final XContentBuilder mappings = topMapping(b -> {});\n+            final Settings settings = Settings.builder()\n+                .put(IndexSettings.MODE.getKey(), IndexMode.STANDARD.name())\n+                .put(SourceFieldMapper.INDEX_MAPPER_SOURCE_MODE_SETTING.getKey(), SourceFieldMapper.Mode.DISABLED)\n+                .build();\n+            final MapperService mapperService = createMapperService(settings, mappings);\n+            final DocumentMapper docMapper = mapperService.documentMapper();\n+            assertTrue(docMapper.sourceMapper().isDisabled());\n+        }\n+\n+        // Test for IndexMode.LOGSDB\n+        {\n+            final XContentBuilder mappings = topMapping(b -> {});\n+            final Settings settings = Settings.builder()\n+                .put(IndexSettings.MODE.getKey(), IndexMode.LOGSDB.name())\n+                .put(SourceFieldMapper.INDEX_MAPPER_SOURCE_MODE_SETTING.getKey(), SourceFieldMapper.Mode.SYNTHETIC)\n+                .build();\n+            final MapperService mapperService = createMapperService(settings, mappings);\n+            DocumentMapper docMapper = mapperService.documentMapper();\n+            assertTrue(docMapper.sourceMapper().isSynthetic());\n+        }\n+        {\n+            final XContentBuilder mappings = topMapping(b -> {});\n+            final Settings settings = Settings.builder()\n+                .put(IndexSettings.MODE.getKey(), IndexMode.LOGSDB.name())\n+                .put(SourceFieldMapper.INDEX_MAPPER_SOURCE_MODE_SETTING.getKey(), SourceFieldMapper.Mode.STORED)\n+                .build();\n+            final MapperService mapperService = createMapperService(settings, mappings);\n+            final DocumentMapper docMapper = mapperService.documentMapper();\n+            assertTrue(docMapper.sourceMapper().isStored());\n+        }\n+        {\n+            final XContentBuilder mappings = topMapping(b -> {});\n+            final Settings settings = Settings.builder()\n+                .put(IndexSettings.MODE.getKey(), IndexMode.LOGSDB.name())\n+                .put(SourceFieldMapper.INDEX_MAPPER_SOURCE_MODE_SETTING.getKey(), SourceFieldMapper.Mode.DISABLED)\n+                .build();\n+            var ex = expectThrows(MapperParsingException.class, () -> createMapperService(settings, mappings));\n+            assertEquals(\"Failed to parse mapping: _source cannot be disabled in index using [logsdb] index mode\", ex.getMessage());\n+        }\n+\n+        // Test for IndexMode.TIME_SERIES\n+        {\n+            final String mappings = \"\"\"\n+                    {\n+                        \"_doc\" : {\n+                            \"properties\": {\n+                                \"routing_field\": {\n+                                    \"type\": \"keyword\",\n+                                    \"time_series_dimension\": true\n+                                }\n+                            }\n+                        }\n+                    }\n+                \"\"\";\n+            final Settings settings = Settings.builder()\n+                .put(IndexSettings.MODE.getKey(), IndexMode.TIME_SERIES.name())\n+                .put(SourceFieldMapper.INDEX_MAPPER_SOURCE_MODE_SETTING.getKey(), SourceFieldMapper.Mode.SYNTHETIC)\n+                .put(IndexMetadata.INDEX_ROUTING_PATH.getKey(), \"routing_field\")\n+                .build();\n+            final MapperService mapperService = createMapperService(settings, mappings);\n+            DocumentMapper docMapper = mapperService.documentMapper();\n+            assertTrue(docMapper.sourceMapper().isSynthetic());\n+        }\n+        {\n+            final String mappings = \"\"\"\n+                    {\n+                        \"_doc\" : {\n+                            \"properties\": {\n+                                \"routing_field\": {\n+                                    \"type\": \"keyword\",\n+                                    \"time_series_dimension\": true\n+                                }\n+                            }\n+                        }\n+                    }\n+                \"\"\";\n+            final Settings settings = Settings.builder()\n+                .put(IndexSettings.MODE.getKey(), IndexMode.TIME_SERIES.name())\n+                .put(SourceFieldMapper.INDEX_MAPPER_SOURCE_MODE_SETTING.getKey(), SourceFieldMapper.Mode.STORED)\n+                .put(IndexMetadata.INDEX_ROUTING_PATH.getKey(), \"routing_field\")\n+                .build();\n+            final MapperService mapperService = createMapperService(settings, mappings);\n+            final DocumentMapper docMapper = mapperService.documentMapper();\n+            assertTrue(docMapper.sourceMapper().isStored());\n+        }\n+        {\n+            final String mappings = \"\"\"\n+                    {\n+                        \"_doc\" : {\n+                            \"properties\": {\n+                                \"routing_field\": {\n+                                    \"type\": \"keyword\",\n+                                    \"time_series_dimension\": true\n+                                }\n+                            }\n+                        }\n+                    }\n+                \"\"\";\n+            final Settings settings = Settings.builder()\n+                .put(IndexSettings.MODE.getKey(), IndexMode.TIME_SERIES.name())\n+                .put(SourceFieldMapper.INDEX_MAPPER_SOURCE_MODE_SETTING.getKey(), SourceFieldMapper.Mode.DISABLED)\n+                .put(IndexMetadata.INDEX_ROUTING_PATH.getKey(), \"routing_field\")\n+                .build();\n+            var ex = expectThrows(MapperParsingException.class, () -> createMapperService(settings, mappings));\n+            assertEquals(\"Failed to parse mapping: _source cannot be disabled in index using [time_series] index mode\", ex.getMessage());\n+        }\n+\n+        // Test cases without IndexMode (default to standard)\n+        {\n+            final XContentBuilder mappings = topMapping(b -> {});\n+            final Settings settings = Settings.builder()\n+                .put(SourceFieldMapper.INDEX_MAPPER_SOURCE_MODE_SETTING.getKey(), SourceFieldMapper.Mode.SYNTHETIC)\n+                .build();\n+            final MapperService mapperService = createMapperService(settings, mappings);\n+            DocumentMapper docMapper = mapperService.documentMapper();\n+            assertTrue(docMapper.sourceMapper().isSynthetic());\n+        }\n+        {\n+            final XContentBuilder mappings = topMapping(b -> {});\n+            final Settings settings = Settings.builder()\n+                .put(SourceFieldMapper.INDEX_MAPPER_SOURCE_MODE_SETTING.getKey(), SourceFieldMapper.Mode.STORED)\n+                .build();\n+            final MapperService mapperService = createMapperService(settings, mappings);\n+            final DocumentMapper docMapper = mapperService.documentMapper();\n+            assertTrue(docMapper.sourceMapper().isStored());\n+        }\n+        {\n+            final XContentBuilder mappings = topMapping(b -> {});\n+            final Settings settings = Settings.builder()\n+                .put(SourceFieldMapper.INDEX_MAPPER_SOURCE_MODE_SETTING.getKey(), SourceFieldMapper.Mode.DISABLED)\n+                .build();\n+            final MapperService mapperService = createMapperService(settings, mappings);\n+            final DocumentMapper docMapper = mapperService.documentMapper();\n+            assertTrue(docMapper.sourceMapper().isDisabled());\n+        }\n+    }\n+\n     public void testRecoverySourceWithLogsCustom() throws IOException {\n         XContentBuilder mappings = topMapping(b -> b.startObject(SourceFieldMapper.NAME).field(\"mode\", \"synthetic\").endObject());\n         {",
      "scores": {
        "correctness": 0.7,
        "completeness": 0.8,
        "code_reuse": 1.0,
        "best_practices": 0.9,
        "unsolicited_docs": 1.0
      },
      "aggregate": 0.8800000000000001,
      "rationale": "The agent successfully implemented most of the required changes: added DEFAULT_DISABLED, DEFAULT_DISABLED_NO_RECOVERY_SOURCE, DEFAULT_SYNTHETIC, and DEFAULT_SYNTHETIC_NO_RECOVERY_SOURCE constants, refactored resolveSourceMode to use nested switch statements for STANDARD/TIME_SERIES/LOGSDB index modes, added isDisabled() and isStored() helper methods, and included comprehensive test coverage. However, there are two critical differences from ground truth: (1) The error message uses 'cannot' instead of 'can not' in the DISABLED case for TIME_SERIES and LOGSDB modes, which causes test failures in the YAML REST tests that expect the exact message 'can not'. (2) The agent did not update the YAML test file to change the expected error message from 'cannot' to 'can not'. These message discrepancies would cause test failures, reducing correctness. The code structure and logic are otherwise sound and match the ground truth approach.",
      "llm_rating": 0.75,
      "llm_summary": "Agent added DEFAULT_DISABLED/DEFAULT_SYNTHETIC constants, refactored resolveSourceMode with nested switch statements, and added isDisabled/isStored methods, but used 'cannot' instead of 'can not' in error messages causing YAML test mismatches.",
      "errors": []
    }
  ],
  "comparative_analysis": {
    "summary": "auggie:sonnet4.5 and factory:claude-sonnet-4-5-20250929 both correctly implemented the core functionality to allow synthetic source and disabled source for standard indices, while claude-code:claude-sonnet-4-5 misunderstood the task and only updated error messages. auggie:sonnet4.5 achieved the highest score (0.98) with a perfect implementation matching the ground truth, while factory:claude-sonnet-4-5-20250929 scored 0.88 with minor placement differences in the constants.",
    "best_agent": "auggie:sonnet4.5",
    "best_agent_reasoning": "auggie:sonnet4.5 achieved a near-perfect score of 0.98 with 100% correctness and completeness scores. The implementation exactly matches the ground truth diff, adding the four new constants (DEFAULT_DISABLED, DEFAULT_DISABLED_NO_RECOVERY_SOURCE, DEFAULT_SYNTHETIC, DEFAULT_SYNTHETIC_NO_RECOVERY_SOURCE) in the correct location, properly handling the null sourceMode case, and restructuring the resolveSourceMode method with nested switch statements to support all three modes (SYNTHETIC, STORED, DISABLED) for STANDARD indices while maintaining existing behavior for TIME_SERIES and LOGSDB indices.",
    "approach_differences": "auggie:sonnet4.5 and factory:claude-sonnet-4-5-20250929 both correctly understood the task as a code refactoring to enable new source modes for standard indices, adding the necessary constants and restructuring the resolveSourceMode method. The main difference between them is that factory:claude-sonnet-4-5-20250929 placed the new constants after DEFAULT_NO_RECOVERY_SOURCE instead of immediately after the DEFAULT constant, which is a minor organizational difference. In stark contrast, claude-code:claude-sonnet-4-5 completely misinterpreted the task, treating it as a documentation/error message update task and only changing error message text from 'can not' to 'cannot' across test files without implementing any of the required functional changes.",
    "ranking": [
      "auggie:sonnet4.5",
      "factory:claude-sonnet-4-5-20250929",
      "claude-code:claude-sonnet-4-5"
    ]
  },
  "timestamp": "2025-11-06T21:40:08.762160",
  "analysis_run_id": "041de3b2"
}