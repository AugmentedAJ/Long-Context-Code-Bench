{
  "repo_url": "https://github.com/elastic/elasticsearch.git",
  "pr_number": 114881,
  "base_commit": "3bb20e39ab1bc094ff412602e3217be08f230631",
  "head_commit": "65d482dd8e65dabdf9d1f56e18465b550ec04e8d",
  "task_instructions": "You are working on a codebase. Your task is to make the necessary code changes to accomplish the following:\n\nHandle remaining refs to `RestApiVersion#V_7`\n\nRemoves several more references to the now-unused `RestApiVersion#V_7`\r\nconstant, and decorates all remaining references with an `@UpdateForV9`\r\nannotation so that they all have clear owners.\n\nPlease make all necessary code changes to complete this task.",
  "ground_truth_diff": "diff --git a/modules/percolator/src/main/java/org/elasticsearch/percolator/PercolateQueryBuilder.java b/modules/percolator/src/main/java/org/elasticsearch/percolator/PercolateQueryBuilder.java\nindex 6b37b02a945b..85af5b120f6f 100644\n--- a/modules/percolator/src/main/java/org/elasticsearch/percolator/PercolateQueryBuilder.java\n+++ b/modules/percolator/src/main/java/org/elasticsearch/percolator/PercolateQueryBuilder.java\n@@ -46,7 +46,6 @@ import org.elasticsearch.common.io.stream.StreamOutput;\n import org.elasticsearch.common.logging.DeprecationLogger;\n import org.elasticsearch.common.xcontent.LoggingDeprecationHandler;\n import org.elasticsearch.common.xcontent.XContentHelper;\n-import org.elasticsearch.core.RestApiVersion;\n import org.elasticsearch.index.IndexVersion;\n import org.elasticsearch.index.IndexVersions;\n import org.elasticsearch.index.fielddata.FieldDataContext;\n@@ -84,7 +83,6 @@ import java.util.Objects;\n import java.util.function.BiConsumer;\n import java.util.function.Supplier;\n \n-import static org.elasticsearch.core.RestApiVersion.equalTo;\n import static org.elasticsearch.search.SearchService.ALLOW_EXPENSIVE_QUERIES;\n import static org.elasticsearch.xcontent.ConstructingObjectParser.constructorArg;\n import static org.elasticsearch.xcontent.ConstructingObjectParser.optionalConstructorArg;\n@@ -368,14 +366,6 @@ public class PercolateQueryBuilder extends AbstractQueryBuilder<PercolateQueryBu\n             DOCUMENTS_FIELD.getPreferredName(),\n             INDEXED_DOCUMENT_FIELD_ID.getPreferredName()\n         );\n-        PARSER.declareString(\n-            deprecateAndIgnoreType(\"percolate_with_type\", TYPE_DEPRECATION_MESSAGE),\n-            INDEXED_DOCUMENT_FIELD_TYPE.forRestApiVersion(equalTo(RestApiVersion.V_7))\n-        );\n-        PARSER.declareString(\n-            deprecateAndIgnoreType(\"percolate_with_document_type\", DOCUMENT_TYPE_DEPRECATION_MESSAGE),\n-            DOCUMENT_TYPE_FIELD.forRestApiVersion(equalTo(RestApiVersion.V_7))\n-        );\n     }\n \n     private static BiConsumer<PercolateQueryBuilder, String> deprecateAndIgnoreType(String key, String message) {\ndiff --git a/server/src/main/java/org/elasticsearch/action/admin/indices/rollover/RolloverRequest.java b/server/src/main/java/org/elasticsearch/action/admin/indices/rollover/RolloverRequest.java\nindex fefc41317591..5a7f330be50c 100644\n--- a/server/src/main/java/org/elasticsearch/action/admin/indices/rollover/RolloverRequest.java\n+++ b/server/src/main/java/org/elasticsearch/action/admin/indices/rollover/RolloverRequest.java\n@@ -18,7 +18,6 @@ import org.elasticsearch.action.support.master.AcknowledgedRequest;\n import org.elasticsearch.cluster.metadata.DataStream;\n import org.elasticsearch.common.io.stream.StreamInput;\n import org.elasticsearch.common.io.stream.StreamOutput;\n-import org.elasticsearch.core.RestApiVersion;\n import org.elasticsearch.index.mapper.MapperService;\n import org.elasticsearch.tasks.CancellableTask;\n import org.elasticsearch.tasks.Task;\n@@ -57,19 +56,6 @@ public class RolloverRequest extends AcknowledgedRequest<RolloverRequest> implem\n             CreateIndexRequest.SETTINGS,\n             ObjectParser.ValueType.OBJECT\n         );\n-        PARSER.declareField((parser, request, context) -> {\n-            // a type is not included, add a dummy _doc type\n-            Map<String, Object> mappings = parser.map();\n-            if (MapperService.isMappingSourceTyped(MapperService.SINGLE_MAPPING_NAME, mappings)) {\n-                throw new IllegalArgumentException(\n-                    \"The mapping definition cannot be nested under a type \"\n-                        + \"[\"\n-                        + MapperService.SINGLE_MAPPING_NAME\n-                        + \"] unless include_type_name is set to true.\"\n-                );\n-            }\n-            request.createIndexRequest.mapping(mappings);\n-        }, CreateIndexRequest.MAPPINGS.forRestApiVersion(RestApiVersion.equalTo(RestApiVersion.V_7)), ObjectParser.ValueType.OBJECT);\n         PARSER.declareField((parser, request, context) -> {\n             // a type is not included, add a dummy _doc type\n             Map<String, Object> mappings = parser.map();\n@@ -78,7 +64,7 @@ public class RolloverRequest extends AcknowledgedRequest<RolloverRequest> implem\n                 throw new IllegalArgumentException(\"The mapping definition cannot be nested under a type\");\n             }\n             request.createIndexRequest.mapping(mappings);\n-        }, CreateIndexRequest.MAPPINGS.forRestApiVersion(RestApiVersion.onOrAfter(RestApiVersion.V_8)), ObjectParser.ValueType.OBJECT);\n+        }, CreateIndexRequest.MAPPINGS, ObjectParser.ValueType.OBJECT);\n \n         PARSER.declareField(\n             (parser, request, context) -> request.createIndexRequest.aliases(parser.map()),\ndiff --git a/server/src/main/java/org/elasticsearch/action/bulk/BulkRequestParser.java b/server/src/main/java/org/elasticsearch/action/bulk/BulkRequestParser.java\nindex cd74989e5df7..4c475bee985a 100644\n--- a/server/src/main/java/org/elasticsearch/action/bulk/BulkRequestParser.java\n+++ b/server/src/main/java/org/elasticsearch/action/bulk/BulkRequestParser.java\n@@ -22,7 +22,6 @@ import org.elasticsearch.core.RestApiVersion;\n import org.elasticsearch.core.UpdateForV9;\n import org.elasticsearch.index.VersionType;\n import org.elasticsearch.index.seqno.SequenceNumbers;\n-import org.elasticsearch.rest.action.document.RestBulkAction;\n import org.elasticsearch.search.fetch.subphase.FetchSourceContext;\n import org.elasticsearch.xcontent.ParseField;\n import org.elasticsearch.xcontent.XContent;\n@@ -271,18 +270,11 @@ public final class BulkRequestParser {\n                                 }\n                                 index = stringDeduplicator.computeIfAbsent(parser.text(), Function.identity());\n                             } else if (TYPE.match(currentFieldName, parser.getDeprecationHandler())) {\n-                                if (parser.getRestApiVersion().matches(RestApiVersion.equalTo(RestApiVersion.V_7))) {\n-                                    // for bigger bulks, deprecation throttling might not be enough\n-                                    if (deprecateOrErrorOnType && typesDeprecationLogged == false) {\n-                                        deprecationLogger.compatibleCritical(\"bulk_with_types\", RestBulkAction.TYPES_DEPRECATION_MESSAGE);\n-                                        typesDeprecationLogged = true;\n-                                    }\n-                                } else if (parser.getRestApiVersion().matches(RestApiVersion.onOrAfter(RestApiVersion.V_8))\n-                                    && deprecateOrErrorOnType) {\n-                                        throw new IllegalArgumentException(\n-                                            \"Action/metadata line [\" + line + \"] contains an unknown parameter [\" + currentFieldName + \"]\"\n-                                        );\n-                                    }\n+                                if (deprecateOrErrorOnType) {\n+                                    throw new IllegalArgumentException(\n+                                        \"Action/metadata line [\" + line + \"] contains an unknown parameter [\" + currentFieldName + \"]\"\n+                                    );\n+                                }\n                                 type = stringDeduplicator.computeIfAbsent(parser.text(), Function.identity());\n                             } else if (ID.match(currentFieldName, parser.getDeprecationHandler())) {\n                                 id = parser.text();\ndiff --git a/server/src/main/java/org/elasticsearch/cluster/metadata/IndexTemplateMetadata.java b/server/src/main/java/org/elasticsearch/cluster/metadata/IndexTemplateMetadata.java\nindex 6ddcd6a45e4b..1379489182b5 100644\n--- a/server/src/main/java/org/elasticsearch/cluster/metadata/IndexTemplateMetadata.java\n+++ b/server/src/main/java/org/elasticsearch/cluster/metadata/IndexTemplateMetadata.java\n@@ -35,9 +35,6 @@ import java.util.Map;\n import java.util.Objects;\n import java.util.Set;\n \n-import static org.elasticsearch.core.RestApiVersion.V_8;\n-import static org.elasticsearch.core.RestApiVersion.onOrAfter;\n-\n public class IndexTemplateMetadata implements SimpleDiffable<IndexTemplateMetadata> {\n \n     private final String name;\n@@ -379,9 +376,7 @@ public class IndexTemplateMetadata implements SimpleDiffable<IndexTemplateMetada\n             indexTemplateMetadata.settings().toXContent(builder, params);\n             builder.endObject();\n \n-            if (builder.getRestApiVersion().matches(onOrAfter(V_8))) {\n-                includeTypeName &= (params.paramAsBoolean(\"reduce_mappings\", false) == false);\n-            }\n+            includeTypeName &= (params.paramAsBoolean(\"reduce_mappings\", false) == false);\n \n             CompressedXContent m = indexTemplateMetadata.mappings();\n             if (m != null) {\ndiff --git a/server/src/main/java/org/elasticsearch/index/query/CommonTermsQueryBuilder.java b/server/src/main/java/org/elasticsearch/index/query/CommonTermsQueryBuilder.java\nindex 263c6bd35bcc..0b9663d9112f 100644\n--- a/server/src/main/java/org/elasticsearch/index/query/CommonTermsQueryBuilder.java\n+++ b/server/src/main/java/org/elasticsearch/index/query/CommonTermsQueryBuilder.java\n@@ -16,6 +16,7 @@ import org.elasticsearch.common.ParsingException;\n import org.elasticsearch.common.io.stream.StreamOutput;\n import org.elasticsearch.common.logging.DeprecationLogger;\n import org.elasticsearch.core.RestApiVersion;\n+import org.elasticsearch.core.UpdateForV9;\n import org.elasticsearch.xcontent.ParseField;\n import org.elasticsearch.xcontent.XContentBuilder;\n import org.elasticsearch.xcontent.XContentParser;\n@@ -27,6 +28,7 @@ public class CommonTermsQueryBuilder extends AbstractQueryBuilder<CommonTermsQue\n     public static final String COMMON_TERMS_QUERY_DEPRECATION_MSG = \"Common Terms Query usage is not supported. \"\n         + \"Use [match] query which can efficiently skip blocks of documents if the total number of hits is not tracked.\";\n \n+    @UpdateForV9(owner = UpdateForV9.Owner.SEARCH_RELEVANCE) // v7 REST API no longer exists: eliminate ref to RestApiVersion.V_7\n     public static ParseField NAME_V7 = new ParseField(\"common\").withAllDeprecated(COMMON_TERMS_QUERY_DEPRECATION_MSG)\n         .forRestApiVersion(RestApiVersion.equalTo(RestApiVersion.V_7));\n \ndiff --git a/server/src/main/java/org/elasticsearch/index/query/GeoBoundingBoxQueryBuilder.java b/server/src/main/java/org/elasticsearch/index/query/GeoBoundingBoxQueryBuilder.java\nindex 22cc68fb3a2f..7d773ce6c3fd 100644\n--- a/server/src/main/java/org/elasticsearch/index/query/GeoBoundingBoxQueryBuilder.java\n+++ b/server/src/main/java/org/elasticsearch/index/query/GeoBoundingBoxQueryBuilder.java\n@@ -24,7 +24,6 @@ import org.elasticsearch.common.geo.SpatialStrategy;\n import org.elasticsearch.common.io.stream.StreamInput;\n import org.elasticsearch.common.io.stream.StreamOutput;\n import org.elasticsearch.common.logging.DeprecationLogger;\n-import org.elasticsearch.core.RestApiVersion;\n import org.elasticsearch.geometry.Rectangle;\n import org.elasticsearch.geometry.utils.Geohash;\n import org.elasticsearch.index.mapper.GeoShapeQueryable;\n@@ -55,7 +54,6 @@ public class GeoBoundingBoxQueryBuilder extends AbstractQueryBuilder<GeoBounding\n      */\n     public static final boolean DEFAULT_IGNORE_UNMAPPED = false;\n \n-    private static final ParseField TYPE_FIELD = new ParseField(\"type\").forRestApiVersion(RestApiVersion.equalTo(RestApiVersion.V_7));\n     private static final ParseField VALIDATION_METHOD_FIELD = new ParseField(\"validation_method\");\n     private static final ParseField IGNORE_UNMAPPED_FIELD = new ParseField(\"ignore_unmapped\");\n \ndiff --git a/server/src/main/java/org/elasticsearch/index/query/MatchQueryBuilder.java b/server/src/main/java/org/elasticsearch/index/query/MatchQueryBuilder.java\nindex d72b755e7e77..fd704d39ca38 100644\n--- a/server/src/main/java/org/elasticsearch/index/query/MatchQueryBuilder.java\n+++ b/server/src/main/java/org/elasticsearch/index/query/MatchQueryBuilder.java\n@@ -20,7 +20,6 @@ import org.elasticsearch.common.io.stream.StreamOutput;\n import org.elasticsearch.common.lucene.search.Queries;\n import org.elasticsearch.common.unit.Fuzziness;\n import org.elasticsearch.common.xcontent.LoggingDeprecationHandler;\n-import org.elasticsearch.core.RestApiVersion;\n import org.elasticsearch.index.analysis.NamedAnalyzer;\n import org.elasticsearch.index.mapper.MappedFieldType;\n import org.elasticsearch.index.query.support.QueryParsers;\n@@ -37,11 +36,7 @@ import java.util.Objects;\n  * result of the analysis.\n  */\n public class MatchQueryBuilder extends AbstractQueryBuilder<MatchQueryBuilder> {\n-    private static final String CUTOFF_FREQUENCY_DEPRECATION_MSG = \"cutoff_freqency is not supported. \"\n-        + \"The [match] query can skip block of documents efficiently if the total number of hits is not tracked\";\n-    public static final ParseField CUTOFF_FREQUENCY_FIELD = new ParseField(\"cutoff_frequency\").withAllDeprecated(\n-        CUTOFF_FREQUENCY_DEPRECATION_MSG\n-    ).forRestApiVersion(RestApiVersion.equalTo(RestApiVersion.V_7));\n+\n     public static final ParseField ZERO_TERMS_QUERY_FIELD = new ParseField(\"zero_terms_query\");\n     public static final ParseField LENIENT_FIELD = new ParseField(\"lenient\");\n     public static final ParseField FUZZY_TRANSPOSITIONS_FIELD = new ParseField(\"fuzzy_transpositions\");\ndiff --git a/server/src/main/java/org/elasticsearch/index/query/MultiMatchQueryBuilder.java b/server/src/main/java/org/elasticsearch/index/query/MultiMatchQueryBuilder.java\nindex a83fb8d1fd41..17e651ab2469 100644\n--- a/server/src/main/java/org/elasticsearch/index/query/MultiMatchQueryBuilder.java\n+++ b/server/src/main/java/org/elasticsearch/index/query/MultiMatchQueryBuilder.java\n@@ -21,7 +21,6 @@ import org.elasticsearch.common.io.stream.StreamOutput;\n import org.elasticsearch.common.io.stream.Writeable;\n import org.elasticsearch.common.unit.Fuzziness;\n import org.elasticsearch.common.xcontent.LoggingDeprecationHandler;\n-import org.elasticsearch.core.RestApiVersion;\n import org.elasticsearch.index.query.support.QueryParsers;\n import org.elasticsearch.index.search.MatchQueryParser;\n import org.elasticsearch.index.search.MultiMatchQueryParser;\n@@ -45,11 +44,7 @@ import java.util.TreeMap;\n public final class MultiMatchQueryBuilder extends AbstractQueryBuilder<MultiMatchQueryBuilder> {\n \n     public static final String NAME = \"multi_match\";\n-    private static final String CUTOFF_FREQUENCY_DEPRECATION_MSG = \"cutoff_freqency is not supported.\"\n-        + \" The [multi_match] query can skip block of documents efficiently if the total number of hits is not tracked\";\n-    private static final ParseField CUTOFF_FREQUENCY_FIELD = new ParseField(\"cutoff_frequency\").withAllDeprecated(\n-        CUTOFF_FREQUENCY_DEPRECATION_MSG\n-    ).forRestApiVersion(RestApiVersion.equalTo(RestApiVersion.V_7));\n+\n     public static final MultiMatchQueryBuilder.Type DEFAULT_TYPE = MultiMatchQueryBuilder.Type.BEST_FIELDS;\n     public static final Operator DEFAULT_OPERATOR = Operator.OR;\n     public static final int DEFAULT_PHRASE_SLOP = MatchQueryParser.DEFAULT_PHRASE_SLOP;\ndiff --git a/server/src/main/java/org/elasticsearch/index/query/TypeQueryV7Builder.java b/server/src/main/java/org/elasticsearch/index/query/TypeQueryV7Builder.java\nindex f707684cb46e..c9aae0195acf 100644\n--- a/server/src/main/java/org/elasticsearch/index/query/TypeQueryV7Builder.java\n+++ b/server/src/main/java/org/elasticsearch/index/query/TypeQueryV7Builder.java\n@@ -18,6 +18,7 @@ import org.elasticsearch.common.io.stream.StreamInput;\n import org.elasticsearch.common.io.stream.StreamOutput;\n import org.elasticsearch.common.logging.DeprecationLogger;\n import org.elasticsearch.core.RestApiVersion;\n+import org.elasticsearch.core.UpdateForV9;\n import org.elasticsearch.index.mapper.MapperService;\n import org.elasticsearch.xcontent.ObjectParser;\n import org.elasticsearch.xcontent.ParseField;\n@@ -26,6 +27,7 @@ import org.elasticsearch.xcontent.XContentParser;\n \n import java.io.IOException;\n \n+@UpdateForV9(owner = UpdateForV9.Owner.SEARCH_RELEVANCE) // v7 REST API no longer exists: eliminate ref to RestApiVersion.V_7\n public class TypeQueryV7Builder extends AbstractQueryBuilder<TypeQueryV7Builder> {\n     private static final DeprecationLogger deprecationLogger = DeprecationLogger.getLogger(TypeQueryV7Builder.class);\n     public static final String TYPES_DEPRECATION_MESSAGE = \"[types removal] Type queries are deprecated, \"\ndiff --git a/server/src/main/java/org/elasticsearch/index/reindex/ReindexRequest.java b/server/src/main/java/org/elasticsearch/index/reindex/ReindexRequest.java\nindex b7ec486df612..f9d027e0c9c1 100644\n--- a/server/src/main/java/org/elasticsearch/index/reindex/ReindexRequest.java\n+++ b/server/src/main/java/org/elasticsearch/index/reindex/ReindexRequest.java\n@@ -20,8 +20,8 @@ import org.elasticsearch.common.io.stream.StreamOutput;\n import org.elasticsearch.common.lucene.uid.Versions;\n import org.elasticsearch.common.settings.SecureString;\n import org.elasticsearch.common.xcontent.XContentHelper;\n-import org.elasticsearch.core.RestApiVersion;\n import org.elasticsearch.core.TimeValue;\n+import org.elasticsearch.core.UpdateForV9;\n import org.elasticsearch.features.NodeFeature;\n import org.elasticsearch.index.VersionType;\n import org.elasticsearch.index.query.QueryBuilder;\n@@ -354,20 +354,10 @@ public class ReindexRequest extends AbstractBulkIndexByScrollRequest<ReindexRequ\n             ObjectParser.ValueType.OBJECT\n         );\n \n-        PARSER.declareInt(\n-            ReindexRequest::setMaxDocsValidateIdentical,\n-            new ParseField(\"max_docs\", \"size\").forRestApiVersion(RestApiVersion.equalTo(RestApiVersion.V_7))\n-        );\n+        PARSER.declareInt(ReindexRequest::setMaxDocsValidateIdentical, new ParseField(\"max_docs\"));\n \n-        PARSER.declareInt(\n-            ReindexRequest::setMaxDocsValidateIdentical,\n-            new ParseField(\"max_docs\").forRestApiVersion(RestApiVersion.onOrAfter(RestApiVersion.V_8))\n-        );\n         // avoid silently accepting an ignored size.\n-        PARSER.declareInt(\n-            (r, s) -> failOnSizeSpecified(),\n-            new ParseField(\"size\").forRestApiVersion(RestApiVersion.onOrAfter(RestApiVersion.V_8))\n-        );\n+        PARSER.declareInt((r, s) -> failOnSizeSpecified(), new ParseField(\"size\"));\n \n         PARSER.declareField((p, v, c) -> v.setScript(Script.parse(p)), new ParseField(\"script\"), ObjectParser.ValueType.OBJECT);\n         PARSER.declareString(ReindexRequest::setConflicts, new ParseField(\"conflicts\"));\n@@ -509,6 +499,8 @@ public class ReindexRequest extends AbstractBulkIndexByScrollRequest<ReindexRequ\n         }\n     }\n \n+    @UpdateForV9(owner = UpdateForV9.Owner.DISTRIBUTED_INDEXING)\n+    // do we still need this ref to [max_docs] or can we remove the field entirely so it's rejected with the default message?\n     private static void failOnSizeSpecified() {\n         throw new IllegalArgumentException(\"invalid parameter [size], use [max_docs] instead\");\n     }\ndiff --git a/server/src/main/java/org/elasticsearch/indices/TermsLookup.java b/server/src/main/java/org/elasticsearch/indices/TermsLookup.java\nindex b1c74c606df6..0bab521a984e 100644\n--- a/server/src/main/java/org/elasticsearch/indices/TermsLookup.java\n+++ b/server/src/main/java/org/elasticsearch/indices/TermsLookup.java\n@@ -13,7 +13,6 @@ import org.elasticsearch.TransportVersions;\n import org.elasticsearch.common.io.stream.StreamInput;\n import org.elasticsearch.common.io.stream.StreamOutput;\n import org.elasticsearch.common.io.stream.Writeable;\n-import org.elasticsearch.core.RestApiVersion;\n import org.elasticsearch.index.mapper.MapperService;\n import org.elasticsearch.index.query.TermsQueryBuilder;\n import org.elasticsearch.xcontent.ConstructingObjectParser;\n@@ -25,7 +24,6 @@ import org.elasticsearch.xcontent.XContentParser;\n import java.io.IOException;\n import java.util.Objects;\n \n-import static org.elasticsearch.core.RestApiVersion.equalTo;\n import static org.elasticsearch.xcontent.ConstructingObjectParser.constructorArg;\n \n /**\n@@ -109,7 +107,6 @@ public class TermsLookup implements Writeable, ToXContentFragment {\n         PARSER.declareString(constructorArg(), new ParseField(\"id\"));\n         PARSER.declareString(constructorArg(), new ParseField(\"path\"));\n         PARSER.declareString(TermsLookup::routing, new ParseField(\"routing\"));\n-        PARSER.declareString((termLookup, type) -> {}, new ParseField(\"type\").forRestApiVersion(equalTo(RestApiVersion.V_7)));\n     }\n \n     public static TermsLookup parseTermsLookup(XContentParser parser) throws IOException {\ndiff --git a/server/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestClusterRerouteAction.java b/server/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestClusterRerouteAction.java\nindex fada07d60b74..970733b36f7f 100644\n--- a/server/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestClusterRerouteAction.java\n+++ b/server/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestClusterRerouteAction.java\n@@ -19,6 +19,7 @@ import org.elasticsearch.common.logging.DeprecationCategory;\n import org.elasticsearch.common.logging.DeprecationLogger;\n import org.elasticsearch.common.settings.Settings;\n import org.elasticsearch.common.settings.SettingsFilter;\n+import org.elasticsearch.core.RestApiVersion;\n import org.elasticsearch.core.UpdateForV10;\n import org.elasticsearch.rest.BaseRestHandler;\n import org.elasticsearch.rest.RestRequest;\n@@ -95,20 +96,19 @@ public class RestClusterRerouteAction extends BaseRestHandler {\n             request.params().put(\"explain\", Boolean.TRUE.toString());\n         }\n \n-        switch (request.getRestApiVersion()) {\n-            case V_9 -> {\n-                // always avoid returning the cluster state by forcing `?metric=none`; emit a warning if `?metric` is even present\n-                if (request.hasParam(\"metric\")) {\n-                    deprecationLogger.critical(DeprecationCategory.API, \"cluster-reroute-metric-param\", METRIC_DEPRECATION_MESSAGE);\n-                }\n-                request.params().put(\"metric\", \"none\");\n+        if (request.getRestApiVersion().matches(RestApiVersion.onOrAfter(RestApiVersion.V_9))) {\n+            // always avoid returning the cluster state by forcing `?metric=none`; emit a warning if `?metric` is even present\n+            if (request.hasParam(\"metric\")) {\n+                deprecationLogger.critical(DeprecationCategory.API, \"cluster-reroute-metric-param\", METRIC_DEPRECATION_MESSAGE);\n             }\n-            case V_8, V_7 -> {\n-                // by default, return everything but metadata\n-                final String metric = request.param(\"metric\");\n-                if (metric == null) {\n-                    request.params().put(\"metric\", V8_DEFAULT_METRICS);\n-                }\n+            request.params().put(\"metric\", \"none\");\n+        } else {\n+            assert request.getRestApiVersion().matches(RestApiVersion.equalTo(RestApiVersion.V_8));\n+            @UpdateForV10(owner = UpdateForV10.Owner.DISTRIBUTED_COORDINATION) // forbid this parameter in the v10 API\n+            // by default, return everything but metadata\n+            final String metric = request.param(\"metric\");\n+            if (metric == null) {\n+                request.params().put(\"metric\", V8_DEFAULT_METRICS);\n             }\n         }\n \n@@ -117,6 +117,7 @@ public class RestClusterRerouteAction extends BaseRestHandler {\n             clusterRerouteRequest,\n             new RestRefCountedChunkedToXContentListener<>(channel)\n         );\n+\n     }\n \n     @Override\ndiff --git a/server/src/main/java/org/elasticsearch/rest/action/admin/indices/RestGetAliasesAction.java b/server/src/main/java/org/elasticsearch/rest/action/admin/indices/RestGetAliasesAction.java\nindex 79e5c574d93b..7780ae08ac0f 100644\n--- a/server/src/main/java/org/elasticsearch/rest/action/admin/indices/RestGetAliasesAction.java\n+++ b/server/src/main/java/org/elasticsearch/rest/action/admin/indices/RestGetAliasesAction.java\n@@ -199,6 +199,8 @@ public class RestGetAliasesAction extends BaseRestHandler {\n     }\n \n     @Override\n+    @UpdateForV9(owner = UpdateForV9.Owner.DATA_MANAGEMENT)\n+    // v7 REST API no longer exists: eliminate ref to RestApiVersion.V_7; reject local parameter in v9 too?\n     public RestChannelConsumer prepareRequest(final RestRequest request, final NodeClient client) throws IOException {\n         // The TransportGetAliasesAction was improved do the same post processing as is happening here.\n         // We can't remove this logic yet to support mixed clusters. We should be able to remove this logic here\ndiff --git a/server/src/main/java/org/elasticsearch/rest/action/admin/indices/RestPutIndexTemplateAction.java b/server/src/main/java/org/elasticsearch/rest/action/admin/indices/RestPutIndexTemplateAction.java\nindex defec2fefc61..592679a2a02a 100644\n--- a/server/src/main/java/org/elasticsearch/rest/action/admin/indices/RestPutIndexTemplateAction.java\n+++ b/server/src/main/java/org/elasticsearch/rest/action/admin/indices/RestPutIndexTemplateAction.java\n@@ -12,9 +12,7 @@ package org.elasticsearch.rest.action.admin.indices;\n import org.elasticsearch.action.admin.indices.template.put.PutIndexTemplateRequest;\n import org.elasticsearch.client.internal.node.NodeClient;\n import org.elasticsearch.common.Strings;\n-import org.elasticsearch.common.logging.DeprecationLogger;\n import org.elasticsearch.common.xcontent.XContentHelper;\n-import org.elasticsearch.core.RestApiVersion;\n import org.elasticsearch.rest.BaseRestHandler;\n import org.elasticsearch.rest.RestRequest;\n import org.elasticsearch.rest.action.RestToXContentListener;\n@@ -30,12 +28,7 @@ import static org.elasticsearch.rest.action.admin.indices.RestCreateIndexAction.\n \n public class RestPutIndexTemplateAction extends BaseRestHandler {\n \n-    private static final DeprecationLogger deprecationLogger = DeprecationLogger.getLogger(RestPutIndexTemplateAction.class);\n     public static final String DEPRECATION_WARNING = \"Legacy index templates are deprecated in favor of composable templates.\";\n-    private static final RestApiVersion DEPRECATION_VERSION = RestApiVersion.V_8;\n-    public static final String TYPES_DEPRECATION_MESSAGE = \"[types removal]\"\n-        + \" Specifying include_type_name in put index template requests is deprecated.\"\n-        + \" The parameter will be removed in the next major version.\";\n \n     @Override\n     public List<Route> routes() {\ndiff --git a/server/src/main/java/org/elasticsearch/rest/action/cat/RestAliasAction.java b/server/src/main/java/org/elasticsearch/rest/action/cat/RestAliasAction.java\nindex 0957821ef553..191746b421c9 100644\n--- a/server/src/main/java/org/elasticsearch/rest/action/cat/RestAliasAction.java\n+++ b/server/src/main/java/org/elasticsearch/rest/action/cat/RestAliasAction.java\n@@ -18,6 +18,7 @@ import org.elasticsearch.common.Table;\n import org.elasticsearch.common.logging.DeprecationCategory;\n import org.elasticsearch.common.logging.DeprecationLogger;\n import org.elasticsearch.core.RestApiVersion;\n+import org.elasticsearch.core.UpdateForV9;\n import org.elasticsearch.rest.RestRequest;\n import org.elasticsearch.rest.RestResponse;\n import org.elasticsearch.rest.Scope;\n@@ -51,6 +52,8 @@ public class RestAliasAction extends AbstractCatAction {\n     }\n \n     @Override\n+    @UpdateForV9(owner = UpdateForV9.Owner.DATA_MANAGEMENT)\n+    // v7 REST API no longer exists: eliminate ref to RestApiVersion.V_7; reject local parameter in v9 too?\n     protected RestChannelConsumer doCatRequest(final RestRequest request, final NodeClient client) {\n         final GetAliasesRequest getAliasesRequest = request.hasParam(\"alias\")\n             ? new GetAliasesRequest(Strings.commaDelimitedListToStringArray(request.param(\"alias\")))\ndiff --git a/server/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateIntervalWrapper.java b/server/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateIntervalWrapper.java\nindex 6f03f9e5952c..6886b0e22c20 100644\n--- a/server/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateIntervalWrapper.java\n+++ b/server/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateIntervalWrapper.java\n@@ -15,22 +15,17 @@ import org.elasticsearch.common.Strings;\n import org.elasticsearch.common.io.stream.StreamInput;\n import org.elasticsearch.common.io.stream.StreamOutput;\n import org.elasticsearch.common.io.stream.Writeable;\n-import org.elasticsearch.common.logging.DeprecationCategory;\n import org.elasticsearch.common.logging.DeprecationLogger;\n-import org.elasticsearch.core.RestApiVersion;\n import org.elasticsearch.core.TimeValue;\n import org.elasticsearch.xcontent.ObjectParser;\n import org.elasticsearch.xcontent.ParseField;\n import org.elasticsearch.xcontent.ToXContentFragment;\n import org.elasticsearch.xcontent.XContentBuilder;\n-import org.elasticsearch.xcontent.XContentParser;\n \n import java.io.IOException;\n import java.time.ZoneId;\n import java.util.Objects;\n \n-import static org.elasticsearch.core.RestApiVersion.equalTo;\n-\n /**\n  * A class that handles all the parsing, bwc and deprecations surrounding date histogram intervals.\n  *\n@@ -91,29 +86,6 @@ public class DateIntervalWrapper implements ToXContentFragment, Writeable {\n     private IntervalTypeEnum intervalType = IntervalTypeEnum.NONE;\n \n     public static <T extends DateIntervalConsumer<T>> void declareIntervalFields(ObjectParser<T, String> parser) {\n-        /*\n-         REST version compatibility.  When in V_7 compatibility mode, continue to parse the old style interval parameter,\n-         but immediately adapt it into either fixed or calendar interval.\n-         */\n-        parser.declareField((wrapper, interval) -> {\n-            DEPRECATION_LOGGER.warn(DeprecationCategory.AGGREGATIONS, \"date-interval-getter\", DEPRECATION_TEXT);\n-            if (interval instanceof Long) {\n-                wrapper.fixedInterval(new DateHistogramInterval(interval + \"ms\"));\n-            } else {\n-                if (interval != null && DateHistogramAggregationBuilder.DATE_FIELD_UNITS.containsKey(interval.toString())) {\n-                    wrapper.calendarInterval((DateHistogramInterval) interval);\n-                } else {\n-                    wrapper.fixedInterval((DateHistogramInterval) interval);\n-                }\n-            }\n-        }, p -> {\n-            if (p.currentToken() == XContentParser.Token.VALUE_NUMBER) {\n-                return p.longValue();\n-            } else {\n-                return new DateHistogramInterval(p.text());\n-            }\n-        }, Histogram.INTERVAL_FIELD.forRestApiVersion(equalTo(RestApiVersion.V_7)), ObjectParser.ValueType.LONG);\n-\n         parser.declareField(\n             DateIntervalConsumer::calendarInterval,\n             p -> new DateHistogramInterval(p.text()),\ndiff --git a/server/src/main/java/org/elasticsearch/search/fetch/subphase/FieldAndFormat.java b/server/src/main/java/org/elasticsearch/search/fetch/subphase/FieldAndFormat.java\nindex 719729f6787a..f623b3040f1c 100644\n--- a/server/src/main/java/org/elasticsearch/search/fetch/subphase/FieldAndFormat.java\n+++ b/server/src/main/java/org/elasticsearch/search/fetch/subphase/FieldAndFormat.java\n@@ -15,9 +15,7 @@ import org.elasticsearch.common.io.stream.Writeable;\n import org.elasticsearch.common.logging.DeprecationLogger;\n import org.elasticsearch.core.CheckedFunction;\n import org.elasticsearch.core.Nullable;\n-import org.elasticsearch.core.RestApiVersion;\n import org.elasticsearch.xcontent.ConstructingObjectParser;\n-import org.elasticsearch.xcontent.ObjectParser;\n import org.elasticsearch.xcontent.ParseField;\n import org.elasticsearch.xcontent.ToXContentObject;\n import org.elasticsearch.xcontent.XContent;\n@@ -27,9 +25,6 @@ import org.elasticsearch.xcontent.XContentParser;\n import java.io.IOException;\n import java.util.Objects;\n \n-import static org.elasticsearch.core.RestApiVersion.equalTo;\n-import static org.elasticsearch.core.RestApiVersion.onOrAfter;\n-\n /**\n  * Wrapper around a field name and the format that should be used to\n  * display values of this field.\n@@ -49,16 +44,7 @@ public final class FieldAndFormat implements Writeable, ToXContentObject {\n \n     static {\n         PARSER.declareString(ConstructingObjectParser.constructorArg(), FIELD_FIELD);\n-        PARSER.declareStringOrNull(\n-            ConstructingObjectParser.optionalConstructorArg(),\n-            FORMAT_FIELD.forRestApiVersion(onOrAfter(RestApiVersion.V_8))\n-        );\n-        PARSER.declareField(\n-            ConstructingObjectParser.optionalConstructorArg(),\n-            ignoreUseFieldMappingStringParser(),\n-            FORMAT_FIELD.forRestApiVersion(equalTo(RestApiVersion.V_7)),\n-            ObjectParser.ValueType.STRING_OR_NULL\n-        );\n+        PARSER.declareStringOrNull(ConstructingObjectParser.optionalConstructorArg(), FORMAT_FIELD);\n         PARSER.declareBoolean(ConstructingObjectParser.optionalConstructorArg(), INCLUDE_UNMAPPED_FIELD);\n     }\n \ndiff --git a/server/src/main/java/org/elasticsearch/search/sort/SortBuilder.java b/server/src/main/java/org/elasticsearch/search/sort/SortBuilder.java\nindex 9f943e63ef1e..0ac3b42dd5b1 100644\n--- a/server/src/main/java/org/elasticsearch/search/sort/SortBuilder.java\n+++ b/server/src/main/java/org/elasticsearch/search/sort/SortBuilder.java\n@@ -19,6 +19,7 @@ import org.elasticsearch.common.io.stream.VersionedNamedWriteable;\n import org.elasticsearch.common.lucene.search.Queries;\n import org.elasticsearch.common.util.BigArrays;\n import org.elasticsearch.core.RestApiVersion;\n+import org.elasticsearch.core.UpdateForV9;\n import org.elasticsearch.index.fielddata.IndexFieldData.XFieldComparatorSource.Nested;\n import org.elasticsearch.index.mapper.NestedObjectMapper;\n import org.elasticsearch.index.query.QueryBuilder;\n@@ -50,6 +51,8 @@ public abstract class SortBuilder<T extends SortBuilder<T>>\n \n     // parse fields common to more than one SortBuilder\n     public static final ParseField ORDER_FIELD = new ParseField(\"order\");\n+\n+    @UpdateForV9(owner = UpdateForV9.Owner.SEARCH_FOUNDATIONS) // v7 REST API no longer exists: eliminate ref to RestApiVersion.V_7\n     public static final ParseField NESTED_FILTER_FIELD = new ParseField(\"nested_filter\").withAllDeprecated()\n         .forRestApiVersion(RestApiVersion.equalTo(RestApiVersion.V_7));\n     public static final ParseField NESTED_PATH_FIELD = new ParseField(\"nested_path\").withAllDeprecated()\ndiff --git a/x-pack/plugin/core/src/main/java/org/elasticsearch/license/License.java b/x-pack/plugin/core/src/main/java/org/elasticsearch/license/License.java\nindex 0d1a007db0d3..f280dcf9b3ed 100644\n--- a/x-pack/plugin/core/src/main/java/org/elasticsearch/license/License.java\n+++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/license/License.java\n@@ -16,6 +16,7 @@ import org.elasticsearch.common.io.stream.StreamOutput;\n import org.elasticsearch.common.xcontent.LoggingDeprecationHandler;\n import org.elasticsearch.common.xcontent.XContentHelper;\n import org.elasticsearch.core.RestApiVersion;\n+import org.elasticsearch.core.UpdateForV9;\n import org.elasticsearch.features.NodeFeature;\n import org.elasticsearch.xcontent.ToXContentObject;\n import org.elasticsearch.xcontent.XContentBuilder;\n@@ -145,6 +146,7 @@ public class License implements ToXContentObject {\n      * XContent param name to map the \"enterprise\" license type to \"platinum\"\n      * for backwards compatibility with older clients\n      */\n+    @UpdateForV9(owner = UpdateForV9.Owner.SECURITY) // v7 REST API no longer exists: eliminate ref to RestApiVersion.V_7\n     public static final String XCONTENT_HIDE_ENTERPRISE = \"hide_enterprise\";\n \n     public static final Comparator<License> LATEST_ISSUE_DATE_FIRST = Comparator.comparing(License::issueDate).reversed();\ndiff --git a/x-pack/plugin/core/src/main/java/org/elasticsearch/license/RestGetLicenseAction.java b/x-pack/plugin/core/src/main/java/org/elasticsearch/license/RestGetLicenseAction.java\nindex baec74814190..92e46e3ea656 100644\n--- a/x-pack/plugin/core/src/main/java/org/elasticsearch/license/RestGetLicenseAction.java\n+++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/license/RestGetLicenseAction.java\n@@ -27,8 +27,6 @@ import java.io.IOException;\n import java.util.List;\n import java.util.Map;\n \n-import static org.elasticsearch.core.RestApiVersion.V_8;\n-import static org.elasticsearch.core.RestApiVersion.onOrAfter;\n import static org.elasticsearch.rest.RestRequest.Method.GET;\n import static org.elasticsearch.rest.RestStatus.NOT_FOUND;\n import static org.elasticsearch.rest.RestStatus.OK;\n@@ -72,7 +70,7 @@ public class RestGetLicenseAction extends BaseRestHandler {\n                 \"Including [accept_enterprise] in get license requests is deprecated.\"\n                     + \" The parameter will be removed in the next major version\"\n             );\n-            if (request.paramAsBoolean(\"accept_enterprise\", true) == false && request.getRestApiVersion().matches(onOrAfter(V_8))) {\n+            if (request.paramAsBoolean(\"accept_enterprise\", true) == false) {\n                 throw new IllegalArgumentException(\"The [accept_enterprise] parameters may not be false\");\n             }\n         }\ndiff --git a/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/CloseJobAction.java b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/CloseJobAction.java\nindex ca81509920ca..bddae0417e46 100644\n--- a/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/CloseJobAction.java\n+++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/CloseJobAction.java\n@@ -14,6 +14,7 @@ import org.elasticsearch.common.io.stream.StreamOutput;\n import org.elasticsearch.common.io.stream.Writeable;\n import org.elasticsearch.core.RestApiVersion;\n import org.elasticsearch.core.TimeValue;\n+import org.elasticsearch.core.UpdateForV9;\n import org.elasticsearch.tasks.Task;\n import org.elasticsearch.xcontent.ObjectParser;\n import org.elasticsearch.xcontent.ParseField;\n@@ -43,7 +44,10 @@ public class CloseJobAction extends ActionType<CloseJobAction.Response> {\n \n         public static final ParseField TIMEOUT = new ParseField(\"timeout\");\n         public static final ParseField FORCE = new ParseField(\"force\");\n+\n+        @UpdateForV9(owner = UpdateForV9.Owner.MACHINE_LEARNING) // v7 REST API no longer exists: eliminate forRestApiVersion\n         public static final ParseField ALLOW_NO_MATCH = new ParseField(\"allow_no_match\").forRestApiVersion(onOrAfter(RestApiVersion.V_8));\n+        @UpdateForV9(owner = UpdateForV9.Owner.MACHINE_LEARNING) // v7 REST API no longer exists: eliminate ref to RestApiVersion.V_7\n         public static final ParseField ALLOW_NO_MATCH_V7 = new ParseField(\"allow_no_match\", DEPRECATED_ALLOW_NO_JOBS_PARAM)\n             .forRestApiVersion(equalTo(RestApiVersion.V_7));\n         public static final ObjectParser<Request, Void> PARSER = new ObjectParser<>(NAME, Request::new);\ndiff --git a/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/GetOverallBucketsAction.java b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/GetOverallBucketsAction.java\nindex 12c8696a5062..47bc6df5f653 100644\n--- a/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/GetOverallBucketsAction.java\n+++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/GetOverallBucketsAction.java\n@@ -15,6 +15,7 @@ import org.elasticsearch.common.io.stream.StreamOutput;\n import org.elasticsearch.common.time.DateMathParser;\n import org.elasticsearch.core.RestApiVersion;\n import org.elasticsearch.core.TimeValue;\n+import org.elasticsearch.core.UpdateForV9;\n import org.elasticsearch.index.mapper.DateFieldMapper;\n import org.elasticsearch.xcontent.ObjectParser;\n import org.elasticsearch.xcontent.ParseField;\n@@ -67,7 +68,9 @@ public class GetOverallBucketsAction extends ActionType<GetOverallBucketsAction.\n         public static final ParseField EXCLUDE_INTERIM = new ParseField(\"exclude_interim\");\n         public static final ParseField START = new ParseField(\"start\");\n         public static final ParseField END = new ParseField(\"end\");\n+        @UpdateForV9(owner = UpdateForV9.Owner.MACHINE_LEARNING) // v7 REST API no longer exists: eliminate forRestApiVersion\n         public static final ParseField ALLOW_NO_MATCH = new ParseField(\"allow_no_match\").forRestApiVersion(onOrAfter(RestApiVersion.V_8));\n+        @UpdateForV9(owner = UpdateForV9.Owner.MACHINE_LEARNING) // v7 REST API no longer exists: eliminate ref to RestApiVersion.V_7\n         public static final ParseField ALLOW_NO_MATCH_V7 = new ParseField(\"allow_no_match\", DEPRECATED_ALLOW_NO_JOBS_PARAM)\n             .forRestApiVersion(equalTo(RestApiVersion.V_7));\n \ndiff --git a/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/GetTrainedModelsStatsAction.java b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/GetTrainedModelsStatsAction.java\nindex c61c62ed23a4..8ad275e29b09 100644\n--- a/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/GetTrainedModelsStatsAction.java\n+++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/GetTrainedModelsStatsAction.java\n@@ -13,7 +13,6 @@ import org.elasticsearch.common.io.stream.StreamInput;\n import org.elasticsearch.common.io.stream.StreamOutput;\n import org.elasticsearch.common.io.stream.Writeable;\n import org.elasticsearch.common.xcontent.ChunkedToXContent;\n-import org.elasticsearch.core.RestApiVersion;\n import org.elasticsearch.ingest.IngestStats;\n import org.elasticsearch.xcontent.ParseField;\n import org.elasticsearch.xcontent.ToXContentObject;\n@@ -34,7 +33,6 @@ import java.util.Map;\n import java.util.Objects;\n import java.util.Set;\n \n-import static org.elasticsearch.core.RestApiVersion.onOrAfter;\n import static org.elasticsearch.core.Strings.format;\n \n public class GetTrainedModelsStatsAction extends ActionType<GetTrainedModelsStatsAction.Response> {\n@@ -172,7 +170,7 @@ public class GetTrainedModelsStatsAction extends ActionType<GetTrainedModelsStat\n                 if (this.inferenceStats != null) {\n                     builder.field(INFERENCE_STATS.getPreferredName(), this.inferenceStats);\n                 }\n-                if (deploymentStats != null && builder.getRestApiVersion().matches(onOrAfter(RestApiVersion.V_8))) {\n+                if (deploymentStats != null) {\n                     builder.field(DEPLOYMENT_STATS.getPreferredName(), this.deploymentStats);\n                 }\n                 builder.endObject();\ndiff --git a/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/StopDatafeedAction.java b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/StopDatafeedAction.java\nindex cb89cfa8cd0e..bd4aac7ccad8 100644\n--- a/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/StopDatafeedAction.java\n+++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/StopDatafeedAction.java\n@@ -15,6 +15,7 @@ import org.elasticsearch.common.io.stream.StreamOutput;\n import org.elasticsearch.common.io.stream.Writeable;\n import org.elasticsearch.core.RestApiVersion;\n import org.elasticsearch.core.TimeValue;\n+import org.elasticsearch.core.UpdateForV9;\n import org.elasticsearch.tasks.Task;\n import org.elasticsearch.xcontent.ObjectParser;\n import org.elasticsearch.xcontent.ParseField;\n@@ -46,7 +47,9 @@ public class StopDatafeedAction extends ActionType<StopDatafeedAction.Response>\n \n         public static final ParseField TIMEOUT = new ParseField(\"timeout\");\n         public static final ParseField FORCE = new ParseField(\"force\");\n+        @UpdateForV9(owner = UpdateForV9.Owner.MACHINE_LEARNING) // v7 REST API no longer exists: eliminate forRestApiVersion\n         public static final ParseField ALLOW_NO_MATCH = new ParseField(\"allow_no_match\").forRestApiVersion(onOrAfter(RestApiVersion.V_8));\n+        @UpdateForV9(owner = UpdateForV9.Owner.MACHINE_LEARNING) // v7 REST API no longer exists: eliminate ref to RestApiVersion.V_7\n         public static final ParseField ALLOW_NO_MATCH_V7 = new ParseField(\"allow_no_match\", DEPRECATED_ALLOW_NO_DATAFEEDS_PARAM)\n             .forRestApiVersion(equalTo(RestApiVersion.V_7));\n \ndiff --git a/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/inference/TrainedModelConfig.java b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/inference/TrainedModelConfig.java\nindex 5ae19f6db6bb..3fb4bb7fa598 100644\n--- a/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/inference/TrainedModelConfig.java\n+++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/inference/TrainedModelConfig.java\n@@ -17,7 +17,6 @@ import org.elasticsearch.common.io.stream.StreamOutput;\n import org.elasticsearch.common.io.stream.Writeable;\n import org.elasticsearch.common.unit.ByteSizeValue;\n import org.elasticsearch.core.Nullable;\n-import org.elasticsearch.core.RestApiVersion;\n import org.elasticsearch.license.License;\n import org.elasticsearch.xcontent.NamedXContentRegistry;\n import org.elasticsearch.xcontent.ObjectParser;\n@@ -514,15 +513,6 @@ public class TrainedModelConfig implements ToXContentObject, Writeable {\n                 CREATE_TIME.getPreferredName() + \"_string\",\n                 createTime.toEpochMilli()\n             );\n-            // If we are NOT storing the model, we should return the deprecated field name\n-            if (params.paramAsBoolean(ToXContentParams.FOR_INTERNAL_STORAGE, false) == false\n-                && builder.getRestApiVersion().matches(RestApiVersion.equalTo(RestApiVersion.V_7))) {\n-                builder.humanReadableField(\n-                    DEPRECATED_ESTIMATED_HEAP_MEMORY_USAGE_BYTES.getPreferredName(),\n-                    ESTIMATED_HEAP_MEMORY_USAGE_HUMAN,\n-                    ByteSizeValue.ofBytes(modelSize)\n-                );\n-            }\n             builder.humanReadableField(MODEL_SIZE_BYTES.getPreferredName(), MODEL_SIZE_HUMAN, ByteSizeValue.ofBytes(modelSize));\n             builder.field(ESTIMATED_OPERATIONS.getPreferredName(), estimatedOperations);\n             builder.field(LICENSE_LEVEL.getPreferredName(), licenseLevel.description());\ndiff --git a/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/rest/action/RestXPackInfoAction.java b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/rest/action/RestXPackInfoAction.java\nindex cfa2efc53ce9..4e558e2a394d 100644\n--- a/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/rest/action/RestXPackInfoAction.java\n+++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/rest/action/RestXPackInfoAction.java\n@@ -9,7 +9,7 @@ package org.elasticsearch.xpack.core.rest.action;\n import org.elasticsearch.client.internal.node.NodeClient;\n import org.elasticsearch.common.logging.DeprecationCategory;\n import org.elasticsearch.common.logging.DeprecationLogger;\n-import org.elasticsearch.core.RestApiVersion;\n+import org.elasticsearch.core.UpdateForV9;\n import org.elasticsearch.protocol.xpack.XPackInfoRequest;\n import org.elasticsearch.rest.BaseRestHandler;\n import org.elasticsearch.rest.RestRequest;\n@@ -22,7 +22,6 @@ import java.io.IOException;\n import java.util.EnumSet;\n import java.util.List;\n \n-import static org.elasticsearch.core.RestApiVersion.onOrAfter;\n import static org.elasticsearch.rest.RestRequest.Method.GET;\n import static org.elasticsearch.rest.RestRequest.Method.HEAD;\n \n@@ -42,6 +41,7 @@ public class RestXPackInfoAction extends BaseRestHandler {\n     }\n \n     @Override\n+    @UpdateForV9(owner = UpdateForV9.Owner.SECURITY) // accept_enterprise parameter no longer supported?\n     public RestChannelConsumer prepareRequest(RestRequest request, NodeClient client) throws IOException {\n \n         // we piggyback verbosity on \"human\" output\n@@ -56,8 +56,7 @@ public class RestXPackInfoAction extends BaseRestHandler {\n                 \"Including [accept_enterprise] in get license requests is deprecated.\"\n                     + \" The parameter will be removed in the next major version\"\n             );\n-            if (request.paramAsBoolean(\"accept_enterprise\", true) == false\n-                && request.getRestApiVersion().matches(onOrAfter(RestApiVersion.V_8))) {\n+            if (request.paramAsBoolean(\"accept_enterprise\", true) == false) {\n                 throw new IllegalArgumentException(\"The [accept_enterprise] parameters may not be false\");\n             }\n         }\ndiff --git a/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/cat/RestCatDatafeedsAction.java b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/cat/RestCatDatafeedsAction.java\nindex b93089eabda2..205bb4f68a62 100644\n--- a/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/cat/RestCatDatafeedsAction.java\n+++ b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/cat/RestCatDatafeedsAction.java\n@@ -12,6 +12,7 @@ import org.elasticsearch.common.Strings;\n import org.elasticsearch.common.Table;\n import org.elasticsearch.core.RestApiVersion;\n import org.elasticsearch.core.TimeValue;\n+import org.elasticsearch.core.UpdateForV9;\n import org.elasticsearch.rest.RestRequest;\n import org.elasticsearch.rest.RestResponse;\n import org.elasticsearch.rest.Scope;\n@@ -51,6 +52,7 @@ public class RestCatDatafeedsAction extends AbstractCatAction {\n         if (Strings.isNullOrEmpty(datafeedId)) {\n             datafeedId = GetDatafeedsStatsAction.ALL;\n         }\n+        @UpdateForV9(owner = UpdateForV9.Owner.MACHINE_LEARNING) // v7 REST API no longer exists: eliminate ref to RestApiVersion.V_7\n         Request request = new Request(datafeedId);\n         checkAndSetDeprecatedParam(\n             DEPRECATED_ALLOW_NO_DATAFEEDS_PARAM,\ndiff --git a/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/cat/RestCatJobsAction.java b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/cat/RestCatJobsAction.java\nindex cb02990da74c..b27819bceee4 100644\n--- a/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/cat/RestCatJobsAction.java\n+++ b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/cat/RestCatJobsAction.java\n@@ -14,6 +14,7 @@ import org.elasticsearch.common.Table;\n import org.elasticsearch.common.unit.ByteSizeValue;\n import org.elasticsearch.core.RestApiVersion;\n import org.elasticsearch.core.TimeValue;\n+import org.elasticsearch.core.UpdateForV9;\n import org.elasticsearch.rest.RestRequest;\n import org.elasticsearch.rest.RestResponse;\n import org.elasticsearch.rest.Scope;\n@@ -56,6 +57,7 @@ public class RestCatJobsAction extends AbstractCatAction {\n         if (Strings.isNullOrEmpty(jobId)) {\n             jobId = Metadata.ALL;\n         }\n+        @UpdateForV9(owner = UpdateForV9.Owner.MACHINE_LEARNING) // v7 REST API no longer exists: eliminate ref to RestApiVersion.V_7\n         Request request = new Request(jobId);\n         checkAndSetDeprecatedParam(\n             DEPRECATED_ALLOW_NO_JOBS_PARAM,\ndiff --git a/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/datafeeds/RestGetDatafeedStatsAction.java b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/datafeeds/RestGetDatafeedStatsAction.java\nindex eb930edffe05..8c85c055fca3 100644\n--- a/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/datafeeds/RestGetDatafeedStatsAction.java\n+++ b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/datafeeds/RestGetDatafeedStatsAction.java\n@@ -9,6 +9,7 @@ package org.elasticsearch.xpack.ml.rest.datafeeds;\n import org.elasticsearch.client.internal.node.NodeClient;\n import org.elasticsearch.common.Strings;\n import org.elasticsearch.core.RestApiVersion;\n+import org.elasticsearch.core.UpdateForV9;\n import org.elasticsearch.rest.BaseRestHandler;\n import org.elasticsearch.rest.RestRequest;\n import org.elasticsearch.rest.Scope;\n@@ -47,6 +48,7 @@ public class RestGetDatafeedStatsAction extends BaseRestHandler {\n         if (Strings.isNullOrEmpty(datafeedId)) {\n             datafeedId = GetDatafeedsStatsAction.ALL;\n         }\n+        @UpdateForV9(owner = UpdateForV9.Owner.MACHINE_LEARNING) // v7 REST API no longer exists: eliminate ref to RestApiVersion.V_7\n         Request request = new Request(datafeedId);\n         checkAndSetDeprecatedParam(\n             DEPRECATED_ALLOW_NO_DATAFEEDS_PARAM,\ndiff --git a/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/datafeeds/RestGetDatafeedsAction.java b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/datafeeds/RestGetDatafeedsAction.java\nindex 6b3a857cdbb9..fd0681f68a3a 100644\n--- a/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/datafeeds/RestGetDatafeedsAction.java\n+++ b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/datafeeds/RestGetDatafeedsAction.java\n@@ -8,6 +8,7 @@ package org.elasticsearch.xpack.ml.rest.datafeeds;\n \n import org.elasticsearch.client.internal.node.NodeClient;\n import org.elasticsearch.core.RestApiVersion;\n+import org.elasticsearch.core.UpdateForV9;\n import org.elasticsearch.rest.BaseRestHandler;\n import org.elasticsearch.rest.RestRequest;\n import org.elasticsearch.rest.Scope;\n@@ -50,6 +51,7 @@ public class RestGetDatafeedsAction extends BaseRestHandler {\n         if (datafeedId == null) {\n             datafeedId = GetDatafeedsAction.ALL;\n         }\n+        @UpdateForV9(owner = UpdateForV9.Owner.MACHINE_LEARNING) // v7 REST API no longer exists: eliminate ref to RestApiVersion.V_7\n         Request request = new Request(datafeedId);\n         checkAndSetDeprecatedParam(\n             DEPRECATED_ALLOW_NO_DATAFEEDS_PARAM,\ndiff --git a/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/datafeeds/RestStopDatafeedAction.java b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/datafeeds/RestStopDatafeedAction.java\nindex bdbdc18a0d9c..8235e2785cc3 100644\n--- a/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/datafeeds/RestStopDatafeedAction.java\n+++ b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/datafeeds/RestStopDatafeedAction.java\n@@ -9,6 +9,7 @@ package org.elasticsearch.xpack.ml.rest.datafeeds;\n import org.elasticsearch.client.internal.node.NodeClient;\n import org.elasticsearch.core.RestApiVersion;\n import org.elasticsearch.core.TimeValue;\n+import org.elasticsearch.core.UpdateForV9;\n import org.elasticsearch.rest.BaseRestHandler;\n import org.elasticsearch.rest.RestRequest;\n import org.elasticsearch.rest.RestResponse;\n@@ -48,6 +49,7 @@ public class RestStopDatafeedAction extends BaseRestHandler {\n     @Override\n     protected RestChannelConsumer prepareRequest(RestRequest restRequest, NodeClient client) throws IOException {\n         String datafeedId = restRequest.param(DatafeedConfig.ID.getPreferredName());\n+        @UpdateForV9(owner = UpdateForV9.Owner.MACHINE_LEARNING) // v7 REST API no longer exists: eliminate ref to RestApiVersion.V_7\n         Request request;\n         if (restRequest.hasContentOrSourceParam()) {\n             XContentParser parser = restRequest.contentOrSourceParamParser();\ndiff --git a/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/job/RestCloseJobAction.java b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/job/RestCloseJobAction.java\nindex 0986a6a2400d..f98a2f5a933a 100644\n--- a/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/job/RestCloseJobAction.java\n+++ b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/job/RestCloseJobAction.java\n@@ -9,6 +9,7 @@ package org.elasticsearch.xpack.ml.rest.job;\n import org.elasticsearch.client.internal.node.NodeClient;\n import org.elasticsearch.core.RestApiVersion;\n import org.elasticsearch.core.TimeValue;\n+import org.elasticsearch.core.UpdateForV9;\n import org.elasticsearch.rest.BaseRestHandler;\n import org.elasticsearch.rest.RestRequest;\n import org.elasticsearch.rest.Scope;\n@@ -42,6 +43,7 @@ public class RestCloseJobAction extends BaseRestHandler {\n \n     @Override\n     protected RestChannelConsumer prepareRequest(RestRequest restRequest, NodeClient client) throws IOException {\n+        @UpdateForV9(owner = UpdateForV9.Owner.MACHINE_LEARNING) // v7 REST API no longer exists: eliminate ref to RestApiVersion.V_7\n         Request request;\n         if (restRequest.hasContentOrSourceParam()) {\n             request = Request.parseRequest(restRequest.param(Job.ID.getPreferredName()), restRequest.contentParser());\ndiff --git a/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/job/RestGetJobStatsAction.java b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/job/RestGetJobStatsAction.java\nindex 1ecc0ff0cefa..2899faabdc40 100644\n--- a/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/job/RestGetJobStatsAction.java\n+++ b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/job/RestGetJobStatsAction.java\n@@ -10,6 +10,7 @@ import org.elasticsearch.client.internal.node.NodeClient;\n import org.elasticsearch.cluster.metadata.Metadata;\n import org.elasticsearch.common.Strings;\n import org.elasticsearch.core.RestApiVersion;\n+import org.elasticsearch.core.UpdateForV9;\n import org.elasticsearch.rest.BaseRestHandler;\n import org.elasticsearch.rest.RestRequest;\n import org.elasticsearch.rest.Scope;\n@@ -51,6 +52,7 @@ public class RestGetJobStatsAction extends BaseRestHandler {\n         if (Strings.isNullOrEmpty(jobId)) {\n             jobId = Metadata.ALL;\n         }\n+        @UpdateForV9(owner = UpdateForV9.Owner.MACHINE_LEARNING) // v7 REST API no longer exists: eliminate ref to RestApiVersion.V_7\n         Request request = new Request(jobId);\n         checkAndSetDeprecatedParam(\n             DEPRECATED_ALLOW_NO_JOBS_PARAM,\ndiff --git a/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/job/RestGetJobsAction.java b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/job/RestGetJobsAction.java\nindex e6f4325024c3..ae8d234d1d8b 100644\n--- a/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/job/RestGetJobsAction.java\n+++ b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/job/RestGetJobsAction.java\n@@ -10,6 +10,7 @@ import org.elasticsearch.client.internal.node.NodeClient;\n import org.elasticsearch.cluster.metadata.Metadata;\n import org.elasticsearch.common.Strings;\n import org.elasticsearch.core.RestApiVersion;\n+import org.elasticsearch.core.UpdateForV9;\n import org.elasticsearch.rest.BaseRestHandler;\n import org.elasticsearch.rest.RestRequest;\n import org.elasticsearch.rest.Scope;\n@@ -51,6 +52,7 @@ public class RestGetJobsAction extends BaseRestHandler {\n         if (Strings.isNullOrEmpty(jobId)) {\n             jobId = Metadata.ALL;\n         }\n+        @UpdateForV9(owner = UpdateForV9.Owner.MACHINE_LEARNING) // v7 REST API no longer exists: eliminate ref to RestApiVersion.V_7\n         Request request = new Request(jobId);\n         checkAndSetDeprecatedParam(\n             DEPRECATED_ALLOW_NO_JOBS_PARAM,\ndiff --git a/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/results/RestGetOverallBucketsAction.java b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/results/RestGetOverallBucketsAction.java\nindex e73e5b32d3a1..2700e01cb9f6 100644\n--- a/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/results/RestGetOverallBucketsAction.java\n+++ b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/results/RestGetOverallBucketsAction.java\n@@ -8,6 +8,7 @@ package org.elasticsearch.xpack.ml.rest.results;\n \n import org.elasticsearch.client.internal.node.NodeClient;\n import org.elasticsearch.core.RestApiVersion;\n+import org.elasticsearch.core.UpdateForV9;\n import org.elasticsearch.rest.BaseRestHandler;\n import org.elasticsearch.rest.RestRequest;\n import org.elasticsearch.rest.Scope;\n@@ -47,6 +48,7 @@ public class RestGetOverallBucketsAction extends BaseRestHandler {\n     @Override\n     protected RestChannelConsumer prepareRequest(RestRequest restRequest, NodeClient client) throws IOException {\n         String jobId = restRequest.param(Job.ID.getPreferredName());\n+        @UpdateForV9(owner = UpdateForV9.Owner.MACHINE_LEARNING) // v7 REST API no longer exists: eliminate ref to RestApiVersion.V_7\n         final Request request;\n         if (restRequest.hasContentOrSourceParam()) {\n             XContentParser parser = restRequest.contentOrSourceParamParser();",
  "judge_mode": "comparative",
  "judge_model": "openai/claude-sonnet-4-5-20250929",
  "test_label": "v0",
  "agent_results": [
    {
      "runner": "auggie",
      "model": "sonnet4.5",
      "edit_run_id": "a9463435",
      "status": "success",
      "elapsed_ms": 1266372,
      "patch_unified": "diff --git a/libs/core/src/main/java/org/elasticsearch/core/RestApiVersion.java b/libs/core/src/main/java/org/elasticsearch/core/RestApiVersion.java\nindex 672090d1..2409ed7a 100644\n--- a/libs/core/src/main/java/org/elasticsearch/core/RestApiVersion.java\n+++ b/libs/core/src/main/java/org/elasticsearch/core/RestApiVersion.java\n@@ -50,6 +50,7 @@ public enum RestApiVersion {\n         return PREVIOUS;\n     }\n \n+    @UpdateForV9(owner = UpdateForV9.Owner.CORE_INFRA)\n     public static Predicate<RestApiVersion> equalTo(RestApiVersion restApiVersion) {\n         return switch (restApiVersion) {\n             case V_9 -> r -> r.major == V_9.major;\n@@ -58,6 +59,7 @@ public enum RestApiVersion {\n         };\n     }\n \n+    @UpdateForV9(owner = UpdateForV9.Owner.CORE_INFRA)\n     public static Predicate<RestApiVersion> onOrAfter(RestApiVersion restApiVersion) {\n         return switch (restApiVersion) {\n             case V_9 -> r -> r.major >= V_9.major;\n@@ -66,6 +68,7 @@ public enum RestApiVersion {\n         };\n     }\n \n+    @UpdateForV9(owner = UpdateForV9.Owner.CORE_INFRA)\n     public static RestApiVersion forMajor(int major) {\n         switch (major) {\n             case 7 -> {\ndiff --git a/modules/percolator/src/main/java/org/elasticsearch/percolator/PercolateQueryBuilder.java b/modules/percolator/src/main/java/org/elasticsearch/percolator/PercolateQueryBuilder.java\nindex 6b37b02a..61264a90 100644\n--- a/modules/percolator/src/main/java/org/elasticsearch/percolator/PercolateQueryBuilder.java\n+++ b/modules/percolator/src/main/java/org/elasticsearch/percolator/PercolateQueryBuilder.java\n@@ -47,6 +47,7 @@ import org.elasticsearch.common.logging.DeprecationLogger;\n import org.elasticsearch.common.xcontent.LoggingDeprecationHandler;\n import org.elasticsearch.common.xcontent.XContentHelper;\n import org.elasticsearch.core.RestApiVersion;\n+import org.elasticsearch.core.UpdateForV9;\n import org.elasticsearch.index.IndexVersion;\n import org.elasticsearch.index.IndexVersions;\n import org.elasticsearch.index.fielddata.FieldDataContext;\n@@ -368,13 +369,17 @@ public class PercolateQueryBuilder extends AbstractQueryBuilder<PercolateQueryBu\n             DOCUMENTS_FIELD.getPreferredName(),\n             INDEXED_DOCUMENT_FIELD_ID.getPreferredName()\n         );\n+        @UpdateForV9(owner = UpdateForV9.Owner.SEARCH_FOUNDATIONS)\n+        var indexedDocumentFieldTypeV7 = INDEXED_DOCUMENT_FIELD_TYPE.forRestApiVersion(equalTo(RestApiVersion.V_7));\n         PARSER.declareString(\n             deprecateAndIgnoreType(\"percolate_with_type\", TYPE_DEPRECATION_MESSAGE),\n-            INDEXED_DOCUMENT_FIELD_TYPE.forRestApiVersion(equalTo(RestApiVersion.V_7))\n+            indexedDocumentFieldTypeV7\n         );\n+        @UpdateForV9(owner = UpdateForV9.Owner.SEARCH_FOUNDATIONS)\n+        var documentTypeFieldV7 = DOCUMENT_TYPE_FIELD.forRestApiVersion(equalTo(RestApiVersion.V_7));\n         PARSER.declareString(\n             deprecateAndIgnoreType(\"percolate_with_document_type\", DOCUMENT_TYPE_DEPRECATION_MESSAGE),\n-            DOCUMENT_TYPE_FIELD.forRestApiVersion(equalTo(RestApiVersion.V_7))\n+            documentTypeFieldV7\n         );\n     }\n \ndiff --git a/server/src/main/java/org/elasticsearch/action/admin/indices/rollover/RolloverRequest.java b/server/src/main/java/org/elasticsearch/action/admin/indices/rollover/RolloverRequest.java\nindex fefc4131..f8ea163e 100644\n--- a/server/src/main/java/org/elasticsearch/action/admin/indices/rollover/RolloverRequest.java\n+++ b/server/src/main/java/org/elasticsearch/action/admin/indices/rollover/RolloverRequest.java\n@@ -19,6 +19,7 @@ import org.elasticsearch.cluster.metadata.DataStream;\n import org.elasticsearch.common.io.stream.StreamInput;\n import org.elasticsearch.common.io.stream.StreamOutput;\n import org.elasticsearch.core.RestApiVersion;\n+import org.elasticsearch.core.UpdateForV9;\n import org.elasticsearch.index.mapper.MapperService;\n import org.elasticsearch.tasks.CancellableTask;\n import org.elasticsearch.tasks.Task;\n@@ -57,6 +58,8 @@ public class RolloverRequest extends AcknowledgedRequest<RolloverRequest> implem\n             CreateIndexRequest.SETTINGS,\n             ObjectParser.ValueType.OBJECT\n         );\n+        @UpdateForV9(owner = UpdateForV9.Owner.DATA_MANAGEMENT)\n+        var mappingsFieldV7 = CreateIndexRequest.MAPPINGS.forRestApiVersion(RestApiVersion.equalTo(RestApiVersion.V_7));\n         PARSER.declareField((parser, request, context) -> {\n             // a type is not included, add a dummy _doc type\n             Map<String, Object> mappings = parser.map();\n@@ -69,7 +72,7 @@ public class RolloverRequest extends AcknowledgedRequest<RolloverRequest> implem\n                 );\n             }\n             request.createIndexRequest.mapping(mappings);\n-        }, CreateIndexRequest.MAPPINGS.forRestApiVersion(RestApiVersion.equalTo(RestApiVersion.V_7)), ObjectParser.ValueType.OBJECT);\n+        }, mappingsFieldV7, ObjectParser.ValueType.OBJECT);\n         PARSER.declareField((parser, request, context) -> {\n             // a type is not included, add a dummy _doc type\n             Map<String, Object> mappings = parser.map();\ndiff --git a/server/src/main/java/org/elasticsearch/action/bulk/BulkRequestParser.java b/server/src/main/java/org/elasticsearch/action/bulk/BulkRequestParser.java\nindex cd74989e..b4f41eab 100644\n--- a/server/src/main/java/org/elasticsearch/action/bulk/BulkRequestParser.java\n+++ b/server/src/main/java/org/elasticsearch/action/bulk/BulkRequestParser.java\n@@ -271,13 +271,15 @@ public final class BulkRequestParser {\n                                 }\n                                 index = stringDeduplicator.computeIfAbsent(parser.text(), Function.identity());\n                             } else if (TYPE.match(currentFieldName, parser.getDeprecationHandler())) {\n-                                if (parser.getRestApiVersion().matches(RestApiVersion.equalTo(RestApiVersion.V_7))) {\n+                                @UpdateForV9(owner = UpdateForV9.Owner.DISTRIBUTED_INDEXING)\n+                                var restApiVersion = parser.getRestApiVersion();\n+                                if (restApiVersion.matches(RestApiVersion.equalTo(RestApiVersion.V_7))) {\n                                     // for bigger bulks, deprecation throttling might not be enough\n                                     if (deprecateOrErrorOnType && typesDeprecationLogged == false) {\n                                         deprecationLogger.compatibleCritical(\"bulk_with_types\", RestBulkAction.TYPES_DEPRECATION_MESSAGE);\n                                         typesDeprecationLogged = true;\n                                     }\n-                                } else if (parser.getRestApiVersion().matches(RestApiVersion.onOrAfter(RestApiVersion.V_8))\n+                                } else if (restApiVersion.matches(RestApiVersion.onOrAfter(RestApiVersion.V_8))\n                                     && deprecateOrErrorOnType) {\n                                         throw new IllegalArgumentException(\n                                             \"Action/metadata line [\" + line + \"] contains an unknown parameter [\" + currentFieldName + \"]\"\ndiff --git a/server/src/main/java/org/elasticsearch/action/ingest/SimulatePipelineRequest.java b/server/src/main/java/org/elasticsearch/action/ingest/SimulatePipelineRequest.java\nindex 6adcd80c..fed5cf22 100644\n--- a/server/src/main/java/org/elasticsearch/action/ingest/SimulatePipelineRequest.java\n+++ b/server/src/main/java/org/elasticsearch/action/ingest/SimulatePipelineRequest.java\n@@ -18,6 +18,7 @@ import org.elasticsearch.common.logging.DeprecationLogger;\n import org.elasticsearch.common.lucene.uid.Versions;\n import org.elasticsearch.common.xcontent.XContentHelper;\n import org.elasticsearch.core.RestApiVersion;\n+import org.elasticsearch.core.UpdateForV9;\n import org.elasticsearch.index.VersionType;\n import org.elasticsearch.ingest.ConfigurationUtils;\n import org.elasticsearch.ingest.IngestDocument;\n@@ -172,7 +173,9 @@ public class SimulatePipelineRequest extends ActionRequest implements ToXContent\n             String index = ConfigurationUtils.readStringOrIntProperty(null, null, dataMap, Metadata.INDEX.getFieldName(), \"_index\");\n             String id = ConfigurationUtils.readStringOrIntProperty(null, null, dataMap, Metadata.ID.getFieldName(), \"_id\");\n             String routing = ConfigurationUtils.readOptionalStringOrIntProperty(null, null, dataMap, Metadata.ROUTING.getFieldName());\n-            if (restApiVersion == RestApiVersion.V_7 && dataMap.containsKey(Metadata.TYPE.getFieldName())) {\n+            @UpdateForV9(owner = UpdateForV9.Owner.DATA_MANAGEMENT)\n+            var apiVersion = restApiVersion;\n+            if (apiVersion == RestApiVersion.V_7 && dataMap.containsKey(Metadata.TYPE.getFieldName())) {\n                 deprecationLogger.compatibleCritical(\n                     \"simulate_pipeline_with_types\",\n                     \"[types removal] specifying _type in pipeline simulation requests is deprecated\"\ndiff --git a/server/src/main/java/org/elasticsearch/action/search/MultiSearchRequest.java b/server/src/main/java/org/elasticsearch/action/search/MultiSearchRequest.java\nindex 8467ee6f..180215e7 100644\n--- a/server/src/main/java/org/elasticsearch/action/search/MultiSearchRequest.java\n+++ b/server/src/main/java/org/elasticsearch/action/search/MultiSearchRequest.java\n@@ -21,6 +21,7 @@ import org.elasticsearch.common.io.stream.StreamOutput;\n import org.elasticsearch.common.logging.DeprecationLogger;\n import org.elasticsearch.common.xcontent.XContentHelper;\n import org.elasticsearch.core.RestApiVersion;\n+import org.elasticsearch.core.UpdateForV9;\n import org.elasticsearch.rest.action.search.RestMultiSearchAction;\n import org.elasticsearch.rest.action.search.RestSearchAction;\n import org.elasticsearch.tasks.CancellableTask;\n@@ -214,7 +215,9 @@ public class MultiSearchRequest extends ActionRequest implements CompositeIndice\n                 break;\n             }\n             // support first line with \\n\n-            if (parserConfig.restApiVersion() == RestApiVersion.V_7 && nextMarker == 0) {\n+            @UpdateForV9(owner = UpdateForV9.Owner.SEARCH_FOUNDATIONS)\n+            var restApiVersion = parserConfig.restApiVersion();\n+            if (restApiVersion == RestApiVersion.V_7 && nextMarker == 0) {\n                 deprecationLogger.compatibleCritical(\"msearch_first_line_empty\", FIRST_LINE_EMPTY_DEPRECATION_MESSAGE);\n                 from = nextMarker + 1;\n                 continue;\n@@ -281,15 +284,18 @@ public class MultiSearchRequest extends ActionRequest implements CompositeIndice\n                             allowNoIndices = value;\n                         } else if (\"ignore_throttled\".equals(entry.getKey()) || \"ignoreThrottled\".equals(entry.getKey())) {\n                             ignoreThrottled = value;\n-                        } else if (parserConfig.restApiVersion() == RestApiVersion.V_7\n-                            && (\"type\".equals(entry.getKey()) || \"types\".equals(entry.getKey()))) {\n+                        } else {\n+                            @UpdateForV9(owner = UpdateForV9.Owner.SEARCH_FOUNDATIONS)\n+                            var apiVersion = parserConfig.restApiVersion();\n+                            if (apiVersion == RestApiVersion.V_7\n+                                && (\"type\".equals(entry.getKey()) || \"types\".equals(entry.getKey()))) {\n                                 deprecationLogger.compatibleCritical(\"msearch_with_types\", RestMultiSearchAction.TYPES_DEPRECATION_MESSAGE);\n                             } else if (extraParamParser.apply(entry.getKey(), value, searchRequest)) {\n                                 // Skip, the parser handled the key/value\n                             } else {\n                                 throw new IllegalArgumentException(\"key [\" + entry.getKey() + \"] is not supported in the metadata section\");\n                             }\n-                    }\n+                        }\n                     defaultOptions = IndicesOptions.fromParameters(\n                         expandWildcards,\n                         ignoreUnavailable,\ndiff --git a/server/src/main/java/org/elasticsearch/action/termvectors/TermVectorsRequest.java b/server/src/main/java/org/elasticsearch/action/termvectors/TermVectorsRequest.java\nindex a36158d1..1816e779 100644\n--- a/server/src/main/java/org/elasticsearch/action/termvectors/TermVectorsRequest.java\n+++ b/server/src/main/java/org/elasticsearch/action/termvectors/TermVectorsRequest.java\n@@ -25,6 +25,7 @@ import org.elasticsearch.common.lucene.uid.Versions;\n import org.elasticsearch.common.util.set.Sets;\n import org.elasticsearch.common.xcontent.XContentHelper;\n import org.elasticsearch.core.RestApiVersion;\n+import org.elasticsearch.core.UpdateForV9;\n import org.elasticsearch.index.VersionType;\n import org.elasticsearch.rest.action.document.RestTermVectorsAction;\n import org.elasticsearch.xcontent.ParseField;\n@@ -583,12 +584,15 @@ public final class TermVectorsRequest extends SingleShardRequest<TermVectorsRequ\n                     termVectorsRequest.version = parser.longValue();\n                 } else if (VERSION_TYPE.match(currentFieldName, parser.getDeprecationHandler())) {\n                     termVectorsRequest.versionType = VersionType.fromString(parser.text());\n-                } else if (restApiVersion == RestApiVersion.V_7 && TYPE.match(currentFieldName, parser.getDeprecationHandler())) {\n-                    deprecationLogger.compatibleCritical(\"termvectors_with_types\", RestTermVectorsAction.TYPES_DEPRECATION_MESSAGE);\n                 } else {\n-                    throw new ElasticsearchParseException(\"failed to parse term vectors request. unknown field [{}]\", currentFieldName);\n+                    @UpdateForV9(owner = UpdateForV9.Owner.SEARCH_FOUNDATIONS)\n+                    var apiVersion = restApiVersion;\n+                    if (apiVersion == RestApiVersion.V_7 && TYPE.match(currentFieldName, parser.getDeprecationHandler())) {\n+                        deprecationLogger.compatibleCritical(\"termvectors_with_types\", RestTermVectorsAction.TYPES_DEPRECATION_MESSAGE);\n+                    } else {\n+                        throw new ElasticsearchParseException(\"failed to parse term vectors request. unknown field [{}]\", currentFieldName);\n+                    }\n                 }\n-            }\n         }\n         if (fields.size() > 0) {\n             String[] fieldsAsArray = new String[fields.size()];\ndiff --git a/server/src/main/java/org/elasticsearch/index/query/CommonTermsQueryBuilder.java b/server/src/main/java/org/elasticsearch/index/query/CommonTermsQueryBuilder.java\nindex 263c6bd3..8e0f1d87 100644\n--- a/server/src/main/java/org/elasticsearch/index/query/CommonTermsQueryBuilder.java\n+++ b/server/src/main/java/org/elasticsearch/index/query/CommonTermsQueryBuilder.java\n@@ -16,6 +16,7 @@ import org.elasticsearch.common.ParsingException;\n import org.elasticsearch.common.io.stream.StreamOutput;\n import org.elasticsearch.common.logging.DeprecationLogger;\n import org.elasticsearch.core.RestApiVersion;\n+import org.elasticsearch.core.UpdateForV9;\n import org.elasticsearch.xcontent.ParseField;\n import org.elasticsearch.xcontent.XContentBuilder;\n import org.elasticsearch.xcontent.XContentParser;\n@@ -27,6 +28,7 @@ public class CommonTermsQueryBuilder extends AbstractQueryBuilder<CommonTermsQue\n     public static final String COMMON_TERMS_QUERY_DEPRECATION_MSG = \"Common Terms Query usage is not supported. \"\n         + \"Use [match] query which can efficiently skip blocks of documents if the total number of hits is not tracked.\";\n \n+    @UpdateForV9(owner = UpdateForV9.Owner.SEARCH_RELEVANCE)\n     public static ParseField NAME_V7 = new ParseField(\"common\").withAllDeprecated(COMMON_TERMS_QUERY_DEPRECATION_MSG)\n         .forRestApiVersion(RestApiVersion.equalTo(RestApiVersion.V_7));\n \ndiff --git a/server/src/main/java/org/elasticsearch/index/query/GeoBoundingBoxQueryBuilder.java b/server/src/main/java/org/elasticsearch/index/query/GeoBoundingBoxQueryBuilder.java\nindex 22cc68fb..5c025ab4 100644\n--- a/server/src/main/java/org/elasticsearch/index/query/GeoBoundingBoxQueryBuilder.java\n+++ b/server/src/main/java/org/elasticsearch/index/query/GeoBoundingBoxQueryBuilder.java\n@@ -25,6 +25,7 @@ import org.elasticsearch.common.io.stream.StreamInput;\n import org.elasticsearch.common.io.stream.StreamOutput;\n import org.elasticsearch.common.logging.DeprecationLogger;\n import org.elasticsearch.core.RestApiVersion;\n+import org.elasticsearch.core.UpdateForV9;\n import org.elasticsearch.geometry.Rectangle;\n import org.elasticsearch.geometry.utils.Geohash;\n import org.elasticsearch.index.mapper.GeoShapeQueryable;\n@@ -55,6 +56,7 @@ public class GeoBoundingBoxQueryBuilder extends AbstractQueryBuilder<GeoBounding\n      */\n     public static final boolean DEFAULT_IGNORE_UNMAPPED = false;\n \n+    @UpdateForV9(owner = UpdateForV9.Owner.SEARCH_FOUNDATIONS)\n     private static final ParseField TYPE_FIELD = new ParseField(\"type\").forRestApiVersion(RestApiVersion.equalTo(RestApiVersion.V_7));\n     private static final ParseField VALIDATION_METHOD_FIELD = new ParseField(\"validation_method\");\n     private static final ParseField IGNORE_UNMAPPED_FIELD = new ParseField(\"ignore_unmapped\");\ndiff --git a/server/src/main/java/org/elasticsearch/index/query/MatchQueryBuilder.java b/server/src/main/java/org/elasticsearch/index/query/MatchQueryBuilder.java\nindex d72b755e..432fdf31 100644\n--- a/server/src/main/java/org/elasticsearch/index/query/MatchQueryBuilder.java\n+++ b/server/src/main/java/org/elasticsearch/index/query/MatchQueryBuilder.java\n@@ -21,6 +21,7 @@ import org.elasticsearch.common.lucene.search.Queries;\n import org.elasticsearch.common.unit.Fuzziness;\n import org.elasticsearch.common.xcontent.LoggingDeprecationHandler;\n import org.elasticsearch.core.RestApiVersion;\n+import org.elasticsearch.core.UpdateForV9;\n import org.elasticsearch.index.analysis.NamedAnalyzer;\n import org.elasticsearch.index.mapper.MappedFieldType;\n import org.elasticsearch.index.query.support.QueryParsers;\n@@ -39,6 +40,7 @@ import java.util.Objects;\n public class MatchQueryBuilder extends AbstractQueryBuilder<MatchQueryBuilder> {\n     private static final String CUTOFF_FREQUENCY_DEPRECATION_MSG = \"cutoff_freqency is not supported. \"\n         + \"The [match] query can skip block of documents efficiently if the total number of hits is not tracked\";\n+    @UpdateForV9(owner = UpdateForV9.Owner.SEARCH_RELEVANCE)\n     public static final ParseField CUTOFF_FREQUENCY_FIELD = new ParseField(\"cutoff_frequency\").withAllDeprecated(\n         CUTOFF_FREQUENCY_DEPRECATION_MSG\n     ).forRestApiVersion(RestApiVersion.equalTo(RestApiVersion.V_7));\ndiff --git a/server/src/main/java/org/elasticsearch/index/query/MultiMatchQueryBuilder.java b/server/src/main/java/org/elasticsearch/index/query/MultiMatchQueryBuilder.java\nindex a83fb8d1..aee0f698 100644\n--- a/server/src/main/java/org/elasticsearch/index/query/MultiMatchQueryBuilder.java\n+++ b/server/src/main/java/org/elasticsearch/index/query/MultiMatchQueryBuilder.java\n@@ -22,6 +22,7 @@ import org.elasticsearch.common.io.stream.Writeable;\n import org.elasticsearch.common.unit.Fuzziness;\n import org.elasticsearch.common.xcontent.LoggingDeprecationHandler;\n import org.elasticsearch.core.RestApiVersion;\n+import org.elasticsearch.core.UpdateForV9;\n import org.elasticsearch.index.query.support.QueryParsers;\n import org.elasticsearch.index.search.MatchQueryParser;\n import org.elasticsearch.index.search.MultiMatchQueryParser;\n@@ -47,6 +48,7 @@ public final class MultiMatchQueryBuilder extends AbstractQueryBuilder<MultiMatc\n     public static final String NAME = \"multi_match\";\n     private static final String CUTOFF_FREQUENCY_DEPRECATION_MSG = \"cutoff_freqency is not supported.\"\n         + \" The [multi_match] query can skip block of documents efficiently if the total number of hits is not tracked\";\n+    @UpdateForV9(owner = UpdateForV9.Owner.SEARCH_RELEVANCE)\n     private static final ParseField CUTOFF_FREQUENCY_FIELD = new ParseField(\"cutoff_frequency\").withAllDeprecated(\n         CUTOFF_FREQUENCY_DEPRECATION_MSG\n     ).forRestApiVersion(RestApiVersion.equalTo(RestApiVersion.V_7));\ndiff --git a/server/src/main/java/org/elasticsearch/index/query/TypeQueryV7Builder.java b/server/src/main/java/org/elasticsearch/index/query/TypeQueryV7Builder.java\nindex f707684c..d01469fe 100644\n--- a/server/src/main/java/org/elasticsearch/index/query/TypeQueryV7Builder.java\n+++ b/server/src/main/java/org/elasticsearch/index/query/TypeQueryV7Builder.java\n@@ -18,6 +18,7 @@ import org.elasticsearch.common.io.stream.StreamInput;\n import org.elasticsearch.common.io.stream.StreamOutput;\n import org.elasticsearch.common.logging.DeprecationLogger;\n import org.elasticsearch.core.RestApiVersion;\n+import org.elasticsearch.core.UpdateForV9;\n import org.elasticsearch.index.mapper.MapperService;\n import org.elasticsearch.xcontent.ObjectParser;\n import org.elasticsearch.xcontent.ParseField;\n@@ -32,20 +33,27 @@ public class TypeQueryV7Builder extends AbstractQueryBuilder<TypeQueryV7Builder>\n         + \"prefer to filter on a field instead.\";\n \n     private static final String NAME = \"type\";\n+    @UpdateForV9(owner = UpdateForV9.Owner.SEARCH_FOUNDATIONS)\n     public static final ParseField NAME_V7 = new ParseField(NAME).forRestApiVersion(RestApiVersion.equalTo(RestApiVersion.V_7));\n     private static final ParseField VALUE_FIELD = new ParseField(\"value\");\n     private static final ObjectParser<TypeQueryV7Builder, Void> PARSER = new ObjectParser<>(NAME, TypeQueryV7Builder::new);\n \n     static {\n+        @UpdateForV9(owner = UpdateForV9.Owner.SEARCH_FOUNDATIONS)\n+        var nameFieldV7 = AbstractQueryBuilder.NAME_FIELD.forRestApiVersion(RestApiVersion.equalTo(RestApiVersion.V_7));\n         PARSER.declareString(\n             QueryBuilder::queryName,\n-            AbstractQueryBuilder.NAME_FIELD.forRestApiVersion(RestApiVersion.equalTo(RestApiVersion.V_7))\n+            nameFieldV7\n         );\n+        @UpdateForV9(owner = UpdateForV9.Owner.SEARCH_FOUNDATIONS)\n+        var boostFieldV7 = AbstractQueryBuilder.BOOST_FIELD.forRestApiVersion(RestApiVersion.equalTo(RestApiVersion.V_7));\n         PARSER.declareFloat(\n             QueryBuilder::boost,\n-            AbstractQueryBuilder.BOOST_FIELD.forRestApiVersion(RestApiVersion.equalTo(RestApiVersion.V_7))\n+            boostFieldV7\n         );\n-        PARSER.declareString(TypeQueryV7Builder::setValue, VALUE_FIELD.forRestApiVersion(RestApiVersion.equalTo(RestApiVersion.V_7)));\n+        @UpdateForV9(owner = UpdateForV9.Owner.SEARCH_FOUNDATIONS)\n+        var valueFieldV7 = VALUE_FIELD.forRestApiVersion(RestApiVersion.equalTo(RestApiVersion.V_7));\n+        PARSER.declareString(TypeQueryV7Builder::setValue, valueFieldV7);\n     }\n \n     private String value;\ndiff --git a/server/src/main/java/org/elasticsearch/index/reindex/ReindexRequest.java b/server/src/main/java/org/elasticsearch/index/reindex/ReindexRequest.java\nindex b7ec486d..ba95d098 100644\n--- a/server/src/main/java/org/elasticsearch/index/reindex/ReindexRequest.java\n+++ b/server/src/main/java/org/elasticsearch/index/reindex/ReindexRequest.java\n@@ -22,6 +22,7 @@ import org.elasticsearch.common.settings.SecureString;\n import org.elasticsearch.common.xcontent.XContentHelper;\n import org.elasticsearch.core.RestApiVersion;\n import org.elasticsearch.core.TimeValue;\n+import org.elasticsearch.core.UpdateForV9;\n import org.elasticsearch.features.NodeFeature;\n import org.elasticsearch.index.VersionType;\n import org.elasticsearch.index.query.QueryBuilder;\n@@ -354,9 +355,11 @@ public class ReindexRequest extends AbstractBulkIndexByScrollRequest<ReindexRequ\n             ObjectParser.ValueType.OBJECT\n         );\n \n+        @UpdateForV9(owner = UpdateForV9.Owner.DATA_MANAGEMENT)\n+        var maxDocsFieldV7 = new ParseField(\"max_docs\", \"size\").forRestApiVersion(RestApiVersion.equalTo(RestApiVersion.V_7));\n         PARSER.declareInt(\n             ReindexRequest::setMaxDocsValidateIdentical,\n-            new ParseField(\"max_docs\", \"size\").forRestApiVersion(RestApiVersion.equalTo(RestApiVersion.V_7))\n+            maxDocsFieldV7\n         );\n \n         PARSER.declareInt(\ndiff --git a/server/src/main/java/org/elasticsearch/indices/TermsLookup.java b/server/src/main/java/org/elasticsearch/indices/TermsLookup.java\nindex b1c74c60..8e541223 100644\n--- a/server/src/main/java/org/elasticsearch/indices/TermsLookup.java\n+++ b/server/src/main/java/org/elasticsearch/indices/TermsLookup.java\n@@ -14,6 +14,7 @@ import org.elasticsearch.common.io.stream.StreamInput;\n import org.elasticsearch.common.io.stream.StreamOutput;\n import org.elasticsearch.common.io.stream.Writeable;\n import org.elasticsearch.core.RestApiVersion;\n+import org.elasticsearch.core.UpdateForV9;\n import org.elasticsearch.index.mapper.MapperService;\n import org.elasticsearch.index.query.TermsQueryBuilder;\n import org.elasticsearch.xcontent.ConstructingObjectParser;\n@@ -109,7 +110,9 @@ public class TermsLookup implements Writeable, ToXContentFragment {\n         PARSER.declareString(constructorArg(), new ParseField(\"id\"));\n         PARSER.declareString(constructorArg(), new ParseField(\"path\"));\n         PARSER.declareString(TermsLookup::routing, new ParseField(\"routing\"));\n-        PARSER.declareString((termLookup, type) -> {}, new ParseField(\"type\").forRestApiVersion(equalTo(RestApiVersion.V_7)));\n+        @UpdateForV9(owner = UpdateForV9.Owner.SEARCH_FOUNDATIONS)\n+        var typeField = new ParseField(\"type\").forRestApiVersion(equalTo(RestApiVersion.V_7));\n+        PARSER.declareString((termLookup, type) -> {}, typeField);\n     }\n \n     public static TermsLookup parseTermsLookup(XContentParser parser) throws IOException {\ndiff --git a/server/src/main/java/org/elasticsearch/rest/action/admin/indices/RestGetAliasesAction.java b/server/src/main/java/org/elasticsearch/rest/action/admin/indices/RestGetAliasesAction.java\nindex 79e5c574..34b1c5b1 100644\n--- a/server/src/main/java/org/elasticsearch/rest/action/admin/indices/RestGetAliasesAction.java\n+++ b/server/src/main/java/org/elasticsearch/rest/action/admin/indices/RestGetAliasesAction.java\n@@ -214,7 +214,9 @@ public class RestGetAliasesAction extends BaseRestHandler {\n         if (request.hasParam(\"local\")) {\n             // consume this param just for validation\n             final var localParam = request.paramAsBoolean(\"local\", false);\n-            if (request.getRestApiVersion() != RestApiVersion.V_7) {\n+            @UpdateForV9(owner = UpdateForV9.Owner.DATA_MANAGEMENT)\n+            var restApiVersion = request.getRestApiVersion();\n+            if (restApiVersion != RestApiVersion.V_7) {\n                 DEPRECATION_LOGGER.critical(\n                     DeprecationCategory.API,\n                     \"get-aliases-local\",\ndiff --git a/server/src/main/java/org/elasticsearch/rest/action/cat/RestAliasAction.java b/server/src/main/java/org/elasticsearch/rest/action/cat/RestAliasAction.java\nindex 0957821e..eaff4afe 100644\n--- a/server/src/main/java/org/elasticsearch/rest/action/cat/RestAliasAction.java\n+++ b/server/src/main/java/org/elasticsearch/rest/action/cat/RestAliasAction.java\n@@ -18,6 +18,7 @@ import org.elasticsearch.common.Table;\n import org.elasticsearch.common.logging.DeprecationCategory;\n import org.elasticsearch.common.logging.DeprecationLogger;\n import org.elasticsearch.core.RestApiVersion;\n+import org.elasticsearch.core.UpdateForV9;\n import org.elasticsearch.rest.RestRequest;\n import org.elasticsearch.rest.RestResponse;\n import org.elasticsearch.rest.Scope;\n@@ -60,7 +61,9 @@ public class RestAliasAction extends AbstractCatAction {\n         if (request.hasParam(\"local\")) {\n             // consume this param just for validation\n             final var localParam = request.paramAsBoolean(\"local\", false);\n-            if (request.getRestApiVersion() != RestApiVersion.V_7) {\n+            @UpdateForV9(owner = UpdateForV9.Owner.DATA_MANAGEMENT)\n+            var restApiVersion = request.getRestApiVersion();\n+            if (restApiVersion != RestApiVersion.V_7) {\n                 DEPRECATION_LOGGER.critical(\n                     DeprecationCategory.API,\n                     \"cat-aliases-local\",\ndiff --git a/server/src/main/java/org/elasticsearch/search/SearchModule.java b/server/src/main/java/org/elasticsearch/search/SearchModule.java\nindex 0bb914a9..bc643296 100644\n--- a/server/src/main/java/org/elasticsearch/search/SearchModule.java\n+++ b/server/src/main/java/org/elasticsearch/search/SearchModule.java\n@@ -687,15 +687,6 @@ public class SearchModule {\n                 .setAggregatorRegistrar(CompositeAggregationBuilder::registerAggregators),\n             builder\n         );\n-        if (RestApiVersion.minimumSupported() == RestApiVersion.V_7) {\n-            registerQuery(\n-                new QuerySpec<>(\n-                    CommonTermsQueryBuilder.NAME_V7,\n-                    (streamInput) -> new CommonTermsQueryBuilder(),\n-                    CommonTermsQueryBuilder::fromXContent\n-                )\n-            );\n-        }\n \n         registerFromPlugin(plugins, SearchPlugin::getAggregations, (agg) -> this.registerAggregation(agg, builder));\n \n@@ -816,15 +807,6 @@ public class SearchModule {\n                 SerialDiffPipelineAggregationBuilder::parse\n             )\n         );\n-        if (RestApiVersion.minimumSupported() == RestApiVersion.V_7) {\n-            registerPipelineAggregation(\n-                new PipelineAggregationSpec(\n-                    MovAvgPipelineAggregationBuilder.NAME_V7,\n-                    MovAvgPipelineAggregationBuilder::new,\n-                    MovAvgPipelineAggregationBuilder.PARSER\n-                )\n-            );\n-        }\n \n         registerFromPlugin(plugins, SearchPlugin::getPipelineAggregations, this::registerPipelineAggregation);\n     }\n@@ -1203,10 +1185,6 @@ public class SearchModule {\n         }));\n \n         registerFromPlugin(plugins, SearchPlugin::getQueries, this::registerQuery);\n-\n-        if (RestApiVersion.minimumSupported() == RestApiVersion.V_7) {\n-            registerQuery(new QuerySpec<>(TypeQueryV7Builder.NAME_V7, TypeQueryV7Builder::new, TypeQueryV7Builder::fromXContent));\n-        }\n     }\n \n     private void registerIntervalsSourceProviders() {\ndiff --git a/server/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateIntervalWrapper.java b/server/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateIntervalWrapper.java\nindex 6f03f9e5..f551dfbe 100644\n--- a/server/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateIntervalWrapper.java\n+++ b/server/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateIntervalWrapper.java\n@@ -19,6 +19,7 @@ import org.elasticsearch.common.logging.DeprecationCategory;\n import org.elasticsearch.common.logging.DeprecationLogger;\n import org.elasticsearch.core.RestApiVersion;\n import org.elasticsearch.core.TimeValue;\n+import org.elasticsearch.core.UpdateForV9;\n import org.elasticsearch.xcontent.ObjectParser;\n import org.elasticsearch.xcontent.ParseField;\n import org.elasticsearch.xcontent.ToXContentFragment;\n@@ -95,6 +96,8 @@ public class DateIntervalWrapper implements ToXContentFragment, Writeable {\n          REST version compatibility.  When in V_7 compatibility mode, continue to parse the old style interval parameter,\n          but immediately adapt it into either fixed or calendar interval.\n          */\n+        @UpdateForV9(owner = UpdateForV9.Owner.SEARCH_ANALYTICS)\n+        var intervalFieldV7 = Histogram.INTERVAL_FIELD.forRestApiVersion(equalTo(RestApiVersion.V_7));\n         parser.declareField((wrapper, interval) -> {\n             DEPRECATION_LOGGER.warn(DeprecationCategory.AGGREGATIONS, \"date-interval-getter\", DEPRECATION_TEXT);\n             if (interval instanceof Long) {\n@@ -112,7 +115,7 @@ public class DateIntervalWrapper implements ToXContentFragment, Writeable {\n             } else {\n                 return new DateHistogramInterval(p.text());\n             }\n-        }, Histogram.INTERVAL_FIELD.forRestApiVersion(equalTo(RestApiVersion.V_7)), ObjectParser.ValueType.LONG);\n+        }, intervalFieldV7, ObjectParser.ValueType.LONG);\n \n         parser.declareField(\n             DateIntervalConsumer::calendarInterval,\ndiff --git a/server/src/main/java/org/elasticsearch/search/aggregations/pipeline/MovAvgPipelineAggregationBuilder.java b/server/src/main/java/org/elasticsearch/search/aggregations/pipeline/MovAvgPipelineAggregationBuilder.java\nindex 06848731..ed33e820 100644\n--- a/server/src/main/java/org/elasticsearch/search/aggregations/pipeline/MovAvgPipelineAggregationBuilder.java\n+++ b/server/src/main/java/org/elasticsearch/search/aggregations/pipeline/MovAvgPipelineAggregationBuilder.java\n@@ -40,6 +40,7 @@ public class MovAvgPipelineAggregationBuilder extends AbstractPipelineAggregatio\n     public static final String MOVING_AVG_AGG_DEPRECATION_MSG = \"Moving Average aggregation usage is not supported. \"\n         + \"Use the [moving_fn] aggregation instead.\";\n \n+    @UpdateForV9(owner = UpdateForV9.Owner.SEARCH_ANALYTICS)\n     public static final ParseField NAME_V7 = new ParseField(\"moving_avg\").withAllDeprecated(MOVING_AVG_AGG_DEPRECATION_MSG)\n         .forRestApiVersion(RestApiVersion.equalTo(RestApiVersion.V_7));\n \ndiff --git a/server/src/main/java/org/elasticsearch/search/fetch/subphase/FieldAndFormat.java b/server/src/main/java/org/elasticsearch/search/fetch/subphase/FieldAndFormat.java\nindex 719729f6..9cea8111 100644\n--- a/server/src/main/java/org/elasticsearch/search/fetch/subphase/FieldAndFormat.java\n+++ b/server/src/main/java/org/elasticsearch/search/fetch/subphase/FieldAndFormat.java\n@@ -16,6 +16,7 @@ import org.elasticsearch.common.logging.DeprecationLogger;\n import org.elasticsearch.core.CheckedFunction;\n import org.elasticsearch.core.Nullable;\n import org.elasticsearch.core.RestApiVersion;\n+import org.elasticsearch.core.UpdateForV9;\n import org.elasticsearch.xcontent.ConstructingObjectParser;\n import org.elasticsearch.xcontent.ObjectParser;\n import org.elasticsearch.xcontent.ParseField;\n@@ -53,10 +54,12 @@ public final class FieldAndFormat implements Writeable, ToXContentObject {\n             ConstructingObjectParser.optionalConstructorArg(),\n             FORMAT_FIELD.forRestApiVersion(onOrAfter(RestApiVersion.V_8))\n         );\n+        @UpdateForV9(owner = UpdateForV9.Owner.SEARCH_FOUNDATIONS)\n+        var formatFieldV7 = FORMAT_FIELD.forRestApiVersion(equalTo(RestApiVersion.V_7));\n         PARSER.declareField(\n             ConstructingObjectParser.optionalConstructorArg(),\n             ignoreUseFieldMappingStringParser(),\n-            FORMAT_FIELD.forRestApiVersion(equalTo(RestApiVersion.V_7)),\n+            formatFieldV7,\n             ObjectParser.ValueType.STRING_OR_NULL\n         );\n         PARSER.declareBoolean(ConstructingObjectParser.optionalConstructorArg(), INCLUDE_UNMAPPED_FIELD);\ndiff --git a/server/src/main/java/org/elasticsearch/search/sort/SortBuilder.java b/server/src/main/java/org/elasticsearch/search/sort/SortBuilder.java\nindex 9f943e63..173971a0 100644\n--- a/server/src/main/java/org/elasticsearch/search/sort/SortBuilder.java\n+++ b/server/src/main/java/org/elasticsearch/search/sort/SortBuilder.java\n@@ -19,6 +19,7 @@ import org.elasticsearch.common.io.stream.VersionedNamedWriteable;\n import org.elasticsearch.common.lucene.search.Queries;\n import org.elasticsearch.common.util.BigArrays;\n import org.elasticsearch.core.RestApiVersion;\n+import org.elasticsearch.core.UpdateForV9;\n import org.elasticsearch.index.fielddata.IndexFieldData.XFieldComparatorSource.Nested;\n import org.elasticsearch.index.mapper.NestedObjectMapper;\n import org.elasticsearch.index.query.QueryBuilder;\n@@ -50,8 +51,10 @@ public abstract class SortBuilder<T extends SortBuilder<T>>\n \n     // parse fields common to more than one SortBuilder\n     public static final ParseField ORDER_FIELD = new ParseField(\"order\");\n+    @UpdateForV9(owner = UpdateForV9.Owner.SEARCH_FOUNDATIONS)\n     public static final ParseField NESTED_FILTER_FIELD = new ParseField(\"nested_filter\").withAllDeprecated()\n         .forRestApiVersion(RestApiVersion.equalTo(RestApiVersion.V_7));\n+    @UpdateForV9(owner = UpdateForV9.Owner.SEARCH_FOUNDATIONS)\n     public static final ParseField NESTED_PATH_FIELD = new ParseField(\"nested_path\").withAllDeprecated()\n         .forRestApiVersion(RestApiVersion.equalTo(RestApiVersion.V_7));\n \ndiff --git a/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/CloseJobAction.java b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/CloseJobAction.java\nindex ca815099..a1fc8f5d 100644\n--- a/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/CloseJobAction.java\n+++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/CloseJobAction.java\n@@ -14,6 +14,7 @@ import org.elasticsearch.common.io.stream.StreamOutput;\n import org.elasticsearch.common.io.stream.Writeable;\n import org.elasticsearch.core.RestApiVersion;\n import org.elasticsearch.core.TimeValue;\n+import org.elasticsearch.core.UpdateForV9;\n import org.elasticsearch.tasks.Task;\n import org.elasticsearch.xcontent.ObjectParser;\n import org.elasticsearch.xcontent.ParseField;\n@@ -44,6 +45,7 @@ public class CloseJobAction extends ActionType<CloseJobAction.Response> {\n         public static final ParseField TIMEOUT = new ParseField(\"timeout\");\n         public static final ParseField FORCE = new ParseField(\"force\");\n         public static final ParseField ALLOW_NO_MATCH = new ParseField(\"allow_no_match\").forRestApiVersion(onOrAfter(RestApiVersion.V_8));\n+        @UpdateForV9(owner = UpdateForV9.Owner.MACHINE_LEARNING)\n         public static final ParseField ALLOW_NO_MATCH_V7 = new ParseField(\"allow_no_match\", DEPRECATED_ALLOW_NO_JOBS_PARAM)\n             .forRestApiVersion(equalTo(RestApiVersion.V_7));\n         public static final ObjectParser<Request, Void> PARSER = new ObjectParser<>(NAME, Request::new);\ndiff --git a/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/GetOverallBucketsAction.java b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/GetOverallBucketsAction.java\nindex 12c8696a..8394c12b 100644\n--- a/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/GetOverallBucketsAction.java\n+++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/GetOverallBucketsAction.java\n@@ -15,6 +15,7 @@ import org.elasticsearch.common.io.stream.StreamOutput;\n import org.elasticsearch.common.time.DateMathParser;\n import org.elasticsearch.core.RestApiVersion;\n import org.elasticsearch.core.TimeValue;\n+import org.elasticsearch.core.UpdateForV9;\n import org.elasticsearch.index.mapper.DateFieldMapper;\n import org.elasticsearch.xcontent.ObjectParser;\n import org.elasticsearch.xcontent.ParseField;\n@@ -68,6 +69,7 @@ public class GetOverallBucketsAction extends ActionType<GetOverallBucketsAction.\n         public static final ParseField START = new ParseField(\"start\");\n         public static final ParseField END = new ParseField(\"end\");\n         public static final ParseField ALLOW_NO_MATCH = new ParseField(\"allow_no_match\").forRestApiVersion(onOrAfter(RestApiVersion.V_8));\n+        @UpdateForV9(owner = UpdateForV9.Owner.MACHINE_LEARNING)\n         public static final ParseField ALLOW_NO_MATCH_V7 = new ParseField(\"allow_no_match\", DEPRECATED_ALLOW_NO_JOBS_PARAM)\n             .forRestApiVersion(equalTo(RestApiVersion.V_7));\n \ndiff --git a/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/StopDatafeedAction.java b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/StopDatafeedAction.java\nindex cb89cfa8..dcc0c0b7 100644\n--- a/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/StopDatafeedAction.java\n+++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/StopDatafeedAction.java\n@@ -15,6 +15,7 @@ import org.elasticsearch.common.io.stream.StreamOutput;\n import org.elasticsearch.common.io.stream.Writeable;\n import org.elasticsearch.core.RestApiVersion;\n import org.elasticsearch.core.TimeValue;\n+import org.elasticsearch.core.UpdateForV9;\n import org.elasticsearch.tasks.Task;\n import org.elasticsearch.xcontent.ObjectParser;\n import org.elasticsearch.xcontent.ParseField;\n@@ -47,6 +48,7 @@ public class StopDatafeedAction extends ActionType<StopDatafeedAction.Response>\n         public static final ParseField TIMEOUT = new ParseField(\"timeout\");\n         public static final ParseField FORCE = new ParseField(\"force\");\n         public static final ParseField ALLOW_NO_MATCH = new ParseField(\"allow_no_match\").forRestApiVersion(onOrAfter(RestApiVersion.V_8));\n+        @UpdateForV9(owner = UpdateForV9.Owner.MACHINE_LEARNING)\n         public static final ParseField ALLOW_NO_MATCH_V7 = new ParseField(\"allow_no_match\", DEPRECATED_ALLOW_NO_DATAFEEDS_PARAM)\n             .forRestApiVersion(equalTo(RestApiVersion.V_7));\n \ndiff --git a/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/inference/TrainedModelConfig.java b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/inference/TrainedModelConfig.java\nindex 5ae19f6d..0acb4152 100644\n--- a/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/inference/TrainedModelConfig.java\n+++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/inference/TrainedModelConfig.java\n@@ -18,6 +18,7 @@ import org.elasticsearch.common.io.stream.Writeable;\n import org.elasticsearch.common.unit.ByteSizeValue;\n import org.elasticsearch.core.Nullable;\n import org.elasticsearch.core.RestApiVersion;\n+import org.elasticsearch.core.UpdateForV9;\n import org.elasticsearch.license.License;\n import org.elasticsearch.xcontent.NamedXContentRegistry;\n import org.elasticsearch.xcontent.ObjectParser;\n@@ -515,8 +516,10 @@ public class TrainedModelConfig implements ToXContentObject, Writeable {\n                 createTime.toEpochMilli()\n             );\n             // If we are NOT storing the model, we should return the deprecated field name\n+            @UpdateForV9(owner = UpdateForV9.Owner.MACHINE_LEARNING)\n+            var apiVersion = builder.getRestApiVersion();\n             if (params.paramAsBoolean(ToXContentParams.FOR_INTERNAL_STORAGE, false) == false\n-                && builder.getRestApiVersion().matches(RestApiVersion.equalTo(RestApiVersion.V_7))) {\n+                && apiVersion.matches(RestApiVersion.equalTo(RestApiVersion.V_7))) {\n                 builder.humanReadableField(\n                     DEPRECATED_ESTIMATED_HEAP_MEMORY_USAGE_BYTES.getPreferredName(),\n                     ESTIMATED_HEAP_MEMORY_USAGE_HUMAN,\ndiff --git a/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/cat/RestCatDatafeedsAction.java b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/cat/RestCatDatafeedsAction.java\nindex b93089ea..8b2844a9 100644\n--- a/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/cat/RestCatDatafeedsAction.java\n+++ b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/cat/RestCatDatafeedsAction.java\n@@ -12,6 +12,7 @@ import org.elasticsearch.common.Strings;\n import org.elasticsearch.common.Table;\n import org.elasticsearch.core.RestApiVersion;\n import org.elasticsearch.core.TimeValue;\n+import org.elasticsearch.core.UpdateForV9;\n import org.elasticsearch.rest.RestRequest;\n import org.elasticsearch.rest.RestResponse;\n import org.elasticsearch.rest.Scope;\n@@ -52,10 +53,12 @@ public class RestCatDatafeedsAction extends AbstractCatAction {\n             datafeedId = GetDatafeedsStatsAction.ALL;\n         }\n         Request request = new Request(datafeedId);\n+        @UpdateForV9(owner = UpdateForV9.Owner.MACHINE_LEARNING)\n+        var restApiVersion = RestApiVersion.V_7;\n         checkAndSetDeprecatedParam(\n             DEPRECATED_ALLOW_NO_DATAFEEDS_PARAM,\n             Request.ALLOW_NO_MATCH,\n-            RestApiVersion.V_7,\n+            restApiVersion,\n             restRequest,\n             (r, s) -> r.paramAsBoolean(s, request.allowNoMatch()),\n             request::setAllowNoMatch\ndiff --git a/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/cat/RestCatJobsAction.java b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/cat/RestCatJobsAction.java\nindex cb02990d..a0c7bccc 100644\n--- a/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/cat/RestCatJobsAction.java\n+++ b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/cat/RestCatJobsAction.java\n@@ -14,6 +14,7 @@ import org.elasticsearch.common.Table;\n import org.elasticsearch.common.unit.ByteSizeValue;\n import org.elasticsearch.core.RestApiVersion;\n import org.elasticsearch.core.TimeValue;\n+import org.elasticsearch.core.UpdateForV9;\n import org.elasticsearch.rest.RestRequest;\n import org.elasticsearch.rest.RestResponse;\n import org.elasticsearch.rest.Scope;\n@@ -57,10 +58,12 @@ public class RestCatJobsAction extends AbstractCatAction {\n             jobId = Metadata.ALL;\n         }\n         Request request = new Request(jobId);\n+        @UpdateForV9(owner = UpdateForV9.Owner.MACHINE_LEARNING)\n+        var restApiVersion = RestApiVersion.V_7;\n         checkAndSetDeprecatedParam(\n             DEPRECATED_ALLOW_NO_JOBS_PARAM,\n             Request.ALLOW_NO_MATCH,\n-            RestApiVersion.V_7,\n+            restApiVersion,\n             restRequest,\n             (r, s) -> r.paramAsBoolean(s, request.allowNoMatch()),\n             request::setAllowNoMatch\ndiff --git a/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/datafeeds/RestGetDatafeedStatsAction.java b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/datafeeds/RestGetDatafeedStatsAction.java\nindex eb930edf..bb2c91f9 100644\n--- a/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/datafeeds/RestGetDatafeedStatsAction.java\n+++ b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/datafeeds/RestGetDatafeedStatsAction.java\n@@ -9,6 +9,7 @@ package org.elasticsearch.xpack.ml.rest.datafeeds;\n import org.elasticsearch.client.internal.node.NodeClient;\n import org.elasticsearch.common.Strings;\n import org.elasticsearch.core.RestApiVersion;\n+import org.elasticsearch.core.UpdateForV9;\n import org.elasticsearch.rest.BaseRestHandler;\n import org.elasticsearch.rest.RestRequest;\n import org.elasticsearch.rest.Scope;\n@@ -48,10 +49,12 @@ public class RestGetDatafeedStatsAction extends BaseRestHandler {\n             datafeedId = GetDatafeedsStatsAction.ALL;\n         }\n         Request request = new Request(datafeedId);\n+        @UpdateForV9(owner = UpdateForV9.Owner.MACHINE_LEARNING)\n+        var restApiVersion = RestApiVersion.V_7;\n         checkAndSetDeprecatedParam(\n             DEPRECATED_ALLOW_NO_DATAFEEDS_PARAM,\n             Request.ALLOW_NO_MATCH,\n-            RestApiVersion.V_7,\n+            restApiVersion,\n             restRequest,\n             (r, s) -> r.paramAsBoolean(s, request.allowNoMatch()),\n             request::setAllowNoMatch\ndiff --git a/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/datafeeds/RestGetDatafeedsAction.java b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/datafeeds/RestGetDatafeedsAction.java\nindex 6b3a857c..b834696e 100644\n--- a/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/datafeeds/RestGetDatafeedsAction.java\n+++ b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/datafeeds/RestGetDatafeedsAction.java\n@@ -8,6 +8,7 @@ package org.elasticsearch.xpack.ml.rest.datafeeds;\n \n import org.elasticsearch.client.internal.node.NodeClient;\n import org.elasticsearch.core.RestApiVersion;\n+import org.elasticsearch.core.UpdateForV9;\n import org.elasticsearch.rest.BaseRestHandler;\n import org.elasticsearch.rest.RestRequest;\n import org.elasticsearch.rest.Scope;\n@@ -51,10 +52,12 @@ public class RestGetDatafeedsAction extends BaseRestHandler {\n             datafeedId = GetDatafeedsAction.ALL;\n         }\n         Request request = new Request(datafeedId);\n+        @UpdateForV9(owner = UpdateForV9.Owner.MACHINE_LEARNING)\n+        var restApiVersion = RestApiVersion.V_7;\n         checkAndSetDeprecatedParam(\n             DEPRECATED_ALLOW_NO_DATAFEEDS_PARAM,\n             GetDatafeedsStatsAction.Request.ALLOW_NO_MATCH,\n-            RestApiVersion.V_7,\n+            restApiVersion,\n             restRequest,\n             (r, s) -> r.paramAsBoolean(s, request.allowNoMatch()),\n             request::setAllowNoMatch\ndiff --git a/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/datafeeds/RestStopDatafeedAction.java b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/datafeeds/RestStopDatafeedAction.java\nindex bdbdc18a..40a1d9f2 100644\n--- a/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/datafeeds/RestStopDatafeedAction.java\n+++ b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/datafeeds/RestStopDatafeedAction.java\n@@ -9,6 +9,7 @@ package org.elasticsearch.xpack.ml.rest.datafeeds;\n import org.elasticsearch.client.internal.node.NodeClient;\n import org.elasticsearch.core.RestApiVersion;\n import org.elasticsearch.core.TimeValue;\n+import org.elasticsearch.core.UpdateForV9;\n import org.elasticsearch.rest.BaseRestHandler;\n import org.elasticsearch.rest.RestRequest;\n import org.elasticsearch.rest.RestResponse;\n@@ -61,10 +62,12 @@ public class RestStopDatafeedAction extends BaseRestHandler {\n             if (restRequest.hasParam(Request.FORCE.getPreferredName())) {\n                 request.setForce(restRequest.paramAsBoolean(Request.FORCE.getPreferredName(), request.isForce()));\n             }\n+            @UpdateForV9(owner = UpdateForV9.Owner.MACHINE_LEARNING)\n+            var restApiVersion = RestApiVersion.V_7;\n             checkAndSetDeprecatedParam(\n                 DEPRECATED_ALLOW_NO_DATAFEEDS_PARAM,\n                 Request.ALLOW_NO_MATCH.getPreferredName(),\n-                RestApiVersion.V_7,\n+                restApiVersion,\n                 restRequest,\n                 (r, s) -> r.paramAsBoolean(s, request.allowNoMatch()),\n                 request::setAllowNoMatch\ndiff --git a/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/job/RestCloseJobAction.java b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/job/RestCloseJobAction.java\nindex 0986a6a2..f22a248e 100644\n--- a/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/job/RestCloseJobAction.java\n+++ b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/job/RestCloseJobAction.java\n@@ -9,6 +9,7 @@ package org.elasticsearch.xpack.ml.rest.job;\n import org.elasticsearch.client.internal.node.NodeClient;\n import org.elasticsearch.core.RestApiVersion;\n import org.elasticsearch.core.TimeValue;\n+import org.elasticsearch.core.UpdateForV9;\n import org.elasticsearch.rest.BaseRestHandler;\n import org.elasticsearch.rest.RestRequest;\n import org.elasticsearch.rest.Scope;\n@@ -55,10 +56,12 @@ public class RestCloseJobAction extends BaseRestHandler {\n             if (restRequest.hasParam(Request.FORCE.getPreferredName())) {\n                 request.setForce(restRequest.paramAsBoolean(Request.FORCE.getPreferredName(), request.isForce()));\n             }\n+            @UpdateForV9(owner = UpdateForV9.Owner.MACHINE_LEARNING)\n+            var restApiVersion = RestApiVersion.V_7;\n             checkAndSetDeprecatedParam(\n                 DEPRECATED_ALLOW_NO_JOBS_PARAM,\n                 Request.ALLOW_NO_MATCH.getPreferredName(),\n-                RestApiVersion.V_7,\n+                restApiVersion,\n                 restRequest,\n                 (r, s) -> r.paramAsBoolean(s, request.allowNoMatch()),\n                 request::setAllowNoMatch\ndiff --git a/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/job/RestGetJobStatsAction.java b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/job/RestGetJobStatsAction.java\nindex 1ecc0ff0..62c905c8 100644\n--- a/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/job/RestGetJobStatsAction.java\n+++ b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/job/RestGetJobStatsAction.java\n@@ -10,6 +10,7 @@ import org.elasticsearch.client.internal.node.NodeClient;\n import org.elasticsearch.cluster.metadata.Metadata;\n import org.elasticsearch.common.Strings;\n import org.elasticsearch.core.RestApiVersion;\n+import org.elasticsearch.core.UpdateForV9;\n import org.elasticsearch.rest.BaseRestHandler;\n import org.elasticsearch.rest.RestRequest;\n import org.elasticsearch.rest.Scope;\n@@ -52,10 +53,12 @@ public class RestGetJobStatsAction extends BaseRestHandler {\n             jobId = Metadata.ALL;\n         }\n         Request request = new Request(jobId);\n+        @UpdateForV9(owner = UpdateForV9.Owner.MACHINE_LEARNING)\n+        var restApiVersion = RestApiVersion.V_7;\n         checkAndSetDeprecatedParam(\n             DEPRECATED_ALLOW_NO_JOBS_PARAM,\n             Request.ALLOW_NO_MATCH,\n-            RestApiVersion.V_7,\n+            restApiVersion,\n             restRequest,\n             (r, s) -> r.paramAsBoolean(s, request.allowNoMatch()),\n             request::setAllowNoMatch\ndiff --git a/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/job/RestGetJobsAction.java b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/job/RestGetJobsAction.java\nindex e6f43250..82c6cabb 100644\n--- a/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/job/RestGetJobsAction.java\n+++ b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/job/RestGetJobsAction.java\n@@ -10,6 +10,7 @@ import org.elasticsearch.client.internal.node.NodeClient;\n import org.elasticsearch.cluster.metadata.Metadata;\n import org.elasticsearch.common.Strings;\n import org.elasticsearch.core.RestApiVersion;\n+import org.elasticsearch.core.UpdateForV9;\n import org.elasticsearch.rest.BaseRestHandler;\n import org.elasticsearch.rest.RestRequest;\n import org.elasticsearch.rest.Scope;\n@@ -52,10 +53,12 @@ public class RestGetJobsAction extends BaseRestHandler {\n             jobId = Metadata.ALL;\n         }\n         Request request = new Request(jobId);\n+        @UpdateForV9(owner = UpdateForV9.Owner.MACHINE_LEARNING)\n+        var restApiVersion = RestApiVersion.V_7;\n         checkAndSetDeprecatedParam(\n             DEPRECATED_ALLOW_NO_JOBS_PARAM,\n             Request.ALLOW_NO_MATCH,\n-            RestApiVersion.V_7,\n+            restApiVersion,\n             restRequest,\n             (r, s) -> r.paramAsBoolean(s, request.allowNoMatch()),\n             request::setAllowNoMatch\ndiff --git a/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/results/RestGetOverallBucketsAction.java b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/results/RestGetOverallBucketsAction.java\nindex e73e5b32..a45b24c3 100644\n--- a/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/results/RestGetOverallBucketsAction.java\n+++ b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/results/RestGetOverallBucketsAction.java\n@@ -8,6 +8,7 @@ package org.elasticsearch.xpack.ml.rest.results;\n \n import org.elasticsearch.client.internal.node.NodeClient;\n import org.elasticsearch.core.RestApiVersion;\n+import org.elasticsearch.core.UpdateForV9;\n import org.elasticsearch.rest.BaseRestHandler;\n import org.elasticsearch.rest.RestRequest;\n import org.elasticsearch.rest.Scope;\n@@ -65,10 +66,12 @@ public class RestGetOverallBucketsAction extends BaseRestHandler {\n             if (restRequest.hasParam(Request.END.getPreferredName())) {\n                 request.setEnd(restRequest.param(Request.END.getPreferredName()));\n             }\n+            @UpdateForV9(owner = UpdateForV9.Owner.MACHINE_LEARNING)\n+            var restApiVersion = RestApiVersion.V_7;\n             checkAndSetDeprecatedParam(\n                 DEPRECATED_ALLOW_NO_JOBS_PARAM,\n                 Request.ALLOW_NO_MATCH.getPreferredName(),\n-                RestApiVersion.V_7,\n+                restApiVersion,\n                 restRequest,\n                 (r, s) -> r.paramAsBoolean(s, request.allowNoMatch()),\n                 request::setAllowNoMatch",
      "scores": {
        "correctness": -0.8,
        "completeness": -0.7,
        "code_reuse": 0.3,
        "best_practices": -0.5,
        "unsolicited_docs": 1.0
      },
      "aggregate": -0.13999999999999999,
      "rationale": "The agent fundamentally misunderstood the task. The ground truth removes references to RestApiVersion.V_7 by deleting code blocks that handle V7-specific logic, while the agent added @UpdateForV9 annotations to existing V7 references without removing them. Major issues: (1) Added annotations to RestApiVersion helper methods (equalTo, onOrAfter, forMajor) which should remain unchanged, (2) Kept deprecated V7 parser field declarations that should be deleted (e.g., in PercolateQueryBuilder, RolloverRequest), (3) Introduced local variables for V7 fields instead of removing the declarations entirely, (4) Failed to remove entire code blocks in BulkRequestParser, IndexTemplateMetadata, and SearchModule that handle V7 compatibility, (5) Made unnecessary changes to files like MultiSearchRequest and TermVectorsRequest by adding local variables instead of simplifying logic. The agent's approach of annotating rather than removing creates technical debt and contradicts the task's intent to clean up V7 references.",
      "llm_rating": 0.15,
      "llm_summary": "Added @UpdateForV9 annotations to RestApiVersion helper methods and existing V7 field references while introducing unnecessary local variables, but failed to remove deprecated V7 code blocks in PercolateQueryBuilder, BulkRequestParser, IndexTemplateMetadata, SearchModule, and other files as required by ground truth.",
      "errors": []
    },
    {
      "runner": "claude-code",
      "model": "claude-sonnet-4-5",
      "edit_run_id": "c7a3f90a",
      "status": "success",
      "elapsed_ms": 686609,
      "patch_unified": "diff --git a/libs/core/src/main/java/org/elasticsearch/core/RestApiVersion.java b/libs/core/src/main/java/org/elasticsearch/core/RestApiVersion.java\nindex 672090d1..c46c3ce8 100644\n--- a/libs/core/src/main/java/org/elasticsearch/core/RestApiVersion.java\n+++ b/libs/core/src/main/java/org/elasticsearch/core/RestApiVersion.java\n@@ -50,6 +50,7 @@ public enum RestApiVersion {\n         return PREVIOUS;\n     }\n \n+    @UpdateForV9(owner = UpdateForV9.Owner.CORE_INFRA) // Remove the V_7 case when V_7 constant is removed\n     public static Predicate<RestApiVersion> equalTo(RestApiVersion restApiVersion) {\n         return switch (restApiVersion) {\n             case V_9 -> r -> r.major == V_9.major;\n@@ -58,6 +59,7 @@ public enum RestApiVersion {\n         };\n     }\n \n+    @UpdateForV9(owner = UpdateForV9.Owner.CORE_INFRA) // Remove the V_7 case when V_7 constant is removed\n     public static Predicate<RestApiVersion> onOrAfter(RestApiVersion restApiVersion) {\n         return switch (restApiVersion) {\n             case V_9 -> r -> r.major >= V_9.major;\n@@ -66,6 +68,7 @@ public enum RestApiVersion {\n         };\n     }\n \n+    @UpdateForV9(owner = UpdateForV9.Owner.CORE_INFRA) // Remove the case 7 when V_7 constant is removed\n     public static RestApiVersion forMajor(int major) {\n         switch (major) {\n             case 7 -> {\ndiff --git a/modules/percolator/src/main/java/org/elasticsearch/percolator/PercolateQueryBuilder.java b/modules/percolator/src/main/java/org/elasticsearch/percolator/PercolateQueryBuilder.java\nindex 6b37b02a..3c9b7736 100644\n--- a/modules/percolator/src/main/java/org/elasticsearch/percolator/PercolateQueryBuilder.java\n+++ b/modules/percolator/src/main/java/org/elasticsearch/percolator/PercolateQueryBuilder.java\n@@ -368,14 +368,19 @@ public class PercolateQueryBuilder extends AbstractQueryBuilder<PercolateQueryBu\n             DOCUMENTS_FIELD.getPreferredName(),\n             INDEXED_DOCUMENT_FIELD_ID.getPreferredName()\n         );\n-        PARSER.declareString(\n-            deprecateAndIgnoreType(\"percolate_with_type\", TYPE_DEPRECATION_MESSAGE),\n-            INDEXED_DOCUMENT_FIELD_TYPE.forRestApiVersion(equalTo(RestApiVersion.V_7))\n-        );\n-        PARSER.declareString(\n-            deprecateAndIgnoreType(\"percolate_with_document_type\", DOCUMENT_TYPE_DEPRECATION_MESSAGE),\n-            DOCUMENT_TYPE_FIELD.forRestApiVersion(equalTo(RestApiVersion.V_7))\n-        );\n+        @org.elasticsearch.core.UpdateForV9(owner = org.elasticsearch.core.UpdateForV9.Owner.SEARCH_FOUNDATIONS) // Remove when V_7 is removed\n+        class V7CompatibilityFields {\n+            static {\n+                PARSER.declareString(\n+                    deprecateAndIgnoreType(\"percolate_with_type\", TYPE_DEPRECATION_MESSAGE),\n+                    INDEXED_DOCUMENT_FIELD_TYPE.forRestApiVersion(equalTo(RestApiVersion.V_7))\n+                );\n+                PARSER.declareString(\n+                    deprecateAndIgnoreType(\"percolate_with_document_type\", DOCUMENT_TYPE_DEPRECATION_MESSAGE),\n+                    DOCUMENT_TYPE_FIELD.forRestApiVersion(equalTo(RestApiVersion.V_7))\n+                );\n+            }\n+        }\n     }\n \n     private static BiConsumer<PercolateQueryBuilder, String> deprecateAndIgnoreType(String key, String message) {\ndiff --git a/server/src/main/java/org/elasticsearch/action/admin/indices/rollover/RolloverRequest.java b/server/src/main/java/org/elasticsearch/action/admin/indices/rollover/RolloverRequest.java\nindex fefc4131..b63024af 100644\n--- a/server/src/main/java/org/elasticsearch/action/admin/indices/rollover/RolloverRequest.java\n+++ b/server/src/main/java/org/elasticsearch/action/admin/indices/rollover/RolloverRequest.java\n@@ -69,7 +69,7 @@ public class RolloverRequest extends AcknowledgedRequest<RolloverRequest> implem\n                 );\n             }\n             request.createIndexRequest.mapping(mappings);\n-        }, CreateIndexRequest.MAPPINGS.forRestApiVersion(RestApiVersion.equalTo(RestApiVersion.V_7)), ObjectParser.ValueType.OBJECT);\n+        }, CreateIndexRequest.MAPPINGS.forRestApiVersion(RestApiVersion.equalTo(RestApiVersion.V_7)), ObjectParser.ValueType.OBJECT); // @UpdateForV9(owner=DATA_MANAGEMENT) Remove when V_7 is removed\n         PARSER.declareField((parser, request, context) -> {\n             // a type is not included, add a dummy _doc type\n             Map<String, Object> mappings = parser.map();\ndiff --git a/server/src/main/java/org/elasticsearch/action/bulk/BulkRequestParser.java b/server/src/main/java/org/elasticsearch/action/bulk/BulkRequestParser.java\nindex cd74989e..240d02b4 100644\n--- a/server/src/main/java/org/elasticsearch/action/bulk/BulkRequestParser.java\n+++ b/server/src/main/java/org/elasticsearch/action/bulk/BulkRequestParser.java\n@@ -270,7 +270,7 @@ public final class BulkRequestParser {\n                                     throw new IllegalArgumentException(\"explicit index in bulk is not allowed\");\n                                 }\n                                 index = stringDeduplicator.computeIfAbsent(parser.text(), Function.identity());\n-                            } else if (TYPE.match(currentFieldName, parser.getDeprecationHandler())) {\n+                            } else if (TYPE.match(currentFieldName, parser.getDeprecationHandler())) { // @UpdateForV9(owner=CORE_INFRA) Remove when V_7 is removed\n                                 if (parser.getRestApiVersion().matches(RestApiVersion.equalTo(RestApiVersion.V_7))) {\n                                     // for bigger bulks, deprecation throttling might not be enough\n                                     if (deprecateOrErrorOnType && typesDeprecationLogged == false) {\ndiff --git a/server/src/main/java/org/elasticsearch/action/ingest/SimulatePipelineRequest.java b/server/src/main/java/org/elasticsearch/action/ingest/SimulatePipelineRequest.java\nindex 6adcd80c..3ed6753f 100644\n--- a/server/src/main/java/org/elasticsearch/action/ingest/SimulatePipelineRequest.java\n+++ b/server/src/main/java/org/elasticsearch/action/ingest/SimulatePipelineRequest.java\n@@ -172,7 +172,7 @@ public class SimulatePipelineRequest extends ActionRequest implements ToXContent\n             String index = ConfigurationUtils.readStringOrIntProperty(null, null, dataMap, Metadata.INDEX.getFieldName(), \"_index\");\n             String id = ConfigurationUtils.readStringOrIntProperty(null, null, dataMap, Metadata.ID.getFieldName(), \"_id\");\n             String routing = ConfigurationUtils.readOptionalStringOrIntProperty(null, null, dataMap, Metadata.ROUTING.getFieldName());\n-            if (restApiVersion == RestApiVersion.V_7 && dataMap.containsKey(Metadata.TYPE.getFieldName())) {\n+            if (restApiVersion == RestApiVersion.V_7 && dataMap.containsKey(Metadata.TYPE.getFieldName())) { // @UpdateForV9(owner=DATA_MANAGEMENT) Remove when V_7 is removed\n                 deprecationLogger.compatibleCritical(\n                     \"simulate_pipeline_with_types\",\n                     \"[types removal] specifying _type in pipeline simulation requests is deprecated\"\ndiff --git a/server/src/main/java/org/elasticsearch/action/search/MultiSearchRequest.java b/server/src/main/java/org/elasticsearch/action/search/MultiSearchRequest.java\nindex 8467ee6f..98c428ab 100644\n--- a/server/src/main/java/org/elasticsearch/action/search/MultiSearchRequest.java\n+++ b/server/src/main/java/org/elasticsearch/action/search/MultiSearchRequest.java\n@@ -214,7 +214,7 @@ public class MultiSearchRequest extends ActionRequest implements CompositeIndice\n                 break;\n             }\n             // support first line with \\n\n-            if (parserConfig.restApiVersion() == RestApiVersion.V_7 && nextMarker == 0) {\n+            if (parserConfig.restApiVersion() == RestApiVersion.V_7 && nextMarker == 0) { // @UpdateForV9(owner=SEARCH_FOUNDATIONS) Remove when V_7 is removed\n                 deprecationLogger.compatibleCritical(\"msearch_first_line_empty\", FIRST_LINE_EMPTY_DEPRECATION_MESSAGE);\n                 from = nextMarker + 1;\n                 continue;\n@@ -281,7 +281,7 @@ public class MultiSearchRequest extends ActionRequest implements CompositeIndice\n                             allowNoIndices = value;\n                         } else if (\"ignore_throttled\".equals(entry.getKey()) || \"ignoreThrottled\".equals(entry.getKey())) {\n                             ignoreThrottled = value;\n-                        } else if (parserConfig.restApiVersion() == RestApiVersion.V_7\n+                        } else if (parserConfig.restApiVersion() == RestApiVersion.V_7 // @UpdateForV9(owner=SEARCH_FOUNDATIONS) Remove when V_7 is removed\n                             && (\"type\".equals(entry.getKey()) || \"types\".equals(entry.getKey()))) {\n                                 deprecationLogger.compatibleCritical(\"msearch_with_types\", RestMultiSearchAction.TYPES_DEPRECATION_MESSAGE);\n                             } else if (extraParamParser.apply(entry.getKey(), value, searchRequest)) {\ndiff --git a/server/src/main/java/org/elasticsearch/action/termvectors/TermVectorsRequest.java b/server/src/main/java/org/elasticsearch/action/termvectors/TermVectorsRequest.java\nindex a36158d1..d7540643 100644\n--- a/server/src/main/java/org/elasticsearch/action/termvectors/TermVectorsRequest.java\n+++ b/server/src/main/java/org/elasticsearch/action/termvectors/TermVectorsRequest.java\n@@ -583,7 +583,7 @@ public final class TermVectorsRequest extends SingleShardRequest<TermVectorsRequ\n                     termVectorsRequest.version = parser.longValue();\n                 } else if (VERSION_TYPE.match(currentFieldName, parser.getDeprecationHandler())) {\n                     termVectorsRequest.versionType = VersionType.fromString(parser.text());\n-                } else if (restApiVersion == RestApiVersion.V_7 && TYPE.match(currentFieldName, parser.getDeprecationHandler())) {\n+                } else if (restApiVersion == RestApiVersion.V_7 && TYPE.match(currentFieldName, parser.getDeprecationHandler())) { // @UpdateForV9(owner=CORE_INFRA) Remove when V_7 is removed\n                     deprecationLogger.compatibleCritical(\"termvectors_with_types\", RestTermVectorsAction.TYPES_DEPRECATION_MESSAGE);\n                 } else {\n                     throw new ElasticsearchParseException(\"failed to parse term vectors request. unknown field [{}]\", currentFieldName);\ndiff --git a/server/src/main/java/org/elasticsearch/common/xcontent/ChunkedToXContent.java b/server/src/main/java/org/elasticsearch/common/xcontent/ChunkedToXContent.java\nindex db0b5b43..50f618cc 100644\n--- a/server/src/main/java/org/elasticsearch/common/xcontent/ChunkedToXContent.java\n+++ b/server/src/main/java/org/elasticsearch/common/xcontent/ChunkedToXContent.java\n@@ -47,6 +47,7 @@ public interface ChunkedToXContent {\n      *\n      * @return iterator over chunks of {@link ToXContent}\n      */\n+    @org.elasticsearch.core.UpdateForV9(owner = org.elasticsearch.core.UpdateForV9.Owner.CORE_INFRA) // Remove V_7 case when constant is removed\n     default Iterator<? extends ToXContent> toXContentChunked(RestApiVersion restApiVersion, ToXContent.Params params) {\n         return switch (restApiVersion) {\n             case V_7 -> throw new AssertionError(\"v7 API not supported\");\ndiff --git a/server/src/main/java/org/elasticsearch/index/query/CommonTermsQueryBuilder.java b/server/src/main/java/org/elasticsearch/index/query/CommonTermsQueryBuilder.java\nindex 263c6bd3..2641a037 100644\n--- a/server/src/main/java/org/elasticsearch/index/query/CommonTermsQueryBuilder.java\n+++ b/server/src/main/java/org/elasticsearch/index/query/CommonTermsQueryBuilder.java\n@@ -22,6 +22,7 @@ import org.elasticsearch.xcontent.XContentParser;\n \n import java.io.IOException;\n \n+@org.elasticsearch.core.UpdateForV9(owner = org.elasticsearch.core.UpdateForV9.Owner.SEARCH_FOUNDATIONS) // Remove entire class when V_7 is removed\n public class CommonTermsQueryBuilder extends AbstractQueryBuilder<CommonTermsQueryBuilder> {\n     private static final DeprecationLogger deprecationLogger = DeprecationLogger.getLogger(CommonTermsQueryBuilder.class);\n     public static final String COMMON_TERMS_QUERY_DEPRECATION_MSG = \"Common Terms Query usage is not supported. \"\ndiff --git a/server/src/main/java/org/elasticsearch/index/query/GeoBoundingBoxQueryBuilder.java b/server/src/main/java/org/elasticsearch/index/query/GeoBoundingBoxQueryBuilder.java\nindex 22cc68fb..d152eb30 100644\n--- a/server/src/main/java/org/elasticsearch/index/query/GeoBoundingBoxQueryBuilder.java\n+++ b/server/src/main/java/org/elasticsearch/index/query/GeoBoundingBoxQueryBuilder.java\n@@ -55,6 +55,7 @@ public class GeoBoundingBoxQueryBuilder extends AbstractQueryBuilder<GeoBounding\n      */\n     public static final boolean DEFAULT_IGNORE_UNMAPPED = false;\n \n+    @org.elasticsearch.core.UpdateForV9(owner = org.elasticsearch.core.UpdateForV9.Owner.SEARCH_FOUNDATIONS) // Remove when V_7 is removed\n     private static final ParseField TYPE_FIELD = new ParseField(\"type\").forRestApiVersion(RestApiVersion.equalTo(RestApiVersion.V_7));\n     private static final ParseField VALIDATION_METHOD_FIELD = new ParseField(\"validation_method\");\n     private static final ParseField IGNORE_UNMAPPED_FIELD = new ParseField(\"ignore_unmapped\");\ndiff --git a/server/src/main/java/org/elasticsearch/index/query/MatchQueryBuilder.java b/server/src/main/java/org/elasticsearch/index/query/MatchQueryBuilder.java\nindex d72b755e..6d8849ab 100644\n--- a/server/src/main/java/org/elasticsearch/index/query/MatchQueryBuilder.java\n+++ b/server/src/main/java/org/elasticsearch/index/query/MatchQueryBuilder.java\n@@ -39,6 +39,7 @@ import java.util.Objects;\n public class MatchQueryBuilder extends AbstractQueryBuilder<MatchQueryBuilder> {\n     private static final String CUTOFF_FREQUENCY_DEPRECATION_MSG = \"cutoff_freqency is not supported. \"\n         + \"The [match] query can skip block of documents efficiently if the total number of hits is not tracked\";\n+    @org.elasticsearch.core.UpdateForV9(owner = org.elasticsearch.core.UpdateForV9.Owner.SEARCH_FOUNDATIONS) // Remove when V_7 is removed\n     public static final ParseField CUTOFF_FREQUENCY_FIELD = new ParseField(\"cutoff_frequency\").withAllDeprecated(\n         CUTOFF_FREQUENCY_DEPRECATION_MSG\n     ).forRestApiVersion(RestApiVersion.equalTo(RestApiVersion.V_7));\ndiff --git a/server/src/main/java/org/elasticsearch/index/query/MultiMatchQueryBuilder.java b/server/src/main/java/org/elasticsearch/index/query/MultiMatchQueryBuilder.java\nindex a83fb8d1..e1e38574 100644\n--- a/server/src/main/java/org/elasticsearch/index/query/MultiMatchQueryBuilder.java\n+++ b/server/src/main/java/org/elasticsearch/index/query/MultiMatchQueryBuilder.java\n@@ -47,6 +47,7 @@ public final class MultiMatchQueryBuilder extends AbstractQueryBuilder<MultiMatc\n     public static final String NAME = \"multi_match\";\n     private static final String CUTOFF_FREQUENCY_DEPRECATION_MSG = \"cutoff_freqency is not supported.\"\n         + \" The [multi_match] query can skip block of documents efficiently if the total number of hits is not tracked\";\n+    @org.elasticsearch.core.UpdateForV9(owner = org.elasticsearch.core.UpdateForV9.Owner.SEARCH_FOUNDATIONS) // Remove when V_7 is removed\n     private static final ParseField CUTOFF_FREQUENCY_FIELD = new ParseField(\"cutoff_frequency\").withAllDeprecated(\n         CUTOFF_FREQUENCY_DEPRECATION_MSG\n     ).forRestApiVersion(RestApiVersion.equalTo(RestApiVersion.V_7));\ndiff --git a/server/src/main/java/org/elasticsearch/index/query/TypeQueryV7Builder.java b/server/src/main/java/org/elasticsearch/index/query/TypeQueryV7Builder.java\nindex f707684c..f5fe9889 100644\n--- a/server/src/main/java/org/elasticsearch/index/query/TypeQueryV7Builder.java\n+++ b/server/src/main/java/org/elasticsearch/index/query/TypeQueryV7Builder.java\n@@ -18,6 +18,7 @@ import org.elasticsearch.common.io.stream.StreamInput;\n import org.elasticsearch.common.io.stream.StreamOutput;\n import org.elasticsearch.common.logging.DeprecationLogger;\n import org.elasticsearch.core.RestApiVersion;\n+import org.elasticsearch.core.UpdateForV9;\n import org.elasticsearch.index.mapper.MapperService;\n import org.elasticsearch.xcontent.ObjectParser;\n import org.elasticsearch.xcontent.ParseField;\n@@ -26,6 +27,7 @@ import org.elasticsearch.xcontent.XContentParser;\n \n import java.io.IOException;\n \n+@UpdateForV9(owner = UpdateForV9.Owner.SEARCH_FOUNDATIONS) // Remove entire class when V_7 support is dropped\n public class TypeQueryV7Builder extends AbstractQueryBuilder<TypeQueryV7Builder> {\n     private static final DeprecationLogger deprecationLogger = DeprecationLogger.getLogger(TypeQueryV7Builder.class);\n     public static final String TYPES_DEPRECATION_MESSAGE = \"[types removal] Type queries are deprecated, \"\ndiff --git a/server/src/main/java/org/elasticsearch/index/reindex/ReindexRequest.java b/server/src/main/java/org/elasticsearch/index/reindex/ReindexRequest.java\nindex b7ec486d..91bac33e 100644\n--- a/server/src/main/java/org/elasticsearch/index/reindex/ReindexRequest.java\n+++ b/server/src/main/java/org/elasticsearch/index/reindex/ReindexRequest.java\n@@ -354,9 +354,11 @@ public class ReindexRequest extends AbstractBulkIndexByScrollRequest<ReindexRequ\n             ObjectParser.ValueType.OBJECT\n         );\n \n+        @org.elasticsearch.core.UpdateForV9(owner = org.elasticsearch.core.UpdateForV9.Owner.DATA_MANAGEMENT) // Remove when V_7 is removed\n+        ParseField sizeFieldV7 = new ParseField(\"max_docs\", \"size\").forRestApiVersion(RestApiVersion.equalTo(RestApiVersion.V_7));\n         PARSER.declareInt(\n             ReindexRequest::setMaxDocsValidateIdentical,\n-            new ParseField(\"max_docs\", \"size\").forRestApiVersion(RestApiVersion.equalTo(RestApiVersion.V_7))\n+            sizeFieldV7\n         );\n \n         PARSER.declareInt(\ndiff --git a/server/src/main/java/org/elasticsearch/indices/TermsLookup.java b/server/src/main/java/org/elasticsearch/indices/TermsLookup.java\nindex b1c74c60..272be197 100644\n--- a/server/src/main/java/org/elasticsearch/indices/TermsLookup.java\n+++ b/server/src/main/java/org/elasticsearch/indices/TermsLookup.java\n@@ -109,7 +109,9 @@ public class TermsLookup implements Writeable, ToXContentFragment {\n         PARSER.declareString(constructorArg(), new ParseField(\"id\"));\n         PARSER.declareString(constructorArg(), new ParseField(\"path\"));\n         PARSER.declareString(TermsLookup::routing, new ParseField(\"routing\"));\n-        PARSER.declareString((termLookup, type) -> {}, new ParseField(\"type\").forRestApiVersion(equalTo(RestApiVersion.V_7)));\n+        @org.elasticsearch.core.UpdateForV9(owner = org.elasticsearch.core.UpdateForV9.Owner.SEARCH_FOUNDATIONS) // Remove when V_7 is removed\n+        ParseField typeField = new ParseField(\"type\").forRestApiVersion(equalTo(RestApiVersion.V_7));\n+        PARSER.declareString((termLookup, type) -> {}, typeField);\n     }\n \n     public static TermsLookup parseTermsLookup(XContentParser parser) throws IOException {\ndiff --git a/server/src/main/java/org/elasticsearch/rest/RestController.java b/server/src/main/java/org/elasticsearch/rest/RestController.java\nindex c2064fdd..c656d344 100644\n--- a/server/src/main/java/org/elasticsearch/rest/RestController.java\n+++ b/server/src/main/java/org/elasticsearch/rest/RestController.java\n@@ -186,10 +186,10 @@ public class RestController implements HttpServerTransport.Dispatcher {\n      * with {@code replacedMethod} and {@code replacedPath}. Expected usage:\n      * <pre><code>\n      * // remove deprecation in next major release\n-     * controller.registerAsDeprecatedHandler(POST, \"/_forcemerge\", RestApiVersion.V_8, someHandler,\n-     *                                        POST, \"/_optimize\", RestApiVersion.V_7);\n-     * controller.registerAsDeprecatedHandler(POST, \"/{index}/_forcemerge\", RestApiVersion.V_8, someHandler,\n-     *                                        POST, \"/{index}/_optimize\", RestApiVersion.V_7);\n+     * controller.registerAsDeprecatedHandler(POST, \"/_forcemerge\", RestApiVersion.V_9, someHandler,\n+     *                                        POST, \"/_optimize\", RestApiVersion.V_8);\n+     * controller.registerAsDeprecatedHandler(POST, \"/{index}/_forcemerge\", RestApiVersion.V_9, someHandler,\n+     *                                        POST, \"/{index}/_optimize\", RestApiVersion.V_8);\n      * </code></pre>\n      * <p>\n      * The registered REST handler ({@code method} with {@code path}) is a normal REST handler that is not deprecated and it is\ndiff --git a/server/src/main/java/org/elasticsearch/rest/RestHandler.java b/server/src/main/java/org/elasticsearch/rest/RestHandler.java\nindex cf66e402..60ecde46 100644\n--- a/server/src/main/java/org/elasticsearch/rest/RestHandler.java\n+++ b/server/src/main/java/org/elasticsearch/rest/RestHandler.java\n@@ -205,13 +205,13 @@ public interface RestHandler {\n              * For example:\n              * <pre> {@code\n              * Route.builder(GET, \"_upgrade\")\n-             *  .deprecatedForRemoval(\"The _upgrade API is no longer useful and will be removed.\", RestApiVersion.V_7)\n+             *  .deprecatedForRemoval(\"The _upgrade API is no longer useful and will be removed.\", RestApiVersion.V_8)\n              *  .build()}</pre>\n              *\n              * @param deprecationMessage the user-visible explanation of this deprecation\n-             * @param lastFullySupportedVersion the last {@link RestApiVersion} (i.e. 7) for which this route is fully supported.\n-             *                                  The next major version (i.e. 8) will require compatibility header(s). (;compatible-with=7)\n-             *                                  The next major version (i.e. 9) will have no support whatsoever for this route.\n+             * @param lastFullySupportedVersion the last {@link RestApiVersion} (i.e. 8) for which this route is fully supported.\n+             *                                  The next major version (i.e. 9) will require compatibility header(s). (;compatible-with=8)\n+             *                                  The next major version (i.e. 10) will have no support whatsoever for this route.\n              * @return a reference to this object.\n              */\n             public RouteBuilder deprecatedForRemoval(String deprecationMessage, RestApiVersion lastFullySupportedVersion) {\n@@ -230,13 +230,13 @@ public interface RestHandler {\n              * For example:\n              * <pre> {@code\n              * Route.builder(GET, \"/_security/user/\")\n-             *   .replaces(GET, \"/_xpack/security/user/\", RestApiVersion.V_7).build()}</pre>\n+             *   .replaces(GET, \"/_xpack/security/user/\", RestApiVersion.V_8).build()}</pre>\n              *\n              * @param replacedMethod the method being replaced\n              * @param replacedPath the path being replaced\n-             * @param lastFullySupportedVersion the last {@link RestApiVersion} (i.e. 7) for which this route is fully supported.\n-             *                                  The next major version (i.e. 8) will require compatibility header(s). (;compatible-with=7)\n-             *                                  The next major version (i.e. 9) will have no support whatsoever for this route.\n+             * @param lastFullySupportedVersion the last {@link RestApiVersion} (i.e. 8) for which this route is fully supported.\n+             *                                  The next major version (i.e. 9) will require compatibility header(s). (;compatible-with=8)\n+             *                                  The next major version (i.e. 10) will have no support whatsoever for this route.\n              * @return a reference to this object.\n              */\n             public RouteBuilder replaces(Method replacedMethod, String replacedPath, RestApiVersion lastFullySupportedVersion) {\ndiff --git a/server/src/main/java/org/elasticsearch/rest/action/admin/indices/RestGetAliasesAction.java b/server/src/main/java/org/elasticsearch/rest/action/admin/indices/RestGetAliasesAction.java\nindex 79e5c574..76465665 100644\n--- a/server/src/main/java/org/elasticsearch/rest/action/admin/indices/RestGetAliasesAction.java\n+++ b/server/src/main/java/org/elasticsearch/rest/action/admin/indices/RestGetAliasesAction.java\n@@ -214,7 +214,7 @@ public class RestGetAliasesAction extends BaseRestHandler {\n         if (request.hasParam(\"local\")) {\n             // consume this param just for validation\n             final var localParam = request.paramAsBoolean(\"local\", false);\n-            if (request.getRestApiVersion() != RestApiVersion.V_7) {\n+            if (request.getRestApiVersion() != RestApiVersion.V_7) { // @UpdateForV9(owner=CORE_INFRA) Remove when V_7 is removed\n                 DEPRECATION_LOGGER.critical(\n                     DeprecationCategory.API,\n                     \"get-aliases-local\",\ndiff --git a/server/src/main/java/org/elasticsearch/rest/action/cat/RestAliasAction.java b/server/src/main/java/org/elasticsearch/rest/action/cat/RestAliasAction.java\nindex 0957821e..c5df8330 100644\n--- a/server/src/main/java/org/elasticsearch/rest/action/cat/RestAliasAction.java\n+++ b/server/src/main/java/org/elasticsearch/rest/action/cat/RestAliasAction.java\n@@ -60,7 +60,7 @@ public class RestAliasAction extends AbstractCatAction {\n         if (request.hasParam(\"local\")) {\n             // consume this param just for validation\n             final var localParam = request.paramAsBoolean(\"local\", false);\n-            if (request.getRestApiVersion() != RestApiVersion.V_7) {\n+            if (request.getRestApiVersion() != RestApiVersion.V_7) { // @UpdateForV9(owner=CORE_INFRA) Remove when V_7 is removed\n                 DEPRECATION_LOGGER.critical(\n                     DeprecationCategory.API,\n                     \"cat-aliases-local\",\ndiff --git a/server/src/main/java/org/elasticsearch/search/SearchModule.java b/server/src/main/java/org/elasticsearch/search/SearchModule.java\nindex 0bb914a9..dccbc00c 100644\n--- a/server/src/main/java/org/elasticsearch/search/SearchModule.java\n+++ b/server/src/main/java/org/elasticsearch/search/SearchModule.java\n@@ -687,14 +687,19 @@ public class SearchModule {\n                 .setAggregatorRegistrar(CompositeAggregationBuilder::registerAggregators),\n             builder\n         );\n-        if (RestApiVersion.minimumSupported() == RestApiVersion.V_7) {\n-            registerQuery(\n-                new QuerySpec<>(\n-                    CommonTermsQueryBuilder.NAME_V7,\n-                    (streamInput) -> new CommonTermsQueryBuilder(),\n-                    CommonTermsQueryBuilder::fromXContent\n-                )\n-            );\n+        @org.elasticsearch.core.UpdateForV9(owner = org.elasticsearch.core.UpdateForV9.Owner.SEARCH_FOUNDATIONS) // Remove when V_7 is removed\n+        class RegisterCommonTermsQuery {\n+            static {\n+                if (RestApiVersion.minimumSupported() == RestApiVersion.V_7) {\n+                    registerQuery(\n+                        new QuerySpec<>(\n+                            CommonTermsQueryBuilder.NAME_V7,\n+                            (streamInput) -> new CommonTermsQueryBuilder(),\n+                            CommonTermsQueryBuilder::fromXContent\n+                        )\n+                    );\n+                }\n+            }\n         }\n \n         registerFromPlugin(plugins, SearchPlugin::getAggregations, (agg) -> this.registerAggregation(agg, builder));\n@@ -816,14 +821,19 @@ public class SearchModule {\n                 SerialDiffPipelineAggregationBuilder::parse\n             )\n         );\n-        if (RestApiVersion.minimumSupported() == RestApiVersion.V_7) {\n-            registerPipelineAggregation(\n-                new PipelineAggregationSpec(\n-                    MovAvgPipelineAggregationBuilder.NAME_V7,\n-                    MovAvgPipelineAggregationBuilder::new,\n-                    MovAvgPipelineAggregationBuilder.PARSER\n-                )\n-            );\n+        @org.elasticsearch.core.UpdateForV9(owner = org.elasticsearch.core.UpdateForV9.Owner.SEARCH_ANALYTICS) // Remove when V_7 is removed\n+        class RegisterMovAvgAggregation {\n+            static {\n+                if (RestApiVersion.minimumSupported() == RestApiVersion.V_7) {\n+                    registerPipelineAggregation(\n+                        new PipelineAggregationSpec(\n+                            MovAvgPipelineAggregationBuilder.NAME_V7,\n+                            MovAvgPipelineAggregationBuilder::new,\n+                            MovAvgPipelineAggregationBuilder.PARSER\n+                        )\n+                    );\n+                }\n+            }\n         }\n \n         registerFromPlugin(plugins, SearchPlugin::getPipelineAggregations, this::registerPipelineAggregation);\n@@ -1204,8 +1214,13 @@ public class SearchModule {\n \n         registerFromPlugin(plugins, SearchPlugin::getQueries, this::registerQuery);\n \n-        if (RestApiVersion.minimumSupported() == RestApiVersion.V_7) {\n-            registerQuery(new QuerySpec<>(TypeQueryV7Builder.NAME_V7, TypeQueryV7Builder::new, TypeQueryV7Builder::fromXContent));\n+        @org.elasticsearch.core.UpdateForV9(owner = org.elasticsearch.core.UpdateForV9.Owner.SEARCH_FOUNDATIONS) // Remove when V_7 is removed\n+        class RegisterTypeQuery {\n+            static {\n+                if (RestApiVersion.minimumSupported() == RestApiVersion.V_7) {\n+                    registerQuery(new QuerySpec<>(TypeQueryV7Builder.NAME_V7, TypeQueryV7Builder::new, TypeQueryV7Builder::fromXContent));\n+                }\n+            }\n         }\n     }\n \ndiff --git a/server/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateIntervalWrapper.java b/server/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateIntervalWrapper.java\nindex 6f03f9e5..dc205ae9 100644\n--- a/server/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateIntervalWrapper.java\n+++ b/server/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateIntervalWrapper.java\n@@ -112,7 +112,7 @@ public class DateIntervalWrapper implements ToXContentFragment, Writeable {\n             } else {\n                 return new DateHistogramInterval(p.text());\n             }\n-        }, Histogram.INTERVAL_FIELD.forRestApiVersion(equalTo(RestApiVersion.V_7)), ObjectParser.ValueType.LONG);\n+        }, Histogram.INTERVAL_FIELD.forRestApiVersion(equalTo(RestApiVersion.V_7)), ObjectParser.ValueType.LONG); // @UpdateForV9(owner=SEARCH_ANALYTICS) Remove when V_7 is removed\n \n         parser.declareField(\n             DateIntervalConsumer::calendarInterval,\ndiff --git a/server/src/main/java/org/elasticsearch/search/fetch/subphase/FieldAndFormat.java b/server/src/main/java/org/elasticsearch/search/fetch/subphase/FieldAndFormat.java\nindex 719729f6..10a0c628 100644\n--- a/server/src/main/java/org/elasticsearch/search/fetch/subphase/FieldAndFormat.java\n+++ b/server/src/main/java/org/elasticsearch/search/fetch/subphase/FieldAndFormat.java\n@@ -53,12 +53,17 @@ public final class FieldAndFormat implements Writeable, ToXContentObject {\n             ConstructingObjectParser.optionalConstructorArg(),\n             FORMAT_FIELD.forRestApiVersion(onOrAfter(RestApiVersion.V_8))\n         );\n-        PARSER.declareField(\n-            ConstructingObjectParser.optionalConstructorArg(),\n-            ignoreUseFieldMappingStringParser(),\n-            FORMAT_FIELD.forRestApiVersion(equalTo(RestApiVersion.V_7)),\n-            ObjectParser.ValueType.STRING_OR_NULL\n-        );\n+        @org.elasticsearch.core.UpdateForV9(owner = org.elasticsearch.core.UpdateForV9.Owner.SEARCH_FOUNDATIONS) // Remove when V_7 is removed\n+        class V7FormatField {\n+            static {\n+                PARSER.declareField(\n+                    ConstructingObjectParser.optionalConstructorArg(),\n+                    ignoreUseFieldMappingStringParser(),\n+                    FORMAT_FIELD.forRestApiVersion(equalTo(RestApiVersion.V_7)),\n+                    ObjectParser.ValueType.STRING_OR_NULL\n+                );\n+            }\n+        }\n         PARSER.declareBoolean(ConstructingObjectParser.optionalConstructorArg(), INCLUDE_UNMAPPED_FIELD);\n     }\n \ndiff --git a/server/src/main/java/org/elasticsearch/search/sort/SortBuilder.java b/server/src/main/java/org/elasticsearch/search/sort/SortBuilder.java\nindex 9f943e63..ab962f71 100644\n--- a/server/src/main/java/org/elasticsearch/search/sort/SortBuilder.java\n+++ b/server/src/main/java/org/elasticsearch/search/sort/SortBuilder.java\n@@ -50,8 +50,10 @@ public abstract class SortBuilder<T extends SortBuilder<T>>\n \n     // parse fields common to more than one SortBuilder\n     public static final ParseField ORDER_FIELD = new ParseField(\"order\");\n+    @org.elasticsearch.core.UpdateForV9(owner = org.elasticsearch.core.UpdateForV9.Owner.SEARCH_FOUNDATIONS) // Remove when V_7 is removed\n     public static final ParseField NESTED_FILTER_FIELD = new ParseField(\"nested_filter\").withAllDeprecated()\n         .forRestApiVersion(RestApiVersion.equalTo(RestApiVersion.V_7));\n+    @org.elasticsearch.core.UpdateForV9(owner = org.elasticsearch.core.UpdateForV9.Owner.SEARCH_FOUNDATIONS) // Remove when V_7 is removed\n     public static final ParseField NESTED_PATH_FIELD = new ParseField(\"nested_path\").withAllDeprecated()\n         .forRestApiVersion(RestApiVersion.equalTo(RestApiVersion.V_7));\n \ndiff --git a/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/CloseJobAction.java b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/CloseJobAction.java\nindex ca815099..04bba66c 100644\n--- a/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/CloseJobAction.java\n+++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/CloseJobAction.java\n@@ -44,6 +44,7 @@ public class CloseJobAction extends ActionType<CloseJobAction.Response> {\n         public static final ParseField TIMEOUT = new ParseField(\"timeout\");\n         public static final ParseField FORCE = new ParseField(\"force\");\n         public static final ParseField ALLOW_NO_MATCH = new ParseField(\"allow_no_match\").forRestApiVersion(onOrAfter(RestApiVersion.V_8));\n+        @org.elasticsearch.core.UpdateForV9(owner = org.elasticsearch.core.UpdateForV9.Owner.MACHINE_LEARNING) // Remove when V_7 is removed\n         public static final ParseField ALLOW_NO_MATCH_V7 = new ParseField(\"allow_no_match\", DEPRECATED_ALLOW_NO_JOBS_PARAM)\n             .forRestApiVersion(equalTo(RestApiVersion.V_7));\n         public static final ObjectParser<Request, Void> PARSER = new ObjectParser<>(NAME, Request::new);\ndiff --git a/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/GetOverallBucketsAction.java b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/GetOverallBucketsAction.java\nindex 12c8696a..6e63cca0 100644\n--- a/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/GetOverallBucketsAction.java\n+++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/GetOverallBucketsAction.java\n@@ -68,6 +68,7 @@ public class GetOverallBucketsAction extends ActionType<GetOverallBucketsAction.\n         public static final ParseField START = new ParseField(\"start\");\n         public static final ParseField END = new ParseField(\"end\");\n         public static final ParseField ALLOW_NO_MATCH = new ParseField(\"allow_no_match\").forRestApiVersion(onOrAfter(RestApiVersion.V_8));\n+        @org.elasticsearch.core.UpdateForV9(owner = org.elasticsearch.core.UpdateForV9.Owner.MACHINE_LEARNING) // Remove when V_7 is removed\n         public static final ParseField ALLOW_NO_MATCH_V7 = new ParseField(\"allow_no_match\", DEPRECATED_ALLOW_NO_JOBS_PARAM)\n             .forRestApiVersion(equalTo(RestApiVersion.V_7));\n \ndiff --git a/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/StopDatafeedAction.java b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/StopDatafeedAction.java\nindex cb89cfa8..524a206a 100644\n--- a/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/StopDatafeedAction.java\n+++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/StopDatafeedAction.java\n@@ -47,6 +47,7 @@ public class StopDatafeedAction extends ActionType<StopDatafeedAction.Response>\n         public static final ParseField TIMEOUT = new ParseField(\"timeout\");\n         public static final ParseField FORCE = new ParseField(\"force\");\n         public static final ParseField ALLOW_NO_MATCH = new ParseField(\"allow_no_match\").forRestApiVersion(onOrAfter(RestApiVersion.V_8));\n+        @org.elasticsearch.core.UpdateForV9(owner = org.elasticsearch.core.UpdateForV9.Owner.MACHINE_LEARNING) // Remove when V_7 is removed\n         public static final ParseField ALLOW_NO_MATCH_V7 = new ParseField(\"allow_no_match\", DEPRECATED_ALLOW_NO_DATAFEEDS_PARAM)\n             .forRestApiVersion(equalTo(RestApiVersion.V_7));\n \ndiff --git a/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/inference/TrainedModelConfig.java b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/inference/TrainedModelConfig.java\nindex 5ae19f6d..4b47776e 100644\n--- a/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/inference/TrainedModelConfig.java\n+++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/inference/TrainedModelConfig.java\n@@ -516,7 +516,7 @@ public class TrainedModelConfig implements ToXContentObject, Writeable {\n             );\n             // If we are NOT storing the model, we should return the deprecated field name\n             if (params.paramAsBoolean(ToXContentParams.FOR_INTERNAL_STORAGE, false) == false\n-                && builder.getRestApiVersion().matches(RestApiVersion.equalTo(RestApiVersion.V_7))) {\n+                && builder.getRestApiVersion().matches(RestApiVersion.equalTo(RestApiVersion.V_7))) { // @UpdateForV9(owner=MACHINE_LEARNING) Remove when V_7 is removed\n                 builder.humanReadableField(\n                     DEPRECATED_ESTIMATED_HEAP_MEMORY_USAGE_BYTES.getPreferredName(),\n                     ESTIMATED_HEAP_MEMORY_USAGE_HUMAN,\ndiff --git a/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/job/RestGetJobsAction.java b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/job/RestGetJobsAction.java\nindex e6f43250..2bda81e3 100644\n--- a/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/job/RestGetJobsAction.java\n+++ b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/job/RestGetJobsAction.java\n@@ -52,7 +52,7 @@ public class RestGetJobsAction extends BaseRestHandler {\n             jobId = Metadata.ALL;\n         }\n         Request request = new Request(jobId);\n-        checkAndSetDeprecatedParam(\n+        checkAndSetDeprecatedParam( // @UpdateForV9(owner=MACHINE_LEARNING) Remove when V_7 is removed\n             DEPRECATED_ALLOW_NO_JOBS_PARAM,\n             Request.ALLOW_NO_MATCH,\n             RestApiVersion.V_7,",
      "scores": {
        "correctness": -0.3,
        "completeness": -0.5,
        "code_reuse": -0.2,
        "best_practices": -0.4,
        "unsolicited_docs": 1.0
      },
      "aggregate": -0.07999999999999999,
      "rationale": "The agent fundamentally misunderstood the task. The ground truth removes V_7 references and adds @UpdateForV9 annotations to remaining ones. The agent instead added @UpdateForV9 annotations to almost all V_7 references without removing any, created unnecessary static initializer blocks (V7CompatibilityFields, RegisterCommonTermsQuery, etc.) that don't exist in ground truth, and missed critical removals like the entire PARSER.declareString blocks in PercolateQueryBuilder, the V_7 mappings handling in RolloverRequest, and the type handling logic in BulkRequestParser. The agent also added annotations to utility methods (equalTo, onOrAfter, forMajor) in RestApiVersion that weren't in ground truth, and created wrapper classes that add complexity without benefit. Major files like IndexTemplateMetadata, RestPutIndexTemplateAction, RestClusterRerouteAction, GetTrainedModelsStatsAction, and License were completely untouched despite having required changes in ground truth.",
      "llm_rating": 0.2,
      "llm_summary": "Agent added @UpdateForV9 annotations to V_7 references and created unnecessary static initializer wrapper classes instead of removing deprecated V_7 code blocks in PercolateQueryBuilder, RolloverRequest, BulkRequestParser, and 10+ other files as required by ground truth",
      "errors": []
    },
    {
      "runner": "factory",
      "model": "claude-sonnet-4-5-20250929",
      "edit_run_id": "074538b9",
      "status": "success",
      "elapsed_ms": 656951,
      "patch_unified": "diff --git a/modules/percolator/src/main/java/org/elasticsearch/percolator/PercolateQueryBuilder.java b/modules/percolator/src/main/java/org/elasticsearch/percolator/PercolateQueryBuilder.java\nindex 6b37b02a..5f383806 100644\n--- a/modules/percolator/src/main/java/org/elasticsearch/percolator/PercolateQueryBuilder.java\n+++ b/modules/percolator/src/main/java/org/elasticsearch/percolator/PercolateQueryBuilder.java\n@@ -47,6 +47,7 @@ import org.elasticsearch.common.logging.DeprecationLogger;\n import org.elasticsearch.common.xcontent.LoggingDeprecationHandler;\n import org.elasticsearch.common.xcontent.XContentHelper;\n import org.elasticsearch.core.RestApiVersion;\n+import org.elasticsearch.core.UpdateForV9;\n import org.elasticsearch.index.IndexVersion;\n import org.elasticsearch.index.IndexVersions;\n import org.elasticsearch.index.fielddata.FieldDataContext;\n@@ -368,13 +369,17 @@ public class PercolateQueryBuilder extends AbstractQueryBuilder<PercolateQueryBu\n             DOCUMENTS_FIELD.getPreferredName(),\n             INDEXED_DOCUMENT_FIELD_ID.getPreferredName()\n         );\n+        @UpdateForV9(owner = UpdateForV9.Owner.SEARCH_FOUNDATIONS) // Remove V_7 compatibility\n+        var indexedDocumentFieldTypeV7 = INDEXED_DOCUMENT_FIELD_TYPE.forRestApiVersion(equalTo(RestApiVersion.V_7));\n         PARSER.declareString(\n             deprecateAndIgnoreType(\"percolate_with_type\", TYPE_DEPRECATION_MESSAGE),\n-            INDEXED_DOCUMENT_FIELD_TYPE.forRestApiVersion(equalTo(RestApiVersion.V_7))\n+            indexedDocumentFieldTypeV7\n         );\n+        @UpdateForV9(owner = UpdateForV9.Owner.SEARCH_FOUNDATIONS) // Remove V_7 compatibility\n+        var documentTypeFieldV7 = DOCUMENT_TYPE_FIELD.forRestApiVersion(equalTo(RestApiVersion.V_7));\n         PARSER.declareString(\n             deprecateAndIgnoreType(\"percolate_with_document_type\", DOCUMENT_TYPE_DEPRECATION_MESSAGE),\n-            DOCUMENT_TYPE_FIELD.forRestApiVersion(equalTo(RestApiVersion.V_7))\n+            documentTypeFieldV7\n         );\n     }\n \ndiff --git a/server/src/main/java/org/elasticsearch/action/admin/indices/rollover/RolloverRequest.java b/server/src/main/java/org/elasticsearch/action/admin/indices/rollover/RolloverRequest.java\nindex fefc4131..0c91919a 100644\n--- a/server/src/main/java/org/elasticsearch/action/admin/indices/rollover/RolloverRequest.java\n+++ b/server/src/main/java/org/elasticsearch/action/admin/indices/rollover/RolloverRequest.java\n@@ -69,6 +69,7 @@ public class RolloverRequest extends AcknowledgedRequest<RolloverRequest> implem\n                 );\n             }\n             request.createIndexRequest.mapping(mappings);\n+        @UpdateForV9(owner = UpdateForV9.Owner.DATA_MANAGEMENT) // Remove V_7 compatibility\n         }, CreateIndexRequest.MAPPINGS.forRestApiVersion(RestApiVersion.equalTo(RestApiVersion.V_7)), ObjectParser.ValueType.OBJECT);\n         PARSER.declareField((parser, request, context) -> {\n             // a type is not included, add a dummy _doc type\ndiff --git a/server/src/main/java/org/elasticsearch/action/bulk/BulkRequestParser.java b/server/src/main/java/org/elasticsearch/action/bulk/BulkRequestParser.java\nindex cd74989e..abc0e635 100644\n--- a/server/src/main/java/org/elasticsearch/action/bulk/BulkRequestParser.java\n+++ b/server/src/main/java/org/elasticsearch/action/bulk/BulkRequestParser.java\n@@ -271,7 +271,9 @@ public final class BulkRequestParser {\n                                 }\n                                 index = stringDeduplicator.computeIfAbsent(parser.text(), Function.identity());\n                             } else if (TYPE.match(currentFieldName, parser.getDeprecationHandler())) {\n-                                if (parser.getRestApiVersion().matches(RestApiVersion.equalTo(RestApiVersion.V_7))) {\n+                                @UpdateForV9(owner = UpdateForV9.Owner.DISTRIBUTED_INDEXING) // Remove V_7 compatibility check\n+                                var isV7Api = parser.getRestApiVersion().matches(RestApiVersion.equalTo(RestApiVersion.V_7));\n+                                if (isV7Api) {\n                                     // for bigger bulks, deprecation throttling might not be enough\n                                     if (deprecateOrErrorOnType && typesDeprecationLogged == false) {\n                                         deprecationLogger.compatibleCritical(\"bulk_with_types\", RestBulkAction.TYPES_DEPRECATION_MESSAGE);\ndiff --git a/server/src/main/java/org/elasticsearch/action/ingest/SimulatePipelineRequest.java b/server/src/main/java/org/elasticsearch/action/ingest/SimulatePipelineRequest.java\nindex 6adcd80c..5735b57c 100644\n--- a/server/src/main/java/org/elasticsearch/action/ingest/SimulatePipelineRequest.java\n+++ b/server/src/main/java/org/elasticsearch/action/ingest/SimulatePipelineRequest.java\n@@ -172,7 +172,9 @@ public class SimulatePipelineRequest extends ActionRequest implements ToXContent\n             String index = ConfigurationUtils.readStringOrIntProperty(null, null, dataMap, Metadata.INDEX.getFieldName(), \"_index\");\n             String id = ConfigurationUtils.readStringOrIntProperty(null, null, dataMap, Metadata.ID.getFieldName(), \"_id\");\n             String routing = ConfigurationUtils.readOptionalStringOrIntProperty(null, null, dataMap, Metadata.ROUTING.getFieldName());\n-            if (restApiVersion == RestApiVersion.V_7 && dataMap.containsKey(Metadata.TYPE.getFieldName())) {\n+            @UpdateForV9(owner = UpdateForV9.Owner.DATA_MANAGEMENT) // Remove V_7 compatibility check\n+            var isRestApiV7 = restApiVersion == RestApiVersion.V_7;\n+            if (isRestApiV7 && dataMap.containsKey(Metadata.TYPE.getFieldName())) {\n                 deprecationLogger.compatibleCritical(\n                     \"simulate_pipeline_with_types\",\n                     \"[types removal] specifying _type in pipeline simulation requests is deprecated\"\ndiff --git a/server/src/main/java/org/elasticsearch/action/search/MultiSearchRequest.java b/server/src/main/java/org/elasticsearch/action/search/MultiSearchRequest.java\nindex 8467ee6f..3b105402 100644\n--- a/server/src/main/java/org/elasticsearch/action/search/MultiSearchRequest.java\n+++ b/server/src/main/java/org/elasticsearch/action/search/MultiSearchRequest.java\n@@ -214,7 +214,9 @@ public class MultiSearchRequest extends ActionRequest implements CompositeIndice\n                 break;\n             }\n             // support first line with \\n\n-            if (parserConfig.restApiVersion() == RestApiVersion.V_7 && nextMarker == 0) {\n+            @UpdateForV9(owner = UpdateForV9.Owner.SEARCH_FOUNDATIONS) // Remove V_7 compatibility check\n+            var isV7 = parserConfig.restApiVersion() == RestApiVersion.V_7;\n+            if (isV7 && nextMarker == 0) {\n                 deprecationLogger.compatibleCritical(\"msearch_first_line_empty\", FIRST_LINE_EMPTY_DEPRECATION_MESSAGE);\n                 from = nextMarker + 1;\n                 continue;\n@@ -281,7 +283,9 @@ public class MultiSearchRequest extends ActionRequest implements CompositeIndice\n                             allowNoIndices = value;\n                         } else if (\"ignore_throttled\".equals(entry.getKey()) || \"ignoreThrottled\".equals(entry.getKey())) {\n                             ignoreThrottled = value;\n-                        } else if (parserConfig.restApiVersion() == RestApiVersion.V_7\n+                        @UpdateForV9(owner = UpdateForV9.Owner.SEARCH_FOUNDATIONS) // Remove V_7 compatibility check\n+                        var isRestApiV7 = parserConfig.restApiVersion() == RestApiVersion.V_7;\n+                        } else if (isRestApiV7\n                             && (\"type\".equals(entry.getKey()) || \"types\".equals(entry.getKey()))) {\n                                 deprecationLogger.compatibleCritical(\"msearch_with_types\", RestMultiSearchAction.TYPES_DEPRECATION_MESSAGE);\n                             } else if (extraParamParser.apply(entry.getKey(), value, searchRequest)) {\ndiff --git a/server/src/main/java/org/elasticsearch/action/termvectors/TermVectorsRequest.java b/server/src/main/java/org/elasticsearch/action/termvectors/TermVectorsRequest.java\nindex a36158d1..b2b6d4f3 100644\n--- a/server/src/main/java/org/elasticsearch/action/termvectors/TermVectorsRequest.java\n+++ b/server/src/main/java/org/elasticsearch/action/termvectors/TermVectorsRequest.java\n@@ -583,7 +583,9 @@ public final class TermVectorsRequest extends SingleShardRequest<TermVectorsRequ\n                     termVectorsRequest.version = parser.longValue();\n                 } else if (VERSION_TYPE.match(currentFieldName, parser.getDeprecationHandler())) {\n                     termVectorsRequest.versionType = VersionType.fromString(parser.text());\n-                } else if (restApiVersion == RestApiVersion.V_7 && TYPE.match(currentFieldName, parser.getDeprecationHandler())) {\n+                @UpdateForV9(owner = UpdateForV9.Owner.SEARCH_FOUNDATIONS) // Remove V_7 compatibility check\n+                var isRestApiV7 = restApiVersion == RestApiVersion.V_7;\n+                } else if (isRestApiV7 && TYPE.match(currentFieldName, parser.getDeprecationHandler())) {\n                     deprecationLogger.compatibleCritical(\"termvectors_with_types\", RestTermVectorsAction.TYPES_DEPRECATION_MESSAGE);\n                 } else {\n                     throw new ElasticsearchParseException(\"failed to parse term vectors request. unknown field [{}]\", currentFieldName);\ndiff --git a/server/src/main/java/org/elasticsearch/index/query/CommonTermsQueryBuilder.java b/server/src/main/java/org/elasticsearch/index/query/CommonTermsQueryBuilder.java\nindex 263c6bd3..63d9df5f 100644\n--- a/server/src/main/java/org/elasticsearch/index/query/CommonTermsQueryBuilder.java\n+++ b/server/src/main/java/org/elasticsearch/index/query/CommonTermsQueryBuilder.java\n@@ -16,6 +16,7 @@ import org.elasticsearch.common.ParsingException;\n import org.elasticsearch.common.io.stream.StreamOutput;\n import org.elasticsearch.common.logging.DeprecationLogger;\n import org.elasticsearch.core.RestApiVersion;\n+import org.elasticsearch.core.UpdateForV9;\n import org.elasticsearch.xcontent.ParseField;\n import org.elasticsearch.xcontent.XContentBuilder;\n import org.elasticsearch.xcontent.XContentParser;\n@@ -27,6 +28,7 @@ public class CommonTermsQueryBuilder extends AbstractQueryBuilder<CommonTermsQue\n     public static final String COMMON_TERMS_QUERY_DEPRECATION_MSG = \"Common Terms Query usage is not supported. \"\n         + \"Use [match] query which can efficiently skip blocks of documents if the total number of hits is not tracked.\";\n \n+    @UpdateForV9(owner = UpdateForV9.Owner.SEARCH_FOUNDATIONS) // Remove V_7 compatibility\n     public static ParseField NAME_V7 = new ParseField(\"common\").withAllDeprecated(COMMON_TERMS_QUERY_DEPRECATION_MSG)\n         .forRestApiVersion(RestApiVersion.equalTo(RestApiVersion.V_7));\n \ndiff --git a/server/src/main/java/org/elasticsearch/index/query/GeoBoundingBoxQueryBuilder.java b/server/src/main/java/org/elasticsearch/index/query/GeoBoundingBoxQueryBuilder.java\nindex 22cc68fb..0fcbf80d 100644\n--- a/server/src/main/java/org/elasticsearch/index/query/GeoBoundingBoxQueryBuilder.java\n+++ b/server/src/main/java/org/elasticsearch/index/query/GeoBoundingBoxQueryBuilder.java\n@@ -25,6 +25,7 @@ import org.elasticsearch.common.io.stream.StreamInput;\n import org.elasticsearch.common.io.stream.StreamOutput;\n import org.elasticsearch.common.logging.DeprecationLogger;\n import org.elasticsearch.core.RestApiVersion;\n+import org.elasticsearch.core.UpdateForV9;\n import org.elasticsearch.geometry.Rectangle;\n import org.elasticsearch.geometry.utils.Geohash;\n import org.elasticsearch.index.mapper.GeoShapeQueryable;\n@@ -55,6 +56,7 @@ public class GeoBoundingBoxQueryBuilder extends AbstractQueryBuilder<GeoBounding\n      */\n     public static final boolean DEFAULT_IGNORE_UNMAPPED = false;\n \n+    @UpdateForV9(owner = UpdateForV9.Owner.SEARCH_ANALYTICS) // Remove V_7 compatibility\n     private static final ParseField TYPE_FIELD = new ParseField(\"type\").forRestApiVersion(RestApiVersion.equalTo(RestApiVersion.V_7));\n     private static final ParseField VALIDATION_METHOD_FIELD = new ParseField(\"validation_method\");\n     private static final ParseField IGNORE_UNMAPPED_FIELD = new ParseField(\"ignore_unmapped\");\ndiff --git a/server/src/main/java/org/elasticsearch/index/query/MatchQueryBuilder.java b/server/src/main/java/org/elasticsearch/index/query/MatchQueryBuilder.java\nindex d72b755e..f4f4dec8 100644\n--- a/server/src/main/java/org/elasticsearch/index/query/MatchQueryBuilder.java\n+++ b/server/src/main/java/org/elasticsearch/index/query/MatchQueryBuilder.java\n@@ -21,6 +21,7 @@ import org.elasticsearch.common.lucene.search.Queries;\n import org.elasticsearch.common.unit.Fuzziness;\n import org.elasticsearch.common.xcontent.LoggingDeprecationHandler;\n import org.elasticsearch.core.RestApiVersion;\n+import org.elasticsearch.core.UpdateForV9;\n import org.elasticsearch.index.analysis.NamedAnalyzer;\n import org.elasticsearch.index.mapper.MappedFieldType;\n import org.elasticsearch.index.query.support.QueryParsers;\n@@ -39,6 +40,7 @@ import java.util.Objects;\n public class MatchQueryBuilder extends AbstractQueryBuilder<MatchQueryBuilder> {\n     private static final String CUTOFF_FREQUENCY_DEPRECATION_MSG = \"cutoff_freqency is not supported. \"\n         + \"The [match] query can skip block of documents efficiently if the total number of hits is not tracked\";\n+    @UpdateForV9(owner = UpdateForV9.Owner.SEARCH_FOUNDATIONS) // Remove V_7 compatibility\n     public static final ParseField CUTOFF_FREQUENCY_FIELD = new ParseField(\"cutoff_frequency\").withAllDeprecated(\n         CUTOFF_FREQUENCY_DEPRECATION_MSG\n     ).forRestApiVersion(RestApiVersion.equalTo(RestApiVersion.V_7));\ndiff --git a/server/src/main/java/org/elasticsearch/index/query/MultiMatchQueryBuilder.java b/server/src/main/java/org/elasticsearch/index/query/MultiMatchQueryBuilder.java\nindex a83fb8d1..bd545066 100644\n--- a/server/src/main/java/org/elasticsearch/index/query/MultiMatchQueryBuilder.java\n+++ b/server/src/main/java/org/elasticsearch/index/query/MultiMatchQueryBuilder.java\n@@ -22,6 +22,7 @@ import org.elasticsearch.common.io.stream.Writeable;\n import org.elasticsearch.common.unit.Fuzziness;\n import org.elasticsearch.common.xcontent.LoggingDeprecationHandler;\n import org.elasticsearch.core.RestApiVersion;\n+import org.elasticsearch.core.UpdateForV9;\n import org.elasticsearch.index.query.support.QueryParsers;\n import org.elasticsearch.index.search.MatchQueryParser;\n import org.elasticsearch.index.search.MultiMatchQueryParser;\n@@ -47,6 +48,7 @@ public final class MultiMatchQueryBuilder extends AbstractQueryBuilder<MultiMatc\n     public static final String NAME = \"multi_match\";\n     private static final String CUTOFF_FREQUENCY_DEPRECATION_MSG = \"cutoff_freqency is not supported.\"\n         + \" The [multi_match] query can skip block of documents efficiently if the total number of hits is not tracked\";\n+    @UpdateForV9(owner = UpdateForV9.Owner.SEARCH_FOUNDATIONS) // Remove V_7 compatibility\n     private static final ParseField CUTOFF_FREQUENCY_FIELD = new ParseField(\"cutoff_frequency\").withAllDeprecated(\n         CUTOFF_FREQUENCY_DEPRECATION_MSG\n     ).forRestApiVersion(RestApiVersion.equalTo(RestApiVersion.V_7));\ndiff --git a/server/src/main/java/org/elasticsearch/index/query/TypeQueryV7Builder.java b/server/src/main/java/org/elasticsearch/index/query/TypeQueryV7Builder.java\nindex f707684c..1eef676a 100644\n--- a/server/src/main/java/org/elasticsearch/index/query/TypeQueryV7Builder.java\n+++ b/server/src/main/java/org/elasticsearch/index/query/TypeQueryV7Builder.java\n@@ -18,6 +18,7 @@ import org.elasticsearch.common.io.stream.StreamInput;\n import org.elasticsearch.common.io.stream.StreamOutput;\n import org.elasticsearch.common.logging.DeprecationLogger;\n import org.elasticsearch.core.RestApiVersion;\n+import org.elasticsearch.core.UpdateForV9;\n import org.elasticsearch.index.mapper.MapperService;\n import org.elasticsearch.xcontent.ObjectParser;\n import org.elasticsearch.xcontent.ParseField;\n@@ -32,20 +33,21 @@ public class TypeQueryV7Builder extends AbstractQueryBuilder<TypeQueryV7Builder>\n         + \"prefer to filter on a field instead.\";\n \n     private static final String NAME = \"type\";\n+    @UpdateForV9(owner = UpdateForV9.Owner.SEARCH_FOUNDATIONS) // Remove V_7 compatibility\n     public static final ParseField NAME_V7 = new ParseField(NAME).forRestApiVersion(RestApiVersion.equalTo(RestApiVersion.V_7));\n     private static final ParseField VALUE_FIELD = new ParseField(\"value\");\n     private static final ObjectParser<TypeQueryV7Builder, Void> PARSER = new ObjectParser<>(NAME, TypeQueryV7Builder::new);\n \n     static {\n-        PARSER.declareString(\n-            QueryBuilder::queryName,\n-            AbstractQueryBuilder.NAME_FIELD.forRestApiVersion(RestApiVersion.equalTo(RestApiVersion.V_7))\n-        );\n-        PARSER.declareFloat(\n-            QueryBuilder::boost,\n-            AbstractQueryBuilder.BOOST_FIELD.forRestApiVersion(RestApiVersion.equalTo(RestApiVersion.V_7))\n-        );\n-        PARSER.declareString(TypeQueryV7Builder::setValue, VALUE_FIELD.forRestApiVersion(RestApiVersion.equalTo(RestApiVersion.V_7)));\n+        @UpdateForV9(owner = UpdateForV9.Owner.SEARCH_FOUNDATIONS) // Remove V_7 compatibility\n+        var nameFieldV7 = AbstractQueryBuilder.NAME_FIELD.forRestApiVersion(RestApiVersion.equalTo(RestApiVersion.V_7));\n+        PARSER.declareString(QueryBuilder::queryName, nameFieldV7);\n+        @UpdateForV9(owner = UpdateForV9.Owner.SEARCH_FOUNDATIONS) // Remove V_7 compatibility\n+        var boostFieldV7 = AbstractQueryBuilder.BOOST_FIELD.forRestApiVersion(RestApiVersion.equalTo(RestApiVersion.V_7));\n+        PARSER.declareFloat(QueryBuilder::boost, boostFieldV7);\n+        @UpdateForV9(owner = UpdateForV9.Owner.SEARCH_FOUNDATIONS) // Remove V_7 compatibility\n+        var valueFieldV7 = VALUE_FIELD.forRestApiVersion(RestApiVersion.equalTo(RestApiVersion.V_7));\n+        PARSER.declareString(TypeQueryV7Builder::setValue, valueFieldV7);\n     }\n \n     private String value;\ndiff --git a/server/src/main/java/org/elasticsearch/index/reindex/ReindexRequest.java b/server/src/main/java/org/elasticsearch/index/reindex/ReindexRequest.java\nindex b7ec486d..c56b6a64 100644\n--- a/server/src/main/java/org/elasticsearch/index/reindex/ReindexRequest.java\n+++ b/server/src/main/java/org/elasticsearch/index/reindex/ReindexRequest.java\n@@ -356,6 +356,7 @@ public class ReindexRequest extends AbstractBulkIndexByScrollRequest<ReindexRequ\n \n         PARSER.declareInt(\n             ReindexRequest::setMaxDocsValidateIdentical,\n+            @UpdateForV9(owner = UpdateForV9.Owner.DISTRIBUTED_INDEXING) // Remove V_7 compatibility\n             new ParseField(\"max_docs\", \"size\").forRestApiVersion(RestApiVersion.equalTo(RestApiVersion.V_7))\n         );\n \ndiff --git a/server/src/main/java/org/elasticsearch/indices/TermsLookup.java b/server/src/main/java/org/elasticsearch/indices/TermsLookup.java\nindex b1c74c60..fbb3b72d 100644\n--- a/server/src/main/java/org/elasticsearch/indices/TermsLookup.java\n+++ b/server/src/main/java/org/elasticsearch/indices/TermsLookup.java\n@@ -109,7 +109,9 @@ public class TermsLookup implements Writeable, ToXContentFragment {\n         PARSER.declareString(constructorArg(), new ParseField(\"id\"));\n         PARSER.declareString(constructorArg(), new ParseField(\"path\"));\n         PARSER.declareString(TermsLookup::routing, new ParseField(\"routing\"));\n-        PARSER.declareString((termLookup, type) -> {}, new ParseField(\"type\").forRestApiVersion(equalTo(RestApiVersion.V_7)));\n+        @UpdateForV9(owner = UpdateForV9.Owner.SEARCH_FOUNDATIONS) // Remove V_7 compatibility\n+        var typeFieldV7 = new ParseField(\"type\").forRestApiVersion(equalTo(RestApiVersion.V_7));\n+        PARSER.declareString((termLookup, type) -> {}, typeFieldV7);\n     }\n \n     public static TermsLookup parseTermsLookup(XContentParser parser) throws IOException {\ndiff --git a/server/src/main/java/org/elasticsearch/rest/action/admin/indices/RestGetAliasesAction.java b/server/src/main/java/org/elasticsearch/rest/action/admin/indices/RestGetAliasesAction.java\nindex 79e5c574..65964ea0 100644\n--- a/server/src/main/java/org/elasticsearch/rest/action/admin/indices/RestGetAliasesAction.java\n+++ b/server/src/main/java/org/elasticsearch/rest/action/admin/indices/RestGetAliasesAction.java\n@@ -214,7 +214,9 @@ public class RestGetAliasesAction extends BaseRestHandler {\n         if (request.hasParam(\"local\")) {\n             // consume this param just for validation\n             final var localParam = request.paramAsBoolean(\"local\", false);\n-            if (request.getRestApiVersion() != RestApiVersion.V_7) {\n+            @UpdateForV9(owner = UpdateForV9.Owner.DATA_MANAGEMENT) // Remove V_7 compatibility check\n+            var isNotV7 = request.getRestApiVersion() != RestApiVersion.V_7;\n+            if (isNotV7) {\n                 DEPRECATION_LOGGER.critical(\n                     DeprecationCategory.API,\n                     \"get-aliases-local\",\ndiff --git a/server/src/main/java/org/elasticsearch/rest/action/cat/RestAliasAction.java b/server/src/main/java/org/elasticsearch/rest/action/cat/RestAliasAction.java\nindex 0957821e..c42caeb8 100644\n--- a/server/src/main/java/org/elasticsearch/rest/action/cat/RestAliasAction.java\n+++ b/server/src/main/java/org/elasticsearch/rest/action/cat/RestAliasAction.java\n@@ -18,6 +18,7 @@ import org.elasticsearch.common.Table;\n import org.elasticsearch.common.logging.DeprecationCategory;\n import org.elasticsearch.common.logging.DeprecationLogger;\n import org.elasticsearch.core.RestApiVersion;\n+import org.elasticsearch.core.UpdateForV9;\n import org.elasticsearch.rest.RestRequest;\n import org.elasticsearch.rest.RestResponse;\n import org.elasticsearch.rest.Scope;\n@@ -60,7 +61,9 @@ public class RestAliasAction extends AbstractCatAction {\n         if (request.hasParam(\"local\")) {\n             // consume this param just for validation\n             final var localParam = request.paramAsBoolean(\"local\", false);\n-            if (request.getRestApiVersion() != RestApiVersion.V_7) {\n+            @UpdateForV9(owner = UpdateForV9.Owner.DATA_MANAGEMENT) // Remove V_7 compatibility check\n+            var isNotV7 = request.getRestApiVersion() != RestApiVersion.V_7;\n+            if (isNotV7) {\n                 DEPRECATION_LOGGER.critical(\n                     DeprecationCategory.API,\n                     \"cat-aliases-local\",\ndiff --git a/server/src/main/java/org/elasticsearch/search/SearchModule.java b/server/src/main/java/org/elasticsearch/search/SearchModule.java\nindex 0bb914a9..d082d461 100644\n--- a/server/src/main/java/org/elasticsearch/search/SearchModule.java\n+++ b/server/src/main/java/org/elasticsearch/search/SearchModule.java\n@@ -687,7 +687,9 @@ public class SearchModule {\n                 .setAggregatorRegistrar(CompositeAggregationBuilder::registerAggregators),\n             builder\n         );\n-        if (RestApiVersion.minimumSupported() == RestApiVersion.V_7) {\n+        @UpdateForV9(owner = UpdateForV9.Owner.SEARCH_FOUNDATIONS) // Remove V_7 compatibility check and registration\n+        var shouldRegisterV7Query = RestApiVersion.minimumSupported() == RestApiVersion.V_7;\n+        if (shouldRegisterV7Query) {\n             registerQuery(\n                 new QuerySpec<>(\n                     CommonTermsQueryBuilder.NAME_V7,\n@@ -816,7 +818,9 @@ public class SearchModule {\n                 SerialDiffPipelineAggregationBuilder::parse\n             )\n         );\n-        if (RestApiVersion.minimumSupported() == RestApiVersion.V_7) {\n+        @UpdateForV9(owner = UpdateForV9.Owner.SEARCH_ANALYTICS) // Remove V_7 compatibility check and registration\n+        var shouldRegisterV7PipelineAgg = RestApiVersion.minimumSupported() == RestApiVersion.V_7;\n+        if (shouldRegisterV7PipelineAgg) {\n             registerPipelineAggregation(\n                 new PipelineAggregationSpec(\n                     MovAvgPipelineAggregationBuilder.NAME_V7,\n@@ -1204,7 +1208,9 @@ public class SearchModule {\n \n         registerFromPlugin(plugins, SearchPlugin::getQueries, this::registerQuery);\n \n-        if (RestApiVersion.minimumSupported() == RestApiVersion.V_7) {\n+        @UpdateForV9(owner = UpdateForV9.Owner.SEARCH_FOUNDATIONS) // Remove V_7 compatibility check and registration\n+        var shouldRegisterTypeQueryV7 = RestApiVersion.minimumSupported() == RestApiVersion.V_7;\n+        if (shouldRegisterTypeQueryV7) {\n             registerQuery(new QuerySpec<>(TypeQueryV7Builder.NAME_V7, TypeQueryV7Builder::new, TypeQueryV7Builder::fromXContent));\n         }\n     }\ndiff --git a/server/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateIntervalWrapper.java b/server/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateIntervalWrapper.java\nindex 6f03f9e5..5ff3c303 100644\n--- a/server/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateIntervalWrapper.java\n+++ b/server/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateIntervalWrapper.java\n@@ -19,6 +19,7 @@ import org.elasticsearch.common.logging.DeprecationCategory;\n import org.elasticsearch.common.logging.DeprecationLogger;\n import org.elasticsearch.core.RestApiVersion;\n import org.elasticsearch.core.TimeValue;\n+import org.elasticsearch.core.UpdateForV9;\n import org.elasticsearch.xcontent.ObjectParser;\n import org.elasticsearch.xcontent.ParseField;\n import org.elasticsearch.xcontent.ToXContentFragment;\n@@ -112,6 +113,7 @@ public class DateIntervalWrapper implements ToXContentFragment, Writeable {\n             } else {\n                 return new DateHistogramInterval(p.text());\n             }\n+        @UpdateForV9(owner = UpdateForV9.Owner.SEARCH_ANALYTICS) // Remove V_7 compatibility\n         }, Histogram.INTERVAL_FIELD.forRestApiVersion(equalTo(RestApiVersion.V_7)), ObjectParser.ValueType.LONG);\n \n         parser.declareField(\ndiff --git a/server/src/main/java/org/elasticsearch/search/aggregations/pipeline/MovAvgPipelineAggregationBuilder.java b/server/src/main/java/org/elasticsearch/search/aggregations/pipeline/MovAvgPipelineAggregationBuilder.java\nindex 06848731..27f7e13d 100644\n--- a/server/src/main/java/org/elasticsearch/search/aggregations/pipeline/MovAvgPipelineAggregationBuilder.java\n+++ b/server/src/main/java/org/elasticsearch/search/aggregations/pipeline/MovAvgPipelineAggregationBuilder.java\n@@ -40,6 +40,7 @@ public class MovAvgPipelineAggregationBuilder extends AbstractPipelineAggregatio\n     public static final String MOVING_AVG_AGG_DEPRECATION_MSG = \"Moving Average aggregation usage is not supported. \"\n         + \"Use the [moving_fn] aggregation instead.\";\n \n+    @UpdateForV9(owner = UpdateForV9.Owner.SEARCH_ANALYTICS) // Remove V_7 compatibility\n     public static final ParseField NAME_V7 = new ParseField(\"moving_avg\").withAllDeprecated(MOVING_AVG_AGG_DEPRECATION_MSG)\n         .forRestApiVersion(RestApiVersion.equalTo(RestApiVersion.V_7));\n \ndiff --git a/server/src/main/java/org/elasticsearch/search/fetch/subphase/FieldAndFormat.java b/server/src/main/java/org/elasticsearch/search/fetch/subphase/FieldAndFormat.java\nindex 719729f6..91d49d33 100644\n--- a/server/src/main/java/org/elasticsearch/search/fetch/subphase/FieldAndFormat.java\n+++ b/server/src/main/java/org/elasticsearch/search/fetch/subphase/FieldAndFormat.java\n@@ -56,6 +56,7 @@ public final class FieldAndFormat implements Writeable, ToXContentObject {\n         PARSER.declareField(\n             ConstructingObjectParser.optionalConstructorArg(),\n             ignoreUseFieldMappingStringParser(),\n+            @UpdateForV9(owner = UpdateForV9.Owner.SEARCH_FOUNDATIONS) // Remove V_7 compatibility\n             FORMAT_FIELD.forRestApiVersion(equalTo(RestApiVersion.V_7)),\n             ObjectParser.ValueType.STRING_OR_NULL\n         );\ndiff --git a/server/src/main/java/org/elasticsearch/search/sort/SortBuilder.java b/server/src/main/java/org/elasticsearch/search/sort/SortBuilder.java\nindex 9f943e63..1bc1d714 100644\n--- a/server/src/main/java/org/elasticsearch/search/sort/SortBuilder.java\n+++ b/server/src/main/java/org/elasticsearch/search/sort/SortBuilder.java\n@@ -19,6 +19,7 @@ import org.elasticsearch.common.io.stream.VersionedNamedWriteable;\n import org.elasticsearch.common.lucene.search.Queries;\n import org.elasticsearch.common.util.BigArrays;\n import org.elasticsearch.core.RestApiVersion;\n+import org.elasticsearch.core.UpdateForV9;\n import org.elasticsearch.index.fielddata.IndexFieldData.XFieldComparatorSource.Nested;\n import org.elasticsearch.index.mapper.NestedObjectMapper;\n import org.elasticsearch.index.query.QueryBuilder;\n@@ -50,8 +51,10 @@ public abstract class SortBuilder<T extends SortBuilder<T>>\n \n     // parse fields common to more than one SortBuilder\n     public static final ParseField ORDER_FIELD = new ParseField(\"order\");\n+    @UpdateForV9(owner = UpdateForV9.Owner.SEARCH_FOUNDATIONS) // Remove V_7 compatibility\n     public static final ParseField NESTED_FILTER_FIELD = new ParseField(\"nested_filter\").withAllDeprecated()\n         .forRestApiVersion(RestApiVersion.equalTo(RestApiVersion.V_7));\n+    @UpdateForV9(owner = UpdateForV9.Owner.SEARCH_FOUNDATIONS) // Remove V_7 compatibility\n     public static final ParseField NESTED_PATH_FIELD = new ParseField(\"nested_path\").withAllDeprecated()\n         .forRestApiVersion(RestApiVersion.equalTo(RestApiVersion.V_7));\n \ndiff --git a/x-pack/plugin/core/src/main/java/org/elasticsearch/license/License.java b/x-pack/plugin/core/src/main/java/org/elasticsearch/license/License.java\nindex 0d1a007d..e2de28c7 100644\n--- a/x-pack/plugin/core/src/main/java/org/elasticsearch/license/License.java\n+++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/license/License.java\n@@ -16,6 +16,7 @@ import org.elasticsearch.common.io.stream.StreamOutput;\n import org.elasticsearch.common.xcontent.LoggingDeprecationHandler;\n import org.elasticsearch.common.xcontent.XContentHelper;\n import org.elasticsearch.core.RestApiVersion;\n+import org.elasticsearch.core.UpdateForV9;\n import org.elasticsearch.features.NodeFeature;\n import org.elasticsearch.xcontent.ToXContentObject;\n import org.elasticsearch.xcontent.XContentBuilder;\n@@ -145,6 +146,7 @@ public class License implements ToXContentObject {\n      * XContent param name to map the \"enterprise\" license type to \"platinum\"\n      * for backwards compatibility with older clients\n      */\n+    @UpdateForV9(owner = UpdateForV9.Owner.SECURITY) // Remove V_7 compatibility\n     public static final String XCONTENT_HIDE_ENTERPRISE = \"hide_enterprise\";\n \n     public static final Comparator<License> LATEST_ISSUE_DATE_FIRST = Comparator.comparing(License::issueDate).reversed();\ndiff --git a/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/CloseJobAction.java b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/CloseJobAction.java\nindex ca815099..7fb2465b 100644\n--- a/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/CloseJobAction.java\n+++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/CloseJobAction.java\n@@ -14,6 +14,7 @@ import org.elasticsearch.common.io.stream.StreamOutput;\n import org.elasticsearch.common.io.stream.Writeable;\n import org.elasticsearch.core.RestApiVersion;\n import org.elasticsearch.core.TimeValue;\n+import org.elasticsearch.core.UpdateForV9;\n import org.elasticsearch.tasks.Task;\n import org.elasticsearch.xcontent.ObjectParser;\n import org.elasticsearch.xcontent.ParseField;\n@@ -44,6 +45,7 @@ public class CloseJobAction extends ActionType<CloseJobAction.Response> {\n         public static final ParseField TIMEOUT = new ParseField(\"timeout\");\n         public static final ParseField FORCE = new ParseField(\"force\");\n         public static final ParseField ALLOW_NO_MATCH = new ParseField(\"allow_no_match\").forRestApiVersion(onOrAfter(RestApiVersion.V_8));\n+        @UpdateForV9(owner = UpdateForV9.Owner.MACHINE_LEARNING) // Remove V_7 compatibility\n         public static final ParseField ALLOW_NO_MATCH_V7 = new ParseField(\"allow_no_match\", DEPRECATED_ALLOW_NO_JOBS_PARAM)\n             .forRestApiVersion(equalTo(RestApiVersion.V_7));\n         public static final ObjectParser<Request, Void> PARSER = new ObjectParser<>(NAME, Request::new);\ndiff --git a/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/GetOverallBucketsAction.java b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/GetOverallBucketsAction.java\nindex 12c8696a..d308e93d 100644\n--- a/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/GetOverallBucketsAction.java\n+++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/GetOverallBucketsAction.java\n@@ -15,6 +15,7 @@ import org.elasticsearch.common.io.stream.StreamOutput;\n import org.elasticsearch.common.time.DateMathParser;\n import org.elasticsearch.core.RestApiVersion;\n import org.elasticsearch.core.TimeValue;\n+import org.elasticsearch.core.UpdateForV9;\n import org.elasticsearch.index.mapper.DateFieldMapper;\n import org.elasticsearch.xcontent.ObjectParser;\n import org.elasticsearch.xcontent.ParseField;\n@@ -68,6 +69,7 @@ public class GetOverallBucketsAction extends ActionType<GetOverallBucketsAction.\n         public static final ParseField START = new ParseField(\"start\");\n         public static final ParseField END = new ParseField(\"end\");\n         public static final ParseField ALLOW_NO_MATCH = new ParseField(\"allow_no_match\").forRestApiVersion(onOrAfter(RestApiVersion.V_8));\n+        @UpdateForV9(owner = UpdateForV9.Owner.MACHINE_LEARNING) // Remove V_7 compatibility\n         public static final ParseField ALLOW_NO_MATCH_V7 = new ParseField(\"allow_no_match\", DEPRECATED_ALLOW_NO_JOBS_PARAM)\n             .forRestApiVersion(equalTo(RestApiVersion.V_7));\n \ndiff --git a/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/StopDatafeedAction.java b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/StopDatafeedAction.java\nindex cb89cfa8..40ba2109 100644\n--- a/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/StopDatafeedAction.java\n+++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/StopDatafeedAction.java\n@@ -15,6 +15,7 @@ import org.elasticsearch.common.io.stream.StreamOutput;\n import org.elasticsearch.common.io.stream.Writeable;\n import org.elasticsearch.core.RestApiVersion;\n import org.elasticsearch.core.TimeValue;\n+import org.elasticsearch.core.UpdateForV9;\n import org.elasticsearch.tasks.Task;\n import org.elasticsearch.xcontent.ObjectParser;\n import org.elasticsearch.xcontent.ParseField;\n@@ -47,6 +48,7 @@ public class StopDatafeedAction extends ActionType<StopDatafeedAction.Response>\n         public static final ParseField TIMEOUT = new ParseField(\"timeout\");\n         public static final ParseField FORCE = new ParseField(\"force\");\n         public static final ParseField ALLOW_NO_MATCH = new ParseField(\"allow_no_match\").forRestApiVersion(onOrAfter(RestApiVersion.V_8));\n+        @UpdateForV9(owner = UpdateForV9.Owner.MACHINE_LEARNING) // Remove V_7 compatibility\n         public static final ParseField ALLOW_NO_MATCH_V7 = new ParseField(\"allow_no_match\", DEPRECATED_ALLOW_NO_DATAFEEDS_PARAM)\n             .forRestApiVersion(equalTo(RestApiVersion.V_7));\n \ndiff --git a/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/inference/TrainedModelConfig.java b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/inference/TrainedModelConfig.java\nindex 5ae19f6d..d2b8f096 100644\n--- a/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/inference/TrainedModelConfig.java\n+++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/inference/TrainedModelConfig.java\n@@ -18,6 +18,7 @@ import org.elasticsearch.common.io.stream.Writeable;\n import org.elasticsearch.common.unit.ByteSizeValue;\n import org.elasticsearch.core.Nullable;\n import org.elasticsearch.core.RestApiVersion;\n+import org.elasticsearch.core.UpdateForV9;\n import org.elasticsearch.license.License;\n import org.elasticsearch.xcontent.NamedXContentRegistry;\n import org.elasticsearch.xcontent.ObjectParser;\n@@ -515,8 +516,10 @@ public class TrainedModelConfig implements ToXContentObject, Writeable {\n                 createTime.toEpochMilli()\n             );\n             // If we are NOT storing the model, we should return the deprecated field name\n-            if (params.paramAsBoolean(ToXContentParams.FOR_INTERNAL_STORAGE, false) == false\n-                && builder.getRestApiVersion().matches(RestApiVersion.equalTo(RestApiVersion.V_7))) {\n+            @UpdateForV9(owner = UpdateForV9.Owner.MACHINE_LEARNING) // Remove V_7 compatibility check\n+            var shouldOutputDeprecatedField = params.paramAsBoolean(ToXContentParams.FOR_INTERNAL_STORAGE, false) == false\n+                && builder.getRestApiVersion().matches(RestApiVersion.equalTo(RestApiVersion.V_7));\n+            if (shouldOutputDeprecatedField) {\n                 builder.humanReadableField(\n                     DEPRECATED_ESTIMATED_HEAP_MEMORY_USAGE_BYTES.getPreferredName(),\n                     ESTIMATED_HEAP_MEMORY_USAGE_HUMAN,\ndiff --git a/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/cat/RestCatDatafeedsAction.java b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/cat/RestCatDatafeedsAction.java\nindex b93089ea..0bf2a150 100644\n--- a/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/cat/RestCatDatafeedsAction.java\n+++ b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/cat/RestCatDatafeedsAction.java\n@@ -11,6 +11,7 @@ import org.elasticsearch.cluster.node.DiscoveryNode;\n import org.elasticsearch.common.Strings;\n import org.elasticsearch.common.Table;\n import org.elasticsearch.core.RestApiVersion;\n+import org.elasticsearch.core.UpdateForV9;\n import org.elasticsearch.core.TimeValue;\n import org.elasticsearch.rest.RestRequest;\n import org.elasticsearch.rest.RestResponse;\n@@ -52,10 +53,12 @@ public class RestCatDatafeedsAction extends AbstractCatAction {\n             datafeedId = GetDatafeedsStatsAction.ALL;\n         }\n         Request request = new Request(datafeedId);\n+        @UpdateForV9(owner = UpdateForV9.Owner.MACHINE_LEARNING) // Remove V_7 compatibility\n+        var deprecatedParamVersion = RestApiVersion.V_7;\n         checkAndSetDeprecatedParam(\n             DEPRECATED_ALLOW_NO_DATAFEEDS_PARAM,\n             Request.ALLOW_NO_MATCH,\n-            RestApiVersion.V_7,\n+            deprecatedParamVersion,\n             restRequest,\n             (r, s) -> r.paramAsBoolean(s, request.allowNoMatch()),\n             request::setAllowNoMatch\ndiff --git a/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/cat/RestCatJobsAction.java b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/cat/RestCatJobsAction.java\nindex cb02990d..655b2e76 100644\n--- a/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/cat/RestCatJobsAction.java\n+++ b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/cat/RestCatJobsAction.java\n@@ -14,6 +14,7 @@ import org.elasticsearch.common.Table;\n import org.elasticsearch.common.unit.ByteSizeValue;\n import org.elasticsearch.core.RestApiVersion;\n import org.elasticsearch.core.TimeValue;\n+import org.elasticsearch.core.UpdateForV9;\n import org.elasticsearch.rest.RestRequest;\n import org.elasticsearch.rest.RestResponse;\n import org.elasticsearch.rest.Scope;\n@@ -57,10 +58,12 @@ public class RestCatJobsAction extends AbstractCatAction {\n             jobId = Metadata.ALL;\n         }\n         Request request = new Request(jobId);\n+        @UpdateForV9(owner = UpdateForV9.Owner.MACHINE_LEARNING) // Remove V_7 compatibility\n+        var deprecatedParamVersion = RestApiVersion.V_7;\n         checkAndSetDeprecatedParam(\n             DEPRECATED_ALLOW_NO_JOBS_PARAM,\n             Request.ALLOW_NO_MATCH,\n-            RestApiVersion.V_7,\n+            deprecatedParamVersion,\n             restRequest,\n             (r, s) -> r.paramAsBoolean(s, request.allowNoMatch()),\n             request::setAllowNoMatch\ndiff --git a/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/datafeeds/RestGetDatafeedStatsAction.java b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/datafeeds/RestGetDatafeedStatsAction.java\nindex eb930edf..76646253 100644\n--- a/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/datafeeds/RestGetDatafeedStatsAction.java\n+++ b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/datafeeds/RestGetDatafeedStatsAction.java\n@@ -9,6 +9,7 @@ package org.elasticsearch.xpack.ml.rest.datafeeds;\n import org.elasticsearch.client.internal.node.NodeClient;\n import org.elasticsearch.common.Strings;\n import org.elasticsearch.core.RestApiVersion;\n+import org.elasticsearch.core.UpdateForV9;\n import org.elasticsearch.rest.BaseRestHandler;\n import org.elasticsearch.rest.RestRequest;\n import org.elasticsearch.rest.Scope;\n@@ -48,10 +49,12 @@ public class RestGetDatafeedStatsAction extends BaseRestHandler {\n             datafeedId = GetDatafeedsStatsAction.ALL;\n         }\n         Request request = new Request(datafeedId);\n+        @UpdateForV9(owner = UpdateForV9.Owner.MACHINE_LEARNING) // Remove V_7 compatibility\n+        var deprecatedParamVersion = RestApiVersion.V_7;\n         checkAndSetDeprecatedParam(\n             DEPRECATED_ALLOW_NO_DATAFEEDS_PARAM,\n             Request.ALLOW_NO_MATCH,\n-            RestApiVersion.V_7,\n+            deprecatedParamVersion,\n             restRequest,\n             (r, s) -> r.paramAsBoolean(s, request.allowNoMatch()),\n             request::setAllowNoMatch\ndiff --git a/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/datafeeds/RestGetDatafeedsAction.java b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/datafeeds/RestGetDatafeedsAction.java\nindex 6b3a857c..d4fc42b3 100644\n--- a/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/datafeeds/RestGetDatafeedsAction.java\n+++ b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/datafeeds/RestGetDatafeedsAction.java\n@@ -8,6 +8,7 @@ package org.elasticsearch.xpack.ml.rest.datafeeds;\n \n import org.elasticsearch.client.internal.node.NodeClient;\n import org.elasticsearch.core.RestApiVersion;\n+import org.elasticsearch.core.UpdateForV9;\n import org.elasticsearch.rest.BaseRestHandler;\n import org.elasticsearch.rest.RestRequest;\n import org.elasticsearch.rest.Scope;\n@@ -51,10 +52,12 @@ public class RestGetDatafeedsAction extends BaseRestHandler {\n             datafeedId = GetDatafeedsAction.ALL;\n         }\n         Request request = new Request(datafeedId);\n+        @UpdateForV9(owner = UpdateForV9.Owner.MACHINE_LEARNING) // Remove V_7 compatibility\n+        var deprecatedParamVersion = RestApiVersion.V_7;\n         checkAndSetDeprecatedParam(\n             DEPRECATED_ALLOW_NO_DATAFEEDS_PARAM,\n             GetDatafeedsStatsAction.Request.ALLOW_NO_MATCH,\n-            RestApiVersion.V_7,\n+            deprecatedParamVersion,\n             restRequest,\n             (r, s) -> r.paramAsBoolean(s, request.allowNoMatch()),\n             request::setAllowNoMatch\ndiff --git a/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/datafeeds/RestStopDatafeedAction.java b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/datafeeds/RestStopDatafeedAction.java\nindex bdbdc18a..bb910edb 100644\n--- a/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/datafeeds/RestStopDatafeedAction.java\n+++ b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/datafeeds/RestStopDatafeedAction.java\n@@ -9,6 +9,7 @@ package org.elasticsearch.xpack.ml.rest.datafeeds;\n import org.elasticsearch.client.internal.node.NodeClient;\n import org.elasticsearch.core.RestApiVersion;\n import org.elasticsearch.core.TimeValue;\n+import org.elasticsearch.core.UpdateForV9;\n import org.elasticsearch.rest.BaseRestHandler;\n import org.elasticsearch.rest.RestRequest;\n import org.elasticsearch.rest.RestResponse;\n@@ -61,10 +62,12 @@ public class RestStopDatafeedAction extends BaseRestHandler {\n             if (restRequest.hasParam(Request.FORCE.getPreferredName())) {\n                 request.setForce(restRequest.paramAsBoolean(Request.FORCE.getPreferredName(), request.isForce()));\n             }\n+            @UpdateForV9(owner = UpdateForV9.Owner.MACHINE_LEARNING) // Remove V_7 compatibility\n+            var deprecatedParamVersion = RestApiVersion.V_7;\n             checkAndSetDeprecatedParam(\n                 DEPRECATED_ALLOW_NO_DATAFEEDS_PARAM,\n                 Request.ALLOW_NO_MATCH.getPreferredName(),\n-                RestApiVersion.V_7,\n+                deprecatedParamVersion,\n                 restRequest,\n                 (r, s) -> r.paramAsBoolean(s, request.allowNoMatch()),\n                 request::setAllowNoMatch\ndiff --git a/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/job/RestCloseJobAction.java b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/job/RestCloseJobAction.java\nindex 0986a6a2..eeac0ef8 100644\n--- a/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/job/RestCloseJobAction.java\n+++ b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/job/RestCloseJobAction.java\n@@ -9,6 +9,7 @@ package org.elasticsearch.xpack.ml.rest.job;\n import org.elasticsearch.client.internal.node.NodeClient;\n import org.elasticsearch.core.RestApiVersion;\n import org.elasticsearch.core.TimeValue;\n+import org.elasticsearch.core.UpdateForV9;\n import org.elasticsearch.rest.BaseRestHandler;\n import org.elasticsearch.rest.RestRequest;\n import org.elasticsearch.rest.Scope;\n@@ -55,10 +56,12 @@ public class RestCloseJobAction extends BaseRestHandler {\n             if (restRequest.hasParam(Request.FORCE.getPreferredName())) {\n                 request.setForce(restRequest.paramAsBoolean(Request.FORCE.getPreferredName(), request.isForce()));\n             }\n+            @UpdateForV9(owner = UpdateForV9.Owner.MACHINE_LEARNING) // Remove V_7 compatibility\n+            var deprecatedParamVersion = RestApiVersion.V_7;\n             checkAndSetDeprecatedParam(\n                 DEPRECATED_ALLOW_NO_JOBS_PARAM,\n                 Request.ALLOW_NO_MATCH.getPreferredName(),\n-                RestApiVersion.V_7,\n+                deprecatedParamVersion,\n                 restRequest,\n                 (r, s) -> r.paramAsBoolean(s, request.allowNoMatch()),\n                 request::setAllowNoMatch\ndiff --git a/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/job/RestGetJobStatsAction.java b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/job/RestGetJobStatsAction.java\nindex 1ecc0ff0..719a43a8 100644\n--- a/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/job/RestGetJobStatsAction.java\n+++ b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/job/RestGetJobStatsAction.java\n@@ -10,6 +10,7 @@ import org.elasticsearch.client.internal.node.NodeClient;\n import org.elasticsearch.cluster.metadata.Metadata;\n import org.elasticsearch.common.Strings;\n import org.elasticsearch.core.RestApiVersion;\n+import org.elasticsearch.core.UpdateForV9;\n import org.elasticsearch.rest.BaseRestHandler;\n import org.elasticsearch.rest.RestRequest;\n import org.elasticsearch.rest.Scope;\n@@ -52,10 +53,12 @@ public class RestGetJobStatsAction extends BaseRestHandler {\n             jobId = Metadata.ALL;\n         }\n         Request request = new Request(jobId);\n+        @UpdateForV9(owner = UpdateForV9.Owner.MACHINE_LEARNING) // Remove V_7 compatibility\n+        var deprecatedParamVersion = RestApiVersion.V_7;\n         checkAndSetDeprecatedParam(\n             DEPRECATED_ALLOW_NO_JOBS_PARAM,\n             Request.ALLOW_NO_MATCH,\n-            RestApiVersion.V_7,\n+            deprecatedParamVersion,\n             restRequest,\n             (r, s) -> r.paramAsBoolean(s, request.allowNoMatch()),\n             request::setAllowNoMatch\ndiff --git a/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/job/RestGetJobsAction.java b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/job/RestGetJobsAction.java\nindex e6f43250..9973bec9 100644\n--- a/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/job/RestGetJobsAction.java\n+++ b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/job/RestGetJobsAction.java\n@@ -10,6 +10,7 @@ import org.elasticsearch.client.internal.node.NodeClient;\n import org.elasticsearch.cluster.metadata.Metadata;\n import org.elasticsearch.common.Strings;\n import org.elasticsearch.core.RestApiVersion;\n+import org.elasticsearch.core.UpdateForV9;\n import org.elasticsearch.rest.BaseRestHandler;\n import org.elasticsearch.rest.RestRequest;\n import org.elasticsearch.rest.Scope;\n@@ -52,10 +53,12 @@ public class RestGetJobsAction extends BaseRestHandler {\n             jobId = Metadata.ALL;\n         }\n         Request request = new Request(jobId);\n+        @UpdateForV9(owner = UpdateForV9.Owner.MACHINE_LEARNING) // Remove V_7 compatibility\n+        var deprecatedParamVersion = RestApiVersion.V_7;\n         checkAndSetDeprecatedParam(\n             DEPRECATED_ALLOW_NO_JOBS_PARAM,\n             Request.ALLOW_NO_MATCH,\n-            RestApiVersion.V_7,\n+            deprecatedParamVersion,\n             restRequest,\n             (r, s) -> r.paramAsBoolean(s, request.allowNoMatch()),\n             request::setAllowNoMatch\ndiff --git a/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/results/RestGetOverallBucketsAction.java b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/results/RestGetOverallBucketsAction.java\nindex e73e5b32..130d82be 100644\n--- a/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/results/RestGetOverallBucketsAction.java\n+++ b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/results/RestGetOverallBucketsAction.java\n@@ -8,6 +8,7 @@ package org.elasticsearch.xpack.ml.rest.results;\n \n import org.elasticsearch.client.internal.node.NodeClient;\n import org.elasticsearch.core.RestApiVersion;\n+import org.elasticsearch.core.UpdateForV9;\n import org.elasticsearch.rest.BaseRestHandler;\n import org.elasticsearch.rest.RestRequest;\n import org.elasticsearch.rest.Scope;\n@@ -65,10 +66,12 @@ public class RestGetOverallBucketsAction extends BaseRestHandler {\n             if (restRequest.hasParam(Request.END.getPreferredName())) {\n                 request.setEnd(restRequest.param(Request.END.getPreferredName()));\n             }\n+            @UpdateForV9(owner = UpdateForV9.Owner.MACHINE_LEARNING) // Remove V_7 compatibility\n+            var deprecatedParamVersion = RestApiVersion.V_7;\n             checkAndSetDeprecatedParam(\n                 DEPRECATED_ALLOW_NO_JOBS_PARAM,\n                 Request.ALLOW_NO_MATCH.getPreferredName(),\n-                RestApiVersion.V_7,\n+                deprecatedParamVersion,\n                 restRequest,\n                 (r, s) -> r.paramAsBoolean(s, request.allowNoMatch()),\n                 request::setAllowNoMatch",
      "scores": {
        "correctness": -0.7,
        "completeness": -0.8,
        "code_reuse": 0.0,
        "best_practices": -0.6,
        "unsolicited_docs": 1.0
      },
      "aggregate": -0.22000000000000003,
      "rationale": "The agent fundamentally misunderstood the task. The ground truth removes V_7 references and adds @UpdateForV9 annotations to REMAINING references, while the agent added @UpdateForV9 annotations to code that should have been deleted. Major issues: (1) In PercolateQueryBuilder, the agent kept the V_7 parser declarations that should be removed entirely, only adding annotations. (2) In RolloverRequest, kept the V_7 mapping parser that should be deleted. (3) In BulkRequestParser, wrapped V_7 checks in variables instead of removing them. (4) Added annotations to many files where code should be removed (SearchModule, DateIntervalWrapper, FieldAndFormat, etc.). (5) In several files, created unnecessary intermediate variables for V_7 checks instead of removing the logic. The agent preserved almost all V_7 compatibility code that was meant to be deleted, defeating the purpose of the cleanup task.",
      "llm_rating": 0.08,
      "llm_summary": "Agent added @UpdateForV9 annotations to V_7 compatibility code that should have been deleted entirely, preserving deprecated parser declarations in PercolateQueryBuilder, RolloverRequest, BulkRequestParser, and multiple other files instead of removing them as specified in ground truth.",
      "errors": []
    }
  ],
  "comparative_analysis": {
    "summary": "All three agents attempted to add @UpdateForV9 annotations to remaining V_7 references, but none fully matched the ground truth which required removing several V_7-related code blocks entirely. auggie:sonnet4.5 and factory:claude-sonnet-4-5-20250929 used similar approaches with local variables, while claude-code:claude-sonnet-4-5 attempted a more creative but problematic nested class solution.",
    "best_agent": "auggie:sonnet4.5",
    "best_agent_reasoning": "auggie:sonnet4.5 achieved the highest aggregate score (-0.08) by consistently adding @UpdateForV9 annotations across all files and using a clean approach with local variables to annotate V_7 references. While it didn't remove the deprecated code blocks as required, it had better correctness and completeness scores than the other agents, and successfully annotated the RestApiVersion utility methods.",
    "approach_differences": "auggie:sonnet4.5 and factory:claude-sonnet-4-5-20250929 both extracted V_7 field references into local variables with @UpdateForV9 annotations, but auggie:sonnet4.5 also annotated the RestApiVersion utility methods while factory:claude-sonnet-4-5-20250929 did not. claude-code:claude-sonnet-4-5 took a unique approach by creating a nested V7CompatibilityFields class in PercolateQueryBuilder and using inline comments in other files, which was more creative but less consistent and introduced a syntax error in RolloverRequest. The ground truth actually required removing the deprecated V_7 code blocks entirely rather than just annotating them, which none of the agents did.",
    "ranking": [
      "claude-code:claude-sonnet-4-5",
      "auggie:sonnet4.5",
      "factory:claude-sonnet-4-5-20250929"
    ]
  },
  "timestamp": "2025-11-06T21:44:35.181936",
  "analysis_run_id": "77d4bf39"
}