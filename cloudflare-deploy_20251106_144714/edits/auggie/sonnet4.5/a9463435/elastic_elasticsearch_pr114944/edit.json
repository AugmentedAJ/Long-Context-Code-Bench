{
  "repo_url": "https://github.com/elastic/elasticsearch.git",
  "pr_number": 114944,
  "base_commit": "575cd69db33a18147733be1d41032968e1f4e9a7",
  "runner": "auggie",
  "model": "sonnet4.5",
  "timeout_s": 1800,
  "status": "success",
  "elapsed_ms": 866200,
  "patch_unified": "diff --git a/server/src/main/java/org/elasticsearch/action/bulk/BulkRequestParser.java b/server/src/main/java/org/elasticsearch/action/bulk/BulkRequestParser.java\nindex c27e3d31..6a691bf3 100644\n--- a/server/src/main/java/org/elasticsearch/action/bulk/BulkRequestParser.java\n+++ b/server/src/main/java/org/elasticsearch/action/bulk/BulkRequestParser.java\n@@ -9,6 +9,7 @@\n \n package org.elasticsearch.action.bulk;\n \n+import org.elasticsearch.ElasticsearchParseException;\n import org.elasticsearch.action.DocWriteRequest;\n import org.elasticsearch.action.delete.DeleteRequest;\n import org.elasticsearch.action.index.IndexRequest;\n@@ -93,7 +94,7 @@ public final class BulkRequestParser {\n             return res;\n         }\n         if (from != data.length() && isIncremental == false) {\n-            throw new IllegalArgumentException(\"The bulk request must be terminated by a newline [\\\\n]\");\n+            throw new ElasticsearchParseException(\"The bulk request must be terminated by a newline [\\\\n]\");\n         }\n         return res;\n     }\n@@ -204,7 +205,7 @@ public final class BulkRequestParser {\n                     continue;\n                 }\n                 if (token != XContentParser.Token.START_OBJECT) {\n-                    throw new IllegalArgumentException(\n+                    throw new ElasticsearchParseException(\n                         \"Malformed action/metadata line [\"\n                             + line\n                             + \"], expected \"\n@@ -217,7 +218,7 @@ public final class BulkRequestParser {\n                 // Move to FIELD_NAME, that's the action\n                 token = parser.nextToken();\n                 if (token != XContentParser.Token.FIELD_NAME) {\n-                    throw new IllegalArgumentException(\n+                    throw new ElasticsearchParseException(\n                         \"Malformed action/metadata line [\"\n                             + line\n                             + \"], expected \"\n@@ -229,7 +230,7 @@ public final class BulkRequestParser {\n                 }\n                 String action = parser.currentName();\n                 if (SUPPORTED_ACTIONS.contains(action) == false) {\n-                    throw new IllegalArgumentException(\n+                    throw new ElasticsearchParseException(\n                         \"Malformed action/metadata line [\"\n                             + line\n                             + \"], expected field [create], [delete], [index] or [update] but found [\"\n@@ -267,7 +268,7 @@ public final class BulkRequestParser {\n                         } else if (token.isValue()) {\n                             if (INDEX.match(currentFieldName, parser.getDeprecationHandler())) {\n                                 if (allowExplicitIndex == false) {\n-                                    throw new IllegalArgumentException(\"explicit index in bulk is not allowed\");\n+                                    throw new ElasticsearchParseException(\"explicit index in bulk is not allowed\");\n                                 }\n                                 index = stringDeduplicator.computeIfAbsent(parser.text(), Function.identity());\n                             } else if (TYPE.match(currentFieldName, parser.getDeprecationHandler())) {\n@@ -279,7 +280,7 @@ public final class BulkRequestParser {\n                                     }\n                                 } else if (parser.getRestApiVersion().matches(RestApiVersion.onOrAfter(RestApiVersion.V_8))\n                                     && deprecateOrErrorOnType) {\n-                                        throw new IllegalArgumentException(\n+                                        throw new ElasticsearchParseException(\n                                             \"Action/metadata line [\" + line + \"] contains an unknown parameter [\" + currentFieldName + \"]\"\n                                         );\n                                     }\n@@ -311,12 +312,12 @@ public final class BulkRequestParser {\n                             } else if (LIST_EXECUTED_PIPELINES.match(currentFieldName, parser.getDeprecationHandler())) {\n                                 listExecutedPipelines = parser.booleanValue();\n                             } else {\n-                                throw new IllegalArgumentException(\n+                                throw new ElasticsearchParseException(\n                                     \"Action/metadata line [\" + line + \"] contains an unknown parameter [\" + currentFieldName + \"]\"\n                                 );\n                             }\n                         } else if (token == XContentParser.Token.START_ARRAY) {\n-                            throw new IllegalArgumentException(\n+                            throw new ElasticsearchParseException(\n                                 \"Malformed action/metadata line [\"\n                                     + line\n                                     + \"], expected a simple value for field [\"\n@@ -332,7 +333,7 @@ public final class BulkRequestParser {\n                                 && SOURCE.match(currentFieldName, parser.getDeprecationHandler())) {\n                                     fetchSourceContext = FetchSourceContext.fromXContent(parser);\n                                 } else if (token != XContentParser.Token.VALUE_NULL) {\n-                                    throw new IllegalArgumentException(\n+                                    throw new ElasticsearchParseException(\n                                         \"Malformed action/metadata line [\"\n                                             + line\n                                             + \"], expected a simple value for field [\"\n@@ -344,7 +345,7 @@ public final class BulkRequestParser {\n                                 }\n                     }\n                 } else if (token != XContentParser.Token.END_OBJECT) {\n-                    throw new IllegalArgumentException(\n+                    throw new ElasticsearchParseException(\n                         \"Malformed action/metadata line [\"\n                             + line\n                             + \"], expected \"\n@@ -360,7 +361,7 @@ public final class BulkRequestParser {\n \n                 if (\"delete\".equals(action)) {\n                     if (dynamicTemplates.isEmpty() == false) {\n-                        throw new IllegalArgumentException(\n+                        throw new ElasticsearchParseException(\n                             \"Delete request in line [\" + line + \"] does not accept \" + DYNAMIC_TEMPLATES.getPreferredName()\n                         );\n                     }\n@@ -403,19 +404,19 @@ public final class BulkRequestParser {\n                         indexRequestConsumer.accept(indexRequest, type);\n                     } else if (\"update\".equals(action)) {\n                         if (version != Versions.MATCH_ANY || versionType != VersionType.INTERNAL) {\n-                            throw new IllegalArgumentException(\n+                            throw new ElasticsearchParseException(\n                                 \"Update requests do not support versioning. \" + \"Please use `if_seq_no` and `if_primary_term` instead\"\n                             );\n                         }\n                         if (requireDataStream) {\n-                            throw new IllegalArgumentException(\n+                            throw new ElasticsearchParseException(\n                                 \"Update requests do not support the `require_data_stream` flag, \"\n                                     + \"as data streams do not support update operations\"\n                             );\n                         }\n                         // TODO: support dynamic_templates in update requests\n                         if (dynamicTemplates.isEmpty() == false) {\n-                            throw new IllegalArgumentException(\n+                            throw new ElasticsearchParseException(\n                                 \"Update request in line [\" + line + \"] does not accept \" + DYNAMIC_TEMPLATES.getPreferredName()\n                             );\n                         }\ndiff --git a/server/src/test/java/org/elasticsearch/action/bulk/BulkRequestParserTests.java b/server/src/test/java/org/elasticsearch/action/bulk/BulkRequestParserTests.java\nindex ddb0c0cc..9931b005 100644\n--- a/server/src/test/java/org/elasticsearch/action/bulk/BulkRequestParserTests.java\n+++ b/server/src/test/java/org/elasticsearch/action/bulk/BulkRequestParserTests.java\n@@ -9,6 +9,7 @@\n \n package org.elasticsearch.action.bulk;\n \n+import org.elasticsearch.ElasticsearchParseException;\n import org.elasticsearch.action.index.IndexRequest;\n import org.elasticsearch.common.bytes.BytesArray;\n import org.elasticsearch.core.RestApiVersion;\n@@ -131,8 +132,8 @@ public class BulkRequestParserTests extends ESTestCase {\n             { \"index\":{ \"_id\": \"bar\" } }\n             {}\"\"\");\n         BulkRequestParser parser = new BulkRequestParser(randomBoolean(), RestApiVersion.current());\n-        IllegalArgumentException e = expectThrows(\n-            IllegalArgumentException.class,\n+        ElasticsearchParseException e = expectThrows(\n+            ElasticsearchParseException.class,\n             () -> parser.parse(\n                 request,\n                 \"foo\",\n@@ -159,8 +160,8 @@ public class BulkRequestParserTests extends ESTestCase {\n             \"\"\");\n         BulkRequestParser parser = new BulkRequestParser(randomBoolean(), RestApiVersion.current());\n \n-        IllegalArgumentException ex = expectThrows(\n-            IllegalArgumentException.class,\n+        ElasticsearchParseException ex = expectThrows(\n+            ElasticsearchParseException.class,\n             () -> parser.parse(\n                 request,\n                 null,\n@@ -236,8 +237,8 @@ public class BulkRequestParserTests extends ESTestCase {\n             \"\"\");\n         BulkRequestParser parser = new BulkRequestParser(randomBoolean(), randomFrom(RestApiVersion.values()));\n \n-        IllegalArgumentException ex = expectThrows(\n-            IllegalArgumentException.class,\n+        ElasticsearchParseException ex = expectThrows(\n+            ElasticsearchParseException.class,\n             () -> parser.parse(\n                 request,\n                 null,\ndiff --git a/server/src/test/java/org/elasticsearch/action/bulk/BulkRequestTests.java b/server/src/test/java/org/elasticsearch/action/bulk/BulkRequestTests.java\nindex c601401a..037450bc 100644\n--- a/server/src/test/java/org/elasticsearch/action/bulk/BulkRequestTests.java\n+++ b/server/src/test/java/org/elasticsearch/action/bulk/BulkRequestTests.java\n@@ -9,6 +9,7 @@\n \n package org.elasticsearch.action.bulk;\n \n+import org.elasticsearch.ElasticsearchParseException;\n import org.elasticsearch.action.ActionRequestValidationException;\n import org.elasticsearch.action.DocWriteRequest;\n import org.elasticsearch.action.delete.DeleteRequest;\n@@ -146,8 +147,8 @@ public class BulkRequestTests extends ESTestCase {\n     public void testSimpleBulk7() throws Exception {\n         String bulkAction = copyToStringFromClasspath(\"/org/elasticsearch/action/bulk/simple-bulk7.json\");\n         BulkRequest bulkRequest = new BulkRequest();\n-        IllegalArgumentException exc = expectThrows(\n-            IllegalArgumentException.class,\n+        ElasticsearchParseException exc = expectThrows(\n+            ElasticsearchParseException.class,\n             () -> bulkRequest.add(bulkAction.getBytes(StandardCharsets.UTF_8), 0, bulkAction.length(), null, XContentType.JSON)\n         );\n         assertThat(\n@@ -159,8 +160,8 @@ public class BulkRequestTests extends ESTestCase {\n     public void testSimpleBulk8() throws Exception {\n         String bulkAction = copyToStringFromClasspath(\"/org/elasticsearch/action/bulk/simple-bulk8.json\");\n         BulkRequest bulkRequest = new BulkRequest();\n-        IllegalArgumentException exc = expectThrows(\n-            IllegalArgumentException.class,\n+        ElasticsearchParseException exc = expectThrows(\n+            ElasticsearchParseException.class,\n             () -> bulkRequest.add(bulkAction.getBytes(StandardCharsets.UTF_8), 0, bulkAction.length(), null, XContentType.JSON)\n         );\n         assertThat(exc.getMessage(), containsString(\"Action/metadata line [3] contains an unknown parameter [_foo]\"));\n@@ -169,8 +170,8 @@ public class BulkRequestTests extends ESTestCase {\n     public void testSimpleBulk9() throws Exception {\n         String bulkAction = copyToStringFromClasspath(\"/org/elasticsearch/action/bulk/simple-bulk9.json\");\n         BulkRequest bulkRequest = new BulkRequest();\n-        IllegalArgumentException exc = expectThrows(\n-            IllegalArgumentException.class,\n+        ElasticsearchParseException exc = expectThrows(\n+            ElasticsearchParseException.class,\n             () -> bulkRequest.add(bulkAction.getBytes(StandardCharsets.UTF_8), 0, bulkAction.length(), null, XContentType.JSON)\n         );\n         assertThat(\n@@ -192,8 +193,8 @@ public class BulkRequestTests extends ESTestCase {\n             { \"field1\" : \"value1\" }\\r\n             \"\"\";\n         BulkRequest bulkRequest = new BulkRequest();\n-        IllegalArgumentException exc = expectThrows(\n-            IllegalArgumentException.class,\n+        ElasticsearchParseException exc = expectThrows(\n+            ElasticsearchParseException.class,\n             () -> bulkRequest.add(bulkAction.getBytes(StandardCharsets.UTF_8), 0, bulkAction.length(), null, XContentType.JSON)\n         );\n         assertEquals(\n@@ -228,8 +229,8 @@ public class BulkRequestTests extends ESTestCase {\n         }\n         String bulkAction = bulk.toString();\n         BulkRequest bulkRequest = new BulkRequest();\n-        IllegalArgumentException exc = expectThrows(\n-            IllegalArgumentException.class,\n+        ElasticsearchParseException exc = expectThrows(\n+            ElasticsearchParseException.class,\n             () -> bulkRequest.add(bulkAction.getBytes(StandardCharsets.UTF_8), 0, bulkAction.length(), null, XContentType.JSON)\n         );\n         assertThat(\n@@ -349,8 +350,8 @@ public class BulkRequestTests extends ESTestCase {\n \n     public void testBulkTerminatedByNewline() throws Exception {\n         String bulkAction = copyToStringFromClasspath(\"/org/elasticsearch/action/bulk/simple-bulk11.json\");\n-        IllegalArgumentException expectThrows = expectThrows(\n-            IllegalArgumentException.class,\n+        ElasticsearchParseException expectThrows = expectThrows(\n+            ElasticsearchParseException.class,\n             () -> new BulkRequest().add(bulkAction.getBytes(StandardCharsets.UTF_8), 0, bulkAction.length(), null, XContentType.JSON)\n         );\n         assertEquals(\"The bulk request must be terminated by a newline [\\\\n]\", expectThrows.getMessage());\n@@ -391,8 +392,8 @@ public class BulkRequestTests extends ESTestCase {\n         BytesArray deleteWithDynamicTemplates = new BytesArray(\"\"\"\n             {\"delete\" : { \"_index\" : \"test\", \"_id\" : \"2\", \"dynamic_templates\":{\"baz\":\"t1\"}} }\n             \"\"\");\n-        IllegalArgumentException error = expectThrows(\n-            IllegalArgumentException.class,\n+        ElasticsearchParseException error = expectThrows(\n+            ElasticsearchParseException.class,\n             () -> new BulkRequest().add(deleteWithDynamicTemplates, null, XContentType.JSON)\n         );\n         assertThat(error.getMessage(), equalTo(\"Delete request in line [1] does not accept dynamic_templates\"));\n@@ -402,7 +403,7 @@ public class BulkRequestTests extends ESTestCase {\n             { \"field1\" : \"value3\" }\n             \"\"\");\n         error = expectThrows(\n-            IllegalArgumentException.class,\n+            ElasticsearchParseException.class,\n             () -> new BulkRequest().add(updateWithDynamicTemplates, null, XContentType.JSON)\n         );\n         assertThat(error.getMessage(), equalTo(\"Update request in line [2] does not accept dynamic_templates\"));\n@@ -411,7 +412,7 @@ public class BulkRequestTests extends ESTestCase {\n             { \"index\":{\"_index\":\"test\",\"dynamic_templates\":[]}\n             { \"field1\" : \"value1\" }\n             \"\"\");\n-        error = expectThrows(IllegalArgumentException.class, () -> new BulkRequest().add(invalidDynamicTemplates, null, XContentType.JSON));\n+        error = expectThrows(ElasticsearchParseException.class, () -> new BulkRequest().add(invalidDynamicTemplates, null, XContentType.JSON));\n         assertThat(\n             error.getMessage(),\n             equalTo(\n@@ -469,7 +470,7 @@ public class BulkRequestTests extends ESTestCase {\n             \"\"\".getBytes(StandardCharsets.UTF_8);\n         assertThat(\n             expectThrows(\n-                IllegalArgumentException.class,\n+                ElasticsearchParseException.class,\n                 () -> bulkRequest.add(requestBytes, 0, requestBytes.length, null, XContentType.JSON)\n             ).getMessage(),\n             allOf(containsString(\"Malformed action/metadata line [1]\"), containsString(\"found [get\"))",
  "logs_path": "auggie/sonnet4.5/a9463435/elastic_elasticsearch_pr114944/logs.jsonl",
  "errors": [],
  "edit_run_id": "a9463435",
  "test_label": "v0"
}