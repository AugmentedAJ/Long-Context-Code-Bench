{
  "repo_url": "https://github.com/elastic/elasticsearch.git",
  "pr_number": 114863,
  "base_commit": "4fa8485a26d5d57e52117ae8d9f89491853703d9",
  "runner": "auggie",
  "model": "sonnet4.5",
  "timeout_s": 1800,
  "status": "success",
  "elapsed_ms": 456139,
  "patch_unified": "diff --git a/x-pack/plugin/esql-core/src/main/java/org/elasticsearch/xpack/esql/core/type/DataType.java b/x-pack/plugin/esql-core/src/main/java/org/elasticsearch/xpack/esql/core/type/DataType.java\nindex b23703c6..2021d11a 100644\n--- a/x-pack/plugin/esql-core/src/main/java/org/elasticsearch/xpack/esql/core/type/DataType.java\n+++ b/x-pack/plugin/esql-core/src/main/java/org/elasticsearch/xpack/esql/core/type/DataType.java\n@@ -292,6 +292,13 @@ public enum DataType {\n         return TYPES;\n     }\n \n+    /**\n+     * Returns all string types (KEYWORD, TEXT, etc).\n+     */\n+    public static Collection<DataType> stringTypes() {\n+        return types().stream().filter(DataType::isString).toList();\n+    }\n+\n     /**\n      * Resolve a type from a name. This name is sometimes user supplied,\n      * like in the case of {@code ::<typename>} and is sometimes the name\ndiff --git a/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/scalar/conditional/Greatest.java b/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/scalar/conditional/Greatest.java\nindex 9d815d15..43b7ecce 100644\n--- a/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/scalar/conditional/Greatest.java\n+++ b/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/scalar/conditional/Greatest.java\n@@ -155,8 +155,7 @@ public class Greatest extends EsqlScalarFunction implements OptionalArgument {\n         if (dataType == DataType.LONG || dataType == DataType.DATETIME) {\n             return new GreatestLongEvaluator.Factory(source(), factories);\n         }\n-        if (dataType == DataType.KEYWORD\n-            || dataType == DataType.TEXT\n+        if (DataType.isString(dataType)\n             || dataType == DataType.IP\n             || dataType == DataType.VERSION\n             || dataType == DataType.UNSUPPORTED) {\ndiff --git a/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/scalar/conditional/Least.java b/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/scalar/conditional/Least.java\nindex 435a14d0..b9acf2da 100644\n--- a/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/scalar/conditional/Least.java\n+++ b/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/scalar/conditional/Least.java\n@@ -154,8 +154,7 @@ public class Least extends EsqlScalarFunction implements OptionalArgument {\n         if (dataType == DataType.LONG || dataType == DataType.DATETIME) {\n             return new LeastLongEvaluator.Factory(source(), factories);\n         }\n-        if (dataType == DataType.KEYWORD\n-            || dataType == DataType.TEXT\n+        if (DataType.isString(dataType)\n             || dataType == DataType.IP\n             || dataType == DataType.VERSION\n             || dataType == DataType.UNSUPPORTED) {\ndiff --git a/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/predicate/operator/comparison/InsensitiveEqualsMapper.java b/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/predicate/operator/comparison/InsensitiveEqualsMapper.java\nindex d11f5c9b..f5704239 100644\n--- a/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/predicate/operator/comparison/InsensitiveEqualsMapper.java\n+++ b/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/predicate/operator/comparison/InsensitiveEqualsMapper.java\n@@ -34,7 +34,7 @@ public class InsensitiveEqualsMapper extends ExpressionMapper<InsensitiveEquals>\n \n         var leftEval = toEvaluator(bc.left(), layout);\n         var rightEval = toEvaluator(bc.right(), layout);\n-        if (leftType == DataType.KEYWORD || leftType == DataType.TEXT) {\n+        if (DataType.isString(leftType)) {\n             if (bc.right().foldable() && DataType.isString(rightType)) {\n                 BytesRef rightVal = BytesRefs.toBytesRef(bc.right().fold());\n                 Automaton automaton = InsensitiveEquals.automaton(rightVal);\ndiff --git a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/AbstractFunctionTestCase.java b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/AbstractFunctionTestCase.java\nindex ca9950a4..8a00eac4 100644\n--- a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/AbstractFunctionTestCase.java\n+++ b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/AbstractFunctionTestCase.java\n@@ -1287,7 +1287,7 @@ public abstract class AbstractFunctionTestCase extends ESTestCase {\n      * All string types (keyword, text, match_only_text, etc).\n      */\n     protected static DataType[] strings() {\n-        return DataType.types().stream().filter(DataType::isString).toArray(DataType[]::new);\n+        return DataType.stringTypes().toArray(DataType[]::new);\n     }\n \n     /**\ndiff --git a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/fulltext/QueryStringTests.java b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/fulltext/QueryStringTests.java\nindex 2dfdb05e..926a4b96 100644\n--- a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/fulltext/QueryStringTests.java\n+++ b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/fulltext/QueryStringTests.java\n@@ -36,7 +36,7 @@ public class QueryStringTests extends AbstractFunctionTestCase {\n     @ParametersFactory\n     public static Iterable<Object[]> parameters() {\n         List<TestCaseSupplier> suppliers = new LinkedList<>();\n-        for (DataType strType : Arrays.stream(DataType.values()).filter(DataType::isString).toList()) {\n+        for (DataType strType : DataType.stringTypes()) {\n             suppliers.add(\n                 new TestCaseSupplier(\n                     \"<\" + strType + \">\",\ndiff --git a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/EndsWithTests.java b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/EndsWithTests.java\nindex 6d086e26..98d0db0d 100644\n--- a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/EndsWithTests.java\n+++ b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/EndsWithTests.java\n@@ -33,8 +33,8 @@ public class EndsWithTests extends AbstractScalarFunctionTestCase {\n     @ParametersFactory\n     public static Iterable<Object[]> parameters() {\n         List<TestCaseSupplier> suppliers = new LinkedList<>();\n-        for (DataType strType : Arrays.stream(DataType.values()).filter(DataType::isString).toList()) {\n-            for (DataType suffixType : Arrays.stream(DataType.values()).filter(DataType::isString).toList()) {\n+        for (DataType strType : DataType.stringTypes()) {\n+            for (DataType suffixType : DataType.stringTypes()) {\n                 suppliers.add(\n                     new TestCaseSupplier(\n                         \"<\" + strType + \">, empty <\" + suffixType + \">\",\ndiff --git a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/RLikeTests.java b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/RLikeTests.java\nindex 5a34d850..4f8adf3a 100644\n--- a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/RLikeTests.java\n+++ b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/RLikeTests.java\n@@ -69,7 +69,7 @@ public class RLikeTests extends AbstractScalarFunctionTestCase {\n         casesForString(cases, \"6 bytes, 2 code points\", () -> \"❗️\", false, escapeString, optionalPattern);\n         casesForString(cases, \"100 random code points\", () -> randomUnicodeOfCodepointLength(100), true, escapeString, optionalPattern);\n         for (DataType type : DataType.types()) {\n-            if (type == DataType.KEYWORD || type == DataType.TEXT || type == DataType.NULL) {\n+            if (DataType.isString(type) || type == DataType.NULL) {\n                 continue;\n             }\n             if (DataType.isRepresentable(type) == false) {\n@@ -125,7 +125,7 @@ public class RLikeTests extends AbstractScalarFunctionTestCase {\n     }\n \n     private static void cases(List<TestCaseSupplier> cases, String title, Supplier<TextAndPattern> textAndPattern, boolean expected) {\n-        for (DataType type : new DataType[] { DataType.KEYWORD, DataType.TEXT }) {\n+        for (DataType type : DataType.stringTypes()) {\n             cases.add(new TestCaseSupplier(title + \" with \" + type.esType(), List.of(type, type, DataType.BOOLEAN), () -> {\n                 TextAndPattern v = textAndPattern.get();\n                 return new TestCaseSupplier.TestCase(\ndiff --git a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/StartsWithTests.java b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/StartsWithTests.java\nindex 8bc8cf31..bcee1559 100644\n--- a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/StartsWithTests.java\n+++ b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/StartsWithTests.java\n@@ -32,8 +32,8 @@ public class StartsWithTests extends AbstractScalarFunctionTestCase {\n     @ParametersFactory\n     public static Iterable<Object[]> parameters() {\n         List<TestCaseSupplier> suppliers = new ArrayList<>();\n-        for (DataType strType : Arrays.stream(DataType.values()).filter(DataType::isString).toList()) {\n-            for (DataType prefixType : Arrays.stream(DataType.values()).filter(DataType::isString).toList()) {\n+        for (DataType strType : DataType.stringTypes()) {\n+            for (DataType prefixType : DataType.stringTypes()) {\n                 suppliers.add(new TestCaseSupplier(List.of(strType, prefixType), () -> {\n                     String str = randomAlphaOfLength(5);\n                     String prefix = randomAlphaOfLength(5);\ndiff --git a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/WildcardLikeTests.java b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/WildcardLikeTests.java\nindex 53b3a99f..737ccd4e 100644\n--- a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/WildcardLikeTests.java\n+++ b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/string/WildcardLikeTests.java\n@@ -53,7 +53,7 @@ public class WildcardLikeTests extends AbstractScalarFunctionTestCase {\n     }\n \n     private static void addCases(List<TestCaseSupplier> suppliers) {\n-        for (DataType type : new DataType[] { DataType.KEYWORD, DataType.TEXT }) {\n+        for (DataType type : DataType.stringTypes()) {\n             suppliers.add(new TestCaseSupplier(\" with \" + type.esType(), List.of(type, type), () -> {\n                 BytesRef str = new BytesRef(randomAlphaOfLength(5));\n                 String patternString = randomAlphaOfLength(2);\ndiff --git a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/type/EsqlDataTypeConverterTests.java b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/type/EsqlDataTypeConverterTests.java\nindex 8ad08368..a9dfc834 100644\n--- a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/type/EsqlDataTypeConverterTests.java\n+++ b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/type/EsqlDataTypeConverterTests.java\n@@ -62,7 +62,7 @@ public class EsqlDataTypeConverterTests extends ESTestCase {\n     }\n \n     public void testCommonTypeStrings() {\n-        List<DataType> STRINGS = Arrays.stream(DataType.values()).filter(DataType::isString).toList();\n+        List<DataType> STRINGS = DataType.stringTypes().stream().toList();\n         for (DataType dataType1 : STRINGS) {\n             for (DataType dataType2 : DataType.values()) {\n                 if (dataType2 == NULL) {",
  "logs_path": "auggie/sonnet4.5/a9463435/elastic_elasticsearch_pr114863/logs.jsonl",
  "errors": [],
  "edit_run_id": "a9463435",
  "test_label": "v0"
}