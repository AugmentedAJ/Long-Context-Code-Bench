{"timestamp": 1761895367.826997, "event": "agent_start", "runner": "auggie", "model": "sonnet4.5", "command": ["auggie", "--print", "--model", "sonnet4.5", "--workspace-root", "/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpbj6dsrar/workspace", "--instruction-file", "/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpbj6dsrar/workspace/.auggie_task.txt", "--retry-timeout", "1800"], "workspace": "/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpbj6dsrar/workspace", "timeout_s": 1800}
{"timestamp": 1761895633.2516532, "event": "agent_run", "stdout": "\ud83e\udd16\nI'll start by gathering information about this backport task. Let me search for relevant code related to named parameters for identifiers and patterns in ES|QL.\n\n\n\u001b[90m\ud83d\udd27 Tool call: codebase-retrieval\u001b[0m\n   information_request: \"named parameter for identifier and pattern in ESQL, snapshot build configuration\"\n\n\u001b[90m\ud83d\udccb Tool result: codebase-retrieval\u001b[0m\nThe following code sections were retrieved:\nPath: docs/reference/esql/esql-rest.asciidoc\n...\n   260\t----\n   261\t// TEST[setup:library]\n   262\t\n   263\tTo avoid any attempts of hacking or code injection, extract the values in a\n   264\tseparate list of parameters. Use question mark placeholders (`?`) in the query\n   265\tstring for each of the parameters:\n   266\t\n   267\t[source,console]\n   268\t----\n   269\tPOST /_query\n   270\t{\n   271\t  \"query\": \"\"\"\n... (733 more lines)\n\n\u001b[90m\ud83d\udd27 Tool call: codebase-retrieval\u001b[0m\n   information_request: \"ESQL parameter types, identifier parameter, pattern parameter\"\n\n\u001b[90m\ud83d\udccb Tool result: codebase-retrieval\u001b[0m\nThe following code sections were retrieved:\nPath: x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/parser/ExpressionBuilder.java\n...\n   842\t\n   843\t    private Expression visitParam(EsqlBaseParser.ParameterContext ctx, QueryParam param) {\n   844\t        Source source = source(ctx);\n   845\t        DataType type = param.type();\n   846\t        var value = param.value();\n   847\t        ParserUtils.ParamClassification classification = param.classification();\n   848\t        // RequestXContent does not allow null value for identifier or pattern\n   849\t        if (value != null && classification != VALUE) {\n   850\t            if (classification == PATTERN) {\n   851\t                // let visitQualifiedNamePattern create a real UnresolvedNamePattern with Automaton\n   852\t                return new UnresolvedNamePattern(source, null, value.toString(), value.toString());\n   853\t            } else {\n... (587 more lines)\n\n\u001b[90m\ud83d\udd27 Tool call: view\u001b[0m\n   path: \".\"\n   type: \"directory\"\n\n\u001b[90m\ud83d\udccb Tool result: view\u001b[0m\nHere's the files and directories up to 2 levels deep in ., excluding hidden items:\n./BUILDING.md\n./CHANGELOG.md\n./CONTRIBUTING.md\n./LICENSE.txt\n./NOTICE.txt\n./README.asciidoc\n./REST_API_COMPATIBILITY.md\n./TESTING.asciidoc\n./TRACING.md\n./Vagrantfile\n./benchmarks\n./branches.json\n./build-conventions\n./build-tools\n... (201 more lines)\n\ud83e\udd16\nLet me search more specifically for the code related to named parameters for identifiers and patterns:\n\n\n\u001b[90m\ud83d\udd27 Tool call: view\u001b[0m\n   path: \"x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/action/RequestXContent.java\"\n   type: \"file\"\n   search_query_regex: \"classification == IDENTIFIER|classification == PATTERN|Build\\.current\\(\\)\\.isSnapshot\\(\\)\"\n\n\u001b[90m\ud83d\udccb Tool result: view\u001b[0m\nRegex search results for pattern: classification == IDENTIFIER|classification == PATTERN|Build\\.current\\(\\)\\.isSnapshot\\(\\) in x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/action/RequestXContent.java\nFound 3 matching lines:\n\n    324\t            }\n    325\t        }\n    326\t\n    327\t        // If a param is an \"identifier\" or a \"pattern\", validate it is a string.\n    328\t        // If a param is a \"pattern\", validate it contains *.\n>   329\t        if (classification == IDENTIFIER || classification == PATTERN) {\n    330\t            if (DataType.fromJava(value) != KEYWORD\n    331\t                || (classification == PATTERN && value != null && value.toString().contains(WILDCARD) == false)) {\n    332\t                errors.add(\n    333\t                    new XContentParseException(\n    334\t                        loc,\n    335\t                        format(\n... (14 more lines)\n\n\u001b[90m\ud83d\udd27 Tool call: view\u001b[0m\n   path: \"x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/action/EsqlQueryRequestTests.java\"\n   type: \"file\"\n   search_query_regex: \"named parameter for identifier|kind.*identifier|kind.*pattern\"\n\n\u001b[90m\ud83d\udccb Tool result: view\u001b[0m\nRegex search results for pattern: named parameter for identifier|kind.*identifier|kind.*pattern in x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/action/EsqlQueryRequestTests.java\nFound 17 matching lines:\n\n     98\t        boolean columnar = randomBoolean();\n     99\t        Locale locale = randomLocale(random());\n    100\t        QueryBuilder filter = randomQueryBuilder();\n    101\t\n    102\t        String paramsString = \"\"\"\n>   103\t            ,\"params\":[ {\"n1\" : {\"value\" : \"f1\", \"kind\" : \"Identifier\"}},\n    104\t             {\"n2\" : {\"value\" : \"f1*\", \"Kind\" : \"identifier\"}},\n    105\t             {\"n3\" : {\"value\" : \"f.1*\", \"KIND\" : \"Pattern\"}},\n    106\t             {\"n4\" : {\"value\" : \"*\", \"kind\" : \"pattern\"}},\n    107\t             {\"n5\" : {\"value\" : \"esql\", \"kind\" : \"Value\"}},\n    108\t             {\"n_6\" : {\"value\" : \"null\", \"kind\" : \"identifier\"}},\n    109\t             {\"n7_\" : {\"value\" : \"f.1.1\"}},\n... (53 more lines)\n\n\u001b[90m\ud83d\udd27 Tool call: web-search\u001b[0m\n   query: \"elasticsearch PR 114784 named parameter identifier pattern snapshot\"\n   num_results: 3\n\n\u001b[90m\ud83d\udccb Tool result: web-search\u001b[0m\n- [elasticsearch: docs/reference/release-notes.asciidoc | Fossies](https://fossies.org/linux/elasticsearch/docs/reference/release-notes.asciidoc)\n  Sep 16, 2025 ... Make named parameter for identifier and pattern snapshot {es-pull}114784[#114784]. Validate mv_sort order {es-pull}110021[#110021] (issue\u00a0...\n\n- [analysis-cpantesters-annotate/annotate.txt at master \u00b7 andk/analysis ...](https://github.com/andk/analysis-cpantesters-annotate/blob/master/annotate.txt)\n  ... ElasticSearch-0.1.0 84962 Class-Lite-v0.1.0 85039 Config-Options-0.08 85067 ... Snapshot-0.04 113817 Algorithm-Networksort-Chooser-0.110 113822 Audio\u00a0...\n\ud83e\udd16\nGreat! I found a reference in the release notes. Let me check the actual PR to understand what changes were made:\n\n\n\u001b[90m\ud83d\udd27 Tool call: web-fetch\u001b[0m\n   url: \"https://github.com/elastic/elasticsearch/pull/114784\"\n\n\u001b[90m\ud83d\udccb Tool result: web-fetch\u001b[0m\n\n\n\n\n\n\n\n\n\n\n\n\n\n  \n    \n... (5246 more lines)\n\ud83e\udd16\nNow let me look at the actual changes from the PR to understand what needs to be done:\n\n\n\u001b[90m\ud83d\udd27 Tool call: web-fetch\u001b[0m\n   url: \"https://github.com/elastic/elasticsearch/pull/114784/files\"\n\n\u001b[90m\ud83d\udccb Tool result: web-fetch\u001b[0m\n@@ -0,0 +1,5 @@\n\n    pr: 114784\n\n    summary: \"[ES|QL] make named parameter for identifier and pattern snapshot\"\n\n    area: ES|QL\n\n    type: bug\n\n    issues: []\n@@ -32,6 +32,7 @@\n\n    import org.elasticsearch.xcontent.XContentBuilder;\n\n... (351 more lines)\n\ud83e\udd16\nPerfect! Now I understand what needs to be done. The PR makes named parameters for identifiers and patterns available only under snapshot builds. Let me examine the current state of the files to see what changes need to be made:\n\n\n\u001b[90m\ud83d\udd27 Tool call: view\u001b[0m\n   path: \"x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/action/EsqlCapabilities.java\"\n   type: \"file\"\n   search_query_regex: \"NAMED_PARAMETER_FOR_FIELD_AND_FUNCTION_NAMES\"\n\n\u001b[90m\ud83d\udccb Tool result: view\u001b[0m\nRegex search results for pattern: NAMED_PARAMETER_FOR_FIELD_AND_FUNCTION_NAMES in x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/action/EsqlCapabilities.java\nFound 1 matching lines:\n\n    373\t        DATE_DIFF_YEAR_CALENDARIAL,\n    374\t\n    375\t        /**\n    376\t         * Support named parameters for field names.\n    377\t         */\n>   378\t        NAMED_PARAMETER_FOR_FIELD_AND_FUNCTION_NAMES,\n    379\t\n    380\t        /**\n    381\t         * Fix sorting not allowed on _source and counters.\n    382\t         */\n    383\t        SORTING_ON_SOURCE_AND_COUNTERS_FORBIDDEN,\n\n... (2 more lines)\n\n\u001b[90m\ud83d\udd27 Tool call: view\u001b[0m\n   path: \"x-pack/plugin/esql/src/main/antlr/EsqlBaseLexer.g4\"\n   type: \"file\"\n   view_range: [305,315]\n\n\u001b[90m\ud83d\udccb Tool result: view\u001b[0m\nHere's the result of running `cat -n` on x-pack/plugin/esql/src/main/antlr/EsqlBaseLexer.g4:\n   305\tPROJECT_PIPE : PIPE -> type(PIPE), popMode;\n   306\tPROJECT_DOT: DOT -> type(DOT);\n   307\tPROJECT_COMMA : COMMA -> type(COMMA);\n   308\tPROJECT_PARAM : PARAM -> type(PARAM);\n   309\tPROJECT_NAMED_OR_POSITIONAL_PARAM : NAMED_OR_POSITIONAL_PARAM -> type(NAMED_OR_POSITIONAL_PARAM);\n   310\t\n   311\tfragment UNQUOTED_ID_BODY_WITH_PATTERN\n   312\t    : (LETTER | DIGIT | UNDERSCORE | ASTERISK)\n   313\t    ;\n   314\t\n   315\tfragment UNQUOTED_ID_PATTERN\nTotal lines in file: 603\n\n\n\u001b[90m\ud83d\udd27 Tool call: view\u001b[0m\n   path: \"x-pack/plugin/esql/src/main/antlr/EsqlBaseParser.g4\"\n   type: \"file\"\n   view_range: [195,225]\n\n\u001b[90m\ud83d\udccb Tool result: view\u001b[0m\nHere's the result of running `cat -n` on x-pack/plugin/esql/src/main/antlr/EsqlBaseParser.g4:\n   195\t\n   196\tidentifierPattern\n   197\t    : ID_PATTERN\n   198\t    | parameter\n   199\t    ;\n   200\t\n   201\tconstant\n   202\t    : NULL                                                                              #nullLiteral\n   203\t    | integerValue UNQUOTED_IDENTIFIER                                                  #qualifiedIntegerLiteral\n   204\t    | decimalValue                                                                      #decimalLiteral\n   205\t    | integerValue                                                                      #integerLiteral\n   206\t    | booleanValue                                                                      #booleanLiteral\n   207\t    | parameter                                                                         #inputParameter\n   208\t    | string                                                                            #stringLiteral\n... (19 more lines)\n\ud83e\udd16\nNow let me check more sections of the lexer file to see all the places that need to be updated:\n\n\n\u001b[90m\ud83d\udd27 Tool call: view\u001b[0m\n   path: \"x-pack/plugin/esql/src/main/antlr/EsqlBaseLexer.g4\"\n   type: \"file\"\n   view_range: [338,348]\n\n\u001b[90m\ud83d\udccb Tool result: view\u001b[0m\nHere's the result of running `cat -n` on x-pack/plugin/esql/src/main/antlr/EsqlBaseLexer.g4:\n   338\tmode RENAME_MODE;\n   339\tRENAME_PIPE : PIPE -> type(PIPE), popMode;\n   340\tRENAME_ASSIGN : ASSIGN -> type(ASSIGN);\n   341\tRENAME_COMMA : COMMA -> type(COMMA);\n   342\tRENAME_DOT: DOT -> type(DOT);\n   343\tRENAME_PARAM : PARAM -> type(PARAM);\n   344\tRENAME_NAMED_OR_POSITIONAL_PARAM : NAMED_OR_POSITIONAL_PARAM -> type(NAMED_OR_POSITIONAL_PARAM);\n   345\t\n   346\tAS : 'as';\n   347\t\n   348\tRENAME_ID_PATTERN\nTotal lines in file: 603\n\n\n\u001b[90m\ud83d\udd27 Tool call: view\u001b[0m\n   path: \"x-pack/plugin/esql/src/main/antlr/EsqlBaseLexer.g4\"\n   type: \"file\"\n   view_range: [411,421]\n\n\u001b[90m\ud83d\udccb Tool result: view\u001b[0m\nHere's the result of running `cat -n` on x-pack/plugin/esql/src/main/antlr/EsqlBaseLexer.g4:\n   411\t\n   412\tENRICH_FIELD_QUOTED_IDENTIFIER\n   413\t    : QUOTED_IDENTIFIER -> type(QUOTED_IDENTIFIER)\n   414\t    ;\n   415\t\n   416\tENRICH_FIELD_PARAM : PARAM -> type(PARAM);\n   417\tENRICH_FIELD_NAMED_OR_POSITIONAL_PARAM : NAMED_OR_POSITIONAL_PARAM -> type(NAMED_OR_POSITIONAL_PARAM);\n   418\t\n   419\tENRICH_FIELD_LINE_COMMENT\n   420\t    : LINE_COMMENT -> channel(HIDDEN)\n   421\t    ;\nTotal lines in file: 603\n\n\n\u001b[90m\ud83d\udd27 Tool call: view\u001b[0m\n   path: \"x-pack/plugin/esql/src/main/antlr/EsqlBaseLexer.g4\"\n   type: \"file\"\n   view_range: [429,439]\n\n\u001b[90m\ud83d\udccb Tool result: view\u001b[0m\nHere's the result of running `cat -n` on x-pack/plugin/esql/src/main/antlr/EsqlBaseLexer.g4:\n   429\t    ;\n   430\t\n   431\tmode MVEXPAND_MODE;\n   432\tMVEXPAND_PIPE : PIPE -> type(PIPE), popMode;\n   433\tMVEXPAND_DOT: DOT -> type(DOT);\n   434\tMVEXPAND_PARAM : PARAM -> type(PARAM);\n   435\tMVEXPAND_NAMED_OR_POSITIONAL_PARAM : NAMED_OR_POSITIONAL_PARAM -> type(NAMED_OR_POSITIONAL_PARAM);\n   436\t\n   437\tMVEXPAND_QUOTED_IDENTIFIER\n   438\t    : QUOTED_IDENTIFIER -> type(QUOTED_IDENTIFIER)\n   439\t    ;\nTotal lines in file: 603\n\n\ud83e\udd16\nNow let me check the RequestXContent.java file to see where the check needs to be added:\n\n\n\u001b[90m\ud83d\udd27 Tool call: view\u001b[0m\n   path: \"x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/action/RequestXContent.java\"\n   type: \"file\"\n   view_range: [180,220]\n\n\u001b[90m\ud83d\udccb Tool result: view\u001b[0m\nHere's the result of running `cat -n` on x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/action/RequestXContent.java:\n   180\t                        );\n   181\t                    }\n   182\t                    for (Map.Entry<String, Object> entry : param.fields.entrySet()) {\n   183\t                        ParserUtils.ParamClassification classification;\n   184\t                        String paramName = entry.getKey();\n   185\t                        checkParamNameValidity(paramName, errors, loc);\n   186\t\n   187\t                        if (entry.getValue() instanceof Map<?, ?> values) {// parameter specified as key:value pairs\n   188\t                            Map<ParamParsingKey, Object> paramElements = Maps.newMapWithExpectedSize(2);\n   189\t                            for (Object keyName : values.keySet()) {\n   190\t                                ParamParsingKey paramType = checkParamValueKeysValidity(keyName.toString(), errors, loc);\n   191\t                                if (paramType != null) {\n   192\t                                    paramElements.put(paramType, values.get(keyName));\n   193\t                                }\n... (29 more lines)\n\ud83e\udd16\nNow let me check the test file to see what test needs to be updated:\n\n\n\u001b[90m\ud83d\udd27 Tool call: view\u001b[0m\n   path: \"x-pack/plugin/esql/qa/server/single-node/src/javaRestTest/java/org/elasticsearch/xpack/esql/qa/single_node/RestEsqlIT.java\"\n   type: \"file\"\n   view_range: [668,685]\n\n\u001b[90m\ud83d\udccb Tool result: view\u001b[0m\nNote:\nStart line 668 exceeds file length (625). Adjusted to 1.\nEnd line 685 exceeds file length (625). Adjusted to 625.\n\nHere's the result of running `cat -n` on x-pack/plugin/esql/qa/server/single-node/src/javaRestTest/java/org/elasticsearch/xpack/esql/qa/single_node/RestEsqlIT.java:\n     1\t/*\n     2\t * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\n     3\t * or more contributor license agreements. Licensed under the Elastic License\n     4\t * 2.0; you may not use this file except in compliance with the Elastic License\n     5\t * 2.0.\n     6\t */\n     7\tpackage org.elasticsearch.xpack.esql.qa.single_node;\n     8\t\n     9\timport com.carrotsearch.randomizedtesting.annotations.ParametersFactory;\n    10\timport com.carrotsearch.randomizedtesting.annotations.ThreadLeakFilters;\n... (617 more lines)\n\ud83e\udd16\nLet me search for the test file that needs to be updated:\n\n\n\u001b[90m\ud83d\udd27 Tool call: codebase-retrieval\u001b[0m\n   information_request: \"testNamedParamsForIdentifierAndIdentifierPatterns test method in RestEsqlIT or similar test files\"\n\n\u001b[90m\ud83d\udccb Tool result: codebase-retrieval\u001b[0m\nThe following code sections were retrieved:\nPath: x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/analysis/AnalyzerTests.java\n...\n  2092\t\n  2093\t    public void testNamedParamsForIdentifiers() {\n  2094\t        assertProjectionWithMapping(\n  2095\t            \"\"\"\n  2096\t                from test\n  2097\t                | eval ?f1 = ?fn1(?f2)\n  2098\t                | where ?f1 == ?f2\n  2099\t                | stats ?f8 = ?fn2(?f3.?f4.?f5) by ?f3.?f6.?f7\n  2100\t                | sort ?f36.?f7, ?f8\n  2101\t                | keep ?f367, ?f8\n  2102\t                \"\"\",\n  2103\t            \"mapping-multi-field-with-nested.json\",\n... (464 more lines)\n\ud83e\udd16\nNow let me look at the RestEsqlTestCase to find the testNamedParamsForIdentifierAndIdentifierPatterns method:\n\n\n\u001b[90m\ud83d\udd27 Tool call: view\u001b[0m\n   path: \"x-pack/plugin/esql/qa/server/src/main/java/org/elasticsearch/xpack/esql/qa/rest/RestEsqlTestCase.java\"\n   type: \"file\"\n   view_range: [670,750]\n\n\u001b[90m\ud83d\udccb Tool result: view\u001b[0m\nHere's the result of running `cat -n` on x-pack/plugin/esql/qa/server/src/main/java/org/elasticsearch/xpack/esql/qa/rest/RestEsqlTestCase.java:\n   670\t    }\n   671\t\n   672\t    public void testNamedParamsForIdentifierAndIdentifierPatterns() throws IOException {\n   673\t        bulkLoadTestData(10);\n   674\t        // positive\n   675\t        var query = requestObjectBuilder().query(\n   676\t            format(\n   677\t                null,\n   678\t                \"from {} | eval x1 = ?n1 | where ?n2 == x1 | stats xx2 = ?fn1(?n3) by ?n4 | keep ?n4, ?n5 | sort ?n4\",\n   679\t                testIndexName()\n   680\t            )\n   681\t        )\n   682\t            .params(\n   683\t                \"[{\\\"n1\\\" : {\\\"value\\\" : \\\"integer\\\" , \\\"kind\\\" : \\\"identifier\\\"}},\"\n... (69 more lines)\n\ud83e\udd16\nPerfect! Now I have all the information I need. Let me create a task list and start making the changes:\n\n\n\u001b[90m\ud83d\udd27 Tool call: add_tasks\u001b[0m\n   tasks: [{\"name\":\"Update EsqlCapabilities.java to make NAMED_PARAMETER_FOR_FIELD_AND_FUNCTION_NAMES snapshot-only\",\"description\":\"Add true parameter to NAMED_PARAMETER_FOR_FIELD_AND_FUNCTION_NAMES capability to make it snapshot-only\"},{\"name\":\"Update EsqlBaseLexer.g4 to guard parameter tokens with isDevVersion()\",\"description\":\"Add {this.isDevVersion()}? guards to PROJECT_PARAM, PROJECT_NAMED_OR_POSITIONAL_PARAM, RENAME_PARAM, RENAME_NAMED_OR_POSITIONAL_PARAM, ENRICH_FIELD_PARAM, ENRICH_FIELD_NAMED_OR_POSITIONAL_PARAM, MVEXPAND_PARAM, and MVEXPAND_NAMED_OR_POSITIONAL_PARAM\"},{\"name\":\"Update EsqlBaseParser.g4 to guard parameter usage in identifierPattern and identifierOrParameter\",\"description\":\"Add {this.isDevVersion()}? guards to parameter alternatives in identifierPattern and identifierOrParameter rules\"},{\"name\":\"Update RequestXContent.java to check capability before parsing identifier/pattern params\",\"description\":\"Add capability check before parsing Map-based parameter values for identifier and pattern classifications\"},{\"name\":\"Update RestEsqlTestCase.java to add assumeTrue for snapshot build\",\"description\":\"Add assumeTrue check at the beginning of testNamedParamsForIdentifierAndIdentifierPatterns method\"},{\"name\":\"Create changelog file\",\"description\":\"Create docs/changelog/114784.yaml file with PR information\"}]\n\n\u001b[90m\ud83d\udccb Tool result: add_tasks\u001b[0m\nTask list updated successfully. Created: 6, Updated: 1, Deleted: 0.\n\n# Task Changes\n\n## Created Tasks\n\n[ ] UUID:dz8heEgRjGZ8J2cyz9sudH NAME:Create changelog file DESCRIPTION:Create docs/changelog/114784.yaml file with PR information\n[ ] UUID:dRyoX7U2Vu5AoSLjHPVE1s NAME:Update RestEsqlTestCase.java to add assumeTrue for snapshot build DESCRIPTION:Add assumeTrue check at the beginning of testNamedParamsForIdentifierAndIdentifierPatterns method\n[ ] UUID:qGDMX5DybKJdPLZwBgq3SD NAME:Update RequestXContent.java to check capability before parsing identifier/pattern params DESCRIPTION:Add capability check before parsing Map-based parameter values for identifier and pattern classifications\n[ ] UUID:dV4Cr4KVawYkYpG3buKiAy NAME:Update EsqlBaseParser.g4 to guard parameter usage in identifierPattern and identifierOrParameter DESCRIPTION:Add {this.isDevVersion()}? guards to parameter alternatives in identifierPattern and identifierOrParameter rules\n[ ] UUID:wEfPMbLhKrVuiR5W8cRi7P NAME:Update EsqlBaseLexer.g4 to guard parameter tokens with isDevVersion() DESCRIPTION:Add {this.isDevVersion()}? guards to PROJECT_PARAM, PROJECT_NAMED_OR_POSITIONAL_PARAM, RENAME_PARAM, RENAME_NAMED_OR_POSITIONAL_PARAM, ENRICH_FIELD_PARAM, ENRICH_FIELD_NAMED_OR_POSITIONAL_PARAM, MVEXPAND_PARAM, and MVEXPAND_NAMED_OR_POSITIONAL_PARAM\n[ ] UUID:jCcGtREJg2EVYTZY2bFoFH NAME:Update EsqlCapabilities.java to make NAMED_PARAMETER_FOR_FIELD_AND_FUNCTION_NAMES snapshot-only DESCRIPTION:Add true parameter to NAMED_PARAMETER_FOR_FIELD_AND_FUNCTION_NAMES capability to make it snapshot-only\n\n## Updated Tasks\n\n... (2 more lines)\n\ud83e\udd16\nNow let me start implementing the changes:\n\n\n\u001b[90m\ud83d\udd27 Tool call: update_tasks\u001b[0m\n   tasks: [{\"task_id\":\"jCcGtREJg2EVYTZY2bFoFH\",\"state\":\"IN_PROGRESS\"}]\n\n\u001b[90m\ud83d\udccb Tool result: update_tasks\u001b[0m\nTask list updated successfully. Created: 0, Updated: 1, Deleted: 0.\n\n# Task Changes\n\n## Updated Tasks\n\n[/] UUID:jCcGtREJg2EVYTZY2bFoFH NAME:Update EsqlCapabilities.java to make NAMED_PARAMETER_FOR_FIELD_AND_FUNCTION_NAMES snapshot-only DESCRIPTION:Add true parameter to NAMED_PARAMETER_FOR_FIELD_AND_FUNCTION_NAMES capability to make it snapshot-only\n\n\n\u001b[90m\ud83d\udd27 Tool call: str-replace-editor\u001b[0m\n\u001b[36m\ud83d\udcdd x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/action/EsqlCapabilities.java (line 4 \u2192 line 4)\u001b[0m\n\u001b[31m-        NAMED_PARAMETER_FOR_FIELD_AND_FUNCTION_NAMES,\u001b[0m\n\u001b[32m+        NAMED_PARAMETER_FOR_FIELD_AND_FUNCTION_NAMES(true),\u001b[0m\n\n\u001b[90m\ud83d\udccb Tool result: str-replace-editor\u001b[0m\nSuccessfully edited the file x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/action/EsqlCapabilities.java.\nResult for str_replace for entry with index [1]:\nReplacement successful.\nnew_str starts at line 375 and ends at line 378.\n\nReview the changes and make sure they are as expected (correct indentation, no duplicate lines, etc).\nEdit the file again if necessary.\n\n\n\u001b[90m\ud83d\udd27 Tool call: update_tasks\u001b[0m\n   tasks: [{\"task_id\":\"jCcGtREJg2EVYTZY2bFoFH\",\"state\":\"COMPLETE\"},{\"task_id\":\"wEfPMbLhKrVuiR5W8cRi7P\",\"state\":\"IN_PROGRESS\"}]\n\n\u001b[90m\ud83d\udccb Tool result: update_tasks\u001b[0m\nTask list updated successfully. Created: 0, Updated: 2, Deleted: 0.\n\n# Task Changes\n\n## Updated Tasks\n\n[/] UUID:wEfPMbLhKrVuiR5W8cRi7P NAME:Update EsqlBaseLexer.g4 to guard parameter tokens with isDevVersion() DESCRIPTION:Add {this.isDevVersion()}? guards to PROJECT_PARAM, PROJECT_NAMED_OR_POSITIONAL_PARAM, RENAME_PARAM, RENAME_NAMED_OR_POSITIONAL_PARAM, ENRICH_FIELD_PARAM, ENRICH_FIELD_NAMED_OR_POSITIONAL_PARAM, MVEXPAND_PARAM, and MVEXPAND_NAMED_OR_POSITIONAL_PARAM\n[x] UUID:jCcGtREJg2EVYTZY2bFoFH NAME:Update EsqlCapabilities.java to make NAMED_PARAMETER_FOR_FIELD_AND_FUNCTION_NAMES snapshot-only DESCRIPTION:Add true parameter to NAMED_PARAMETER_FOR_FIELD_AND_FUNCTION_NAMES capability to make it snapshot-only\n\n\n\u001b[90m\ud83d\udd27 Tool call: str-replace-editor\u001b[0m\n\u001b[36m\ud83d\udcdd x-pack/plugin/esql/src/main/antlr/EsqlBaseLexer.g4 (lines 4-5 \u2192 lines 4-5)\u001b[0m\n\u001b[31m-PROJECT_PARAM : PARAM -> type(PARAM);\u001b[0m\n\u001b[31m-PROJECT_NAMED_OR_POSITIONAL_PARAM : NAMED_OR_POSITIONAL_PARAM -> type(NAMED_OR_POSITIONAL_PARAM);\u001b[0m\n\u001b[32m+PROJECT_PARAM : {this.isDevVersion()}? PARAM -> type(PARAM);\u001b[0m\n\u001b[32m+PROJECT_NAMED_OR_POSITIONAL_PARAM : {this.isDevVersion()}? NAMED_OR_POSITIONAL_PARAM -> type(NAMED_OR_POSITIONAL_PARAM);\u001b[0m\n\n\u001b[90m\ud83d\udccb Tool result: str-replace-editor\u001b[0m\nSuccessfully edited the file x-pack/plugin/esql/src/main/antlr/EsqlBaseLexer.g4.\nResult for str_replace for entry with index [1]:\nReplacement successful.\nnew_str starts at line 305 and ends at line 309.\n\nReview the changes and make sure they are as expected (correct indentation, no duplicate lines, etc).\nEdit the file again if necessary.\n\n\n\u001b[90m\ud83d\udd27 Tool call: str-replace-editor\u001b[0m\n\u001b[36m\ud83d\udcdd x-pack/plugin/esql/src/main/antlr/EsqlBaseLexer.g4 (lines 5-6 \u2192 lines 5-6)\u001b[0m\n\u001b[31m-RENAME_PARAM : PARAM -> type(PARAM);\u001b[0m\n\u001b[31m-RENAME_NAMED_OR_POSITIONAL_PARAM : NAMED_OR_POSITIONAL_PARAM -> type(NAMED_OR_POSITIONAL_PARAM);\u001b[0m\n\u001b[32m+RENAME_PARAM : {this.isDevVersion()}? PARAM -> type(PARAM);\u001b[0m\n\u001b[32m+RENAME_NAMED_OR_POSITIONAL_PARAM : {this.isDevVersion()}? NAMED_OR_POSITIONAL_PARAM -> type(NAMED_OR_POSITIONAL_PARAM);\u001b[0m\n\n\u001b[90m\ud83d\udccb Tool result: str-replace-editor\u001b[0m\nSuccessfully edited the file x-pack/plugin/esql/src/main/antlr/EsqlBaseLexer.g4.\nResult for str_replace for entry with index [1]:\nReplacement successful.\nnew_str starts at line 339 and ends at line 344.\n\nReview the changes and make sure they are as expected (correct indentation, no duplicate lines, etc).\nEdit the file again if necessary.\n\n\n\u001b[90m\ud83d\udd27 Tool call: str-replace-editor\u001b[0m\n\u001b[36m\ud83d\udcdd x-pack/plugin/esql/src/main/antlr/EsqlBaseLexer.g4 (lines 5-6 \u2192 lines 5-6)\u001b[0m\n\u001b[31m-ENRICH_FIELD_PARAM : PARAM -> type(PARAM);\u001b[0m\n\u001b[31m-ENRICH_FIELD_NAMED_OR_POSITIONAL_PARAM : NAMED_OR_POSITIONAL_PARAM -> type(NAMED_OR_POSITIONAL_PARAM);\u001b[0m\n\u001b[32m+ENRICH_FIELD_PARAM : {this.isDevVersion()}? PARAM -> type(PARAM);\u001b[0m\n\u001b[32m+ENRICH_FIELD_NAMED_OR_POSITIONAL_PARAM : {this.isDevVersion()}? NAMED_OR_POSITIONAL_PARAM -> type(NAMED_OR_POSITIONAL_PARAM);\u001b[0m\n\n\u001b[90m\ud83d\udccb Tool result: str-replace-editor\u001b[0m\nSuccessfully edited the file x-pack/plugin/esql/src/main/antlr/EsqlBaseLexer.g4.\nResult for str_replace for entry with index [1]:\nReplacement successful.\nnew_str starts at line 412 and ends at line 417.\n\nReview the changes and make sure they are as expected (correct indentation, no duplicate lines, etc).\nEdit the file again if necessary.\n\n\n\u001b[90m\ud83d\udd27 Tool call: str-replace-editor\u001b[0m\n\u001b[36m\ud83d\udcdd x-pack/plugin/esql/src/main/antlr/EsqlBaseLexer.g4 (lines 4-5 \u2192 lines 4-5)\u001b[0m\n\u001b[31m-MVEXPAND_PARAM : PARAM -> type(PARAM);\u001b[0m\n\u001b[31m-MVEXPAND_NAMED_OR_POSITIONAL_PARAM : NAMED_OR_POSITIONAL_PARAM -> type(NAMED_OR_POSITIONAL_PARAM);\u001b[0m\n\u001b[32m+MVEXPAND_PARAM : {this.isDevVersion()}? PARAM -> type(PARAM);\u001b[0m\n\u001b[32m+MVEXPAND_NAMED_OR_POSITIONAL_PARAM : {this.isDevVersion()}? NAMED_OR_POSITIONAL_PARAM -> type(NAMED_OR_POSITIONAL_PARAM);\u001b[0m\n\n\u001b[90m\ud83d\udccb Tool result: str-replace-editor\u001b[0m\nSuccessfully edited the file x-pack/plugin/esql/src/main/antlr/EsqlBaseLexer.g4.\nResult for str_replace for entry with index [1]:\nReplacement successful.\nnew_str starts at line 431 and ends at line 435.\n\nReview the changes and make sure they are as expected (correct indentation, no duplicate lines, etc).\nEdit the file again if necessary.\n\n\n\u001b[90m\ud83d\udd27 Tool call: update_tasks\u001b[0m\n   tasks: [{\"task_id\":\"wEfPMbLhKrVuiR5W8cRi7P\",\"state\":\"COMPLETE\"},{\"task_id\":\"dV4Cr4KVawYkYpG3buKiAy\",\"state\":\"IN_PROGRESS\"}]\n\n\u001b[90m\ud83d\udccb Tool result: update_tasks\u001b[0m\nTask list updated successfully. Created: 0, Updated: 2, Deleted: 0.\n\n# Task Changes\n\n## Updated Tasks\n\n[/] UUID:dV4Cr4KVawYkYpG3buKiAy NAME:Update EsqlBaseParser.g4 to guard parameter usage in identifierPattern and identifierOrParameter DESCRIPTION:Add {this.isDevVersion()}? guards to parameter alternatives in identifierPattern and identifierOrParameter rules\n[x] UUID:wEfPMbLhKrVuiR5W8cRi7P NAME:Update EsqlBaseLexer.g4 to guard parameter tokens with isDevVersion() DESCRIPTION:Add {this.isDevVersion()}? guards to PROJECT_PARAM, PROJECT_NAMED_OR_POSITIONAL_PARAM, RENAME_PARAM, RENAME_NAMED_OR_POSITIONAL_PARAM, ENRICH_FIELD_PARAM, ENRICH_FIELD_NAMED_OR_POSITIONAL_PARAM, MVEXPAND_PARAM, and MVEXPAND_NAMED_OR_POSITIONAL_PARAM\n\n\n\u001b[90m\ud83d\udd27 Tool call: str-replace-editor\u001b[0m\n\u001b[36m\ud83d\udcdd x-pack/plugin/esql/src/main/antlr/EsqlBaseParser.g4 (line 3 \u2192 line 3)\u001b[0m\n\u001b[31m-    | parameter\u001b[0m\n\u001b[32m+    | {this.isDevVersion()}? parameter\u001b[0m\n\n\u001b[90m\ud83d\udccb Tool result: str-replace-editor\u001b[0m\nSuccessfully edited the file x-pack/plugin/esql/src/main/antlr/EsqlBaseParser.g4.\nResult for str_replace for entry with index [1]:\nReplacement successful.\nnew_str starts at line 196 and ends at line 199.\n\nReview the changes and make sure they are as expected (correct indentation, no duplicate lines, etc).\nEdit the file again if necessary.\n\n\n\u001b[90m\ud83d\udd27 Tool call: str-replace-editor\u001b[0m\n\u001b[36m\ud83d\udcdd x-pack/plugin/esql/src/main/antlr/EsqlBaseParser.g4 (line 3 \u2192 line 3)\u001b[0m\n\u001b[31m-    | parameter\u001b[0m\n\u001b[32m+    | {this.isDevVersion()}? parameter\u001b[0m\n\n\u001b[90m\ud83d\udccb Tool result: str-replace-editor\u001b[0m\nSuccessfully edited the file x-pack/plugin/esql/src/main/antlr/EsqlBaseParser.g4.\nResult for str_replace for entry with index [1]:\nReplacement successful.\nnew_str starts at line 219 and ends at line 222.\n\nReview the changes and make sure they are as expected (correct indentation, no duplicate lines, etc).\nEdit the file again if necessary.\n\n\n\u001b[90m\ud83d\udd27 Tool call: update_tasks\u001b[0m\n   tasks: [{\"task_id\":\"dV4Cr4KVawYkYpG3buKiAy\",\"state\":\"COMPLETE\"},{\"task_id\":\"qGDMX5DybKJdPLZwBgq3SD\",\"state\":\"IN_PROGRESS\"}]\n\n\u001b[90m\ud83d\udccb Tool result: update_tasks\u001b[0m\nTask list updated successfully. Created: 0, Updated: 2, Deleted: 0.\n\n# Task Changes\n\n## Updated Tasks\n\n[/] UUID:qGDMX5DybKJdPLZwBgq3SD NAME:Update RequestXContent.java to check capability before parsing identifier/pattern params DESCRIPTION:Add capability check before parsing Map-based parameter values for identifier and pattern classifications\n[x] UUID:dV4Cr4KVawYkYpG3buKiAy NAME:Update EsqlBaseParser.g4 to guard parameter usage in identifierPattern and identifierOrParameter DESCRIPTION:Add {this.isDevVersion()}? guards to parameter alternatives in identifierPattern and identifierOrParameter rules\n\n\n\u001b[90m\ud83d\udd27 Tool call: str-replace-editor\u001b[0m\n\u001b[36m\ud83d\udcdd x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/action/RequestXContent.java (line 6 \u2192 lines 6-7)\u001b[0m\n\u001b[31m-                        if (entry.getValue() instanceof Map<?, ?> values) {// parameter specified as key:value pairs\u001b[0m\n\u001b[32m+                        if (EsqlCapabilities.Cap.NAMED_PARAMETER_FOR_FIELD_AND_FUNCTION_NAMES.isEnabled()\u001b[0m\n\u001b[32m+                            && entry.getValue() instanceof Map<?, ?> values) {// parameter specified as key:value pairs\u001b[0m\n\n\u001b[90m\ud83d\udccb Tool result: str-replace-editor\u001b[0m\nSuccessfully edited the file x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/action/RequestXContent.java.\nResult for str_replace for entry with index [1]:\nReplacement successful.\nnew_str starts at line 182 and ends at line 188.\n\nReview the changes and make sure they are as expected (correct indentation, no duplicate lines, etc).\nEdit the file again if necessary.\n\n\n\u001b[90m\ud83d\udd27 Tool call: update_tasks\u001b[0m\n   tasks: [{\"task_id\":\"qGDMX5DybKJdPLZwBgq3SD\",\"state\":\"COMPLETE\"},{\"task_id\":\"dRyoX7U2Vu5AoSLjHPVE1s\",\"state\":\"IN_PROGRESS\"}]\n\n\u001b[90m\ud83d\udccb Tool result: update_tasks\u001b[0m\nTask list updated successfully. Created: 0, Updated: 2, Deleted: 0.\n\n# Task Changes\n\n## Updated Tasks\n\n[/] UUID:dRyoX7U2Vu5AoSLjHPVE1s NAME:Update RestEsqlTestCase.java to add assumeTrue for snapshot build DESCRIPTION:Add assumeTrue check at the beginning of testNamedParamsForIdentifierAndIdentifierPatterns method\n[x] UUID:qGDMX5DybKJdPLZwBgq3SD NAME:Update RequestXContent.java to check capability before parsing identifier/pattern params DESCRIPTION:Add capability check before parsing Map-based parameter values for identifier and pattern classifications\n\n\n\u001b[90m\ud83d\udd27 Tool call: view\u001b[0m\n   path: \"x-pack/plugin/esql/qa/server/src/main/java/org/elasticsearch/xpack/esql/qa/rest/RestEsqlTestCase.java\"\n   type: \"file\"\n   view_range: [1,50]\n\n\u001b[90m\ud83d\udccb Tool result: view\u001b[0m\nHere's the result of running `cat -n` on x-pack/plugin/esql/qa/server/src/main/java/org/elasticsearch/xpack/esql/qa/rest/RestEsqlTestCase.java:\n     1\t/*\n     2\t * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\n     3\t * or more contributor license agreements. Licensed under the Elastic License\n     4\t * 2.0; you may not use this file except in compliance with the Elastic License\n     5\t * 2.0.\n     6\t */\n     7\t\n     8\tpackage org.elasticsearch.xpack.esql.qa.rest;\n     9\t\n    10\timport org.apache.http.HttpEntity;\n    11\timport org.apache.http.entity.ContentType;\n    12\timport org.apache.http.nio.entity.NByteArrayEntity;\n    13\timport org.apache.http.util.EntityUtils;\n    14\timport org.elasticsearch.Build;\n... (38 more lines)\n\n\u001b[90m\ud83d\udd27 Tool call: str-replace-editor\u001b[0m\n\u001b[36m\ud83d\udcdd x-pack/plugin/esql/qa/server/src/main/java/org/elasticsearch/xpack/esql/qa/rest/RestEsqlTestCase.java (lines 4-3 \u2192 line 5)\u001b[0m\n\u001b[32m+import org.elasticsearch.xpack.esql.action.EsqlCapabilities;\u001b[0m\n\n\u001b[90m\ud83d\udccb Tool result: str-replace-editor\u001b[0m\nSuccessfully edited the file x-pack/plugin/esql/qa/server/src/main/java/org/elasticsearch/xpack/esql/qa/rest/RestEsqlTestCase.java.\nResult for str_replace for entry with index [1]:\nReplacement successful.\nnew_str starts at line 31 and ends at line 38.\n\nReview the changes and make sure they are as expected (correct indentation, no duplicate lines, etc).\nEdit the file again if necessary.\n\n\n\u001b[90m\ud83d\udd27 Tool call: str-replace-editor\u001b[0m\n\u001b[36m\ud83d\udcdd x-pack/plugin/esql/qa/server/src/main/java/org/elasticsearch/xpack/esql/qa/rest/RestEsqlTestCase.java (lines 1-0 \u2192 lines 2-5)\u001b[0m\n\u001b[32m+        assumeTrue(\u001b[0m\n\u001b[32m+            \"named parameters for identifiers and patterns require snapshot build\",\u001b[0m\n\u001b[32m+            EsqlCapabilities.Cap.NAMED_PARAMETER_FOR_FIELD_AND_FUNCTION_NAMES.isEnabled()\u001b[0m\n\u001b[32m+        );\u001b[0m\n\n\u001b[90m\ud83d\udccb Tool result: str-replace-editor\u001b[0m\nSuccessfully edited the file x-pack/plugin/esql/qa/server/src/main/java/org/elasticsearch/xpack/esql/qa/rest/RestEsqlTestCase.java.\nResult for str_replace for entry with index [1]:\nReplacement successful.\nnew_str starts at line 673 and ends at line 680.\n\nReview the changes and make sure they are as expected (correct indentation, no duplicate lines, etc).\nEdit the file again if necessary.\n\n\n\u001b[90m\ud83d\udd27 Tool call: update_tasks\u001b[0m\n   tasks: [{\"task_id\":\"dRyoX7U2Vu5AoSLjHPVE1s\",\"state\":\"COMPLETE\"},{\"task_id\":\"dz8heEgRjGZ8J2cyz9sudH\",\"state\":\"IN_PROGRESS\"}]\n\n\u001b[90m\ud83d\udccb Tool result: update_tasks\u001b[0m\nTask list updated successfully. Created: 0, Updated: 2, Deleted: 0.\n\n# Task Changes\n\n## Updated Tasks\n\n[/] UUID:dz8heEgRjGZ8J2cyz9sudH NAME:Create changelog file DESCRIPTION:Create docs/changelog/114784.yaml file with PR information\n[x] UUID:dRyoX7U2Vu5AoSLjHPVE1s NAME:Update RestEsqlTestCase.java to add assumeTrue for snapshot build DESCRIPTION:Add assumeTrue check at the beginning of testNamedParamsForIdentifierAndIdentifierPatterns method\n\n\n\u001b[90m\ud83d\udd27 Tool call: save-file\u001b[0m\n   instructions_reminder: \"LIMIT THE FILE CONTENT TO AT MOST 150 LINES. IF MORE CONTENT NEEDS TO BE ADDED USE THE str-replace-editor TOOL TO EDIT THE FILE AFTER IT HAS BEEN CREATED.\"\n   path: \"docs/changelog/114784.yaml\"\n   file_content: \"pr: 114784\n   summary: \"[ES|QL] make named parameter for identifier and pattern snapshot\"\n   area: ES|QL\n   type: bug\n   issues: []\n   \"\n\n\u001b[90m\ud83d\udccb Tool result: save-file\u001b[0m\nFile saved.  Saved file {docs/changelog/114784.yaml}\n\n\u001b[90m\ud83d\udd27 Tool call: update_tasks\u001b[0m\n   tasks: [{\"task_id\":\"dz8heEgRjGZ8J2cyz9sudH\",\"state\":\"COMPLETE\"}]\n\n\u001b[90m\ud83d\udccb Tool result: update_tasks\u001b[0m\nTask list updated successfully. Created: 0, Updated: 1, Deleted: 0.\n\n# Task Changes\n\n## Updated Tasks\n\n[x] UUID:dz8heEgRjGZ8J2cyz9sudH NAME:Create changelog file DESCRIPTION:Create docs/changelog/114784.yaml file with PR information\n\n\ud83e\udd16\nPerfect! All the code changes have been made. Now let me verify the changes are correct by reviewing what was done:\n\n\n\u001b[90m\ud83d\udd27 Tool call: view_tasklist\u001b[0m\n   \n\n\u001b[90m\ud83d\udccb Tool result: view_tasklist\u001b[0m\n# Current Task List\n\n[ ] UUID:sfYP3ZvCBRgPNZ3UtvvtEr NAME:Current Task List DESCRIPTION:Root task for conversation 8c5b2474-448a-4862-8ec7-ff2d8084cd95 \n-[x] UUID:jCcGtREJg2EVYTZY2bFoFH NAME:Update EsqlCapabilities.java to make NAMED_PARAMETER_FOR_FIELD_AND_FUNCTION_NAMES snapshot-only DESCRIPTION:Add true parameter to NAMED_PARAMETER_FOR_FIELD_AND_FUNCTION_NAMES capability to make it snapshot-only\n-[x] UUID:wEfPMbLhKrVuiR5W8cRi7P NAME:Update EsqlBaseLexer.g4 to guard parameter tokens with isDevVersion() DESCRIPTION:Add {this.isDevVersion()}? guards to PROJECT_PARAM, PROJECT_NAMED_OR_POSITIONAL_PARAM, RENAME_PARAM, RENAME_NAMED_OR_POSITIONAL_PARAM, ENRICH_FIELD_PARAM, ENRICH_FIELD_NAMED_OR_POSITIONAL_PARAM, MVEXPAND_PARAM, and MVEXPAND_NAMED_OR_POSITIONAL_PARAM\n-[x] UUID:dV4Cr4KVawYkYpG3buKiAy NAME:Update EsqlBaseParser.g4 to guard parameter usage in identifierPattern and identifierOrParameter DESCRIPTION:Add {this.isDevVersion()}? guards to parameter alternatives in identifierPattern and identifierOrParameter rules\n-[x] UUID:qGDMX5DybKJdPLZwBgq3SD NAME:Update RequestXContent.java to check capability before parsing identifier/pattern params DESCRIPTION:Add capability check before parsing Map-based parameter values for identifier and pattern classifications\n-[x] UUID:dRyoX7U2Vu5AoSLjHPVE1s NAME:Update RestEsqlTestCase.java to add assumeTrue for snapshot build DESCRIPTION:Add assumeTrue check at the beginning of testNamedParamsForIdentifierAndIdentifierPatterns method\n-[x] UUID:dz8heEgRjGZ8J2cyz9sudH NAME:Create changelog file DESCRIPTION:Create docs/changelog/114784.yaml file with PR information\n\ud83e\udd16\nExcellent! All tasks are complete. Let me verify the changes by viewing the modified files to ensure everything is correct:\n\n\n\u001b[90m\ud83d\udd27 Tool call: view\u001b[0m\n   path: \"x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/action/EsqlCapabilities.java\"\n   type: \"file\"\n   view_range: [373,383]\n\n\u001b[90m\ud83d\udccb Tool result: view\u001b[0m\nHere's the result of running `cat -n` on x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/action/EsqlCapabilities.java:\n   373\t        DATE_DIFF_YEAR_CALENDARIAL,\n   374\t\n   375\t        /**\n   376\t         * Support named parameters for field names.\n   377\t         */\n   378\t        NAMED_PARAMETER_FOR_FIELD_AND_FUNCTION_NAMES(true),\n   379\t\n   380\t        /**\n   381\t         * Fix sorting not allowed on _source and counters.\n   382\t         */\n   383\t        SORTING_ON_SOURCE_AND_COUNTERS_FORBIDDEN,\nTotal lines in file: 454\n\n\n\u001b[90m\ud83d\udd27 Tool call: view\u001b[0m\n   path: \"docs/changelog/114784.yaml\"\n   type: \"file\"\n\n\u001b[90m\ud83d\udccb Tool result: view\u001b[0m\nHere's the result of running `cat -n` on docs/changelog/114784.yaml:\n     1\tpr: 114784\n     2\tsummary: \"[ES|QL] make named parameter for identifier and pattern snapshot\"\n     3\tarea: ES|QL\n     4\ttype: bug\n     5\tissues: []\n     6\t\n     7\t\nTotal lines in file: 7\n\n\ud83e\udd16\nPerfect! All the necessary code changes have been successfully completed. Let me provide a summary of what was done:\n\n## Summary\n\nI have successfully completed the backport of PR #114784 to make named parameters for identifiers and patterns available only under snapshot builds in ES|QL. Here are the changes made:\n\n### 1. **EsqlCapabilities.java** \u2705\n   - Modified `NAMED_PARAMETER_FOR_FIELD_AND_FUNCTION_NAMES` capability to be snapshot-only by adding `(true)` parameter\n\n### 2. **EsqlBaseLexer.g4** \u2705\n   - Added `{this.isDevVersion()}?` semantic predicates to 8 lexer rules:\n     - `PROJECT_PARAM` and `PROJECT_NAMED_OR_POSITIONAL_PARAM`\n     - `RENAME_PARAM` and `RENAME_NAMED_OR_POSITIONAL_PARAM`\n     - `ENRICH_FIELD_PARAM` and `ENRICH_FIELD_NAMED_OR_POSITIONAL_PARAM`\n     - `MVEXPAND_PARAM` and `MVEXPAND_NAMED_OR_POSITIONAL_PARAM`\n\n### 3. **EsqlBaseParser.g4** \u2705\n   - Added `{this.isDevVersion()}?` guards to parameter alternatives in:\n     - `identifierPattern` rule\n     - `identifierOrParameter` rule\n\n### 4. **RequestXContent.java** \u2705\n   - Added capability check before parsing Map-based parameter values for identifier and pattern classifications\n\n### 5. **RestEsqlTestCase.java** \u2705\n   - Added `assumeTrue` check at the beginning of `testNamedParamsForIdentifierAndIdentifierPatterns` method to skip the test on non-snapshot builds\n   - Added import for `EsqlCapabilities`\n\n### 6. **docs/changelog/114784.yaml** \u2705\n   - Created changelog file with PR metadata\n\nAll changes ensure that named parameters for identifiers and patterns are only available in snapshot/development builds of Elasticsearch, preventing this feature from being used in production releases until it's fully ready.\n\n", "stderr": "", "returncode": 0}
