{
  "repo_url": "https://github.com/elastic/elasticsearch.git",
  "pr_number": 114953,
  "base_commit": "9922d544a144c4e6a9f5bee806c39338f637b645",
  "runner": "auggie",
  "model": "sonnet4.5",
  "timeout_s": 1800,
  "status": "success",
  "elapsed_ms": 265428,
  "patch_unified": "diff --git a/x-pack/plugin/esql/qa/server/src/main/java/org/elasticsearch/xpack/esql/qa/rest/RestEsqlTestCase.java b/x-pack/plugin/esql/qa/server/src/main/java/org/elasticsearch/xpack/esql/qa/rest/RestEsqlTestCase.java\nindex 4fa6ac30..e3199649 100644\n--- a/x-pack/plugin/esql/qa/server/src/main/java/org/elasticsearch/xpack/esql/qa/rest/RestEsqlTestCase.java\n+++ b/x-pack/plugin/esql/qa/server/src/main/java/org/elasticsearch/xpack/esql/qa/rest/RestEsqlTestCase.java\n@@ -32,6 +32,7 @@ import org.elasticsearch.xcontent.ToXContent;\n import org.elasticsearch.xcontent.XContentBuilder;\n import org.elasticsearch.xcontent.XContentType;\n import org.elasticsearch.xpack.esql.EsqlTestUtils;\n+import org.elasticsearch.xpack.esql.action.EsqlCapabilities;\n import org.junit.After;\n import org.junit.Assert;\n import org.junit.Before;\n@@ -670,6 +671,10 @@ public abstract class RestEsqlTestCase extends ESRestTestCase {\n     }\n \n     public void testNamedParamsForIdentifierAndIdentifierPatterns() throws IOException {\n+        assumeTrue(\n+            \"named parameters for identifiers and patterns require snapshot build\",\n+            EsqlCapabilities.Cap.NAMED_PARAMETER_FOR_FIELD_AND_FUNCTION_NAMES.isEnabled()\n+        );\n         bulkLoadTestData(10);\n         // positive\n         var query = requestObjectBuilder().query(\ndiff --git a/x-pack/plugin/esql/src/main/antlr/EsqlBaseLexer.g4 b/x-pack/plugin/esql/src/main/antlr/EsqlBaseLexer.g4\nindex 051e8312..ffab261d 100644\n--- a/x-pack/plugin/esql/src/main/antlr/EsqlBaseLexer.g4\n+++ b/x-pack/plugin/esql/src/main/antlr/EsqlBaseLexer.g4\n@@ -305,8 +305,8 @@ mode PROJECT_MODE;\n PROJECT_PIPE : PIPE -> type(PIPE), popMode;\n PROJECT_DOT: DOT -> type(DOT);\n PROJECT_COMMA : COMMA -> type(COMMA);\n-PROJECT_PARAM : PARAM -> type(PARAM);\n-PROJECT_NAMED_OR_POSITIONAL_PARAM : NAMED_OR_POSITIONAL_PARAM -> type(NAMED_OR_POSITIONAL_PARAM);\n+PROJECT_PARAM : {this.isDevVersion()}? PARAM -> type(PARAM);\n+PROJECT_NAMED_OR_POSITIONAL_PARAM : {this.isDevVersion()}? NAMED_OR_POSITIONAL_PARAM -> type(NAMED_OR_POSITIONAL_PARAM);\n \n fragment UNQUOTED_ID_BODY_WITH_PATTERN\n     : (LETTER | DIGIT | UNDERSCORE | ASTERISK)\n@@ -340,8 +340,8 @@ RENAME_PIPE : PIPE -> type(PIPE), popMode;\n RENAME_ASSIGN : ASSIGN -> type(ASSIGN);\n RENAME_COMMA : COMMA -> type(COMMA);\n RENAME_DOT: DOT -> type(DOT);\n-RENAME_PARAM : PARAM -> type(PARAM);\n-RENAME_NAMED_OR_POSITIONAL_PARAM : NAMED_OR_POSITIONAL_PARAM -> type(NAMED_OR_POSITIONAL_PARAM);\n+RENAME_PARAM : {this.isDevVersion()}? PARAM -> type(PARAM);\n+RENAME_NAMED_OR_POSITIONAL_PARAM : {this.isDevVersion()}? NAMED_OR_POSITIONAL_PARAM -> type(NAMED_OR_POSITIONAL_PARAM);\n \n AS : 'as';\n \n@@ -413,8 +413,8 @@ ENRICH_FIELD_QUOTED_IDENTIFIER\n     : QUOTED_IDENTIFIER -> type(QUOTED_IDENTIFIER)\n     ;\n \n-ENRICH_FIELD_PARAM : PARAM -> type(PARAM);\n-ENRICH_FIELD_NAMED_OR_POSITIONAL_PARAM : NAMED_OR_POSITIONAL_PARAM -> type(NAMED_OR_POSITIONAL_PARAM);\n+ENRICH_FIELD_PARAM : {this.isDevVersion()}? PARAM -> type(PARAM);\n+ENRICH_FIELD_NAMED_OR_POSITIONAL_PARAM : {this.isDevVersion()}? NAMED_OR_POSITIONAL_PARAM -> type(NAMED_OR_POSITIONAL_PARAM);\n \n ENRICH_FIELD_LINE_COMMENT\n     : LINE_COMMENT -> channel(HIDDEN)\n@@ -431,8 +431,8 @@ ENRICH_FIELD_WS\n mode MVEXPAND_MODE;\n MVEXPAND_PIPE : PIPE -> type(PIPE), popMode;\n MVEXPAND_DOT: DOT -> type(DOT);\n-MVEXPAND_PARAM : PARAM -> type(PARAM);\n-MVEXPAND_NAMED_OR_POSITIONAL_PARAM : NAMED_OR_POSITIONAL_PARAM -> type(NAMED_OR_POSITIONAL_PARAM);\n+MVEXPAND_PARAM : {this.isDevVersion()}? PARAM -> type(PARAM);\n+MVEXPAND_NAMED_OR_POSITIONAL_PARAM : {this.isDevVersion()}? NAMED_OR_POSITIONAL_PARAM -> type(NAMED_OR_POSITIONAL_PARAM);\n \n MVEXPAND_QUOTED_IDENTIFIER\n     : QUOTED_IDENTIFIER -> type(QUOTED_IDENTIFIER)\ndiff --git a/x-pack/plugin/esql/src/main/antlr/EsqlBaseParser.g4 b/x-pack/plugin/esql/src/main/antlr/EsqlBaseParser.g4\nindex 7d489417..f9f994f4 100644\n--- a/x-pack/plugin/esql/src/main/antlr/EsqlBaseParser.g4\n+++ b/x-pack/plugin/esql/src/main/antlr/EsqlBaseParser.g4\n@@ -195,7 +195,7 @@ identifier\n \n identifierPattern\n     : ID_PATTERN\n-    | parameter\n+    | {this.isDevVersion()}? parameter\n     ;\n \n constant\n@@ -218,7 +218,7 @@ parameter\n \n identifierOrParameter\n     : identifier\n-    | parameter\n+    | {this.isDevVersion()}? parameter\n     ;\n \n limitCommand\ndiff --git a/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/action/EsqlCapabilities.java b/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/action/EsqlCapabilities.java\nindex 18ebbe6d..c9479196 100644\n--- a/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/action/EsqlCapabilities.java\n+++ b/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/action/EsqlCapabilities.java\n@@ -375,7 +375,7 @@ public class EsqlCapabilities {\n         /**\n          * Support named parameters for field names.\n          */\n-        NAMED_PARAMETER_FOR_FIELD_AND_FUNCTION_NAMES,\n+        NAMED_PARAMETER_FOR_FIELD_AND_FUNCTION_NAMES(true),\n \n         /**\n          * Fix sorting not allowed on _source and counters.\ndiff --git a/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/action/RequestXContent.java b/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/action/RequestXContent.java\nindex 7224aa04..71aface9 100644\n--- a/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/action/RequestXContent.java\n+++ b/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/action/RequestXContent.java\n@@ -184,7 +184,8 @@ final class RequestXContent {\n                         String paramName = entry.getKey();\n                         checkParamNameValidity(paramName, errors, loc);\n \n-                        if (entry.getValue() instanceof Map<?, ?> values) {// parameter specified as key:value pairs\n+                        if (EsqlCapabilities.Cap.NAMED_PARAMETER_FOR_FIELD_AND_FUNCTION_NAMES.isEnabled()\n+                            && entry.getValue() instanceof Map<?, ?> values) {// parameter specified as key:value pairs\n                             Map<ParamParsingKey, Object> paramElements = Maps.newMapWithExpectedSize(2);\n                             for (Object keyName : values.keySet()) {\n                                 ParamParsingKey paramType = checkParamValueKeysValidity(keyName.toString(), errors, loc);",
  "logs_path": "auggie/sonnet4.5/a9463435/elastic_elasticsearch_pr114953/logs.jsonl",
  "errors": [],
  "edit_run_id": "a9463435",
  "test_label": "v0"
}