{
  "repo_url": "https://github.com/elastic/elasticsearch.git",
  "pr_number": 114959,
  "base_commit": "49f359a598142420534e56459ae600f9b92b810a",
  "runner": "factory",
  "model": "claude-sonnet-4-5-20250929",
  "timeout_s": 7200,
  "status": "success",
  "elapsed_ms": 822179,
  "patch_unified": "diff --git a/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/parser/IdentifierBuilder.java b/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/parser/IdentifierBuilder.java\nindex 1872fa6e..ae237931 100644\n--- a/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/parser/IdentifierBuilder.java\n+++ b/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/parser/IdentifierBuilder.java\n@@ -21,6 +21,7 @@ import java.util.ArrayList;\n import java.util.List;\n \n import static org.elasticsearch.transport.RemoteClusterAware.REMOTE_CLUSTER_INDEX_SEPARATOR;\n+import static org.elasticsearch.transport.RemoteClusterAware.isRemoteIndexName;\n import static org.elasticsearch.xpack.esql.core.util.StringUtils.EXCLUSION;\n import static org.elasticsearch.xpack.esql.core.util.StringUtils.WILDCARD;\n import static org.elasticsearch.xpack.esql.parser.ParserUtils.source;\n@@ -61,11 +62,14 @@ abstract class IdentifierBuilder extends AbstractBuilder {\n         Holder<Boolean> hasSeenStar = new Holder<>(false);\n         ctx.forEach(c -> {\n             String indexPattern = visitIndexString(c.indexString());\n-            hasSeenStar.set(indexPattern.contains(WILDCARD) || hasSeenStar.get());\n-            validateIndexPattern(indexPattern, c, hasSeenStar.get());\n-            patterns.add(\n-                c.clusterString() != null ? c.clusterString().getText() + REMOTE_CLUSTER_INDEX_SEPARATOR + indexPattern : indexPattern\n-            );\n+            String clusterString = c.clusterString() != null ? c.clusterString().getText() : null;\n+            // skip validating index on remote cluster, because the behavior of remote cluster is not consistent with local cluster\n+            // For example, invalid#index is an invalid index name, however FROM *:invalid#index does not return an error\n+            if (clusterString == null) {\n+                hasSeenStar.set(indexPattern.contains(WILDCARD) || hasSeenStar.get());\n+                validateIndexPattern(indexPattern, c, hasSeenStar.get());\n+            }\n+            patterns.add(clusterString != null ? clusterString + REMOTE_CLUSTER_INDEX_SEPARATOR + indexPattern : indexPattern);\n         });\n         return Strings.collectionToDelimitedString(patterns, \",\");\n     }\n@@ -75,6 +79,9 @@ abstract class IdentifierBuilder extends AbstractBuilder {\n         String[] indices = indexPattern.split(\",\");\n         boolean hasExclusion = false;\n         for (String index : indices) {\n+            if (isRemoteIndexName(index)) { // skip the validation if there is remote cluster\n+                continue;\n+            }\n             hasSeenStar = index.contains(WILDCARD) || hasSeenStar;\n             index = index.replace(WILDCARD, \"\").strip();\n             if (index.isBlank()) {\ndiff --git a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/parser/AbstractStatementParserTests.java b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/parser/AbstractStatementParserTests.java\nindex a1bcdec2..e6fef186 100644\n--- a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/parser/AbstractStatementParserTests.java\n+++ b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/parser/AbstractStatementParserTests.java\n@@ -144,8 +144,15 @@ abstract class AbstractStatementParserTests extends ESTestCase {\n         assertThat(e.getMessage(), containsString(errorMessage));\n     }\n \n-    void expectInvalidIndexNameErrorWithLineNumber(String query, String arg, String lineNumber, String indexString) {\n-        expectError(LoggerMessageFormat.format(null, query, arg), lineNumber + \"Invalid index name [\" + indexString);\n+    void expectInvalidIndexNameErrorWithLineNumber(String query, String indexString, String lineNumber) {\n+        if ((indexString.contains(\"|\") || indexString.contains(\" \")) == false) {\n+            expectInvalidIndexNameErrorWithLineNumber(query, indexString, lineNumber, indexString);\n+        }\n+        expectInvalidIndexNameErrorWithLineNumber(query, \"\\\"\" + indexString + \"\\\"\", lineNumber, indexString);\n+    }\n+\n+    void expectInvalidIndexNameErrorWithLineNumber(String query, String indexString, String lineNumber, String error) {\n+        expectError(LoggerMessageFormat.format(null, query, indexString), lineNumber + \"Invalid index name [\" + error);\n     }\n \n     void expectDateMathErrorWithLineNumber(String query, String arg, String lineNumber, String error) {\ndiff --git a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/parser/StatementParserTests.java b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/parser/StatementParserTests.java\nindex 0aeb25ac..094d3018 100644\n--- a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/parser/StatementParserTests.java\n+++ b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/parser/StatementParserTests.java\n@@ -59,6 +59,7 @@ import org.elasticsearch.xpack.esql.plan.logical.Rename;\n import org.elasticsearch.xpack.esql.plan.logical.Row;\n import org.elasticsearch.xpack.esql.plan.logical.UnresolvedRelation;\n \n+import java.util.ArrayList;\n import java.util.HashMap;\n import java.util.List;\n import java.util.Map;\n@@ -425,7 +426,12 @@ public class StatementParserTests extends AbstractStatementParserTests {\n     }\n \n     public void testStringAsIndexPattern() {\n-        for (String command : List.of(\"FROM\", \"METRICS\")) {\n+        List<String> commands = new ArrayList<>();\n+        commands.add(\"FROM\");\n+        if (Build.current().isSnapshot()) {\n+            commands.add(\"METRICS\");\n+        }\n+        for (String command : commands) {\n             assertStringAsIndexPattern(\"foo\", command + \" \\\"foo\\\"\");\n             assertStringAsIndexPattern(\"foo,test-*\", command + \"\"\"\n                  \"foo\",\"test-*\"\n@@ -457,15 +463,23 @@ public class StatementParserTests extends AbstractStatementParserTests {\n             assertStringAsIndexPattern(\"`backtick`,``multiple`back``ticks```\", command + \" `backtick`, ``multiple`back``ticks```\");\n             assertStringAsIndexPattern(\"test,metadata,metaata,.metadata\", command + \" test,\\\"metadata\\\", metaata, .metadata\");\n             assertStringAsIndexPattern(\".dot\", command + \" .dot\");\n-            assertStringAsIndexPattern(\"cluster:index\", command + \" cluster:index\");\n-            assertStringAsIndexPattern(\"cluster:.index\", command + \" cluster:.index\");\n-            assertStringAsIndexPattern(\"cluster*:index*\", command + \" cluster*:index*\");\n-            assertStringAsIndexPattern(\"cluster*:*\", command + \" cluster*:*\");\n-            assertStringAsIndexPattern(\"*:index*\", command + \" *:index*\");\n-            assertStringAsIndexPattern(\"*:*\", command + \" *:*\");\n+            assertStringAsIndexPattern(\"cluster:index|pattern\", command + \" cluster:\\\"index|pattern\\\"\");\n+            assertStringAsIndexPattern(\"*:index|pattern\", command + \" \\\"*:index|pattern\\\"\");\n+            clusterAndIndexAsIndexPattern(command, \"cluster:index\");\n+            clusterAndIndexAsIndexPattern(command, \"cluster:.index\");\n+            clusterAndIndexAsIndexPattern(command, \"cluster*:index*\");\n+            clusterAndIndexAsIndexPattern(command, \"cluster*:<logstash-{now/D}>*\");\n+            clusterAndIndexAsIndexPattern(command, \"cluster*:*\");\n+            clusterAndIndexAsIndexPattern(command, \"*:index*\");\n+            clusterAndIndexAsIndexPattern(command, \"*:*\");\n         }\n     }\n \n+    private void clusterAndIndexAsIndexPattern(String command, String clusterAndIndex) {\n+        assertStringAsIndexPattern(clusterAndIndex, command + \" \" + clusterAndIndex);\n+        assertStringAsIndexPattern(clusterAndIndex, command + \" \\\"\" + clusterAndIndex + \"\\\"\");\n+    }\n+\n     public void testStringAsLookupIndexPattern() {\n         assumeTrue(\"requires snapshot build\", Build.current().isSnapshot());\n         assertStringAsLookupIndexPattern(\"foo\", \"ROW x = 1 | LOOKUP \\\"foo\\\" ON j\");\n@@ -487,221 +501,104 @@ public class StatementParserTests extends AbstractStatementParserTests {\n         assertStringAsLookupIndexPattern(\"`backtick`\", \"ROW x = 1 | LOOKUP `backtick` ON j\");\n         assertStringAsLookupIndexPattern(\"``multiple`back``ticks```\", \"ROW x = 1 | LOOKUP ``multiple`back``ticks``` ON j\");\n         assertStringAsLookupIndexPattern(\".dot\", \"ROW x = 1 | LOOKUP .dot ON j\");\n-        assertStringAsLookupIndexPattern(\"cluster:index\", \"ROW x = 1 | LOOKUP cluster:index ON j\");\n-        assertStringAsLookupIndexPattern(\"cluster:.index\", \"ROW x = 1 | LOOKUP cluster:.index ON j\");\n-        assertStringAsLookupIndexPattern(\"cluster*:index*\", \"ROW x = 1 | LOOKUP cluster*:index* ON j\");\n-        assertStringAsLookupIndexPattern(\"cluster*:*\", \"ROW x = 1 | LOOKUP cluster*:* ON j\");\n-        assertStringAsLookupIndexPattern(\"*:index*\", \"ROW x = 1 | LOOKUP  *:index* ON j\");\n-        assertStringAsLookupIndexPattern(\"*:*\", \"ROW x = 1 | LOOKUP  *:* ON j\");\n+        clusterAndIndexAsLookupIndexPattern(\"cluster:index\");\n+        clusterAndIndexAsLookupIndexPattern(\"cluster:.index\");\n+        clusterAndIndexAsLookupIndexPattern(\"cluster*:index*\");\n+        clusterAndIndexAsLookupIndexPattern(\"cluster*:*\");\n+        clusterAndIndexAsLookupIndexPattern(\"*:index*\");\n+        clusterAndIndexAsLookupIndexPattern(\"*:*\");\n+    }\n+\n+    private void clusterAndIndexAsLookupIndexPattern(String clusterAndIndex) {\n+        assertStringAsLookupIndexPattern(clusterAndIndex, \"ROW x = 1 | LOOKUP \" + clusterAndIndex + \" ON j\");\n+        assertStringAsLookupIndexPattern(clusterAndIndex, \"ROW x = 1 | LOOKUP \\\"\" + clusterAndIndex + \"\\\"\" + \" ON j\");\n     }\n \n     public void testInvalidCharacterInIndexPattern() {\n         Map<String, String> commands = new HashMap<>();\n-        commands.put(\"FROM {}\", \"line 1:8: \");\n+        commands.put(\"FROM {}\", \"line 1:7: \");\n         if (Build.current().isSnapshot()) {\n-            commands.put(\"METRICS {}\", \"line 1:11: \");\n-            commands.put(\"ROW x = 1 | LOOKUP {} ON j\", \"line 1:22: \");\n+            commands.put(\"METRICS {}\", \"line 1:10: \");\n+            commands.put(\"ROW x = 1 | LOOKUP {} ON j\", \"line 1:21: \");\n         }\n-        List<String> clusterStrings = List.of(\" \", \" *:\", \" cluster:\");\n         String lineNumber;\n         for (String command : commands.keySet()) {\n             lineNumber = commands.get(command);\n-            for (String clusterString : clusterStrings) {\n-                expectInvalidIndexNameErrorWithLineNumber(command, clusterString + \"\\\"index|pattern\\\"\", lineNumber, \"index|pattern\");\n-                expectInvalidIndexNameErrorWithLineNumber(command, clusterString + \"\\\"index pattern\\\"\", lineNumber, \"index pattern\");\n-                expectInvalidIndexNameErrorWithLineNumber(command, clusterString + \"\\\"index#pattern\\\"\", lineNumber, \"index#pattern\");\n-                expectInvalidIndexNameErrorWithLineNumber(command, clusterString + \"index#pattern\", lineNumber, \"index#pattern\");\n-                expectInvalidIndexNameErrorWithLineNumber(command, clusterString + \"\\\"index?pattern\\\"\", lineNumber, \"index?pattern\");\n-                expectInvalidIndexNameErrorWithLineNumber(command, clusterString + \"index?pattern\", lineNumber, \"index?pattern\");\n-                expectInvalidIndexNameErrorWithLineNumber(command, clusterString + \"\\\"index>pattern\\\"\", lineNumber, \"index>pattern\");\n-                expectInvalidIndexNameErrorWithLineNumber(command, clusterString + \"index>pattern\", lineNumber, \"index>pattern\");\n-                expectInvalidIndexNameErrorWithLineNumber(command, clusterString + \"\\\"index<pattern\\\"\", lineNumber, \"index<pattern\");\n-                expectInvalidIndexNameErrorWithLineNumber(command, clusterString + \"index<pattern\", lineNumber, \"index<pattern\");\n-                expectInvalidIndexNameErrorWithLineNumber(command, clusterString + \"\\\"index/pattern\\\"\", lineNumber, \"index/pattern\");\n-                expectInvalidIndexNameErrorWithLineNumber(command, clusterString + \"index/pattern\", lineNumber, \"index/pattern\");\n-                expectInvalidIndexNameErrorWithLineNumber(command, clusterString + \"\\\"index\\\\\\\\pattern\\\"\", lineNumber, \"index\\\\pattern\");\n-                expectInvalidIndexNameErrorWithLineNumber(command, clusterString + \"index\\\\pattern\", lineNumber, \"index\\\\pattern\");\n-                expectInvalidIndexNameErrorWithLineNumber(command, clusterString + \"\\\"..\\\"\", lineNumber, \"..\");\n-                expectInvalidIndexNameErrorWithLineNumber(command, clusterString + \"..\", lineNumber, \"..\");\n-                expectInvalidIndexNameErrorWithLineNumber(command, clusterString + \"\\\"_indexpattern\\\"\", lineNumber, \"_indexpattern\");\n-                expectInvalidIndexNameErrorWithLineNumber(command, clusterString + \"_indexpattern\", lineNumber, \"_indexpattern\");\n-                expectInvalidIndexNameErrorWithLineNumber(command, clusterString + \"\\\"+indexpattern\\\"\", lineNumber, \"+indexpattern\");\n-                expectInvalidIndexNameErrorWithLineNumber(command, clusterString + \"+indexpattern\", lineNumber, \"+indexpattern\");\n-                expectInvalidIndexNameErrorWithLineNumber(command, clusterString + \"\\\"--indexpattern\\\"\", lineNumber, \"-indexpattern\");\n-                expectInvalidIndexNameErrorWithLineNumber(command, clusterString + \"--indexpattern\", lineNumber, \"-indexpattern\");\n-                expectInvalidIndexNameErrorWithLineNumber(\n-                    command,\n-                    clusterString + \"\\\"<--logstash-{now/M{yyyy.MM}}>\\\"\",\n-                    lineNumber,\n-                    \"-logstash-\"\n-                );\n-                expectInvalidIndexNameErrorWithLineNumber(\n-                    command,\n-                    clusterString + \"--<logstash-{now/M{yyyy.MM}}>\",\n-                    lineNumber,\n-                    \"-<logstash-{now/M{yyyy.MM}}>\"\n-                );\n-                expectInvalidIndexNameErrorWithLineNumber(command, clusterString + \"\\\"<logstash#{now/d}>\\\"\", lineNumber, \"logstash#\");\n-                expectInvalidIndexNameErrorWithLineNumber(command, clusterString + \"<logstash#{now/d}>\", lineNumber, \"logstash#\");\n-                expectInvalidIndexNameErrorWithLineNumber(\n-                    command,\n-                    clusterString + \"\\\"+<logstash-{now/d}>\\\"\",\n-                    lineNumber,\n-                    \"+<logstash-{now/d}>\"\n-                );\n-                expectInvalidIndexNameErrorWithLineNumber(\n-                    command,\n-                    clusterString + \"+<logstash-{now/d}>\",\n-                    lineNumber,\n-                    \"+<logstash-{now/d}>\"\n-                );\n-                expectInvalidIndexNameErrorWithLineNumber(\n-                    command,\n-                    clusterString + \"\\\"_<logstash-{now/d}>\\\"\",\n-                    lineNumber,\n-                    \"_<logstash-{now/d}>\"\n-                );\n-                expectInvalidIndexNameErrorWithLineNumber(\n-                    command,\n-                    clusterString + \"_<logstash-{now/d}>\",\n-                    lineNumber,\n-                    \"_<logstash-{now/d}>\"\n-                );\n-                expectInvalidIndexNameErrorWithLineNumber(command, clusterString + \"\\\"<<logstash{now/d}>>\\\"\", lineNumber, \"<logstash\");\n-                expectInvalidIndexNameErrorWithLineNumber(command, clusterString + \"<<logstash{now/d}>>\", lineNumber, \"<logstash\");\n-                expectInvalidIndexNameErrorWithLineNumber(command, clusterString + \"\\\"<<logstash<{now/d}>>>\\\"\", lineNumber, \"<logstash<\");\n-                expectInvalidIndexNameErrorWithLineNumber(command, clusterString + \"<<logstash<{now/d}>>>\", lineNumber, \"<logstash<\");\n-                expectInvalidIndexNameErrorWithLineNumber(\n-                    command,\n-                    clusterString + \"\\\"-<logstash- {now/d{yyyy.MM.dd|+12:00}}>\\\"\",\n-                    lineNumber,\n-                    \"logstash- \"\n-                );\n-            }\n+            expectInvalidIndexNameErrorWithLineNumber(command, \"index|pattern\", lineNumber);\n+            expectInvalidIndexNameErrorWithLineNumber(command, \"index pattern\", lineNumber);\n+            expectInvalidIndexNameErrorWithLineNumber(command, \"index#pattern\", lineNumber);\n+            expectInvalidIndexNameErrorWithLineNumber(command, \"index?pattern\", lineNumber);\n+            expectInvalidIndexNameErrorWithLineNumber(command, \"index>pattern\", lineNumber);\n+            expectInvalidIndexNameErrorWithLineNumber(command, \"index<pattern\", lineNumber);\n+            expectInvalidIndexNameErrorWithLineNumber(command, \"index/pattern\", lineNumber);\n+            expectInvalidIndexNameErrorWithLineNumber(command, \"_indexpattern\", lineNumber);\n+            expectInvalidIndexNameErrorWithLineNumber(command, \"+indexpattern\", lineNumber);\n+            expectInvalidIndexNameErrorWithLineNumber(command, \"..\", lineNumber);\n+            expectInvalidIndexNameErrorWithLineNumber(command, \"+<logstash-{now/d}>\", lineNumber);\n+            expectInvalidIndexNameErrorWithLineNumber(command, \"_<logstash-{now/d}>\", lineNumber);\n+            expectInvalidIndexNameErrorWithLineNumber(command, \"index\\\\pattern\", lineNumber, \"index\\\\pattern\");\n+            expectInvalidIndexNameErrorWithLineNumber(command, \"\\\"index\\\\\\\\pattern\\\"\", lineNumber, \"index\\\\pattern\");\n+            expectInvalidIndexNameErrorWithLineNumber(command, \"\\\"--indexpattern\\\"\", lineNumber, \"-indexpattern\");\n+            expectInvalidIndexNameErrorWithLineNumber(command, \"--indexpattern\", lineNumber, \"-indexpattern\");\n+            expectInvalidIndexNameErrorWithLineNumber(command, \"<--logstash-{now/M{yyyy.MM}}>\", lineNumber, \"-logstash-\");\n+            expectInvalidIndexNameErrorWithLineNumber(\n+                command,\n+                \"\\\"--<logstash-{now/M{yyyy.MM}}>\\\"\",\n+                lineNumber,\n+                \"-<logstash-{now/M{yyyy.MM}}>\"\n+            );\n+            expectInvalidIndexNameErrorWithLineNumber(command, \"<logstash#{now/d}>\", lineNumber, \"logstash#\");\n+            expectInvalidIndexNameErrorWithLineNumber(command, \"\\\"<logstash#{now/d}>\\\"\", lineNumber, \"logstash#\");\n+            expectInvalidIndexNameErrorWithLineNumber(command, \"<<logstash{now/d}>>\", lineNumber, \"<logstash\");\n+            expectInvalidIndexNameErrorWithLineNumber(command, \"\\\"<<logstash{now/d}>>\\\"\", lineNumber, \"<logstash\");\n+            expectInvalidIndexNameErrorWithLineNumber(command, \"<<logstash<{now/d}>>>\", lineNumber, \"<logstash<\");\n+            expectInvalidIndexNameErrorWithLineNumber(command, \"\\\"<<logstash<{now/d}>>>\\\"\", lineNumber, \"<logstash<\");\n+            expectInvalidIndexNameErrorWithLineNumber(command, \"\\\"-<logstash- {now/d{yyyy.MM.dd|+12:00}}>\\\"\", lineNumber, \"logstash- \");\n         }\n \n-        // comma separated indices\n+        // comma separated indices, with exclusions\n         // Invalid index names after removing exclusion fail, when there is no index name with wildcard before it\n         for (String command : commands.keySet()) {\n             if (command.contains(\"LOOKUP\")) {\n                 continue;\n             }\n-            for (String clusterString : clusterStrings) {\n-                lineNumber = command.contains(\"FROM\")\n-                    ? \"line 1:\" + (22 + clusterString.length() - 1) + \": \"\n-                    : \"line 1:\" + (25 + clusterString.length() - 1) + \": \";\n-                expectInvalidIndexNameErrorWithLineNumber(\n-                    command,\n-                    clusterString + \"indexpattern, --indexpattern\",\n-                    lineNumber,\n-                    \"-indexpattern\"\n-                );\n-                expectInvalidIndexNameErrorWithLineNumber(\n-                    command,\n-                    clusterString + \"indexpattern, \\\"--indexpattern\\\"\",\n-                    lineNumber,\n-                    \"-indexpattern\"\n-                );\n-                expectInvalidIndexNameErrorWithLineNumber(\n-                    command,\n-                    clusterString + \"\\\"indexpattern, --indexpattern\\\"\",\n-                    commands.get(command),\n-                    \"-indexpattern\"\n-                );\n-                assertEquals(\n-                    unresolvedRelation(clusterString.strip() + \"indexpattern,-indexpattern\"),\n-                    statement(command, clusterString + \"indexpattern, -indexpattern\")\n-                );\n-                assertEquals(\n-                    unresolvedRelation(clusterString.strip() + \"indexpattern,-indexpattern\"),\n-                    statement(command, clusterString + \"indexpattern, \\\"-indexpattern\\\"\")\n-                );\n-                assertEquals(\n-                    unresolvedRelation(clusterString.strip() + \"indexpattern, -indexpattern\"),\n-                    statement(command, clusterString + \"\\\"indexpattern, -indexpattern\\\"\")\n-                );\n-            }\n+\n+            lineNumber = command.contains(\"FROM\") ? \"line 1:21: \" : \"line 1:24: \";\n+            expectInvalidIndexNameErrorWithLineNumber(command, \"indexpattern, --indexpattern\", lineNumber, \"-indexpattern\");\n+            expectInvalidIndexNameErrorWithLineNumber(command, \"indexpattern, \\\"--indexpattern\\\"\", lineNumber, \"-indexpattern\");\n+            expectInvalidIndexNameErrorWithLineNumber(command, \"\\\"indexpattern, --indexpattern\\\"\", commands.get(command), \"-indexpattern\");\n+            clustersAndIndices(command, \"indexpattern\", \"-indexpattern\");\n         }\n \n         // Invalid index names, except invalid DateMath, are ignored if there is an index name with wildcard before it\n+        String dateMathError = \"unit [D] not supported for date math [/D]\";\n         for (String command : commands.keySet()) {\n             if (command.contains(\"LOOKUP\")) {\n                 continue;\n             }\n-            for (String clusterString : clusterStrings) {\n-                lineNumber = command.contains(\"FROM\")\n-                    ? \"line 1:\" + (11 + clusterString.length() - 1) + \": \"\n-                    : \"line 1:\" + (14 + clusterString.length() - 1) + \": \";\n-                assertEquals(\n-                    unresolvedRelation(clusterString.strip() + \"*,-index#pattern\"),\n-                    statement(command, clusterString + \"*, \\\"-index#pattern\\\"\")\n-                );\n-                assertEquals(\n-                    unresolvedRelation(clusterString.strip() + \"*,-index#pattern\"),\n-                    statement(command, clusterString + \"*, -index#pattern\")\n-                );\n-                assertEquals(\n-                    unresolvedRelation(clusterString.strip() + \"*, -index#pattern\"),\n-                    statement(command, clusterString + \"\\\"*, -index#pattern\\\"\")\n-                );\n-                assertEquals(\n-                    unresolvedRelation(clusterString.strip() + \"index*,-index#pattern\"),\n-                    statement(command, clusterString + \"index*, \\\"-index#pattern\\\"\")\n-                );\n-                assertEquals(\n-                    unresolvedRelation(clusterString.strip() + \"index*,-index#pattern\"),\n-                    statement(command, clusterString + \"index*, -index#pattern\")\n-                );\n-                assertEquals(\n-                    unresolvedRelation(clusterString.strip() + \"index*, -index#pattern\"),\n-                    statement(command, clusterString + \"\\\"index*, -index#pattern\\\"\")\n-                );\n-                assertEquals(\n-                    unresolvedRelation(clusterString.strip() + \"*,-<--logstash-{now/M{yyyy.MM}}>\"),\n-                    statement(command, clusterString + \"*, \\\"-<--logstash-{now/M{yyyy.MM}}>\\\"\")\n-                );\n-                assertEquals(\n-                    unresolvedRelation(clusterString.strip() + \"*,-<--logstash-{now/M{yyyy.MM}}>\"),\n-                    statement(command, clusterString + \"*, -<--logstash-{now/M{yyyy.MM}}>\")\n-                );\n-                assertEquals(\n-                    unresolvedRelation(clusterString.strip() + \"*, -<--logstash-{now/M{yyyy.MM}}>\"),\n-                    statement(command, clusterString + \"\\\"*, -<--logstash-{now/M{yyyy.MM}}>\\\"\")\n-                );\n-                assertEquals(\n-                    unresolvedRelation(clusterString.strip() + \"index*,-<--logstash#-{now/M{yyyy.MM}}>\"),\n-                    statement(command, clusterString + \"index*, \\\"-<--logstash#-{now/M{yyyy.MM}}>\\\"\")\n-                );\n-                assertEquals(\n-                    unresolvedRelation(clusterString.strip() + \"index*,-<--logstash#-{now/M{yyyy.MM}}>\"),\n-                    statement(command, clusterString + \"index*, -<--logstash#-{now/M{yyyy.MM}}>\")\n-                );\n-                assertEquals(\n-                    unresolvedRelation(clusterString.strip() + \"index*, -<--logstash#-{now/M{yyyy.MM}}>\"),\n-                    statement(command, clusterString + \"\\\"index*, -<--logstash#-{now/M{yyyy.MM}}>\\\"\")\n-                );\n-                expectDateMathErrorWithLineNumber(\n-                    command,\n-                    clusterString + \"*, \\\"-<-logstash-{now/D}>\\\"\",\n-                    lineNumber,\n-                    \"unit [D] not supported for date math [/D]\"\n-                );\n-                expectDateMathErrorWithLineNumber(\n-                    command,\n-                    clusterString + \"*, -<-logstash-{now/D}>\",\n-                    lineNumber,\n-                    \"unit [D] not supported for date math [/D]\"\n-                );\n-                expectDateMathErrorWithLineNumber(\n-                    command,\n-                    clusterString + \"\\\"*, -<-logstash-{now/D}>\\\"\",\n-                    commands.get(command),\n-                    \"unit [D] not supported for date math [/D]\"\n-                );\n-            }\n+            lineNumber = command.contains(\"FROM\") ? \"line 1:10: \" : \"line 1:13: \";\n+            clustersAndIndices(command, \"*\", \"-index#pattern\");\n+            clustersAndIndices(command, \"index*\", \"-index#pattern\");\n+            clustersAndIndices(command, \"*\", \"-<--logstash-{now/M{yyyy.MM}}>\");\n+            clustersAndIndices(command, \"index*\", \"-<--logstash#-{now/M{yyyy.MM}}>\");\n+            expectDateMathErrorWithLineNumber(command, \"*, \\\"-<-logstash-{now/D}>\\\"\", lineNumber, dateMathError);\n+            expectDateMathErrorWithLineNumber(command, \"*, -<-logstash-{now/D}>\", lineNumber, dateMathError);\n+            expectDateMathErrorWithLineNumber(command, \"\\\"*, -<-logstash-{now/D}>\\\"\", commands.get(command), dateMathError);\n         }\n     }\n \n+    private void clustersAndIndices(String command, String indexString1, String indexString2) {\n+        assertEquals(unresolvedRelation(indexString1 + \",\" + indexString2), statement(command, indexString1 + \", \" + indexString2));\n+        assertEquals(\n+            unresolvedRelation(indexString1 + \",\" + indexString2),\n+            statement(command, indexString1 + \", \\\"\" + indexString2 + \"\\\"\")\n+        );\n+        assertEquals(\n+            unresolvedRelation(indexString1 + \", \" + indexString2),\n+            statement(command, \"\\\"\" + indexString1 + \", \" + indexString2 + \"\\\"\")\n+        );\n+    }\n+\n     public void testInvalidQuotingAsFromIndexPattern() {\n         expectError(\"FROM \\\"foo\", \": token recognition error at: '\\\"foo'\");\n         expectError(\"FROM \\\"foo | LIMIT 1\", \": token recognition error at: '\\\"foo | LIMIT 1'\");",
  "logs_path": "factory/claude-sonnet-4-5-20250929/074538b9/elastic_elasticsearch_pr114959/logs.jsonl",
  "errors": [],
  "edit_run_id": "074538b9",
  "test_label": "v0"
}