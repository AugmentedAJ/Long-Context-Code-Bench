{
  "repo_url": "https://github.com/elastic/elasticsearch.git",
  "pr_number": 114992,
  "base_commit": "cf9687f56de49bf5f07152b70b388d3f971aa9a5",
  "runner": "factory",
  "model": "claude-sonnet-4-5-20250929",
  "timeout_s": 7200,
  "status": "success",
  "elapsed_ms": 364473,
  "patch_unified": "diff --git a/modules/data-streams/src/main/java/org/elasticsearch/datastreams/lifecycle/action/DeleteDataStreamLifecycleAction.java b/modules/data-streams/src/main/java/org/elasticsearch/datastreams/lifecycle/action/DeleteDataStreamLifecycleAction.java\nindex 15953486..0b7052fb 100644\n--- a/modules/data-streams/src/main/java/org/elasticsearch/datastreams/lifecycle/action/DeleteDataStreamLifecycleAction.java\n+++ b/modules/data-streams/src/main/java/org/elasticsearch/datastreams/lifecycle/action/DeleteDataStreamLifecycleAction.java\n@@ -51,6 +51,7 @@ public class DeleteDataStreamLifecycleAction {\n                     .allowClosedIndices(true)\n                     .ignoreThrottled(false)\n                     .allowFailureIndices(false)\n+                    .allowSelectors(false)\n                     .build()\n             )\n             .build();\ndiff --git a/server/src/main/java/org/elasticsearch/action/admin/indices/alias/IndicesAliasesRequest.java b/server/src/main/java/org/elasticsearch/action/admin/indices/alias/IndicesAliasesRequest.java\nindex d66cab1d..c7be077f 100644\n--- a/server/src/main/java/org/elasticsearch/action/admin/indices/alias/IndicesAliasesRequest.java\n+++ b/server/src/main/java/org/elasticsearch/action/admin/indices/alias/IndicesAliasesRequest.java\n@@ -75,6 +75,7 @@ public class IndicesAliasesRequest extends AcknowledgedRequest<IndicesAliasesReq\n                 .allowClosedIndices(true)\n                 .ignoreThrottled(false)\n                 .allowFailureIndices(true)\n+                .allowSelectors(false)\n                 .build()\n         )\n         .build();\ndiff --git a/server/src/main/java/org/elasticsearch/action/admin/indices/alias/get/GetAliasesRequest.java b/server/src/main/java/org/elasticsearch/action/admin/indices/alias/get/GetAliasesRequest.java\nindex c2810881..bff091b7 100644\n--- a/server/src/main/java/org/elasticsearch/action/admin/indices/alias/get/GetAliasesRequest.java\n+++ b/server/src/main/java/org/elasticsearch/action/admin/indices/alias/get/GetAliasesRequest.java\n@@ -24,7 +24,7 @@ import java.util.Map;\n \n public class GetAliasesRequest extends ActionRequest implements AliasesRequest {\n \n-    public static final IndicesOptions DEFAULT_INDICES_OPTIONS = IndicesOptions.strictExpandHidden();\n+    public static final IndicesOptions DEFAULT_INDICES_OPTIONS = IndicesOptions.strictExpandHiddenNoSelectors();\n \n     private String[] aliases;\n     private String[] originalAliases;\ndiff --git a/server/src/main/java/org/elasticsearch/action/admin/indices/delete/DeleteIndexRequest.java b/server/src/main/java/org/elasticsearch/action/admin/indices/delete/DeleteIndexRequest.java\nindex 96fae42b..c72964cd 100644\n--- a/server/src/main/java/org/elasticsearch/action/admin/indices/delete/DeleteIndexRequest.java\n+++ b/server/src/main/java/org/elasticsearch/action/admin/indices/delete/DeleteIndexRequest.java\n@@ -44,6 +44,7 @@ public class DeleteIndexRequest extends AcknowledgedRequest<DeleteIndexRequest>\n                 .allowClosedIndices(true)\n                 .ignoreThrottled(false)\n                 .allowFailureIndices(true)\n+                .allowSelectors(false)\n                 .build()\n         )\n         .build();\ndiff --git a/server/src/main/java/org/elasticsearch/action/admin/indices/mapping/put/PutMappingRequest.java b/server/src/main/java/org/elasticsearch/action/admin/indices/mapping/put/PutMappingRequest.java\nindex 7b782c6d..643e2637 100644\n--- a/server/src/main/java/org/elasticsearch/action/admin/indices/mapping/put/PutMappingRequest.java\n+++ b/server/src/main/java/org/elasticsearch/action/admin/indices/mapping/put/PutMappingRequest.java\n@@ -83,6 +83,7 @@ public class PutMappingRequest extends AcknowledgedRequest<PutMappingRequest> im\n                 .allowAliasToMultipleIndices(true)\n                 .ignoreThrottled(false)\n                 .allowFailureIndices(false)\n+                .allowSelectors(false)\n         )\n         .build();\n \ndiff --git a/server/src/main/java/org/elasticsearch/action/support/IndicesOptions.java b/server/src/main/java/org/elasticsearch/action/support/IndicesOptions.java\nindex 85889d83..86686f08 100644\n--- a/server/src/main/java/org/elasticsearch/action/support/IndicesOptions.java\n+++ b/server/src/main/java/org/elasticsearch/action/support/IndicesOptions.java\n@@ -325,6 +325,7 @@ public record IndicesOptions(\n      * @param allowAliasToMultipleIndices, allow aliases to multiple indices, true by default.\n      * @param allowClosedIndices, allow closed indices, true by default.\n      * @param allowFailureIndices, allow failure indices in the response, true by default\n+     * @param allowSelectors, allow selector syntax (::data, ::failures, ::*) in index expressions, true by default\n      * @param ignoreThrottled, filters out throttled (aka frozen indices), defaults to true. This is deprecated and the only one\n      *                         that only filters and never throws an error.\n      */\n@@ -332,11 +333,12 @@ public record IndicesOptions(\n         boolean allowAliasToMultipleIndices,\n         boolean allowClosedIndices,\n         boolean allowFailureIndices,\n+        boolean allowSelectors,\n         @Deprecated boolean ignoreThrottled\n     ) implements ToXContentFragment {\n \n         public static final String IGNORE_THROTTLED = \"ignore_throttled\";\n-        public static final GatekeeperOptions DEFAULT = new GatekeeperOptions(true, true, true, false);\n+        public static final GatekeeperOptions DEFAULT = new GatekeeperOptions(true, true, true, true, false);\n \n         public static GatekeeperOptions parseParameter(Object ignoreThrottled, GatekeeperOptions defaultOptions) {\n             if (ignoreThrottled == null && defaultOptions != null) {\n@@ -356,6 +358,7 @@ public record IndicesOptions(\n             private boolean allowAliasToMultipleIndices;\n             private boolean allowClosedIndices;\n             private boolean allowFailureIndices;\n+            private boolean allowSelectors;\n             private boolean ignoreThrottled;\n \n             public Builder() {\n@@ -366,6 +369,7 @@ public record IndicesOptions(\n                 allowAliasToMultipleIndices = options.allowAliasToMultipleIndices;\n                 allowClosedIndices = options.allowClosedIndices;\n                 allowFailureIndices = options.allowFailureIndices;\n+                allowSelectors = options.allowSelectors;\n                 ignoreThrottled = options.ignoreThrottled;\n             }\n \n@@ -396,6 +400,15 @@ public record IndicesOptions(\n                 return this;\n             }\n \n+            /**\n+             * Selector syntax (::data, ::failures, ::*) is accepted when true, otherwise expressions with selectors will throw an error.\n+             * Defaults to true.\n+             */\n+            public Builder allowSelectors(boolean allowSelectors) {\n+                this.allowSelectors = allowSelectors;\n+                return this;\n+            }\n+\n             /**\n              * Throttled indices will not be included in the result. Defaults to false.\n              */\n@@ -405,7 +418,7 @@ public record IndicesOptions(\n             }\n \n             public GatekeeperOptions build() {\n-                return new GatekeeperOptions(allowAliasToMultipleIndices, allowClosedIndices, allowFailureIndices, ignoreThrottled);\n+                return new GatekeeperOptions(allowAliasToMultipleIndices, allowClosedIndices, allowFailureIndices, allowSelectors, ignoreThrottled);\n             }\n         }\n \n@@ -586,6 +599,7 @@ public record IndicesOptions(\n                 .allowAliasToMultipleIndices(true)\n                 .allowClosedIndices(true)\n                 .allowFailureIndices(false)\n+                .allowSelectors(false)\n                 .ignoreThrottled(false)\n         )\n         .build();\n@@ -651,6 +665,7 @@ public record IndicesOptions(\n                 .allowAliasToMultipleIndices(true)\n                 .allowClosedIndices(true)\n                 .allowFailureIndices(false)\n+                .allowSelectors(false)\n                 .ignoreThrottled(false)\n         )\n         .build();\n@@ -697,6 +712,7 @@ public record IndicesOptions(\n                 .allowAliasToMultipleIndices(true)\n                 .allowClosedIndices(true)\n                 .allowFailureIndices(false)\n+                .allowSelectors(false)\n                 .ignoreThrottled(false)\n         )\n         .build();\n@@ -909,6 +925,13 @@ public record IndicesOptions(\n         return gatekeeperOptions.allowFailureIndices();\n     }\n \n+    /**\n+     * @return Whether selector syntax (::data, ::failures, ::*) is allowed in index expressions.\n+     */\n+    public boolean allowSelectors() {\n+        return gatekeeperOptions.allowSelectors();\n+    }\n+\n     /**\n      * @return whether aliases pointing to multiple indices are allowed\n      */\n@@ -1479,6 +1502,15 @@ public record IndicesOptions(\n         return STRICT_EXPAND_OPEN_CLOSED_HIDDEN;\n     }\n \n+    /**\n+     * @return indices options that requires every specified index to exist, expands wildcards to open and hidden indices, allows\n+     * that no indices are resolved from wildcard expressions (not returning an error), forbids the use of closed indices\n+     * by throwing an error, and does not allow selector syntax.\n+     */\n+    public static IndicesOptions strictExpandHiddenNoSelectors() {\n+        return STRICT_EXPAND_OPEN_CLOSED_HIDDEN_NO_SELECTORS;\n+    }\n+\n     /**\n      * @return indices option that expands wildcards to both open and closed indices, includes failure store\n      * (with data stream) and allows that indices can be missing and no indices are resolved from wildcard expressions\ndiff --git a/server/src/main/java/org/elasticsearch/cluster/metadata/IndexNameExpressionResolver.java b/server/src/main/java/org/elasticsearch/cluster/metadata/IndexNameExpressionResolver.java\nindex 279243ee..b53947f1 100644\n--- a/server/src/main/java/org/elasticsearch/cluster/metadata/IndexNameExpressionResolver.java\n+++ b/server/src/main/java/org/elasticsearch/cluster/metadata/IndexNameExpressionResolver.java\n@@ -13,6 +13,7 @@ import org.apache.lucene.util.automaton.Automaton;\n import org.elasticsearch.ElasticsearchParseException;\n import org.elasticsearch.action.DocWriteRequest;\n import org.elasticsearch.action.IndicesRequest;\n+import org.elasticsearch.action.support.IndexComponentSelector;\n import org.elasticsearch.action.support.IndicesOptions;\n import org.elasticsearch.cluster.ClusterState;\n import org.elasticsearch.cluster.metadata.IndexAbstraction.Type;\n@@ -1147,6 +1148,46 @@ public class IndexNameExpressionResolver {\n         return true;\n     }\n \n+    /**\n+     * Represents a resolved index expression, containing the resource name and optional selector.\n+     * A selector (e.g., ::data, ::failures, ::*) specifies which component of the resource to target.\n+     *\n+     * @param resource the name of the resource (index, alias, or data stream)\n+     * @param selector the optional selector specifying which component to target (data, failures, or all applicable)\n+     */\n+    public record ResolvedExpression(String resource, @Nullable IndexComponentSelector selector) {\n+        public static final String SELECTOR_SEPARATOR = \"::\";\n+\n+        /**\n+         * Creates a ResolvedExpression from a resource name with an optional selector.\n+         *\n+         * @param expression the full expression (e.g., \"my-index::data\")\n+         * @return a ResolvedExpression with parsed resource and selector\n+         */\n+        public static ResolvedExpression fromExpression(String expression) {\n+            int separatorIndex = expression.indexOf(SELECTOR_SEPARATOR);\n+            if (separatorIndex == -1) {\n+                return new ResolvedExpression(expression, null);\n+            }\n+            String resource = expression.substring(0, separatorIndex);\n+            String selectorKey = expression.substring(separatorIndex + SELECTOR_SEPARATOR.length());\n+            IndexComponentSelector selector = IndexComponentSelector.getByKey(selectorKey);\n+            if (selector == null) {\n+                throw new IllegalArgumentException(\n+                    \"Invalid index component selector [\" + selectorKey + \"], valid options are: data, failures, *\"\n+                );\n+            }\n+            return new ResolvedExpression(resource, selector);\n+        }\n+\n+        /**\n+         * Returns the full expression string including the selector if present.\n+         */\n+        public String asExpression() {\n+            return selector == null ? resource : resource + SELECTOR_SEPARATOR + selector.getKey();\n+        }\n+    }\n+\n     public static class Context {\n \n         private final ClusterState state;",
  "logs_path": "factory/claude-sonnet-4-5-20250929/074538b9/elastic_elasticsearch_pr114992/logs.jsonl",
  "errors": [],
  "edit_run_id": "074538b9",
  "test_label": "v0"
}