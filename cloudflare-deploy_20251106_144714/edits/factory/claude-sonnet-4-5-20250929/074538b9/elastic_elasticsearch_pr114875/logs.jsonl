{"timestamp": 1762428045.932731, "event": "agent_start", "runner": "factory", "model": "claude-sonnet-4-5-20250929", "command": ["droid", "exec", "--skip-permissions-unsafe", "You are working on a codebase. Your task is to make the necessary code changes to accomplish the following:\n\n[8.x] Removing tech-preview header and updating documentation for retrievers and RRF (#114810)\n\nBackports the following commits to 8.x:\n - Removing tech-preview header and updating documentation for retrievers and RRF (#114810)\n\nPlease make all necessary code changes to complete this task.", "--output-format", "stream-json", "--model", "claude-sonnet-4-5-20250929"], "workspace": "/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpfnfjl2kw/workspace", "timeout_s": 7200}
{"timestamp": 1762428283.713797, "event": "agent_run", "stdout": "{\"type\":\"system\",\"subtype\":\"init\",\"cwd\":\"/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpfnfjl2kw/workspace\",\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\",\"tools\":[\"Read\",\"LS\",\"Execute\",\"Edit\",\"ApplyPatch\",\"Grep\",\"Glob\",\"Create\",\"ExitSpecMode\",\"WebSearch\",\"TodoWrite\",\"FetchUrl\",\"slack_post_message\",\"GenerateDroid\"],\"model\":\"claude-sonnet-4-5-20250929\"}\n{\"type\":\"message\",\"role\":\"user\",\"id\":\"af64b632-69de-4b79-aca8-ddf5950dcaa1\",\"text\":\"You are working on a codebase. Your task is to make the necessary code changes to accomplish the following:\\n\\n[8.x] Removing tech-preview header and updating documentation for retrievers and RRF (#114810)\\n\\nBackports the following commits to 8.x:\\n - Removing tech-preview header and updating documentation for retrievers and RRF (#114810)\\n\\nPlease make all necessary code changes to complete this task.\",\"timestamp\":1762428047264,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"message\",\"role\":\"assistant\",\"id\":\"3f8da506-41e2-421a-9dac-69f36a344d4e\",\"text\":\"I'll help you complete this task. Let me start by exploring the codebase to understand what needs to be done regarding removing tech-preview headers and updating documentation for retrievers and RRF.\",\"timestamp\":1762428057392,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_call\",\"id\":\"toolu_01GrvsEag9HasHo4GEXLxdaM\",\"messageId\":\"3f8da506-41e2-421a-9dac-69f36a344d4e\",\"toolId\":\"TodoWrite\",\"toolName\":\"TodoWrite\",\"parameters\":{\"todos\":[{\"id\":\"1\",\"content\":\"Explore codebase to find tech-preview headers related to retrievers and RRF\",\"status\":\"in_progress\",\"priority\":\"high\"},{\"id\":\"2\",\"content\":\"Find documentation files for retrievers and RRF\",\"status\":\"pending\",\"priority\":\"high\"},{\"id\":\"3\",\"content\":\"Remove tech-preview headers from relevant files\",\"status\":\"pending\",\"priority\":\"high\"},{\"id\":\"4\",\"content\":\"Update documentation as needed\",\"status\":\"pending\",\"priority\":\"high\"},{\"id\":\"5\",\"content\":\"Verify all changes are complete\",\"status\":\"pending\",\"priority\":\"medium\"}]},\"timestamp\":1762428057392,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_call\",\"id\":\"toolu_01JNGxpgegR9DJFLFVtV66kr\",\"messageId\":\"3f8da506-41e2-421a-9dac-69f36a344d4e\",\"toolId\":\"Grep\",\"toolName\":\"Grep\",\"parameters\":{\"pattern\":\"tech-preview\",\"case_insensitive\":true,\"output_mode\":\"file_paths\"},\"timestamp\":1762428057392,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_call\",\"id\":\"toolu_01R4DpTywQwqYqeJ4ZxtPZkA\",\"messageId\":\"3f8da506-41e2-421a-9dac-69f36a344d4e\",\"toolId\":\"Grep\",\"toolName\":\"Grep\",\"parameters\":{\"pattern\":\"retriever\",\"case_insensitive\":true,\"output_mode\":\"file_paths\"},\"timestamp\":1762428057392,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_call\",\"id\":\"toolu_01WtrwayC8DLhk3yJ9nUa5Tw\",\"messageId\":\"3f8da506-41e2-421a-9dac-69f36a344d4e\",\"toolId\":\"Grep\",\"toolName\":\"Grep\",\"parameters\":{\"pattern\":\"RRF\",\"output_mode\":\"file_paths\"},\"timestamp\":1762428057392,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_result\",\"id\":\"toolu_01GrvsEag9HasHo4GEXLxdaM\",\"messageId\":\"e6a5de24-7099-46fd-be53-e979791ab197\",\"toolId\":\"TodoWrite\",\"isError\":false,\"value\":\"TODO List Updated\",\"timestamp\":1762428058271,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_result\",\"id\":\"toolu_01JNGxpgegR9DJFLFVtV66kr\",\"messageId\":\"e6a5de24-7099-46fd-be53-e979791ab197\",\"toolId\":\"Grep\",\"isError\":false,\"value\":\"No matching files found\",\"timestamp\":1762428058271,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_result\",\"id\":\"toolu_01R4DpTywQwqYqeJ4ZxtPZkA\",\"messageId\":\"e6a5de24-7099-46fd-be53-e979791ab197\",\"toolId\":\"Grep\",\"isError\":false,\"value\":\"./x-pack/plugin/ql/src/test/java/org/elasticsearch/xpack/ql/async/AsyncTaskManagementServiceTests.java\\n./x-pack/plugin/ql/src/main/java/org/elasticsearch/xpack/ql/plugin/AbstractTransportQlAsyncGetResultsAction.java\\n./x-pack/plugin/monitoring/src/test/java/org/elasticsearch/xpack/monitoring/collector/cluster/ClusterStatsMonitoringDocTests.java\\n./x-pack/plugin/inference/src/main/java/org/elasticsearch/xpack/inference/InferencePlugin.java\\n./x-pack/plugin/inference/src/main/java/org/elasticsearch/xpack/inference/rank/random/RandomRankBuilder.java\\n./x-pack/plugin/inference/src/main/java/org/elasticsearch/xpack/inference/rank/textsimilarity/TextSimilarityRankBuilder.java\\n./x-pack/plugin/inference/src/main/java/org/elasticsearch/xpack/inference/rank/textsimilarity/TextSimilarityRankRetrieverBuilder.java\\n./x-pack/plugin/inference/src/main/java/org/elasticsearch/xpack/inference/rank/random/RandomRankRetrieverBuilder.java\\n./x-pack/plugin/inference/src/main/java/org/elasticsearch/xpack/inference/InferenceFeatures.java\\n./x-pack/plugin/inference/src/yamlRestTest/resources/rest-api-spec/test/inference/80_random_rerank_retriever.yml\\n./x-pack/plugin/inference/src/yamlRestTest/resources/rest-api-spec/test/inference/70_text_similarity_rank_retriever.yml\\n./x-pack/plugin/inference/src/test/java/org/elasticsearch/xpack/inference/rank/random/RandomRankRetrieverBuilderTests.java\\n./x-pack/plugin/inference/src/test/java/org/elasticsearch/xpack/inference/rank/textsimilarity/TextSimilarityRankRetrieverBuilderTests.java\\n./x-pack/plugin/inference/src/test/java/org/elasticsearch/xpack/inference/rank/textsimilarity/TextSimilarityRankRetrieverTelemetryTests.java\\n./x-pack/plugin/async-search/src/main/java/org/elasticsearch/xpack/search/TransportGetAsyncSearchAction.java\\n./x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/action/TransportDeleteTrainedModelAction.java\\n./x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/action/TransportStartTrainedModelDeploymentAction.java\\n./x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/action/TransportPutTrainedModelAction.java\\n./x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/utils/TaskRetriever.java\\n./x-pack/plugin/ml/src/main/resources/org/elasticsearch/xpack/ml/aggs/categorization/ml-en.dict\\n./x-pack/plugin/ml/src/test/java/org/elasticsearch/xpack/ml/action/TransportDeleteTrainedModelActionTests.java\\n./x-pack/plugin/ml/src/test/java/org/elasticsearch/xpack/ml/action/TransportPutTrainedModelActionTests.java\\n./x-pack/plugin/ml/src/test/java/org/elasticsearch/xpack/ml/utils/TaskRetrieverTests.java\\n./x-pack/plugin/rank-rrf/src/yamlRestTest/resources/rest-api-spec/test/license/100_license.yml\\n./x-pack/plugin/rank-rrf/src/yamlRestTest/resources/rest-api-spec/test/rrf/400_rrf_retriever_script.yml\\n./x-pack/plugin/rank-rrf/src/yamlRestTest/resources/rest-api-spec/test/rrf/800_rrf_with_text_similarity_reranker_retriever.yml\\n./x-pack/plugin/rank-rrf/src/yamlRestTest/resources/rest-api-spec/test/rrf/700_rrf_retriever_search_api_compatibility.yml\\n./x-pack/plugin/rank-rrf/src/yamlRestTest/resources/rest-api-spec/test/rrf/300_rrf_retriever.yml\\n./x-pack/plugin/rank-rrf/src/yamlRestTest/resources/rest-api-spec/test/rrf/350_rrf_retriever_pagination.yml\\n./x-pack/plugin/rank-rrf/src/yamlRestTest/resources/rest-api-spec/test/rrf/600_rrf_retriever_profile.yml\\n./x-pack/plugin/rank-rrf/src/internalClusterTest/java/org/elasticsearch/xpack/rank/rrf/RRFRetrieverBuilderNestedDocsIT.java\\n./x-pack/plugin/rank-rrf/src/internalClusterTest/java/org/elasticsearch/xpack/rank/rrf/RRFRetrieverBuilderIT.java\\n./x-pack/plugin/rank-rrf/src/internalClusterTest/java/org/elasticsearch/xpack/rank/rrf/RRFRetrieverTelemetryIT.java\\n./x-pack/plugin/rank-rrf/src/test/java/org/elasticsearch/xpack/rank/rrf/RRFRetrieverBuilderTests.java\\n./x-pack/plugin/rank-rrf/src/test/java/org/elasticsearch/xpack/rank/rrf/RRFRetrieverBuilderParsingTests.java\\n./x-pack/plugin/rank-rrf/src/main/java/org/elasticsearch/xpack/rank/rrf/RRFRetrieverBuilder.java\\n./x-pack/plugin/rank-rrf/src/main/java/org/elasticsearch/xpack/rank/rrf/RRFRankPlugin.java\\n./x-pack/plugin/rank-rrf/src/yamlRestTest/resources/rest-api-spec/test/rrf/500_rrf_retriever_explain.yml\\n./x-pack/plugin/rank-rrf/src/main/java/org/elasticsearch/xpack/rank/rrf/RRFFeatures.java\\n./x-pack/plugin/slm/src/test/java/org/elasticsearch/xpack/slm/SnapshotRetentionTaskTests.java\\n./x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/async/AsyncResultsService.java\\n./x-pack/plugin/esql-core/src/main/java/org/elasticsearch/xpack/esql/core/plugin/AbstractTransportQlAsyncGetResultsAction.java\\n./x-pack/plugin/esql-core/src/test/java/org/elasticsearch/xpack/esql/core/async/AsyncTaskManagementServiceTests.java\\n./x-pack/plugin/core/src/test/java/org/elasticsearch/xpack/core/async/AsyncResultsServiceTests.java\\n./muted-tests.yml\\n./rest-api-spec/src/yamlRestTest/resources/rest-api-spec/test/search.vectors/190_knn_query-with-k-param.yml\\n./rest-api-spec/src/yamlRestTest/resources/rest-api-spec/test/search.retrievers/20_knn_retriever.yml\\n./rest-api-spec/src/yamlRestTest/resources/rest-api-spec/test/search.retrievers/10_standard_retriever.yml\\n./docs/reference/query-dsl/semantic-query.asciidoc\\n./docs/reference/query-dsl/text-expansion-query.asciidoc\\n./docs/reference/query-dsl/sparse-vector-query.asciidoc\\n./docs/reference/rest-api/common-parms.asciidoc\\n./docs/reference/reranking/semantic-reranking.asciidoc\\n./docs/reference/inference/service-cohere.asciidoc\\n./docs/reference/tab-widgets/semantic-search/hybrid-search.asciidoc\\n./docs/reference/search/rrf.asciidoc\\n./docs/reference/search/search-your-data/search-api.asciidoc\\n./docs/reference/search/search.asciidoc\\n./docs/reference/search/search-your-data/search-application-api.asciidoc\\n./docs/reference/search/search-your-data/retrievers-overview.asciidoc\\n./docs/reference/search/retriever.asciidoc\\n./docs/reference/search/search-your-data/semantic-text-hybrid-search\\n./docs/reference/release-notes/8.14.0.asciidoc\\n./docs/reference/release-notes/8.15.1.asciidoc\\n./docs/reference/release-notes/8.15.0.asciidoc\\n./docs/reference/search.asciidoc\\n./docs/reference/cluster/stats.asciidoc\\n./docs/changelog/114109.yaml\\n./server/src/main/resources/META-INF/services/org.elasticsearch.features.FeatureSpecification\\n./server/src/main/java/module-info.java\\n./server/src/main/java/org/elasticsearch/TransportVersions.java\\n./server/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestClusterStatsAction.java\\n./server/src/main/java/org/elasticsearch/action/search/TransportSearchAction.java\\n./server/src/main/java/org/elasticsearch/action/admin/cluster/stats/SearchUsageStats.java\\n./server/src/main/java/org/elasticsearch/search/SearchModule.java\\n./server/src/test/java/org/elasticsearch/action/search/SearchRequestTests.java\\n./server/src/test/java/org/elasticsearch/action/admin/cluster/stats/SearchUsageStatsTests.java\\n./server/src/test/java/org/elasticsearch/search/rank/AbstractRankDocWireSerializingTestCase.java\\n./server/src/test/java/org/elasticsearch/search/builder/SearchSourceBuilderTests.java\\n./server/src/test/java/org/elasticsearch/search/retriever/RetrieverBuilderVersionTests.java\\n./server/src/test/java/org/elasticsearch/search/retriever/RankDocsRetrieverBuilderTests.java\\n./server/src/test/java/org/elasticsearch/search/retriever/KnnRetrieverBuilderParsingTests.java\\n./server/src/test/java/org/elasticsearch/search/retriever/RetrieverBuilderErrorTests.java\\n./server/src/test/java/org/elasticsearch/search/retriever/StandardRetrieverBuilderParsingTests.java\\n./server/src/test/java/org/elasticsearch/search/retriever/rankdoc/RankDocsQueryBuilderTests.java\\n./server/src/main/java/org/elasticsearch/search/builder/SearchSourceBuilder.java\\n./server/src/main/java/org/elasticsearch/search/rank/RankDoc.java\\n./server/src/main/java/org/elasticsearch/search/retriever/RetrieverBuilder.java\\n./server/src/main/java/org/elasticsearch/search/retriever/RankDocsRetrieverBuilder.java\\n./server/src/main/java/org/elasticsearch/search/retriever/StandardRetrieverBuilder.java\\n./server/src/main/java/org/elasticsearch/search/retriever/RetrieverParser.java\\n./server/src/main/java/org/elasticsearch/search/retriever/RetrieverParserContext.java\\n./server/src/main/java/org/elasticsearch/search/retriever/RetrieversFeatures.java\\n./server/src/main/java/org/elasticsearch/search/retriever/rankdoc/RankDocsQueryBuilder.java\\n./server/src/main/java/org/elasticsearch/search/retriever/rankdoc/RankDocsQuery.java\\n./server/src/main/java/org/elasticsearch/search/retriever/KnnRetrieverBuilder.java\\n./server/src/main/java/org/elasticsearch/search/retriever/CompoundRetrieverBuilder.java\\n./server/src/main/java/org/elasticsearch/usage/SearchUsageHolder.java\\n./server/src/main/java/org/elasticsearch/usage/SearchUsage.java\\n./server/src/main/java/org/elasticsearch/plugins/SearchPlugin.java\\n./server/src/main/java/org/elasticsearch/lucene/search/uhighlight/CustomUnifiedHighlighter.java\\n./server/src/test/resources/indices/analyze/no_aff_conf_dir/hunspell/en_US/en_US.dic\\n./server/src/test/resources/indices/analyze/conf_dir/hunspell/en_US/en_US.dic\\n./server/src/test/resources/indices/analyze/two_aff_conf_dir/hunspell/en_US/en_US.dic\\n./server/src/test/resources/indices/analyze/conf_dir/hunspell/en_US_custom/en_US.dic\\n./server/src/internalClusterTest/java/org/elasticsearch/search/ccs/CCSUsageTelemetryIT.java\\n./server/src/internalClusterTest/java/org/elasticsearch/search/retriever/RetrieverRewriteIT.java\\n./server/src/internalClusterTest/java/org/elasticsearch/search/retriever/RetrieverTelemetryIT.java\\n./server/src/internalClusterTest/java/org/elasticsearch/search/retriever/MinimalCompoundRetrieverIT.java\\n./test/framework/src/main/java/org/elasticsearch/search/retriever/TestCompoundRetrieverBuilder.java\\n./test/framework/src/main/java/org/elasticsearch/search/retriever/TestRetrieverBuilder.java\",\"timestamp\":1762428058271,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_result\",\"id\":\"toolu_01WtrwayC8DLhk3yJ9nUa5Tw\",\"messageId\":\"e6a5de24-7099-46fd-be53-e979791ab197\",\"toolId\":\"Grep\",\"isError\":false,\"value\":\"./x-pack/plugin/rank-rrf/src/main/java/module-info.java\\n./x-pack/plugin/rank-rrf/src/main/java/org/elasticsearch/xpack/rank/rrf/RRFQueryPhaseRankCoordinatorContext.java\\n./x-pack/plugin/rank-rrf/src/main/java/org/elasticsearch/xpack/rank/rrf/RRFRankBuilder.java\\n./x-pack/plugin/rank-rrf/src/main/java/org/elasticsearch/xpack/rank/rrf/RRFRankPlugin.java\\n./x-pack/plugin/rank-rrf/src/main/java/org/elasticsearch/xpack/rank/rrf/RRFRankDoc.java\\n./x-pack/plugin/rank-rrf/src/main/java/org/elasticsearch/xpack/rank/rrf/RRFRankShardResult.java\\n./x-pack/plugin/rank-rrf/src/main/java/org/elasticsearch/xpack/rank/rrf/RRFQueryPhaseRankShardContext.java\\n./x-pack/plugin/rank-rrf/src/main/java/org/elasticsearch/xpack/rank/rrf/RRFFeatures.java\\n./x-pack/plugin/rank-rrf/src/main/resources/META-INF/services/org.elasticsearch.features.FeatureSpecification\\n./x-pack/plugin/rank-rrf/src/yamlRestTest/resources/rest-api-spec/test/license/100_license.yml\\n./x-pack/plugin/rank-rrf/src/yamlRestTest/resources/rest-api-spec/test/rrf/200_rank_rrf_script.yml\\n./x-pack/plugin/rank-rrf/src/yamlRestTest/resources/rest-api-spec/test/rrf/800_rrf_with_text_similarity_reranker_retriever.yml\\n./x-pack/plugin/rank-rrf/src/yamlRestTest/resources/rest-api-spec/test/rrf/100_rank_rrf.yml\\n./x-pack/plugin/rank-rrf/build.gradle\\n./x-pack/plugin/rank-rrf/src/internalClusterTest/java/org/elasticsearch/xpack/rank/rrf/RRFRetrieverBuilderNestedDocsIT.java\\n./x-pack/plugin/rank-rrf/src/main/java/org/elasticsearch/xpack/rank/rrf/RRFRetrieverBuilder.java\\n./x-pack/plugin/rank-rrf/src/test/java/org/elasticsearch/xpack/rank/rrf/RRFRankShardResultTests.java\\n./x-pack/plugin/rank-rrf/src/test/java/org/elasticsearch/xpack/rank/rrf/RRFRankBuilderTests.java\\n./x-pack/plugin/rank-rrf/src/test/java/org/elasticsearch/xpack/rank/rrf/RRFRetrieverBuilderTests.java\\n./x-pack/plugin/rank-rrf/src/test/java/org/elasticsearch/xpack/rank/rrf/RRFRetrieverBuilderParsingTests.java\\n./x-pack/plugin/rank-rrf/src/test/java/org/elasticsearch/xpack/rank/rrf/RRFRankContextTests.java\\n./x-pack/plugin/rank-rrf/src/yamlRestTest/java/org/elasticsearch/xpack/rank/rrf/RRFRankClientYamlTestSuiteIT.java\\n./x-pack/plugin/rank-rrf/src/internalClusterTest/java/org/elasticsearch/xpack/rank/rrf/RRFRankCoordinatorCanMatchIT.java\\n./x-pack/plugin/rank-rrf/src/internalClusterTest/java/org/elasticsearch/xpack/rank/rrf/RRFRetrieverBuilderIT.java\\n./x-pack/plugin/rank-rrf/src/internalClusterTest/java/org/elasticsearch/xpack/rank/rrf/RRFRetrieverTelemetryIT.java\\n./x-pack/plugin/rank-rrf/src/internalClusterTest/java/org/elasticsearch/xpack/rank/rrf/RRFRankSingleShardIT.java\\n./x-pack/plugin/rank-rrf/src/internalClusterTest/java/org/elasticsearch/xpack/rank/rrf/RRFRankShardCanMatchIT.java\\n./x-pack/plugin/rank-rrf/src/test/java/org/elasticsearch/xpack/rank/rrf/RRFRankDocTests.java\\n./x-pack/plugin/rank-rrf/src/internalClusterTest/java/org/elasticsearch/xpack/rank/rrf/RRFRankMultiShardIT.java\\n./x-pack/plugin/inference/src/main/java/org/elasticsearch/xpack/inference/rank/random/RandomRankRetrieverBuilder.java\\n./x-pack/plugin/inference/src/test/java/org/elasticsearch/xpack/inference/rank/textsimilarity/TextSimilarityRankRetrieverTelemetryTests.java\\n./x-pack/plugin/ml/src/main/resources/org/elasticsearch/xpack/ml/inference/persistence/lang_ident_model_1.json\\n./x-pack/plugin/ml/src/main/resources/org/elasticsearch/xpack/ml/inference.nlp.tokenizers/spm_precompiled_normalizer.txt\\n./x-pack/plugin/core/src/test/resources/org/elasticsearch/xpack/security/transport/ssl/certs/simple/nodes/ca-signed/n7.c1.crt\\n./docs/reference/reranking/index.asciidoc\\n./docs/reference/rest-api/common-parms.asciidoc\\n./docs/reference/reranking/semantic-reranking.asciidoc\\n./docs/reference/query-dsl/text-expansion-query.asciidoc\\n./docs/reference/query-dsl/sparse-vector-query.asciidoc\\n./docs/reference/search/search-your-data/search-application-api.asciidoc\\n./docs/reference/search/search-your-data/search-application-client.asciidoc\\n./docs/reference/search/search-your-data/retrievers-overview.asciidoc\\n./docs/reference/search/search-your-data/semantic-text-hybrid-search\\n./docs/reference/search/rrf.asciidoc\\n./docs/reference/search/retriever.asciidoc\\n./docs/reference/release-notes/8.15.0.asciidoc\\n./docs/reference/release-notes/8.12.0.asciidoc\\n./server/src/main/java/org/elasticsearch/TransportVersions.java\\n./server/src/main/java/org/elasticsearch/search/retriever/rankdoc/RankDocsQueryBuilder.java\\n./docs/changelog/112058.yaml\",\"timestamp\":1762428058271,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"message\",\"role\":\"assistant\",\"id\":\"dfc2a859-78d7-4d98-8324-c079b02c0823\",\"text\":\"Now let me search more specifically for tech-preview headers in documentation and retriever-related files:\",\"timestamp\":1762428065941,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_call\",\"id\":\"toolu_01GhUYAdUT2wfWCvirCtckji\",\"messageId\":\"dfc2a859-78d7-4d98-8324-c079b02c0823\",\"toolId\":\"Grep\",\"toolName\":\"Grep\",\"parameters\":{\"pattern\":\"tech.preview|technical.preview\",\"case_insensitive\":true,\"output_mode\":\"content\",\"line_numbers\":true},\"timestamp\":1762428065941,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_call\",\"id\":\"toolu_01GSjBiB61Eq2xGTYYrFTjZd\",\"messageId\":\"dfc2a859-78d7-4d98-8324-c079b02c0823\",\"toolId\":\"Read\",\"toolName\":\"Read\",\"parameters\":{\"file_path\":\"/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpfnfjl2kw/workspace/docs/reference/search/retriever.asciidoc\"},\"timestamp\":1762428065941,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_call\",\"id\":\"toolu_017J3gyZsrbLUQGfLa3uZ3zS\",\"messageId\":\"dfc2a859-78d7-4d98-8324-c079b02c0823\",\"toolId\":\"Read\",\"toolName\":\"Read\",\"parameters\":{\"file_path\":\"/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpfnfjl2kw/workspace/docs/reference/search/rrf.asciidoc\"},\"timestamp\":1762428065941,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_result\",\"id\":\"toolu_01GhUYAdUT2wfWCvirCtckji\",\"messageId\":\"ae4fc0b0-fe02-4d21-94ff-2fa09a75e0ba\",\"toolId\":\"Grep\",\"isError\":false,\"value\":\"./x-pack/plugin/mapper-counted-keyword/src/main/java/org/elasticsearch/xpack/countedkeyword/CountedKeywordMapperPlugin.java:30: * <p>Both features are considered a tech preview and are thus intentionally undocumented.</p>\\n./x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/AbstractFunctionTestCase.java:877:        \\\"\\\\npreview::[\\\\\\\"Do not use `VALUES` on production environments. This functionality is in technical preview and \\\"\\n./x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/AbstractFunctionTestCase.java:878:            + \\\"may be changed or removed in a future release. Elastic will work to fix any issues, but features in technical preview \\\"\\n./x-pack/plugin/ent-search/src/main/java/org/elasticsearch/xpack/application/connector/ConnectorAPIFeature.java:20:     * Enables the Connectors API feature by default for the tech preview phase.\\n./x-pack/plugin/ent-search/src/main/java/org/elasticsearch/xpack/application/connector/ConnectorAPIFeature.java:21:     * As documented, the Connectors API is currently a tech preview feature,\\n./x-pack/plugin/ent-search/src/main/java/org/elasticsearch/xpack/application/connector/secrets/ConnectorSecretsFeature.java:20:     * Enables the Connectors Secrets feature by default for the tech preview phase.\\n./x-pack/plugin/ent-search/src/main/java/org/elasticsearch/xpack/application/connector/secrets/ConnectorSecretsFeature.java:21:     * As documented, the Connectors Secrets is currently a tech preview feature,\\n./modules/data-streams/src/yamlRestTest/resources/rest-api-spec/test/data_stream/lifecycle/20_basic.yml:4:      reason: \\\"Data stream lifecycle was released as tech preview in 8.11\\\"\\n./modules/data-streams/src/yamlRestTest/resources/rest-api-spec/test/data_stream/lifecycle/10_explain_lifecycle.yml:5:      reason: \\\"Data stream lifecycle was released as tech preview in 8.11\\\"\\n./modules/data-streams/src/yamlRestTest/resources/rest-api-spec/test/data_stream/lifecycle/30_not_found.yml:4:      reason: \\\"Data stream lifecycle was released as tech preview in 8.11\\\"\\n./modules/data-streams/src/yamlRestTest/resources/rest-api-spec/test/data_stream/lifecycle/40_effective_retention.yml:4:      reason: \\\"Data stream lifecycle was released as tech preview in 8.11\\\"\\n./docs/reference/release-notes/8.9.0.asciidoc:263:* Removes the technical preview admonition from query_vector_builder docs {es-pull}96735[#96735]\\n./docs/reference/release-notes/8.10.0.asciidoc:270:* Enable Query Rules as technical preview {es-pull}97466[#97466]\\n./docs/reference/release-notes/8.15.0.asciidoc:497:* Introduce logs index mode as Tech Preview {es-pull}108896[#108896] (issue: {es-issue}108896[#108896])\\n./docs/reference/release-notes/8.12.0.asciidoc:34:* Changes to features that are in Technical Preview.\\n./docs/reference/release-notes/8.12.0.asciidoc:391:* Enable Connectors API as technical preview {es-pull}102994[#102994]\\n./docs/reference/release-notes/8.7.0.asciidoc:370:* Release time_series and rate (on counter fields) aggegations as tech preview {es-pull}93546[#93546]\\n./docs/reference/migration/migrate_8_11.asciidoc:64:<<xpack-rollup,Rollup functionality>> has been deprecated and will be removed in a future release. Previously, rollups were available in technical preview.\\n./docs/reference/migration/migrate_8_12.asciidoc:24:* Changes to features that are in Technical Preview.\\n./docs/reference/migration/migrate_8_13.asciidoc:26:* Changes to features that are in Technical Preview.\\n./docs/reference/rest-api/usage.asciidoc:547:// 6. Ignore the contents of data streams until the failure store is tech preview.\\n./docs/reference/esql/functions/layout/qstr.asciidoc:7:preview::[\\\"Do not use `VALUES` on production environments. This functionality is in technical preview and may be changed or removed in a future release. Elastic will work to fix any issues, but features in technical preview are not subject to the support SLA of official GA features.\\\"]\\n./docs/reference/esql/functions/layout/match.asciidoc:7:preview::[\\\"Do not use on production environments. This functionality is in technical preview and may be changed or removed in a future release. Elastic will work to fix any issues, but features in technical preview are not subject to the support SLA of official GA features.\\\"]\\n./docs/reference/esql/functions/layout/to_date_nanos.asciidoc:7:preview::[\\\"Do not use `VALUES` on production environments. This functionality is in technical preview and may be changed or removed in a future release. Elastic will work to fix any issues, but features in technical preview are not subject to the support SLA of official GA features.\\\"]\\n./docs/reference/esql/functions/layout/values.asciidoc:7:preview::[\\\"Do not use `VALUES` on production environments. This functionality is in technical preview and may be changed or removed in a future release. Elastic will work to fix any issues, but features in technical preview are not subject to the support SLA of official GA features.\\\"]\\n./docs/reference/esql/esql-across-clusters.asciidoc:9:preview::[\\\"{ccs-cap} for {esql} is in technical preview and may be changed or removed in a future release. Elastic will work to fix any issues, but features in technical preview are not subject to the support SLA of official GA features.\\\"]\\n./docs/reference/connector/docs/connectors-redis.asciidoc:28:This connector is in *technical preview* and is subject to change. The design and code is less mature than official GA features and is being provided as-is with no warranties. Technical preview features are not subject to the support SLA of official GA features.\\n./docs/reference/connector/docs/connectors-zoom.asciidoc:35:This connector is in **technical preview** and is subject to change.\\n./docs/reference/connector/docs/connectors-zoom.asciidoc:37:Technical preview features are not subject to the support SLA of official GA features.\\n./docs/reference/connector/docs/connectors-zoom.asciidoc:196:This connector is in *technical preview* and is subject to change.\\n./docs/reference/connector/docs/connectors-zoom.asciidoc:198:Technical preview features are not subject to the support SLA of official GA features.\\n./docs/reference/connector/docs/connectors-box.asciidoc:34:This connector is in *technical preview* and is subject to change.\\n./docs/reference/connector/docs/connectors-box.asciidoc:36:Technical preview features are not subject to the support SLA of official GA features.\\n./docs/reference/connector/docs/connectors-box.asciidoc:204:This connector is in *technical preview* and is subject to change.\\n./docs/reference/connector/docs/connectors-box.asciidoc:206:Technical preview features are not subject to the support SLA of official GA features.\\n./docs/reference/connector/docs/connectors-mysql.asciidoc:157:* *Upgrading from a tech preview connector (8.7 or earlier) to 8.8 will cause the MySQL connector configuration to be invalid.*\\n./docs/reference/connector/docs/connectors-mysql.asciidoc:419:* *Upgrading from a tech preview connector (8.7 or earlier) to 8.8 will cause the MySQL connector configuration to be invalid.*\\n./docs/reference/connector/docs/connectors-teams.asciidoc:34:This connector is in **technical preview** and is subject to change.\\n./docs/reference/connector/docs/connectors-teams.asciidoc:36:Technical preview features are not subject to the support SLA of official GA features.\\n./docs/reference/connector/docs/connectors-teams.asciidoc:196:This connector is in *technical preview* and is subject to change.\\n./docs/reference/connector/docs/connectors-teams.asciidoc:198:Technical preview features are not subject to the support SLA of official GA features.\\n./docs/reference/connector/docs/connectors-graphql.asciidoc:27:This connector is in *technical preview* and is subject to change. The design and code is less mature than official GA features and is being provided as-is with no warranties. Technical preview features are not subject to the support SLA of official GA features.\\n./docs/reference/connector/docs/connectors-confluence.asciidoc:39:Confluence Data Center support was added in 8.13.0 in technical preview and is subject to change. The design and code is less mature than official GA features and is being provided as-is with no warranties. Technical preview features are not subject to the support SLA of official GA features.\\n./docs/reference/connector/docs/connectors-confluence.asciidoc:278:Confluence Data Center support was added in 8.13.0 in technical preview and is subject to change. The design and code is less mature than official GA features and is being provided as-is with no warranties. Technical preview features are not subject to the support SLA of official GA features.\\n./docs/reference/connector/docs/_connectors-overview-table.asciidoc:5:* *Status*: Indicates whether the connector is in General Availability (GA), Technical Preview, Beta, or is an Example connector.\\n./docs/reference/connector/docs/connectors-jira.asciidoc:39:Jira Data Center support was added in 8.13.0 in technical preview and is subject to change. The design and code is less mature than official GA features and is being provided as-is with no warranties. Technical preview features are not subject to the support SLA of official GA features.\\n./docs/reference/connector/docs/connectors-jira.asciidoc:280:Jira Data Center support was added in 8.13.0 in technical preview and is subject to change. The design and code is less mature than official GA features and is being provided as-is with no warranties. Technical preview features are not subject to the support SLA of official GA features.\\n./docs/reference/connector/docs/connectors-slack.asciidoc:34:This connector is in **technical preview** and is subject to change.\\n./docs/reference/connector/docs/connectors-slack.asciidoc:36:Technical preview features are not subject to the support SLA of official GA features.\\n./docs/reference/connector/docs/connectors-slack.asciidoc:189:This connector is in **technical preview** and is subject to change.\\n./docs/reference/connector/docs/connectors-slack.asciidoc:191:Technical preview features are not subject to the support SLA of official GA features.\\n./docs/reference/search/rrf.asciidoc:4:preview::[\\\"This functionality is in technical preview and may be changed or removed in a future release. The syntax will likely change before GA. Elastic will work to fix any issues, but features in technical preview are not subject to the support SLA of official GA features.\\\"]\\n./docs/reference/search/retriever.asciidoc:4:preview::[\\\"This functionality is in technical preview and may be changed or removed in a future release. The syntax will likely change before GA. Elastic will work to fix any issues, but features in technical preview are not subject to the support SLA of official GA features.\\\"]\\n./docs/reference/data-management.asciidoc:29:preview::[\\\"The built-in data stream lifecycle is in technical preview and may be changed or removed in a future release. Elastic will work to fix any issues, but this feature is not subject to the support SLA of official GA features.\\\"]\\n./docs/reference/intro.asciidoc:88:* {serverless-docs}/general/sign-up-trial[*Elastic Cloud Serverless* (technical preview)]: Create serverless projects for autoscaled and fully managed {es} deployments. Sign up for a https://cloud.elastic.co/serverless-registration[14-day free trial].\\n./docs/reference/ingest/processors/geoip.asciidoc:78:preview::[\\\"Do not use the GeoIP2 Anonymous IP, GeoIP2 Connection Type, GeoIP2 Domain, GeoIP2 ISP, and GeoIP2 Enterprise databases in production environments. This functionality is in technical preview and may be changed or removed in a future release. Elastic will work to fix any issues, but features in technical preview are not subject to the support SLA of official GA features.\\\"]\\n./docs/reference/ingest/apis/index.asciidoc:31:preview::[\\\"The commercial IP geolocation database download management APIs are in technical preview and may be changed or removed in a future release. Elastic will work to fix any issues, but this feature is not subject to the support SLA of official GA features.\\\"]\\n./docs/reference/data-streams/logs.asciidoc:4:preview::[Logs data streams and the logsdb index mode are in tech preview and may be changed or removed in the future. Don't use logs data streams or logsdb index mode in production.]\\n./docs/reference/mapping/fields/synthetic-source.asciidoc:6:synthetic `_source` is in technical preview. Features in technical preview may\\n./docs/reference/mapping/fields/synthetic-source.asciidoc:8:any issues, but features in technical preview are not subject to the support SLA\\n./docs/reference/mapping/types/search-as-you-type.asciidoc:263:synthetic `_source` is in technical preview. Features in technical preview may\\n./docs/reference/mapping/types/search-as-you-type.asciidoc:265:any issues, but features in technical preview are not subject to the support SLA\\n./docs/reference/mapping/types/numeric.asciidoc:247:synthetic `_source` is in technical preview. Features in technical preview may\\n./docs/reference/mapping/types/numeric.asciidoc:249:any issues, but features in technical preview are not subject to the support SLA\\n./docs/reference/mapping/types/keyword.asciidoc:176:synthetic `_source` is in technical preview. Features in technical preview may\\n./docs/reference/mapping/types/keyword.asciidoc:178:any issues, but features in technical preview are not subject to the support SLA\\n./docs/reference/mapping/types/text.asciidoc:170:synthetic `_source` is in technical preview. Features in technical preview may\\n./docs/reference/mapping/types/text.asciidoc:172:any issues, but features in technical preview are not subject to the support SLA\\n./docs/reference/mapping/types/boolean.asciidoc:238:synthetic `_source` is in technical preview. Features in technical preview may\\n./docs/reference/mapping/types/boolean.asciidoc:240:any issues, but features in technical preview are not subject to the support SLA\\n./docs/reference/mapping/types/flattened.asciidoc:322:synthetic `_source` is in technical preview. Features in technical preview may\\n./docs/reference/mapping/types/flattened.asciidoc:324:any issues, but features in technical preview are not subject to the support SLA\\n./docs/reference/mapping/types/aggregate-metric-double.asciidoc:257:synthetic `_source` is in technical preview. Features in technical preview may\\n./docs/reference/mapping/types/aggregate-metric-double.asciidoc:259:any issues, but features in technical preview are not subject to the support SLA\\n./docs/reference/mapping/types/version.asciidoc:76:synthetic `_source` is in technical preview. Features in technical preview may\\n./docs/reference/mapping/types/version.asciidoc:78:any issues, but features in technical preview are not subject to the support SLA\\n./docs/reference/mapping/types/histogram.asciidoc:76:synthetic `_source` is in technical preview. Features in technical preview may\\n./docs/reference/mapping/types/histogram.asciidoc:78:any issues, but features in technical preview are not subject to the support SLA\\n./docs/reference/mapping/types/geo-shape.asciidoc:501:synthetic `_source` is in technical preview. Features in technical preview may\\n./docs/reference/mapping/types/geo-shape.asciidoc:503:any issues, but features in technical preview are not subject to the support SLA\\n./docs/reference/mapping/types/dense-vector.asciidoc:367:synthetic `_source` is in technical preview. Features in technical preview may\\n./docs/reference/mapping/types/dense-vector.asciidoc:369:any issues, but features in technical preview are not subject to the support SLA\\n./docs/reference/mapping/types/date_nanos.asciidoc:148:synthetic `_source` is in technical preview. Features in technical preview may\\n./docs/reference/mapping/types/date_nanos.asciidoc:150:any issues, but features in technical preview are not subject to the support SLA\\n./docs/reference/mapping/types/date.asciidoc:245:synthetic `_source` is in technical preview. Features in technical preview may\\n./docs/reference/mapping/types/date.asciidoc:247:any issues, but features in technical preview are not subject to the support SLA\\n./docs/reference/mapping/types/binary.asciidoc:61:synthetic `_source` is in technical preview. Features in technical preview may\\n./docs/reference/mapping/types/binary.asciidoc:63:any issues, but features in technical preview are not subject to the support SLA\\n./docs/reference/mapping/types/range.asciidoc:244:synthetic `_source` is in technical preview. Features in technical preview may\\n./docs/reference/mapping/types/range.asciidoc:246:any issues, but features in technical preview are not subject to the support SLA\\n./docs/reference/mapping/types/token-count.asciidoc:100:synthetic `_source` is in technical preview. Features in technical preview may\\n./docs/reference/mapping/types/token-count.asciidoc:102:any issues, but features in technical preview are not subject to the support SLA\\n./docs/reference/mapping/types/geo-point.asciidoc:217:synthetic `_source` is in technical preview. Features in technical preview may\\n./docs/reference/mapping/types/geo-point.asciidoc:219:any issues, but features in technical preview are not subject to the support SLA\\n./docs/reference/mapping/types/ip.asciidoc:159:synthetic `_source` is in technical preview. Features in technical preview may\\n./docs/reference/mapping/types/ip.asciidoc:161:any issues, but features in technical preview are not subject to the support SLA\\n./docs/plugins/mapper-annotated-text.asciidoc:153:synthetic `_source` is in technical preview. Features in technical preview may\\n./docs/plugins/mapper-annotated-text.asciidoc:155:any issues, but features in technical preview are not subject to the support SLA\",\"timestamp\":1762428066209,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_result\",\"id\":\"toolu_01GSjBiB61Eq2xGTYYrFTjZd\",\"messageId\":\"ae4fc0b0-fe02-4d21-94ff-2fa09a75e0ba\",\"toolId\":\"Read\",\"isError\":false,\"value\":\"[[retriever]]\\n=== Retriever\\n\\npreview::[\\\"This functionality is in technical preview and may be changed or removed in a future release. The syntax will likely change before GA. Elastic will work to fix any issues, but features in technical preview are not subject to the support SLA of official GA features.\\\"]\\n\\nA retriever is a specification to describe top documents returned from a\\nsearch. A retriever replaces other elements of the <<search-search, search API>>\\nthat also return top documents such as <<query-dsl, `query`>> and\\n<<search-api-knn, `knn`>>. A retriever may have child retrievers where a\\nretriever with two or more children is considered a compound retriever. This\\nallows for complex behavior to be depicted in a tree-like structure, called\\nthe retriever tree, to better clarify the order of operations that occur\\nduring a search.\\n\\n[TIP]\\n====\\nRefer to <<retrievers-overview>> for a high level overview of the retrievers abstraction.\\n====\\n\\nThe following retrievers are available:\\n\\n`standard`::\\nA <<standard-retriever, retriever>> that replaces the functionality of a traditional <<query-dsl, query>>.\\n\\n`knn`::\\nA <<knn-retriever, retriever>> that replaces the functionality of a <<search-api-knn, knn search>>.\\n\\n`rrf`::\\nA <<rrf-retriever, retriever>> that produces top documents from <<rrf, reciprocal rank fusion (RRF)>>.\\n\\n`text_similarity_reranker`::\\nA <<text-similarity-reranker-retriever, retriever>> that enhances search results by re-ranking documents based on semantic similarity to a specified inference text, using a machine learning model.\\n\\n[[standard-retriever]]\\n==== Standard Retriever\\n\\nA standard retriever returns top documents from a traditional <<query-dsl, query>>.\\n\\n===== Parameters:\\n\\n`query`::\\n(Optional, <<query-dsl, query object>>)\\n+\\nDefines a query to retrieve a set of top documents.\\n\\n`filter`::\\n(Optional, <<query-dsl, query object or list of query objects>>)\\n+\\nApplies a <<query-dsl-bool-query, boolean query filter>> to this retriever\\nwhere all documents must match this query but do not contribute to the score.\\n\\n`search_after`::\\n(Optional, <<search-after, search after object>>)\\n+\\nDefines a search after object parameter used for pagination.\\n\\ninclude::{es-ref-dir}/rest-api/common-parms.asciidoc[tag=terminate_after]\\n\\n`sort`::\\n+\\n(Optional, <<sort-search-results, sort object>>)\\nA sort object that that specifies the order of matching documents.\\n\\n`min_score`::\\n(Optional, `float`)\\n+\\nMinimum <<relevance-scores, `_score`>> for matching documents. Documents with a\\nlower `_score` are not included in the top documents.\\n\\n`collapse`::\\n(Optional, <<collapse-search-results, collapse object>>)\\n+\\nCollapses the top documents by a specified key into a single top document per key.\\n\\n===== Restrictions\\n\\nWhen a retriever tree contains a compound retriever (a retriever with two or more child\\nretrievers) *only* the query element is allowed.\\n\\n[discrete]\\n[[standard-retriever-example]]\\n==== Example\\n\\n////\\n[source,console]\\n----\\nPUT /restaurants\\n{\\n  \\\"mappings\\\": {\\n    \\\"properties\\\": {\\n      \\\"region\\\": { \\\"type\\\": \\\"keyword\\\" },\\n      \\\"year\\\": { \\\"type\\\": \\\"keyword\\\" },\\n      \\\"vector\\\": {\\n        \\\"type\\\": \\\"dense_vector\\\",\\n        \\\"dims\\\": 3\\n      }\\n    }\\n  }\\n}\\n\\nPOST /restaurants/_bulk?refresh\\n{\\\"index\\\":{}}\\n{\\\"region\\\": \\\"Austria\\\", \\\"year\\\": \\\"2019\\\", \\\"vector\\\": [10, 22, 77]}\\n{\\\"index\\\":{}}\\n{\\\"region\\\": \\\"France\\\", \\\"year\\\": \\\"2019\\\", \\\"vector\\\": [10, 22, 78]}\\n{\\\"index\\\":{}}\\n{\\\"region\\\": \\\"Austria\\\", \\\"year\\\": \\\"2020\\\", \\\"vector\\\": [10, 22, 79]}\\n{\\\"index\\\":{}}\\n{\\\"region\\\": \\\"France\\\", \\\"year\\\": \\\"2020\\\", \\\"vector\\\": [10, 22, 80]}\\n----\\n// TESTSETUP\\n\\n[source,console]\\n--------------------------------------------------\\nDELETE /restaurants\\n--------------------------------------------------\\n// TEARDOWN\\n////\\n\\n[source,console]\\n----\\nGET /restaurants/_search\\n{\\n  \\\"retriever\\\": { <1>\\n    \\\"standard\\\": { <2>\\n      \\\"query\\\": { <3>\\n        \\\"bool\\\": { <4>\\n          \\\"should\\\": [ <5>\\n            {\\n              \\\"match\\\": { <6>\\n                \\\"region\\\": \\\"Austria\\\"\\n              }\\n            }\\n          ],\\n          \\\"filter\\\": [ <7>\\n            {\\n              \\\"term\\\": { <8>\\n                \\\"year\\\": \\\"2019\\\" <9>\\n              }\\n            }\\n          ]\\n        }\\n      }\\n    }\\n  }\\n}\\n----\\n<1> Opens the `retriever` object.\\n<2> The `standard` retriever is used for defining traditional {es} queries.\\n<3> The entry point for defining the search query.\\n<4> The `bool` object allows for combining multiple query clauses logically.\\n<5> The `should` array indicates conditions under which a document will match. Documents matching these conditions will increase their relevancy score.\\n<6> The `match` object finds documents where the `region` field contains the word \\\"Austria.\\\"\\n<7> The `filter` array provides filtering conditions that must be met but do not contribute to the relevancy score.\\n<8> The `term` object is used for exact matches, in this case, filtering documents by the `year` field.\\n<9> The exact value to match in the `year` field.\\n\\n[[knn-retriever]]\\n==== kNN Retriever\\n\\nA kNN retriever returns top documents from a <<knn-search, k-nearest neighbor search (kNN)>>.\\n\\n===== Parameters\\n\\n`field`::\\n(Required, string)\\n+\\ninclude::{es-ref-dir}/rest-api/common-parms.asciidoc[tag=knn-field]\\n\\n`query_vector`::\\n(Required if `query_vector_builder` is not defined, array of `float`)\\n+\\ninclude::{es-ref-dir}/rest-api/common-parms.asciidoc[tag=knn-query-vector]\\n\\n`query_vector_builder`::\\n(Required if `query_vector` is not defined, query vector builder object)\\n+\\nDefines a <<knn-semantic-search, model>> to build a query vector.\\n\\n`k`::\\n(Required, integer)\\n+\\nNumber of nearest neighbors to return as top hits. This value must be fewer than\\nor equal to `num_candidates`.\\n\\n`num_candidates`::\\n(Required, integer)\\n+\\ninclude::{es-ref-dir}/rest-api/common-parms.asciidoc[tag=knn-num-candidates]\\n\\n`filter`::\\n(Optional, <<query-dsl, query object or list of query objects>>)\\n+\\ninclude::{es-ref-dir}/rest-api/common-parms.asciidoc[tag=knn-filter]\\n\\n`similarity`::\\n(Optional, float)\\n+\\ninclude::{es-ref-dir}/rest-api/common-parms.asciidoc[tag=knn-similarity]\\n\\n===== Restrictions\\n\\nThe parameters `query_vector` and `query_vector_builder` cannot be used together.\\n\\n[discrete]\\n[[knn-retriever-example]]\\n==== Example\\n\\n[source,console]\\n----\\nGET /restaurants/_search\\n{\\n  \\\"retriever\\\": {\\n    \\\"knn\\\": { <1>\\n      \\\"field\\\": \\\"vector\\\", <2>\\n      \\\"query_vector\\\": [10, 22, 77], <3>\\n      \\\"k\\\": 10, <4>\\n      \\\"num_candidates\\\": 10 <5>\\n    }\\n  }\\n}\\n----\\n// TEST[continued]\\n<1> Configuration for k-nearest neighbor (knn) search, which is based on vector similarity.\\n<2> Specifies the field name that contains the vectors.\\n<3> The query vector against which document vectors are compared in the `knn` search.\\n<4> The number of nearest neighbors to return as top hits. This value must be fewer than or equal to `num_candidates`.\\n<5> The size of the initial candidate set from which the final `k` nearest neighbors are selected.\\n\\n[[rrf-retriever]]\\n==== RRF Retriever\\n\\nAn <<rrf, RRF>> retriever returns top documents based on the RRF formula,\\nequally weighting two or more child retrievers.\\nReciprocal rank fusion (RRF) is a method for combining multiple result\\nsets with different relevance indicators into a single result set.\\n\\n===== Parameters\\n\\ninclude::{es-ref-dir}/rest-api/common-parms.asciidoc[tag=rrf-retrievers]\\n\\ninclude::{es-ref-dir}/rest-api/common-parms.asciidoc[tag=rrf-rank-constant]\\n\\ninclude::{es-ref-dir}/rest-api/common-parms.asciidoc[tag=rrf-rank-window-size]\\n\\ninclude::{es-ref-dir}/rest-api/common-parms.asciidoc[tag=rrf-filter]\\n\\n===== Restrictions\\n\\nAn RRF retriever is a compound retriever. Child retrievers may not use\\nelements that are restricted by having a compound retriever as part of\\nthe retriever tree.\\n\\n[discrete]\\n[[rrf-retriever-example-hybrid]]\\n==== Example: Hybrid search\\n\\nA simple hybrid search example (lexical search + dense vector search) combining a `standard` retriever with a `knn` retriever using RRF:\\n\\n[source,console]\\n----\\nGET /restaurants/_search\\n{\\n  \\\"retriever\\\": {\\n    \\\"rrf\\\": { <1>\\n      \\\"retrievers\\\": [ <2>\\n        {\\n          \\\"standard\\\": { <3>\\n            \\\"query\\\": {\\n              \\\"multi_match\\\": {\\n                \\\"query\\\": \\\"Austria\\\",\\n                \\\"fields\\\": [\\n                  \\\"city\\\",\\n                  \\\"region\\\"\\n                ]\\n              }\\n            }\\n          }\\n        },\\n        {\\n          \\\"knn\\\": { <4>\\n            \\\"field\\\": \\\"vector\\\",\\n            \\\"query_vector\\\": [10, 22, 77],\\n            \\\"k\\\": 10,\\n            \\\"num_candidates\\\": 10\\n          }\\n        }\\n      ],\\n      \\\"rank_constant\\\": 1, <5>\\n      \\\"rank_window_size\\\": 50  <6>\\n    }\\n  }\\n}\\n----\\n// TEST[continued]\\n<1> Defines a retriever tree with an RRF retriever.\\n<2> The sub-retriever array.\\n<3> The first sub-retriever is a `standard` retriever.\\n<4> The second sub-retriever is a `knn` retriever.\\n<5> The rank constant for the RRF retriever.\\n<6> The rank window size for the RRF retriever.\\n\\n[discrete]\\n[[rrf-retriever-example-hybrid-sparse]]\\n==== Example: Hybrid search with sparse vectors\\n\\nA more complex hybrid search example (lexical search + ELSER sparse vector search + dense vector search) using RRF:\\n\\n[source,console]\\n----\\nGET movies/_search\\n{\\n  \\\"retriever\\\": {\\n    \\\"rrf\\\": {\\n      \\\"retrievers\\\": [\\n        {\\n          \\\"standard\\\": {\\n            \\\"query\\\": {\\n              \\\"sparse_vector\\\": {\\n                \\\"field\\\": \\\"plot_embedding\\\",\\n                \\\"inference_id\\\": \\\"my-elser-model\\\",\\n                \\\"query\\\": \\\"films that explore psychological depths\\\"\\n              }\\n            }\\n          }\\n        },\\n        {\\n          \\\"standard\\\": {\\n            \\\"query\\\": {\\n              \\\"multi_match\\\": {\\n                \\\"query\\\": \\\"crime\\\",\\n                \\\"fields\\\": [\\n                  \\\"plot\\\",\\n                  \\\"title\\\"\\n                ]\\n              }\\n            }\\n          }\\n        },\\n        {\\n          \\\"knn\\\": {\\n            \\\"field\\\": \\\"vector\\\",\\n            \\\"query_vector\\\": [10, 22, 77],\\n            \\\"k\\\": 10,\\n            \\\"num_candidates\\\": 10\\n          }\\n        }\\n      ]\\n    }\\n  }\\n}\\n----\\n// TEST[skip:uses ELSER]\\n\\n[[text-similarity-reranker-retriever]]\\n==== Text Similarity Re-ranker Retriever\\n\\nThe `text_similarity_reranker` retriever uses an NLP model to improve search results by reordering the top-k documents based on their semantic similarity to the query.\\n\\n[TIP]\\n====\\nRefer to <<semantic-reranking>> for a high level overview of semantic re-ranking.\\n====\\n\\n===== Prerequisites\\n\\nTo use `text_similarity_reranker` you must first set up a `rerank` task using the <<put-inference-api, Create {infer} API>>.\\nThe `rerank` task should be set up with a machine learning model that can compute text similarity. Refer to {ml-docs}/ml-nlp-model-ref.html#ml-nlp-model-ref-text-similarity[the Elastic NLP model reference] for a list of third-party text similarity models supported by {es}.\\n\\nCurrently you can:\\n\\n* Integrate directly with the <<infer-service-cohere,Cohere Rerank inference endpoint>> using the `rerank` task type\\n* Integrate directly with the <<infer-service-google-vertex-ai,Google Vertex AI inference endpoint>> using the `rerank` task type\\n* Upload a model to {es} with {eland-docs}/machine-learning.html#ml-nlp-pytorch[Eland] using the `text_similarity` NLP task type.\\n** Then set up an <<inference-example-eland,{es} service inference endpoint>> with the `rerank` task type\\n** Refer to the <<text-similarity-reranker-retriever-example-eland,example>> on this page for a step-by-step guide.\\n\\n===== Parameters\\n`retriever`::\\n(Required, <<retriever, retriever>>)\\n+\\nThe child retriever that generates the initial set of top documents to be re-ranked.\\n\\n`field`::\\n(Required, `string`)\\n+\\nThe document field to be used for text similarity comparisons. This field should contain the text that will be evaluated against the `inferenceText`.\\n\\n`inference_id`::\\n(Required, `string`)\\n+\\nUnique identifier of the inference endpoint created using the {infer} API.\\n\\n`inference_text`::\\n(Required, `string`)\\n+\\nThe text snippet used as the basis for similarity comparison.\\n\\n`rank_window_size`::\\n(Optional, `int`)\\n+\\nThe number of top documents to consider in the re-ranking process. Defaults to `10`.\\n\\n`min_score`::\\n(Optional, `float`)\\n+\\nSets a minimum threshold score for including documents in the re-ranked results. Documents with similarity scores below this threshold will be excluded. Note that score calculations vary depending on the model used.\\n\\n`filter`::\\n(Optional, <<query-dsl, query object or list of query objects>>)\\n+\\nApplies the specified <<query-dsl-bool-query, boolean query filter>> to the child  <<retriever, retriever>>.\\nIf the child retriever already specifies any filters, then this top-level filter is applied in conjuction\\nwith the filter defined in the child retriever.\\n\\n===== Restrictions\\n\\nA text similarity re-ranker retriever is a compound retriever. Child retrievers may not use elements that are restricted by having a compound retriever as part of the retriever tree.\\n\\n[discrete]\\n[[text-similarity-reranker-retriever-example-cohere]]\\n==== Example: Cohere Rerank\\n\\nThis example enables out-of-the-box semantic search by re-ranking top documents using the Cohere Rerank API. This approach eliminate the need to generate and store embeddings for all indexed documents.\\nThis requires a <<infer-service-cohere,Cohere Rerank inference endpoint>> using the `rerank` task type.\\n\\n[source,console]\\n----\\nGET /index/_search\\n{\\n   \\\"retriever\\\": {\\n      \\\"text_similarity_reranker\\\": {\\n         \\\"retriever\\\": {\\n            \\\"standard\\\": {\\n               \\\"query\\\": {\\n                  \\\"match_phrase\\\": {\\n                     \\\"text\\\": \\\"landmark in Paris\\\"\\n                  }\\n               }\\n            }\\n         },\\n         \\\"field\\\": \\\"text\\\",\\n         \\\"inference_id\\\": \\\"my-cohere-rerank-model\\\",\\n         \\\"inference_text\\\": \\\"Most famous landmark in Paris\\\",\\n         \\\"rank_window_size\\\": 100,\\n         \\\"min_score\\\": 0.5\\n      }\\n   }\\n}\\n----\\n// TEST[skip:uses ML]\\n\\n[discrete]\\n[[text-similarity-reranker-retriever-example-eland]]\\n==== Example: Semantic re-ranking with a Hugging Face model\\n\\nThe following example uses the `cross-encoder/ms-marco-MiniLM-L-6-v2` model from Hugging Face to rerank search results based on semantic similarity.\\nThe model must be uploaded to {es} using https://www.elastic.co/guide/en/elasticsearch/client/eland/current/machine-learning.html#ml-nlp-pytorch[Eland].\\n\\n[TIP]\\n====\\nRefer to {ml-docs}/ml-nlp-model-ref.html#ml-nlp-model-ref-text-similarity[the Elastic NLP model reference] for a list of third party text similarity models supported by {es}.\\n====\\n\\nFollow these steps to load the model and create a semantic re-ranker.\\n\\n. Install Eland using `pip`\\n+\\n[source,sh]\\n----\\npython -m pip install eland[pytorch]\\n----\\n+\\n. Upload the model to {es} using Eland. This example assumes you have an Elastic Cloud deployment and an API key. Refer to the https://www.elastic.co/guide/en/elasticsearch/client/eland/current/machine-learning.html#ml-nlp-pytorch-auth[Eland documentation] for more authentication options.\\n+\\n[source,sh]\\n----\\neland_import_hub_model \\\\\\n  --cloud-id $CLOUD_ID \\\\\\n  --es-api-key $ES_API_KEY \\\\\\n  --hub-model-id cross-encoder/ms-marco-MiniLM-L-6-v2 \\\\\\n  --task-type text_similarity \\\\\\n  --clear-previous \\\\\\n  --start\\n----\\n+\\n. Create an inference endpoint for the `rerank` task\\n+\\n[source,console]\\n----\\nPUT _inference/rerank/my-msmarco-minilm-model\\n{\\n  \\\"service\\\": \\\"elasticsearch\\\",\\n  \\\"service_settings\\\": {\\n    \\\"num_allocations\\\": 1,\\n    \\\"num_threads\\\": 1,\\n    \\\"model_id\\\": \\\"cross-encoder__ms-marco-minilm-l-6-v2\\\"\\n  }\\n}\\n----\\n// TEST[skip:uses ML]\\n+\\n. Define a `text_similarity_rerank` retriever.\\n+\\n[source,console]\\n----\\nPOST movies/_search\\n{\\n  \\\"retriever\\\": {\\n    \\\"text_similarity_reranker\\\": {\\n      \\\"retriever\\\": {\\n        \\\"standard\\\": {\\n          \\\"query\\\": {\\n            \\\"match\\\": {\\n              \\\"genre\\\": \\\"drama\\\"\\n            }\\n          }\\n        }\\n      },\\n      \\\"field\\\": \\\"plot\\\",\\n      \\\"inference_id\\\": \\\"my-msmarco-minilm-model\\\",\\n      \\\"inference_text\\\": \\\"films that explore psychological depths\\\"\\n    }\\n  }\\n}\\n----\\n// TEST[skip:uses ML]\\n+\\nThis retriever uses a standard `match` query to search the `movie` index for films tagged with the genre \\\"drama\\\".\\nIt then re-ranks the results based on semantic similarity to the text in the `inference_text` parameter, using the model we uploaded to {es}.\\n\\n==== Using `from` and `size` with a retriever tree\\n\\nThe <<search-from-param, `from`>> and <<search-size-param, `size`>>\\nparameters are provided globally as part of the general\\n<<search-search, search API>>. They are applied to all retrievers in a\\nretriever tree unless a specific retriever overrides the `size` parameter\\nusing a different parameter such as `rank_window_size`. Though, the final\\nsearch hits are always limited to `size`.\\n\\n==== Using aggregations with a retriever tree\\n\\n<<search-aggregations, Aggregations>> are globally specified as part of a search request.\\nThe query used for an aggregation is the combination of all leaf retrievers as `should`\\nclauses in a <<query-dsl-bool-query, boolean query>>.\\n\\n==== Restrictions on search parameters when specifying a retriever\\n\\nWhen a retriever is specified as part of a search the following elements are not allowed\\nat the top-level and instead are only allowed as elements of specific retrievers:\\n\\n* <<request-body-search-query, `query`>>\\n* <<search-api-knn, `knn`>>\\n* <<search-after, `search_after`>>\\n* <<request-body-search-terminate-after, `terminate_after`>>\\n* <<search-sort-param, `sort`>>\\n* <<rescore, `rescore`>>\\n* <<search-api-min-score, `min_score`>>\\n\",\"timestamp\":1762428066209,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_result\",\"id\":\"toolu_017J3gyZsrbLUQGfLa3uZ3zS\",\"messageId\":\"ae4fc0b0-fe02-4d21-94ff-2fa09a75e0ba\",\"toolId\":\"Read\",\"isError\":false,\"value\":\"[[rrf]]\\n=== Reciprocal rank fusion\\n\\npreview::[\\\"This functionality is in technical preview and may be changed or removed in a future release. The syntax will likely change before GA. Elastic will work to fix any issues, but features in technical preview are not subject to the support SLA of official GA features.\\\"]\\n\\nhttps://plg.uwaterloo.ca/~gvcormac/cormacksigir09-rrf.pdf[Reciprocal rank fusion (RRF)]\\nis a method for combining multiple result sets with different relevance indicators into a single result set.\\nRRF requires no tuning, and the different relevance indicators do not have to be related to each other to achieve high-quality results.\\n\\nRRF uses the following formula to determine the score for ranking each document:\\n\\n[source,python]\\n----\\nscore = 0.0\\nfor q in queries:\\n    if d in result(q):\\n        score += 1.0 / ( k + rank( result(q), d ) )\\nreturn score\\n\\n# where\\n# k is a ranking constant\\n# q is a query in the set of queries\\n# d is a document in the result set of q\\n# result(q) is the result set of q\\n# rank( result(q), d ) is d's rank within the result(q) starting from 1\\n----\\n// NOTCONSOLE\\n\\n[[rrf-api]]\\n==== Reciprocal rank fusion API\\n\\nYou can use RRF as part of a <<search-search, search>> to combine and rank documents using separate sets of top documents (result sets) from a combination of <<retriever, child retrievers>> using an\\n<<rrf-retriever, RRF retriever>>.\\nA minimum of *two* child retrievers is required for ranking.\\n\\nAn RRF retriever is an optional object defined as part of a search request's\\n<<request-body-retriever, retriever parameter>>.\\nThe RRF retriever object contains the following parameters:\\n\\ninclude::{es-ref-dir}/rest-api/common-parms.asciidoc[tag=rrf-retrievers]\\n\\ninclude::{es-ref-dir}/rest-api/common-parms.asciidoc[tag=rrf-rank-constant]\\n\\ninclude::{es-ref-dir}/rest-api/common-parms.asciidoc[tag=rrf-rank-window-size]\\n\\nAn example request using RRF:\\n\\n[source,console]\\n----\\nGET example-index/_search\\n{\\n    \\\"retriever\\\": {\\n        \\\"rrf\\\": { <3>\\n            \\\"retrievers\\\": [\\n                {\\n                    \\\"standard\\\": { <2>\\n                        \\\"query\\\": {\\n                            \\\"term\\\": {\\n                                \\\"text\\\": \\\"shoes\\\"\\n                            }\\n                        }\\n                    }\\n                },\\n                {\\n                    \\\"knn\\\": { <1>\\n                        \\\"field\\\": \\\"vector\\\",\\n                        \\\"query_vector\\\": [1.25, 2, 3.5],\\n                        \\\"k\\\": 50,\\n                        \\\"num_candidates\\\": 100\\n                    }\\n                }\\n            ],\\n            \\\"rank_window_size\\\": 50,\\n            \\\"rank_constant\\\": 20\\n        }\\n    }\\n}\\n----\\n// TEST[skip:example fragment]\\n\\nIn the above example, we execute the `knn` and `standard` retrievers independently of each other.\\nThen we use the `rrf` retriever to combine the results.\\n\\n<1> First, we execute the kNN search specified by the `knn` retriever to get its global top 50 results.\\n<2> Second, we execute the query specified by the `standard` retriever to get its global top 50 results.\\n<3> Then, on a coordinating node, we combine the kNN search top documents with the query top documents and rank them based on the RRF formula using parameters from the `rrf` retriever to get the combined top documents using the default `size` of `10`.\\n\\nNote that if `k` from a knn search is larger than `rank_window_size`, the results are truncated to `rank_window_size`.\\nIf `k` is smaller than `rank_window_size`, the results are `k` size.\\n\\n[[rrf-supported-features]]\\n==== Reciprocal rank fusion supported features\\n\\nThe `rrf` retriever supports:\\n\\n* <<search-aggregations, aggregations>>\\n* <<search-from-param, from>>\\n\\nThe `rrf` retriever does not currently support:\\n\\n* <<search-api-scroll-query-param, scroll>>\\n* <<search-api-pit, point in time>>\\n* <<search-sort-param, sort>>\\n* <<rescore, rescore>>\\n* <<search-suggesters, suggesters>>\\n* <<highlighting, highlighting>>\\n* <<collapse-search-results, collapse>>\\n* <<profiling-queries, profiling>>\\n\\nUsing unsupported features as part of a search with an `rrf` retriever results in an exception.\\n\\n[[rrf-using-multiple-standard-retrievers]]\\n==== Reciprocal rank fusion using multiple standard retrievers\\n\\nThe `rrf` retriever provides a way to combine and rank multiple `standard` retrievers.\\nA primary use case is combining top documents from a traditional BM25 query and an <<semantic-search-elser, ELSER>> query to achieve improved relevance.\\n\\nAn example request using RRF with multiple standard retrievers:\\n\\n[source,console]\\n----\\nGET example-index/_search\\n{\\n    \\\"retriever\\\": {\\n        \\\"rrf\\\": { <3>\\n            \\\"retrievers\\\": [\\n                {\\n                    \\\"standard\\\": { <1>\\n                        \\\"query\\\": {\\n                            \\\"term\\\": {\\n                                \\\"text\\\": \\\"blue shoes sale\\\"\\n                            }\\n                        }\\n                    }\\n                },\\n                {\\n                    \\\"standard\\\": { <2>\\n                        \\\"query\\\": {\\n                            \\\"sparse_vector\\\":{\\n                                \\\"field\\\": \\\"ml.tokens\\\",\\n                                \\\"inference_id\\\": \\\"my_elser_model\\\",\\n                                \\\"query\\\": \\\"What blue shoes are on sale?\\\"\\n                            }\\n                        }\\n                    }\\n                }\\n            ],\\n            \\\"rank_window_size\\\": 50,\\n            \\\"rank_constant\\\": 20\\n        }\\n    }\\n}\\n----\\n// TEST[skip:example fragment]\\n\\nIn the above example, we execute each of the two `standard` retrievers independently of each other.\\nThen we use the `rrf` retriever to combine the results.\\n\\n<1> First we run the `standard` retriever specifying a term query for `blue shoes sales` using the standard BM25 scoring algorithm.\\n<2> Next we run the `standard` retriever specifying a sparse_vector query for `What blue shoes are on sale?`\\nusing our <<semantic-search-elser, ELSER>> scoring algorithm.\\n<3> The `rrf` retriever allows us to combine the two top documents sets generated by completely independent scoring algorithms with equal weighting.\\n\\nNot only does this remove the need to figure out what the appropriate weighting is using linear combination, but RRF is also shown to give improved relevance over either query individually.\\n\\n[[rrf-using-sub-searches]]\\n==== Reciprocal rank fusion using sub searches\\n\\nRRF using sub searches is no longer supported.\\nUse the <<retriever, retriever API>> instead.\\nSee <<rrf-using-multiple-standard-retrievers, using multiple standard retrievers>> for an example.\\n\\n[[rrf-full-example]]\\n==== Reciprocal rank fusion full example\\n\\nWe begin by creating a mapping for an index with a text field, a vector field, and an integer field along with indexing several documents.\\nFor this example we are going to use a vector with only a single dimension to make the ranking easier to explain.\\n\\n[source,console]\\n----\\nPUT example-index\\n{\\n    \\\"mappings\\\": {\\n        \\\"properties\\\": {\\n            \\\"text\\\" : {\\n                \\\"type\\\" : \\\"text\\\"\\n            },\\n            \\\"vector\\\": {\\n                \\\"type\\\": \\\"dense_vector\\\",\\n                \\\"dims\\\": 1,\\n                \\\"index\\\": true,\\n                \\\"similarity\\\": \\\"l2_norm\\\",\\n                 \\\"index_options\\\": {\\n                     \\\"type\\\": \\\"hnsw\\\"\\n                 }\\n            },\\n            \\\"integer\\\" : {\\n                \\\"type\\\" : \\\"integer\\\"\\n            }\\n        }\\n    }\\n}\\n\\nPUT example-index/_doc/1\\n{\\n    \\\"text\\\" : \\\"rrf\\\",\\n    \\\"vector\\\" : [5],\\n    \\\"integer\\\": 1\\n}\\n\\nPUT example-index/_doc/2\\n{\\n    \\\"text\\\" : \\\"rrf rrf\\\",\\n    \\\"vector\\\" : [4],\\n    \\\"integer\\\": 2\\n}\\n\\nPUT example-index/_doc/3\\n{\\n    \\\"text\\\" : \\\"rrf rrf rrf\\\",\\n    \\\"vector\\\" : [3],\\n    \\\"integer\\\": 1\\n}\\n\\nPUT example-index/_doc/4\\n{\\n    \\\"text\\\" : \\\"rrf rrf rrf rrf\\\",\\n    \\\"integer\\\": 2\\n}\\n\\nPUT example-index/_doc/5\\n{\\n    \\\"vector\\\" : [0],\\n    \\\"integer\\\": 1\\n}\\n\\nPOST example-index/_refresh\\n----\\n// TEST\\n\\nWe now execute a search using an `rrf` retriever with a `standard` retriever specifying a BM25 query, a `knn` retriever specifying a kNN search, and a terms aggregation.\\n\\n[source,console]\\n----\\nGET example-index/_search\\n{\\n    \\\"retriever\\\": {\\n        \\\"rrf\\\": {\\n            \\\"retrievers\\\": [\\n                {\\n                    \\\"standard\\\": {\\n                        \\\"query\\\": {\\n                            \\\"term\\\": {\\n                                \\\"text\\\": \\\"rrf\\\"\\n                            }\\n                        }\\n                    }\\n                },\\n                {\\n                    \\\"knn\\\": {\\n                        \\\"field\\\": \\\"vector\\\",\\n                        \\\"query_vector\\\": [3],\\n                        \\\"k\\\": 5,\\n                        \\\"num_candidates\\\": 5\\n                    }\\n                }\\n            ],\\n            \\\"rank_window_size\\\": 5,\\n            \\\"rank_constant\\\": 1\\n        }\\n    },\\n    \\\"size\\\": 3,\\n    \\\"aggs\\\": {\\n        \\\"int_count\\\": {\\n            \\\"terms\\\": {\\n                \\\"field\\\": \\\"integer\\\"\\n            }\\n        }\\n    }\\n}\\n----\\n// TEST[continued]\\n\\nAnd we receive the response with ranked `hits` and the terms aggregation result.\\nWe have both the ranker's `score` and the `_rank` option to show our top-ranked documents.\\n\\n[source,console-response]\\n----\\n{\\n    \\\"took\\\": ...,\\n    \\\"timed_out\\\" : false,\\n    \\\"_shards\\\" : {\\n        \\\"total\\\" : 1,\\n        \\\"successful\\\" : 1,\\n        \\\"skipped\\\" : 0,\\n        \\\"failed\\\" : 0\\n    },\\n    \\\"hits\\\" : {\\n        \\\"total\\\" : {\\n            \\\"value\\\" : 5,\\n            \\\"relation\\\" : \\\"eq\\\"\\n        },\\n        \\\"max_score\\\" : ...,\\n        \\\"hits\\\" : [\\n            {\\n                \\\"_index\\\" : \\\"example-index\\\",\\n                \\\"_id\\\" : \\\"3\\\",\\n                \\\"_score\\\" : 0.8333334,\\n                \\\"_source\\\" : {\\n                    \\\"integer\\\" : 1,\\n                    \\\"vector\\\" : [\\n                        3\\n                    ],\\n                    \\\"text\\\" : \\\"rrf rrf rrf\\\"\\n                }\\n            },\\n            {\\n                \\\"_index\\\" : \\\"example-index\\\",\\n                \\\"_id\\\" : \\\"2\\\",\\n                \\\"_score\\\" : 0.5833334,\\n                \\\"_source\\\" : {\\n                    \\\"integer\\\" : 2,\\n                    \\\"vector\\\" : [\\n                        4\\n                    ],\\n                    \\\"text\\\" : \\\"rrf rrf\\\"\\n                }\\n            },\\n            {\\n                \\\"_index\\\" : \\\"example-index\\\",\\n                \\\"_id\\\" : \\\"4\\\",\\n                \\\"_score\\\" : 0.5,\\n                \\\"_source\\\" : {\\n                    \\\"integer\\\" : 2,\\n                    \\\"text\\\" : \\\"rrf rrf rrf rrf\\\"\\n                }\\n            }\\n        ]\\n    },\\n    \\\"aggregations\\\" : {\\n        \\\"int_count\\\" : {\\n            \\\"doc_count_error_upper_bound\\\" : 0,\\n            \\\"sum_other_doc_count\\\" : 0,\\n            \\\"buckets\\\" : [\\n                {\\n                    \\\"key\\\" : 1,\\n                    \\\"doc_count\\\" : 3\\n                },\\n                {\\n                    \\\"key\\\" : 2,\\n                    \\\"doc_count\\\" : 2\\n                }\\n            ]\\n        }\\n    }\\n}\\n----\\n// TESTRESPONSE[s/: \\\\.\\\\.\\\\./: $body.$_path/]\\n\\nLet's break down how these hits were ranked.\\nWe start by running the `standard` retriever specifying a query and the `knn` retriever specifying a kNN search separately to collect what their individual hits are.\\n\\nFirst, we look at the hits for the query from the `standard` retriever.\\n\\n[source,console-result]\\n----\\n\\\"hits\\\" : [\\n    {\\n        \\\"_index\\\" : \\\"example-index\\\",\\n        \\\"_id\\\" : \\\"4\\\",\\n        \\\"_score\\\" : 0.16152832,              <1>\\n        \\\"_source\\\" : {\\n            \\\"integer\\\" : 2,\\n            \\\"text\\\" : \\\"rrf rrf rrf rrf\\\"\\n        }\\n    },\\n    {\\n        \\\"_index\\\" : \\\"example-index\\\",\\n        \\\"_id\\\" : \\\"3\\\",                        <2>\\n        \\\"_score\\\" : 0.15876243,\\n        \\\"_source\\\" : {\\n            \\\"integer\\\" : 1,\\n            \\\"vector\\\" : [3],\\n            \\\"text\\\" : \\\"rrf rrf rrf\\\"\\n        }\\n    },\\n    {\\n        \\\"_index\\\" : \\\"example-index\\\",\\n        \\\"_id\\\" : \\\"2\\\",                        <3>\\n        \\\"_score\\\" : 0.15350538,\\n        \\\"_source\\\" : {\\n            \\\"integer\\\" : 2,\\n            \\\"vector\\\" : [4],\\n            \\\"text\\\" : \\\"rrf rrf\\\"\\n        }\\n    },\\n    {\\n        \\\"_index\\\" : \\\"example-index\\\",\\n        \\\"_id\\\" : \\\"1\\\",                        <4>\\n        \\\"_score\\\" : 0.13963442,\\n        \\\"_source\\\" : {\\n            \\\"integer\\\" : 1,\\n            \\\"vector\\\" : [5],\\n            \\\"text\\\" : \\\"rrf\\\"\\n        }\\n    }\\n]\\n----\\n// TEST[skip:example fragment]\\n<1> rank 1, `_id` 4\\n<2> rank 2, `_id` 3\\n<3> rank 3, `_id` 2\\n<4> rank 4, `_id` 1\\n\\nNote that our first hit doesn't have a value for the `vector` field.\\nNow, we look at the results for the kNN search from the `knn` retriever.\\n\\n[source,console-result]\\n----\\n\\\"hits\\\" : [\\n    {\\n        \\\"_index\\\" : \\\"example-index\\\",\\n        \\\"_id\\\" : \\\"3\\\",                   <1>\\n        \\\"_score\\\" : 1.0,\\n        \\\"_source\\\" : {\\n            \\\"integer\\\" : 1,\\n            \\\"vector\\\" : [3],\\n            \\\"text\\\" : \\\"rrf rrf rrf\\\"\\n        }\\n    },\\n    {\\n        \\\"_index\\\" : \\\"example-index\\\",\\n        \\\"_id\\\" : \\\"2\\\",                   <2>\\n        \\\"_score\\\" : 0.5,\\n        \\\"_source\\\" : {\\n            \\\"integer\\\" : 2,\\n            \\\"vector\\\" : [4],\\n            \\\"text\\\" : \\\"rrf rrf\\\"\\n        }\\n    },\\n    {\\n        \\\"_index\\\" : \\\"example-index\\\",\\n        \\\"_id\\\" : \\\"1\\\",                   <3>\\n        \\\"_score\\\" : 0.2,\\n        \\\"_source\\\" : {\\n            \\\"integer\\\" : 1,\\n            \\\"vector\\\" : [5],\\n            \\\"text\\\" : \\\"rrf\\\"\\n        }\\n    },\\n    {\\n        \\\"_index\\\" : \\\"example-index\\\",\\n        \\\"_id\\\" : \\\"5\\\",                   <4>\\n        \\\"_score\\\" : 0.1,\\n        \\\"_source\\\" : {\\n            \\\"integer\\\" : 1,\\n            \\\"vector\\\" : [0]\\n        }\\n    }\\n]\\n----\\n// TEST[skip:example fragment]\\n<1> rank 1, `_id` 3\\n<2> rank 2, `_id` 2\\n<3> rank 3, `_id` 1\\n<4> rank 4, `_id` 5\\n\\nWe can now take the two individually ranked result sets and apply the RRF formula to them using parameters from the `rrf` retriever to get our final ranking.\\n\\n[source,python]\\n----\\n# doc  | query     | knn       | score\\n_id: 1 = 1.0/(1+4) + 1.0/(1+3) = 0.4500\\n_id: 2 = 1.0/(1+3) + 1.0/(1+2) = 0.5833\\n_id: 3 = 1.0/(1+2) + 1.0/(1+1) = 0.8333\\n_id: 4 = 1.0/(1+1)             = 0.5000\\n_id: 5 =             1.0/(1+4) = 0.2000\\n----\\n// NOTCONSOLE\\n\\nWe rank the documents based on the RRF formula with a `rank_window_size` of `5` truncating the bottom `2` docs in our RRF result set with a `size` of `3`.\\nWe end with `_id: 3` as `_rank: 1`, `_id: 2` as `_rank: 2`, and `_id: 4` as `_rank: 3`.\\nThis ranking matches the result set from the original RRF search as expected.\\n\\n==== Explain in RRF\\n\\nIn addition to individual query scoring details, we can make use of the `explain=true` parameter to get information on how the RRF scores for each document were computed.\\nWorking with the example above, and by adding `explain=true` to the search request, we'd now have a response that looks like the following:\\n\\n[source,js]\\n----\\n{\\n    \\\"hits\\\":\\n    [\\n        {\\n            \\\"_index\\\": \\\"example-index\\\",\\n            \\\"_id\\\": \\\"3\\\",\\n            \\\"_score\\\": 0.8333334,\\n            \\\"_explanation\\\":\\n            {\\n                \\\"value\\\": 0.8333334,                                                                                                                                               <1>\\n                \\\"description\\\": \\\"rrf score: [0.8333334] computed for initial ranks [2, 1] with rankConstant: [1] as sum of [1 / (rank + rankConstant)] for each query\\\",            <2>\\n                \\\"details\\\":                                                                                                                                                        <3>\\n                [\\n                    {\\n                        \\\"value\\\": 2,                                                                                                                                               <4>\\n                        \\\"description\\\": \\\"rrf score: [0.33333334], for rank [2] in query at index [0] computed as [1 / (2 + 1]), for matching query with score: \\\",\\n                        \\\"details\\\":                                                                                                                                                <5>\\n                        [\\n                            {\\n                                \\\"value\\\": 0.15876243,\\n                                \\\"description\\\": \\\"weight(text:rrf in 0) [PerFieldSimilarity], result of:\\\",\\n                                \\\"details\\\":\\n                                [\\n                                    ...\\n                                ]\\n                            }\\n                        ]\\n                    },\\n                    {\\n                        \\\"value\\\": 1,                                                                                                                                              <6>\\n                        \\\"description\\\": \\\"rrf score: [0.5], for rank [1] in query at index [1] computed as [1 / (1 + 1]), for matching query with score: \\\",\\n                        \\\"details\\\":\\n                        [\\n                            {\\n                                \\\"value\\\": 1,\\n                                \\\"description\\\": \\\"within top k documents\\\",\\n                                \\\"details\\\":\\n                                []\\n                            }\\n                        ]\\n                    }\\n                ]\\n            }\\n        }\\n        ...\\n    ]\\n}\\n----\\n// NOTCONSOLE\\n\\n<1> the final RRF score for document with `_id=3`\\n<2> a description on how this score was computed based on the ranks of this document in each individual query\\n<3> details on how the RRF score was computed for each of the queries\\n<4> the `value` heres specifies the `rank` of this document in the specific query\\n<5> standard `explain` output of the underlying query, describing matching terms and weights\\n<6> the `value` heres specifies the `rank` of this document for the second (`knn`) query\\n\\nIn addition to the above, explain in RRF also supports <<named-queries,named queries>> using the `_name` parameter.\\nUsing named queries allows for easier and more intuitive understanding of the RRF score computation, especially when dealing with multiple queries.\\nSo, we would now have:\\n\\n[source,js]\\n----\\nGET example-index/_search\\n{\\n    \\\"retriever\\\": {\\n        \\\"rrf\\\": {\\n            \\\"retrievers\\\": [\\n                {\\n                    \\\"standard\\\": {\\n                        \\\"query\\\": {\\n                            \\\"term\\\": {\\n                                \\\"text\\\": \\\"rrf\\\"\\n                            }\\n                        }\\n                    }\\n                },\\n                {\\n                    \\\"knn\\\": {\\n                        \\\"field\\\": \\\"vector\\\",\\n                        \\\"query_vector\\\": [3],\\n                        \\\"k\\\": 5,\\n                        \\\"num_candidates\\\": 5,\\n                        \\\"_name\\\": \\\"my_knn_query\\\"                           <1>\\n                    }\\n                }\\n            ],\\n            \\\"rank_window_size\\\": 5,\\n            \\\"rank_constant\\\": 1\\n        }\\n    },\\n    \\\"size\\\": 3,\\n    \\\"aggs\\\": {\\n        \\\"int_count\\\": {\\n            \\\"terms\\\": {\\n                \\\"field\\\": \\\"integer\\\"\\n            }\\n        }\\n    }\\n}\\n----\\n// NOTCONSOLE\\n<1> Here we specify a `_name` for the `knn` retriever\\n\\nThe response would now include the named query in the explanation:\\n\\n[source,js]\\n----\\n{\\n    \\\"hits\\\":\\n    [\\n        {\\n            \\\"_index\\\": \\\"example-index\\\",\\n            \\\"_id\\\": \\\"3\\\",\\n            \\\"_score\\\": 0.8333334,\\n            \\\"_explanation\\\":\\n            {\\n                \\\"value\\\": 0.8333334,\\n                \\\"description\\\": \\\"rrf score: [0.8333334] computed for initial ranks [2, 1] with rankConstant: [1] as sum of [1 / (rank + rankConstant)] for each query\\\",\\n                \\\"details\\\":\\n                [\\n                    {\\n                        \\\"value\\\": 2,\\n                        \\\"description\\\": \\\"rrf score: [0.33333334], for rank [2] in query at index [0] computed as [1 / (2 + 1]), for matching query with score: \\\",\\n                        \\\"details\\\":\\n                        [\\n                            ...\\n                        ]\\n                    },\\n                    {\\n                        \\\"value\\\": 1,\\n                        \\\"description\\\": \\\"rrf score: [0.5], for rank [1] in query [my_knn_query] computed as [1 / (1 + 1]), for matching query with score: \\\",                      <1>\\n                        \\\"details\\\":\\n                        [\\n                           ...\\n                        ]\\n                    }\\n                ]\\n            }\\n        }\\n        ...\\n    ]\\n}\\n----\\n// NOTCONSOLE\\n<1> Instead of the anonymous `at index n` , we now have a reference to the named query `my_knn_query`.\\n\\n==== Pagination in RRF\\n\\nWhen using `rrf` you can paginate through the results using the `from` parameter.\\nAs the final ranking is solely dependent on the original query ranks, to ensure consistency when paginating, we have to make sure that while `from` changes, the order of what we have already seen remains intact.\\nTo that end, we're using a fixed `rank_window_size` as the whole available result set upon which we can paginate.\\nThis essentially means that if:\\n\\n* `from + size` &le; `rank_window_size` : we could get  `results[from: from+size]` documents back from the final `rrf` ranked result set\\n\\n* `from + size` &gt; `rank_window_size` : we would get 0 results back, as the request would fall outside the available `rank_window_size`-sized result set.\\n\\nAn important thing to note here is that since `rank_window_size` is all the results that we'll get to see from the individual query components, pagination guarantees consistency, i.e. no documents are skipped or duplicated in multiple pages, iff `rank_window_size` remains the same.\\nIf `rank_window_size` changes, then the order of the results might change as well, even for the same ranks.\\n\\nTo illustrate all of the above, let's consider the following simplified example where we have two queries, `queryA` and `queryB` and their ranked documents:\\n\\n[source,python]\\n----\\n     |  queryA   |  queryB    |\\n_id: |  1        |  5         |\\n_id: |  2        |  4         |\\n_id: |  3        |  3         |\\n_id: |  4        |  1         |\\n_id: |           |  2         |\\n----\\n// NOTCONSOLE\\n\\nFor `rank_window_size=5` we would get to see all documents from both `queryA` and `queryB`.\\nAssuming a `rank_constant=1`, the `rrf` scores would be:\\n\\n[source,python]\\n----\\n# doc   | queryA     | queryB       | score\\n_id: 1 =  1.0/(1+1)  + 1.0/(1+4)      = 0.7\\n_id: 2 =  1.0/(1+2)  + 1.0/(1+5)      = 0.5\\n_id: 3 =  1.0/(1+3)  + 1.0/(1+3)      = 0.5\\n_id: 4 =  1.0/(1+4)  + 1.0/(1+2)      = 0.533\\n_id: 5 =    0        + 1.0/(1+1)      = 0.5\\n----\\n// NOTCONSOLE\\n\\nSo the final ranked result set would be [`1`, `4`, `2`, `3`, `5`] and we would paginate over that, since `rank_window_size == len(results)`.\\nIn this scenario, we would have:\\n\\n* `from=0, size=2` would return documents [`1`, `4`] with ranks `[1, 2]`\\n* `from=2, size=2` would return documents [`2`, `3`] with ranks `[3, 4]`\\n* `from=4, size=2` would return document [`5`] with rank `[5]`\\n* `from=6, size=2` would return an empty result set as it there are no more results to iterate over\\n\\nNow, if we had a `rank_window_size=2`, we would only get to see `[1, 2]` and `[5, 4]` documents for queries `queryA` and `queryB` respectively.\\nWorking out the math, we would see that the results would now be slightly different, because we would have no knowledge of the documents in positions `[3: end]` for either query.\\n\\n[source,python]\\n----\\n# doc   | queryA     | queryB         | score\\n_id: 1 =  1.0/(1+1)  + 0              = 0.5\\n_id: 2 =  1.0/(1+2)  + 0              = 0.33\\n_id: 4 =    0        + 1.0/(1+2)      = 0.33\\n_id: 5 =    0        + 1.0/(1+1)      = 0.5\\n----\\n// NOTCONSOLE\\n\\nThe final ranked result set would be [`1`, `5`, `2`, `4`], and we would be able to paginate on the top `rank_window_size` results, i.e. [`1`, `5`].\\nSo for the same params as above, we would now have:\\n\\n* `from=0, size=2` would return [`1`, `5`] with ranks `[1, 2]`\\n* `from=2, size=2` would return an empty result set as it would fall outside the available `rank_window_size` results.\\n\",\"timestamp\":1762428066209,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"message\",\"role\":\"assistant\",\"id\":\"20ff3594-f2ce-4ac1-b4a0-cc38684004a6\",\"text\":\"Perfect! I found the tech-preview headers in both documentation files. Now let me update the TODO list and explore what other files might need changes:\",\"timestamp\":1762428078098,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_call\",\"id\":\"toolu_01NRrxZUTbXuTDUMdDVvc7iN\",\"messageId\":\"20ff3594-f2ce-4ac1-b4a0-cc38684004a6\",\"toolId\":\"TodoWrite\",\"toolName\":\"TodoWrite\",\"parameters\":{\"todos\":[{\"id\":\"1\",\"content\":\"Explore codebase to find tech-preview headers related to retrievers and RRF\",\"status\":\"completed\",\"priority\":\"high\"},{\"id\":\"2\",\"content\":\"Find documentation files for retrievers and RRF\",\"status\":\"completed\",\"priority\":\"high\"},{\"id\":\"3\",\"content\":\"Remove tech-preview header from docs/reference/search/retriever.asciidoc\",\"status\":\"in_progress\",\"priority\":\"high\"},{\"id\":\"4\",\"content\":\"Remove tech-preview header from docs/reference/search/rrf.asciidoc\",\"status\":\"pending\",\"priority\":\"high\"},{\"id\":\"5\",\"content\":\"Check for any related documentation that references tech-preview status\",\"status\":\"pending\",\"priority\":\"medium\"},{\"id\":\"6\",\"content\":\"Verify all changes are complete\",\"status\":\"pending\",\"priority\":\"medium\"}]},\"timestamp\":1762428078098,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_call\",\"id\":\"toolu_019YiVoNaZrgyYu4UyMik731\",\"messageId\":\"20ff3594-f2ce-4ac1-b4a0-cc38684004a6\",\"toolId\":\"Grep\",\"toolName\":\"Grep\",\"parameters\":{\"pattern\":\"retrievers.*technical preview|retrievers.*tech preview\",\"case_insensitive\":true,\"output_mode\":\"content\",\"line_numbers\":true},\"timestamp\":1762428078098,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_call\",\"id\":\"toolu_01MkCE4XUtj5XhXvJaHrFsyt\",\"messageId\":\"20ff3594-f2ce-4ac1-b4a0-cc38684004a6\",\"toolId\":\"Grep\",\"toolName\":\"Grep\",\"parameters\":{\"pattern\":\"RRF.*technical preview|RRF.*tech preview\",\"case_insensitive\":true,\"output_mode\":\"content\",\"line_numbers\":true},\"timestamp\":1762428078098,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_result\",\"id\":\"toolu_01NRrxZUTbXuTDUMdDVvc7iN\",\"messageId\":\"402ccb9a-1828-47ab-9797-146df455fbe0\",\"toolId\":\"TodoWrite\",\"isError\":false,\"value\":\"TODO List Updated\",\"timestamp\":1762428078642,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_result\",\"id\":\"toolu_019YiVoNaZrgyYu4UyMik731\",\"messageId\":\"402ccb9a-1828-47ab-9797-146df455fbe0\",\"toolId\":\"Grep\",\"isError\":false,\"value\":\"No matches found\",\"timestamp\":1762428078642,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_result\",\"id\":\"toolu_01MkCE4XUtj5XhXvJaHrFsyt\",\"messageId\":\"402ccb9a-1828-47ab-9797-146df455fbe0\",\"toolId\":\"Grep\",\"isError\":false,\"value\":\"No matches found\",\"timestamp\":1762428078642,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_result\",\"id\":\"toolu_01NFPcuPgqaGGpwFLGqvSnWj\",\"messageId\":\"e76f8751-d51e-4bb1-8107-d34a18b35dc0\",\"toolId\":\"\",\"isError\":false,\"value\":\"[[retrievers-overview]]\\n=== Retrievers\\n\\npreview::[]\\n\\nA retriever is an abstraction that was added to the Search API in *8.14.0*.\\nThis abstraction enables the configuration of multi-stage retrieval pipelines within a single `_search` call.\\nThis simplifies your search application logic, because you no longer need to configure complex searches via multiple {es} calls or implement additional client-side logic to combine results from different queries.\\n\\nThis document provides a general overview of the retriever abstraction.\\nFor implementation details, including notable restrictions, check out the\\n<<retriever,reference documentation>> in the `_search` API docs.\\n\\n[discrete]\\n[[retrievers-overview-types]]\\n==== Retriever types\\n\\nRetrievers come in various types, each tailored for different search operations.\\nThe following retrievers are currently available:\\n\\n* <<standard-retriever,*Standard Retriever*>>. Returns top documents from a\\ntraditional https://www.elastic.co/guide/en/elasticsearch/reference/master/query-dsl.html[query].\\nMimics a traditional query but in the context of a retriever framework. This\\nensures backward compatibility as existing `_search` requests remain supported.\\nThat way you can transition to the new abstraction at your own pace without\\nmixing syntaxes.\\n* <<knn-retriever,*kNN Retriever*>>. Returns top documents from a <<search-api-knn,knn search>>,\\nin the context of a retriever framework.\\n* <<rrf-retriever,*RRF Retriever*>>. Combines and ranks multiple first-stage retrievers using\\nthe reciprocal rank fusion (RRF) algorithm. Allows you to combine multiple result sets\\nwith different relevance indicators into a single result set.\\nAn RRF retriever is a *compound retriever*, where its `filter` element is\\npropagated to its sub retrievers.\\n+\\nSub retrievers may not use elements that are restricted by having a compound retriever as part of the retriever tree.\\nSee the <<rrf-using-multiple-standard-retrievers,RRF documentation>> for detailed examples and information on how to use the RRF retriever.\\n* <<text-similarity-reranker-retriever,*Text Similarity Re-ranker Retriever*>>. Used for <<semantic-reranking,semantic reranking>>.\\nRequires first creating a `rerank` task using the <<put-inference-api,{es} Inference API>>.\\n\\n[discrete]\\n==== What makes retrievers useful?\\n\\nHere's an overview of what makes retrievers useful and how they differ from regular queries.\\n\\n. *Simplified user experience*.\\nRetrievers simplify the user experience by allowing entire retrieval pipelines to be configured in a single API call.\\nThis maintains backward compatibility with traditional query elements by automatically translating them to the appropriate retriever.\\n. *Structured retrieval*.\\nRetrievers provide a more structured way to define search operations.\\nThey allow searches to be described using a \\\"retriever tree\\\", a hierarchical structure that clarifies the sequence and logic of operations, making complex searches more understandable and manageable.\\n. *Composability and flexibility*.\\nRetrievers enable flexible composability, allowing you to build pipelines and seamlessly integrate different retrieval strategies into these pipelines.\\nRetrievers make it easy to test out different retrieval strategy combinations.\\n. *Compound operations*.\\nA retriever can have sub retrievers.\\nThis allows complex nested searches where the results of one retriever feed into another, supporting sophisticated querying strategies that might involve multiple stages or criteria.\\n. *Retrieval as a first-class concept*.\\nUnlike traditional queries, where the query is a part of a larger search API call, retrievers are designed as standalone entities that can be combined or used in isolation.\\nThis enables a more modular and flexible approach to constructing searches.\\n. *Enhanced control over document scoring and ranking*.\\nRetrievers allow for more explicit control over how documents are scored and filtered.\\nFor instance, you can specify minimum score thresholds, apply complex filters without affecting scoring, and use parameters like `terminate_after` for performance optimizations.\\n. *Integration with existing {es} functionalities*.\\nEven though retrievers can be used instead of existing `_search` API syntax (like the\\n`query` and `knn`), they are designed to integrate seamlessly with things like pagination (`search_after`) and sorting.\\nThey also maintain compatibility with aggregation operations by treating the combination of all leaf retrievers as\\n`should` clauses in a boolean query.\\n. *Cleaner separation of concerns*.\\nWhen using compound retrievers, only the query element is allowed, which enforces a cleaner separation of concerns and prevents the complexity that might arise from overly nested or interdependent configurations.\\n\\n[discrete]\\n[[retrievers-overview-example]]\\n==== Example\\n\\nThe following example demonstrates how using retrievers simplify the composability of queries for RRF ranking.\\n\\n[source,js]\\n----\\nGET example-index/_search\\n{\\n  \\\"retriever\\\": {\\n    \\\"rrf\\\": {\\n      \\\"retrievers\\\": [\\n        {\\n          \\\"standard\\\": {\\n            \\\"query\\\": {\\n              \\\"sparse_vector\\\": {\\n                \\\"field\\\": \\\"vector.tokens\\\",\\n                \\\"inference_id\\\": \\\"my-elser-endpoint\\\",\\n                \\\"query\\\": \\\"What blue shoes are on sale?\\\"\\n              }\\n            }\\n          }\\n        },\\n        {\\n          \\\"standard\\\": {\\n            \\\"query\\\": {\\n              \\\"match\\\": {\\n                \\\"text\\\": \\\"blue shoes sale\\\"\\n              }\\n            }\\n          }\\n        }\\n      ]\\n    }\\n  }\\n}\\n----\\n//NOTCONSOLE\\n\\nThis example demonstrates how you can combine different retrieval strategies into a single `retriever` pipeline.\\n\\nCompare to `RRF` with `sub_searches` approach:\\n\\n.*Expand* for example\\n[%collapsible]\\n==============\\n\\n[source,js]\\n----\\nGET example-index/_search\\n{\\n  \\\"sub_searches\\\":[\\n    {\\n      \\\"query\\\":{\\n        \\\"match\\\":{\\n          \\\"text\\\":\\\"blue shoes sale\\\"\\n        }\\n      }\\n    },\\n    {\\n      \\\"query\\\":{\\n        \\\"sparse_vector\\\": {\\n            \\\"field\\\": \\\"vector.tokens\\\",\\n            \\\"inference_id\\\": \\\"my-elser-endoint\\\",\\n            \\\"query\\\": \\\"What blue shoes are on sale?\\\"\\n          }\\n        }\\n      }\\n  ],\\n  \\\"rank\\\":{\\n    \\\"rrf\\\":{\\n      \\\"rank_window_size\\\":50,\\n      \\\"rank_constant\\\":20\\n    }\\n  }\\n}\\n----\\n//NOTCONSOLE\\n==============\\n\\n[discrete]\\n[[retrievers-overview-glossary]]\\n==== Glossary\\n\\nHere are some important terms:\\n\\n* *Retrieval Pipeline*. Defines the entire retrieval and ranking logic to\\nproduce top hits.\\n* *Retriever Tree*. A hierarchical structure that defines how retrievers interact.\\n* *First-stage Retriever*. Returns an initial set of candidate documents.\\n* *Compound Retriever*. Builds on one or more retrievers,\\nenhancing document retrieval and ranking logic.\\n* *Combiners*. Compound retrievers that merge top hits\\nfrom multiple sub-retrievers.\\n* *Rerankers*. Special compound retrievers that reorder hits and may adjust the number of hits, with distinctions between first-stage and second-stage rerankers.\\n\\n[discrete]\\n[[retrievers-overview-play-in-search]]\\n==== Retrievers in action\\n\\nThe Search Playground builds Elasticsearch queries using the retriever abstraction.\\nIt automatically detects the fields and types in your index and builds a retriever tree based on your selections.\\n\\nYou can use the Playground to experiment with different retriever configurations and see how they affect search results.\\n\\nRefer to the {kibana-ref}/playground.html[Playground documentation] for more information.\\n\\n[discrete]\\n[[retrievers-overview-api-reference]]\\n==== API reference\\n\\nFor implementation details, including notable restrictions, check out the <<retriever,reference documentation>> in the Search API docs.\\n\",\"timestamp\":1762428086314,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_result\",\"id\":\"toolu_0196RX8H3b3QYKVxt1XKeZNe\",\"messageId\":\"e76f8751-d51e-4bb1-8107-d34a18b35dc0\",\"toolId\":\"\",\"isError\":false,\"value\":\"./reranking/semantic-reranking.asciidoc-2-== Semantic re-ranking\\n./reranking/semantic-reranking.asciidoc-3-\\n./reranking/semantic-reranking.asciidoc:4:preview::[]\\n./reranking/semantic-reranking.asciidoc-5-\\n./reranking/semantic-reranking.asciidoc-6-[TIP]\\n--\\n./rest-api/security/bulk-delete-roles.asciidoc-2-[[security-api-bulk-delete-role]]\\n./rest-api/security/bulk-delete-roles.asciidoc-3-=== Bulk delete roles API\\n./rest-api/security/bulk-delete-roles.asciidoc:4:preview::[]\\n./rest-api/security/bulk-delete-roles.asciidoc-5-++++\\n./rest-api/security/bulk-delete-roles.asciidoc-6-<titleabbrev>Bulk delete roles API</titleabbrev>\\n--\\n./rest-api/security/bulk-create-roles.asciidoc-2-[[security-api-bulk-put-role]]\\n./rest-api/security/bulk-create-roles.asciidoc-3-=== Bulk create or update roles API\\n./rest-api/security/bulk-create-roles.asciidoc:4:preview::[]\\n./rest-api/security/bulk-create-roles.asciidoc-5-++++\\n./rest-api/security/bulk-create-roles.asciidoc-6-<titleabbrev>Bulk create or update roles API</titleabbrev>\\n--\\n./aggregations/metrics/geoline-aggregation.asciidoc-306-==== Grouping with time-series\\n./aggregations/metrics/geoline-aggregation.asciidoc-307-\\n./aggregations/metrics/geoline-aggregation.asciidoc:308:preview::[]\\n./aggregations/metrics/geoline-aggregation.asciidoc-309-\\n./aggregations/metrics/geoline-aggregation.asciidoc-310-Using the same data as before, we can also perform the grouping with a\\n--\\n./esql/functions/layout/qstr.asciidoc-5-=== `QSTR`\\n./esql/functions/layout/qstr.asciidoc-6-\\n./esql/functions/layout/qstr.asciidoc:7:preview::[\\\"Do not use `VALUES` on production environments. This functionality is in technical preview and may be changed or removed in a future release. Elastic will work to fix any issues, but features in technical preview are not subject to the support SLA of official GA features.\\\"]\\n./esql/functions/layout/qstr.asciidoc-8-\\n./esql/functions/layout/qstr.asciidoc-9-*Syntax*\\n--\\n./esql/functions/layout/match.asciidoc-5-=== `MATCH`\\n./esql/functions/layout/match.asciidoc-6-\\n./esql/functions/layout/match.asciidoc:7:preview::[\\\"Do not use on production environments. This functionality is in technical preview and may be changed or removed in a future release. Elastic will work to fix any issues, but features in technical preview are not subject to the support SLA of official GA features.\\\"]\\n./esql/functions/layout/match.asciidoc-8-\\n./esql/functions/layout/match.asciidoc-9-*Syntax*\\n--\\n./esql/functions/layout/to_date_nanos.asciidoc-5-=== `TO_DATE_NANOS`\\n./esql/functions/layout/to_date_nanos.asciidoc-6-\\n./esql/functions/layout/to_date_nanos.asciidoc:7:preview::[\\\"Do not use `VALUES` on production environments. This functionality is in technical preview and may be changed or removed in a future release. Elastic will work to fix any issues, but features in technical preview are not subject to the support SLA of official GA features.\\\"]\\n./esql/functions/layout/to_date_nanos.asciidoc-8-\\n./esql/functions/layout/to_date_nanos.asciidoc-9-*Syntax*\\n--\\n./esql/functions/layout/values.asciidoc-5-=== `VALUES`\\n./esql/functions/layout/values.asciidoc-6-\\n./esql/functions/layout/values.asciidoc:7:preview::[\\\"Do not use `VALUES` on production environments. This functionality is in technical preview and may be changed or removed in a future release. Elastic will work to fix any issues, but features in technical preview are not subject to the support SLA of official GA features.\\\"]\\n./esql/functions/layout/values.asciidoc-8-\\n./esql/functions/layout/values.asciidoc-9-*Syntax*\\n--\\n./esql/esql-across-clusters.asciidoc-7-[partintro]\\n./esql/esql-across-clusters.asciidoc-8-\\n./esql/esql-across-clusters.asciidoc:9:preview::[\\\"{ccs-cap} for {esql} is in technical preview and may be changed or removed in a future release. Elastic will work to fix any issues, but features in technical preview are not subject to the support SLA of official GA features.\\\"]\\n./esql/esql-across-clusters.asciidoc-10-\\n./esql/esql-across-clusters.asciidoc-11-[NOTE]\\n--\\n./esql/processing-commands/mv_expand.asciidoc-3-=== `MV_EXPAND`\\n./esql/processing-commands/mv_expand.asciidoc-4-\\n./esql/processing-commands/mv_expand.asciidoc:5:preview::[]\\n./esql/processing-commands/mv_expand.asciidoc-6-\\n./esql/processing-commands/mv_expand.asciidoc-7-The `MV_EXPAND` processing command expands multivalued columns into one row per\\n--\\n./query-rules/apis/test-query-ruleset.asciidoc-9-Evaluates match criteria against a query ruleset to identify the rules that would match that criteria.\\n./query-rules/apis/test-query-ruleset.asciidoc-10-\\n./query-rules/apis/test-query-ruleset.asciidoc:11:preview::[]\\n./query-rules/apis/test-query-ruleset.asciidoc-12-\\n./query-rules/apis/test-query-ruleset.asciidoc-13-[[test-query-ruleset-request]]\\n--\\n./aggregations/bucket/time-series-aggregation.asciidoc-5-++++\\n./aggregations/bucket/time-series-aggregation.asciidoc-6-\\n./aggregations/bucket/time-series-aggregation.asciidoc:7:preview::[]\\n./aggregations/bucket/time-series-aggregation.asciidoc-8-\\n./aggregations/bucket/time-series-aggregation.asciidoc-9-The time series aggregation queries data created using a time series index. This is typically data such as metrics\\n--\\n./query-dsl/weighted-tokens-query.asciidoc-7-\\n./query-dsl/weighted-tokens-query.asciidoc-8-deprecated[8.15.0, This query has been replaced by the <<query-dsl-sparse-vector-query>> and will be removed in an upcoming release.]\\n./query-dsl/weighted-tokens-query.asciidoc:9:preview::[]\\n./query-dsl/weighted-tokens-query.asciidoc-10-\\n./query-dsl/weighted-tokens-query.asciidoc-11-The weighted tokens query requires a list of token-weight pairs that are sent in with a query rather than calculated using a {nlp} model.\\n--\\n./connector/apis/claim-connector-sync-job-api.asciidoc-5-++++\\n./connector/apis/claim-connector-sync-job-api.asciidoc-6-\\n./connector/apis/claim-connector-sync-job-api.asciidoc:7:preview::[]\\n./connector/apis/claim-connector-sync-job-api.asciidoc-8-\\n./connector/apis/claim-connector-sync-job-api.asciidoc-9-Claims a connector sync job.\\n--\\n./connector/apis/update-connector-error-api.asciidoc-5-++++\\n./connector/apis/update-connector-error-api.asciidoc-6-\\n./connector/apis/update-connector-error-api.asciidoc:7:preview::[]\\n./connector/apis/update-connector-error-api.asciidoc-8-\\n./connector/apis/update-connector-error-api.asciidoc-9-Updates the `error` field of a connector.\\n--\\n./connector/apis/check-in-connector-sync-job-api.asciidoc-5-++++\\n./connector/apis/check-in-connector-sync-job-api.asciidoc-6-\\n./connector/apis/check-in-connector-sync-job-api.asciidoc:7:preview::[]\\n./connector/apis/check-in-connector-sync-job-api.asciidoc-8-\\n./connector/apis/check-in-connector-sync-job-api.asciidoc-9-Checks in a connector sync job (updates `last_seen` to the current time).\\n--\\n./connector/apis/update-connector-status-api.asciidoc-5-++++\\n./connector/apis/update-connector-status-api.asciidoc-6-\\n./connector/apis/update-connector-status-api.asciidoc:7:preview::[]\\n./connector/apis/update-connector-status-api.asciidoc-8-\\n./connector/apis/update-connector-status-api.asciidoc-9-Updates the `status` of a connector.\\n--\\n./connector/apis/update-connector-last-sync-api.asciidoc-5-++++\\n./connector/apis/update-connector-last-sync-api.asciidoc-6-\\n./connector/apis/update-connector-last-sync-api.asciidoc:7:preview::[]\\n./connector/apis/update-connector-last-sync-api.asciidoc-8-\\n./connector/apis/update-connector-last-sync-api.asciidoc-9-Updates the fields related to the last sync of a connector.\\n--\\n./connector/apis/check-in-connector-api.asciidoc-5-++++\\n./connector/apis/check-in-connector-api.asciidoc-6-\\n./connector/apis/check-in-connector-api.asciidoc:7:preview::[]\\n./connector/apis/check-in-connector-api.asciidoc-8-\\n./connector/apis/check-in-connector-api.asciidoc-9-Updates the `last_seen` field of a connector with current timestamp.\\n--\\n./connector/apis/connector-apis.asciidoc-83-=== Service APIs\\n./connector/apis/connector-apis.asciidoc-84-\\n./connector/apis/connector-apis.asciidoc:85:preview::[]\\n./connector/apis/connector-apis.asciidoc-86-\\n./connector/apis/connector-apis.asciidoc-87-*Connector Service APIs* are a subset of Connector API endpoints, that represent framework-level operations defined in the https://github.com/elastic/connectors/blob/main/docs/CONNECTOR_PROTOCOL.md[Connector Protocol]. These APIs are not intended for direct connector management by users but are there to support the implementation of services that utilize the Connector Protocol to communicate with {es}.\\n--\\n./connector/apis/set-connector-sync-job-error-api.asciidoc-5-++++\\n./connector/apis/set-connector-sync-job-error-api.asciidoc-6-\\n./connector/apis/set-connector-sync-job-error-api.asciidoc:7:preview::[]\\n./connector/apis/set-connector-sync-job-error-api.asciidoc-8-\\n./connector/apis/set-connector-sync-job-error-api.asciidoc-9-Sets a connector sync job error.\\n--\\n./connector/apis/set-connector-sync-job-stats-api.asciidoc-5-++++\\n./connector/apis/set-connector-sync-job-stats-api.asciidoc-6-\\n./connector/apis/set-connector-sync-job-stats-api.asciidoc:7:preview::[]\\n./connector/apis/set-connector-sync-job-stats-api.asciidoc-8-\\n./connector/apis/set-connector-sync-job-stats-api.asciidoc-9-Sets connector sync job stats.\\n--\\n./data-management.asciidoc-27-common lifecycle management needs.\\n./data-management.asciidoc-28-\\n./data-management.asciidoc:29:preview::[\\\"The built-in data stream lifecycle is in technical preview and may be changed or removed in a future release. Elastic will work to fix any issues, but this feature is not subject to the support SLA of official GA features.\\\"]\\n./data-management.asciidoc-30-\\n./data-management.asciidoc-31-**{ilm-init}** can be used to manage both indices and data streams and it allows you to:\\n--\\n./search/rrf.asciidoc-2-=== Reciprocal rank fusion\\n./search/rrf.asciidoc-3-\\n./search/rrf.asciidoc:4:preview::[\\\"This functionality is in technical preview and may be changed or removed in a future release. The syntax will likely change before GA. Elastic will work to fix any issues, but features in technical preview are not subject to the support SLA of official GA features.\\\"]\\n./search/rrf.asciidoc-5-\\n./search/rrf.asciidoc-6-https://plg.uwaterloo.ca/~gvcormac/cormacksigir09-rrf.pdf[Reciprocal rank fusion (RRF)]\\n--\\n./search/retriever.asciidoc-2-=== Retriever\\n./search/retriever.asciidoc-3-\\n./search/retriever.asciidoc:4:preview::[\\\"This functionality is in technical preview and may be changed or removed in a future release. The syntax will likely change before GA. Elastic will work to fix any issues, but features in technical preview are not subject to the support SLA of official GA features.\\\"]\\n./search/retriever.asciidoc-5-\\n./search/retriever.asciidoc-6-A retriever is a specification to describe top documents returned from a\\n--\\n./search/search-your-data/retrievers-overview.asciidoc-2-=== Retrievers\\n./search/search-your-data/retrievers-overview.asciidoc-3-\\n./search/search-your-data/retrievers-overview.asciidoc:4:preview::[]\\n./search/search-your-data/retrievers-overview.asciidoc-5-\\n./search/search-your-data/retrievers-overview.asciidoc-6-A retriever is an abstraction that was added to the Search API in *8.14.0*.\\n--\\n./setup/advanced-configuration.asciidoc-159-===== Enable the Elasticsearch TCP readiness port\\n./setup/advanced-configuration.asciidoc-160-\\n./setup/advanced-configuration.asciidoc:161:preview::[]\\n./setup/advanced-configuration.asciidoc-162-\\n./setup/advanced-configuration.asciidoc-163-If configured, a node can open a TCP port when the node is in a ready state. A node is deemed\\n--\\n./ingest/processors/geoip.asciidoc-76-`connection_type`. The fields actually added  depend on what has been found and which properties were configured in `properties`.\\n./ingest/processors/geoip.asciidoc-77-\\n./ingest/processors/geoip.asciidoc:78:preview::[\\\"Do not use the GeoIP2 Anonymous IP, GeoIP2 Connection Type, GeoIP2 Domain, GeoIP2 ISP, and GeoIP2 Enterprise databases in production environments. This functionality is in technical preview and may be changed or removed in a future release. Elastic will work to fix any issues, but features in technical preview are not subject to the support SLA of official GA features.\\\"]\\n./ingest/processors/geoip.asciidoc-79-\\n./ingest/processors/geoip.asciidoc-80-Here is an example that uses the default city database and adds the geographical information to the `geoip` field based on the `ip` field:\\n--\\n./ingest/apis/index.asciidoc-29-=== Ingest GeoIP Database APIs\\n./ingest/apis/index.asciidoc-30-\\n./ingest/apis/index.asciidoc:31:preview::[\\\"The commercial IP geolocation database download management APIs are in technical preview and may be changed or removed in a future release. Elastic will work to fix any issues, but this feature is not subject to the support SLA of official GA features.\\\"]\\n./ingest/apis/index.asciidoc-32-\\n./ingest/apis/index.asciidoc-33-Use the following APIs to configure and manage commercial IP geolocation database downloads:\\n--\\n./data-streams/data-stream-apis.asciidoc-16-The following APIs are available for managing the built-in lifecycle of data streams:\\n./data-streams/data-stream-apis.asciidoc-17-\\n./data-streams/data-stream-apis.asciidoc:18:preview::[]\\n./data-streams/data-stream-apis.asciidoc-19-\\n./data-streams/data-stream-apis.asciidoc-20-* <<data-streams-put-lifecycle,Update data stream lifecycle>> \\n--\\n./data-streams/logs.asciidoc-2-== Logs data stream\\n./data-streams/logs.asciidoc-3-\\n./data-streams/logs.asciidoc:4:preview::[Logs data streams and the logsdb index mode are in tech preview and may be changed or removed in the future. Don't use logs data streams or logsdb index mode in production.]\\n./data-streams/logs.asciidoc-5-\\n./data-streams/logs.asciidoc-6-A logs data stream is a data stream type that stores log data more efficiently.\\n--\\n./search-application/apis/search-application-render-query.asciidoc-3-=== Render Search Application Query\\n./search-application/apis/search-application-render-query.asciidoc-4-\\n./search-application/apis/search-application-render-query.asciidoc:5:preview::[]\\n./search-application/apis/search-application-render-query.asciidoc-6-\\n./search-application/apis/search-application-render-query.asciidoc-7-++++\",\"timestamp\":1762428086314,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"message\",\"role\":\"assistant\",\"id\":\"a66cc2a3-590c-4bea-b2e7-846f43f54964\",\"text\":\"Let me check the retrievers-overview and related documentation files:\",\"timestamp\":1762428086272,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_call\",\"id\":\"toolu_01NFPcuPgqaGGpwFLGqvSnWj\",\"messageId\":\"a66cc2a3-590c-4bea-b2e7-846f43f54964\",\"toolId\":\"Read\",\"toolName\":\"Read\",\"parameters\":{\"file_path\":\"/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpfnfjl2kw/workspace/docs/reference/search/search-your-data/retrievers-overview.asciidoc\"},\"timestamp\":1762428086272,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_call\",\"id\":\"toolu_0196RX8H3b3QYKVxt1XKeZNe\",\"messageId\":\"a66cc2a3-590c-4bea-b2e7-846f43f54964\",\"toolId\":\"Grep\",\"toolName\":\"Grep\",\"parameters\":{\"pattern\":\"preview::\",\"path\":\"/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpfnfjl2kw/workspace/docs/reference\",\"output_mode\":\"content\",\"line_numbers\":true,\"context\":2},\"timestamp\":1762428086272,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_result\",\"id\":\"toolu_01Lvkj6b85YRQaZ4czRKmxsA\",\"messageId\":\"e89d762a-d5f5-402d-9be0-aa00d4e1bf38\",\"toolId\":\"\",\"isError\":false,\"value\":\"{\\\"diffLines\\\":[{\\\"type\\\":\\\"unchanged\\\",\\\"content\\\":\\\"[[retriever]]\\\",\\\"lineNumber\\\":{\\\"old\\\":1,\\\"new\\\":1}},{\\\"type\\\":\\\"unchanged\\\",\\\"content\\\":\\\"=== Retriever\\\",\\\"lineNumber\\\":{\\\"old\\\":2,\\\"new\\\":2}},{\\\"type\\\":\\\"unchanged\\\",\\\"content\\\":\\\"\\\",\\\"lineNumber\\\":{\\\"old\\\":3,\\\"new\\\":3}},{\\\"type\\\":\\\"removed\\\",\\\"content\\\":\\\"preview::[\\\\\\\"This functionality is in technical preview and may be changed or removed in a future release. The syntax will likely change before GA. Elastic will work to fix any issues, but features in technical preview are not subject to the support SLA of official GA features.\\\\\\\"]\\\",\\\"lineNumber\\\":{\\\"old\\\":4}},{\\\"type\\\":\\\"removed\\\",\\\"content\\\":\\\"\\\",\\\"lineNumber\\\":{\\\"old\\\":5}},{\\\"type\\\":\\\"unchanged\\\",\\\"content\\\":\\\"A retriever is a specification to describe top documents returned from a\\\",\\\"lineNumber\\\":{\\\"old\\\":6,\\\"new\\\":4}},{\\\"type\\\":\\\"unchanged\\\",\\\"content\\\":\\\"search. A retriever replaces other elements of the <<search-search, search API>>\\\",\\\"lineNumber\\\":{\\\"old\\\":7,\\\"new\\\":5}},{\\\"type\\\":\\\"unchanged\\\",\\\"content\\\":\\\"that also return top documents such as <<query-dsl, `query`>> and\\\",\\\"lineNumber\\\":{\\\"old\\\":8,\\\"new\\\":6}}]}\",\"timestamp\":1762428097184,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"message\",\"role\":\"assistant\",\"id\":\"1be26c49-a7c2-43e4-91d1-9fba038dc351\",\"text\":\"Now I can see that there are several files with `preview::[]` tags. Let me focus on the ones related to retrievers and RRF. I found:\\n1. `/docs/reference/search/retriever.asciidoc` - has tech preview header\\n2. `/docs/reference/search/rrf.asciidoc` - has tech preview header  \\n3. `/docs/reference/search/search-your-data/retrievers-overview.asciidoc` - has `preview::[]` (empty, might need to be removed)\\n4. `/docs/reference/reranking/semantic-reranking.asciidoc` - has `preview::[]` (related but may be separate)\\n\\nLet me start removing the tech-preview headers from the retriever and RRF files:\",\"timestamp\":1762428097175,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_call\",\"id\":\"toolu_01Lvkj6b85YRQaZ4czRKmxsA\",\"messageId\":\"1be26c49-a7c2-43e4-91d1-9fba038dc351\",\"toolId\":\"Edit\",\"toolName\":\"Edit\",\"parameters\":{\"file_path\":\"/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpfnfjl2kw/workspace/docs/reference/search/retriever.asciidoc\",\"old_str\":\"[[retriever]]\\n=== Retriever\\n\\npreview::[\\\"This functionality is in technical preview and may be changed or removed in a future release. The syntax will likely change before GA. Elastic will work to fix any issues, but features in technical preview are not subject to the support SLA of official GA features.\\\"]\\n\\nA retriever is a specification to describe top documents returned from a\\nsearch.\",\"new_str\":\"[[retriever]]\\n=== Retriever\\n\\nA retriever is a specification to describe top documents returned from a\\nsearch.\"},\"timestamp\":1762428097175,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_result\",\"id\":\"toolu_01QxNXj39sR16Px3BMHfRJau\",\"messageId\":\"a3c48759-f7a1-44f3-83e1-9e2f4a6c3f1c\",\"toolId\":\"\",\"isError\":false,\"value\":\"TODO List Updated\",\"timestamp\":1762428108070,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_result\",\"id\":\"toolu_01UryqM3FbejL69w3qYVQi1N\",\"messageId\":\"a3c48759-f7a1-44f3-83e1-9e2f4a6c3f1c\",\"toolId\":\"\",\"isError\":false,\"value\":\"{\\\"diffLines\\\":[{\\\"type\\\":\\\"unchanged\\\",\\\"content\\\":\\\"[[rrf]]\\\",\\\"lineNumber\\\":{\\\"old\\\":1,\\\"new\\\":1}},{\\\"type\\\":\\\"unchanged\\\",\\\"content\\\":\\\"=== Reciprocal rank fusion\\\",\\\"lineNumber\\\":{\\\"old\\\":2,\\\"new\\\":2}},{\\\"type\\\":\\\"unchanged\\\",\\\"content\\\":\\\"\\\",\\\"lineNumber\\\":{\\\"old\\\":3,\\\"new\\\":3}},{\\\"type\\\":\\\"removed\\\",\\\"content\\\":\\\"preview::[\\\\\\\"This functionality is in technical preview and may be changed or removed in a future release. The syntax will likely change before GA. Elastic will work to fix any issues, but features in technical preview are not subject to the support SLA of official GA features.\\\\\\\"]\\\",\\\"lineNumber\\\":{\\\"old\\\":4}},{\\\"type\\\":\\\"removed\\\",\\\"content\\\":\\\"\\\",\\\"lineNumber\\\":{\\\"old\\\":5}},{\\\"type\\\":\\\"unchanged\\\",\\\"content\\\":\\\"https://plg.uwaterloo.ca/~gvcormac/cormacksigir09-rrf.pdf[Reciprocal rank fusion (RRF)]\\\",\\\"lineNumber\\\":{\\\"old\\\":6,\\\"new\\\":4}},{\\\"type\\\":\\\"unchanged\\\",\\\"content\\\":\\\"is a method for combining multiple result sets with different relevance indicators into a single result set.\\\",\\\"lineNumber\\\":{\\\"old\\\":7,\\\"new\\\":5}},{\\\"type\\\":\\\"unchanged\\\",\\\"content\\\":\\\"RRF requires no tuning, and the different relevance indicators do not have to be related to each other to achieve high-quality results.\\\",\\\"lineNumber\\\":{\\\"old\\\":8,\\\"new\\\":6}}]}\",\"timestamp\":1762428108070,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_call\",\"id\":\"toolu_01QxNXj39sR16Px3BMHfRJau\",\"messageId\":\"532518fa-d8e1-48d6-8dc5-697a1261261d\",\"toolId\":\"TodoWrite\",\"toolName\":\"TodoWrite\",\"parameters\":{\"todos\":[{\"id\":\"1\",\"content\":\"Explore codebase to find tech-preview headers related to retrievers and RRF\",\"status\":\"completed\",\"priority\":\"high\"},{\"id\":\"2\",\"content\":\"Find documentation files for retrievers and RRF\",\"status\":\"completed\",\"priority\":\"high\"},{\"id\":\"3\",\"content\":\"Remove tech-preview header from docs/reference/search/retriever.asciidoc\",\"status\":\"completed\",\"priority\":\"high\"},{\"id\":\"4\",\"content\":\"Remove tech-preview header from docs/reference/search/rrf.asciidoc\",\"status\":\"in_progress\",\"priority\":\"high\"},{\"id\":\"5\",\"content\":\"Remove preview::[] from docs/reference/search/search-your-data/retrievers-overview.asciidoc\",\"status\":\"pending\",\"priority\":\"high\"},{\"id\":\"6\",\"content\":\"Check semantic-reranking.asciidoc if it needs update\",\"status\":\"pending\",\"priority\":\"medium\"},{\"id\":\"7\",\"content\":\"Verify all changes are complete\",\"status\":\"pending\",\"priority\":\"medium\"}]},\"timestamp\":1762428108061,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_call\",\"id\":\"toolu_01UryqM3FbejL69w3qYVQi1N\",\"messageId\":\"532518fa-d8e1-48d6-8dc5-697a1261261d\",\"toolId\":\"Edit\",\"toolName\":\"Edit\",\"parameters\":{\"file_path\":\"/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpfnfjl2kw/workspace/docs/reference/search/rrf.asciidoc\",\"old_str\":\"[[rrf]]\\n=== Reciprocal rank fusion\\n\\npreview::[\\\"This functionality is in technical preview and may be changed or removed in a future release. The syntax will likely change before GA. Elastic will work to fix any issues, but features in technical preview are not subject to the support SLA of official GA features.\\\"]\\n\\nhttps://plg.uwaterloo.ca/~gvcormac/cormacksigir09-rrf.pdf[Reciprocal rank fusion (RRF)]\\nis a method for combining multiple result sets with different relevance indicators into a single result set.\",\"new_str\":\"[[rrf]]\\n=== Reciprocal rank fusion\\n\\nhttps://plg.uwaterloo.ca/~gvcormac/cormacksigir09-rrf.pdf[Reciprocal rank fusion (RRF)]\\nis a method for combining multiple result sets with different relevance indicators into a single result set.\"},\"timestamp\":1762428108061,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_result\",\"id\":\"toolu_0191BojrNMbGYVGibi7wdpaq\",\"messageId\":\"ab4277ee-1a4f-4a2a-ad39-093d14524d95\",\"toolId\":\"\",\"isError\":false,\"value\":\"TODO List Updated\",\"timestamp\":1762428115760,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_result\",\"id\":\"toolu_01Tji7qj4DSLTZNeVrHEAG1Z\",\"messageId\":\"ab4277ee-1a4f-4a2a-ad39-093d14524d95\",\"toolId\":\"\",\"isError\":false,\"value\":\"{\\\"diffLines\\\":[{\\\"type\\\":\\\"unchanged\\\",\\\"content\\\":\\\"[[retrievers-overview]]\\\",\\\"lineNumber\\\":{\\\"old\\\":1,\\\"new\\\":1}},{\\\"type\\\":\\\"unchanged\\\",\\\"content\\\":\\\"=== Retrievers\\\",\\\"lineNumber\\\":{\\\"old\\\":2,\\\"new\\\":2}},{\\\"type\\\":\\\"unchanged\\\",\\\"content\\\":\\\"\\\",\\\"lineNumber\\\":{\\\"old\\\":3,\\\"new\\\":3}},{\\\"type\\\":\\\"removed\\\",\\\"content\\\":\\\"preview::[]\\\",\\\"lineNumber\\\":{\\\"old\\\":4}},{\\\"type\\\":\\\"removed\\\",\\\"content\\\":\\\"\\\",\\\"lineNumber\\\":{\\\"old\\\":5}},{\\\"type\\\":\\\"unchanged\\\",\\\"content\\\":\\\"A retriever is an abstraction that was added to the Search API in *8.14.0*.\\\",\\\"lineNumber\\\":{\\\"old\\\":6,\\\"new\\\":4}},{\\\"type\\\":\\\"unchanged\\\",\\\"content\\\":\\\"This abstraction enables the configuration of multi-stage retrieval pipelines within a single `_search` call.\\\",\\\"lineNumber\\\":{\\\"old\\\":7,\\\"new\\\":5}},{\\\"type\\\":\\\"unchanged\\\",\\\"content\\\":\\\"This simplifies your search application logic, because you no longer need to configure complex searches via multiple {es} calls or implement additional client-side logic to combine results from different queries.\\\",\\\"lineNumber\\\":{\\\"old\\\":8,\\\"new\\\":6}}]}\",\"timestamp\":1762428115760,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_call\",\"id\":\"toolu_0191BojrNMbGYVGibi7wdpaq\",\"messageId\":\"02e1f431-8cfb-4609-b853-33810c67dc7e\",\"toolId\":\"TodoWrite\",\"toolName\":\"TodoWrite\",\"parameters\":{\"todos\":[{\"id\":\"1\",\"content\":\"Explore codebase to find tech-preview headers related to retrievers and RRF\",\"status\":\"completed\",\"priority\":\"high\"},{\"id\":\"2\",\"content\":\"Find documentation files for retrievers and RRF\",\"status\":\"completed\",\"priority\":\"high\"},{\"id\":\"3\",\"content\":\"Remove tech-preview header from docs/reference/search/retriever.asciidoc\",\"status\":\"completed\",\"priority\":\"high\"},{\"id\":\"4\",\"content\":\"Remove tech-preview header from docs/reference/search/rrf.asciidoc\",\"status\":\"completed\",\"priority\":\"high\"},{\"id\":\"5\",\"content\":\"Remove preview::[] from docs/reference/search/search-your-data/retrievers-overview.asciidoc\",\"status\":\"in_progress\",\"priority\":\"high\"},{\"id\":\"6\",\"content\":\"Check semantic-reranking.asciidoc if it needs update\",\"status\":\"pending\",\"priority\":\"medium\"},{\"id\":\"7\",\"content\":\"Verify all changes are complete\",\"status\":\"pending\",\"priority\":\"medium\"}]},\"timestamp\":1762428115750,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_call\",\"id\":\"toolu_01Tji7qj4DSLTZNeVrHEAG1Z\",\"messageId\":\"02e1f431-8cfb-4609-b853-33810c67dc7e\",\"toolId\":\"Edit\",\"toolName\":\"Edit\",\"parameters\":{\"file_path\":\"/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpfnfjl2kw/workspace/docs/reference/search/search-your-data/retrievers-overview.asciidoc\",\"old_str\":\"[[retrievers-overview]]\\n=== Retrievers\\n\\npreview::[]\\n\\nA retriever is an abstraction that was added to the Search API in *8.14.0*.\",\"new_str\":\"[[retrievers-overview]]\\n=== Retrievers\\n\\nA retriever is an abstraction that was added to the Search API in *8.14.0*.\"},\"timestamp\":1762428115750,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_result\",\"id\":\"toolu_01XxcUqiky4frv93YWdK36Pf\",\"messageId\":\"8bf99a5f-bb82-452b-9656-0ae4f26c6b1d\",\"toolId\":\"\",\"isError\":false,\"value\":\"[[semantic-reranking]]\\n== Semantic re-ranking\\n\\npreview::[]\\n\\n[TIP]\\n====\\nThis overview focuses more on the high-level concepts and use cases for semantic re-ranking. For full implementation details on how to set up and use semantic re-ranking in {es}, see the <<text-similarity-reranker-retriever,reference documentation>> in the Search API docs.\\n====\\n\\nRe-rankers improve the relevance of results from earlier-stage retrieval mechanisms.\\n_Semantic_ re-rankers use machine learning models to reorder search results based on their semantic similarity to a query.\\n\\nSemantic re-ranking requires relatively large and complex machine learning models and operates in real-time in response to queries.\\nThis technique makes sense on a small _top-k_ result set, as one the of the final steps in a pipeline.\\nThis is a powerful technique for improving search relevance that works equally well with keyword, semantic, or hybrid retrieval algorithms.\\n\\nThe next sections provide more details on the benefits, use cases, and model types used for semantic re-ranking.\\nThe final sections include a practical, high-level overview of how to implement <<semantic-reranking-in-es,semantic re-ranking in {es}>> and links to the full reference documentation.\\n\\n[discrete]\\n[[semantic-reranking-use-cases]]\\n=== Use cases\\n\\nSemantic re-ranking enables a variety of use cases:\\n\\n* *Lexical (BM25) retrieval results re-ranking*\\n** Out-of-the-box semantic search by adding a simple API call to any lexical/BM25 retrieval pipeline.\\n** Adds semantic search capabilities on top of existing indices without reindexing, perfect for quick improvements.\\n** Ideal for environments with complex existing indices.\\n\\n* *Semantic retrieval results re-ranking*\\n** Improves results from semantic retrievers using ELSER sparse vector embeddings or dense vector embeddings by using more powerful models.\\n** Adds a refinement layer on top of hybrid retrieval with <<rrf, reciprocal rank fusion (RRF)>>.\\n\\n* *General applications*\\n** Supports automatic and transparent chunking, eliminating the need for pre-chunking at index time.\\n** Provides explicit control over document relevance in retrieval-augmented generation (RAG) uses cases or other scenarios involving language model (LLM) inputs.\\n\\nNow that we've outlined the value of semantic re-ranking, we'll explore the specific models that power this process and how they differ.\\n\\n[discrete]\\n[[semantic-reranking-models]]\\n=== Cross-encoder and bi-encoder models\\n\\nAt a high level, two model types are used for semantic re-ranking: cross-encoders and bi-encoders.\\n\\nNOTE: In this version, {es} *only supports cross-encoders* for semantic re-ranking.\\n\\n* A *cross-encoder model* can be thought of as a more powerful, all-in-one solution, because it generates query-aware document representations.\\nIt takes the query and document texts as a single, concatenated input.\\n* A *bi-encoder model* takes as input either document or query text.\\nDocuments and query embeddings are computed separately, so they aren't aware of each other.\\n** To compute a ranking score, an external operation is required. This typically involves computing dot-product or cosine similarity between the query and document embeddings.\\n\\nIn brief, cross-encoders provide high accuracy but are more resource-intensive.\\nBi-encoders are faster and more cost-effective but less precise.\\n\\nIn future versions, {es} will also support bi-encoders.\\nIf you're interested in a more detailed analysis of the practical differences between cross-encoders and bi-encoders, untoggle the next section.\\n\\n.Comparisons between cross-encoder and bi-encoder\\n[%collapsible]\\n==============\\nThe following is a non-exhaustive list of considerations when choosing between cross-encoders and bi-encoders for semantic re-ranking:\\n\\n* Because a cross-encoder model simultaneously processes both query and document texts, it can better infer their relevance, making it more effective as a reranker than a bi-encoder.\\n* Cross-encoder models are generally larger and more computationally intensive, resulting in higher latencies and increased computational costs.\\n* There are significantly fewer open-source cross-encoders, while bi-encoders offer a wide variety of sizes, languages, and other trade-offs.\\n* The effectiveness of cross-encoders can also improve the relevance of semantic retrievers.\\nFor example, their ability to take word order into account can improve on dense or sparse embedding retrieval.\\n* When trained in tandem with specific retrievers (like lexical/BM25), cross-encoders can \u201ccorrect\u201d typical errors made by those retrievers.\\n* Cross-encoders output scores that are consistent across queries.\\nThis enables you to maintain high relevance in result sets, by setting a minimum score threshold for all queries.\\nFor example, this is important when using results in a RAG workflow or if you're otherwise feeding results to LLMs.\\nNote that similarity scores from bi-encoders/embedding similarities are _query-dependent_, meaning you cannot set universal cut-offs.\\n* Bi-encoders rerank using embeddings. You can improve your re-ranking latency by creating embeddings at ingest-time. These embeddings can be stored for re-ranking without being indexed for retrieval, reducing your memory footprint.\\n==============\\n\\n[discrete]\\n[[semantic-reranking-in-es]]\\n=== Semantic re-ranking in {es}\\n\\nIn {es}, semantic re-rankers are implemented using the {es} <<inference-apis,Inference API>> and a <<retriever,retriever>>.\\n\\nTo use semantic re-ranking in {es}, you need to:\\n\\n. *Choose a re-ranking model*.\\nCurrently you can:\\n\\n** Integrate directly with the <<infer-service-cohere,Cohere Rerank inference endpoint>> using the `rerank` task type\\n** Integrate directly with the <<infer-service-google-vertex-ai,Google Vertex AI inference endpoint>> using the `rerank` task type\\n** Upload a model to {es} from Hugging Face with {eland-docs}/machine-learning.html#ml-nlp-pytorch[Eland]. You'll need to use the `text_similarity` NLP task type when loading the model using Eland. Refer to {ml-docs}/ml-nlp-model-ref.html#ml-nlp-model-ref-text-similarity[the Elastic NLP model reference] for a list of third party text similarity models supported by {es} for semantic re-ranking.\\n*** Then set up an <<inference-example-eland,{es} service inference endpoint>> with the `rerank` task type\\n. *Create a `rerank` task using the <<put-inference-api,{es} Inference API>>*.\\nThe Inference API creates an inference endpoint and configures your chosen machine learning model to perform the re-ranking task.\\n. *Define a `text_similarity_reranker` retriever in your search request*.\\nThe retriever syntax makes it simple to configure both the retrieval and re-ranking of search results in a single API call.\\n\\n.*Example search request* with semantic reranker\\n[%collapsible]\\n==============\\nThe following example shows a search request that uses a semantic reranker to reorder the top-k documents based on their semantic similarity to the query.\\n[source,console]\\n----\\nPOST _search\\n{\\n  \\\"retriever\\\": {\\n    \\\"text_similarity_reranker\\\": {\\n      \\\"retriever\\\": {\\n        \\\"standard\\\": {\\n          \\\"query\\\": {\\n            \\\"match\\\": {\\n              \\\"text\\\": \\\"How often does the moon hide the sun?\\\"\\n            }\\n          }\\n        }\\n      },\\n      \\\"field\\\": \\\"text\\\",\\n      \\\"inference_id\\\": \\\"my-cohere-rerank-model\\\",\\n      \\\"inference_text\\\": \\\"How often does the moon hide the sun?\\\",\\n      \\\"rank_window_size\\\": 100,\\n      \\\"min_score\\\": 0.5\\n    }\\n  }\\n}\\n----\\n// TEST[skip:TBD]\\n==============\\n\\n[discrete]\\n[[semantic-reranking-learn-more]]\\n=== Learn more\\n\\n* Read the <<retriever,retriever reference documentation>> for syntax and implementation details\\n* Learn more about the <<retrievers-overview,retrievers>> abstraction\\n* Learn more about the Elastic <<inference-apis,Inference APIs>>\\n* Check out our https://github.com/elastic/elasticsearch-labs/blob/main/notebooks/integrations/cohere/cohere-elasticsearch.ipynb[Python notebook] for using Cohere with {es}\",\"timestamp\":1762428122538,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"message\",\"role\":\"assistant\",\"id\":\"e32d725b-612a-41cc-bb51-b4c3f6f99b5f\",\"text\":\"Now let me check if the semantic-reranking file should also have its preview tag removed, since it's related to retrievers:\",\"timestamp\":1762428122531,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_call\",\"id\":\"toolu_01XxcUqiky4frv93YWdK36Pf\",\"messageId\":\"e32d725b-612a-41cc-bb51-b4c3f6f99b5f\",\"toolId\":\"Read\",\"toolName\":\"Read\",\"parameters\":{\"file_path\":\"/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpfnfjl2kw/workspace/docs/reference/reranking/semantic-reranking.asciidoc\"},\"timestamp\":1762428122531,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"message\",\"role\":\"assistant\",\"id\":\"733ad8d1-bcc3-4408-b48f-0a0d2b1b5baa\",\"text\":\"Based on the PR description and the content of semantic-reranking.asciidoc, it seems like the text_similarity_reranker is a feature that works with retrievers. However, the PR title specifically mentions \\\"retrievers and RRF\\\", not semantic reranking. Let me check if there are any references in the original PR or related changelogs to understand the scope better:\",\"timestamp\":1762428130333,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_call\",\"id\":\"toolu_01B1SjwWccVcKU8kjHY7mGG1\",\"messageId\":\"733ad8d1-bcc3-4408-b48f-0a0d2b1b5baa\",\"toolId\":\"Grep\",\"toolName\":\"Grep\",\"parameters\":{\"pattern\":\"114810\",\"output_mode\":\"content\",\"line_numbers\":true},\"timestamp\":1762428130333,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_call\",\"id\":\"toolu_01CLrHodYvLqHeFvmCnyHG4D\",\"messageId\":\"733ad8d1-bcc3-4408-b48f-0a0d2b1b5baa\",\"toolId\":\"Grep\",\"toolName\":\"Grep\",\"parameters\":{\"pattern\":\"text_similarity_reranker.*preview|text_similarity_reranker.*tech\",\"case_insensitive\":true,\"output_mode\":\"content\",\"line_numbers\":true},\"timestamp\":1762428130333,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_result\",\"id\":\"toolu_01B1SjwWccVcKU8kjHY7mGG1\",\"messageId\":\"4ce3772d-e277-4874-a29c-e079c1e30db4\",\"toolId\":\"Grep\",\"isError\":false,\"value\":\"No matches found\",\"timestamp\":1762428131193,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_result\",\"id\":\"toolu_01CLrHodYvLqHeFvmCnyHG4D\",\"messageId\":\"4ce3772d-e277-4874-a29c-e079c1e30db4\",\"toolId\":\"Grep\",\"isError\":false,\"value\":\"No matches found\",\"timestamp\":1762428131193,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_result\",\"id\":\"toolu_01TuFjpD4tmMrqYkt4euuqWx\",\"messageId\":\"5bc21c5c-33b4-4608-805f-a8ab9f4cdf40\",\"toolId\":\"\",\"isError\":false,\"value\":\"./111855.yaml\\n./110593.yaml\\n./112687.yaml\\n./112412.yaml\\n./110993.yaml\\n./112916.yaml\\n./113690.yaml\\n./110116.yaml\\n./114856.yaml\\n./112081.yaml\\n./113385.yaml\\n./111212.yaml\\n./111091.yaml\\n./112652.yaml\\n./113297.yaml\\n./114552.yaml\\n./111245.yaml\\n./111316.yaml\\n./111879.yaml\\n./112214.yaml\\n./112263.yaml\\n./114358.yaml\\n./111336.yaml\\n./110527.yaml\\n./112058.yaml\\n./114533.yaml\\n./111818.yaml\\n./113825.yaml\\n./112330.yaml\\n./112019.yaml\\n./111770.yaml\\n./110399.yaml\\n./114732.yaml\\n./111064.yaml\\n./114636.yaml\\n./112218.yaml\\n./114549.yaml\\n./114375.yaml\\n./111874.yaml\\n./111161.yaml\\n./114363.yaml\\n./109414.yaml\\n./112126.yaml\\n./112063.yaml\\n./112761.yaml\\n./113873.yaml\\n./110971.yaml\\n./113961.yaml\\n./111225.yaml\\n./112409.yaml\\n./112665.yaml\\n./114836.yaml\\n./112262.yaml\\n./112350.yaml\\n./113812.yaml\\n./112645.yaml\\n./114512.yaml\\n./114457.yaml\\n./111655.yaml\\n./114683.yaml\\n./112612.yaml\\n./113280.yaml\\n./112595.yaml\\n./110951.yaml\\n./112151.yaml\\n./111950.yaml\\n./114482.yaml\\n./112055.yaml\\n./112405.yaml\\n./110603.yaml\\n./113869.yaml\\n./113613.yaml\\n./110879.yaml\\n./109583.yaml\\n./112320.yaml\\n./114309.yaml\\n./111367.yaml\\n./113570.yaml\\n./113989.yaml\\n./110833.yaml\\n./112273.yaml\\n./110921.yaml\\n./112571.yaml\\n./112199.yaml\\n./111465.yaml\\n./111445.yaml\\n./111015.yaml\\n./112547.yaml\\n./110829.yaml\\n./111412.yaml\\n./111238.yaml\\n./112678.yaml\\n./114128.yaml\\n./113897.yaml\\n./111516.yaml\\n./111644.yaml\\n./112341.yaml\\n./110669.yaml\\n./110901.yaml\\n./114411.yaml\\n./114368.yaml\\n./111490.yaml\\n./113911.yaml\\n./111740.yaml\\n./114407.yaml\\n./107047.yaml\\n./111193.yaml\\n./112707.yaml\\n./112706.yaml\\n./113286.yaml\\n./111311.yaml\\n./114386.yaml\\n./113013.yaml\\n./113910.yaml\\n./112481.yaml\\n./111079.yaml\\n./113697.yaml\\n./111215.yaml\\n./114715.yaml\\n./114596.yaml\\n./112100.yaml\\n./111413.yaml\\n./114168.yaml\\n./111690.yaml\\n./113183.yaml\\n./111917.yaml\\n./111501.yaml\\n./111576.yaml\\n./112024.yaml\\n./111937.yaml\\n./112874.yaml\\n./114109.yaml\\n./113623.yaml\\n./110633.yaml\\n./112337.yaml\\n./114719.yaml\\n./109193.yaml\\n./113967.yaml\\n./113988.yaml\\n./114021.yaml\\n./111809.yaml\\n./111624.yaml\\n./111274.yaml\\n./110520.yaml\\n./112973.yaml\\n./113374.yaml\\n./112565.yaml\\n./114848.yaml\\n./110734.yaml\\n./109684.yaml\\n./114389.yaml\\n./110630.yaml\\n./112066.yaml\\n./112123.yaml\\n./110237.yaml\\n./112508.yaml\\n./111689.yaml\\n./110427.yaml\\n./114464.yaml\\n./110974.yaml\\n./113437.yaml\\n./110574.yaml\\n./110718.yaml\\n./113499.yaml\\n./112210.yaml\\n./113051.yaml\\n./114002.yaml\\n./110554.yaml\\n./113143.yaml\\n./109667.yaml\\n./110796.yaml\\n./110846.yaml\\n./113552.yaml\\n./112768.yaml\\n./114080.yaml\\n./112857.yaml\\n./111797.yaml\\n./111955.yaml\\n./111105.yaml\\n./110578.yaml\\n./110606.yaml\\n./112512.yaml\\n./114429.yaml\\n./112905.yaml\\n./111915.yaml\\n./112401.yaml\\n./112397.yaml\\n./111684.yaml\\n./110216.yaml\\n./111779.yaml\\n./113314.yaml\\n./112440.yaml\\n./113251.yaml\\n./113103.yaml\\n./112895.yaml\\n./110847.yaml\\n./112929.yaml\\n./112303.yaml\\n./114453.yaml\\n./111344.yaml\\n./111981.yaml\\n./113816.yaml\\n./113498.yaml\\n./113027.yaml\\n./113123.yaml\\n./112677.yaml\\n./112270.yaml\\n./110021.yaml\\n./109017.yaml\\n./113699.yaml\\n./113158.yaml\\n./112933.yaml\\n./114234.yaml\\n./111523.yaml\\n./112026.yaml\\n./112972.yaml\\n./114638.yaml\\n./111969.yaml\\n./113846.yaml\\n./114116.yaml\\n./111181.yaml\\n./112938.yaml\\n./112200.yaml\\n./112345.yaml\\n./113387.yaml\\n./114157.yaml\\n./112294.yaml\\n./111457.yaml\\n./111284.yaml\\n./114439.yaml\\n./113981.yaml\\n./112369.yaml\\n./111683.yaml\\n./112282.yaml\\n./111154.yaml\\n./112451.yaml\\n./112133.yaml\\n./106520.yaml\\n./110677.yaml\\n./114264.yaml\\n./111123.yaml\\n./114321.yaml\\n./112888.yaml\\n./113276.yaml\\n./113333.yaml\\n./112826.yaml\\n./111420.yaml\\n./114337.yaml\\n./110860.yaml\\n./112277.yaml\\n./114527.yaml\\n./111226.yaml\\n./112723.yaml\\n./112519.yaml\\n./110524.yaml\\n./113563.yaml\\n./107936.yaml\\n./111948.yaml\\n./111118.yaml\\n./113172.yaml\\n./111071.yaml\\n./111972.yaml\\n./112348.yaml\\n./112431.yaml\\n./113735.yaml\\n./112574.yaml\\n./112489.yaml\\n./111749.yaml\\n./110676.yaml\\n./111437.yaml\\n./113723.yaml\\n./113373.yaml\\n./113187.yaml\\n./110986.yaml\\n./111552.yaml\\n./114750.yaml\\n./111544.yaml\\n./113129.yaml\\n./112850.yaml\\n./113607.yaml\\n./110928.yaml\\n./111840.yaml\\n./112295.yaml\\n./110816.yaml\\n./114382.yaml\\n./111600.yaml\\n./111315.yaml\\n./111968.yaml\",\"timestamp\":1762428137338,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_result\",\"id\":\"toolu_01DKSX7yxMJoCLaVN3UBrZzP\",\"messageId\":\"5bc21c5c-33b4-4608-805f-a8ab9f4cdf40\",\"toolId\":\"\",\"isError\":false,\"value\":\"./112058.yaml\\n./114109.yaml\",\"timestamp\":1762428137338,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"message\",\"role\":\"assistant\",\"id\":\"d028e566-30eb-40ee-9303-000647cc2e19\",\"text\":\"Let me check the changelog files to understand what changes were made:\",\"timestamp\":1762428137322,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_call\",\"id\":\"toolu_01TuFjpD4tmMrqYkt4euuqWx\",\"messageId\":\"d028e566-30eb-40ee-9303-000647cc2e19\",\"toolId\":\"Glob\",\"toolName\":\"Glob\",\"parameters\":{\"patterns\":[\"*.yaml\",\"*.yml\"],\"folder\":\"/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpfnfjl2kw/workspace/docs/changelog\"},\"timestamp\":1762428137322,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_call\",\"id\":\"toolu_01DKSX7yxMJoCLaVN3UBrZzP\",\"messageId\":\"d028e566-30eb-40ee-9303-000647cc2e19\",\"toolId\":\"Grep\",\"toolName\":\"Grep\",\"parameters\":{\"pattern\":\"retriever|RRF\",\"path\":\"/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpfnfjl2kw/workspace/docs/changelog\",\"output_mode\":\"file_paths\"},\"timestamp\":1762428137322,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_result\",\"id\":\"toolu_01XdhgeBcntoecAncWpXKVV9\",\"messageId\":\"5f2e47ec-d48f-4e77-993f-2e001f0a9c17\",\"toolId\":\"\",\"isError\":false,\"value\":\"pr: 114109\\nsummary: Update cluster stats for retrievers\\narea: Search\\ntype: enhancement\\nissues: []\\n\",\"timestamp\":1762428141901,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_result\",\"id\":\"toolu_01AHa8R2EbpZUSEuKvy4yYdz\",\"messageId\":\"5f2e47ec-d48f-4e77-993f-2e001f0a9c17\",\"toolId\":\"\",\"isError\":false,\"value\":\"pr: 112058\\nsummary: Fix RRF validation for `rank_constant` < 1\\narea: Ranking\\ntype: bug\\nissues: []\\n\",\"timestamp\":1762428141901,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_call\",\"id\":\"toolu_01XdhgeBcntoecAncWpXKVV9\",\"messageId\":\"f35f1cc6-684e-4020-b903-2e092d82a89c\",\"toolId\":\"Read\",\"toolName\":\"Read\",\"parameters\":{\"file_path\":\"/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpfnfjl2kw/workspace/docs/changelog/114109.yaml\"},\"timestamp\":1762428141897,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_call\",\"id\":\"toolu_01AHa8R2EbpZUSEuKvy4yYdz\",\"messageId\":\"f35f1cc6-684e-4020-b903-2e092d82a89c\",\"toolId\":\"Read\",\"toolName\":\"Read\",\"parameters\":{\"file_path\":\"/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpfnfjl2kw/workspace/docs/changelog/112058.yaml\"},\"timestamp\":1762428141897,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_result\",\"id\":\"toolu_01HrJKYZj8MmhXLvRmXiuLQb\",\"messageId\":\"11aa48ee-f513-44bb-9b78-3ca9534893e1\",\"toolId\":\"\",\"isError\":false,\"value\":\"./reranking/semantic-reranking.asciidoc\\n./inference/service-cohere.asciidoc\\n./search/retriever.asciidoc\\n./search/search-your-data/retrievers-overview.asciidoc\",\"timestamp\":1762428149606,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_result\",\"id\":\"toolu_01SRYDPDQhmkqyLGTM3jsbWL\",\"messageId\":\"11aa48ee-f513-44bb-9b78-3ca9534893e1\",\"toolId\":\"\",\"isError\":false,\"value\":\"No matches found\",\"timestamp\":1762428149606,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"message\",\"role\":\"assistant\",\"id\":\"6b981d6f-635c-4b71-b582-049cb601d8cb\",\"text\":\"Let me search more specifically for any references in the PR title or check if there are any other documentation references:\",\"timestamp\":1762428149556,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_call\",\"id\":\"toolu_01HrJKYZj8MmhXLvRmXiuLQb\",\"messageId\":\"6b981d6f-635c-4b71-b582-049cb601d8cb\",\"toolId\":\"Grep\",\"toolName\":\"Grep\",\"parameters\":{\"pattern\":\"text-similarity-reranker-retriever|text_similarity_reranker\",\"path\":\"/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpfnfjl2kw/workspace/docs/reference\",\"output_mode\":\"file_paths\"},\"timestamp\":1762428149556,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_call\",\"id\":\"toolu_01SRYDPDQhmkqyLGTM3jsbWL\",\"messageId\":\"6b981d6f-635c-4b71-b582-049cb601d8cb\",\"toolId\":\"Grep\",\"toolName\":\"Grep\",\"parameters\":{\"pattern\":\"preview.*retriever|preview.*rrf\",\"case_insensitive\":true,\"path\":\"/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpfnfjl2kw/workspace/docs/reference\",\"output_mode\":\"content\",\"line_numbers\":true},\"timestamp\":1762428149556,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_result\",\"id\":\"toolu_01KMUqSboBKkMNtEJbuEk7Hp\",\"messageId\":\"cf7fe16b-ab81-4194-8d4a-d65056783f10\",\"toolId\":\"\",\"isError\":false,\"value\":\"No matches found\",\"timestamp\":1762428156897,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_result\",\"id\":\"toolu_01JLkdH6iUdXPyAbhZKnNH4P\",\"messageId\":\"cf7fe16b-ab81-4194-8d4a-d65056783f10\",\"toolId\":\"\",\"isError\":false,\"value\":\"[[infer-service-cohere]]\\n=== Cohere {infer} service\\n\\nCreates an {infer} endpoint to perform an {infer} task with the `cohere` service.\\n\\n\\n[discrete]\\n[[infer-service-cohere-api-request]]\\n==== {api-request-title}\\n\\n`PUT /_inference/<task_type>/<inference_id>`\\n\\n[discrete]\\n[[infer-service-cohere-api-path-params]]\\n==== {api-path-parms-title}\\n\\n`<inference_id>`::\\n(Required, string)\\ninclude::inference-shared.asciidoc[tag=inference-id]\\n\\n`<task_type>`::\\n(Required, string)\\ninclude::inference-shared.asciidoc[tag=task-type]\\n+\\n--\\nAvailable task types:\\n\\n* `completion`,\\n* `rerank`,\\n* `text_embedding`.\\n--\\n\\n[discrete]\\n[[infer-service-cohere-api-request-body]]\\n==== {api-request-body-title}\\n\\n`service`::\\n(Required, string)\\nThe type of service supported for the specified task type. In this case, \\n`cohere`.\\n\\n`service_settings`::\\n(Required, object)\\ninclude::inference-shared.asciidoc[tag=service-settings]\\n+\\n--\\nThese settings are specific to the `cohere` service.\\n--\\n\\n`api_key`:::\\n(Required, string)\\nA valid API key of your Cohere account.\\nYou can find your Cohere API keys or you can create a new one\\nhttps://dashboard.cohere.com/api-keys[on the API keys settings page].\\n+\\n--\\ninclude::inference-shared.asciidoc[tag=api-key-admonition]\\n--\\n\\n`rate_limit`:::\\n(Optional, object)\\nBy default, the `cohere` service sets the number of requests allowed per minute to `10000`.\\nThis value is the same for all task types.\\nThis helps to minimize the number of rate limit errors returned from Cohere.\\nTo modify this, set the `requests_per_minute` setting of this object in your service settings:\\n+\\n--\\ninclude::inference-shared.asciidoc[tag=request-per-minute-example]\\n\\nMore information about Cohere's rate limits can be found in https://docs.cohere.com/docs/going-live#production-key-specifications[Cohere's production key docs].\\n--\\n+\\n.`service_settings` for the `completion` task type\\n[%collapsible%closed]\\n=====\\n`model_id`::\\n(Optional, string)\\nThe name of the model to use for the {infer} task.\\nTo review the available `completion` models, refer to the\\nhttps://docs.cohere.com/docs/models#command[Cohere docs].\\n=====\\n+\\n.`service_settings` for the `rerank` task type\\n[%collapsible%closed]\\n=====\\n`model_id`::\\n(Optional, string)\\nThe name of the model to use for the {infer} task.\\nTo review the available `rerank` models, refer to the\\nhttps://docs.cohere.com/reference/rerank-1[Cohere docs].\\n=====\\n+\\n.`service_settings` for the `text_embedding` task type\\n[%collapsible%closed]\\n=====\\n`embedding_type`:::\\n(Optional, string)\\nSpecifies the types of embeddings you want to get back.\\nDefaults to `float`.\\nValid values are:\\n\\n<system-reminder>[Showing lines 1-100 of 205 total lines]</system-reminder>\",\"timestamp\":1762428156897,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"message\",\"role\":\"assistant\",\"id\":\"1287405a-6b60-42f4-8df2-b78dea2bb33c\",\"text\":\"Good! Now let me check if there are any other references in the documentation that might still refer to retrievers or RRF as technical preview:\",\"timestamp\":1762428156857,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_call\",\"id\":\"toolu_01KMUqSboBKkMNtEJbuEk7Hp\",\"messageId\":\"1287405a-6b60-42f4-8df2-b78dea2bb33c\",\"toolId\":\"Grep\",\"toolName\":\"Grep\",\"parameters\":{\"pattern\":\"retriever.*syntax.*change|RRF.*syntax.*change\",\"case_insensitive\":true,\"path\":\"/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpfnfjl2kw/workspace/docs/reference\",\"output_mode\":\"content\",\"line_numbers\":true},\"timestamp\":1762428156857,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_call\",\"id\":\"toolu_01JLkdH6iUdXPyAbhZKnNH4P\",\"messageId\":\"1287405a-6b60-42f4-8df2-b78dea2bb33c\",\"toolId\":\"Read\",\"toolName\":\"Read\",\"parameters\":{\"file_path\":\"/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpfnfjl2kw/workspace/docs/reference/inference/service-cohere.asciidoc\",\"offset\":0,\"limit\":100},\"timestamp\":1762428156857,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_result\",\"id\":\"toolu_01BTwNc1AX2gUw3eaTKmyW7e\",\"messageId\":\"25b8d5bd-37a8-4869-ab15-578ff95505c7\",\"toolId\":\"\",\"isError\":false,\"value\":\"No matches found\",\"timestamp\":1762428163181,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"message\",\"role\":\"assistant\",\"id\":\"c6c10491-d427-474c-9d5c-93ee260d4e1d\",\"text\":\"Now let me check if there are any release notes or other places that mention the tech preview status that should be updated:\",\"timestamp\":1762428163147,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_call\",\"id\":\"toolu_01BTwNc1AX2gUw3eaTKmyW7e\",\"messageId\":\"c6c10491-d427-474c-9d5c-93ee260d4e1d\",\"toolId\":\"Grep\",\"toolName\":\"Grep\",\"parameters\":{\"pattern\":\"retriever.*tech.*preview|retriever.*technical preview\",\"case_insensitive\":true,\"path\":\"/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpfnfjl2kw/workspace/docs/reference\",\"output_mode\":\"content\",\"line_numbers\":true,\"context\":2},\"timestamp\":1762428163147,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_result\",\"id\":\"toolu_01BR2s1zc58TwyuahjiUubdE\",\"messageId\":\"7b66759c-e385-4093-b870-26843280ebdd\",\"toolId\":\"\",\"isError\":false,\"value\":\"TODO List Updated\",\"timestamp\":1762428173375,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_result\",\"id\":\"toolu_01RPguSRtun4oHcb26zny9Ti\",\"messageId\":\"7b66759c-e385-4093-b870-26843280ebdd\",\"toolId\":\"\",\"isError\":false,\"value\":\"[[retriever]]\\n=== Retriever\\n\\nA retriever is a specification to describe top documents returned from a\\nsearch. A retriever replaces other elements of the <<search-search, search API>>\\nthat also return top documents such as <<query-dsl, `query`>> and\\n<<search-api-knn, `knn`>>. A retriever may have child retrievers where a\\nretriever with two or more children is considered a compound retriever. This\\nallows for complex behavior to be depicted in a tree-like structure, called\\nthe retriever tree, to better clarify the order of operations that occur\\nduring a search.\\n\\n[TIP]\\n====\\nRefer to <<retrievers-overview>> for a high level overview of the retrievers abstraction.\\n====\\n\\nThe following retrievers are available:\\n\\n`standard`::\\n\\n<system-reminder>[Showing lines 1-20 of 557 total lines]</system-reminder>\",\"timestamp\":1762428173375,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_result\",\"id\":\"toolu_01Rhroj49Y4mXjqf8iC75Bpk\",\"messageId\":\"7b66759c-e385-4093-b870-26843280ebdd\",\"toolId\":\"\",\"isError\":false,\"value\":\"[[rrf]]\\n=== Reciprocal rank fusion\\n\\nhttps://plg.uwaterloo.ca/~gvcormac/cormacksigir09-rrf.pdf[Reciprocal rank fusion (RRF)]\\nis a method for combining multiple result sets with different relevance indicators into a single result set.\\nRRF requires no tuning, and the different relevance indicators do not have to be related to each other to achieve high-quality results.\\n\\nRRF uses the following formula to determine the score for ranking each document:\\n\\n[source,python]\\n----\\nscore = 0.0\\nfor q in queries:\\n    if d in result(q):\\n        score += 1.0 / ( k + rank( result(q), d ) )\\nreturn score\\n\\n# where\\n# k is a ranking constant\\n# q is a query in the set of queries\\n\\n<system-reminder>[Showing lines 1-20 of 704 total lines]</system-reminder>\",\"timestamp\":1762428173375,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_result\",\"id\":\"toolu_017F84kWU3uD8RJnjReJT3Qm\",\"messageId\":\"7b66759c-e385-4093-b870-26843280ebdd\",\"toolId\":\"\",\"isError\":false,\"value\":\"[[retrievers-overview]]\\n=== Retrievers\\n\\nA retriever is an abstraction that was added to the Search API in *8.14.0*.\\nThis abstraction enables the configuration of multi-stage retrieval pipelines within a single `_search` call.\\nThis simplifies your search application logic, because you no longer need to configure complex searches via multiple {es} calls or implement additional client-side logic to combine results from different queries.\\n\\nThis document provides a general overview of the retriever abstraction.\\nFor implementation details, including notable restrictions, check out the\\n<<retriever,reference documentation>> in the `_search` API docs.\\n\\n[discrete]\\n[[retrievers-overview-types]]\\n==== Retriever types\\n\\nRetrievers come in various types, each tailored for different search operations.\\nThe following retrievers are currently available:\\n\\n* <<standard-retriever,*Standard Retriever*>>. Returns top documents from a\\ntraditional https://www.elastic.co/guide/en/elasticsearch/reference/master/query-dsl.html[query].\\n\\n<system-reminder>[Showing lines 1-20 of 182 total lines]</system-reminder>\",\"timestamp\":1762428173375,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"message\",\"role\":\"assistant\",\"id\":\"192cdd3a-dc88-4295-abca-78c04f8c017c\",\"text\":\"Perfect! Now let me verify that all the changes have been made correctly by checking the modified files:\",\"timestamp\":1762428173365,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_call\",\"id\":\"toolu_01BR2s1zc58TwyuahjiUubdE\",\"messageId\":\"192cdd3a-dc88-4295-abca-78c04f8c017c\",\"toolId\":\"TodoWrite\",\"toolName\":\"TodoWrite\",\"parameters\":{\"todos\":[{\"id\":\"1\",\"content\":\"Explore codebase to find tech-preview headers related to retrievers and RRF\",\"status\":\"completed\",\"priority\":\"high\"},{\"id\":\"2\",\"content\":\"Find documentation files for retrievers and RRF\",\"status\":\"completed\",\"priority\":\"high\"},{\"id\":\"3\",\"content\":\"Remove tech-preview header from docs/reference/search/retriever.asciidoc\",\"status\":\"completed\",\"priority\":\"high\"},{\"id\":\"4\",\"content\":\"Remove tech-preview header from docs/reference/search/rrf.asciidoc\",\"status\":\"completed\",\"priority\":\"high\"},{\"id\":\"5\",\"content\":\"Remove preview::[] from docs/reference/search/search-your-data/retrievers-overview.asciidoc\",\"status\":\"completed\",\"priority\":\"high\"},{\"id\":\"6\",\"content\":\"Verify all changes are complete by reading the modified files\",\"status\":\"in_progress\",\"priority\":\"medium\"}]},\"timestamp\":1762428173365,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_call\",\"id\":\"toolu_01RPguSRtun4oHcb26zny9Ti\",\"messageId\":\"192cdd3a-dc88-4295-abca-78c04f8c017c\",\"toolId\":\"Read\",\"toolName\":\"Read\",\"parameters\":{\"file_path\":\"/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpfnfjl2kw/workspace/docs/reference/search/retriever.asciidoc\",\"offset\":0,\"limit\":20},\"timestamp\":1762428173365,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_call\",\"id\":\"toolu_01Rhroj49Y4mXjqf8iC75Bpk\",\"messageId\":\"192cdd3a-dc88-4295-abca-78c04f8c017c\",\"toolId\":\"Read\",\"toolName\":\"Read\",\"parameters\":{\"file_path\":\"/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpfnfjl2kw/workspace/docs/reference/search/rrf.asciidoc\",\"offset\":0,\"limit\":20},\"timestamp\":1762428173365,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_call\",\"id\":\"toolu_017F84kWU3uD8RJnjReJT3Qm\",\"messageId\":\"192cdd3a-dc88-4295-abca-78c04f8c017c\",\"toolId\":\"Read\",\"toolName\":\"Read\",\"parameters\":{\"file_path\":\"/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpfnfjl2kw/workspace/docs/reference/search/search-your-data/retrievers-overview.asciidoc\",\"offset\":0,\"limit\":20},\"timestamp\":1762428173365,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_result\",\"id\":\"toolu_018f4Hm9XjRfUPJiYT7zMJdi\",\"messageId\":\"71030c5f-858e-4bc4-b9e3-d68e0827ec5d\",\"toolId\":\"\",\"isError\":false,\"value\":\"./8.14.0.asciidoc\\n./8.15.1.asciidoc\\n./8.15.0.asciidoc\\n./8.12.0.asciidoc\",\"timestamp\":1762428179462,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"message\",\"role\":\"assistant\",\"id\":\"03c419e0-495f-4682-8065-57c8fac0120a\",\"text\":\"Excellent! All the tech-preview headers have been successfully removed. Now let me do a final verification to ensure there are no other references to tech preview status for retrievers and RRF in the documentation:\",\"timestamp\":1762428179440,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_call\",\"id\":\"toolu_018f4Hm9XjRfUPJiYT7zMJdi\",\"messageId\":\"03c419e0-495f-4682-8065-57c8fac0120a\",\"toolId\":\"Grep\",\"toolName\":\"Grep\",\"parameters\":{\"pattern\":\"retriever|RRF\",\"path\":\"/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpfnfjl2kw/workspace/docs/reference/release-notes\",\"output_mode\":\"file_paths\"},\"timestamp\":1762428179440,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_result\",\"id\":\"toolu_01FZQuywMjfjYBvWCTvmk3RV\",\"messageId\":\"e4d4d9f4-2763-42ab-bc00-257a53690679\",\"toolId\":\"\",\"isError\":false,\"value\":\"No matches found\",\"timestamp\":1762428184980,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"message\",\"role\":\"assistant\",\"id\":\"605f1f42-c088-4a5d-86cc-55d3463e48ce\",\"text\":\"Let me check these release notes to see if they need any updates:\",\"timestamp\":1762428184961,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_call\",\"id\":\"toolu_01FZQuywMjfjYBvWCTvmk3RV\",\"messageId\":\"605f1f42-c088-4a5d-86cc-55d3463e48ce\",\"toolId\":\"Grep\",\"toolName\":\"Grep\",\"parameters\":{\"pattern\":\"retriever.*preview|RRF.*preview\",\"case_insensitive\":true,\"path\":\"/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpfnfjl2kw/workspace/docs/reference/release-notes\",\"output_mode\":\"content\",\"line_numbers\":true,\"context\":3},\"timestamp\":1762428184961,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_result\",\"id\":\"toolu_01BqjMwDZqWu1qBJpJ75vmfs\",\"messageId\":\"4cd0d952-d8e8-4f74-a9cd-015cc91898d6\",\"toolId\":\"\",\"isError\":false,\"value\":\"No matches found\",\"timestamp\":1762428190153,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"message\",\"role\":\"assistant\",\"id\":\"3a664f95-d7e8-4bbb-9963-6f9404087d8e\",\"text\":\"Perfect! Now let me check if there are any other documentation files that might reference the tech preview status:\",\"timestamp\":1762428189423,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_call\",\"id\":\"toolu_01BqjMwDZqWu1qBJpJ75vmfs\",\"messageId\":\"3a664f95-d7e8-4bbb-9963-6f9404087d8e\",\"toolId\":\"Grep\",\"toolName\":\"Grep\",\"parameters\":{\"pattern\":\"retriever.*technical|retriever.*tech preview\",\"case_insensitive\":true,\"output_mode\":\"content\",\"line_numbers\":true},\"timestamp\":1762428189423,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_result\",\"id\":\"toolu_01AhLNju313c7HAZKDYVaSXE\",\"messageId\":\"4756e6b6-a896-43ac-a271-01ffd507d687\",\"toolId\":\"\",\"isError\":false,\"value\":\"1306-\\n1307-See <<index-wait-for-active-shards>>.\\n1308---\\n1309-end::wait_for_active_shards[]\\n1310-\\n1311:tag::rrf-retrievers[]\\n1312-`retrievers`::\\n1313-(Required, array of retriever objects)\\n1314-+\\n1315-A list of child retrievers to specify which sets of returned top documents\\n1316-will have the RRF formula applied to them. Each child retriever carries an\\n1317-equal weight as part of the RRF formula. Two or more child retrievers are\\n1318-required.\\n1319:end::rrf-retrievers[]\\n1320-\\n1321:tag::rrf-rank-constant[]\\n1322-`rank_constant`::\\n1323-(Optional, integer)\\n1324-+\\n1325-This value determines how much influence documents in individual\\n1326-result sets per query have over the final ranked result set. A higher value indicates\\n1327-that lower ranked documents have more influence. This value must be greater than or\\n1328-equal to `1`. Defaults to `60`.\\n1329:end::rrf-rank-constant[]\\n1330-\\n1331:tag::rrf-rank-window-size[]\\n1332-`rank_window_size`::\\n1333-(Optional, integer)\\n1334-+\\n1335-This value determines the size of the individual result sets per\\n1336-query. A higher value will improve result relevance at the cost of performance. The final\\n1337-ranked result set is pruned down to the search request's <<search-size-param, size>>.\\n1338-`rank_window_size` must be greater than or equal to `size` and greater than or equal to `1`.\\n1339-Defaults to the `size` parameter.\\n1340:end::rrf-rank-window-size[]\\n1341-\\n1342:tag::rrf-filter[]\\n1343-`filter`::\\n1344-(Optional, <<query-dsl, query object or list of query objects>>)\\n1345-+\\n1346-Applies the specified <<query-dsl-bool-query, boolean query filter>> to all of the specified sub-retrievers,\\n1347-according to each retriever's specifications.\\n1348:end::rrf-filter[]\",\"timestamp\":1762428196436,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"message\",\"role\":\"assistant\",\"id\":\"cf6f74ff-5098-4572-bb40-8ba9d2ef0143\",\"text\":\"Excellent! Let me also check for any mentions in common-parms.asciidoc which often contains reusable parameter descriptions:\",\"timestamp\":1762428196420,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_call\",\"id\":\"toolu_01AhLNju313c7HAZKDYVaSXE\",\"messageId\":\"cf6f74ff-5098-4572-bb40-8ba9d2ef0143\",\"toolId\":\"Grep\",\"toolName\":\"Grep\",\"parameters\":{\"pattern\":\"rrf-retrievers|rrf-rank-constant|rrf-rank-window-size|rrf-filter\",\"path\":\"/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpfnfjl2kw/workspace/docs/reference/rest-api/common-parms.asciidoc\",\"output_mode\":\"content\",\"line_numbers\":true,\"context\":5},\"timestamp\":1762428196420,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_result\",\"id\":\"toolu_01B7BiGHi7wYghZBwSG5tGuf\",\"messageId\":\"ec0d08a1-a189-4d1d-9a7e-763ccddb9c5b\",\"toolId\":\"\",\"isError\":false,\"value\":\"TODO List Updated\",\"timestamp\":1762428204707,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_result\",\"id\":\"toolu_016VKmZCbRZV9az2XGjZkYVi\",\"messageId\":\"ec0d08a1-a189-4d1d-9a7e-763ccddb9c5b\",\"toolId\":\"\",\"isError\":false,\"value\":\"No matches found\",\"timestamp\":1762428204707,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"message\",\"role\":\"assistant\",\"id\":\"ca095d20-2790-4952-b577-b9b55ca5c5b8\",\"text\":\"Good! The parameter definitions look clean and don't have any tech preview mentions. Now let me do a comprehensive final check to ensure everything is correct:\",\"timestamp\":1762428204667,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_call\",\"id\":\"toolu_01B7BiGHi7wYghZBwSG5tGuf\",\"messageId\":\"ca095d20-2790-4952-b577-b9b55ca5c5b8\",\"toolId\":\"TodoWrite\",\"toolName\":\"TodoWrite\",\"parameters\":{\"todos\":[{\"id\":\"1\",\"content\":\"Explore codebase to find tech-preview headers related to retrievers and RRF\",\"status\":\"completed\",\"priority\":\"high\"},{\"id\":\"2\",\"content\":\"Find documentation files for retrievers and RRF\",\"status\":\"completed\",\"priority\":\"high\"},{\"id\":\"3\",\"content\":\"Remove tech-preview header from docs/reference/search/retriever.asciidoc\",\"status\":\"completed\",\"priority\":\"high\"},{\"id\":\"4\",\"content\":\"Remove tech-preview header from docs/reference/search/rrf.asciidoc\",\"status\":\"completed\",\"priority\":\"high\"},{\"id\":\"5\",\"content\":\"Remove preview::[] from docs/reference/search/search-your-data/retrievers-overview.asciidoc\",\"status\":\"completed\",\"priority\":\"high\"},{\"id\":\"6\",\"content\":\"Verify all changes are complete by checking for any remaining references\",\"status\":\"completed\",\"priority\":\"medium\"}]},\"timestamp\":1762428204667,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_call\",\"id\":\"toolu_016VKmZCbRZV9az2XGjZkYVi\",\"messageId\":\"ca095d20-2790-4952-b577-b9b55ca5c5b8\",\"toolId\":\"Grep\",\"toolName\":\"Grep\",\"parameters\":{\"pattern\":\"preview.*\\\\[.*retriever|preview.*\\\\[.*rrf\",\"case_insensitive\":true,\"path\":\"/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpfnfjl2kw/workspace/docs/reference\",\"output_mode\":\"content\",\"line_numbers\":true},\"timestamp\":1762428204667,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_result\",\"id\":\"toolu_01RdaiKbX985TnueVw6RhvWV\",\"messageId\":\"0d979e7f-934a-49f7-808d-1f7113a24d1f\",\"toolId\":\"\",\"isError\":false,\"value\":\"docs/reference/search/suggesters/phrase-suggest.asciidoc\\ndocs/reference/search/suggesters/misc.asciidoc\\ndocs/reference/search/suggesters/context-suggest.asciidoc\\ndocs/reference/search/suggesters/term-suggest.asciidoc\\ndocs/reference/search/suggesters/completion-suggest.asciidoc\\ndocs/reference/search/async-search.asciidoc\\ndocs/reference/search/multi-search.asciidoc\\ndocs/reference/search/search-template-api.asciidoc\\ndocs/reference/search/search.asciidoc\\ndocs/reference/search/search-your-data/search-application-security.asciidoc\\ndocs/reference/search/search-your-data/filter-search-results.asciidoc\\ndocs/reference/search/search-your-data/paginate-search-results.asciidoc\\ndocs/reference/search/search-your-data/semantic-search-inference.asciidoc\\ndocs/reference/search/search-your-data/semantic-search-semantic-text.asciidoc\\ndocs/reference/search/search-your-data/sort-search-results.asciidoc\\ndocs/reference/search/search-your-data/retrieve-inner-hits.asciidoc\\ndocs/reference/search/search-your-data/behavioral-analytics/behavioral-analytics-event-reference.asciidoc\\ndocs/reference/search/search-your-data/behavioral-analytics/behavioral-analytics-overview.asciidoc\\ndocs/reference/search/search-your-data/behavioral-analytics/behavioral-analytics-api.asciidoc\\ndocs/reference/search/search-your-data/behavioral-analytics/behavioral-analytics-event.asciidoc\\n\\n\\n[Process exited with code 0]\",\"timestamp\":1762428211515,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"message\",\"role\":\"assistant\",\"id\":\"01a999c7-5b13-4462-97b7-21a2b7ea9e9d\",\"text\":\"Perfect! Now let me create a summary of all changes made. Let me verify the exact files that were modified:\",\"timestamp\":1762428211490,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_call\",\"id\":\"toolu_01RdaiKbX985TnueVw6RhvWV\",\"messageId\":\"01a999c7-5b13-4462-97b7-21a2b7ea9e9d\",\"toolId\":\"Execute\",\"toolName\":\"Execute\",\"parameters\":{\"command\":\"cd /private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpfnfjl2kw/workspace && find docs/reference/search -name \\\"*.asciidoc\\\" -type f | head -20\",\"riskLevelReason\":\"This find command only reads the directory structure without modifying any files.\",\"riskLevel\":\"low\"},\"timestamp\":1762428211490,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_result\",\"id\":\"toolu_01XLEACepE9a95nvDGPGPsoF\",\"messageId\":\"3a4490a5-3c62-4b47-bea3-dd811604af2e\",\"toolId\":\"\",\"isError\":false,\"value\":\"=== Files modified ===\\n1. docs/reference/search/retriever.asciidoc\\n2. docs/reference/search/rrf.asciidoc\\n3. docs/reference/search/search-your-data/retrievers-overview.asciidoc\\n\\n\\n[Process exited with code 0]\",\"timestamp\":1762428218019,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"message\",\"role\":\"assistant\",\"id\":\"e6175981-fcd1-438e-a75a-6178f3df9a14\",\"text\":\"Let me do a final comprehensive check by listing what we changed:\",\"timestamp\":1762428218008,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_call\",\"id\":\"toolu_01XLEACepE9a95nvDGPGPsoF\",\"messageId\":\"e6175981-fcd1-438e-a75a-6178f3df9a14\",\"toolId\":\"Execute\",\"toolName\":\"Execute\",\"parameters\":{\"command\":\"cd /private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpfnfjl2kw/workspace && echo \\\"=== Files modified ===\\\" && echo \\\"1. docs/reference/search/retriever.asciidoc\\\" && echo \\\"2. docs/reference/search/rrf.asciidoc\\\" && echo \\\"3. docs/reference/search/search-your-data/retrievers-overview.asciidoc\\\"\",\"riskLevelReason\":\"This echo command only displays text without modifying any files.\",\"riskLevel\":\"low\"},\"timestamp\":1762428218008,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_result\",\"id\":\"toolu_019wMPqN7WiXwZNA2JsY6NzL\",\"messageId\":\"44d6d724-f1be-4ff9-84ee-00ac174f6e0b\",\"toolId\":\"\",\"isError\":false,\"value\":\"No preview:: tags found in these files\\n\\n\\n[Process exited with code 0]\",\"timestamp\":1762428224041,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"message\",\"role\":\"assistant\",\"id\":\"2dd4bd22-0c8e-4082-a340-df85a5a77f8c\",\"text\":\"Perfect! Let me do one more verification to ensure the files were correctly modified by checking for any remaining \\\"preview::\\\" tags in the retriever/RRF related files:\",\"timestamp\":1762428224030,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_call\",\"id\":\"toolu_019wMPqN7WiXwZNA2JsY6NzL\",\"messageId\":\"2dd4bd22-0c8e-4082-a340-df85a5a77f8c\",\"toolId\":\"Execute\",\"toolName\":\"Execute\",\"parameters\":{\"command\":\"cd /private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpfnfjl2kw/workspace && grep -n \\\"preview::\\\" docs/reference/search/retriever.asciidoc docs/reference/search/rrf.asciidoc docs/reference/search/search-your-data/retrievers-overview.asciidoc 2>&1 || echo \\\"No preview:: tags found in these files\\\"\",\"riskLevelReason\":\"This grep command only reads file contents without making any modifications.\",\"riskLevel\":\"low\"},\"timestamp\":1762428224030,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_result\",\"id\":\"toolu_01WvqGfwpTpffJvfUv7Y1jXu\",\"messageId\":\"48482466-c0d9-48c6-9ed3-73bd6bfbb4d4\",\"toolId\":\"\",\"isError\":false,\"value\":\"[[retriever]]\\n=== Retriever\\n\\nA retriever is a specification to describe top documents returned from a\\nsearch. A retriever replaces other elements of the <<search-search, search API>>\\nthat also return top documents such as <<query-dsl, `query`>> and\\n<<search-api-knn, `knn`>>. A retriever may have child retrievers where a\\nretriever with two or more children is considered a compound retriever. This\\nallows for complex behavior to be depicted in a tree-like structure, called\\nthe retriever tree, to better clarify the order of operations that occur\\n---\\n[[rrf]]\\n=== Reciprocal rank fusion\\n\\nhttps://plg.uwaterloo.ca/~gvcormac/cormacksigir09-rrf.pdf[Reciprocal rank fusion (RRF)]\\nis a method for combining multiple result sets with different relevance indicators into a single result set.\\nRRF requires no tuning, and the different relevance indicators do not have to be related to each other to achieve high-quality results.\\n\\nRRF uses the following formula to determine the score for ranking each document:\\n\\n[source,python]\\n---\\n[[retrievers-overview]]\\n=== Retrievers\\n\\nA retriever is an abstraction that was added to the Search API in *8.14.0*.\\nThis abstraction enables the configuration of multi-stage retrieval pipelines within a single `_search` call.\\nThis simplifies your search application logic, because you no longer need to configure complex searches via multiple {es} calls or implement additional client-side logic to combine results from different queries.\\n\\nThis document provides a general overview of the retriever abstraction.\\nFor implementation details, including notable restrictions, check out the\\n<<retriever,reference documentation>> in the `_search` API docs.\\n\\n\\n[Process exited with code 0]\",\"timestamp\":1762428229740,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"message\",\"role\":\"assistant\",\"id\":\"7490abb8-d175-4775-ad28-a6564ac87643\",\"text\":\"Excellent! Now let me verify that we haven't accidentally broken anything by checking the structure of the files:\",\"timestamp\":1762428229730,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_call\",\"id\":\"toolu_01WvqGfwpTpffJvfUv7Y1jXu\",\"messageId\":\"7490abb8-d175-4775-ad28-a6564ac87643\",\"toolId\":\"Execute\",\"toolName\":\"Execute\",\"parameters\":{\"command\":\"cd /private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpfnfjl2kw/workspace && head -10 docs/reference/search/retriever.asciidoc && echo \\\"---\\\" && head -10 docs/reference/search/rrf.asciidoc && echo \\\"---\\\" && head -10 docs/reference/search/search-your-data/retrievers-overview.asciidoc\",\"riskLevelReason\":\"This head command only reads the first few lines of files without modifying them.\",\"riskLevel\":\"low\"},\"timestamp\":1762428229730,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_result\",\"id\":\"toolu_01CSpMyJC9k9vs38Jy9ozCPT\",\"messageId\":\"1d4a6424-e998-4436-b11a-6e0cd4f1d10b\",\"toolId\":\"\",\"isError\":false,\"value\":\"./search/rrf.asciidoc:239:We now execute a search using an `rrf` retriever with a `standard` retriever specifying a BM25 query, a `knn` retriever specifying a kNN search, and a terms aggregation.\",\"timestamp\":1762428237965,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_result\",\"id\":\"toolu_01JdBgScCWpkHeje212cdQum\",\"messageId\":\"1d4a6424-e998-4436-b11a-6e0cd4f1d10b\",\"toolId\":\"\",\"isError\":false,\"value\":\"No matches found\",\"timestamp\":1762428237965,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"message\",\"role\":\"assistant\",\"id\":\"cc5b14fe-bdc5-4dd7-9015-58358ff080dd\",\"text\":\"Perfect! All the changes look correct. Now let me do a final sanity check to make sure we haven't missed any other files that might reference retrievers or RRF as being in technical preview:\",\"timestamp\":1762428237925,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_call\",\"id\":\"toolu_01CSpMyJC9k9vs38Jy9ozCPT\",\"messageId\":\"cc5b14fe-bdc5-4dd7-9015-58358ff080dd\",\"toolId\":\"Grep\",\"toolName\":\"Grep\",\"parameters\":{\"pattern\":\"RRF.*GA|retriever.*GA\",\"case_insensitive\":true,\"path\":\"/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpfnfjl2kw/workspace/docs/reference\",\"output_mode\":\"content\",\"line_numbers\":true},\"timestamp\":1762428237925,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_call\",\"id\":\"toolu_01JdBgScCWpkHeje212cdQum\",\"messageId\":\"cc5b14fe-bdc5-4dd7-9015-58358ff080dd\",\"toolId\":\"Grep\",\"toolName\":\"Grep\",\"parameters\":{\"pattern\":\"syntax will.*change|may be changed or removed\",\"case_insensitive\":true,\"path\":\"/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpfnfjl2kw/workspace/docs/reference/search\",\"output_mode\":\"content\",\"line_numbers\":true},\"timestamp\":1762428237925,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_result\",\"id\":\"toolu_01KzmmCcuA4Zfqc3QYLitr1r\",\"messageId\":\"5a07c878-8318-4ee7-b969-fec48af8415c\",\"toolId\":\"\",\"isError\":false,\"value\":\"./hybrid-search-widget.asciidoc\",\"timestamp\":1762428245615,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_result\",\"id\":\"toolu_0129ZMyGHFobwwELV9B5Lf9g\",\"messageId\":\"5a07c878-8318-4ee7-b969-fec48af8415c\",\"toolId\":\"\",\"isError\":false,\"value\":\"// tag::elser[]\\n\\nHybrid search between a semantic and lexical query can be achieved by using an\\n<<rrf-retriever, `rrf` retriever>> as part of your search request. Provide a\\n`sparse_vector` query and a full-text query as\\n<<standard-retriever, `standard` retrievers>> for the `rrf` retriever. The `rrf`\\nretriever uses <<rrf, reciprocal rank fusion>> to rank the top documents.\\n\\n[source,console]\\n----\\nGET my-index/_search\\n{\\n  \\\"retriever\\\": {\\n    \\\"rrf\\\": {\\n      \\\"retrievers\\\": [\\n        {\\n          \\\"standard\\\": {\\n            \\\"query\\\": {\\n              \\\"match\\\": {\\n                \\\"my_text_field\\\": \\\"the query string\\\"\\n              }\\n            }\\n          }\\n        },\\n        {\\n          \\\"standard\\\": {\\n            \\\"query\\\": {\\n             \\\"sparse_vector\\\": {\\n                \\\"field\\\": \\\"my_tokens\\\",\\n                \\\"inference_id\\\": \\\"my-elser-endpoint\\\",\\n                \\\"query\\\": \\\"the query string\\\"\\n              }\\n            }\\n          }\\n        }\\n      ]\\n    }\\n  }\\n}\\n----\\n// TEST[skip:TBD]\\n\\n// end::elser[]\\n\\n\\n// tag::dense-vector[]\\n\\nHybrid search between a semantic and lexical query can be achieved by providing:\\n\\n* an `rrf` retriever to rank top documents using <<rrf, reciprocal rank fusion>>\\n\\n<system-reminder>[Showing lines 1-50 of 91 total lines]</system-reminder>\",\"timestamp\":1762428245615,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"message\",\"role\":\"assistant\",\"id\":\"580383a9-f938-46d1-80f8-ad40e7564160\",\"text\":\"Great! The only match is a reference to \\\"retriever\\\" in a normal context (not about tech preview status). Let me also check if there are any tab-widgets or other documentation that might reference retrievers:\",\"timestamp\":1762428245599,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_call\",\"id\":\"toolu_01KzmmCcuA4Zfqc3QYLitr1r\",\"messageId\":\"580383a9-f938-46d1-80f8-ad40e7564160\",\"toolId\":\"Grep\",\"toolName\":\"Grep\",\"parameters\":{\"pattern\":\"hybrid-search\",\"path\":\"/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpfnfjl2kw/workspace/docs/reference/tab-widgets/semantic-search\",\"output_mode\":\"file_paths\"},\"timestamp\":1762428245599,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_call\",\"id\":\"toolu_0129ZMyGHFobwwELV9B5Lf9g\",\"messageId\":\"580383a9-f938-46d1-80f8-ad40e7564160\",\"toolId\":\"Read\",\"toolName\":\"Read\",\"parameters\":{\"file_path\":\"/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpfnfjl2kw/workspace/docs/reference/tab-widgets/semantic-search/hybrid-search.asciidoc\",\"offset\":0,\"limit\":50},\"timestamp\":1762428245599,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"message\",\"role\":\"assistant\",\"id\":\"e64a4935-2869-4e61-be44-9625db3f2c97\",\"text\":\"Good! The hybrid-search documentation looks fine and doesn't have any tech preview warnings. Let me make one final comprehensive check across all documentation to ensure we haven't missed anything:\",\"timestamp\":1762428257549,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_call\",\"id\":\"toolu_019NHWdbjoAwRfU6WErjdpaW\",\"messageId\":\"e64a4935-2869-4e61-be44-9625db3f2c97\",\"toolId\":\"Execute\",\"toolName\":\"Execute\",\"parameters\":{\"command\":\"cd /private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpfnfjl2kw/workspace && grep -r \\\"technical preview.*retriever\\\\|tech preview.*retriever\\\\|retriever.*technical preview\\\\|retriever.*tech preview\\\" docs/reference/ 2>&1 | grep -v \\\"Binary file\\\" | head -20 || echo \\\"No tech preview references found for retrievers\\\"\",\"riskLevelReason\":\"This grep command only reads file contents to search for patterns without making any modifications.\",\"riskLevel\":\"low\"},\"timestamp\":1762428257549,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_call\",\"id\":\"toolu_014bBXq9ZC8bfXJNM17ZsMUt\",\"messageId\":\"e64a4935-2869-4e61-be44-9625db3f2c97\",\"toolId\":\"Execute\",\"toolName\":\"Execute\",\"parameters\":{\"command\":\"cd /private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpfnfjl2kw/workspace && grep -r \\\"technical preview.*RRF\\\\|tech preview.*RRF\\\\|RRF.*technical preview\\\\|RRF.*tech preview\\\" docs/reference/ 2>&1 | grep -v \\\"Binary file\\\" | head -20 || echo \\\"No tech preview references found for RRF\\\"\",\"riskLevelReason\":\"This grep command only reads file contents to search for patterns without making any modifications.\",\"riskLevel\":\"low\"},\"timestamp\":1762428257549,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_result\",\"id\":\"toolu_019NHWdbjoAwRfU6WErjdpaW\",\"messageId\":\"5c65c941-06b4-42b0-ad29-25785ca94e21\",\"toolId\":\"Execute\",\"isError\":false,\"value\":\"Command completed successfully\\n\\n[Process exited with code 0]\",\"timestamp\":1762428262622,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_result\",\"id\":\"toolu_014bBXq9ZC8bfXJNM17ZsMUt\",\"messageId\":\"5c65c941-06b4-42b0-ad29-25785ca94e21\",\"toolId\":\"Execute\",\"isError\":false,\"value\":\"Command completed successfully\\n\\n[Process exited with code 0]\",\"timestamp\":1762428262622,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"message\",\"role\":\"assistant\",\"id\":\"39c5da1b-6d3c-4915-a081-4f86de5c1a50\",\"text\":\"Perfect! Let me run one more check to make sure the output was complete:\",\"timestamp\":1762428269873,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_call\",\"id\":\"toolu_014kRU3hpcq6VCJQGYW3TP9X\",\"messageId\":\"39c5da1b-6d3c-4915-a081-4f86de5c1a50\",\"toolId\":\"Execute\",\"toolName\":\"Execute\",\"parameters\":{\"command\":\"cd /private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpfnfjl2kw/workspace && echo \\\"Checking for any remaining tech preview references...\\\" && if grep -r \\\"technical preview.*retriever\\\\|tech preview.*retriever\\\\|retriever.*technical preview\\\\|retriever.*tech preview\\\" docs/reference/ 2>/dev/null | grep -v \\\"Binary file\\\"; then echo \\\"Found references!\\\"; else echo \\\"\u2713 No tech preview references found for retrievers\\\"; fi\",\"riskLevelReason\":\"This grep command only reads file contents to search for patterns without making any modifications.\",\"riskLevel\":\"low\"},\"timestamp\":1762428269873,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_call\",\"id\":\"toolu_01SrYtMa7ExP2joHv4sKL4pc\",\"messageId\":\"39c5da1b-6d3c-4915-a081-4f86de5c1a50\",\"toolId\":\"Execute\",\"toolName\":\"Execute\",\"parameters\":{\"command\":\"cd /private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpfnfjl2kw/workspace && if grep -r \\\"technical preview.*RRF\\\\|tech preview.*RRF\\\\|RRF.*technical preview\\\\|RRF.*tech preview\\\" docs/reference/ 2>/dev/null | grep -v \\\"Binary file\\\"; then echo \\\"Found references!\\\"; else echo \\\"\u2713 No tech preview references found for RRF\\\"; fi\",\"riskLevelReason\":\"This grep command only reads file contents to search for patterns without making any modifications.\",\"riskLevel\":\"low\"},\"timestamp\":1762428269873,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_result\",\"id\":\"toolu_014kRU3hpcq6VCJQGYW3TP9X\",\"messageId\":\"a441685a-bf7d-4cde-9a43-ba3a4237dc5c\",\"toolId\":\"Execute\",\"isError\":false,\"value\":\"Checking for any remaining tech preview references...\\n\u2713 No tech preview references found for retrievers\\n\\n\\n[Process exited with code 0]\",\"timestamp\":1762428274899,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n{\"type\":\"tool_result\",\"id\":\"toolu_01SrYtMa7ExP2joHv4sKL4pc\",\"messageId\":\"a441685a-bf7d-4cde-9a43-ba3a4237dc5c\",\"toolId\":\"Execute\",\"isError\":false,\"value\":\"\u2713 No tech preview references found for RRF\\n\\n\\n[Process exited with code 0]\",\"timestamp\":1762428274899,\"session_id\":\"a3e2259c-c301-4ff2-8a97-f18058c77939\"}\n", "stderr": "", "returncode": 0}
