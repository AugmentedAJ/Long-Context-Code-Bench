{
  "repo_url": "https://github.com/elastic/elasticsearch.git",
  "pr_number": 114920,
  "base_commit": "f6a1e36d6be56a5d480765ad2d5f72f4adcaef5b",
  "runner": "factory",
  "model": "claude-sonnet-4-5-20250929",
  "timeout_s": 7200,
  "status": "success",
  "elapsed_ms": 278819,
  "patch_unified": "diff --git a/server/src/main/java/org/elasticsearch/common/file/AbstractFileWatchingService.java b/server/src/main/java/org/elasticsearch/common/file/AbstractFileWatchingService.java\nindex dcb28a17..39f7aead 100644\n--- a/server/src/main/java/org/elasticsearch/common/file/AbstractFileWatchingService.java\n+++ b/server/src/main/java/org/elasticsearch/common/file/AbstractFileWatchingService.java\n@@ -220,6 +220,11 @@ public abstract class AbstractFileWatchingService extends AbstractLifecycleCompo\n                         }\n                     } catch (IOException e) {\n                         logger.warn(\"encountered I/O error while watching file settings\", e);\n+                    } catch (ExecutionException e) {\n+                        // ExecutionException wrapping FailedToCommitClusterStateException is rethrown to the outer catch\n+                        // block where it's handled as a terminal error, causing the watcher thread to shut down.\n+                        // All other ExecutionExceptions are already handled in processSettingsAndNotifyListeners().\n+                        throw e;\n                     }\n                 } else {\n                     key.pollEvents();\n@@ -228,6 +233,16 @@ public abstract class AbstractFileWatchingService extends AbstractLifecycleCompo\n             }\n         } catch (ClosedWatchServiceException | InterruptedException expected) {\n             logger.info(\"shutting down watcher thread\");\n+        } catch (ExecutionException e) {\n+            if (e.getCause() instanceof org.elasticsearch.cluster.coordination.FailedToCommitClusterStateException) {\n+                // FailedToCommitClusterStateException is a terminal error that indicates cluster state publication\n+                // failed. We don't log this as a generic \"Error processing watched file\" to allow for different\n+                // alerting strategies, but we do log it as a watcher thread shutdown.\n+                logger.error(\"shutting down watcher thread due to cluster state publication failure\", e);\n+            } else {\n+                // This should not happen as other ExecutionExceptions are handled in processSettingsAndNotifyListeners()\n+                logger.error(\"shutting down watcher thread with exception\", e);\n+            }\n         } catch (Exception e) {\n             logger.error(\"shutting down watcher thread with exception\", e);\n         }\n@@ -290,13 +305,21 @@ public abstract class AbstractFileWatchingService extends AbstractLifecycleCompo\n         } while (true);\n     }\n \n-    void processSettingsAndNotifyListeners() throws InterruptedException {\n+    void processSettingsAndNotifyListeners() throws InterruptedException, ExecutionException {\n         try {\n             processFileChanges();\n             for (var listener : eventListeners) {\n                 listener.watchedFileChanged();\n             }\n-        } catch (IOException | ExecutionException e) {\n+        } catch (ExecutionException e) {\n+            // Check if the cause is FailedToCommitClusterStateException, which indicates a cluster state publication\n+            // failure. These failures have different alerting requirements and should not be logged as generic file\n+            // processing errors. The exception is rethrown as ExecutionException to maintain the method signature.\n+            if (e.getCause() instanceof org.elasticsearch.cluster.coordination.FailedToCommitClusterStateException) {\n+                throw e;\n+            }\n+            logger.error(() -> \"Error processing watched file: \" + watchedFile(), e);\n+        } catch (IOException e) {\n             logger.error(() -> \"Error processing watched file: \" + watchedFile(), e);\n         }\n     }\ndiff --git a/server/src/test/java/org/elasticsearch/common/file/AbstractFileWatchingServiceTests.java b/server/src/test/java/org/elasticsearch/common/file/AbstractFileWatchingServiceTests.java\nindex ebf1064c..90e6517f 100644\n--- a/server/src/test/java/org/elasticsearch/common/file/AbstractFileWatchingServiceTests.java\n+++ b/server/src/test/java/org/elasticsearch/common/file/AbstractFileWatchingServiceTests.java\n@@ -194,6 +194,47 @@ public class AbstractFileWatchingServiceTests extends ESTestCase {\n         verify(service, times(2)).retryDelayMillis(anyInt());\n     }\n \n+    public void testProcessSettingsWithFailedToCommitClusterStateException() throws Exception {\n+        var service = new TestFileWatchingService(getWatchedFilePath(env)) {\n+            @Override\n+            protected void processFileChanges() throws ExecutionException {\n+                throw new ExecutionException(\n+                    new org.elasticsearch.cluster.coordination.FailedToCommitClusterStateException(\"test failure\")\n+                );\n+            }\n+        };\n+\n+        // FailedToCommitClusterStateException wrapped in ExecutionException should be rethrown\n+        ExecutionException thrown = assertThrows(ExecutionException.class, service::processSettingsAndNotifyListeners);\n+        assertTrue(thrown.getCause() instanceof org.elasticsearch.cluster.coordination.FailedToCommitClusterStateException);\n+    }\n+\n+    public void testProcessSettingsWithOtherExecutionException() throws Exception {\n+        var service = new TestFileWatchingService(getWatchedFilePath(env)) {\n+            @Override\n+            protected void processFileChanges() throws ExecutionException {\n+                throw new ExecutionException(new RuntimeException(\"other error\"));\n+            }\n+        };\n+\n+        // Other ExecutionExceptions should be caught and logged, not rethrown\n+        service.processSettingsAndNotifyListeners();\n+        // If we reach here without exception, the test passes\n+    }\n+\n+    public void testProcessSettingsWithIOException() throws Exception {\n+        var service = new TestFileWatchingService(getWatchedFilePath(env)) {\n+            @Override\n+            protected void processFileChanges() throws IOException {\n+                throw new IOException(\"IO error\");\n+            }\n+        };\n+\n+        // IOException should be caught and logged, not rethrown\n+        service.processSettingsAndNotifyListeners();\n+        // If we reach here without exception, the test passes\n+    }\n+\n     // helpers\n     private void writeTestFile(Path path, String contents) throws IOException {\n         Path tempFilePath = createTempFile();",
  "logs_path": "factory/claude-sonnet-4-5-20250929/074538b9/elastic_elasticsearch_pr114920/logs.jsonl",
  "errors": [],
  "edit_run_id": "074538b9",
  "test_label": "v0"
}