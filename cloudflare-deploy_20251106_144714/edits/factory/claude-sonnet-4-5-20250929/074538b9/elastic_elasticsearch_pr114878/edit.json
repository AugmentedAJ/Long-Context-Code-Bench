{
  "repo_url": "https://github.com/elastic/elasticsearch.git",
  "pr_number": 114878,
  "base_commit": "87987e7c6ad5e02c7b8ca6bf3c213243abdc026e",
  "runner": "factory",
  "model": "claude-sonnet-4-5-20250929",
  "timeout_s": 7200,
  "status": "success",
  "elapsed_ms": 646966,
  "patch_unified": "diff --git a/x-pack/plugin/otel-data/src/main/resources/component-templates/metrics-otel@mappings.yaml b/x-pack/plugin/otel-data/src/main/resources/component-templates/metrics-otel@mappings.yaml\nindex 37dd93b7..d2df9b56 100644\n--- a/x-pack/plugin/otel-data/src/main/resources/component-templates/metrics-otel@mappings.yaml\n+++ b/x-pack/plugin/otel-data/src/main/resources/component-templates/metrics-otel@mappings.yaml\n@@ -3,6 +3,8 @@ _meta:\n   description: Default mappings for the OpenTelemetry metrics index template installed by x-pack\n   managed: true\n template:\n+  settings:\n+    index.mapping.ignore_malformed: true\n   mappings:\n     properties:\n       start_timestamp:\n@@ -19,27 +21,22 @@ template:\n       - histogram:\n           mapping:\n             type: histogram\n-            ignore_malformed: true\n       - counter_long:\n           mapping:\n             type: long\n             time_series_metric: counter\n-            ignore_malformed: true\n       - gauge_long:\n           mapping:\n             type: long\n             time_series_metric: gauge\n-            ignore_malformed: true\n       - counter_double:\n           mapping:\n             type: double\n             time_series_metric: counter\n-            ignore_malformed: true\n       - gauge_double:\n           mapping:\n             type: double\n             time_series_metric: gauge\n-            ignore_malformed: true\n       - summary:\n           mapping:\n             type: aggregate_metric_double\ndiff --git a/x-pack/plugin/otel-data/src/main/resources/index-templates/metrics-otel@template.yaml b/x-pack/plugin/otel-data/src/main/resources/index-templates/metrics-otel@template.yaml\nindex 3b4c3127..f8489605 100644\n--- a/x-pack/plugin/otel-data/src/main/resources/index-templates/metrics-otel@template.yaml\n+++ b/x-pack/plugin/otel-data/src/main/resources/index-templates/metrics-otel@template.yaml\n@@ -27,14 +27,3 @@ template:\n       data_stream.type:\n         type: constant_keyword\n         value: metrics\n-    dynamic_templates:\n-      - ecs_ip:\n-          mapping:\n-            type: ip\n-          path_match: [ \"ip\", \"*.ip\", \"*_ip\" ]\n-          match_mapping_type: string\n-      - all_strings_to_keywords:\n-          mapping:\n-            ignore_above: 1024\n-            type: keyword\n-          match_mapping_type: string\ndiff --git a/x-pack/plugin/otel-data/src/main/resources/resources.yaml b/x-pack/plugin/otel-data/src/main/resources/resources.yaml\nindex 52873287..b2d30c7f 100644\n--- a/x-pack/plugin/otel-data/src/main/resources/resources.yaml\n+++ b/x-pack/plugin/otel-data/src/main/resources/resources.yaml\n@@ -1,7 +1,7 @@\n # \"version\" holds the version of the templates and ingest pipelines installed\n # by xpack-plugin otel-data. This must be increased whenever an existing template is\n # changed, in order for it to be updated on Elasticsearch upgrade.\n-version: 5\n+version: 6\n \n component-templates:\n   - otel@mappings\ndiff --git a/x-pack/plugin/otel-data/src/yamlRestTest/resources/rest-api-spec/test/20_metrics_tests.yml b/x-pack/plugin/otel-data/src/yamlRestTest/resources/rest-api-spec/test/20_metrics_tests.yml\nindex 81aded9c..1aafe376 100644\n--- a/x-pack/plugin/otel-data/src/yamlRestTest/resources/rest-api-spec/test/20_metrics_tests.yml\n+++ b/x-pack/plugin/otel-data/src/yamlRestTest/resources/rest-api-spec/test/20_metrics_tests.yml\n@@ -245,3 +245,37 @@ IP dimensions:\n   - match: { .$idx0name.mappings.properties.metrics.properties.summary.type: 'aggregate_metric_double' }\n   - match: { .$idx0name.mappings.properties.metrics.properties.summary_minmax.type: 'aggregate_metric_double' }\n   - match: { .$idx0name.mappings.properties.metrics.properties.histogram.type: 'histogram' }\n+---\n+Empty IP field:\n+  - do:\n+      bulk:\n+        index: metrics-generic.otel-default\n+        refresh: true\n+        body:\n+          - create: {\"dynamic_templates\":{\"metrics.foo.bar\":\"counter_long\"}}\n+          - \"@timestamp\": 2024-07-18T14:48:33.467654000Z\n+            resource:\n+              attributes:\n+                host.name: localhost\n+                host.ip: \"\"\n+            metrics:\n+              foo.bar: 42\n+  - is_false: errors\n+\n+  - do:\n+      indices.get_data_stream:\n+        name: metrics-generic.otel-default\n+  - set: { data_streams.0.indices.0.index_name: idx0name }\n+\n+  - do:\n+      indices.get_mapping:\n+        index: $idx0name\n+        expand_wildcards: hidden\n+  - match: { .$idx0name.mappings.properties.resource.properties.attributes.properties.host\\.ip.type: 'ip' }\n+  - do:\n+      search:\n+        index: metrics-generic.otel-default\n+        body:\n+          fields: [\"*\"]\n+  - length: { hits.hits: 1 }\n+  - match: { hits.hits.0._ignored: [\"resource.attributes.host.ip\"] }",
  "logs_path": "factory/claude-sonnet-4-5-20250929/074538b9/elastic_elasticsearch_pr114878/logs.jsonl",
  "errors": [],
  "edit_run_id": "074538b9",
  "test_label": "v0"
}