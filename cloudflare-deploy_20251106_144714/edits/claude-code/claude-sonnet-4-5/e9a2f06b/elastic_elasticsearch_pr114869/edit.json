{
  "repo_url": "https://github.com/elastic/elasticsearch.git",
  "pr_number": 114869,
  "base_commit": "2aec12c17383de5da35664d9160904b668944364",
  "runner": "claude-code",
  "model": "claude-sonnet-4-5",
  "timeout_s": 1800,
  "status": "success",
  "elapsed_ms": 386673,
  "patch_unified": "diff --git a/qa/smoke-test-http/src/javaRestTest/java/org/elasticsearch/http/IncrementalBulkRestIT.java b/qa/smoke-test-http/src/javaRestTest/java/org/elasticsearch/http/IncrementalBulkRestIT.java\nindex da050116..8c5d4ba0 100644\n--- a/qa/smoke-test-http/src/javaRestTest/java/org/elasticsearch/http/IncrementalBulkRestIT.java\n+++ b/qa/smoke-test-http/src/javaRestTest/java/org/elasticsearch/http/IncrementalBulkRestIT.java\n@@ -27,13 +27,15 @@ import static org.hamcrest.CoreMatchers.containsString;\n import static org.hamcrest.Matchers.equalTo;\n \n @ESIntegTestCase.ClusterScope(scope = ESIntegTestCase.Scope.SUITE, supportsDedicatedMasters = false, numDataNodes = 2, numClientNodes = 0)\n-public class IncrementalBulkRestIT extends HttpSmokeTestCase {\n+public class BulkRestIT extends HttpSmokeTestCase {\n+\n+    private final boolean useIncrementalBulk = randomBoolean();\n \n     @Override\n     protected Settings nodeSettings(int nodeOrdinal, Settings otherSettings) {\n         return Settings.builder()\n             .put(super.nodeSettings(nodeOrdinal, otherSettings))\n-            .put(IncrementalBulkService.INCREMENTAL_BULK.getKey(), true)\n+            .put(IncrementalBulkService.INCREMENTAL_BULK.getKey(), useIncrementalBulk)\n             .build();\n     }\n \n@@ -64,7 +66,7 @@ public class IncrementalBulkRestIT extends HttpSmokeTestCase {\n         assertThat(responseException.getMessage(), containsString(\"could not parse bulk request body\"));\n     }\n \n-    public void testIncrementalBulk() throws IOException {\n+    public void testBulk() throws IOException {\n         Request createRequest = new Request(\"PUT\", \"/index_name\");\n         createRequest.setJsonEntity(\"\"\"\n             {\n@@ -137,7 +139,7 @@ public class IncrementalBulkRestIT extends HttpSmokeTestCase {\n         }\n     }\n \n-    public void testIncrementalMalformed() throws IOException {\n+    public void testBulkMalformed() throws IOException {\n         Request createRequest = new Request(\"PUT\", \"/index_name\");\n         createRequest.setJsonEntity(\"\"\"\n             {\n@@ -163,7 +165,9 @@ public class IncrementalBulkRestIT extends HttpSmokeTestCase {\n \n         bulkRequest.setJsonEntity(bulk.toString());\n \n-        expectThrows(ResponseException.class, () -> getRestClient().performRequest(bulkRequest));\n+        ResponseException responseException = expectThrows(ResponseException.class, () -> getRestClient().performRequest(bulkRequest));\n+        assertEquals(400, responseException.getResponse().getStatusLine().getStatusCode());\n+        assertThat(responseException.getMessage(), containsString(\"could not parse bulk request body\"));\n     }\n \n     @SuppressWarnings(\"unchecked\")\ndiff --git a/server/src/main/java/org/elasticsearch/rest/action/document/RestBulkAction.java b/server/src/main/java/org/elasticsearch/rest/action/document/RestBulkAction.java\nindex 03694c74..c8e693df 100644\n--- a/server/src/main/java/org/elasticsearch/rest/action/document/RestBulkAction.java\n+++ b/server/src/main/java/org/elasticsearch/rest/action/document/RestBulkAction.java\n@@ -104,19 +104,23 @@ public class RestBulkAction extends BaseRestHandler {\n             boolean defaultRequireDataStream = request.paramAsBoolean(DocWriteRequest.REQUIRE_DATA_STREAM, false);\n             bulkRequest.timeout(request.paramAsTime(\"timeout\", BulkShardRequest.DEFAULT_TIMEOUT));\n             bulkRequest.setRefreshPolicy(request.param(\"refresh\"));\n-            bulkRequest.add(\n-                request.requiredContent(),\n-                defaultIndex,\n-                defaultRouting,\n-                defaultFetchSourceContext,\n-                defaultPipeline,\n-                defaultRequireAlias,\n-                defaultRequireDataStream,\n-                defaultListExecutedPipelines,\n-                allowExplicitIndex,\n-                request.getXContentType(),\n-                request.getRestApiVersion()\n-            );\n+            try {\n+                bulkRequest.add(\n+                    request.requiredContent(),\n+                    defaultIndex,\n+                    defaultRouting,\n+                    defaultFetchSourceContext,\n+                    defaultPipeline,\n+                    defaultRequireAlias,\n+                    defaultRequireDataStream,\n+                    defaultListExecutedPipelines,\n+                    allowExplicitIndex,\n+                    request.getXContentType(),\n+                    request.getRestApiVersion()\n+                );\n+            } catch (Exception e) {\n+                throw new ElasticsearchParseException(\"could not parse bulk request body\", e);\n+            }\n \n             return channel -> client.bulk(bulkRequest, new RestRefCountedChunkedToXContentListener<>(channel));\n         } else {",
  "logs_path": "claude-code/claude-sonnet-4-5/e9a2f06b/elastic_elasticsearch_pr114869/logs.jsonl",
  "errors": [],
  "edit_run_id": "e9a2f06b",
  "test_label": "v0"
}