{
  "repo_url": "https://github.com/elastic/elasticsearch.git",
  "pr_number": 114869,
  "base_commit": "2aec12c17383de5da35664d9160904b668944364",
  "runner": "claude-code",
  "model": "claude-sonnet-4-5",
  "timeout_s": 1800,
  "status": "success",
  "elapsed_ms": 473770,
  "patch_unified": "diff --git a/qa/smoke-test-http/src/javaRestTest/java/org/elasticsearch/http/IncrementalBulkRestIT.java b/qa/smoke-test-http/src/javaRestTest/java/org/elasticsearch/http/IncrementalBulkRestIT.java\nindex da050116..e11631b6 100644\n--- a/qa/smoke-test-http/src/javaRestTest/java/org/elasticsearch/http/IncrementalBulkRestIT.java\n+++ b/qa/smoke-test-http/src/javaRestTest/java/org/elasticsearch/http/IncrementalBulkRestIT.java\n@@ -27,13 +27,15 @@ import static org.hamcrest.CoreMatchers.containsString;\n import static org.hamcrest.Matchers.equalTo;\n \n @ESIntegTestCase.ClusterScope(scope = ESIntegTestCase.Scope.SUITE, supportsDedicatedMasters = false, numDataNodes = 2, numClientNodes = 0)\n-public class IncrementalBulkRestIT extends HttpSmokeTestCase {\n+public class BulkRestIT extends HttpSmokeTestCase {\n+\n+    private final boolean incrementalBulk = randomBoolean();\n \n     @Override\n     protected Settings nodeSettings(int nodeOrdinal, Settings otherSettings) {\n         return Settings.builder()\n             .put(super.nodeSettings(nodeOrdinal, otherSettings))\n-            .put(IncrementalBulkService.INCREMENTAL_BULK.getKey(), true)\n+            .put(IncrementalBulkService.INCREMENTAL_BULK.getKey(), incrementalBulk)\n             .build();\n     }\n \n@@ -64,7 +66,7 @@ public class IncrementalBulkRestIT extends HttpSmokeTestCase {\n         assertThat(responseException.getMessage(), containsString(\"could not parse bulk request body\"));\n     }\n \n-    public void testIncrementalBulk() throws IOException {\n+    public void testBulk() throws IOException {\n         Request createRequest = new Request(\"PUT\", \"/index_name\");\n         createRequest.setJsonEntity(\"\"\"\n             {\n@@ -137,7 +139,7 @@ public class IncrementalBulkRestIT extends HttpSmokeTestCase {\n         }\n     }\n \n-    public void testIncrementalMalformed() throws IOException {\n+    public void testBulkMalformed() throws IOException {\n         Request createRequest = new Request(\"PUT\", \"/index_name\");\n         createRequest.setJsonEntity(\"\"\"\n             {\ndiff --git a/server/src/main/java/org/elasticsearch/action/bulk/BulkRequestParser.java b/server/src/main/java/org/elasticsearch/action/bulk/BulkRequestParser.java\nindex cd74989e..62561e3b 100644\n--- a/server/src/main/java/org/elasticsearch/action/bulk/BulkRequestParser.java\n+++ b/server/src/main/java/org/elasticsearch/action/bulk/BulkRequestParser.java\n@@ -9,6 +9,7 @@\n \n package org.elasticsearch.action.bulk;\n \n+import org.elasticsearch.ElasticsearchParseException;\n import org.elasticsearch.action.DocWriteRequest;\n import org.elasticsearch.action.delete.DeleteRequest;\n import org.elasticsearch.action.index.IndexRequest;\n@@ -93,7 +94,7 @@ public final class BulkRequestParser {\n             return res;\n         }\n         if (from != data.length() && isIncremental == false) {\n-            throw new IllegalArgumentException(\"The bulk request must be terminated by a newline [\\\\n]\");\n+            throw new ElasticsearchParseException(\"The bulk request must be terminated by a newline [\\\\n]\");\n         }\n         return res;\n     }\n@@ -204,7 +205,7 @@ public final class BulkRequestParser {\n                     continue;\n                 }\n                 if (token != XContentParser.Token.START_OBJECT) {\n-                    throw new IllegalArgumentException(\n+                    throw new ElasticsearchParseException(\n                         \"Malformed action/metadata line [\"\n                             + line\n                             + \"], expected \"\n@@ -217,7 +218,7 @@ public final class BulkRequestParser {\n                 // Move to FIELD_NAME, that's the action\n                 token = parser.nextToken();\n                 if (token != XContentParser.Token.FIELD_NAME) {\n-                    throw new IllegalArgumentException(\n+                    throw new ElasticsearchParseException(\n                         \"Malformed action/metadata line [\"\n                             + line\n                             + \"], expected \"\n@@ -229,7 +230,7 @@ public final class BulkRequestParser {\n                 }\n                 String action = parser.currentName();\n                 if (SUPPORTED_ACTIONS.contains(action) == false) {\n-                    throw new IllegalArgumentException(\n+                    throw new ElasticsearchParseException(\n                         \"Malformed action/metadata line [\"\n                             + line\n                             + \"], expected field [create], [delete], [index] or [update] but found [\"\n@@ -267,7 +268,7 @@ public final class BulkRequestParser {\n                         } else if (token.isValue()) {\n                             if (INDEX.match(currentFieldName, parser.getDeprecationHandler())) {\n                                 if (allowExplicitIndex == false) {\n-                                    throw new IllegalArgumentException(\"explicit index in bulk is not allowed\");\n+                                    throw new ElasticsearchParseException(\"explicit index in bulk is not allowed\");\n                                 }\n                                 index = stringDeduplicator.computeIfAbsent(parser.text(), Function.identity());\n                             } else if (TYPE.match(currentFieldName, parser.getDeprecationHandler())) {\n@@ -279,7 +280,7 @@ public final class BulkRequestParser {\n                                     }\n                                 } else if (parser.getRestApiVersion().matches(RestApiVersion.onOrAfter(RestApiVersion.V_8))\n                                     && deprecateOrErrorOnType) {\n-                                        throw new IllegalArgumentException(\n+                                        throw new ElasticsearchParseException(\n                                             \"Action/metadata line [\" + line + \"] contains an unknown parameter [\" + currentFieldName + \"]\"\n                                         );\n                                     }\n@@ -311,12 +312,12 @@ public final class BulkRequestParser {\n                             } else if (LIST_EXECUTED_PIPELINES.match(currentFieldName, parser.getDeprecationHandler())) {\n                                 listExecutedPipelines = parser.booleanValue();\n                             } else {\n-                                throw new IllegalArgumentException(\n+                                throw new ElasticsearchParseException(\n                                     \"Action/metadata line [\" + line + \"] contains an unknown parameter [\" + currentFieldName + \"]\"\n                                 );\n                             }\n                         } else if (token == XContentParser.Token.START_ARRAY) {\n-                            throw new IllegalArgumentException(\n+                            throw new ElasticsearchParseException(\n                                 \"Malformed action/metadata line [\"\n                                     + line\n                                     + \"], expected a simple value for field [\"\n@@ -332,7 +333,7 @@ public final class BulkRequestParser {\n                                 && SOURCE.match(currentFieldName, parser.getDeprecationHandler())) {\n                                     fetchSourceContext = FetchSourceContext.fromXContent(parser);\n                                 } else if (token != XContentParser.Token.VALUE_NULL) {\n-                                    throw new IllegalArgumentException(\n+                                    throw new ElasticsearchParseException(\n                                         \"Malformed action/metadata line [\"\n                                             + line\n                                             + \"], expected a simple value for field [\"\n@@ -344,7 +345,7 @@ public final class BulkRequestParser {\n                                 }\n                     }\n                 } else if (token != XContentParser.Token.END_OBJECT) {\n-                    throw new IllegalArgumentException(\n+                    throw new ElasticsearchParseException(\n                         \"Malformed action/metadata line [\"\n                             + line\n                             + \"], expected \"\n@@ -360,7 +361,7 @@ public final class BulkRequestParser {\n \n                 if (\"delete\".equals(action)) {\n                     if (dynamicTemplates.isEmpty() == false) {\n-                        throw new IllegalArgumentException(\n+                        throw new ElasticsearchParseException(\n                             \"Delete request in line [\" + line + \"] does not accept \" + DYNAMIC_TEMPLATES.getPreferredName()\n                         );\n                     }\n@@ -403,19 +404,19 @@ public final class BulkRequestParser {\n                         indexRequestConsumer.accept(indexRequest, type);\n                     } else if (\"update\".equals(action)) {\n                         if (version != Versions.MATCH_ANY || versionType != VersionType.INTERNAL) {\n-                            throw new IllegalArgumentException(\n+                            throw new ElasticsearchParseException(\n                                 \"Update requests do not support versioning. \" + \"Please use `if_seq_no` and `if_primary_term` instead\"\n                             );\n                         }\n                         if (requireDataStream) {\n-                            throw new IllegalArgumentException(\n+                            throw new ElasticsearchParseException(\n                                 \"Update requests do not support the `require_data_stream` flag, \"\n                                     + \"as data streams do not support update operations\"\n                             );\n                         }\n                         // TODO: support dynamic_templates in update requests\n                         if (dynamicTemplates.isEmpty() == false) {\n-                            throw new IllegalArgumentException(\n+                            throw new ElasticsearchParseException(\n                                 \"Update request in line [\" + line + \"] does not accept \" + DYNAMIC_TEMPLATES.getPreferredName()\n                             );\n                         }",
  "logs_path": "claude-code/claude-sonnet-4-5/dd30913d/elastic_elasticsearch_pr114869/logs.jsonl",
  "errors": [],
  "edit_run_id": "dd30913d",
  "test_label": "v0"
}