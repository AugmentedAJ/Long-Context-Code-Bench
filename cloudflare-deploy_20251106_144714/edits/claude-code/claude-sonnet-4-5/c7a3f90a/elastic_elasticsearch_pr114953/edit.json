{
  "repo_url": "https://github.com/elastic/elasticsearch.git",
  "pr_number": 114953,
  "base_commit": "9922d544a144c4e6a9f5bee806c39338f637b645",
  "runner": "claude-code",
  "model": "claude-sonnet-4-5",
  "timeout_s": 1200,
  "status": "success",
  "elapsed_ms": 460118,
  "patch_unified": "diff --git a/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/action/EsqlCapabilities.java b/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/action/EsqlCapabilities.java\nindex 18ebbe6d..c9479196 100644\n--- a/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/action/EsqlCapabilities.java\n+++ b/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/action/EsqlCapabilities.java\n@@ -375,7 +375,7 @@ public class EsqlCapabilities {\n         /**\n          * Support named parameters for field names.\n          */\n-        NAMED_PARAMETER_FOR_FIELD_AND_FUNCTION_NAMES,\n+        NAMED_PARAMETER_FOR_FIELD_AND_FUNCTION_NAMES(true),\n \n         /**\n          * Fix sorting not allowed on _source and counters.\ndiff --git a/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/parser/ExpressionBuilder.java b/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/parser/ExpressionBuilder.java\nindex cda118ad..5bd44545 100644\n--- a/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/parser/ExpressionBuilder.java\n+++ b/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/parser/ExpressionBuilder.java\n@@ -315,6 +315,12 @@ public abstract class ExpressionBuilder extends IdentifierBuilder {\n                 unresolvedStar = true;\n             }\n             if (idCtx.parameter() != null) {\n+                if (Build.current().isSnapshot() == false) {\n+                    throw new ParsingException(\n+                        src,\n+                        \"Using a parameter as an identifier or a pattern is only supported in snapshot build\"\n+                    );\n+                }\n                 Expression exp = expression(idCtx.parameter());\n                 if (exp instanceof Literal lit) {\n                     if (lit.value() != null) {\n@@ -351,6 +357,12 @@ public abstract class ExpressionBuilder extends IdentifierBuilder {\n             if (pattern.ID_PATTERN() != null) {\n                 patternContext = pattern.ID_PATTERN().getText();\n             } else if (pattern.parameter() != null) {\n+                if (Build.current().isSnapshot() == false) {\n+                    throw new ParsingException(\n+                        src,\n+                        \"Using a parameter as an identifier or a pattern is only supported in snapshot build\"\n+                    );\n+                }\n                 Expression exp = expression(pattern.parameter());\n                 if (exp instanceof Literal lit) {\n                     // only Literal.NULL can happen with missing params, params for constants are not allowed\n@@ -626,6 +638,13 @@ public abstract class ExpressionBuilder extends IdentifierBuilder {\n             return visitIdentifier(ctx.identifier());\n         }\n \n+        if (Build.current().isSnapshot() == false) {\n+            throw new ParsingException(\n+                source(ctx),\n+                \"Using a parameter as an identifier or a pattern is only supported in snapshot build\"\n+            );\n+        }\n+\n         return unresolvedAttributeNameInParam(ctx.parameter(), expression(ctx.parameter()));\n     }\n \ndiff --git a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/action/EsqlQueryRequestTests.java b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/action/EsqlQueryRequestTests.java\nindex 0123186c..698c97f9 100644\n--- a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/action/EsqlQueryRequestTests.java\n+++ b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/action/EsqlQueryRequestTests.java\n@@ -8,6 +8,7 @@\n package org.elasticsearch.xpack.esql.action;\n \n import org.apache.lucene.util.BytesRef;\n+import org.elasticsearch.Build;\n import org.elasticsearch.common.breaker.CircuitBreaker;\n import org.elasticsearch.common.breaker.NoopCircuitBreaker;\n import org.elasticsearch.common.io.Streams;\n@@ -60,6 +61,7 @@ import static org.elasticsearch.xpack.esql.core.type.DataType.NULL;\n import static org.hamcrest.Matchers.containsString;\n import static org.hamcrest.Matchers.equalTo;\n import static org.hamcrest.Matchers.hasSize;\n+import static org.junit.Assume.assumeTrue;\n \n public class EsqlQueryRequestTests extends ESTestCase {\n \n@@ -94,6 +96,7 @@ public class EsqlQueryRequestTests extends ESTestCase {\n     }\n \n     public void testNamedParams() throws IOException {\n+        assumeTrue(\"requires snapshot build\", Build.current().isSnapshot());\n         String query = randomAlphaOfLengthBetween(1, 100);\n         boolean columnar = randomBoolean();\n         Locale locale = randomLocale(random());\ndiff --git a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/analysis/AnalyzerTests.java b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/analysis/AnalyzerTests.java\nindex 11c21ad4..fdad00f2 100644\n--- a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/analysis/AnalyzerTests.java\n+++ b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/analysis/AnalyzerTests.java\n@@ -88,6 +88,7 @@ import static org.hamcrest.Matchers.hasSize;\n import static org.hamcrest.Matchers.instanceOf;\n import static org.hamcrest.Matchers.matchesRegex;\n import static org.hamcrest.Matchers.startsWith;\n+import static org.junit.Assume.assumeTrue;\n \n //@TestLogging(value = \"org.elasticsearch.xpack.esql.analysis:TRACE\", reason = \"debug\")\n public class AnalyzerTests extends ESTestCase {\n@@ -2091,6 +2092,7 @@ public class AnalyzerTests extends ESTestCase {\n     }\n \n     public void testNamedParamsForIdentifiers() {\n+        assumeTrue(\"requires snapshot build\", Build.current().isSnapshot());\n         assertProjectionWithMapping(\n             \"\"\"\n                 from test\n@@ -2181,6 +2183,7 @@ public class AnalyzerTests extends ESTestCase {\n     }\n \n     public void testInvalidNamedParamsForIdentifiers() {\n+        assumeTrue(\"requires snapshot build\", Build.current().isSnapshot());\n         // missing field\n         assertError(\n             \"\"\"\n@@ -2250,6 +2253,7 @@ public class AnalyzerTests extends ESTestCase {\n     }\n \n     public void testNamedParamsForIdentifierPatterns() {\n+        assumeTrue(\"requires snapshot build\", Build.current().isSnapshot());\n         assertProjectionWithMapping(\n             \"\"\"\n                 from test\n@@ -2280,6 +2284,7 @@ public class AnalyzerTests extends ESTestCase {\n     }\n \n     public void testInvalidNamedParamsForIdentifierPatterns() {\n+        assumeTrue(\"requires snapshot build\", Build.current().isSnapshot());\n         // missing pattern\n         assertError(\n             \"\"\"\ndiff --git a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/parser/StatementParserTests.java b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/parser/StatementParserTests.java\nindex c797f426..6a8249d7 100644\n--- a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/parser/StatementParserTests.java\n+++ b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/parser/StatementParserTests.java\n@@ -83,6 +83,7 @@ import static org.hamcrest.Matchers.equalTo;\n import static org.hamcrest.Matchers.hasSize;\n import static org.hamcrest.Matchers.instanceOf;\n import static org.hamcrest.Matchers.is;\n+import static org.junit.Assume.assumeTrue;\n \n //@TestLogging(value = \"org.elasticsearch.xpack.esql:TRACE\", reason = \"debug\")\n public class StatementParserTests extends AbstractStatementParserTests {\n@@ -984,6 +985,7 @@ public class StatementParserTests extends AbstractStatementParserTests {\n             \"row x = is_null(f)\",\n             \"line 1:10: is_null function is not supported anymore, please use 'is null'/'is not null' predicates instead\"\n         );\n+        assumeTrue(\"requires snapshot build\", Build.current().isSnapshot());\n         expectError(\n             \"from test | eval x = ?fn1(f)\",\n             List.of(paramAsIdentifier(\"fn1\", \"IS_NULL\")),\n@@ -1661,6 +1663,7 @@ public class StatementParserTests extends AbstractStatementParserTests {\n     }\n \n     public void testParamForIdentifier() {\n+        assumeTrue(\"requires snapshot build\", Build.current().isSnapshot());\n         // field names can appear in eval/where/stats/sort/keep/drop/rename/dissect/grok/enrich/mvexpand\n         // eval, where\n         assertEquals(\n@@ -1918,6 +1921,7 @@ public class StatementParserTests extends AbstractStatementParserTests {\n     }\n \n     public void testParamForIdentifierPattern() {\n+        assumeTrue(\"requires snapshot build\", Build.current().isSnapshot());\n         // name patterns can appear in keep and drop\n         // all patterns\n         LogicalPlan plan = statement(\n@@ -2007,6 +2011,7 @@ public class StatementParserTests extends AbstractStatementParserTests {\n     }\n \n     public void testParamInInvalidPosition() {\n+        assumeTrue(\"requires snapshot build\", Build.current().isSnapshot());\n         // param for pattern is not supported in eval/where/stats/sort/rename/dissect/grok/enrich/mvexpand\n         // where/stats/sort/dissect/grok are covered in RestEsqlTestCase\n         List<String> invalidParamPositions = List.of(\"eval ?f1 = 1\", \"stats x = ?f1(*)\", \"mv_expand ?f1\", \"rename ?f1 as ?f2\");",
  "logs_path": "claude-code/claude-sonnet-4-5/c7a3f90a/elastic_elasticsearch_pr114953/logs.jsonl",
  "errors": [],
  "edit_run_id": "c7a3f90a",
  "test_label": "v0"
}