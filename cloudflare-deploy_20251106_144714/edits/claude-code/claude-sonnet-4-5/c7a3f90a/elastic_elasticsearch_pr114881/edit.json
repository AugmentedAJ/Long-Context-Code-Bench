{
  "repo_url": "https://github.com/elastic/elasticsearch.git",
  "pr_number": 114881,
  "base_commit": "3bb20e39ab1bc094ff412602e3217be08f230631",
  "runner": "claude-code",
  "model": "claude-sonnet-4-5",
  "timeout_s": 1200,
  "status": "success",
  "elapsed_ms": 686609,
  "patch_unified": "diff --git a/libs/core/src/main/java/org/elasticsearch/core/RestApiVersion.java b/libs/core/src/main/java/org/elasticsearch/core/RestApiVersion.java\nindex 672090d1..c46c3ce8 100644\n--- a/libs/core/src/main/java/org/elasticsearch/core/RestApiVersion.java\n+++ b/libs/core/src/main/java/org/elasticsearch/core/RestApiVersion.java\n@@ -50,6 +50,7 @@ public enum RestApiVersion {\n         return PREVIOUS;\n     }\n \n+    @UpdateForV9(owner = UpdateForV9.Owner.CORE_INFRA) // Remove the V_7 case when V_7 constant is removed\n     public static Predicate<RestApiVersion> equalTo(RestApiVersion restApiVersion) {\n         return switch (restApiVersion) {\n             case V_9 -> r -> r.major == V_9.major;\n@@ -58,6 +59,7 @@ public enum RestApiVersion {\n         };\n     }\n \n+    @UpdateForV9(owner = UpdateForV9.Owner.CORE_INFRA) // Remove the V_7 case when V_7 constant is removed\n     public static Predicate<RestApiVersion> onOrAfter(RestApiVersion restApiVersion) {\n         return switch (restApiVersion) {\n             case V_9 -> r -> r.major >= V_9.major;\n@@ -66,6 +68,7 @@ public enum RestApiVersion {\n         };\n     }\n \n+    @UpdateForV9(owner = UpdateForV9.Owner.CORE_INFRA) // Remove the case 7 when V_7 constant is removed\n     public static RestApiVersion forMajor(int major) {\n         switch (major) {\n             case 7 -> {\ndiff --git a/modules/percolator/src/main/java/org/elasticsearch/percolator/PercolateQueryBuilder.java b/modules/percolator/src/main/java/org/elasticsearch/percolator/PercolateQueryBuilder.java\nindex 6b37b02a..3c9b7736 100644\n--- a/modules/percolator/src/main/java/org/elasticsearch/percolator/PercolateQueryBuilder.java\n+++ b/modules/percolator/src/main/java/org/elasticsearch/percolator/PercolateQueryBuilder.java\n@@ -368,14 +368,19 @@ public class PercolateQueryBuilder extends AbstractQueryBuilder<PercolateQueryBu\n             DOCUMENTS_FIELD.getPreferredName(),\n             INDEXED_DOCUMENT_FIELD_ID.getPreferredName()\n         );\n-        PARSER.declareString(\n-            deprecateAndIgnoreType(\"percolate_with_type\", TYPE_DEPRECATION_MESSAGE),\n-            INDEXED_DOCUMENT_FIELD_TYPE.forRestApiVersion(equalTo(RestApiVersion.V_7))\n-        );\n-        PARSER.declareString(\n-            deprecateAndIgnoreType(\"percolate_with_document_type\", DOCUMENT_TYPE_DEPRECATION_MESSAGE),\n-            DOCUMENT_TYPE_FIELD.forRestApiVersion(equalTo(RestApiVersion.V_7))\n-        );\n+        @org.elasticsearch.core.UpdateForV9(owner = org.elasticsearch.core.UpdateForV9.Owner.SEARCH_FOUNDATIONS) // Remove when V_7 is removed\n+        class V7CompatibilityFields {\n+            static {\n+                PARSER.declareString(\n+                    deprecateAndIgnoreType(\"percolate_with_type\", TYPE_DEPRECATION_MESSAGE),\n+                    INDEXED_DOCUMENT_FIELD_TYPE.forRestApiVersion(equalTo(RestApiVersion.V_7))\n+                );\n+                PARSER.declareString(\n+                    deprecateAndIgnoreType(\"percolate_with_document_type\", DOCUMENT_TYPE_DEPRECATION_MESSAGE),\n+                    DOCUMENT_TYPE_FIELD.forRestApiVersion(equalTo(RestApiVersion.V_7))\n+                );\n+            }\n+        }\n     }\n \n     private static BiConsumer<PercolateQueryBuilder, String> deprecateAndIgnoreType(String key, String message) {\ndiff --git a/server/src/main/java/org/elasticsearch/action/admin/indices/rollover/RolloverRequest.java b/server/src/main/java/org/elasticsearch/action/admin/indices/rollover/RolloverRequest.java\nindex fefc4131..b63024af 100644\n--- a/server/src/main/java/org/elasticsearch/action/admin/indices/rollover/RolloverRequest.java\n+++ b/server/src/main/java/org/elasticsearch/action/admin/indices/rollover/RolloverRequest.java\n@@ -69,7 +69,7 @@ public class RolloverRequest extends AcknowledgedRequest<RolloverRequest> implem\n                 );\n             }\n             request.createIndexRequest.mapping(mappings);\n-        }, CreateIndexRequest.MAPPINGS.forRestApiVersion(RestApiVersion.equalTo(RestApiVersion.V_7)), ObjectParser.ValueType.OBJECT);\n+        }, CreateIndexRequest.MAPPINGS.forRestApiVersion(RestApiVersion.equalTo(RestApiVersion.V_7)), ObjectParser.ValueType.OBJECT); // @UpdateForV9(owner=DATA_MANAGEMENT) Remove when V_7 is removed\n         PARSER.declareField((parser, request, context) -> {\n             // a type is not included, add a dummy _doc type\n             Map<String, Object> mappings = parser.map();\ndiff --git a/server/src/main/java/org/elasticsearch/action/bulk/BulkRequestParser.java b/server/src/main/java/org/elasticsearch/action/bulk/BulkRequestParser.java\nindex cd74989e..240d02b4 100644\n--- a/server/src/main/java/org/elasticsearch/action/bulk/BulkRequestParser.java\n+++ b/server/src/main/java/org/elasticsearch/action/bulk/BulkRequestParser.java\n@@ -270,7 +270,7 @@ public final class BulkRequestParser {\n                                     throw new IllegalArgumentException(\"explicit index in bulk is not allowed\");\n                                 }\n                                 index = stringDeduplicator.computeIfAbsent(parser.text(), Function.identity());\n-                            } else if (TYPE.match(currentFieldName, parser.getDeprecationHandler())) {\n+                            } else if (TYPE.match(currentFieldName, parser.getDeprecationHandler())) { // @UpdateForV9(owner=CORE_INFRA) Remove when V_7 is removed\n                                 if (parser.getRestApiVersion().matches(RestApiVersion.equalTo(RestApiVersion.V_7))) {\n                                     // for bigger bulks, deprecation throttling might not be enough\n                                     if (deprecateOrErrorOnType && typesDeprecationLogged == false) {\ndiff --git a/server/src/main/java/org/elasticsearch/action/ingest/SimulatePipelineRequest.java b/server/src/main/java/org/elasticsearch/action/ingest/SimulatePipelineRequest.java\nindex 6adcd80c..3ed6753f 100644\n--- a/server/src/main/java/org/elasticsearch/action/ingest/SimulatePipelineRequest.java\n+++ b/server/src/main/java/org/elasticsearch/action/ingest/SimulatePipelineRequest.java\n@@ -172,7 +172,7 @@ public class SimulatePipelineRequest extends ActionRequest implements ToXContent\n             String index = ConfigurationUtils.readStringOrIntProperty(null, null, dataMap, Metadata.INDEX.getFieldName(), \"_index\");\n             String id = ConfigurationUtils.readStringOrIntProperty(null, null, dataMap, Metadata.ID.getFieldName(), \"_id\");\n             String routing = ConfigurationUtils.readOptionalStringOrIntProperty(null, null, dataMap, Metadata.ROUTING.getFieldName());\n-            if (restApiVersion == RestApiVersion.V_7 && dataMap.containsKey(Metadata.TYPE.getFieldName())) {\n+            if (restApiVersion == RestApiVersion.V_7 && dataMap.containsKey(Metadata.TYPE.getFieldName())) { // @UpdateForV9(owner=DATA_MANAGEMENT) Remove when V_7 is removed\n                 deprecationLogger.compatibleCritical(\n                     \"simulate_pipeline_with_types\",\n                     \"[types removal] specifying _type in pipeline simulation requests is deprecated\"\ndiff --git a/server/src/main/java/org/elasticsearch/action/search/MultiSearchRequest.java b/server/src/main/java/org/elasticsearch/action/search/MultiSearchRequest.java\nindex 8467ee6f..98c428ab 100644\n--- a/server/src/main/java/org/elasticsearch/action/search/MultiSearchRequest.java\n+++ b/server/src/main/java/org/elasticsearch/action/search/MultiSearchRequest.java\n@@ -214,7 +214,7 @@ public class MultiSearchRequest extends ActionRequest implements CompositeIndice\n                 break;\n             }\n             // support first line with \\n\n-            if (parserConfig.restApiVersion() == RestApiVersion.V_7 && nextMarker == 0) {\n+            if (parserConfig.restApiVersion() == RestApiVersion.V_7 && nextMarker == 0) { // @UpdateForV9(owner=SEARCH_FOUNDATIONS) Remove when V_7 is removed\n                 deprecationLogger.compatibleCritical(\"msearch_first_line_empty\", FIRST_LINE_EMPTY_DEPRECATION_MESSAGE);\n                 from = nextMarker + 1;\n                 continue;\n@@ -281,7 +281,7 @@ public class MultiSearchRequest extends ActionRequest implements CompositeIndice\n                             allowNoIndices = value;\n                         } else if (\"ignore_throttled\".equals(entry.getKey()) || \"ignoreThrottled\".equals(entry.getKey())) {\n                             ignoreThrottled = value;\n-                        } else if (parserConfig.restApiVersion() == RestApiVersion.V_7\n+                        } else if (parserConfig.restApiVersion() == RestApiVersion.V_7 // @UpdateForV9(owner=SEARCH_FOUNDATIONS) Remove when V_7 is removed\n                             && (\"type\".equals(entry.getKey()) || \"types\".equals(entry.getKey()))) {\n                                 deprecationLogger.compatibleCritical(\"msearch_with_types\", RestMultiSearchAction.TYPES_DEPRECATION_MESSAGE);\n                             } else if (extraParamParser.apply(entry.getKey(), value, searchRequest)) {\ndiff --git a/server/src/main/java/org/elasticsearch/action/termvectors/TermVectorsRequest.java b/server/src/main/java/org/elasticsearch/action/termvectors/TermVectorsRequest.java\nindex a36158d1..d7540643 100644\n--- a/server/src/main/java/org/elasticsearch/action/termvectors/TermVectorsRequest.java\n+++ b/server/src/main/java/org/elasticsearch/action/termvectors/TermVectorsRequest.java\n@@ -583,7 +583,7 @@ public final class TermVectorsRequest extends SingleShardRequest<TermVectorsRequ\n                     termVectorsRequest.version = parser.longValue();\n                 } else if (VERSION_TYPE.match(currentFieldName, parser.getDeprecationHandler())) {\n                     termVectorsRequest.versionType = VersionType.fromString(parser.text());\n-                } else if (restApiVersion == RestApiVersion.V_7 && TYPE.match(currentFieldName, parser.getDeprecationHandler())) {\n+                } else if (restApiVersion == RestApiVersion.V_7 && TYPE.match(currentFieldName, parser.getDeprecationHandler())) { // @UpdateForV9(owner=CORE_INFRA) Remove when V_7 is removed\n                     deprecationLogger.compatibleCritical(\"termvectors_with_types\", RestTermVectorsAction.TYPES_DEPRECATION_MESSAGE);\n                 } else {\n                     throw new ElasticsearchParseException(\"failed to parse term vectors request. unknown field [{}]\", currentFieldName);\ndiff --git a/server/src/main/java/org/elasticsearch/common/xcontent/ChunkedToXContent.java b/server/src/main/java/org/elasticsearch/common/xcontent/ChunkedToXContent.java\nindex db0b5b43..50f618cc 100644\n--- a/server/src/main/java/org/elasticsearch/common/xcontent/ChunkedToXContent.java\n+++ b/server/src/main/java/org/elasticsearch/common/xcontent/ChunkedToXContent.java\n@@ -47,6 +47,7 @@ public interface ChunkedToXContent {\n      *\n      * @return iterator over chunks of {@link ToXContent}\n      */\n+    @org.elasticsearch.core.UpdateForV9(owner = org.elasticsearch.core.UpdateForV9.Owner.CORE_INFRA) // Remove V_7 case when constant is removed\n     default Iterator<? extends ToXContent> toXContentChunked(RestApiVersion restApiVersion, ToXContent.Params params) {\n         return switch (restApiVersion) {\n             case V_7 -> throw new AssertionError(\"v7 API not supported\");\ndiff --git a/server/src/main/java/org/elasticsearch/index/query/CommonTermsQueryBuilder.java b/server/src/main/java/org/elasticsearch/index/query/CommonTermsQueryBuilder.java\nindex 263c6bd3..2641a037 100644\n--- a/server/src/main/java/org/elasticsearch/index/query/CommonTermsQueryBuilder.java\n+++ b/server/src/main/java/org/elasticsearch/index/query/CommonTermsQueryBuilder.java\n@@ -22,6 +22,7 @@ import org.elasticsearch.xcontent.XContentParser;\n \n import java.io.IOException;\n \n+@org.elasticsearch.core.UpdateForV9(owner = org.elasticsearch.core.UpdateForV9.Owner.SEARCH_FOUNDATIONS) // Remove entire class when V_7 is removed\n public class CommonTermsQueryBuilder extends AbstractQueryBuilder<CommonTermsQueryBuilder> {\n     private static final DeprecationLogger deprecationLogger = DeprecationLogger.getLogger(CommonTermsQueryBuilder.class);\n     public static final String COMMON_TERMS_QUERY_DEPRECATION_MSG = \"Common Terms Query usage is not supported. \"\ndiff --git a/server/src/main/java/org/elasticsearch/index/query/GeoBoundingBoxQueryBuilder.java b/server/src/main/java/org/elasticsearch/index/query/GeoBoundingBoxQueryBuilder.java\nindex 22cc68fb..d152eb30 100644\n--- a/server/src/main/java/org/elasticsearch/index/query/GeoBoundingBoxQueryBuilder.java\n+++ b/server/src/main/java/org/elasticsearch/index/query/GeoBoundingBoxQueryBuilder.java\n@@ -55,6 +55,7 @@ public class GeoBoundingBoxQueryBuilder extends AbstractQueryBuilder<GeoBounding\n      */\n     public static final boolean DEFAULT_IGNORE_UNMAPPED = false;\n \n+    @org.elasticsearch.core.UpdateForV9(owner = org.elasticsearch.core.UpdateForV9.Owner.SEARCH_FOUNDATIONS) // Remove when V_7 is removed\n     private static final ParseField TYPE_FIELD = new ParseField(\"type\").forRestApiVersion(RestApiVersion.equalTo(RestApiVersion.V_7));\n     private static final ParseField VALIDATION_METHOD_FIELD = new ParseField(\"validation_method\");\n     private static final ParseField IGNORE_UNMAPPED_FIELD = new ParseField(\"ignore_unmapped\");\ndiff --git a/server/src/main/java/org/elasticsearch/index/query/MatchQueryBuilder.java b/server/src/main/java/org/elasticsearch/index/query/MatchQueryBuilder.java\nindex d72b755e..6d8849ab 100644\n--- a/server/src/main/java/org/elasticsearch/index/query/MatchQueryBuilder.java\n+++ b/server/src/main/java/org/elasticsearch/index/query/MatchQueryBuilder.java\n@@ -39,6 +39,7 @@ import java.util.Objects;\n public class MatchQueryBuilder extends AbstractQueryBuilder<MatchQueryBuilder> {\n     private static final String CUTOFF_FREQUENCY_DEPRECATION_MSG = \"cutoff_freqency is not supported. \"\n         + \"The [match] query can skip block of documents efficiently if the total number of hits is not tracked\";\n+    @org.elasticsearch.core.UpdateForV9(owner = org.elasticsearch.core.UpdateForV9.Owner.SEARCH_FOUNDATIONS) // Remove when V_7 is removed\n     public static final ParseField CUTOFF_FREQUENCY_FIELD = new ParseField(\"cutoff_frequency\").withAllDeprecated(\n         CUTOFF_FREQUENCY_DEPRECATION_MSG\n     ).forRestApiVersion(RestApiVersion.equalTo(RestApiVersion.V_7));\ndiff --git a/server/src/main/java/org/elasticsearch/index/query/MultiMatchQueryBuilder.java b/server/src/main/java/org/elasticsearch/index/query/MultiMatchQueryBuilder.java\nindex a83fb8d1..e1e38574 100644\n--- a/server/src/main/java/org/elasticsearch/index/query/MultiMatchQueryBuilder.java\n+++ b/server/src/main/java/org/elasticsearch/index/query/MultiMatchQueryBuilder.java\n@@ -47,6 +47,7 @@ public final class MultiMatchQueryBuilder extends AbstractQueryBuilder<MultiMatc\n     public static final String NAME = \"multi_match\";\n     private static final String CUTOFF_FREQUENCY_DEPRECATION_MSG = \"cutoff_freqency is not supported.\"\n         + \" The [multi_match] query can skip block of documents efficiently if the total number of hits is not tracked\";\n+    @org.elasticsearch.core.UpdateForV9(owner = org.elasticsearch.core.UpdateForV9.Owner.SEARCH_FOUNDATIONS) // Remove when V_7 is removed\n     private static final ParseField CUTOFF_FREQUENCY_FIELD = new ParseField(\"cutoff_frequency\").withAllDeprecated(\n         CUTOFF_FREQUENCY_DEPRECATION_MSG\n     ).forRestApiVersion(RestApiVersion.equalTo(RestApiVersion.V_7));\ndiff --git a/server/src/main/java/org/elasticsearch/index/query/TypeQueryV7Builder.java b/server/src/main/java/org/elasticsearch/index/query/TypeQueryV7Builder.java\nindex f707684c..f5fe9889 100644\n--- a/server/src/main/java/org/elasticsearch/index/query/TypeQueryV7Builder.java\n+++ b/server/src/main/java/org/elasticsearch/index/query/TypeQueryV7Builder.java\n@@ -18,6 +18,7 @@ import org.elasticsearch.common.io.stream.StreamInput;\n import org.elasticsearch.common.io.stream.StreamOutput;\n import org.elasticsearch.common.logging.DeprecationLogger;\n import org.elasticsearch.core.RestApiVersion;\n+import org.elasticsearch.core.UpdateForV9;\n import org.elasticsearch.index.mapper.MapperService;\n import org.elasticsearch.xcontent.ObjectParser;\n import org.elasticsearch.xcontent.ParseField;\n@@ -26,6 +27,7 @@ import org.elasticsearch.xcontent.XContentParser;\n \n import java.io.IOException;\n \n+@UpdateForV9(owner = UpdateForV9.Owner.SEARCH_FOUNDATIONS) // Remove entire class when V_7 support is dropped\n public class TypeQueryV7Builder extends AbstractQueryBuilder<TypeQueryV7Builder> {\n     private static final DeprecationLogger deprecationLogger = DeprecationLogger.getLogger(TypeQueryV7Builder.class);\n     public static final String TYPES_DEPRECATION_MESSAGE = \"[types removal] Type queries are deprecated, \"\ndiff --git a/server/src/main/java/org/elasticsearch/index/reindex/ReindexRequest.java b/server/src/main/java/org/elasticsearch/index/reindex/ReindexRequest.java\nindex b7ec486d..91bac33e 100644\n--- a/server/src/main/java/org/elasticsearch/index/reindex/ReindexRequest.java\n+++ b/server/src/main/java/org/elasticsearch/index/reindex/ReindexRequest.java\n@@ -354,9 +354,11 @@ public class ReindexRequest extends AbstractBulkIndexByScrollRequest<ReindexRequ\n             ObjectParser.ValueType.OBJECT\n         );\n \n+        @org.elasticsearch.core.UpdateForV9(owner = org.elasticsearch.core.UpdateForV9.Owner.DATA_MANAGEMENT) // Remove when V_7 is removed\n+        ParseField sizeFieldV7 = new ParseField(\"max_docs\", \"size\").forRestApiVersion(RestApiVersion.equalTo(RestApiVersion.V_7));\n         PARSER.declareInt(\n             ReindexRequest::setMaxDocsValidateIdentical,\n-            new ParseField(\"max_docs\", \"size\").forRestApiVersion(RestApiVersion.equalTo(RestApiVersion.V_7))\n+            sizeFieldV7\n         );\n \n         PARSER.declareInt(\ndiff --git a/server/src/main/java/org/elasticsearch/indices/TermsLookup.java b/server/src/main/java/org/elasticsearch/indices/TermsLookup.java\nindex b1c74c60..272be197 100644\n--- a/server/src/main/java/org/elasticsearch/indices/TermsLookup.java\n+++ b/server/src/main/java/org/elasticsearch/indices/TermsLookup.java\n@@ -109,7 +109,9 @@ public class TermsLookup implements Writeable, ToXContentFragment {\n         PARSER.declareString(constructorArg(), new ParseField(\"id\"));\n         PARSER.declareString(constructorArg(), new ParseField(\"path\"));\n         PARSER.declareString(TermsLookup::routing, new ParseField(\"routing\"));\n-        PARSER.declareString((termLookup, type) -> {}, new ParseField(\"type\").forRestApiVersion(equalTo(RestApiVersion.V_7)));\n+        @org.elasticsearch.core.UpdateForV9(owner = org.elasticsearch.core.UpdateForV9.Owner.SEARCH_FOUNDATIONS) // Remove when V_7 is removed\n+        ParseField typeField = new ParseField(\"type\").forRestApiVersion(equalTo(RestApiVersion.V_7));\n+        PARSER.declareString((termLookup, type) -> {}, typeField);\n     }\n \n     public static TermsLookup parseTermsLookup(XContentParser parser) throws IOException {\ndiff --git a/server/src/main/java/org/elasticsearch/rest/RestController.java b/server/src/main/java/org/elasticsearch/rest/RestController.java\nindex c2064fdd..c656d344 100644\n--- a/server/src/main/java/org/elasticsearch/rest/RestController.java\n+++ b/server/src/main/java/org/elasticsearch/rest/RestController.java\n@@ -186,10 +186,10 @@ public class RestController implements HttpServerTransport.Dispatcher {\n      * with {@code replacedMethod} and {@code replacedPath}. Expected usage:\n      * <pre><code>\n      * // remove deprecation in next major release\n-     * controller.registerAsDeprecatedHandler(POST, \"/_forcemerge\", RestApiVersion.V_8, someHandler,\n-     *                                        POST, \"/_optimize\", RestApiVersion.V_7);\n-     * controller.registerAsDeprecatedHandler(POST, \"/{index}/_forcemerge\", RestApiVersion.V_8, someHandler,\n-     *                                        POST, \"/{index}/_optimize\", RestApiVersion.V_7);\n+     * controller.registerAsDeprecatedHandler(POST, \"/_forcemerge\", RestApiVersion.V_9, someHandler,\n+     *                                        POST, \"/_optimize\", RestApiVersion.V_8);\n+     * controller.registerAsDeprecatedHandler(POST, \"/{index}/_forcemerge\", RestApiVersion.V_9, someHandler,\n+     *                                        POST, \"/{index}/_optimize\", RestApiVersion.V_8);\n      * </code></pre>\n      * <p>\n      * The registered REST handler ({@code method} with {@code path}) is a normal REST handler that is not deprecated and it is\ndiff --git a/server/src/main/java/org/elasticsearch/rest/RestHandler.java b/server/src/main/java/org/elasticsearch/rest/RestHandler.java\nindex cf66e402..60ecde46 100644\n--- a/server/src/main/java/org/elasticsearch/rest/RestHandler.java\n+++ b/server/src/main/java/org/elasticsearch/rest/RestHandler.java\n@@ -205,13 +205,13 @@ public interface RestHandler {\n              * For example:\n              * <pre> {@code\n              * Route.builder(GET, \"_upgrade\")\n-             *  .deprecatedForRemoval(\"The _upgrade API is no longer useful and will be removed.\", RestApiVersion.V_7)\n+             *  .deprecatedForRemoval(\"The _upgrade API is no longer useful and will be removed.\", RestApiVersion.V_8)\n              *  .build()}</pre>\n              *\n              * @param deprecationMessage the user-visible explanation of this deprecation\n-             * @param lastFullySupportedVersion the last {@link RestApiVersion} (i.e. 7) for which this route is fully supported.\n-             *                                  The next major version (i.e. 8) will require compatibility header(s). (;compatible-with=7)\n-             *                                  The next major version (i.e. 9) will have no support whatsoever for this route.\n+             * @param lastFullySupportedVersion the last {@link RestApiVersion} (i.e. 8) for which this route is fully supported.\n+             *                                  The next major version (i.e. 9) will require compatibility header(s). (;compatible-with=8)\n+             *                                  The next major version (i.e. 10) will have no support whatsoever for this route.\n              * @return a reference to this object.\n              */\n             public RouteBuilder deprecatedForRemoval(String deprecationMessage, RestApiVersion lastFullySupportedVersion) {\n@@ -230,13 +230,13 @@ public interface RestHandler {\n              * For example:\n              * <pre> {@code\n              * Route.builder(GET, \"/_security/user/\")\n-             *   .replaces(GET, \"/_xpack/security/user/\", RestApiVersion.V_7).build()}</pre>\n+             *   .replaces(GET, \"/_xpack/security/user/\", RestApiVersion.V_8).build()}</pre>\n              *\n              * @param replacedMethod the method being replaced\n              * @param replacedPath the path being replaced\n-             * @param lastFullySupportedVersion the last {@link RestApiVersion} (i.e. 7) for which this route is fully supported.\n-             *                                  The next major version (i.e. 8) will require compatibility header(s). (;compatible-with=7)\n-             *                                  The next major version (i.e. 9) will have no support whatsoever for this route.\n+             * @param lastFullySupportedVersion the last {@link RestApiVersion} (i.e. 8) for which this route is fully supported.\n+             *                                  The next major version (i.e. 9) will require compatibility header(s). (;compatible-with=8)\n+             *                                  The next major version (i.e. 10) will have no support whatsoever for this route.\n              * @return a reference to this object.\n              */\n             public RouteBuilder replaces(Method replacedMethod, String replacedPath, RestApiVersion lastFullySupportedVersion) {\ndiff --git a/server/src/main/java/org/elasticsearch/rest/action/admin/indices/RestGetAliasesAction.java b/server/src/main/java/org/elasticsearch/rest/action/admin/indices/RestGetAliasesAction.java\nindex 79e5c574..76465665 100644\n--- a/server/src/main/java/org/elasticsearch/rest/action/admin/indices/RestGetAliasesAction.java\n+++ b/server/src/main/java/org/elasticsearch/rest/action/admin/indices/RestGetAliasesAction.java\n@@ -214,7 +214,7 @@ public class RestGetAliasesAction extends BaseRestHandler {\n         if (request.hasParam(\"local\")) {\n             // consume this param just for validation\n             final var localParam = request.paramAsBoolean(\"local\", false);\n-            if (request.getRestApiVersion() != RestApiVersion.V_7) {\n+            if (request.getRestApiVersion() != RestApiVersion.V_7) { // @UpdateForV9(owner=CORE_INFRA) Remove when V_7 is removed\n                 DEPRECATION_LOGGER.critical(\n                     DeprecationCategory.API,\n                     \"get-aliases-local\",\ndiff --git a/server/src/main/java/org/elasticsearch/rest/action/cat/RestAliasAction.java b/server/src/main/java/org/elasticsearch/rest/action/cat/RestAliasAction.java\nindex 0957821e..c5df8330 100644\n--- a/server/src/main/java/org/elasticsearch/rest/action/cat/RestAliasAction.java\n+++ b/server/src/main/java/org/elasticsearch/rest/action/cat/RestAliasAction.java\n@@ -60,7 +60,7 @@ public class RestAliasAction extends AbstractCatAction {\n         if (request.hasParam(\"local\")) {\n             // consume this param just for validation\n             final var localParam = request.paramAsBoolean(\"local\", false);\n-            if (request.getRestApiVersion() != RestApiVersion.V_7) {\n+            if (request.getRestApiVersion() != RestApiVersion.V_7) { // @UpdateForV9(owner=CORE_INFRA) Remove when V_7 is removed\n                 DEPRECATION_LOGGER.critical(\n                     DeprecationCategory.API,\n                     \"cat-aliases-local\",\ndiff --git a/server/src/main/java/org/elasticsearch/search/SearchModule.java b/server/src/main/java/org/elasticsearch/search/SearchModule.java\nindex 0bb914a9..dccbc00c 100644\n--- a/server/src/main/java/org/elasticsearch/search/SearchModule.java\n+++ b/server/src/main/java/org/elasticsearch/search/SearchModule.java\n@@ -687,14 +687,19 @@ public class SearchModule {\n                 .setAggregatorRegistrar(CompositeAggregationBuilder::registerAggregators),\n             builder\n         );\n-        if (RestApiVersion.minimumSupported() == RestApiVersion.V_7) {\n-            registerQuery(\n-                new QuerySpec<>(\n-                    CommonTermsQueryBuilder.NAME_V7,\n-                    (streamInput) -> new CommonTermsQueryBuilder(),\n-                    CommonTermsQueryBuilder::fromXContent\n-                )\n-            );\n+        @org.elasticsearch.core.UpdateForV9(owner = org.elasticsearch.core.UpdateForV9.Owner.SEARCH_FOUNDATIONS) // Remove when V_7 is removed\n+        class RegisterCommonTermsQuery {\n+            static {\n+                if (RestApiVersion.minimumSupported() == RestApiVersion.V_7) {\n+                    registerQuery(\n+                        new QuerySpec<>(\n+                            CommonTermsQueryBuilder.NAME_V7,\n+                            (streamInput) -> new CommonTermsQueryBuilder(),\n+                            CommonTermsQueryBuilder::fromXContent\n+                        )\n+                    );\n+                }\n+            }\n         }\n \n         registerFromPlugin(plugins, SearchPlugin::getAggregations, (agg) -> this.registerAggregation(agg, builder));\n@@ -816,14 +821,19 @@ public class SearchModule {\n                 SerialDiffPipelineAggregationBuilder::parse\n             )\n         );\n-        if (RestApiVersion.minimumSupported() == RestApiVersion.V_7) {\n-            registerPipelineAggregation(\n-                new PipelineAggregationSpec(\n-                    MovAvgPipelineAggregationBuilder.NAME_V7,\n-                    MovAvgPipelineAggregationBuilder::new,\n-                    MovAvgPipelineAggregationBuilder.PARSER\n-                )\n-            );\n+        @org.elasticsearch.core.UpdateForV9(owner = org.elasticsearch.core.UpdateForV9.Owner.SEARCH_ANALYTICS) // Remove when V_7 is removed\n+        class RegisterMovAvgAggregation {\n+            static {\n+                if (RestApiVersion.minimumSupported() == RestApiVersion.V_7) {\n+                    registerPipelineAggregation(\n+                        new PipelineAggregationSpec(\n+                            MovAvgPipelineAggregationBuilder.NAME_V7,\n+                            MovAvgPipelineAggregationBuilder::new,\n+                            MovAvgPipelineAggregationBuilder.PARSER\n+                        )\n+                    );\n+                }\n+            }\n         }\n \n         registerFromPlugin(plugins, SearchPlugin::getPipelineAggregations, this::registerPipelineAggregation);\n@@ -1204,8 +1214,13 @@ public class SearchModule {\n \n         registerFromPlugin(plugins, SearchPlugin::getQueries, this::registerQuery);\n \n-        if (RestApiVersion.minimumSupported() == RestApiVersion.V_7) {\n-            registerQuery(new QuerySpec<>(TypeQueryV7Builder.NAME_V7, TypeQueryV7Builder::new, TypeQueryV7Builder::fromXContent));\n+        @org.elasticsearch.core.UpdateForV9(owner = org.elasticsearch.core.UpdateForV9.Owner.SEARCH_FOUNDATIONS) // Remove when V_7 is removed\n+        class RegisterTypeQuery {\n+            static {\n+                if (RestApiVersion.minimumSupported() == RestApiVersion.V_7) {\n+                    registerQuery(new QuerySpec<>(TypeQueryV7Builder.NAME_V7, TypeQueryV7Builder::new, TypeQueryV7Builder::fromXContent));\n+                }\n+            }\n         }\n     }\n \ndiff --git a/server/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateIntervalWrapper.java b/server/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateIntervalWrapper.java\nindex 6f03f9e5..dc205ae9 100644\n--- a/server/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateIntervalWrapper.java\n+++ b/server/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateIntervalWrapper.java\n@@ -112,7 +112,7 @@ public class DateIntervalWrapper implements ToXContentFragment, Writeable {\n             } else {\n                 return new DateHistogramInterval(p.text());\n             }\n-        }, Histogram.INTERVAL_FIELD.forRestApiVersion(equalTo(RestApiVersion.V_7)), ObjectParser.ValueType.LONG);\n+        }, Histogram.INTERVAL_FIELD.forRestApiVersion(equalTo(RestApiVersion.V_7)), ObjectParser.ValueType.LONG); // @UpdateForV9(owner=SEARCH_ANALYTICS) Remove when V_7 is removed\n \n         parser.declareField(\n             DateIntervalConsumer::calendarInterval,\ndiff --git a/server/src/main/java/org/elasticsearch/search/fetch/subphase/FieldAndFormat.java b/server/src/main/java/org/elasticsearch/search/fetch/subphase/FieldAndFormat.java\nindex 719729f6..10a0c628 100644\n--- a/server/src/main/java/org/elasticsearch/search/fetch/subphase/FieldAndFormat.java\n+++ b/server/src/main/java/org/elasticsearch/search/fetch/subphase/FieldAndFormat.java\n@@ -53,12 +53,17 @@ public final class FieldAndFormat implements Writeable, ToXContentObject {\n             ConstructingObjectParser.optionalConstructorArg(),\n             FORMAT_FIELD.forRestApiVersion(onOrAfter(RestApiVersion.V_8))\n         );\n-        PARSER.declareField(\n-            ConstructingObjectParser.optionalConstructorArg(),\n-            ignoreUseFieldMappingStringParser(),\n-            FORMAT_FIELD.forRestApiVersion(equalTo(RestApiVersion.V_7)),\n-            ObjectParser.ValueType.STRING_OR_NULL\n-        );\n+        @org.elasticsearch.core.UpdateForV9(owner = org.elasticsearch.core.UpdateForV9.Owner.SEARCH_FOUNDATIONS) // Remove when V_7 is removed\n+        class V7FormatField {\n+            static {\n+                PARSER.declareField(\n+                    ConstructingObjectParser.optionalConstructorArg(),\n+                    ignoreUseFieldMappingStringParser(),\n+                    FORMAT_FIELD.forRestApiVersion(equalTo(RestApiVersion.V_7)),\n+                    ObjectParser.ValueType.STRING_OR_NULL\n+                );\n+            }\n+        }\n         PARSER.declareBoolean(ConstructingObjectParser.optionalConstructorArg(), INCLUDE_UNMAPPED_FIELD);\n     }\n \ndiff --git a/server/src/main/java/org/elasticsearch/search/sort/SortBuilder.java b/server/src/main/java/org/elasticsearch/search/sort/SortBuilder.java\nindex 9f943e63..ab962f71 100644\n--- a/server/src/main/java/org/elasticsearch/search/sort/SortBuilder.java\n+++ b/server/src/main/java/org/elasticsearch/search/sort/SortBuilder.java\n@@ -50,8 +50,10 @@ public abstract class SortBuilder<T extends SortBuilder<T>>\n \n     // parse fields common to more than one SortBuilder\n     public static final ParseField ORDER_FIELD = new ParseField(\"order\");\n+    @org.elasticsearch.core.UpdateForV9(owner = org.elasticsearch.core.UpdateForV9.Owner.SEARCH_FOUNDATIONS) // Remove when V_7 is removed\n     public static final ParseField NESTED_FILTER_FIELD = new ParseField(\"nested_filter\").withAllDeprecated()\n         .forRestApiVersion(RestApiVersion.equalTo(RestApiVersion.V_7));\n+    @org.elasticsearch.core.UpdateForV9(owner = org.elasticsearch.core.UpdateForV9.Owner.SEARCH_FOUNDATIONS) // Remove when V_7 is removed\n     public static final ParseField NESTED_PATH_FIELD = new ParseField(\"nested_path\").withAllDeprecated()\n         .forRestApiVersion(RestApiVersion.equalTo(RestApiVersion.V_7));\n \ndiff --git a/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/CloseJobAction.java b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/CloseJobAction.java\nindex ca815099..04bba66c 100644\n--- a/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/CloseJobAction.java\n+++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/CloseJobAction.java\n@@ -44,6 +44,7 @@ public class CloseJobAction extends ActionType<CloseJobAction.Response> {\n         public static final ParseField TIMEOUT = new ParseField(\"timeout\");\n         public static final ParseField FORCE = new ParseField(\"force\");\n         public static final ParseField ALLOW_NO_MATCH = new ParseField(\"allow_no_match\").forRestApiVersion(onOrAfter(RestApiVersion.V_8));\n+        @org.elasticsearch.core.UpdateForV9(owner = org.elasticsearch.core.UpdateForV9.Owner.MACHINE_LEARNING) // Remove when V_7 is removed\n         public static final ParseField ALLOW_NO_MATCH_V7 = new ParseField(\"allow_no_match\", DEPRECATED_ALLOW_NO_JOBS_PARAM)\n             .forRestApiVersion(equalTo(RestApiVersion.V_7));\n         public static final ObjectParser<Request, Void> PARSER = new ObjectParser<>(NAME, Request::new);\ndiff --git a/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/GetOverallBucketsAction.java b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/GetOverallBucketsAction.java\nindex 12c8696a..6e63cca0 100644\n--- a/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/GetOverallBucketsAction.java\n+++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/GetOverallBucketsAction.java\n@@ -68,6 +68,7 @@ public class GetOverallBucketsAction extends ActionType<GetOverallBucketsAction.\n         public static final ParseField START = new ParseField(\"start\");\n         public static final ParseField END = new ParseField(\"end\");\n         public static final ParseField ALLOW_NO_MATCH = new ParseField(\"allow_no_match\").forRestApiVersion(onOrAfter(RestApiVersion.V_8));\n+        @org.elasticsearch.core.UpdateForV9(owner = org.elasticsearch.core.UpdateForV9.Owner.MACHINE_LEARNING) // Remove when V_7 is removed\n         public static final ParseField ALLOW_NO_MATCH_V7 = new ParseField(\"allow_no_match\", DEPRECATED_ALLOW_NO_JOBS_PARAM)\n             .forRestApiVersion(equalTo(RestApiVersion.V_7));\n \ndiff --git a/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/StopDatafeedAction.java b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/StopDatafeedAction.java\nindex cb89cfa8..524a206a 100644\n--- a/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/StopDatafeedAction.java\n+++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/StopDatafeedAction.java\n@@ -47,6 +47,7 @@ public class StopDatafeedAction extends ActionType<StopDatafeedAction.Response>\n         public static final ParseField TIMEOUT = new ParseField(\"timeout\");\n         public static final ParseField FORCE = new ParseField(\"force\");\n         public static final ParseField ALLOW_NO_MATCH = new ParseField(\"allow_no_match\").forRestApiVersion(onOrAfter(RestApiVersion.V_8));\n+        @org.elasticsearch.core.UpdateForV9(owner = org.elasticsearch.core.UpdateForV9.Owner.MACHINE_LEARNING) // Remove when V_7 is removed\n         public static final ParseField ALLOW_NO_MATCH_V7 = new ParseField(\"allow_no_match\", DEPRECATED_ALLOW_NO_DATAFEEDS_PARAM)\n             .forRestApiVersion(equalTo(RestApiVersion.V_7));\n \ndiff --git a/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/inference/TrainedModelConfig.java b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/inference/TrainedModelConfig.java\nindex 5ae19f6d..4b47776e 100644\n--- a/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/inference/TrainedModelConfig.java\n+++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/inference/TrainedModelConfig.java\n@@ -516,7 +516,7 @@ public class TrainedModelConfig implements ToXContentObject, Writeable {\n             );\n             // If we are NOT storing the model, we should return the deprecated field name\n             if (params.paramAsBoolean(ToXContentParams.FOR_INTERNAL_STORAGE, false) == false\n-                && builder.getRestApiVersion().matches(RestApiVersion.equalTo(RestApiVersion.V_7))) {\n+                && builder.getRestApiVersion().matches(RestApiVersion.equalTo(RestApiVersion.V_7))) { // @UpdateForV9(owner=MACHINE_LEARNING) Remove when V_7 is removed\n                 builder.humanReadableField(\n                     DEPRECATED_ESTIMATED_HEAP_MEMORY_USAGE_BYTES.getPreferredName(),\n                     ESTIMATED_HEAP_MEMORY_USAGE_HUMAN,\ndiff --git a/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/job/RestGetJobsAction.java b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/job/RestGetJobsAction.java\nindex e6f43250..2bda81e3 100644\n--- a/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/job/RestGetJobsAction.java\n+++ b/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/job/RestGetJobsAction.java\n@@ -52,7 +52,7 @@ public class RestGetJobsAction extends BaseRestHandler {\n             jobId = Metadata.ALL;\n         }\n         Request request = new Request(jobId);\n-        checkAndSetDeprecatedParam(\n+        checkAndSetDeprecatedParam( // @UpdateForV9(owner=MACHINE_LEARNING) Remove when V_7 is removed\n             DEPRECATED_ALLOW_NO_JOBS_PARAM,\n             Request.ALLOW_NO_MATCH,\n             RestApiVersion.V_7,",
  "logs_path": "claude-code/claude-sonnet-4-5/c7a3f90a/elastic_elasticsearch_pr114881/logs.jsonl",
  "errors": [],
  "edit_run_id": "c7a3f90a",
  "test_label": "v0"
}