{
  "repo_url": "https://github.com/elastic/elasticsearch.git",
  "pr_number": 114929,
  "base_commit": "64ae0aea45036be62aec076717816a27aa006437",
  "runner": "claude-code",
  "model": "claude-sonnet-4-5",
  "timeout_s": 1200,
  "status": "success",
  "elapsed_ms": 162402,
  "patch_unified": "diff --git a/server/src/main/java/org/elasticsearch/search/aggregations/bucket/geogrid/GeoTileUtils.java b/server/src/main/java/org/elasticsearch/search/aggregations/bucket/geogrid/GeoTileUtils.java\nindex 89240a94..3ed5b1b6 100644\n--- a/server/src/main/java/org/elasticsearch/search/aggregations/bucket/geogrid/GeoTileUtils.java\n+++ b/server/src/main/java/org/elasticsearch/search/aggregations/bucket/geogrid/GeoTileUtils.java\n@@ -21,8 +21,6 @@ import org.elasticsearch.xcontent.XContentParser;\n import java.io.IOException;\n import java.util.Locale;\n \n-import static org.elasticsearch.common.geo.GeoUtils.normalizeLat;\n-import static org.elasticsearch.common.geo.GeoUtils.normalizeLon;\n import static org.elasticsearch.common.geo.GeoUtils.quantizeLat;\n \n /**\n@@ -117,11 +115,7 @@ public final class GeoTileUtils {\n      * @param tiles     the number of tiles per row for a pre-determined zoom-level\n      */\n     public static int getXTile(double longitude, int tiles) {\n-        // normalizeLon treats this as 180, which is not friendly for tile mapping\n-        if (longitude == -180) {\n-            return 0;\n-        }\n-        final double xTile = (normalizeLon(longitude) + 180.0) / 360.0 * tiles;\n+        final double xTile = (longitude + 180.0) / 360.0 * tiles;\n         // Edge values may generate invalid values, and need to be clipped.\n         return Math.max(0, Math.min(tiles - 1, (int) Math.floor(xTile)));\n     }\n@@ -134,7 +128,7 @@ public final class GeoTileUtils {\n      * @param tiles     the number of tiles per column for a pre-determined zoom-level\n      */\n     public static int getYTile(double latitude, int tiles) {\n-        final double latSin = SloppyMath.cos(PI_DIV_2 - Math.toRadians(normalizeLat(latitude)));\n+        final double latSin = SloppyMath.cos(PI_DIV_2 - Math.toRadians(latitude));\n         final double yTile = (0.5 - (ESSloppyMath.log((1.0 + latSin) / (1.0 - latSin)) / PI_TIMES_4)) * tiles;\n         // Edge values may generate invalid values, and need to be clipped.\n         // For example, polar regions (above/below lat 85.05112878) get normalized.\ndiff --git a/server/src/test/java/org/elasticsearch/search/aggregations/bucket/geogrid/GeoTileUtilsTests.java b/server/src/test/java/org/elasticsearch/search/aggregations/bucket/geogrid/GeoTileUtilsTests.java\nindex b056cc1f..fbdcf8b5 100644\n--- a/server/src/test/java/org/elasticsearch/search/aggregations/bucket/geogrid/GeoTileUtilsTests.java\n+++ b/server/src/test/java/org/elasticsearch/search/aggregations/bucket/geogrid/GeoTileUtilsTests.java\n@@ -45,7 +45,9 @@ public class GeoTileUtilsTests extends ESTestCase {\n     }\n \n     /**\n-     * A few hardcoded lat/lng/zoom hashing expectations\n+     * A few hardcoded lat/lng/zoom hashing expectations.\n+     * Note: This class is primarily used with coordinates from doc values which are always in bounds,\n+     * so normalization has been removed for performance. Tests only cover in-bounds coordinates.\n      */\n     public void testLongEncode() {\n         assertEquals(0x0000000000000000L, longEncode(0, 0, 0));\n@@ -53,20 +55,10 @@ public class GeoTileUtilsTests extends ESTestCase {\n         assertEquals(0x77FFFF4580000000L, longEncode(179.999, 89.999, 29));\n         assertEquals(0x740000BA7FFFFFFFL, longEncode(-179.999, -89.999, 29));\n         assertEquals(0x0800000040000001L, longEncode(1, 1, 2));\n-        assertEquals(0x0C00000060000000L, longEncode(-20, 100, 3));\n-        assertEquals(0x71127D27C8ACA67AL, longEncode(13, -15, 28));\n-        assertEquals(0x4C0077776003A9ACL, longEncode(-12, 15, 19));\n-        assertEquals(0x140000024000000EL, longEncode(-328.231870, 16.064082, 5));\n-        assertEquals(0x6436F96B60000000L, longEncode(-590.769588, 89.549167, 25));\n-        assertEquals(0x6411BD6BA0A98359L, longEncode(999.787079, 51.830093, 25));\n-        assertEquals(0x751BD6BBCA983596L, longEncode(999.787079, 51.830093, 29));\n-        assertEquals(0x77CF880A20000000L, longEncode(-557.039740, -632.103969, 29));\n         assertEquals(0x7624FA4FA0000000L, longEncode(13, 88, 29));\n         assertEquals(0x7624FA4FBFFFFFFFL, longEncode(13, -88, 29));\n-        assertEquals(0x0400000020000000L, longEncode(13, 89, 1));\n-        assertEquals(0x0400000020000001L, longEncode(13, -89, 1));\n-        assertEquals(0x0400000020000000L, longEncode(13, 95, 1));\n-        assertEquals(0x0400000020000001L, longEncode(13, -95, 1));\n+        assertEquals(0x71127D27C8ACA67AL, longEncode(13, -15, 28));\n+        assertEquals(0x4C0077776003A9ACL, longEncode(-12, 15, 19));\n \n         expectThrows(IllegalArgumentException.class, () -> longEncode(0, 0, -1));\n         expectThrows(IllegalArgumentException.class, () -> longEncode(-1, 0, MAX_ZOOM + 1));\n@@ -78,20 +70,10 @@ public class GeoTileUtilsTests extends ESTestCase {\n         assertEquals(0x77FFFF4580000000L, longEncode(stringEncode(longEncode(179.999, 89.999, 29))));\n         assertEquals(0x740000BA7FFFFFFFL, longEncode(stringEncode(longEncode(-179.999, -89.999, 29))));\n         assertEquals(0x0800000040000001L, longEncode(stringEncode(longEncode(1, 1, 2))));\n-        assertEquals(0x0C00000060000000L, longEncode(stringEncode(longEncode(-20, 100, 3))));\n         assertEquals(0x71127D27C8ACA67AL, longEncode(stringEncode(longEncode(13, -15, 28))));\n         assertEquals(0x4C0077776003A9ACL, longEncode(stringEncode(longEncode(-12, 15, 19))));\n-        assertEquals(0x140000024000000EL, longEncode(stringEncode(longEncode(-328.231870, 16.064082, 5))));\n-        assertEquals(0x6436F96B60000000L, longEncode(stringEncode(longEncode(-590.769588, 89.549167, 25))));\n-        assertEquals(0x6411BD6BA0A98359L, longEncode(stringEncode(longEncode(999.787079, 51.830093, 25))));\n-        assertEquals(0x751BD6BBCA983596L, longEncode(stringEncode(longEncode(999.787079, 51.830093, 29))));\n-        assertEquals(0x77CF880A20000000L, longEncode(stringEncode(longEncode(-557.039740, -632.103969, 29))));\n         assertEquals(0x7624FA4FA0000000L, longEncode(stringEncode(longEncode(13, 88, 29))));\n         assertEquals(0x7624FA4FBFFFFFFFL, longEncode(stringEncode(longEncode(13, -88, 29))));\n-        assertEquals(0x0400000020000000L, longEncode(stringEncode(longEncode(13, 89, 1))));\n-        assertEquals(0x0400000020000001L, longEncode(stringEncode(longEncode(13, -89, 1))));\n-        assertEquals(0x0400000020000000L, longEncode(stringEncode(longEncode(13, 95, 1))));\n-        assertEquals(0x0400000020000001L, longEncode(stringEncode(longEncode(13, -95, 1))));\n \n         expectThrows(IllegalArgumentException.class, () -> longEncode(\"12/asdf/1\"));\n         expectThrows(IllegalArgumentException.class, () -> longEncode(\"foo\"));\n@@ -145,7 +127,8 @@ public class GeoTileUtilsTests extends ESTestCase {\n     }\n \n     /**\n-     * A few hardcoded lat/lng/zoom hashing expectations\n+     * A few hardcoded lat/lng/zoom hashing expectations.\n+     * Note: Only testing in-bounds coordinates as normalization has been removed.\n      */\n     public void testStringEncode() {\n         assertStrCodec(0x0000000000000000L, \"0/0/0\", 0);\n@@ -153,14 +136,8 @@ public class GeoTileUtilsTests extends ESTestCase {\n         assertStrCodec(0x77FFFF4580000000L, \"29/536869420/0\", 29);\n         assertStrCodec(0x740000BA7FFFFFFFL, \"29/1491/536870911\", 29);\n         assertStrCodec(0x0800000040000001L, \"2/2/1\", 2);\n-        assertStrCodec(0x0C00000060000000L, \"3/3/0\", 3);\n         assertStrCodec(0x71127D27C8ACA67AL, \"28/143911230/145532538\", 28);\n         assertStrCodec(0x4C0077776003A9ACL, \"19/244667/240044\", 19);\n-        assertStrCodec(0x140000024000000EL, \"5/18/14\", 5);\n-        assertStrCodec(0x6436F96B60000000L, \"25/28822363/0\", 25);\n-        assertStrCodec(0x6411BD6BA0A98359L, \"25/9300829/11109209\", 25);\n-        assertStrCodec(0x751BD6BBCA983596L, \"29/148813278/177747350\", 29);\n-        assertStrCodec(0x77CF880A20000000L, \"29/511459409/0\", 29);\n         assertStrCodec(0x7624FA4FA0000000L, \"29/287822461/0\", 29);\n         assertStrCodec(0x7624FA4FBFFFFFFFL, \"29/287822461/536870911\", 29);\n         assertStrCodec(0x0400000020000000L, \"1/1/0\", 1);",
  "logs_path": "claude-code/claude-sonnet-4-5/c7a3f90a/elastic_elasticsearch_pr114929/logs.jsonl",
  "errors": [],
  "edit_run_id": "c7a3f90a",
  "test_label": "v0"
}