{
  "repo_url": "https://github.com/elastic/elasticsearch.git",
  "pr_number": 114974,
  "base_commit": "f4b94645a585df9e57f53c3ed65e272b35cdcea7",
  "runner": "claude-code",
  "model": "claude-sonnet-4-5",
  "timeout_s": 1200,
  "status": "success",
  "elapsed_ms": 195652,
  "patch_unified": "diff --git a/.buildkite/scripts/dra-update-staging.sh b/.buildkite/scripts/dra-update-staging.sh\nindex 676361bf..207eee8d 100755\n--- a/.buildkite/scripts/dra-update-staging.sh\n+++ b/.buildkite/scripts/dra-update-staging.sh\n@@ -4,23 +4,38 @@ set -euo pipefail\n \n source .buildkite/scripts/branches.sh\n \n+echo \"--- DRA Update Staging\"\n+echo \"Processing branches: ${BRANCHES[*]}\"\n+\n for BRANCH in \"${BRANCHES[@]}\"; do\n   # Don't publish main branch to staging\n   if [[ \"$BRANCH\" == \"main\" ]]; then\n+    echo \"Skipping main branch\"\n     continue\n   fi\n \n   echo \"--- Checking $BRANCH\"\n \n+  echo \"Fetching latest manifests for $BRANCH...\"\n   BEATS_MANIFEST=$(curl -sS \"https://artifacts-staging.elastic.co/beats/latest/${BRANCH}.json\" | jq -r '.manifest_url')\n+  echo \"Latest Beats manifest: $BEATS_MANIFEST\"\n+\n   ML_MANIFEST=$(curl -sS \"https://artifacts-staging.elastic.co/ml-cpp/latest/${BRANCH}.json\" | jq -r '.manifest_url')\n+  echo \"Latest ML-CPP manifest: $ML_MANIFEST\"\n+\n   ES_MANIFEST=$(curl -sS \"https://artifacts-staging.elastic.co/elasticsearch/latest/${BRANCH}.json\" | jq -r '.manifest_url')\n+  echo \"Latest ES manifest: $ES_MANIFEST\"\n \n+  echo \"Checking ES dependencies...\"\n   ES_BEATS_DEPENDENCY=$(curl -sS \"$ES_MANIFEST\" | jq -r '.projects.elasticsearch.dependencies[] | select(.prefix == \"beats\") | .build_uri')\n+  echo \"ES Beats dependency: $ES_BEATS_DEPENDENCY\"\n+\n   ES_ML_DEPENDENCY=$(curl -sS \"$ES_MANIFEST\" | jq -r '.projects.elasticsearch.dependencies[] | select(.prefix == \"ml-cpp\") | .build_uri')\n+  echo \"ES ML-CPP dependency: $ES_ML_DEPENDENCY\"\n \n   SHOULD_TRIGGER=\"\"\n \n+  echo \"Comparing dependencies...\"\n   if [ \"$BEATS_MANIFEST\" = \"$ES_BEATS_DEPENDENCY\" ]; then\n     echo \"ES has the latest beats\"\n   else\ndiff --git a/.buildkite/scripts/dra-workflow.sh b/.buildkite/scripts/dra-workflow.sh\nindex ecfb8088..83850c94 100755\n--- a/.buildkite/scripts/dra-workflow.sh\n+++ b/.buildkite/scripts/dra-workflow.sh\n@@ -5,8 +5,15 @@ set -euo pipefail\n WORKFLOW=\"${DRA_WORKFLOW:-snapshot}\"\n BRANCH=\"${BUILDKITE_BRANCH:-}\"\n \n+echo \"--- DRA Workflow Configuration\"\n+echo \"WORKFLOW: $WORKFLOW\"\n+echo \"BRANCH: $BRANCH\"\n+echo \"BUILDKITE_COMMIT: ${BUILDKITE_COMMIT:-}\"\n+echo \"WORKSPACE: ${WORKSPACE:-}\"\n+\n # Don't publish main branch to staging\n if [[ \"$BRANCH\" == \"main\" && \"$WORKFLOW\" == \"staging\" ]]; then\n+  echo \"Skipping staging workflow for main branch\"\n   exit 0\n fi\n \n@@ -28,22 +35,43 @@ if [[ \"$WORKFLOW\" == \"snapshot\" ]]; then\n   VERSION_SUFFIX=\"-SNAPSHOT\"\n fi\n \n+echo \"--- Resolving Dependencies\"\n+echo \"RM_BRANCH: $RM_BRANCH\"\n+echo \"ES_VERSION: $ES_VERSION\"\n+echo \"VERSION_SUFFIX: $VERSION_SUFFIX\"\n+\n+echo \"Resolving Beats manifest...\"\n BEATS_BUILD_ID=\"$(./.ci/scripts/resolve-dra-manifest.sh beats \"$RM_BRANCH\" \"$ES_VERSION\" \"$WORKFLOW\")\"\n+echo \"BEATS_BUILD_ID: $BEATS_BUILD_ID\"\n+\n+echo \"Resolving ML-CPP manifest...\"\n ML_CPP_BUILD_ID=\"$(./.ci/scripts/resolve-dra-manifest.sh ml-cpp \"$RM_BRANCH\" \"$ES_VERSION\" \"$WORKFLOW\")\"\n+echo \"ML_CPP_BUILD_ID: $ML_CPP_BUILD_ID\"\n \n LICENSE_KEY_ARG=\"\"\n BUILD_SNAPSHOT_ARG=\"\"\n \n if [[ \"$WORKFLOW\" == \"staging\" ]]; then\n+  echo \"--- Configuring staging workflow\"\n   LICENSE_KEY=$(mktemp -d)/license.key\n   # Notice that only the public key is being read here, which isn't really secret\n+  echo \"Reading license key from vault...\"\n   vault read -field pubkey secret/ci/elastic-elasticsearch/migrated/license | base64 --decode > \"$LICENSE_KEY\"\n   LICENSE_KEY_ARG=\"-Dlicense.key=$LICENSE_KEY\"\n \n   BUILD_SNAPSHOT_ARG=\"-Dbuild.snapshot=false\"\n+  echo \"License key configured\"\n fi\n \n echo --- Building release artifacts\n+echo \"Gradle arguments:\"\n+echo \"  -Ddra.artifacts=true\"\n+echo \"  -Ddra.artifacts.dependency.beats=$BEATS_BUILD_ID\"\n+echo \"  -Ddra.artifacts.dependency.ml-cpp=$ML_CPP_BUILD_ID\"\n+echo \"  -Ddra.workflow=$WORKFLOW\"\n+echo \"  -Dcsv=$WORKSPACE/build/distributions/dependencies-${ES_VERSION}${VERSION_SUFFIX}.csv\"\n+echo \"  $LICENSE_KEY_ARG\"\n+echo \"  $BUILD_SNAPSHOT_ARG\"\n \n .ci/scripts/run-gradle.sh -Ddra.artifacts=true \\\n   -Ddra.artifacts.dependency.beats=\"${BEATS_BUILD_ID}\" \\\n@@ -70,6 +98,15 @@ find \"$WORKSPACE\" -type f -path \"*/build/distributions/*\" -exec chmod a+r {} \\;\n find \"$WORKSPACE\" -type d -path \"*/build/distributions\" -exec chmod a+w {} \\;\n \n echo --- Running release-manager\n+echo \"Release manager configuration:\"\n+echo \"  Project: elasticsearch\"\n+echo \"  Branch: $RM_BRANCH\"\n+echo \"  Commit: $BUILDKITE_COMMIT\"\n+echo \"  Workflow: $WORKFLOW\"\n+echo \"  Version: $ES_VERSION\"\n+echo \"  Artifact set: main\"\n+echo \"  Beats dependency: https://artifacts-${WORKFLOW}.elastic.co/beats/${BEATS_BUILD_ID}/manifest-${ES_VERSION}${VERSION_SUFFIX}.json\"\n+echo \"  ML-CPP dependency: https://artifacts-${WORKFLOW}.elastic.co/ml-cpp/${ML_CPP_BUILD_ID}/manifest-${ES_VERSION}${VERSION_SUFFIX}.json\"\n \n # Artifacts should be generated\n docker run --rm \\\ndiff --git a/.buildkite/scripts/dra-workflow.trigger.sh b/.buildkite/scripts/dra-workflow.trigger.sh\nindex 5ef756c3..5fafdbd0 100755\n--- a/.buildkite/scripts/dra-workflow.trigger.sh\n+++ b/.buildkite/scripts/dra-workflow.trigger.sh\n@@ -6,14 +6,21 @@ echo \"steps:\"\n \n source .buildkite/scripts/branches.sh\n \n+echo \"--- DRA Workflow Trigger\" >&2\n+echo \"Processing branches: ${BRANCHES[*]}\" >&2\n+\n for BRANCH in \"${BRANCHES[@]}\"; do\n   if [[ \"$BRANCH\" == \"main\" ]]; then\n+    echo \"Skipping main branch\" >&2\n     continue\n   fi\n \n+  echo \"--- Processing branch: $BRANCH\" >&2\n   INTAKE_PIPELINE_SLUG=\"elasticsearch-intake\"\n+  echo \"Fetching last good commit for branch $BRANCH from pipeline $INTAKE_PIPELINE_SLUG\" >&2\n   BUILD_JSON=$(curl -sH \"Authorization: Bearer ${BUILDKITE_API_TOKEN}\" \"https://api.buildkite.com/v2/organizations/elastic/pipelines/${INTAKE_PIPELINE_SLUG}/builds?branch=${BRANCH}&state=passed&per_page=1\" | jq '.[0] | {commit: .commit, url: .web_url}')\n   LAST_GOOD_COMMIT=$(echo \"${BUILD_JSON}\" | jq -r '.commit')\n+  echo \"Last good commit for $BRANCH: $LAST_GOOD_COMMIT\" >&2\n \n   cat <<EOF\n   - trigger: elasticsearch-dra-workflow\ndiff --git a/.ci/scripts/resolve-dra-manifest.sh b/.ci/scripts/resolve-dra-manifest.sh\nindex e42a2283..7f77bf80 100755\n--- a/.ci/scripts/resolve-dra-manifest.sh\n+++ b/.ci/scripts/resolve-dra-manifest.sh\n@@ -15,12 +15,21 @@ BRANCH=\"${BRANCH:-$2}\"\n ES_VERSION=\"${ES_VERSION:-$3}\"\n WORKFLOW=${WORKFLOW:-$4}\n \n+echo \"Resolving DRA manifest for $ARTIFACT\" 1>&2\n+echo \"  Branch: $BRANCH\" 1>&2\n+echo \"  ES Version: $ES_VERSION\" 1>&2\n+echo \"  Workflow: $WORKFLOW\" 1>&2\n+\n LATEST_BUILD=$(fetch_build $WORKFLOW $ARTIFACT $BRANCH)\n+echo \"Latest build ID: $LATEST_BUILD\" 1>&2\n+\n LATEST_VERSION=$(strip_version $LATEST_BUILD)\n+echo \"Latest version: $LATEST_VERSION\" 1>&2\n \n # If the latest artifact version doesn't match what we expect, try the corresponding version branch.\n # This can happen when the version of artifact has been bumped on the master branch.\n if [ \"$LATEST_VERSION\" != \"$ES_VERSION\" ]; then\n+  echo \"Version mismatch detected!\" 1>&2\n   echo \"Latest build for '$ARTIFACT' is version $LATEST_VERSION but expected version $ES_VERSION.\" 1>&2\n   NEW_BRANCH=$(echo $ES_VERSION | sed -E \"s/([0-9]+\\.[0-9]+)\\.[0-9]/\\1/g\")\n \n@@ -31,6 +40,8 @@ if [ \"$LATEST_VERSION\" != \"$ES_VERSION\" ]; then\n \n   echo \"Using branch $NEW_BRANCH instead of $BRANCH.\" 1>&2\n   LATEST_BUILD=$(fetch_build $WORKFLOW $ARTIFACT $NEW_BRANCH)\n+  echo \"Resolved build ID: $LATEST_BUILD\" 1>&2\n fi\n \n+echo \"Final build ID for $ARTIFACT: $LATEST_BUILD\" 1>&2\n echo $LATEST_BUILD",
  "logs_path": "claude-code/claude-sonnet-4-5/c7a3f90a/elastic_elasticsearch_pr114974/logs.jsonl",
  "errors": [],
  "edit_run_id": "c7a3f90a",
  "test_label": "v0"
}