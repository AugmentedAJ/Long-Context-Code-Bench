{
  "repo_url": "https://github.com/elastic/elasticsearch.git",
  "pr_number": 114860,
  "base_commit": "8c475a23c9aac193f8360fc9d78dd98e9dc690b8",
  "runner": "claude-code",
  "model": "claude-sonnet-4-5",
  "timeout_s": 1200,
  "status": "success",
  "elapsed_ms": 344595,
  "patch_unified": "diff --git a/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/scalar/spatial/StDistance.java b/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/scalar/spatial/StDistance.java\nindex ae9d3383..4588a42c 100644\n--- a/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/scalar/spatial/StDistance.java\n+++ b/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/expression/function/scalar/spatial/StDistance.java\n@@ -14,6 +14,7 @@ import org.elasticsearch.common.io.stream.NamedWriteableRegistry;\n import org.elasticsearch.common.io.stream.StreamInput;\n import org.elasticsearch.compute.ann.Evaluator;\n import org.elasticsearch.compute.ann.Fixed;\n+import org.elasticsearch.compute.ann.MvEvaluator;\n import org.elasticsearch.compute.operator.EvalOperator;\n import org.elasticsearch.geometry.Geometry;\n import org.elasticsearch.geometry.Point;\n@@ -249,45 +250,45 @@ public class StDistance extends BinarySpatialFunction implements EvaluatorMapper\n         throw EsqlIllegalArgumentException.illegalDataType(crsType().name());\n     }\n \n-    @Evaluator(extraName = \"GeoSourceAndConstant\", warnExceptions = { IllegalArgumentException.class, IOException.class })\n-    static double processGeoSourceAndConstant(BytesRef leftValue, @Fixed Point rightValue) throws IOException {\n-        return GEO.distance(leftValue, rightValue);\n+    @MvEvaluator(extraName = \"GeoSourceAndConstant\", warnExceptions = { IllegalArgumentException.class, IOException.class })\n+    static double processGeoSourceAndConstant(double current, BytesRef leftValue, @Fixed Point rightValue) throws IOException {\n+        return Math.min(current, GEO.distance(leftValue, rightValue));\n     }\n \n-    @Evaluator(extraName = \"GeoSourceAndSource\", warnExceptions = { IllegalArgumentException.class, IOException.class })\n-    static double processGeoSourceAndSource(BytesRef leftValue, BytesRef rightValue) throws IOException {\n-        return GEO.distance(leftValue, rightValue);\n+    @MvEvaluator(extraName = \"GeoSourceAndSource\", warnExceptions = { IllegalArgumentException.class, IOException.class })\n+    static double processGeoSourceAndSource(double current, BytesRef leftValue, BytesRef rightValue) throws IOException {\n+        return Math.min(current, GEO.distance(leftValue, rightValue));\n     }\n \n-    @Evaluator(extraName = \"GeoPointDocValuesAndConstant\", warnExceptions = { IllegalArgumentException.class })\n-    static double processGeoPointDocValuesAndConstant(long leftValue, @Fixed Point rightValue) {\n-        return GEO.distance(leftValue, rightValue);\n+    @MvEvaluator(extraName = \"GeoPointDocValuesAndConstant\", warnExceptions = { IllegalArgumentException.class })\n+    static double processGeoPointDocValuesAndConstant(double current, long leftValue, @Fixed Point rightValue) {\n+        return Math.min(current, GEO.distance(leftValue, rightValue));\n     }\n \n-    @Evaluator(extraName = \"GeoPointDocValuesAndSource\", warnExceptions = { IllegalArgumentException.class })\n-    static double processGeoPointDocValuesAndSource(long leftValue, BytesRef rightValue) {\n+    @MvEvaluator(extraName = \"GeoPointDocValuesAndSource\", warnExceptions = { IllegalArgumentException.class })\n+    static double processGeoPointDocValuesAndSource(double current, long leftValue, BytesRef rightValue) {\n         Geometry geometry = SpatialCoordinateTypes.UNSPECIFIED.wkbToGeometry(rightValue);\n-        return GEO.distance(leftValue, geometry);\n+        return Math.min(current, GEO.distance(leftValue, geometry));\n     }\n \n-    @Evaluator(extraName = \"CartesianSourceAndConstant\", warnExceptions = { IllegalArgumentException.class, IOException.class })\n-    static double processCartesianSourceAndConstant(BytesRef leftValue, @Fixed Point rightValue) throws IOException {\n-        return CARTESIAN.distance(leftValue, rightValue);\n+    @MvEvaluator(extraName = \"CartesianSourceAndConstant\", warnExceptions = { IllegalArgumentException.class, IOException.class })\n+    static double processCartesianSourceAndConstant(double current, BytesRef leftValue, @Fixed Point rightValue) throws IOException {\n+        return Math.min(current, CARTESIAN.distance(leftValue, rightValue));\n     }\n \n-    @Evaluator(extraName = \"CartesianSourceAndSource\", warnExceptions = { IllegalArgumentException.class, IOException.class })\n-    static double processCartesianSourceAndSource(BytesRef leftValue, BytesRef rightValue) throws IOException {\n-        return CARTESIAN.distance(leftValue, rightValue);\n+    @MvEvaluator(extraName = \"CartesianSourceAndSource\", warnExceptions = { IllegalArgumentException.class, IOException.class })\n+    static double processCartesianSourceAndSource(double current, BytesRef leftValue, BytesRef rightValue) throws IOException {\n+        return Math.min(current, CARTESIAN.distance(leftValue, rightValue));\n     }\n \n-    @Evaluator(extraName = \"CartesianPointDocValuesAndConstant\", warnExceptions = { IllegalArgumentException.class })\n-    static double processCartesianPointDocValuesAndConstant(long leftValue, @Fixed Point rightValue) {\n-        return CARTESIAN.distance(leftValue, rightValue);\n+    @MvEvaluator(extraName = \"CartesianPointDocValuesAndConstant\", warnExceptions = { IllegalArgumentException.class })\n+    static double processCartesianPointDocValuesAndConstant(double current, long leftValue, @Fixed Point rightValue) {\n+        return Math.min(current, CARTESIAN.distance(leftValue, rightValue));\n     }\n \n-    @Evaluator(extraName = \"CartesianPointDocValuesAndSource\")\n-    static double processCartesianPointDocValuesAndSource(long leftValue, BytesRef rightValue) {\n+    @MvEvaluator(extraName = \"CartesianPointDocValuesAndSource\")\n+    static double processCartesianPointDocValuesAndSource(double current, long leftValue, BytesRef rightValue) {\n         Geometry geometry = SpatialCoordinateTypes.UNSPECIFIED.wkbToGeometry(rightValue);\n-        return CARTESIAN.distance(leftValue, geometry);\n+        return Math.min(current, CARTESIAN.distance(leftValue, geometry));\n     }\n }",
  "logs_path": "claude-code/claude-sonnet-4-5/c7a3f90a/elastic_elasticsearch_pr114860/logs.jsonl",
  "errors": [],
  "edit_run_id": "c7a3f90a",
  "test_label": "v0"
}