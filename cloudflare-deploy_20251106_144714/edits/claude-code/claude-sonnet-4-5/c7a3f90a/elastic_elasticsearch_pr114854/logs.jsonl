{"timestamp": 1761878913.350851, "event": "agent_start", "runner": "claude-code", "model": "claude-sonnet-4-5", "command": ["claude", "-p", "You are working on a codebase. Your task is to make the necessary code changes to accomplish the following:\n\nAdding deprecation warnings for rank and sub_searches\n\nAdding deprecation warning for using the `rank` and `sub_searches` elements in Search API. \r\nAll doc references have already been removed, so here we just add the necessary headers.\n\nPlease make all necessary code changes to complete this task.", "--output-format", "stream-json", "--verbose", "--model", "claude-sonnet-4-5", "--allowedTools", "Edit Bash(git:*)"], "workspace": "/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace", "timeout_s": 1200}
{"timestamp": 1761878913.350889, "event": "auth_info", "auth_mode": "auto", "used_auth": "subscription", "anthropic_api_key_present": false}
{"timestamp": 1761879092.283328, "event": "agent_run", "stdout": "{\"type\":\"system\",\"subtype\":\"init\",\"cwd\":\"/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace\",\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"tools\":[\"Task\",\"Bash\",\"Glob\",\"Grep\",\"ExitPlanMode\",\"Read\",\"Edit\",\"Write\",\"NotebookEdit\",\"WebFetch\",\"TodoWrite\",\"WebSearch\",\"BashOutput\",\"KillShell\",\"Skill\",\"SlashCommand\"],\"mcp_servers\":[],\"model\":\"claude-sonnet-4-5\",\"permissionMode\":\"default\",\"slash_commands\":[\"compact\",\"context\",\"cost\",\"init\",\"output-style:new\",\"pr-comments\",\"release-notes\",\"todos\",\"review\",\"security-review\"],\"apiKeySource\":\"none\",\"claude_code_version\":\"2.0.29\",\"output_style\":\"default\",\"agents\":[\"general-purpose\",\"statusline-setup\",\"output-style-setup\",\"Explore\",\"Plan\"],\"skills\":[],\"plugins\":[],\"uuid\":\"4b2f55fd-4b70-419c-85b2-625dd098dc32\"}\n{\"type\":\"assistant\",\"message\":{\"model\":\"claude-sonnet-4-5-20250929\",\"id\":\"msg_01GJpZNY4Y2Uo1TDkzZJKEji\",\"type\":\"message\",\"role\":\"assistant\",\"content\":[{\"type\":\"text\",\"text\":\"I'll help you add deprecation warnings for the `rank` and `sub_searches` elements in the Search API. Let me start by exploring the codebase to understand the structure and locate the relevant files.\"}],\"stop_reason\":null,\"stop_sequence\":null,\"usage\":{\"input_tokens\":2,\"cache_creation_input_tokens\":2676,\"cache_read_input_tokens\":12441,\"cache_creation\":{\"ephemeral_5m_input_tokens\":2676,\"ephemeral_1h_input_tokens\":0},\"output_tokens\":8,\"service_tier\":\"standard\"}},\"parent_tool_use_id\":null,\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"593d2029-bbcf-4a63-a617-b23e20de608c\"}\n{\"type\":\"assistant\",\"message\":{\"model\":\"claude-sonnet-4-5-20250929\",\"id\":\"msg_01GJpZNY4Y2Uo1TDkzZJKEji\",\"type\":\"message\",\"role\":\"assistant\",\"content\":[{\"type\":\"tool_use\",\"id\":\"toolu_01Ug4yyFVxfE3Bg3XBr7dBdP\",\"name\":\"Task\",\"input\":{\"subagent_type\":\"Explore\",\"description\":\"Explore Search API codebase\",\"prompt\":\"I need to find files related to the Search API where `rank` and `sub_searches` parameters are used. Please search for:\\n1. Files containing \\\"rank\\\" and \\\"sub_searches\\\" in the context of search API\\n2. API endpoint definitions or handlers for search functionality\\n3. Parameter validation or processing code for search operations\\n\\nFocus on finding the main API files where these parameters are handled so we can add deprecation warnings.\",\"model\":\"haiku\"}}],\"stop_reason\":null,\"stop_sequence\":null,\"usage\":{\"input_tokens\":2,\"cache_creation_input_tokens\":2676,\"cache_read_input_tokens\":12441,\"cache_creation\":{\"ephemeral_5m_input_tokens\":2676,\"ephemeral_1h_input_tokens\":0},\"output_tokens\":8,\"service_tier\":\"standard\"}},\"parent_tool_use_id\":null,\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"28ed9dbb-fa1d-4c43-b12a-7e052f54ef70\"}\n{\"type\":\"user\",\"message\":{\"role\":\"user\",\"content\":[{\"type\":\"text\",\"text\":\"I need to find files related to the Search API where `rank` and `sub_searches` parameters are used. Please search for:\\n1. Files containing \\\"rank\\\" and \\\"sub_searches\\\" in the context of search API\\n2. API endpoint definitions or handlers for search functionality\\n3. Parameter validation or processing code for search operations\\n\\nFocus on finding the main API files where these parameters are handled so we can add deprecation warnings.\"}]},\"parent_tool_use_id\":\"toolu_01Ug4yyFVxfE3Bg3XBr7dBdP\",\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"614c799d-63a8-45c3-99fc-4f1860cbc752\"}\n{\"type\":\"assistant\",\"message\":{\"model\":\"claude-haiku-4-5-20251001\",\"id\":\"msg_012v8DNeS1RuFNgZPcAfzt4o\",\"type\":\"message\",\"role\":\"assistant\",\"content\":[{\"type\":\"tool_use\",\"id\":\"toolu_018KqnvsGB8b9sT1rcE5wJ2J\",\"name\":\"Grep\",\"input\":{\"pattern\":\"rank.*sub_searches|sub_searches.*rank\",\"output_mode\":\"files_with_matches\"}}],\"stop_reason\":null,\"stop_sequence\":null,\"usage\":{\"input_tokens\":2,\"cache_creation_input_tokens\":5620,\"cache_read_input_tokens\":0,\"cache_creation\":{\"ephemeral_5m_input_tokens\":5620,\"ephemeral_1h_input_tokens\":0},\"output_tokens\":1,\"service_tier\":\"standard\"}},\"parent_tool_use_id\":\"toolu_01Ug4yyFVxfE3Bg3XBr7dBdP\",\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"970472d7-1250-4cad-9fe8-727b16bb6864\"}\n{\"type\":\"assistant\",\"message\":{\"model\":\"claude-haiku-4-5-20251001\",\"id\":\"msg_012v8DNeS1RuFNgZPcAfzt4o\",\"type\":\"message\",\"role\":\"assistant\",\"content\":[{\"type\":\"tool_use\",\"id\":\"toolu_01EEoyyz3BhzyiPx57Ww3KFj\",\"name\":\"Grep\",\"input\":{\"pattern\":\"sub_searches\",\"output_mode\":\"files_with_matches\"}}],\"stop_reason\":null,\"stop_sequence\":null,\"usage\":{\"input_tokens\":2,\"cache_creation_input_tokens\":5620,\"cache_read_input_tokens\":0,\"cache_creation\":{\"ephemeral_5m_input_tokens\":5620,\"ephemeral_1h_input_tokens\":0},\"output_tokens\":1,\"service_tier\":\"standard\"}},\"parent_tool_use_id\":\"toolu_01Ug4yyFVxfE3Bg3XBr7dBdP\",\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"5bd704e4-2091-4a3c-8b75-6c7c2227d157\"}\n{\"type\":\"assistant\",\"message\":{\"model\":\"claude-haiku-4-5-20251001\",\"id\":\"msg_012v8DNeS1RuFNgZPcAfzt4o\",\"type\":\"message\",\"role\":\"assistant\",\"content\":[{\"type\":\"tool_use\",\"id\":\"toolu_01SMtfASh52iBpaduU2wVJGM\",\"name\":\"Grep\",\"input\":{\"pattern\":\"rank\",\"output_mode\":\"files_with_matches\",\"type\":\"py\"}}],\"stop_reason\":null,\"stop_sequence\":null,\"usage\":{\"input_tokens\":2,\"cache_creation_input_tokens\":5620,\"cache_read_input_tokens\":0,\"cache_creation\":{\"ephemeral_5m_input_tokens\":5620,\"ephemeral_1h_input_tokens\":0},\"output_tokens\":1,\"service_tier\":\"standard\"}},\"parent_tool_use_id\":\"toolu_01Ug4yyFVxfE3Bg3XBr7dBdP\",\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"fb68d076-c282-4620-b3ad-78f9d0baa32a\"}\n{\"type\":\"assistant\",\"message\":{\"model\":\"claude-haiku-4-5-20251001\",\"id\":\"msg_012v8DNeS1RuFNgZPcAfzt4o\",\"type\":\"message\",\"role\":\"assistant\",\"content\":[{\"type\":\"tool_use\",\"id\":\"toolu_01SXYiGBYHzSFFUwGPDG8jwm\",\"name\":\"Glob\",\"input\":{\"pattern\":\"**/*search*.py\"}}],\"stop_reason\":null,\"stop_sequence\":null,\"usage\":{\"input_tokens\":2,\"cache_creation_input_tokens\":5620,\"cache_read_input_tokens\":0,\"cache_creation\":{\"ephemeral_5m_input_tokens\":5620,\"ephemeral_1h_input_tokens\":0},\"output_tokens\":1,\"service_tier\":\"standard\"}},\"parent_tool_use_id\":\"toolu_01Ug4yyFVxfE3Bg3XBr7dBdP\",\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"3f20e469-0927-42d9-9318-f28af4bedb01\"}\n{\"type\":\"assistant\",\"message\":{\"model\":\"claude-haiku-4-5-20251001\",\"id\":\"msg_012v8DNeS1RuFNgZPcAfzt4o\",\"type\":\"message\",\"role\":\"assistant\",\"content\":[{\"type\":\"tool_use\",\"id\":\"toolu_01KX3MiqgbnYZ4E8wL6TpFSr\",\"name\":\"Glob\",\"input\":{\"pattern\":\"**/*api*.py\"}}],\"stop_reason\":null,\"stop_sequence\":null,\"usage\":{\"input_tokens\":2,\"cache_creation_input_tokens\":5620,\"cache_read_input_tokens\":0,\"cache_creation\":{\"ephemeral_5m_input_tokens\":5620,\"ephemeral_1h_input_tokens\":0},\"output_tokens\":1,\"service_tier\":\"standard\"}},\"parent_tool_use_id\":\"toolu_01Ug4yyFVxfE3Bg3XBr7dBdP\",\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"5d9f5c27-6845-4602-a6f2-7dd1cdc82647\"}\n{\"type\":\"user\",\"message\":{\"role\":\"user\",\"content\":[{\"tool_use_id\":\"toolu_01SMtfASh52iBpaduU2wVJGM\",\"type\":\"tool_result\",\"content\":\"No files found\"}]},\"parent_tool_use_id\":\"toolu_01Ug4yyFVxfE3Bg3XBr7dBdP\",\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"a696a442-80a9-4a0c-a810-d67da1ad9054\"}\n{\"type\":\"user\",\"message\":{\"role\":\"user\",\"content\":[{\"tool_use_id\":\"toolu_01EEoyyz3BhzyiPx57Ww3KFj\",\"type\":\"tool_result\",\"content\":\"Found 7 files\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/rank-rrf/src/yamlRestTest/resources/rest-api-spec/test/rrf/550_rrf_sub_searches_explain.yml\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/rank-rrf/src/yamlRestTest/resources/rest-api-spec/test/rrf/150_rank_rrf_pagination.yml\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/rank-rrf/src/yamlRestTest/resources/rest-api-spec/test/rrf/100_rank_rrf.yml\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/test/java/org/elasticsearch/action/search/SearchRequestTests.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/search/builder/SearchSourceBuilder.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/docs/reference/release-notes/8.9.0.asciidoc\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/docs/reference/release-notes/8.14.2.asciidoc\"}]},\"parent_tool_use_id\":\"toolu_01Ug4yyFVxfE3Bg3XBr7dBdP\",\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"0b00564f-8108-4784-9252-bd36568b866c\"}\n{\"type\":\"user\",\"message\":{\"role\":\"user\",\"content\":[{\"tool_use_id\":\"toolu_018KqnvsGB8b9sT1rcE5wJ2J\",\"type\":\"tool_result\",\"content\":\"Found 4 files\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/rank-rrf/src/yamlRestTest/resources/rest-api-spec/test/rrf/100_rank_rrf.yml\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/test/java/org/elasticsearch/action/search/SearchRequestTests.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/search/builder/SearchSourceBuilder.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/docs/reference/release-notes/8.14.2.asciidoc\"}]},\"parent_tool_use_id\":\"toolu_01Ug4yyFVxfE3Bg3XBr7dBdP\",\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"d0db9d95-06c0-4ef8-a049-3c6ad51d9041\"}\n{\"type\":\"user\",\"message\":{\"role\":\"user\",\"content\":[{\"tool_use_id\":\"toolu_01SXYiGBYHzSFFUwGPDG8jwm\",\"type\":\"tool_result\",\"content\":\"No files found\"}]},\"parent_tool_use_id\":\"toolu_01Ug4yyFVxfE3Bg3XBr7dBdP\",\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"a0a37bf1-53b4-48c1-b8f1-ff7b5bf763a8\"}\n{\"type\":\"user\",\"message\":{\"role\":\"user\",\"content\":[{\"tool_use_id\":\"toolu_01KX3MiqgbnYZ4E8wL6TpFSr\",\"type\":\"tool_result\",\"content\":\"No files found\"}]},\"parent_tool_use_id\":\"toolu_01Ug4yyFVxfE3Bg3XBr7dBdP\",\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"ac2b97f1-5381-48f6-aca8-bda408e5b9c5\"}\n{\"type\":\"assistant\",\"message\":{\"model\":\"claude-haiku-4-5-20251001\",\"id\":\"msg_01NEyb1Qa9LJTSUNuaN1MztM\",\"type\":\"message\",\"role\":\"assistant\",\"content\":[{\"type\":\"tool_use\",\"id\":\"toolu_01WxDQGFaQSGywdy3XQDwUfh\",\"name\":\"Glob\",\"input\":{\"pattern\":\"**/*.py\",\"path\":\"/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace\"}}],\"stop_reason\":null,\"stop_sequence\":null,\"usage\":{\"input_tokens\":6,\"cache_creation_input_tokens\":1308,\"cache_read_input_tokens\":5620,\"cache_creation\":{\"ephemeral_5m_input_tokens\":1308,\"ephemeral_1h_input_tokens\":0},\"output_tokens\":3,\"service_tier\":\"standard\"}},\"parent_tool_use_id\":\"toolu_01Ug4yyFVxfE3Bg3XBr7dBdP\",\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"4c8554a5-4ec7-4262-8b0e-a30707ea8f2f\"}\n{\"type\":\"assistant\",\"message\":{\"model\":\"claude-haiku-4-5-20251001\",\"id\":\"msg_01NEyb1Qa9LJTSUNuaN1MztM\",\"type\":\"message\",\"role\":\"assistant\",\"content\":[{\"type\":\"tool_use\",\"id\":\"toolu_01Rx5TEHNvc1pCST8U6WuvDz\",\"name\":\"Glob\",\"input\":{\"pattern\":\"**/*search*.java\",\"path\":\"/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace\"}}],\"stop_reason\":null,\"stop_sequence\":null,\"usage\":{\"input_tokens\":6,\"cache_creation_input_tokens\":1308,\"cache_read_input_tokens\":5620,\"cache_creation\":{\"ephemeral_5m_input_tokens\":1308,\"ephemeral_1h_input_tokens\":0},\"output_tokens\":3,\"service_tier\":\"standard\"}},\"parent_tool_use_id\":\"toolu_01Ug4yyFVxfE3Bg3XBr7dBdP\",\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"986fff76-132f-4fd2-addf-51ce33da3d3d\"}\n{\"type\":\"assistant\",\"message\":{\"model\":\"claude-haiku-4-5-20251001\",\"id\":\"msg_01NEyb1Qa9LJTSUNuaN1MztM\",\"type\":\"message\",\"role\":\"assistant\",\"content\":[{\"type\":\"tool_use\",\"id\":\"toolu_01ARr8JvpWyewT2iwBQRzxBh\",\"name\":\"Read\",\"input\":{\"file_path\":\"/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/search/builder/SearchSourceBuilder.java\"}}],\"stop_reason\":null,\"stop_sequence\":null,\"usage\":{\"input_tokens\":6,\"cache_creation_input_tokens\":1308,\"cache_read_input_tokens\":5620,\"cache_creation\":{\"ephemeral_5m_input_tokens\":1308,\"ephemeral_1h_input_tokens\":0},\"output_tokens\":3,\"service_tier\":\"standard\"}},\"parent_tool_use_id\":\"toolu_01Ug4yyFVxfE3Bg3XBr7dBdP\",\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"80d9e189-2ade-4b15-842f-15459ae741a4\"}\n{\"type\":\"assistant\",\"message\":{\"model\":\"claude-haiku-4-5-20251001\",\"id\":\"msg_01NEyb1Qa9LJTSUNuaN1MztM\",\"type\":\"message\",\"role\":\"assistant\",\"content\":[{\"type\":\"tool_use\",\"id\":\"toolu_01TZMeQ43JrAeMJbUsZmKup8\",\"name\":\"Read\",\"input\":{\"file_path\":\"/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/test/java/org/elasticsearch/action/search/SearchRequestTests.java\"}}],\"stop_reason\":null,\"stop_sequence\":null,\"usage\":{\"input_tokens\":6,\"cache_creation_input_tokens\":1308,\"cache_read_input_tokens\":5620,\"cache_creation\":{\"ephemeral_5m_input_tokens\":1308,\"ephemeral_1h_input_tokens\":0},\"output_tokens\":3,\"service_tier\":\"standard\"}},\"parent_tool_use_id\":\"toolu_01Ug4yyFVxfE3Bg3XBr7dBdP\",\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"8a00ae3d-1d59-47f4-b88a-c504cc785e9f\"}\n{\"type\":\"user\",\"message\":{\"role\":\"user\",\"content\":[{\"tool_use_id\":\"toolu_01WxDQGFaQSGywdy3XQDwUfh\",\"type\":\"tool_result\",\"content\":\"/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/dev-tools/prepare_release_update_documentation.py\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/dev-tools/smoke_test_xpack_rc.py\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/sql/connectors/tableau/tdvt/tdvt_run.py\"}]},\"parent_tool_use_id\":\"toolu_01Ug4yyFVxfE3Bg3XBr7dBdP\",\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"500a338b-b82d-48df-be28-78837fce0e74\"}\n{\"type\":\"user\",\"message\":{\"role\":\"user\",\"content\":[{\"tool_use_id\":\"toolu_01Rx5TEHNvc1pCST8U6WuvDz\",\"type\":\"tool_result\",\"content\":\"/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/build-tools-internal/src/main/java/org/elasticsearch/gradle/internal/ElasticsearchBuildCompletePlugin.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/build-tools-internal/src/main/java/org/elasticsearch/gradle/internal/ElasticsearchJavaBasePlugin.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/build-tools-internal/src/main/java/org/elasticsearch/gradle/internal/ElasticsearchJavaModulePathPlugin.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/build-tools-internal/src/main/java/org/elasticsearch/gradle/internal/ElasticsearchJavaPlugin.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/build-tools-internal/src/main/java/org/elasticsearch/gradle/internal/ElasticsearchJavadocPlugin.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/build-tools-internal/src/main/java/org/elasticsearch/gradle/internal/ElasticsearchTestBasePlugin.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/build-tools-internal/src/main/java/org/elasticsearch/gradle/internal/ExportElasticsearchBuildResourcesTask.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/build-tools-internal/src/main/java/org/elasticsearch/gradle/internal/distribution/DebElasticsearchDistributionType.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/build-tools-internal/src/main/java/org/elasticsearch/gradle/internal/distribution/DockerCloudElasticsearchDistributionType.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/build-tools-internal/src/main/java/org/elasticsearch/gradle/internal/distribution/DockerCloudEssElasticsearchDistributionType.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/build-tools-internal/src/main/java/org/elasticsearch/gradle/internal/distribution/DockerElasticsearchDistributionType.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/build-tools-internal/src/main/java/org/elasticsearch/gradle/internal/distribution/DockerIronBankElasticsearchDistributionType.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/build-tools-internal/src/main/java/org/elasticsearch/gradle/internal/distribution/DockerUbiElasticsearchDistributionType.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/build-tools-internal/src/main/java/org/elasticsearch/gradle/internal/distribution/DockerWolfiElasticsearchDistributionType.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/build-tools-internal/src/main/java/org/elasticsearch/gradle/internal/distribution/ElasticsearchDistributionExtension.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/build-tools-internal/src/main/java/org/elasticsearch/gradle/internal/distribution/ElasticsearchDistributionPlugin.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/build-tools-internal/src/main/java/org/elasticsearch/gradle/internal/distribution/InternalElasticsearchDistributionTypes.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/build-tools-internal/src/main/java/org/elasticsearch/gradle/internal/distribution/RpmElasticsearchDistributionType.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/build-tools/src/main/java/org/elasticsearch/gradle/ElasticsearchDistribution.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/build-tools/src/main/java/org/elasticsearch/gradle/ElasticsearchDistributionType.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/build-tools/src/main/java/org/elasticsearch/gradle/distribution/ArchiveElasticsearchDistributionType.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/build-tools/src/main/java/org/elasticsearch/gradle/distribution/ElasticsearchDistributionTypes.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/build-tools/src/main/java/org/elasticsearch/gradle/distribution/IntegTestZipElasticsearchDistributionType.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/build-tools/src/main/java/org/elasticsearch/gradle/testclusters/ElasticsearchCluster.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/build-tools/src/main/java/org/elasticsearch/gradle/testclusters/ElasticsearchNode.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/client/benchmark/src/main/java/org/elasticsearch/client/benchmark/ops/search/SearchBenchmarkTask.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/client/benchmark/src/main/java/org/elasticsearch/client/benchmark/ops/search/SearchRequestExecutor.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/client/client-benchmark-noop-api-plugin/src/main/java/org/elasticsearch/plugin/noop/action/search/RestNoopSearchAction.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/client/client-benchmark-noop-api-plugin/src/main/java/org/elasticsearch/plugin/noop/action/search/TransportNoopSearchAction.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/client/sniffer/src/main/java/org/elasticsearch/client/sniff/ElasticsearchNodesSniffer.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/client/sniffer/src/test/java/org/elasticsearch/client/sniff/ElasticsearchNodesSnifferParseTests.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/client/sniffer/src/test/java/org/elasticsearch/client/sniff/ElasticsearchNodesSnifferTests.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/distribution/tools/entitlement-runtime/src/main/java/org/elasticsearch/entitlement/runtime/api/ElasticsearchEntitlementManager.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/modules/aggregations/src/internalClusterTest/java/org/elasticsearch/aggregations/bucket/SearchCancellationIT.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/modules/lang-mustache/src/internalClusterTest/java/org/elasticsearch/script/mustache/MultiSearchTemplateIT.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/modules/lang-mustache/src/internalClusterTest/java/org/elasticsearch/script/mustache/SearchTemplateIT.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/modules/lang-mustache/src/internalClusterTest/java/org/elasticsearch/script/mustache/SearchUsageStatsIT.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/modules/lang-mustache/src/javaRestTest/java/org/elasticsearch/script/mustache/SearchTemplateWithoutContentIT.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/MultiSearchTemplateRequest.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/MultiSearchTemplateResponse.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/RestMultiSearchTemplateAction.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/RestRenderSearchTemplateAction.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/RestSearchTemplateAction.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/SearchTemplateRequest.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/SearchTemplateRequestBuilder.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/SearchTemplateResponse.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/TransportMultiSearchTemplateAction.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/TransportSearchTemplateAction.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/MultiSearchTemplateRequestTests.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/MultiSearchTemplateResponseTests.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/SearchTemplateRequestTests.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/SearchTemplateRequestXContentTests.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/SearchTemplateResponseTests.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/modules/legacy-geo/src/test/java/org/elasticsearch/legacygeo/test/ElasticsearchGeoAssertions.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/modules/mapper-extras/src/main/java/org/elasticsearch/index/mapper/extras/SearchAsYouTypeFieldMapper.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/modules/mapper-extras/src/test/java/org/elasticsearch/index/mapper/extras/SearchAsYouTypeAnalyzerTests.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/modules/mapper-extras/src/test/java/org/elasticsearch/index/mapper/extras/SearchAsYouTypeFieldMapperTests.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/modules/mapper-extras/src/test/java/org/elasticsearch/index/mapper/extras/SearchAsYouTypeFieldTypeTests.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/modules/parent-join/src/internalClusterTest/java/org/elasticsearch/join/query/ChildQuerySearchIT.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/modules/percolator/src/internalClusterTest/java/org/elasticsearch/percolator/PercolatorQuerySearchIT.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/modules/percolator/src/test/java/org/elasticsearch/percolator/PercolatorQuerySearchTests.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/modules/rank-eval/src/main/java/org/elasticsearch/index/rankeval/RatedSearchHit.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/modules/rank-eval/src/test/java/org/elasticsearch/index/rankeval/RatedSearchHitTests.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/qa/ccs-rolling-upgrade-remote-cluster/src/test/java/org/elasticsearch/upgrades/SearchStatesIT.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/qa/ccs-unavailable-clusters/src/javaRestTest/java/org/elasticsearch/search/CrossClusterSearchUnavailableClusterIT.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/qa/multi-cluster-search/src/test/java/org/elasticsearch/search/MultiClusterSearchYamlTestSuiteIT.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/qa/rolling-upgrade/src/javaRestTest/java/org/elasticsearch/upgrades/VectorSearchIT.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/qa/smoke-test-http/src/javaRestTest/java/org/elasticsearch/http/BlockedSearcherRestCancellationTestCase.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/qa/smoke-test-http/src/javaRestTest/java/org/elasticsearch/http/SearchRestCancellationIT.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/internalClusterTest/java/org/elasticsearch/action/search/SearchProgressActionListenerIT.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/internalClusterTest/java/org/elasticsearch/action/search/SearchShardsIT.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/internalClusterTest/java/org/elasticsearch/action/search/TransportSearchIT.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/internalClusterTest/java/org/elasticsearch/cluster/shards/ClusterSearchShardsIT.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/internalClusterTest/java/org/elasticsearch/index/shard/SearchIdleIT.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/internalClusterTest/java/org/elasticsearch/search/CollapseSearchResultsIT.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/internalClusterTest/java/org/elasticsearch/search/SearchCancellationIT.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/internalClusterTest/java/org/elasticsearch/search/SearchServiceCleanupOnLostMasterIT.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/internalClusterTest/java/org/elasticsearch/search/SearchTimeoutIT.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/internalClusterTest/java/org/elasticsearch/search/SearchWithRejectionsIT.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/internalClusterTest/java/org/elasticsearch/search/StressSearchServiceReaperIT.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/internalClusterTest/java/org/elasticsearch/search/basic/SearchRedStateIndexIT.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/internalClusterTest/java/org/elasticsearch/search/basic/SearchWhileCreatingIndexIT.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/internalClusterTest/java/org/elasticsearch/search/basic/SearchWhileRelocatingIT.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/internalClusterTest/java/org/elasticsearch/search/basic/SearchWithRandomExceptionsIT.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/internalClusterTest/java/org/elasticsearch/search/basic/SearchWithRandomIOExceptionsIT.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/internalClusterTest/java/org/elasticsearch/search/basic/TransportSearchFailuresIT.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/internalClusterTest/java/org/elasticsearch/search/basic/TransportTwoNodesSearchIT.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/internalClusterTest/java/org/elasticsearch/search/ccs/CrossClusterSearchIT.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/internalClusterTest/java/org/elasticsearch/search/ccs/CrossClusterSearchLeakIT.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/internalClusterTest/java/org/elasticsearch/search/fetch/subphase/highlight/CustomHighlighterSearchIT.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/internalClusterTest/java/org/elasticsearch/search/fetch/subphase/highlight/HighlighterSearchIT.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/internalClusterTest/java/org/elasticsearch/search/fields/SearchFieldsIT.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/internalClusterTest/java/org/elasticsearch/search/msearch/MultiSearchIT.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/internalClusterTest/java/org/elasticsearch/search/query/SearchQueryIT.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/internalClusterTest/java/org/elasticsearch/search/routing/SearchPreferenceIT.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/internalClusterTest/java/org/elasticsearch/search/routing/SearchReplicaSelectionIT.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/internalClusterTest/java/org/elasticsearch/search/scriptfilter/ScriptQuerySearchIT.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/internalClusterTest/java/org/elasticsearch/search/scroll/SearchScrollIT.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/internalClusterTest/java/org/elasticsearch/search/scroll/SearchScrollWithFailingNodesIT.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/internalClusterTest/java/org/elasticsearch/search/searchafter/SearchAfterIT.java\\n(Results are truncated. Consider using a more specific path or pattern.)\"}]},\"parent_tool_use_id\":\"toolu_01Ug4yyFVxfE3Bg3XBr7dBdP\",\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"6c7fd4dd-8022-463b-8aa1-3cfe4f7db3f6\"}\n{\"type\":\"user\",\"message\":{\"role\":\"user\",\"content\":[{\"tool_use_id\":\"toolu_01TZMeQ43JrAeMJbUsZmKup8\",\"type\":\"tool_result\",\"content\":\"     1\u2192/*\\n     2\u2192 * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\\n     3\u2192 * or more contributor license agreements. Licensed under the \\\"Elastic License\\n     4\u2192 * 2.0\\\", the \\\"GNU Affero General Public License v3.0 only\\\", and the \\\"Server Side\\n     5\u2192 * Public License v 1\\\"; you may not use this file except in compliance with, at\\n     6\u2192 * your election, the \\\"Elastic License 2.0\\\", the \\\"GNU Affero General Public\\n     7\u2192 * License v3.0 only\\\", or the \\\"Server Side Public License, v 1\\\".\\n     8\u2192 */\\n     9\u2192\\n    10\u2192package org.elasticsearch.action.search;\\n    11\u2192\\n    12\u2192import org.elasticsearch.TransportVersion;\\n    13\u2192import org.elasticsearch.TransportVersions;\\n    14\u2192import org.elasticsearch.action.ActionRequestValidationException;\\n    15\u2192import org.elasticsearch.action.support.IndicesOptions;\\n    16\u2192import org.elasticsearch.common.Strings;\\n    17\u2192import org.elasticsearch.common.bytes.BytesArray;\\n    18\u2192import org.elasticsearch.common.io.stream.BytesStreamOutput;\\n    19\u2192import org.elasticsearch.common.io.stream.StreamOutput;\\n    20\u2192import org.elasticsearch.common.util.ArrayUtils;\\n    21\u2192import org.elasticsearch.core.TimeValue;\\n    22\u2192import org.elasticsearch.index.query.QueryBuilder;\\n    23\u2192import org.elasticsearch.index.query.QueryBuilders;\\n    24\u2192import org.elasticsearch.index.query.TermQueryBuilder;\\n    25\u2192import org.elasticsearch.search.AbstractSearchTestCase;\\n    26\u2192import org.elasticsearch.search.Scroll;\\n    27\u2192import org.elasticsearch.search.builder.PointInTimeBuilder;\\n    28\u2192import org.elasticsearch.search.builder.SearchSourceBuilder;\\n    29\u2192import org.elasticsearch.search.builder.SubSearchSourceBuilder;\\n    30\u2192import org.elasticsearch.search.collapse.CollapseBuilder;\\n    31\u2192import org.elasticsearch.search.rank.TestRankBuilder;\\n    32\u2192import org.elasticsearch.search.rescore.QueryRescorerBuilder;\\n    33\u2192import org.elasticsearch.search.retriever.RetrieverBuilder;\\n    34\u2192import org.elasticsearch.search.retriever.TestCompoundRetrieverBuilder;\\n    35\u2192import org.elasticsearch.search.slice.SliceBuilder;\\n    36\u2192import org.elasticsearch.search.suggest.SuggestBuilder;\\n    37\u2192import org.elasticsearch.search.suggest.term.TermSuggestionBuilder;\\n    38\u2192import org.elasticsearch.search.vectors.KnnSearchBuilder;\\n    39\u2192import org.elasticsearch.tasks.TaskId;\\n    40\u2192import org.elasticsearch.test.ESTestCase;\\n    41\u2192import org.elasticsearch.test.TransportVersionUtils;\\n    42\u2192import org.elasticsearch.xcontent.XContentBuilder;\\n    43\u2192\\n    44\u2192import java.io.IOException;\\n    45\u2192import java.nio.charset.StandardCharsets;\\n    46\u2192import java.util.ArrayList;\\n    47\u2192import java.util.Base64;\\n    48\u2192import java.util.List;\\n    49\u2192\\n    50\u2192import static java.util.Collections.emptyMap;\\n    51\u2192import static org.elasticsearch.test.EqualsHashCodeTestUtils.checkEqualsAndHashCode;\\n    52\u2192import static org.hamcrest.Matchers.equalTo;\\n    53\u2192\\n    54\u2192public class SearchRequestTests extends AbstractSearchTestCase {\\n    55\u2192\\n    56\u2192    @Override\\n    57\u2192    protected SearchRequest createSearchRequest() throws IOException {\\n    58\u2192        SearchRequest request = super.createSearchRequest();\\n    59\u2192        if (randomBoolean()) {\\n    60\u2192            return request;\\n    61\u2192        }\\n    62\u2192        // clusterAlias and absoluteStartMillis do not have public getters/setters hence we randomize them only in this test specifically.\\n    63\u2192        return SearchRequest.subSearchRequest(\\n    64\u2192            new TaskId(\\\"node\\\", 1),\\n    65\u2192            request,\\n    66\u2192            request.indices(),\\n    67\u2192            randomAlphaOfLengthBetween(5, 10),\\n    68\u2192            randomNonNegativeLong(),\\n    69\u2192            randomBoolean()\\n    70\u2192        );\\n    71\u2192    }\\n    72\u2192\\n    73\u2192    public void testWithLocalReduction() {\\n    74\u2192        final TaskId taskId = new TaskId(\\\"n\\\", 1);\\n    75\u2192        expectThrows(\\n    76\u2192            NullPointerException.class,\\n    77\u2192            () -> SearchRequest.subSearchRequest(taskId, null, Strings.EMPTY_ARRAY, \\\"\\\", 0, randomBoolean())\\n    78\u2192        );\\n    79\u2192        SearchRequest request = new SearchRequest();\\n    80\u2192        expectThrows(NullPointerException.class, () -> SearchRequest.subSearchRequest(taskId, request, null, \\\"\\\", 0, randomBoolean()));\\n    81\u2192        expectThrows(\\n    82\u2192            NullPointerException.class,\\n    83\u2192            () -> SearchRequest.subSearchRequest(taskId, request, new String[] { null }, \\\"\\\", 0, randomBoolean())\\n    84\u2192        );\\n    85\u2192        expectThrows(\\n    86\u2192            NullPointerException.class,\\n    87\u2192            () -> SearchRequest.subSearchRequest(taskId, request, Strings.EMPTY_ARRAY, null, 0, randomBoolean())\\n    88\u2192        );\\n    89\u2192        expectThrows(\\n    90\u2192            IllegalArgumentException.class,\\n    91\u2192            () -> SearchRequest.subSearchRequest(taskId, request, Strings.EMPTY_ARRAY, \\\"\\\", -1, randomBoolean())\\n    92\u2192        );\\n    93\u2192        SearchRequest searchRequest = SearchRequest.subSearchRequest(taskId, request, Strings.EMPTY_ARRAY, \\\"\\\", 0, randomBoolean());\\n    94\u2192        assertNull(searchRequest.validate());\\n    95\u2192    }\\n    96\u2192\\n    97\u2192    public void testSerialization() throws Exception {\\n    98\u2192        SearchRequest searchRequest = createSearchRequest();\\n    99\u2192        SearchRequest deserializedRequest = copyWriteable(searchRequest, namedWriteableRegistry, SearchRequest::new);\\n   100\u2192        assertEquals(deserializedRequest, searchRequest);\\n   101\u2192        assertEquals(deserializedRequest.hashCode(), searchRequest.hashCode());\\n   102\u2192        assertNotSame(deserializedRequest, searchRequest);\\n   103\u2192    }\\n   104\u2192\\n   105\u2192    public void testSerializationMultiKNN() throws Exception {\\n   106\u2192        SearchRequest searchRequest = createSearchRequest();\\n   107\u2192        if (searchRequest.source() == null) {\\n   108\u2192            searchRequest.source(new SearchSourceBuilder());\\n   109\u2192        } else {\\n   110\u2192            // tests version prior to 8.8 so remove possible rank builder\\n   111\u2192            searchRequest.source().rankBuilder(null);\\n   112\u2192            // tests version prior to 8_500_999 so remove possible multiple queries\\n   113\u2192            searchRequest.source().subSearches(new ArrayList<>());\\n   114\u2192        }\\n   115\u2192        searchRequest.source()\\n   116\u2192            .knnSearch(\\n   117\u2192                List.of(\\n   118\u2192                    new KnnSearchBuilder(randomAlphaOfLength(10), new float[] { 1, 2 }, 5, 10, randomBoolean() ? null : randomFloat()),\\n   119\u2192                    new KnnSearchBuilder(randomAlphaOfLength(10), new float[] { 4, 12, 41 }, 3, 5, randomBoolean() ? null : randomFloat())\\n   120\u2192                )\\n   121\u2192            );\\n   122\u2192        expectThrows(\\n   123\u2192            IllegalArgumentException.class,\\n   124\u2192            () -> copyWriteable(\\n   125\u2192                searchRequest,\\n   126\u2192                namedWriteableRegistry,\\n   127\u2192                SearchRequest::new,\\n   128\u2192                TransportVersionUtils.randomVersionBetween(random(), TransportVersions.V_8_4_0, TransportVersions.V_8_6_0)\\n   129\u2192            )\\n   130\u2192        );\\n   131\u2192\\n   132\u2192        searchRequest.source()\\n   133\u2192            .knnSearch(\\n   134\u2192                List.of(new KnnSearchBuilder(randomAlphaOfLength(10), new float[] { 1, 2 }, 5, 10, randomBoolean() ? null : randomFloat()))\\n   135\u2192            );\\n   136\u2192        // Shouldn't throw because its just one KNN request\\n   137\u2192        copyWriteable(\\n   138\u2192            searchRequest,\\n   139\u2192            namedWriteableRegistry,\\n   140\u2192            SearchRequest::new,\\n   141\u2192            TransportVersionUtils.randomVersionBetween(random(), TransportVersions.V_8_4_0, TransportVersions.V_8_6_0)\\n   142\u2192        );\\n   143\u2192    }\\n   144\u2192\\n   145\u2192    public void testRandomVersionSerialization() throws IOException {\\n   146\u2192        SearchRequest searchRequest = createSearchRequest();\\n   147\u2192        TransportVersion version = TransportVersionUtils.randomVersion(random());\\n   148\u2192        if (version.before(TransportVersions.V_7_11_0) && searchRequest.source() != null) {\\n   149\u2192            // Versions before 7.11.0 don't support runtime mappings\\n   150\u2192            searchRequest.source().runtimeMappings(emptyMap());\\n   151\u2192        }\\n   152\u2192        if (version.before(TransportVersions.V_8_4_0)) {\\n   153\u2192            // Versions before 8.4.0 don't support force_synthetic_source\\n   154\u2192            searchRequest.setForceSyntheticSource(false);\\n   155\u2192        }\\n   156\u2192        if (version.before(TransportVersions.V_8_7_0) && searchRequest.hasKnnSearch() && searchRequest.source().knnSearch().size() > 1) {\\n   157\u2192            // Versions before 8.7.0 don't support more than one KNN clause\\n   158\u2192            searchRequest.source().knnSearch(List.of(searchRequest.source().knnSearch().get(0)));\\n   159\u2192        }\\n   160\u2192        if (version.before(TransportVersions.V_8_8_0) && searchRequest.source() != null) {\\n   161\u2192            // Versions before 8.8 don't support rank\\n   162\u2192            searchRequest.source().rankBuilder(null);\\n   163\u2192        }\\n   164\u2192        if (version.before(TransportVersions.V_8_9_X) && searchRequest.source() != null) {\\n   165\u2192            // Versions before 8_500_999 don't support queries\\n   166\u2192            searchRequest.source().subSearches(new ArrayList<>());\\n   167\u2192        }\\n   168\u2192        SearchRequest deserializedRequest = copyWriteable(searchRequest, namedWriteableRegistry, SearchRequest::new, version);\\n   169\u2192        assertEquals(searchRequest.isCcsMinimizeRoundtrips(), deserializedRequest.isCcsMinimizeRoundtrips());\\n   170\u2192        assertEquals(searchRequest.getLocalClusterAlias(), deserializedRequest.getLocalClusterAlias());\\n   171\u2192        assertEquals(searchRequest.getAbsoluteStartMillis(), deserializedRequest.getAbsoluteStartMillis());\\n   172\u2192        assertEquals(searchRequest.isFinalReduce(), deserializedRequest.isFinalReduce());\\n   173\u2192    }\\n   174\u2192\\n   175\u2192    public void testIllegalArguments() {\\n   176\u2192        SearchRequest searchRequest = new SearchRequest();\\n   177\u2192        assertNotNull(searchRequest.indices());\\n   178\u2192        assertNotNull(searchRequest.indicesOptions());\\n   179\u2192        assertNotNull(searchRequest.searchType());\\n   180\u2192\\n   181\u2192        NullPointerException e = expectThrows(NullPointerException.class, () -> searchRequest.indices((String[]) null));\\n   182\u2192        assertEquals(\\\"indices must not be null\\\", e.getMessage());\\n   183\u2192        e = expectThrows(NullPointerException.class, () -> searchRequest.indices((String) null));\\n   184\u2192        assertEquals(\\\"index must not be null\\\", e.getMessage());\\n   185\u2192\\n   186\u2192        e = expectThrows(NullPointerException.class, () -> searchRequest.indicesOptions(null));\\n   187\u2192        assertEquals(\\\"indicesOptions must not be null\\\", e.getMessage());\\n   188\u2192\\n   189\u2192        e = expectThrows(NullPointerException.class, () -> searchRequest.searchType((SearchType) null));\\n   190\u2192        assertEquals(\\\"searchType must not be null\\\", e.getMessage());\\n   191\u2192\\n   192\u2192        e = expectThrows(NullPointerException.class, () -> searchRequest.source(null));\\n   193\u2192        assertEquals(\\\"source must not be null\\\", e.getMessage());\\n   194\u2192\\n   195\u2192        e = expectThrows(NullPointerException.class, () -> searchRequest.scroll((TimeValue) null));\\n   196\u2192        assertEquals(\\\"keepAlive must not be null\\\", e.getMessage());\\n   197\u2192    }\\n   198\u2192\\n   199\u2192    public void testValidate() throws IOException {\\n   200\u2192        {\\n   201\u2192            // if scroll isn't set, validate should never add errors\\n   202\u2192            SearchRequest searchRequest = createSearchRequest().source(new SearchSourceBuilder());\\n   203\u2192            searchRequest.scroll((Scroll) null);\\n   204\u2192            ActionRequestValidationException validationErrors = searchRequest.validate();\\n   205\u2192            assertNull(validationErrors);\\n   206\u2192        }\\n   207\u2192        {\\n   208\u2192            // disabling `track_total_hits` isn't valid in scroll context\\n   209\u2192            SearchRequest searchRequest = createSearchRequest().source(new SearchSourceBuilder());\\n   210\u2192            // make sure we don't set the request cache for a scroll query\\n   211\u2192            searchRequest.requestCache(false);\\n   212\u2192            searchRequest.scroll(new TimeValue(1000));\\n   213\u2192            searchRequest.source().trackTotalHits(false);\\n   214\u2192            ActionRequestValidationException validationErrors = searchRequest.validate();\\n   215\u2192            assertNotNull(validationErrors);\\n   216\u2192            assertEquals(1, validationErrors.validationErrors().size());\\n   217\u2192            assertEquals(\\\"disabling [track_total_hits] is not allowed in a scroll context\\\", validationErrors.validationErrors().get(0));\\n   218\u2192        }\\n   219\u2192        {\\n   220\u2192            // scroll and `from` isn't valid\\n   221\u2192            SearchRequest searchRequest = createSearchRequest().source(new SearchSourceBuilder());\\n   222\u2192            // make sure we don't set the request cache for a scroll query\\n   223\u2192            searchRequest.requestCache(false);\\n   224\u2192            searchRequest.scroll(new TimeValue(1000));\\n   225\u2192            searchRequest.source().from(10);\\n   226\u2192            ActionRequestValidationException validationErrors = searchRequest.validate();\\n   227\u2192            assertNotNull(validationErrors);\\n   228\u2192            assertEquals(1, validationErrors.validationErrors().size());\\n   229\u2192            assertEquals(\\\"using [from] is not allowed in a scroll context\\\", validationErrors.validationErrors().get(0));\\n   230\u2192        }\\n   231\u2192        {\\n   232\u2192            // scroll and `size` is `0`\\n   233\u2192            SearchRequest searchRequest = createSearchRequest().source(new SearchSourceBuilder().size(0));\\n   234\u2192            searchRequest.requestCache(false);\\n   235\u2192            searchRequest.scroll(new TimeValue(1000));\\n   236\u2192            ActionRequestValidationException validationErrors = searchRequest.validate();\\n   237\u2192            assertNotNull(validationErrors);\\n   238\u2192            assertEquals(1, validationErrors.validationErrors().size());\\n   239\u2192            assertEquals(\\\"[size] cannot be [0] in a scroll context\\\", validationErrors.validationErrors().get(0));\\n   240\u2192        }\\n   241\u2192        {\\n   242\u2192            // scroll and search_after\\n   243\u2192            SearchRequest searchRequest = createSearchRequest().source(new SearchSourceBuilder());\\n   244\u2192            searchRequest.requestCache(false);\\n   245\u2192            searchRequest.scroll(new TimeValue(1000));\\n   246\u2192            searchRequest.source().searchAfter(new String[] { \\\"value\\\" });\\n   247\u2192            ActionRequestValidationException validationErrors = searchRequest.validate();\\n   248\u2192            assertNotNull(validationErrors);\\n   249\u2192            assertEquals(1, validationErrors.validationErrors().size());\\n   250\u2192            assertEquals(\\\"[search_after] cannot be used in a scroll context\\\", validationErrors.validationErrors().get(0));\\n   251\u2192        }\\n   252\u2192        {\\n   253\u2192            // scroll and collapse\\n   254\u2192            SearchRequest searchRequest = createSearchRequest().source(new SearchSourceBuilder());\\n   255\u2192            searchRequest.requestCache(false);\\n   256\u2192            searchRequest.scroll(new TimeValue(1000));\\n   257\u2192            searchRequest.source().collapse(new CollapseBuilder(\\\"field\\\"));\\n   258\u2192            ActionRequestValidationException validationErrors = searchRequest.validate();\\n   259\u2192            assertNotNull(validationErrors);\\n   260\u2192            assertEquals(1, validationErrors.validationErrors().size());\\n   261\u2192            assertEquals(\\\"cannot use `collapse` in a scroll context\\\", validationErrors.validationErrors().get(0));\\n   262\u2192        }\\n   263\u2192        {\\n   264\u2192            // allow_partial_results and compound retriever\\n   265\u2192            SearchRequest searchRequest = createSearchRequest().source(\\n   266\u2192                new SearchSourceBuilder().retriever(new TestCompoundRetrieverBuilder(randomIntBetween(1, 10)))\\n   267\u2192            );\\n   268\u2192            searchRequest.allowPartialSearchResults(true);\\n   269\u2192            searchRequest.scroll((Scroll) null);\\n   270\u2192            ActionRequestValidationException validationErrors = searchRequest.validate();\\n   271\u2192            assertNotNull(validationErrors);\\n   272\u2192            assertEquals(1, validationErrors.validationErrors().size());\\n   273\u2192            assertEquals(\\n   274\u2192                \\\"cannot specify a compound retriever and [allow_partial_search_results]\\\",\\n   275\u2192                validationErrors.validationErrors().get(0)\\n   276\u2192            );\\n   277\u2192        }\\n   278\u2192        {\\n   279\u2192            // allow_partial_results and non-compound retriever\\n   280\u2192            SearchRequest searchRequest = createSearchRequest().source(new SearchSourceBuilder().retriever(new RetrieverBuilder() {\\n   281\u2192                @Override\\n   282\u2192                public QueryBuilder topDocsQuery() {\\n   283\u2192                    return null;\\n   284\u2192                }\\n   285\u2192\\n   286\u2192                @Override\\n   287\u2192                public void extractToSearchSourceBuilder(SearchSourceBuilder searchSourceBuilder, boolean compoundUsed) {\\n   288\u2192                    // no-op\\n   289\u2192                }\\n   290\u2192\\n   291\u2192                @Override\\n   292\u2192                public String getName() {\\n   293\u2192                    return \\\"not_a_compound_retriever\\\";\\n   294\u2192                }\\n   295\u2192\\n   296\u2192                @Override\\n   297\u2192                protected void doToXContent(XContentBuilder builder, Params params) throws IOException {}\\n   298\u2192\\n   299\u2192                @Override\\n   300\u2192                protected boolean doEquals(Object o) {\\n   301\u2192                    return false;\\n   302\u2192                }\\n   303\u2192\\n   304\u2192                @Override\\n   305\u2192                protected int doHashCode() {\\n   306\u2192                    return 0;\\n   307\u2192                }\\n   308\u2192            }));\\n   309\u2192            searchRequest.allowPartialSearchResults(true);\\n   310\u2192            searchRequest.scroll((Scroll) null);\\n   311\u2192            ActionRequestValidationException validationErrors = searchRequest.validate();\\n   312\u2192            assertNull(validationErrors);\\n   313\u2192        }\\n   314\u2192        {\\n   315\u2192            // allow_partial_results not defined and compound retriever\\n   316\u2192            SearchRequest searchRequest = new SearchRequest().source(new SearchSourceBuilder().retriever(new RetrieverBuilder() {\\n   317\u2192                @Override\\n   318\u2192                public void extractToSearchSourceBuilder(SearchSourceBuilder searchSourceBuilder, boolean compoundUsed) {\\n   319\u2192                    // no-op\\n   320\u2192                }\\n   321\u2192\\n   322\u2192                @Override\\n   323\u2192                public String getName() {\\n   324\u2192                    return \\\"compound_retriever\\\";\\n   325\u2192                }\\n   326\u2192\\n   327\u2192                @Override\\n   328\u2192                protected void doToXContent(XContentBuilder builder, Params params) throws IOException {}\\n   329\u2192\\n   330\u2192                @Override\\n   331\u2192                protected boolean doEquals(Object o) {\\n   332\u2192                    return false;\\n   333\u2192                }\\n   334\u2192\\n   335\u2192                @Override\\n   336\u2192                protected int doHashCode() {\\n   337\u2192                    return 0;\\n   338\u2192                }\\n   339\u2192\\n   340\u2192                @Override\\n   341\u2192                public boolean isCompound() {\\n   342\u2192                    return true;\\n   343\u2192                }\\n   344\u2192\\n   345\u2192                @Override\\n   346\u2192                public QueryBuilder topDocsQuery() {\\n   347\u2192                    return null;\\n   348\u2192                }\\n   349\u2192            }));\\n   350\u2192            searchRequest.scroll((Scroll) null);\\n   351\u2192            ActionRequestValidationException validationErrors = searchRequest.validate();\\n   352\u2192            assertNull(validationErrors);\\n   353\u2192        }\\n   354\u2192        {\\n   355\u2192            // search_after and `from` isn't valid\\n   356\u2192            SearchRequest searchRequest = createSearchRequest().source(new SearchSourceBuilder());\\n   357\u2192            searchRequest.scroll((Scroll) null);\\n   358\u2192            searchRequest.source().searchAfter(new String[] { \\\"value\\\" });\\n   359\u2192            searchRequest.source().from(10);\\n   360\u2192            ActionRequestValidationException validationErrors = searchRequest.validate();\\n   361\u2192            assertNotNull(validationErrors);\\n   362\u2192            assertEquals(1, validationErrors.validationErrors().size());\\n   363\u2192            assertEquals(\\\"[from] parameter must be set to 0 when [search_after] is used\\\", validationErrors.validationErrors().get(0));\\n   364\u2192        }\\n   365\u2192        {\\n   366\u2192            // slice without scroll or pit\\n   367\u2192            SearchRequest searchRequest = createSearchRequest().source(new SearchSourceBuilder());\\n   368\u2192            searchRequest.scroll((Scroll) null);\\n   369\u2192            searchRequest.source().pointInTimeBuilder(null);\\n   370\u2192            searchRequest.source().slice(new SliceBuilder(1, 10));\\n   371\u2192            ActionRequestValidationException validationErrors = searchRequest.validate();\\n   372\u2192            assertNotNull(validationErrors);\\n   373\u2192            assertEquals(1, validationErrors.validationErrors().size());\\n   374\u2192            assertEquals(\\\"[slice] can only be used with [scroll] or [point-in-time] requests\\\", validationErrors.validationErrors().get(0));\\n   375\u2192        }\\n   376\u2192        {\\n   377\u2192            // stored fields disabled with _source requested\\n   378\u2192            SearchRequest searchRequest = createSearchRequest().source(new SearchSourceBuilder());\\n   379\u2192            searchRequest.scroll((Scroll) null);\\n   380\u2192            searchRequest.source().storedField(\\\"_none_\\\");\\n   381\u2192            searchRequest.source().fetchSource(true);\\n   382\u2192            ActionRequestValidationException validationErrors = searchRequest.validate();\\n   383\u2192            assertNotNull(validationErrors);\\n   384\u2192            assertEquals(1, validationErrors.validationErrors().size());\\n   385\u2192            assertEquals(\\\"[stored_fields] cannot be disabled if [_source] is requested\\\", validationErrors.validationErrors().get(0));\\n   386\u2192        }\\n   387\u2192        {\\n   388\u2192            // stored fields disabled with fetch fields requested\\n   389\u2192            SearchRequest searchRequest = createSearchRequest().source(new SearchSourceBuilder());\\n   390\u2192            searchRequest.scroll((Scroll) null);\\n   391\u2192            searchRequest.source().storedField(\\\"_none_\\\");\\n   392\u2192            searchRequest.source().fetchSource(false);\\n   393\u2192            searchRequest.source().fetchField(\\\"field\\\");\\n   394\u2192            ActionRequestValidationException validationErrors = searchRequest.validate();\\n   395\u2192            assertNotNull(validationErrors);\\n   396\u2192            assertEquals(1, validationErrors.validationErrors().size());\\n   397\u2192            assertEquals(\\\"[stored_fields] cannot be disabled when using the [fields] option\\\", validationErrors.validationErrors().get(0));\\n   398\u2192        }\\n   399\u2192        {\\n   400\u2192            // cannot have multiple queries without rank\\n   401\u2192            SearchRequest searchRequest = createSearchRequest().source(new SearchSourceBuilder());\\n   402\u2192            if (searchRequest.scroll() != null) {\\n   403\u2192                searchRequest.requestCache(false);\\n   404\u2192            }\\n   405\u2192            searchRequest.source()\\n   406\u2192                .subSearches(\\n   407\u2192                    List.of(\\n   408\u2192                        new SubSearchSourceBuilder(new TermQueryBuilder(\\\"three\\\", \\\"four\\\")),\\n   409\u2192                        new SubSearchSourceBuilder(new TermQueryBuilder(\\\"five\\\", \\\"six\\\"))\\n   410\u2192                    )\\n   411\u2192                );\\n   412\u2192            ActionRequestValidationException validationErrors = searchRequest.validate();\\n   413\u2192            assertNotNull(validationErrors);\\n   414\u2192            assertEquals(1, validationErrors.validationErrors().size());\\n   415\u2192            assertEquals(\\\"[sub_searches] requires [rank]\\\", validationErrors.validationErrors().get(0));\\n   416\u2192        }\\n   417\u2192        {\\n   418\u2192            // Rescore is not allowed on scroll requests\\n   419\u2192            SearchRequest searchRequest = createSearchRequest().source(new SearchSourceBuilder());\\n   420\u2192            searchRequest.source().addRescorer(new QueryRescorerBuilder(QueryBuilders.matchAllQuery()));\\n   421\u2192            searchRequest.requestCache(false);\\n   422\u2192            searchRequest.scroll(new TimeValue(1000));\\n   423\u2192            ActionRequestValidationException validationErrors = searchRequest.validate();\\n   424\u2192            assertNotNull(validationErrors);\\n   425\u2192            assertEquals(1, validationErrors.validationErrors().size());\\n   426\u2192            assertEquals(\\\"using [rescore] is not allowed in a scroll context\\\", validationErrors.validationErrors().get(0));\\n   427\u2192        }\\n   428\u2192        {\\n   429\u2192            // Reader context with scroll\\n   430\u2192            SearchRequest searchRequest = new SearchRequest().source(\\n   431\u2192                new SearchSourceBuilder().pointInTimeBuilder(\\n   432\u2192                    new PointInTimeBuilder(new BytesArray(Base64.getUrlEncoder().encode(\\\"id\\\".getBytes(StandardCharsets.UTF_8))))\\n   433\u2192                )\\n   434\u2192            ).scroll(TimeValue.timeValueMillis(randomIntBetween(1, 100)));\\n   435\u2192            ActionRequestValidationException validationErrors = searchRequest.validate();\\n   436\u2192            assertNotNull(validationErrors);\\n   437\u2192            assertEquals(1, validationErrors.validationErrors().size());\\n   438\u2192            assertEquals(\\\"using [point in time] is not allowed in a scroll context\\\", validationErrors.validationErrors().get(0));\\n   439\u2192        }\\n   440\u2192        {\\n   441\u2192            SearchRequest searchRequest = new SearchRequest().source(\\n   442\u2192                new SearchSourceBuilder().rankBuilder(new TestRankBuilder(100))\\n   443\u2192                    .query(QueryBuilders.termQuery(\\\"field\\\", \\\"term\\\"))\\n   444\u2192                    .knnSearch(List.of(new KnnSearchBuilder(\\\"vector\\\", new float[] { 0f }, 10, 100, null)))\\n   445\u2192                    .size(0)\\n   446\u2192            );\\n   447\u2192            ActionRequestValidationException validationErrors = searchRequest.validate();\\n   448\u2192            assertNotNull(validationErrors);\\n   449\u2192            assertEquals(1, validationErrors.validationErrors().size());\\n   450\u2192            assertEquals(\\\"[rank] requires [size] greater than [0]\\\", validationErrors.validationErrors().get(0));\\n   451\u2192        }\\n   452\u2192        {\\n   453\u2192            SearchRequest searchRequest = new SearchRequest().source(\\n   454\u2192                new SearchSourceBuilder().rankBuilder(new TestRankBuilder(1))\\n   455\u2192                    .query(QueryBuilders.termQuery(\\\"field\\\", \\\"term\\\"))\\n   456\u2192                    .knnSearch(List.of(new KnnSearchBuilder(\\\"vector\\\", new float[] { 0f }, 10, 100, null)))\\n   457\u2192                    .size(2)\\n   458\u2192            );\\n   459\u2192            ActionRequestValidationException validationErrors = searchRequest.validate();\\n   460\u2192            assertNotNull(validationErrors);\\n   461\u2192            assertEquals(1, validationErrors.validationErrors().size());\\n   462\u2192            assertEquals(\\n   463\u2192                \\\"[rank] requires [rank_window_size: 1] be greater than or equal to [size: 2]\\\",\\n   464\u2192                validationErrors.validationErrors().get(0)\\n   465\u2192            );\\n   466\u2192        }\\n   467\u2192        {\\n   468\u2192            SearchRequest searchRequest = new SearchRequest().source(\\n   469\u2192                new SearchSourceBuilder().rankBuilder(new TestRankBuilder(100)).query(QueryBuilders.termQuery(\\\"field\\\", \\\"term\\\"))\\n   470\u2192            );\\n   471\u2192            ActionRequestValidationException validationErrors = searchRequest.validate();\\n   472\u2192            assertNotNull(validationErrors);\\n   473\u2192            assertEquals(validationErrors.validationErrors().toString(), 1, validationErrors.validationErrors().size());\\n   474\u2192            assertEquals(\\n   475\u2192                \\\"[rank] requires a minimum of [2] result sets using a combination of sub searches and/or knn searches\\\",\\n   476\u2192                validationErrors.validationErrors().get(0)\\n   477\u2192            );\\n   478\u2192        }\\n   479\u2192        {\\n   480\u2192            SearchRequest searchRequest = new SearchRequest().source(\\n   481\u2192                new SearchSourceBuilder().rankBuilder(new TestRankBuilder(100))\\n   482\u2192                    .query(QueryBuilders.termQuery(\\\"field\\\", \\\"term\\\"))\\n   483\u2192                    .knnSearch(List.of(new KnnSearchBuilder(\\\"vector\\\", new float[] { 0f }, 10, 100, null)))\\n   484\u2192            ).scroll(new TimeValue(1000));\\n   485\u2192            ActionRequestValidationException validationErrors = searchRequest.validate();\\n   486\u2192            assertNotNull(validationErrors);\\n   487\u2192            assertEquals(1, validationErrors.validationErrors().size());\\n   488\u2192            assertEquals(\\\"[rank] cannot be used in a scroll context\\\", validationErrors.validationErrors().get(0));\\n   489\u2192        }\\n   490\u2192        {\\n   491\u2192            SearchRequest searchRequest = new SearchRequest().source(\\n   492\u2192                new SearchSourceBuilder().rankBuilder(new TestRankBuilder(9))\\n   493\u2192                    .query(QueryBuilders.termQuery(\\\"field\\\", \\\"term\\\"))\\n   494\u2192                    .knnSearch(List.of(new KnnSearchBuilder(\\\"vector\\\", new float[] { 0f }, 10, 100, null)))\\n   495\u2192            );\\n   496\u2192            ActionRequestValidationException validationErrors = searchRequest.validate();\\n   497\u2192            assertNotNull(validationErrors);\\n   498\u2192            assertEquals(1, validationErrors.validationErrors().size());\\n   499\u2192            assertEquals(\\n   500\u2192                \\\"[rank] requires [rank_window_size: 9] be greater than or equal to [size: 10]\\\",\\n   501\u2192                validationErrors.validationErrors().get(0)\\n   502\u2192            );\\n   503\u2192        }\\n   504\u2192        {\\n   505\u2192            SearchRequest searchRequest = new SearchRequest().source(\\n   506\u2192                new SearchSourceBuilder().rankBuilder(new TestRankBuilder(3))\\n   507\u2192                    .query(QueryBuilders.termQuery(\\\"field\\\", \\\"term\\\"))\\n   508\u2192                    .knnSearch(List.of(new KnnSearchBuilder(\\\"vector\\\", new float[] { 0f }, 10, 100, null)))\\n   509\u2192                    .size(3)\\n   510\u2192                    .from(4)\\n   511\u2192            );\\n   512\u2192            ActionRequestValidationException validationErrors = searchRequest.validate();\\n   513\u2192            assertNull(validationErrors);\\n   514\u2192        }\\n   515\u2192        {\\n   516\u2192            SearchRequest searchRequest = new SearchRequest().source(\\n   517\u2192                new SearchSourceBuilder().rankBuilder(new TestRankBuilder(100))\\n   518\u2192                    .query(QueryBuilders.termQuery(\\\"field\\\", \\\"term\\\"))\\n   519\u2192                    .knnSearch(List.of(new KnnSearchBuilder(\\\"vector\\\", new float[] { 0f }, 10, 100, null)))\\n   520\u2192                    .addRescorer(new QueryRescorerBuilder(QueryBuilders.termQuery(\\\"rescore\\\", \\\"another term\\\")))\\n   521\u2192            );\\n   522\u2192            ActionRequestValidationException validationErrors = searchRequest.validate();\\n   523\u2192            assertNotNull(validationErrors);\\n   524\u2192            assertEquals(1, validationErrors.validationErrors().size());\\n   525\u2192            assertEquals(\\\"[rank] cannot be used with [rescore]\\\", validationErrors.validationErrors().get(0));\\n   526\u2192        }\\n   527\u2192        {\\n   528\u2192            SearchRequest searchRequest = new SearchRequest().source(\\n   529\u2192                new SearchSourceBuilder().rankBuilder(new TestRankBuilder(100))\\n   530\u2192                    .query(QueryBuilders.termQuery(\\\"field\\\", \\\"term\\\"))\\n   531\u2192                    .knnSearch(List.of(new KnnSearchBuilder(\\\"vector\\\", new float[] { 0f }, 10, 100, null)))\\n   532\u2192                    .suggest(new SuggestBuilder().setGlobalText(\\\"test\\\").addSuggestion(\\\"suggestion\\\", new TermSuggestionBuilder(\\\"term\\\")))\\n   533\u2192            );\\n   534\u2192            ActionRequestValidationException validationErrors = searchRequest.validate();\\n   535\u2192            assertNotNull(validationErrors);\\n   536\u2192            assertEquals(1, validationErrors.validationErrors().size());\\n   537\u2192            assertEquals(\\\"[rank] cannot be used with [suggest]\\\", validationErrors.validationErrors().get(0));\\n   538\u2192        }\\n   539\u2192        {\\n   540\u2192            SearchRequest searchRequest = new SearchRequest(\\\"test\\\").source(\\n   541\u2192                new SearchSourceBuilder().pointInTimeBuilder(new PointInTimeBuilder(BytesArray.EMPTY))\\n   542\u2192            );\\n   543\u2192            ActionRequestValidationException validationErrors = searchRequest.validate();\\n   544\u2192            assertNotNull(validationErrors);\\n   545\u2192            assertEquals(1, validationErrors.validationErrors().size());\\n   546\u2192            assertEquals(\\n   547\u2192                \\\"[indices] cannot be used with point in time. Do not specify any index with point in time.\\\",\\n   548\u2192                validationErrors.validationErrors().get(0)\\n   549\u2192            );\\n   550\u2192        }\\n   551\u2192        {\\n   552\u2192            SearchRequest searchRequest = new SearchRequest().indicesOptions(IndicesOptions.LENIENT_EXPAND_OPEN_CLOSED)\\n   553\u2192                .source(new SearchSourceBuilder().pointInTimeBuilder(new PointInTimeBuilder(BytesArray.EMPTY)));\\n   554\u2192            ActionRequestValidationException validationErrors = searchRequest.validate();\\n   555\u2192            assertNotNull(validationErrors);\\n   556\u2192            assertEquals(1, validationErrors.validationErrors().size());\\n   557\u2192            assertEquals(\\\"[indicesOptions] cannot be used with point in time\\\", validationErrors.validationErrors().get(0));\\n   558\u2192        }\\n   559\u2192        {\\n   560\u2192            SearchRequest searchRequest = new SearchRequest().routing(\\\"route1\\\")\\n   561\u2192                .source(new SearchSourceBuilder().pointInTimeBuilder(new PointInTimeBuilder(BytesArray.EMPTY)));\\n   562\u2192            ActionRequestValidationException validationErrors = searchRequest.validate();\\n   563\u2192            assertNotNull(validationErrors);\\n   564\u2192            assertEquals(1, validationErrors.validationErrors().size());\\n   565\u2192            assertEquals(\\\"[routing] cannot be used with point in time\\\", validationErrors.validationErrors().get(0));\\n   566\u2192        }\\n   567\u2192        {\\n   568\u2192            SearchRequest searchRequest = new SearchRequest().preference(\\\"pref1\\\")\\n   569\u2192                .source(new SearchSourceBuilder().pointInTimeBuilder(new PointInTimeBuilder(BytesArray.EMPTY)));\\n   570\u2192            ActionRequestValidationException validationErrors = searchRequest.validate();\\n   571\u2192            assertNotNull(validationErrors);\\n   572\u2192            assertEquals(1, validationErrors.validationErrors().size());\\n   573\u2192            assertEquals(\\\"[preference] cannot be used with point in time\\\", validationErrors.validationErrors().get(0));\\n   574\u2192        }\\n   575\u2192    }\\n   576\u2192\\n   577\u2192    public void testCopyConstructor() throws IOException {\\n   578\u2192        SearchRequest searchRequest = createSearchRequest();\\n   579\u2192        SearchRequest deserializedRequest = copyWriteable(searchRequest, namedWriteableRegistry, SearchRequest::new);\\n   580\u2192        assertEquals(deserializedRequest, searchRequest);\\n   581\u2192        assertEquals(deserializedRequest.hashCode(), searchRequest.hashCode());\\n   582\u2192        assertNotSame(deserializedRequest, searchRequest);\\n   583\u2192    }\\n   584\u2192\\n   585\u2192    public void testEqualsAndHashcode() throws IOException {\\n   586\u2192        checkEqualsAndHashCode(createSearchRequest(), SearchRequest::new, this::mutate);\\n   587\u2192    }\\n   588\u2192\\n   589\u2192    private SearchRequest mutate(SearchRequest searchRequest) {\\n   590\u2192        SearchRequest mutation = new SearchRequest(searchRequest);\\n   591\u2192        List<Runnable> mutators = new ArrayList<>();\\n   592\u2192        mutators.add(() -> mutation.indices(ArrayUtils.concat(searchRequest.indices(), new String[] { randomAlphaOfLength(10) })));\\n   593\u2192        mutators.add(\\n   594\u2192            () -> mutation.indicesOptions(\\n   595\u2192                randomValueOtherThan(\\n   596\u2192                    searchRequest.indicesOptions(),\\n   597\u2192                    () -> IndicesOptions.fromOptions(randomBoolean(), randomBoolean(), randomBoolean(), randomBoolean())\\n   598\u2192                )\\n   599\u2192            )\\n   600\u2192        );\\n   601\u2192        mutators.add(() -> mutation.preference(randomValueOtherThan(searchRequest.preference(), () -> randomAlphaOfLengthBetween(3, 10))));\\n   602\u2192        mutators.add(() -> mutation.routing(randomValueOtherThan(searchRequest.routing(), () -> randomAlphaOfLengthBetween(3, 10))));\\n   603\u2192        mutators.add(() -> mutation.requestCache((randomValueOtherThan(searchRequest.requestCache(), ESTestCase::randomBoolean))));\\n   604\u2192        mutators.add(\\n   605\u2192            () -> mutation.scroll(\\n   606\u2192                randomValueOtherThan(searchRequest.scroll(), () -> new Scroll(new TimeValue(randomNonNegativeLong() % 100000)))\\n   607\u2192            )\\n   608\u2192        );\\n   609\u2192        mutators.add(\\n   610\u2192            () -> mutation.searchType(\\n   611\u2192                randomValueOtherThan(\\n   612\u2192                    searchRequest.searchType(),\\n   613\u2192                    () -> randomFrom(SearchType.DFS_QUERY_THEN_FETCH, SearchType.QUERY_THEN_FETCH)\\n   614\u2192                )\\n   615\u2192            )\\n   616\u2192        );\\n   617\u2192        mutators.add(() -> mutation.source(randomValueOtherThan(searchRequest.source(), this::createSearchSourceBuilder)));\\n   618\u2192        mutators.add(() -> mutation.setCcsMinimizeRoundtrips(searchRequest.isCcsMinimizeRoundtrips() == false));\\n   619\u2192        randomFrom(mutators).run();\\n   620\u2192        return mutation;\\n   621\u2192    }\\n   622\u2192\\n   623\u2192    public void testDescriptionForDefault() {\\n   624\u2192        assertThat(toDescription(new SearchRequest()), equalTo(\\\"indices[], search_type[QUERY_THEN_FETCH], source[]\\\"));\\n   625\u2192    }\\n   626\u2192\\n   627\u2192    public void testDescriptionIncludesScroll() {\\n   628\u2192        assertThat(\\n   629\u2192            toDescription(new SearchRequest().scroll(TimeValue.timeValueMinutes(5))),\\n   630\u2192            equalTo(\\\"indices[], search_type[QUERY_THEN_FETCH], scroll[5m], source[]\\\")\\n   631\u2192        );\\n   632\u2192    }\\n   633\u2192\\n   634\u2192    public void testDescriptionIncludePreferenceAndRouting() {\\n   635\u2192        assertThat(\\n   636\u2192            toDescription(new SearchRequest().preference(\\\"abc\\\")),\\n   637\u2192            equalTo(\\\"indices[], search_type[QUERY_THEN_FETCH], source[], preference[abc]\\\")\\n   638\u2192        );\\n   639\u2192        assertThat(\\n   640\u2192            toDescription(new SearchRequest().preference(\\\"abc\\\").routing(\\\"xyz\\\")),\\n   641\u2192            equalTo(\\\"indices[], search_type[QUERY_THEN_FETCH], source[], routing[xyz], preference[abc]\\\")\\n   642\u2192        );\\n   643\u2192    }\\n   644\u2192\\n   645\u2192    private String toDescription(SearchRequest request) {\\n   646\u2192        return request.createTask(0, \\\"test\\\", TransportSearchAction.TYPE.name(), TaskId.EMPTY_TASK_ID, emptyMap()).getDescription();\\n   647\u2192    }\\n   648\u2192\\n   649\u2192    public void testForceSyntheticUnsupported() {\\n   650\u2192        SearchRequest request = new SearchRequest();\\n   651\u2192        request.setForceSyntheticSource(true);\\n   652\u2192        StreamOutput out = new BytesStreamOutput();\\n   653\u2192        out.setTransportVersion(TransportVersions.V_8_3_0);\\n   654\u2192        Exception e = expectThrows(IllegalArgumentException.class, () -> request.writeTo(out));\\n   655\u2192        assertEquals(e.getMessage(), \\\"force_synthetic_source is not supported before 8.4.0\\\");\\n   656\u2192    }\\n   657\u2192}\\n   658\u2192\\n\\n<system-reminder>\\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\\n</system-reminder>\\n\"}]},\"parent_tool_use_id\":\"toolu_01Ug4yyFVxfE3Bg3XBr7dBdP\",\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"946c4ed1-3814-4807-9812-858e3e6c968c\"}\n{\"type\":\"user\",\"message\":{\"role\":\"user\",\"content\":[{\"tool_use_id\":\"toolu_01ARr8JvpWyewT2iwBQRzxBh\",\"type\":\"tool_result\",\"content\":\"     1\u2192/*\\n     2\u2192 * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\\n     3\u2192 * or more contributor license agreements. Licensed under the \\\"Elastic License\\n     4\u2192 * 2.0\\\", the \\\"GNU Affero General Public License v3.0 only\\\", and the \\\"Server Side\\n     5\u2192 * Public License v 1\\\"; you may not use this file except in compliance with, at\\n     6\u2192 * your election, the \\\"Elastic License 2.0\\\", the \\\"GNU Affero General Public\\n     7\u2192 * License v3.0 only\\\", or the \\\"Server Side Public License, v 1\\\".\\n     8\u2192 */\\n     9\u2192\\n    10\u2192package org.elasticsearch.search.builder;\\n    11\u2192\\n    12\u2192import org.elasticsearch.ElasticsearchException;\\n    13\u2192import org.elasticsearch.TransportVersions;\\n    14\u2192import org.elasticsearch.action.ActionRequestValidationException;\\n    15\u2192import org.elasticsearch.action.search.SearchRequest;\\n    16\u2192import org.elasticsearch.common.ParsingException;\\n    17\u2192import org.elasticsearch.common.Strings;\\n    18\u2192import org.elasticsearch.common.ValidationException;\\n    19\u2192import org.elasticsearch.common.io.stream.StreamInput;\\n    20\u2192import org.elasticsearch.common.io.stream.StreamOutput;\\n    21\u2192import org.elasticsearch.common.io.stream.Writeable;\\n    22\u2192import org.elasticsearch.common.logging.DeprecationLogger;\\n    23\u2192import org.elasticsearch.common.util.CollectionUtils;\\n    24\u2192import org.elasticsearch.common.xcontent.XContentHelper;\\n    25\u2192import org.elasticsearch.core.Booleans;\\n    26\u2192import org.elasticsearch.core.Nullable;\\n    27\u2192import org.elasticsearch.core.TimeValue;\\n    28\u2192import org.elasticsearch.features.NodeFeature;\\n    29\u2192import org.elasticsearch.index.query.BoolQueryBuilder;\\n    30\u2192import org.elasticsearch.index.query.QueryBuilder;\\n    31\u2192import org.elasticsearch.index.query.QueryRewriteContext;\\n    32\u2192import org.elasticsearch.index.query.Rewriteable;\\n    33\u2192import org.elasticsearch.script.Script;\\n    34\u2192import org.elasticsearch.search.SearchExtBuilder;\\n    35\u2192import org.elasticsearch.search.SearchService;\\n    36\u2192import org.elasticsearch.search.aggregations.AggregationBuilder;\\n    37\u2192import org.elasticsearch.search.aggregations.AggregatorFactories;\\n    38\u2192import org.elasticsearch.search.aggregations.PipelineAggregationBuilder;\\n    39\u2192import org.elasticsearch.search.collapse.CollapseBuilder;\\n    40\u2192import org.elasticsearch.search.fetch.StoredFieldsContext;\\n    41\u2192import org.elasticsearch.search.fetch.subphase.FetchSourceContext;\\n    42\u2192import org.elasticsearch.search.fetch.subphase.FieldAndFormat;\\n    43\u2192import org.elasticsearch.search.fetch.subphase.highlight.HighlightBuilder;\\n    44\u2192import org.elasticsearch.search.internal.SearchContext;\\n    45\u2192import org.elasticsearch.search.rank.RankBuilder;\\n    46\u2192import org.elasticsearch.search.rescore.RescorerBuilder;\\n    47\u2192import org.elasticsearch.search.retriever.RetrieverBuilder;\\n    48\u2192import org.elasticsearch.search.retriever.RetrieverParserContext;\\n    49\u2192import org.elasticsearch.search.searchafter.SearchAfterBuilder;\\n    50\u2192import org.elasticsearch.search.slice.SliceBuilder;\\n    51\u2192import org.elasticsearch.search.sort.FieldSortBuilder;\\n    52\u2192import org.elasticsearch.search.sort.ScoreSortBuilder;\\n    53\u2192import org.elasticsearch.search.sort.ShardDocSortField;\\n    54\u2192import org.elasticsearch.search.sort.SortBuilder;\\n    55\u2192import org.elasticsearch.search.sort.SortBuilders;\\n    56\u2192import org.elasticsearch.search.sort.SortOrder;\\n    57\u2192import org.elasticsearch.search.suggest.SuggestBuilder;\\n    58\u2192import org.elasticsearch.search.vectors.KnnSearchBuilder;\\n    59\u2192import org.elasticsearch.usage.SearchUsage;\\n    60\u2192import org.elasticsearch.usage.SearchUsageHolder;\\n    61\u2192import org.elasticsearch.xcontent.ParseField;\\n    62\u2192import org.elasticsearch.xcontent.ToXContentFragment;\\n    63\u2192import org.elasticsearch.xcontent.ToXContentObject;\\n    64\u2192import org.elasticsearch.xcontent.XContentBuilder;\\n    65\u2192import org.elasticsearch.xcontent.XContentParseException;\\n    66\u2192import org.elasticsearch.xcontent.XContentParser;\\n    67\u2192import org.elasticsearch.xcontent.XContentType;\\n    68\u2192\\n    69\u2192import java.io.IOException;\\n    70\u2192import java.util.ArrayList;\\n    71\u2192import java.util.Collections;\\n    72\u2192import java.util.List;\\n    73\u2192import java.util.Map;\\n    74\u2192import java.util.Objects;\\n    75\u2192import java.util.function.Consumer;\\n    76\u2192import java.util.function.Predicate;\\n    77\u2192import java.util.function.ToLongFunction;\\n    78\u2192import java.util.stream.Collectors;\\n    79\u2192\\n    80\u2192import static java.util.Collections.emptyMap;\\n    81\u2192import static org.elasticsearch.action.ValidateActions.addValidationError;\\n    82\u2192import static org.elasticsearch.index.query.AbstractQueryBuilder.parseTopLevelQuery;\\n    83\u2192import static org.elasticsearch.search.internal.SearchContext.DEFAULT_TERMINATE_AFTER;\\n    84\u2192import static org.elasticsearch.search.internal.SearchContext.TRACK_TOTAL_HITS_ACCURATE;\\n    85\u2192import static org.elasticsearch.search.internal.SearchContext.TRACK_TOTAL_HITS_DISABLED;\\n    86\u2192\\n    87\u2192/**\\n    88\u2192 * A search source builder allowing to easily build search source. Simple\\n    89\u2192 * construction using {@link SearchSourceBuilder#searchSource()}.\\n    90\u2192 *\\n    91\u2192 * @see SearchRequest#source(SearchSourceBuilder)\\n    92\u2192 */\\n    93\u2192public final class SearchSourceBuilder implements Writeable, ToXContentObject, Rewriteable<SearchSourceBuilder> {\\n    94\u2192    private static final DeprecationLogger deprecationLogger = DeprecationLogger.getLogger(SearchSourceBuilder.class);\\n    95\u2192\\n    96\u2192    public static final ParseField FROM_FIELD = new ParseField(\\\"from\\\");\\n    97\u2192    public static final ParseField SIZE_FIELD = new ParseField(\\\"size\\\");\\n    98\u2192    public static final ParseField TIMEOUT_FIELD = new ParseField(\\\"timeout\\\");\\n    99\u2192    public static final ParseField TERMINATE_AFTER_FIELD = new ParseField(\\\"terminate_after\\\");\\n   100\u2192    public static final ParseField QUERY_FIELD = new ParseField(\\\"query\\\");\\n   101\u2192    public static final ParseField SUB_SEARCHES_FIELD = new ParseField(\\\"sub_searches\\\");\\n   102\u2192    public static final ParseField POST_FILTER_FIELD = new ParseField(\\\"post_filter\\\");\\n   103\u2192    public static final ParseField KNN_FIELD = new ParseField(\\\"knn\\\");\\n   104\u2192    public static final ParseField RANK_FIELD = new ParseField(\\\"rank\\\");\\n   105\u2192    public static final ParseField MIN_SCORE_FIELD = new ParseField(\\\"min_score\\\");\\n   106\u2192    public static final ParseField VERSION_FIELD = new ParseField(\\\"version\\\");\\n   107\u2192    public static final ParseField SEQ_NO_PRIMARY_TERM_FIELD = new ParseField(\\\"seq_no_primary_term\\\");\\n   108\u2192    public static final ParseField EXPLAIN_FIELD = new ParseField(\\\"explain\\\");\\n   109\u2192    public static final ParseField _SOURCE_FIELD = new ParseField(\\\"_source\\\");\\n   110\u2192    public static final ParseField STORED_FIELDS_FIELD = new ParseField(\\\"stored_fields\\\");\\n   111\u2192    public static final ParseField DOCVALUE_FIELDS_FIELD = new ParseField(\\\"docvalue_fields\\\");\\n   112\u2192    public static final ParseField FETCH_FIELDS_FIELD = new ParseField(\\\"fields\\\");\\n   113\u2192    public static final ParseField SCRIPT_FIELDS_FIELD = new ParseField(\\\"script_fields\\\");\\n   114\u2192    public static final ParseField SCRIPT_FIELD = new ParseField(\\\"script\\\");\\n   115\u2192    public static final ParseField IGNORE_FAILURE_FIELD = new ParseField(\\\"ignore_failure\\\");\\n   116\u2192    public static final ParseField SORT_FIELD = new ParseField(\\\"sort\\\");\\n   117\u2192    public static final ParseField TRACK_SCORES_FIELD = new ParseField(\\\"track_scores\\\");\\n   118\u2192    public static final ParseField TRACK_TOTAL_HITS_FIELD = new ParseField(\\\"track_total_hits\\\");\\n   119\u2192    public static final ParseField INDICES_BOOST_FIELD = new ParseField(\\\"indices_boost\\\");\\n   120\u2192    public static final ParseField AGGREGATIONS_FIELD = new ParseField(\\\"aggregations\\\");\\n   121\u2192    public static final ParseField AGGS_FIELD = new ParseField(\\\"aggs\\\");\\n   122\u2192    public static final ParseField HIGHLIGHT_FIELD = new ParseField(\\\"highlight\\\");\\n   123\u2192    public static final ParseField SUGGEST_FIELD = new ParseField(\\\"suggest\\\");\\n   124\u2192    public static final ParseField RESCORE_FIELD = new ParseField(\\\"rescore\\\");\\n   125\u2192    public static final ParseField STATS_FIELD = new ParseField(\\\"stats\\\");\\n   126\u2192    public static final ParseField EXT_FIELD = new ParseField(\\\"ext\\\");\\n   127\u2192    public static final ParseField PROFILE_FIELD = new ParseField(\\\"profile\\\");\\n   128\u2192    public static final ParseField SEARCH_AFTER = new ParseField(\\\"search_after\\\");\\n   129\u2192    public static final ParseField COLLAPSE = new ParseField(\\\"collapse\\\");\\n   130\u2192    public static final ParseField SLICE = new ParseField(\\\"slice\\\");\\n   131\u2192    public static final ParseField POINT_IN_TIME = new ParseField(\\\"pit\\\");\\n   132\u2192    public static final ParseField RUNTIME_MAPPINGS_FIELD = new ParseField(\\\"runtime_mappings\\\");\\n   133\u2192    public static final ParseField RETRIEVER = new ParseField(\\\"retriever\\\");\\n   134\u2192\\n   135\u2192    private static final boolean RANK_SUPPORTED = Booleans.parseBoolean(System.getProperty(\\\"es.search.rank_supported\\\"), true);\\n   136\u2192\\n   137\u2192    /**\\n   138\u2192     * A static factory method to construct a new search source.\\n   139\u2192     */\\n   140\u2192    public static SearchSourceBuilder searchSource() {\\n   141\u2192        return new SearchSourceBuilder();\\n   142\u2192    }\\n   143\u2192\\n   144\u2192    /**\\n   145\u2192     * A static factory method to construct new search highlights.\\n   146\u2192     */\\n   147\u2192    public static HighlightBuilder highlight() {\\n   148\u2192        return new HighlightBuilder();\\n   149\u2192    }\\n   150\u2192\\n   151\u2192    private transient RetrieverBuilder retrieverBuilder;\\n   152\u2192\\n   153\u2192    private List<SubSearchSourceBuilder> subSearchSourceBuilders = new ArrayList<>();\\n   154\u2192\\n   155\u2192    private QueryBuilder postQueryBuilder;\\n   156\u2192\\n   157\u2192    private List<KnnSearchBuilder> knnSearch = new ArrayList<>();\\n   158\u2192\\n   159\u2192    private RankBuilder rankBuilder = null;\\n   160\u2192\\n   161\u2192    private int from = -1;\\n   162\u2192\\n   163\u2192    private int size = -1;\\n   164\u2192\\n   165\u2192    private Boolean explain;\\n   166\u2192\\n   167\u2192    private Boolean version;\\n   168\u2192\\n   169\u2192    private Boolean seqNoAndPrimaryTerm;\\n   170\u2192\\n   171\u2192    private List<SortBuilder<?>> sorts;\\n   172\u2192\\n   173\u2192    private boolean trackScores = false;\\n   174\u2192\\n   175\u2192    private Integer trackTotalHitsUpTo;\\n   176\u2192\\n   177\u2192    private SearchAfterBuilder searchAfterBuilder;\\n   178\u2192\\n   179\u2192    private SliceBuilder sliceBuilder;\\n   180\u2192\\n   181\u2192    private Float minScore;\\n   182\u2192\\n   183\u2192    private TimeValue timeout = null;\\n   184\u2192    private int terminateAfter = SearchContext.DEFAULT_TERMINATE_AFTER;\\n   185\u2192\\n   186\u2192    private StoredFieldsContext storedFieldsContext;\\n   187\u2192    private List<FieldAndFormat> docValueFields;\\n   188\u2192    private List<ScriptField> scriptFields;\\n   189\u2192    private FetchSourceContext fetchSourceContext;\\n   190\u2192    private List<FieldAndFormat> fetchFields;\\n   191\u2192\\n   192\u2192    private AggregatorFactories.Builder aggregations;\\n   193\u2192\\n   194\u2192    private HighlightBuilder highlightBuilder;\\n   195\u2192\\n   196\u2192    private SuggestBuilder suggestBuilder;\\n   197\u2192\\n   198\u2192    @SuppressWarnings(\\\"rawtypes\\\")\\n   199\u2192    private List<RescorerBuilder> rescoreBuilders;\\n   200\u2192\\n   201\u2192    private List<IndexBoost> indexBoosts = new ArrayList<>();\\n   202\u2192\\n   203\u2192    private List<String> stats;\\n   204\u2192\\n   205\u2192    private List<SearchExtBuilder> extBuilders = Collections.emptyList();\\n   206\u2192\\n   207\u2192    private boolean profile = false;\\n   208\u2192\\n   209\u2192    private CollapseBuilder collapse = null;\\n   210\u2192\\n   211\u2192    private PointInTimeBuilder pointInTimeBuilder = null;\\n   212\u2192\\n   213\u2192    private Map<String, Object> runtimeMappings = emptyMap();\\n   214\u2192\\n   215\u2192    /**\\n   216\u2192     * Constructs a new search source builder.\\n   217\u2192     */\\n   218\u2192    public SearchSourceBuilder() {}\\n   219\u2192\\n   220\u2192    /**\\n   221\u2192     * Read from a stream.\\n   222\u2192     */\\n   223\u2192    public SearchSourceBuilder(StreamInput in) throws IOException {\\n   224\u2192        aggregations = in.readOptionalWriteable(AggregatorFactories.Builder::new);\\n   225\u2192        explain = in.readOptionalBoolean();\\n   226\u2192        fetchSourceContext = in.readOptionalWriteable(FetchSourceContext::readFrom);\\n   227\u2192        if (in.readBoolean()) {\\n   228\u2192            docValueFields = in.readCollectionAsList(FieldAndFormat::new);\\n   229\u2192        } else {\\n   230\u2192            docValueFields = null;\\n   231\u2192        }\\n   232\u2192        storedFieldsContext = in.readOptionalWriteable(StoredFieldsContext::new);\\n   233\u2192        from = in.readVInt();\\n   234\u2192        highlightBuilder = in.readOptionalWriteable(HighlightBuilder::new);\\n   235\u2192        indexBoosts = in.readCollectionAsList(IndexBoost::new);\\n   236\u2192        minScore = in.readOptionalFloat();\\n   237\u2192        postQueryBuilder = in.readOptionalNamedWriteable(QueryBuilder.class);\\n   238\u2192        if (in.getTransportVersion().onOrAfter(TransportVersions.V_8_9_X)) {\\n   239\u2192            subSearchSourceBuilders = in.readCollectionAsList(SubSearchSourceBuilder::new);\\n   240\u2192        } else {\\n   241\u2192            QueryBuilder queryBuilder = in.readOptionalNamedWriteable(QueryBuilder.class);\\n   242\u2192            if (queryBuilder != null) {\\n   243\u2192                subSearchSourceBuilders.add(new SubSearchSourceBuilder(queryBuilder));\\n   244\u2192            }\\n   245\u2192        }\\n   246\u2192        if (in.readBoolean()) {\\n   247\u2192            rescoreBuilders = in.readNamedWriteableCollectionAsList(RescorerBuilder.class);\\n   248\u2192        }\\n   249\u2192        if (in.readBoolean()) {\\n   250\u2192            scriptFields = in.readCollectionAsList(ScriptField::new);\\n   251\u2192        }\\n   252\u2192        size = in.readVInt();\\n   253\u2192        if (in.readBoolean()) {\\n   254\u2192            int size = in.readVInt();\\n   255\u2192            sorts = new ArrayList<>();\\n   256\u2192            for (int i = 0; i < size; i++) {\\n   257\u2192                sorts.add(in.readNamedWriteable(SortBuilder.class));\\n   258\u2192            }\\n   259\u2192        }\\n   260\u2192        if (in.readBoolean()) {\\n   261\u2192            stats = in.readStringCollectionAsList();\\n   262\u2192        }\\n   263\u2192        suggestBuilder = in.readOptionalWriteable(SuggestBuilder::new);\\n   264\u2192        terminateAfter = in.readVInt();\\n   265\u2192        timeout = in.readOptionalTimeValue();\\n   266\u2192        trackScores = in.readBoolean();\\n   267\u2192        version = in.readOptionalBoolean();\\n   268\u2192        seqNoAndPrimaryTerm = in.readOptionalBoolean();\\n   269\u2192        extBuilders = in.readNamedWriteableCollectionAsList(SearchExtBuilder.class);\\n   270\u2192        profile = in.readBoolean();\\n   271\u2192        searchAfterBuilder = in.readOptionalWriteable(SearchAfterBuilder::new);\\n   272\u2192        sliceBuilder = in.readOptionalWriteable(SliceBuilder::new);\\n   273\u2192        collapse = in.readOptionalWriteable(CollapseBuilder::new);\\n   274\u2192        trackTotalHitsUpTo = in.readOptionalInt();\\n   275\u2192        if (in.readBoolean()) {\\n   276\u2192            fetchFields = in.readCollectionAsList(FieldAndFormat::new);\\n   277\u2192        }\\n   278\u2192        pointInTimeBuilder = in.readOptionalWriteable(PointInTimeBuilder::new);\\n   279\u2192        runtimeMappings = in.readGenericMap();\\n   280\u2192        if (in.getTransportVersion().onOrAfter(TransportVersions.V_8_4_0)) {\\n   281\u2192            if (in.getTransportVersion().before(TransportVersions.V_8_7_0)) {\\n   282\u2192                KnnSearchBuilder searchBuilder = in.readOptionalWriteable(KnnSearchBuilder::new);\\n   283\u2192                knnSearch = searchBuilder != null ? List.of(searchBuilder) : List.of();\\n   284\u2192            } else {\\n   285\u2192                knnSearch = in.readCollectionAsList(KnnSearchBuilder::new);\\n   286\u2192            }\\n   287\u2192        }\\n   288\u2192        if (in.getTransportVersion().onOrAfter(TransportVersions.V_8_8_0)) {\\n   289\u2192            rankBuilder = in.readOptionalNamedWriteable(RankBuilder.class);\\n   290\u2192        }\\n   291\u2192    }\\n   292\u2192\\n   293\u2192    @Override\\n   294\u2192    public void writeTo(StreamOutput out) throws IOException {\\n   295\u2192        if (retrieverBuilder != null) {\\n   296\u2192            throw new IllegalStateException(\\\"SearchSourceBuilder should be rewritten first\\\");\\n   297\u2192        }\\n   298\u2192        out.writeOptionalWriteable(aggregations);\\n   299\u2192        out.writeOptionalBoolean(explain);\\n   300\u2192        out.writeOptionalWriteable(fetchSourceContext);\\n   301\u2192        out.writeBoolean(docValueFields != null);\\n   302\u2192        if (docValueFields != null) {\\n   303\u2192            out.writeCollection(docValueFields);\\n   304\u2192        }\\n   305\u2192        out.writeOptionalWriteable(storedFieldsContext);\\n   306\u2192        out.writeVInt(from);\\n   307\u2192        out.writeOptionalWriteable(highlightBuilder);\\n   308\u2192        out.writeCollection(indexBoosts);\\n   309\u2192        out.writeOptionalFloat(minScore);\\n   310\u2192        out.writeOptionalNamedWriteable(postQueryBuilder);\\n   311\u2192        if (out.getTransportVersion().onOrAfter(TransportVersions.V_8_9_X)) {\\n   312\u2192            out.writeCollection(subSearchSourceBuilders);\\n   313\u2192        } else if (out.getTransportVersion().before(TransportVersions.V_8_4_0) && subSearchSourceBuilders.size() >= 2) {\\n   314\u2192            throw new IllegalArgumentException(\\n   315\u2192                \\\"cannot serialize [sub_searches] to version [\\\" + out.getTransportVersion().toReleaseVersion() + \\\"]\\\"\\n   316\u2192            );\\n   317\u2192        } else {\\n   318\u2192            out.writeOptionalNamedWriteable(query());\\n   319\u2192        }\\n   320\u2192        boolean hasRescoreBuilders = rescoreBuilders != null;\\n   321\u2192        out.writeBoolean(hasRescoreBuilders);\\n   322\u2192        if (hasRescoreBuilders) {\\n   323\u2192            out.writeNamedWriteableCollection(rescoreBuilders);\\n   324\u2192        }\\n   325\u2192        boolean hasScriptFields = scriptFields != null;\\n   326\u2192        out.writeBoolean(hasScriptFields);\\n   327\u2192        if (hasScriptFields) {\\n   328\u2192            out.writeCollection(scriptFields);\\n   329\u2192        }\\n   330\u2192        out.writeVInt(size);\\n   331\u2192        boolean hasSorts = sorts != null;\\n   332\u2192        out.writeBoolean(hasSorts);\\n   333\u2192        if (hasSorts) {\\n   334\u2192            out.writeNamedWriteableCollection(sorts);\\n   335\u2192        }\\n   336\u2192        boolean hasStats = stats != null;\\n   337\u2192        out.writeBoolean(hasStats);\\n   338\u2192        if (hasStats) {\\n   339\u2192            out.writeStringCollection(stats);\\n   340\u2192        }\\n   341\u2192        out.writeOptionalWriteable(suggestBuilder);\\n   342\u2192        out.writeVInt(terminateAfter);\\n   343\u2192        out.writeOptionalTimeValue(timeout);\\n   344\u2192        out.writeBoolean(trackScores);\\n   345\u2192        out.writeOptionalBoolean(version);\\n   346\u2192        out.writeOptionalBoolean(seqNoAndPrimaryTerm);\\n   347\u2192        out.writeNamedWriteableCollection(extBuilders);\\n   348\u2192        out.writeBoolean(profile);\\n   349\u2192        out.writeOptionalWriteable(searchAfterBuilder);\\n   350\u2192        out.writeOptionalWriteable(sliceBuilder);\\n   351\u2192        out.writeOptionalWriteable(collapse);\\n   352\u2192        out.writeOptionalInt(trackTotalHitsUpTo);\\n   353\u2192        out.writeBoolean(fetchFields != null);\\n   354\u2192        if (fetchFields != null) {\\n   355\u2192            out.writeCollection(fetchFields);\\n   356\u2192        }\\n   357\u2192        out.writeOptionalWriteable(pointInTimeBuilder);\\n   358\u2192        out.writeGenericMap(runtimeMappings);\\n   359\u2192        if (out.getTransportVersion().onOrAfter(TransportVersions.V_8_4_0)) {\\n   360\u2192            if (out.getTransportVersion().before(TransportVersions.V_8_7_0)) {\\n   361\u2192                if (knnSearch.size() > 1) {\\n   362\u2192                    throw new IllegalArgumentException(\\n   363\u2192                        \\\"Versions before [\\\"\\n   364\u2192                            + TransportVersions.V_8_7_0.toReleaseVersion()\\n   365\u2192                            + \\\"] don't support multiple [knn] search clauses and search was sent to [\\\"\\n   366\u2192                            + out.getTransportVersion().toReleaseVersion()\\n   367\u2192                            + \\\"]\\\"\\n   368\u2192                    );\\n   369\u2192                }\\n   370\u2192                out.writeOptionalWriteable(knnSearch.isEmpty() ? null : knnSearch.get(0));\\n   371\u2192            } else {\\n   372\u2192                out.writeCollection(knnSearch);\\n   373\u2192            }\\n   374\u2192        }\\n   375\u2192        if (out.getTransportVersion().onOrAfter(TransportVersions.V_8_8_0)) {\\n   376\u2192            out.writeOptionalNamedWriteable(rankBuilder);\\n   377\u2192        } else if (rankBuilder != null) {\\n   378\u2192            throw new IllegalArgumentException(\\\"cannot serialize [rank] to version [\\\" + out.getTransportVersion().toReleaseVersion() + \\\"]\\\");\\n   379\u2192        }\\n   380\u2192    }\\n   381\u2192\\n   382\u2192    /**\\n   383\u2192     * Sets the retriever for this request.\\n   384\u2192     */\\n   385\u2192    public SearchSourceBuilder retriever(RetrieverBuilder retrieverBuilder) {\\n   386\u2192        this.retrieverBuilder = retrieverBuilder;\\n   387\u2192        return this;\\n   388\u2192    }\\n   389\u2192\\n   390\u2192    public RetrieverBuilder retriever() {\\n   391\u2192        return retrieverBuilder;\\n   392\u2192    }\\n   393\u2192\\n   394\u2192    /**\\n   395\u2192     * Sets the query for this request.\\n   396\u2192     */\\n   397\u2192    public SearchSourceBuilder query(QueryBuilder queryBuilder) {\\n   398\u2192        subSearchSourceBuilders = new ArrayList<>();\\n   399\u2192        if (queryBuilder != null) {\\n   400\u2192            subSearchSourceBuilders.add(new SubSearchSourceBuilder(queryBuilder));\\n   401\u2192        }\\n   402\u2192        return this;\\n   403\u2192    }\\n   404\u2192\\n   405\u2192    /**\\n   406\u2192     * Gets the query for this request.\\n   407\u2192     *\\n   408\u2192     * @return This will return {@code null} if there are no\\n   409\u2192     * sub searches, a single {@link QueryBuilder} if there is only\\n   410\u2192     * one sub search, and a combined {@link BoolQueryBuilder} if\\n   411\u2192     * there are multiple sub searches where each sub search becomes\\n   412\u2192     * a query with a should clause.\\n   413\u2192     */\\n   414\u2192    public QueryBuilder query() {\\n   415\u2192        if (subSearchSourceBuilders.isEmpty()) {\\n   416\u2192            return null;\\n   417\u2192        } else if (subSearchSourceBuilders.size() == 1) {\\n   418\u2192            return subSearchSourceBuilders.get(0).getQueryBuilder();\\n   419\u2192        } else {\\n   420\u2192            BoolQueryBuilder boolQueryBuilder = new BoolQueryBuilder();\\n   421\u2192            for (SubSearchSourceBuilder subSearchSourceBuilder : subSearchSourceBuilders) {\\n   422\u2192                boolQueryBuilder.should(subSearchSourceBuilder.getQueryBuilder());\\n   423\u2192            }\\n   424\u2192            return boolQueryBuilder;\\n   425\u2192        }\\n   426\u2192    }\\n   427\u2192\\n   428\u2192    /**\\n   429\u2192     * Sets the sub searches for this request.\\n   430\u2192     */\\n   431\u2192    public SearchSourceBuilder subSearches(List<SubSearchSourceBuilder> subSearchSourceBuilders) {\\n   432\u2192        Objects.requireNonNull(subSearchSourceBuilders);\\n   433\u2192        this.subSearchSourceBuilders = subSearchSourceBuilders;\\n   434\u2192        return this;\\n   435\u2192    }\\n   436\u2192\\n   437\u2192    /**\\n   438\u2192     * Gets the sub searches for this request.\\n   439\u2192     */\\n   440\u2192    public List<SubSearchSourceBuilder> subSearches() {\\n   441\u2192        return subSearchSourceBuilders;\\n   442\u2192    }\\n   443\u2192\\n   444\u2192    /**\\n   445\u2192     * Sets a filter that will be executed after the query has been executed and\\n   446\u2192     * only has affect on the search hits (not aggregations). This filter is\\n   447\u2192     * always executed as last filtering mechanism.\\n   448\u2192     */\\n   449\u2192    public SearchSourceBuilder postFilter(QueryBuilder postFilter) {\\n   450\u2192        this.postQueryBuilder = postFilter;\\n   451\u2192        return this;\\n   452\u2192    }\\n   453\u2192\\n   454\u2192    /**\\n   455\u2192     * Gets the post filter for this request\\n   456\u2192     */\\n   457\u2192    public QueryBuilder postFilter() {\\n   458\u2192        return postQueryBuilder;\\n   459\u2192    }\\n   460\u2192\\n   461\u2192    /**\\n   462\u2192     * Defines a kNN search. If a query is also provided, the kNN hits\\n   463\u2192     * are combined with the query hits.\\n   464\u2192     */\\n   465\u2192    public SearchSourceBuilder knnSearch(List<KnnSearchBuilder> knnSearch) {\\n   466\u2192        this.knnSearch = Objects.requireNonNull(knnSearch);\\n   467\u2192        return this;\\n   468\u2192    }\\n   469\u2192\\n   470\u2192    /**\\n   471\u2192     * An optional kNN search definition.\\n   472\u2192     */\\n   473\u2192    public List<KnnSearchBuilder> knnSearch() {\\n   474\u2192        return Collections.unmodifiableList(knnSearch);\\n   475\u2192    }\\n   476\u2192\\n   477\u2192    public SearchSourceBuilder rankBuilder(RankBuilder rankBuilder) {\\n   478\u2192        this.rankBuilder = rankBuilder;\\n   479\u2192        return this;\\n   480\u2192    }\\n   481\u2192\\n   482\u2192    public RankBuilder rankBuilder() {\\n   483\u2192        return rankBuilder;\\n   484\u2192    }\\n   485\u2192\\n   486\u2192    /**\\n   487\u2192     * From index to start the search from. Defaults to {@code 0}.\\n   488\u2192     * Must be a positive value or 0.\\n   489\u2192     */\\n   490\u2192    public SearchSourceBuilder from(int from) {\\n   491\u2192        if (from < 0) {\\n   492\u2192            throw new IllegalArgumentException(\\\"[from] parameter cannot be negative but was [\\\" + from + \\\"]\\\");\\n   493\u2192        }\\n   494\u2192        this.from = from;\\n   495\u2192        return this;\\n   496\u2192    }\\n   497\u2192\\n   498\u2192    /**\\n   499\u2192     * Gets the from index to start the search from.\\n   500\u2192     **/\\n   501\u2192    public int from() {\\n   502\u2192        return from;\\n   503\u2192    }\\n   504\u2192\\n   505\u2192    /**\\n   506\u2192     * The number of search hits to return. Defaults to {@code 10}.\\n   507\u2192     */\\n   508\u2192    public SearchSourceBuilder size(int size) {\\n   509\u2192        if (size < 0) {\\n   510\u2192            throw new IllegalArgumentException(\\\"[size] parameter cannot be negative, found [\\\" + size + \\\"]\\\");\\n   511\u2192        }\\n   512\u2192        this.size = size;\\n   513\u2192        return this;\\n   514\u2192    }\\n   515\u2192\\n   516\u2192    /**\\n   517\u2192     * Gets the number of search hits to return.\\n   518\u2192     */\\n   519\u2192    public int size() {\\n   520\u2192        return size;\\n   521\u2192    }\\n   522\u2192\\n   523\u2192    /**\\n   524\u2192     * Sets the minimum score below which docs will be filtered out.\\n   525\u2192     */\\n   526\u2192    public SearchSourceBuilder minScore(float minScore) {\\n   527\u2192        this.minScore = minScore;\\n   528\u2192        return this;\\n   529\u2192    }\\n   530\u2192\\n   531\u2192    /**\\n   532\u2192     * Gets the minimum score below which docs will be filtered out.\\n   533\u2192     */\\n   534\u2192    public Float minScore() {\\n   535\u2192        return minScore;\\n   536\u2192    }\\n   537\u2192\\n   538\u2192    /**\\n   539\u2192     * Should each {@link org.elasticsearch.search.SearchHit} be returned with\\n   540\u2192     * an explanation of the hit (ranking).\\n   541\u2192     */\\n   542\u2192    public SearchSourceBuilder explain(Boolean explain) {\\n   543\u2192        this.explain = explain;\\n   544\u2192        return this;\\n   545\u2192    }\\n   546\u2192\\n   547\u2192    /**\\n   548\u2192     * Indicates whether each search hit will be returned with an explanation of\\n   549\u2192     * the hit (ranking)\\n   550\u2192     */\\n   551\u2192    public Boolean explain() {\\n   552\u2192        return explain;\\n   553\u2192    }\\n   554\u2192\\n   555\u2192    /**\\n   556\u2192     * Should each {@link org.elasticsearch.search.SearchHit} be returned with a\\n   557\u2192     * version associated with it.\\n   558\u2192     */\\n   559\u2192    public SearchSourceBuilder version(Boolean version) {\\n   560\u2192        this.version = version;\\n   561\u2192        return this;\\n   562\u2192    }\\n   563\u2192\\n   564\u2192    /**\\n   565\u2192     * Indicates whether the document's version will be included in the search\\n   566\u2192     * hits.\\n   567\u2192     */\\n   568\u2192    public Boolean version() {\\n   569\u2192        return version;\\n   570\u2192    }\\n   571\u2192\\n   572\u2192    /**\\n   573\u2192     * Should each {@link org.elasticsearch.search.SearchHit} be returned with the\\n   574\u2192     * sequence number and primary term of the last modification of the document.\\n   575\u2192     */\\n   576\u2192    public SearchSourceBuilder seqNoAndPrimaryTerm(Boolean seqNoAndPrimaryTerm) {\\n   577\u2192        this.seqNoAndPrimaryTerm = seqNoAndPrimaryTerm;\\n   578\u2192        return this;\\n   579\u2192    }\\n   580\u2192\\n   581\u2192    /**\\n   582\u2192     * Indicates whether {@link org.elasticsearch.search.SearchHit}s should be returned with the\\n   583\u2192     * sequence number and primary term of the last modification of the document.\\n   584\u2192     */\\n   585\u2192    public Boolean seqNoAndPrimaryTerm() {\\n   586\u2192        return seqNoAndPrimaryTerm;\\n   587\u2192    }\\n   588\u2192\\n   589\u2192    /**\\n   590\u2192     * An optional timeout to control how long search is allowed to take.\\n   591\u2192     */\\n   592\u2192    public SearchSourceBuilder timeout(TimeValue timeout) {\\n   593\u2192        this.timeout = timeout;\\n   594\u2192        return this;\\n   595\u2192    }\\n   596\u2192\\n   597\u2192    /**\\n   598\u2192     * Gets the timeout to control how long search is allowed to take.\\n   599\u2192     */\\n   600\u2192    public TimeValue timeout() {\\n   601\u2192        return timeout;\\n   602\u2192    }\\n   603\u2192\\n   604\u2192    /**\\n   605\u2192     * An optional terminate_after to terminate the search after collecting\\n   606\u2192     * <code>terminateAfter</code> documents\\n   607\u2192     */\\n   608\u2192    public SearchSourceBuilder terminateAfter(int terminateAfter) {\\n   609\u2192        if (terminateAfter < 0) {\\n   610\u2192            throw new IllegalArgumentException(\\\"terminateAfter must be > 0\\\");\\n   611\u2192        }\\n   612\u2192        this.terminateAfter = terminateAfter;\\n   613\u2192        return this;\\n   614\u2192    }\\n   615\u2192\\n   616\u2192    /**\\n   617\u2192     * Gets the number of documents to terminate after collecting.\\n   618\u2192     */\\n   619\u2192    public int terminateAfter() {\\n   620\u2192        return terminateAfter;\\n   621\u2192    }\\n   622\u2192\\n   623\u2192    /**\\n   624\u2192     * Adds a sort against the given field name and the sort ordering.\\n   625\u2192     *\\n   626\u2192     * @param name\\n   627\u2192     *            The name of the field\\n   628\u2192     * @param order\\n   629\u2192     *            The sort ordering\\n   630\u2192     */\\n   631\u2192    public SearchSourceBuilder sort(String name, SortOrder order) {\\n   632\u2192        if (name.equals(ScoreSortBuilder.NAME)) {\\n   633\u2192            return sort(SortBuilders.scoreSort().order(order));\\n   634\u2192        }\\n   635\u2192        return sort(SortBuilders.fieldSort(name).order(order));\\n   636\u2192    }\\n   637\u2192\\n   638\u2192    /**\\n   639\u2192     * Add a sort against the given field name.\\n   640\u2192     *\\n   641\u2192     * @param name\\n   642\u2192     *            The name of the field to sort by\\n   643\u2192     */\\n   644\u2192    public SearchSourceBuilder sort(String name) {\\n   645\u2192        if (name.equals(ScoreSortBuilder.NAME)) {\\n   646\u2192            return sort(SortBuilders.scoreSort());\\n   647\u2192        }\\n   648\u2192        return sort(SortBuilders.fieldSort(name));\\n   649\u2192    }\\n   650\u2192\\n   651\u2192    /**\\n   652\u2192     * Adds a sort builder.\\n   653\u2192     */\\n   654\u2192    public SearchSourceBuilder sort(SortBuilder<?> sort) {\\n   655\u2192        if (sorts == null) {\\n   656\u2192            sorts = new ArrayList<>();\\n   657\u2192        }\\n   658\u2192        sorts.add(sort);\\n   659\u2192        return this;\\n   660\u2192    }\\n   661\u2192\\n   662\u2192    /**\\n   663\u2192     * Sets the sort builders for this request.\\n   664\u2192     */\\n   665\u2192    public SearchSourceBuilder sort(List<SortBuilder<?>> sorts) {\\n   666\u2192        this.sorts = sorts;\\n   667\u2192        return this;\\n   668\u2192    }\\n   669\u2192\\n   670\u2192    /**\\n   671\u2192     * Gets the sort builders for this request.\\n   672\u2192     */\\n   673\u2192    public List<SortBuilder<?>> sorts() {\\n   674\u2192        return sorts;\\n   675\u2192    }\\n   676\u2192\\n   677\u2192    /**\\n   678\u2192     * Applies when sorting, and controls if scores will be tracked as well.\\n   679\u2192     * Defaults to {@code false}.\\n   680\u2192     */\\n   681\u2192    public SearchSourceBuilder trackScores(boolean trackScores) {\\n   682\u2192        this.trackScores = trackScores;\\n   683\u2192        return this;\\n   684\u2192    }\\n   685\u2192\\n   686\u2192    /**\\n   687\u2192     * Indicates whether scores will be tracked for this request.\\n   688\u2192     */\\n   689\u2192    public boolean trackScores() {\\n   690\u2192        return trackScores;\\n   691\u2192    }\\n   692\u2192\\n   693\u2192    /**\\n   694\u2192     * Indicates if the total hit count for the query should be tracked.\\n   695\u2192     */\\n   696\u2192    public SearchSourceBuilder trackTotalHits(boolean trackTotalHits) {\\n   697\u2192        this.trackTotalHitsUpTo = trackTotalHits ? TRACK_TOTAL_HITS_ACCURATE : TRACK_TOTAL_HITS_DISABLED;\\n   698\u2192        return this;\\n   699\u2192    }\\n   700\u2192\\n   701\u2192    /**\\n   702\u2192     * Returns the total hit count that should be tracked or null if the value is unset.\\n   703\u2192     * Defaults to null.\\n   704\u2192     */\\n   705\u2192    @Nullable\\n   706\u2192    public Integer trackTotalHitsUpTo() {\\n   707\u2192        return trackTotalHitsUpTo;\\n   708\u2192    }\\n   709\u2192\\n   710\u2192    public SearchSourceBuilder trackTotalHitsUpTo(int trackTotalHitsUpTo) {\\n   711\u2192        if (trackTotalHitsUpTo < TRACK_TOTAL_HITS_DISABLED) {\\n   712\u2192            throw new IllegalArgumentException(\\n   713\u2192                \\\"[track_total_hits] parameter must be positive or equals to -1, \\\" + \\\"got \\\" + trackTotalHitsUpTo\\n   714\u2192            );\\n   715\u2192        }\\n   716\u2192        this.trackTotalHitsUpTo = trackTotalHitsUpTo;\\n   717\u2192        return this;\\n   718\u2192    }\\n   719\u2192\\n   720\u2192    /**\\n   721\u2192     * The sort values that indicates which docs this request should \\\"search after\\\".\\n   722\u2192     * The sort values of the search_after must be equal to the number of sort fields in the query and they should be\\n   723\u2192     * of the same type (or parsable as such).\\n   724\u2192     * Defaults to {@code null}.\\n   725\u2192     */\\n   726\u2192    public Object[] searchAfter() {\\n   727\u2192        if (searchAfterBuilder == null) {\\n   728\u2192            return null;\\n   729\u2192        }\\n   730\u2192        return searchAfterBuilder.getSortValues();\\n   731\u2192    }\\n   732\u2192\\n   733\u2192    /**\\n   734\u2192     * Set the sort values that indicates which docs this request should \\\"search after\\\".\\n   735\u2192     */\\n   736\u2192    public SearchSourceBuilder searchAfter(Object[] values) {\\n   737\u2192        this.searchAfterBuilder = new SearchAfterBuilder().setSortValues(values);\\n   738\u2192        return this;\\n   739\u2192    }\\n   740\u2192\\n   741\u2192    /**\\n   742\u2192     * Sets a filter that will restrict the search hits, the top hits and the aggregations to a slice of the results\\n   743\u2192     * of the main query.\\n   744\u2192     */\\n   745\u2192    public SearchSourceBuilder slice(SliceBuilder builder) {\\n   746\u2192        this.sliceBuilder = builder;\\n   747\u2192        return this;\\n   748\u2192    }\\n   749\u2192\\n   750\u2192    /**\\n   751\u2192     * Gets the slice used to filter the search hits, the top hits and the aggregations.\\n   752\u2192     */\\n   753\u2192    public SliceBuilder slice() {\\n   754\u2192        return sliceBuilder;\\n   755\u2192    }\\n   756\u2192\\n   757\u2192    public CollapseBuilder collapse() {\\n   758\u2192        return collapse;\\n   759\u2192    }\\n   760\u2192\\n   761\u2192    public SearchSourceBuilder collapse(CollapseBuilder collapse) {\\n   762\u2192        this.collapse = collapse;\\n   763\u2192        return this;\\n   764\u2192    }\\n   765\u2192\\n   766\u2192    public SearchSourceBuilder aggregationsBuilder(AggregatorFactories.Builder aggregations) {\\n   767\u2192        if (this.aggregations != null) {\\n   768\u2192            throw new IllegalStateException(\\\"cannot override aggregations builder\\\");\\n   769\u2192        }\\n   770\u2192        this.aggregations = aggregations;\\n   771\u2192        return this;\\n   772\u2192    }\\n   773\u2192\\n   774\u2192    /**\\n   775\u2192     * Add an aggregation to perform as part of the search.\\n   776\u2192     */\\n   777\u2192    public SearchSourceBuilder aggregation(AggregationBuilder aggregation) {\\n   778\u2192        if (aggregations == null) {\\n   779\u2192            aggregations = AggregatorFactories.builder();\\n   780\u2192        }\\n   781\u2192        aggregations.addAggregator(aggregation);\\n   782\u2192        return this;\\n   783\u2192    }\\n   784\u2192\\n   785\u2192    /**\\n   786\u2192     * Add an aggregation to perform as part of the search.\\n   787\u2192     */\\n   788\u2192    public SearchSourceBuilder aggregation(PipelineAggregationBuilder aggregation) {\\n   789\u2192        if (aggregations == null) {\\n   790\u2192            aggregations = AggregatorFactories.builder();\\n   791\u2192        }\\n   792\u2192        aggregations.addPipelineAggregator(aggregation);\\n   793\u2192        return this;\\n   794\u2192    }\\n   795\u2192\\n   796\u2192    /**\\n   797\u2192     * Gets the bytes representing the aggregation builders for this request.\\n   798\u2192     */\\n   799\u2192    public AggregatorFactories.Builder aggregations() {\\n   800\u2192        return aggregations;\\n   801\u2192    }\\n   802\u2192\\n   803\u2192    /**\\n   804\u2192     * Adds highlight to perform as part of the search.\\n   805\u2192     */\\n   806\u2192    public SearchSourceBuilder highlighter(HighlightBuilder highlightBuilder) {\\n   807\u2192        this.highlightBuilder = highlightBuilder;\\n   808\u2192        return this;\\n   809\u2192    }\\n   810\u2192\\n   811\u2192    /**\\n   812\u2192     * Gets the highlighter builder for this request.\\n   813\u2192     */\\n   814\u2192    public HighlightBuilder highlighter() {\\n   815\u2192        return highlightBuilder;\\n   816\u2192    }\\n   817\u2192\\n   818\u2192    public SearchSourceBuilder suggest(SuggestBuilder suggestBuilder) {\\n   819\u2192        this.suggestBuilder = suggestBuilder;\\n   820\u2192        return this;\\n   821\u2192    }\\n   822\u2192\\n   823\u2192    /**\\n   824\u2192     * Gets the suggester builder for this request.\\n   825\u2192     */\\n   826\u2192    public SuggestBuilder suggest() {\\n   827\u2192        return suggestBuilder;\\n   828\u2192    }\\n   829\u2192\\n   830\u2192    public SearchSourceBuilder addRescorer(RescorerBuilder<?> rescoreBuilder) {\\n   831\u2192        if (rescoreBuilders == null) {\\n   832\u2192            rescoreBuilders = new ArrayList<>();\\n   833\u2192        }\\n   834\u2192        rescoreBuilders.add(rescoreBuilder);\\n   835\u2192        return this;\\n   836\u2192    }\\n   837\u2192\\n   838\u2192    public SearchSourceBuilder clearRescorers() {\\n   839\u2192        rescoreBuilders = null;\\n   840\u2192        return this;\\n   841\u2192    }\\n   842\u2192\\n   843\u2192    /**\\n   844\u2192     * Should the query be profiled. Defaults to {@code false}\\n   845\u2192     */\\n   846\u2192    public SearchSourceBuilder profile(boolean profile) {\\n   847\u2192        this.profile = profile;\\n   848\u2192        return this;\\n   849\u2192    }\\n   850\u2192\\n   851\u2192    /**\\n   852\u2192     * Return whether to profile query execution, or {@code null} if\\n   853\u2192     * unspecified.\\n   854\u2192     */\\n   855\u2192    public boolean profile() {\\n   856\u2192        return profile;\\n   857\u2192    }\\n   858\u2192\\n   859\u2192    /**\\n   860\u2192     * Gets the bytes representing the rescore builders for this request.\\n   861\u2192     */\\n   862\u2192    @SuppressWarnings(\\\"rawtypes\\\")\\n   863\u2192    public List<RescorerBuilder> rescores() {\\n   864\u2192        return rescoreBuilders;\\n   865\u2192    }\\n   866\u2192\\n   867\u2192    /**\\n   868\u2192     * Indicates whether the response should contain the stored _source for\\n   869\u2192     * every hit\\n   870\u2192     */\\n   871\u2192    public SearchSourceBuilder fetchSource(boolean fetch) {\\n   872\u2192        FetchSourceContext fetchSourceContext = this.fetchSourceContext != null ? this.fetchSourceContext : FetchSourceContext.FETCH_SOURCE;\\n   873\u2192        this.fetchSourceContext = FetchSourceContext.of(fetch, fetchSourceContext.includes(), fetchSourceContext.excludes());\\n   874\u2192        return this;\\n   875\u2192    }\\n   876\u2192\\n   877\u2192    /**\\n   878\u2192     * Indicate that _source should be returned with every hit, with an\\n   879\u2192     * \\\"include\\\" and/or \\\"exclude\\\" set which can include simple wildcard\\n   880\u2192     * elements.\\n   881\u2192     *\\n   882\u2192     * @param include\\n   883\u2192     *            An optional include (optionally wildcarded) pattern to filter\\n   884\u2192     *            the returned _source\\n   885\u2192     * @param exclude\\n   886\u2192     *            An optional exclude (optionally wildcarded) pattern to filter\\n   887\u2192     *            the returned _source\\n   888\u2192     */\\n   889\u2192    public SearchSourceBuilder fetchSource(@Nullable String include, @Nullable String exclude) {\\n   890\u2192        return fetchSource(\\n   891\u2192            include == null ? Strings.EMPTY_ARRAY : new String[] { include },\\n   892\u2192            exclude == null ? Strings.EMPTY_ARRAY : new String[] { exclude }\\n   893\u2192        );\\n   894\u2192    }\\n   895\u2192\\n   896\u2192    /**\\n   897\u2192     * Indicate that _source should be returned with every hit, with an\\n   898\u2192     * \\\"include\\\" and/or \\\"exclude\\\" set which can include simple wildcard\\n   899\u2192     * elements.\\n   900\u2192     *\\n   901\u2192     * @param includes\\n   902\u2192     *            An optional list of include (optionally wildcarded) pattern to\\n   903\u2192     *            filter the returned _source\\n   904\u2192     * @param excludes\\n   905\u2192     *            An optional list of exclude (optionally wildcarded) pattern to\\n   906\u2192     *            filter the returned _source\\n   907\u2192     */\\n   908\u2192    public SearchSourceBuilder fetchSource(@Nullable String[] includes, @Nullable String[] excludes) {\\n   909\u2192        FetchSourceContext fetchSourceContext = this.fetchSourceContext != null ? this.fetchSourceContext : FetchSourceContext.FETCH_SOURCE;\\n   910\u2192        this.fetchSourceContext = FetchSourceContext.of(fetchSourceContext.fetchSource(), includes, excludes);\\n   911\u2192        return this;\\n   912\u2192    }\\n   913\u2192\\n   914\u2192    /**\\n   915\u2192     * Indicate how the _source should be fetched.\\n   916\u2192     */\\n   917\u2192    public SearchSourceBuilder fetchSource(@Nullable FetchSourceContext fetchSourceContext) {\\n   918\u2192        this.fetchSourceContext = fetchSourceContext;\\n   919\u2192        return this;\\n   920\u2192    }\\n   921\u2192\\n   922\u2192    /**\\n   923\u2192     * Gets the {@link FetchSourceContext} which defines how the _source should\\n   924\u2192     * be fetched.\\n   925\u2192     */\\n   926\u2192    public FetchSourceContext fetchSource() {\\n   927\u2192        return fetchSourceContext;\\n   928\u2192    }\\n   929\u2192\\n   930\u2192    /**\\n   931\u2192     * Adds a stored field to load and return as part of the\\n   932\u2192     * search request. If none are specified, the source of the document will be\\n   933\u2192     * return.\\n   934\u2192     */\\n   935\u2192    public SearchSourceBuilder storedField(String name) {\\n   936\u2192        return storedFields(Collections.singletonList(name));\\n   937\u2192    }\\n   938\u2192\\n   939\u2192    /**\\n   940\u2192     * Sets the stored fields to load and return as part of the search request. If none\\n   941\u2192     * are specified, the source of the document will be returned.\\n   942\u2192     */\\n   943\u2192    public SearchSourceBuilder storedFields(List<String> fields) {\\n   944\u2192        if (storedFieldsContext == null) {\\n   945\u2192            storedFieldsContext = StoredFieldsContext.fromList(fields);\\n   946\u2192        } else {\\n   947\u2192            storedFieldsContext.addFieldNames(fields);\\n   948\u2192        }\\n   949\u2192        return this;\\n   950\u2192    }\\n   951\u2192\\n   952\u2192    /**\\n   953\u2192     * Indicates how the stored fields should be fetched.\\n   954\u2192     */\\n   955\u2192    public SearchSourceBuilder storedFields(StoredFieldsContext context) {\\n   956\u2192        storedFieldsContext = context;\\n   957\u2192        return this;\\n   958\u2192    }\\n   959\u2192\\n   960\u2192    /**\\n   961\u2192     * Gets the stored fields context.\\n   962\u2192     */\\n   963\u2192    public StoredFieldsContext storedFields() {\\n   964\u2192        return storedFieldsContext;\\n   965\u2192    }\\n   966\u2192\\n   967\u2192    /**\\n   968\u2192     * Gets the docvalue fields.\\n   969\u2192     */\\n   970\u2192    public List<FieldAndFormat> docValueFields() {\\n   971\u2192        return docValueFields;\\n   972\u2192    }\\n   973\u2192\\n   974\u2192    /**\\n   975\u2192     * Adds a field to load from the doc values and return as part of the\\n   976\u2192     * search request.\\n   977\u2192     */\\n   978\u2192    public SearchSourceBuilder docValueField(String name, @Nullable String format) {\\n   979\u2192        if (docValueFields == null) {\\n   980\u2192            docValueFields = new ArrayList<>();\\n   981\u2192        }\\n   982\u2192        docValueFields.add(new FieldAndFormat(name, format));\\n   983\u2192        return this;\\n   984\u2192    }\\n   985\u2192\\n   986\u2192    /**\\n   987\u2192     * Adds a field to load from the doc values and return as part of the\\n   988\u2192     * search request.\\n   989\u2192     */\\n   990\u2192    public SearchSourceBuilder docValueField(String name) {\\n   991\u2192        return docValueField(name, null);\\n   992\u2192    }\\n   993\u2192\\n   994\u2192    /**\\n   995\u2192     * Gets the fields to load and return as part of the search request.\\n   996\u2192     */\\n   997\u2192    public List<FieldAndFormat> fetchFields() {\\n   998\u2192        return fetchFields;\\n   999\u2192    }\\n  1000\u2192\\n  1001\u2192    /**\\n  1002\u2192     * Adds a field to load and return as part of the search request.\\n  1003\u2192     */\\n  1004\u2192    public SearchSourceBuilder fetchField(String name) {\\n  1005\u2192        return fetchField(new FieldAndFormat(name, null, null));\\n  1006\u2192    }\\n  1007\u2192\\n  1008\u2192    /**\\n  1009\u2192     * Adds a field to load and return as part of the search request.\\n  1010\u2192     * @param fetchField defining the field name, optional format and optional inclusion of unmapped fields\\n  1011\u2192     */\\n  1012\u2192    public SearchSourceBuilder fetchField(FieldAndFormat fetchField) {\\n  1013\u2192        if (fetchFields == null) {\\n  1014\u2192            fetchFields = new ArrayList<>();\\n  1015\u2192        }\\n  1016\u2192        fetchFields.add(fetchField);\\n  1017\u2192        return this;\\n  1018\u2192    }\\n  1019\u2192\\n  1020\u2192    /**\\n  1021\u2192     * Adds a script field under the given name with the provided script.\\n  1022\u2192     *\\n  1023\u2192     * @param name\\n  1024\u2192     *            The name of the field\\n  1025\u2192     * @param script\\n  1026\u2192     *            The script\\n  1027\u2192     */\\n  1028\u2192    public SearchSourceBuilder scriptField(String name, Script script) {\\n  1029\u2192        scriptField(name, script, false);\\n  1030\u2192        return this;\\n  1031\u2192    }\\n  1032\u2192\\n  1033\u2192    /**\\n  1034\u2192     * Adds a script field under the given name with the provided script.\\n  1035\u2192     *\\n  1036\u2192     * @param name\\n  1037\u2192     *            The name of the field\\n  1038\u2192     * @param script\\n  1039\u2192     *            The script\\n  1040\u2192     */\\n  1041\u2192    public SearchSourceBuilder scriptField(String name, Script script, boolean ignoreFailure) {\\n  1042\u2192        if (scriptFields == null) {\\n  1043\u2192            scriptFields = new ArrayList<>();\\n  1044\u2192        }\\n  1045\u2192        scriptFields.add(new ScriptField(name, script, ignoreFailure));\\n  1046\u2192        return this;\\n  1047\u2192    }\\n  1048\u2192\\n  1049\u2192    /**\\n  1050\u2192     * Gets the script fields.\\n  1051\u2192     */\\n  1052\u2192    public List<ScriptField> scriptFields() {\\n  1053\u2192        return scriptFields;\\n  1054\u2192    }\\n  1055\u2192\\n  1056\u2192    /**\\n  1057\u2192     * Sets the boost a specific index or alias will receive when the query is executed\\n  1058\u2192     * against it.\\n  1059\u2192     *\\n  1060\u2192     * @param index\\n  1061\u2192     *            The index or alias to apply the boost against\\n  1062\u2192     * @param indexBoost\\n  1063\u2192     *            The boost to apply to the index\\n  1064\u2192     */\\n  1065\u2192    public SearchSourceBuilder indexBoost(String index, float indexBoost) {\\n  1066\u2192        Objects.requireNonNull(index, \\\"index must not be null\\\");\\n  1067\u2192        this.indexBoosts.add(new IndexBoost(index, indexBoost));\\n  1068\u2192        return this;\\n  1069\u2192    }\\n  1070\u2192\\n  1071\u2192    /**\\n  1072\u2192     * Gets the boost a specific indices or aliases will receive when the query is\\n  1073\u2192     * executed against them.\\n  1074\u2192     */\\n  1075\u2192    public List<IndexBoost> indexBoosts() {\\n  1076\u2192        return indexBoosts;\\n  1077\u2192    }\\n  1078\u2192\\n  1079\u2192    /**\\n  1080\u2192     * The stats groups this request will be aggregated under.\\n  1081\u2192     */\\n  1082\u2192    public SearchSourceBuilder stats(List<String> statsGroups) {\\n  1083\u2192        this.stats = statsGroups;\\n  1084\u2192        return this;\\n  1085\u2192    }\\n  1086\u2192\\n  1087\u2192    /**\\n  1088\u2192     * The stats groups this request will be aggregated under.\\n  1089\u2192     */\\n  1090\u2192    public List<String> stats() {\\n  1091\u2192        return stats;\\n  1092\u2192    }\\n  1093\u2192\\n  1094\u2192    public SearchSourceBuilder ext(List<SearchExtBuilder> searchExtBuilders) {\\n  1095\u2192        this.extBuilders = Objects.requireNonNull(searchExtBuilders, \\\"searchExtBuilders must not be null\\\");\\n  1096\u2192        return this;\\n  1097\u2192    }\\n  1098\u2192\\n  1099\u2192    public List<SearchExtBuilder> ext() {\\n  1100\u2192        return extBuilders;\\n  1101\u2192    }\\n  1102\u2192\\n  1103\u2192    /**\\n  1104\u2192     * @return true if the source only has suggest\\n  1105\u2192     */\\n  1106\u2192    public boolean isSuggestOnly() {\\n  1107\u2192        return suggestBuilder != null && knnSearch.isEmpty() && aggregations == null && subSearchSourceBuilders.isEmpty();\\n  1108\u2192    }\\n  1109\u2192\\n  1110\u2192    /**\\n  1111\u2192     * Returns the point in time that is configured with this query\\n  1112\u2192     */\\n  1113\u2192    public PointInTimeBuilder pointInTimeBuilder() {\\n  1114\u2192        return pointInTimeBuilder;\\n  1115\u2192    }\\n  1116\u2192\\n  1117\u2192    /**\\n  1118\u2192     * Specify a point in time that this query should execute against.\\n  1119\u2192     */\\n  1120\u2192    public SearchSourceBuilder pointInTimeBuilder(PointInTimeBuilder builder) {\\n  1121\u2192        this.pointInTimeBuilder = builder;\\n  1122\u2192        return this;\\n  1123\u2192    }\\n  1124\u2192\\n  1125\u2192    /**\\n  1126\u2192     * Mappings specified on this search request that override built in mappings.\\n  1127\u2192     */\\n  1128\u2192    public Map<String, Object> runtimeMappings() {\\n  1129\u2192        return Collections.unmodifiableMap(runtimeMappings);\\n  1130\u2192    }\\n  1131\u2192\\n  1132\u2192    /**\\n  1133\u2192     * Specify the mappings specified on this search request that override built in mappings.\\n  1134\u2192     */\\n  1135\u2192    public SearchSourceBuilder runtimeMappings(Map<String, Object> runtimeMappings) {\\n  1136\u2192        this.runtimeMappings = runtimeMappings == null ? emptyMap() : runtimeMappings;\\n  1137\u2192        return this;\\n  1138\u2192    }\\n  1139\u2192\\n  1140\u2192    /**\\n  1141\u2192     * Rewrites this search source builder into its primitive form. e.g. by\\n  1142\u2192     * rewriting the QueryBuilder. If the builder did not change the identity\\n  1143\u2192     * reference must be returned otherwise the builder will be rewritten\\n  1144\u2192     * infinitely.\\n  1145\u2192     */\\n  1146\u2192    @Override\\n  1147\u2192    @SuppressWarnings({ \\\"unchecked\\\", \\\"rawtypes\\\" })\\n  1148\u2192    public SearchSourceBuilder rewrite(QueryRewriteContext context) throws IOException {\\n  1149\u2192        assert (this.equals(\\n  1150\u2192            shallowCopy(\\n  1151\u2192                subSearchSourceBuilders,\\n  1152\u2192                postQueryBuilder,\\n  1153\u2192                knnSearch,\\n  1154\u2192                aggregations,\\n  1155\u2192                sliceBuilder,\\n  1156\u2192                sorts,\\n  1157\u2192                rescoreBuilders,\\n  1158\u2192                highlightBuilder\\n  1159\u2192            )\\n  1160\u2192        ));\\n  1161\u2192        if (retrieverBuilder != null) {\\n  1162\u2192            var newRetriever = retrieverBuilder.rewrite(context);\\n  1163\u2192            if (newRetriever != retrieverBuilder) {\\n  1164\u2192                var rewritten = shallowCopy();\\n  1165\u2192                rewritten.retrieverBuilder = newRetriever;\\n  1166\u2192                return rewritten;\\n  1167\u2192            } else {\\n  1168\u2192                // retriever is transient, the rewritten version is extracted in this source.\\n  1169\u2192                var retriever = retrieverBuilder;\\n  1170\u2192                retrieverBuilder = null;\\n  1171\u2192                retriever.extractToSearchSourceBuilder(this, false);\\n  1172\u2192                validate();\\n  1173\u2192            }\\n  1174\u2192        }\\n  1175\u2192\\n  1176\u2192        List<SubSearchSourceBuilder> subSearchSourceBuilders = Rewriteable.rewrite(this.subSearchSourceBuilders, context);\\n  1177\u2192        QueryBuilder postQueryBuilder = null;\\n  1178\u2192        if (this.postQueryBuilder != null) {\\n  1179\u2192            postQueryBuilder = this.postQueryBuilder.rewrite(context);\\n  1180\u2192        }\\n  1181\u2192        List<KnnSearchBuilder> knnSearch = Rewriteable.rewrite(this.knnSearch, context);\\n  1182\u2192        AggregatorFactories.Builder aggregations = null;\\n  1183\u2192        if (this.aggregations != null) {\\n  1184\u2192            aggregations = this.aggregations.rewrite(context);\\n  1185\u2192        }\\n  1186\u2192        List<SortBuilder<?>> sorts = Rewriteable.rewrite(this.sorts, context);\\n  1187\u2192\\n  1188\u2192        List<RescorerBuilder> rescoreBuilders = Rewriteable.rewrite(this.rescoreBuilders, context);\\n  1189\u2192        HighlightBuilder highlightBuilder = this.highlightBuilder;\\n  1190\u2192        if (highlightBuilder != null) {\\n  1191\u2192            highlightBuilder = this.highlightBuilder.rewrite(context);\\n  1192\u2192        }\\n  1193\u2192\\n  1194\u2192        boolean rewritten = subSearchSourceBuilders != this.subSearchSourceBuilders\\n  1195\u2192            || postQueryBuilder != this.postQueryBuilder\\n  1196\u2192            || knnSearch != this.knnSearch\\n  1197\u2192            || aggregations != this.aggregations\\n  1198\u2192            || rescoreBuilders != this.rescoreBuilders\\n  1199\u2192            || sorts != this.sorts\\n  1200\u2192            || this.highlightBuilder != highlightBuilder;\\n  1201\u2192        if (rewritten) {\\n  1202\u2192            return shallowCopy(\\n  1203\u2192                subSearchSourceBuilders,\\n  1204\u2192                postQueryBuilder,\\n  1205\u2192                knnSearch,\\n  1206\u2192                aggregations,\\n  1207\u2192                this.sliceBuilder,\\n  1208\u2192                sorts,\\n  1209\u2192                rescoreBuilders,\\n  1210\u2192                highlightBuilder\\n  1211\u2192            );\\n  1212\u2192        }\\n  1213\u2192        return this;\\n  1214\u2192    }\\n  1215\u2192\\n  1216\u2192    /**\\n  1217\u2192     * Create a shallow copy of this builder with a new slice configuration.\\n  1218\u2192     */\\n  1219\u2192    public SearchSourceBuilder shallowCopy() {\\n  1220\u2192        return shallowCopy(\\n  1221\u2192            subSearchSourceBuilders,\\n  1222\u2192            postQueryBuilder,\\n  1223\u2192            knnSearch,\\n  1224\u2192            aggregations,\\n  1225\u2192            sliceBuilder,\\n  1226\u2192            sorts,\\n  1227\u2192            rescoreBuilders,\\n  1228\u2192            highlightBuilder\\n  1229\u2192        );\\n  1230\u2192    }\\n  1231\u2192\\n  1232\u2192    /**\\n  1233\u2192     * Create a shallow copy of this source replaced {@link #subSearchSourceBuilders}, {@link #postQueryBuilder}, and {@link #sliceBuilder}.\\n  1234\u2192     * Used by {@link #rewrite(QueryRewriteContext)}}.\\n  1235\u2192     */\\n  1236\u2192    @SuppressWarnings(\\\"rawtypes\\\")\\n  1237\u2192    private SearchSourceBuilder shallowCopy(\\n  1238\u2192        List<SubSearchSourceBuilder> subSearchSourceBuilders,\\n  1239\u2192        QueryBuilder postQueryBuilder,\\n  1240\u2192        List<KnnSearchBuilder> knnSearch,\\n  1241\u2192        AggregatorFactories.Builder aggregations,\\n  1242\u2192        SliceBuilder slice,\\n  1243\u2192        List<SortBuilder<?>> sorts,\\n  1244\u2192        List<RescorerBuilder> rescoreBuilders,\\n  1245\u2192        HighlightBuilder highlightBuilder\\n  1246\u2192    ) {\\n  1247\u2192        SearchSourceBuilder rewrittenBuilder = new SearchSourceBuilder();\\n  1248\u2192        rewrittenBuilder.aggregations = aggregations;\\n  1249\u2192        rewrittenBuilder.explain = explain;\\n  1250\u2192        rewrittenBuilder.extBuilders = extBuilders;\\n  1251\u2192        rewrittenBuilder.fetchSourceContext = fetchSourceContext;\\n  1252\u2192        rewrittenBuilder.fetchFields = fetchFields;\\n  1253\u2192        rewrittenBuilder.docValueFields = docValueFields;\\n  1254\u2192        rewrittenBuilder.storedFieldsContext = storedFieldsContext;\\n  1255\u2192        rewrittenBuilder.from = from;\\n  1256\u2192        rewrittenBuilder.highlightBuilder = highlightBuilder;\\n  1257\u2192        rewrittenBuilder.indexBoosts = indexBoosts;\\n  1258\u2192        rewrittenBuilder.minScore = minScore;\\n  1259\u2192        rewrittenBuilder.postQueryBuilder = postQueryBuilder;\\n  1260\u2192        rewrittenBuilder.knnSearch = knnSearch;\\n  1261\u2192        rewrittenBuilder.rankBuilder = rankBuilder;\\n  1262\u2192        rewrittenBuilder.profile = profile;\\n  1263\u2192        rewrittenBuilder.subSearchSourceBuilders = subSearchSourceBuilders;\\n  1264\u2192        rewrittenBuilder.rescoreBuilders = rescoreBuilders;\\n  1265\u2192        rewrittenBuilder.scriptFields = scriptFields;\\n  1266\u2192        rewrittenBuilder.searchAfterBuilder = searchAfterBuilder;\\n  1267\u2192        rewrittenBuilder.sliceBuilder = slice;\\n  1268\u2192        rewrittenBuilder.size = size;\\n  1269\u2192        rewrittenBuilder.sorts = sorts;\\n  1270\u2192        rewrittenBuilder.stats = stats;\\n  1271\u2192        rewrittenBuilder.suggestBuilder = suggestBuilder;\\n  1272\u2192        rewrittenBuilder.terminateAfter = terminateAfter;\\n  1273\u2192        rewrittenBuilder.timeout = timeout;\\n  1274\u2192        rewrittenBuilder.trackScores = trackScores;\\n  1275\u2192        rewrittenBuilder.trackTotalHitsUpTo = trackTotalHitsUpTo;\\n  1276\u2192        rewrittenBuilder.version = version;\\n  1277\u2192        rewrittenBuilder.seqNoAndPrimaryTerm = seqNoAndPrimaryTerm;\\n  1278\u2192        rewrittenBuilder.collapse = collapse;\\n  1279\u2192        rewrittenBuilder.pointInTimeBuilder = pointInTimeBuilder;\\n  1280\u2192        rewrittenBuilder.runtimeMappings = runtimeMappings;\\n  1281\u2192        return rewrittenBuilder;\\n  1282\u2192    }\\n  1283\u2192\\n  1284\u2192    /**\\n  1285\u2192     * Parse some xContent into this SearchSourceBuilder, overwriting any values specified in the xContent.\\n  1286\u2192     *\\n  1287\u2192     * @param parser The xContent parser.\\n  1288\u2192     * @param checkTrailingTokens If true throws a parsing exception when extra tokens are found after the main object.\\n  1289\u2192     * @param searchUsageHolder holder for the search usage statistics\\n  1290\u2192     * @param clusterSupportsFeature used to check if certain features are available on this cluster\\n  1291\u2192     */\\n  1292\u2192    public SearchSourceBuilder parseXContent(\\n  1293\u2192        XContentParser parser,\\n  1294\u2192        boolean checkTrailingTokens,\\n  1295\u2192        SearchUsageHolder searchUsageHolder,\\n  1296\u2192        Predicate<NodeFeature> clusterSupportsFeature\\n  1297\u2192    ) throws IOException {\\n  1298\u2192        return parseXContent(parser, checkTrailingTokens, searchUsageHolder::updateUsage, clusterSupportsFeature);\\n  1299\u2192    }\\n  1300\u2192\\n  1301\u2192    /**\\n  1302\u2192     * Parse some xContent into this SearchSourceBuilder, overwriting any values specified in the xContent.\\n  1303\u2192     * This variant does not record search features usage. Most times the variant that accepts a {@link SearchUsageHolder} and records\\n  1304\u2192     * usage stats into it is the one to use.\\n  1305\u2192     *\\n  1306\u2192     * @param parser The xContent parser.\\n  1307\u2192     * @param checkTrailingTokens If true throws a parsing exception when extra tokens are found after the main object.\\n  1308\u2192     * @param clusterSupportsFeature used to check if certain features are available on this cluster\\n  1309\u2192     */\\n  1310\u2192    public SearchSourceBuilder parseXContent(\\n  1311\u2192        XContentParser parser,\\n  1312\u2192        boolean checkTrailingTokens,\\n  1313\u2192        Predicate<NodeFeature> clusterSupportsFeature\\n  1314\u2192    ) throws IOException {\\n  1315\u2192        return parseXContent(parser, checkTrailingTokens, s -> {}, clusterSupportsFeature);\\n  1316\u2192    }\\n  1317\u2192\\n  1318\u2192    private SearchSourceBuilder parseXContent(\\n  1319\u2192        XContentParser parser,\\n  1320\u2192        boolean checkTrailingTokens,\\n  1321\u2192        Consumer<SearchUsage> searchUsageConsumer,\\n  1322\u2192        Predicate<NodeFeature> clusterSupportsFeature\\n  1323\u2192    ) throws IOException {\\n  1324\u2192        XContentParser.Token token = parser.currentToken();\\n  1325\u2192        String currentFieldName = null;\\n  1326\u2192        if (token != XContentParser.Token.START_OBJECT && (token = parser.nextToken()) != XContentParser.Token.START_OBJECT) {\\n  1327\u2192            throw new ParsingException(\\n  1328\u2192                parser.getTokenLocation(),\\n  1329\u2192                \\\"Expected [\\\" + XContentParser.Token.START_OBJECT + \\\"] but found [\\\" + token + \\\"]\\\",\\n  1330\u2192                parser.getTokenLocation()\\n  1331\u2192            );\\n  1332\u2192        }\\n  1333\u2192        List<KnnSearchBuilder.Builder> knnBuilders = new ArrayList<>();\\n  1334\u2192\\n  1335\u2192        SearchUsage searchUsage = new SearchUsage();\\n  1336\u2192        while ((token = parser.nextToken()) != XContentParser.Token.END_OBJECT) {\\n  1337\u2192            if (token == XContentParser.Token.FIELD_NAME) {\\n  1338\u2192                currentFieldName = parser.currentName();\\n  1339\u2192            } else if (token.isValue()) {\\n  1340\u2192                if (FROM_FIELD.match(currentFieldName, parser.getDeprecationHandler())) {\\n  1341\u2192                    from(parser.intValue());\\n  1342\u2192                } else if (SIZE_FIELD.match(currentFieldName, parser.getDeprecationHandler())) {\\n  1343\u2192                    size(parser.intValue());\\n  1344\u2192                } else if (TIMEOUT_FIELD.match(currentFieldName, parser.getDeprecationHandler())) {\\n  1345\u2192                    timeout = TimeValue.parseTimeValue(parser.text(), null, TIMEOUT_FIELD.getPreferredName());\\n  1346\u2192                } else if (TERMINATE_AFTER_FIELD.match(currentFieldName, parser.getDeprecationHandler())) {\\n  1347\u2192                    terminateAfter(parser.intValue());\\n  1348\u2192                    searchUsage.trackSectionUsage(TERMINATE_AFTER_FIELD.getPreferredName());\\n  1349\u2192                } else if (MIN_SCORE_FIELD.match(currentFieldName, parser.getDeprecationHandler())) {\\n  1350\u2192                    minScore = parser.floatValue();\\n  1351\u2192                    searchUsage.trackSectionUsage(MIN_SCORE_FIELD.getPreferredName());\\n  1352\u2192                } else if (VERSION_FIELD.match(currentFieldName, parser.getDeprecationHandler())) {\\n  1353\u2192                    version = parser.booleanValue();\\n  1354\u2192                } else if (SEQ_NO_PRIMARY_TERM_FIELD.match(currentFieldName, parser.getDeprecationHandler())) {\\n  1355\u2192                    seqNoAndPrimaryTerm = parser.booleanValue();\\n  1356\u2192                } else if (EXPLAIN_FIELD.match(currentFieldName, parser.getDeprecationHandler())) {\\n  1357\u2192                    explain = parser.booleanValue();\\n  1358\u2192                } else if (TRACK_SCORES_FIELD.match(currentFieldName, parser.getDeprecationHandler())) {\\n  1359\u2192                    trackScores = parser.booleanValue();\\n  1360\u2192                } else if (TRACK_TOTAL_HITS_FIELD.match(currentFieldName, parser.getDeprecationHandler())) {\\n  1361\u2192                    if (token == XContentParser.Token.VALUE_BOOLEAN\\n  1362\u2192                        || (token == XContentParser.Token.VALUE_STRING && Booleans.isBoolean(parser.text()))) {\\n  1363\u2192                        trackTotalHits(parser.booleanValue());\\n  1364\u2192                    } else {\\n  1365\u2192                        trackTotalHitsUpTo(parser.intValue());\\n  1366\u2192                    }\\n  1367\u2192                } else if (_SOURCE_FIELD.match(currentFieldName, parser.getDeprecationHandler())) {\\n  1368\u2192                    fetchSourceContext = FetchSourceContext.fromXContent(parser);\\n  1369\u2192                    if (fetchSourceContext.includes().length > 0 || fetchSourceContext.fetchSource() == false) {\\n  1370\u2192                        searchUsage.trackSectionUsage(_SOURCE_FIELD.getPreferredName());\\n  1371\u2192                    }\\n  1372\u2192                } else if (STORED_FIELDS_FIELD.match(currentFieldName, parser.getDeprecationHandler())) {\\n  1373\u2192                    storedFieldsContext = StoredFieldsContext.fromXContent(\\n  1374\u2192                        SearchSourceBuilder.STORED_FIELDS_FIELD.getPreferredName(),\\n  1375\u2192                        parser\\n  1376\u2192                    );\\n  1377\u2192                    if (storedFieldsContext.fetchFields() == false\\n  1378\u2192                        || (storedFieldsContext.fieldNames() != null && storedFieldsContext.fieldNames().size() > 0)) {\\n  1379\u2192                        searchUsage.trackSectionUsage(STORED_FIELDS_FIELD.getPreferredName());\\n  1380\u2192                    }\\n  1381\u2192                } else if (SORT_FIELD.match(currentFieldName, parser.getDeprecationHandler())) {\\n  1382\u2192                    sort(parser.text());\\n  1383\u2192                } else if (PROFILE_FIELD.match(currentFieldName, parser.getDeprecationHandler())) {\\n  1384\u2192                    profile = parser.booleanValue();\\n  1385\u2192                } else {\\n  1386\u2192                    throw new ParsingException(\\n  1387\u2192                        parser.getTokenLocation(),\\n  1388\u2192                        \\\"Unknown key for a \\\" + token + \\\" in [\\\" + currentFieldName + \\\"].\\\",\\n  1389\u2192                        parser.getTokenLocation()\\n  1390\u2192                    );\\n  1391\u2192                }\\n  1392\u2192            } else if (token == XContentParser.Token.START_OBJECT) {\\n  1393\u2192                if (RETRIEVER.match(currentFieldName, parser.getDeprecationHandler())) {\\n  1394\u2192                    if (clusterSupportsFeature.test(RetrieverBuilder.RETRIEVERS_SUPPORTED) == false) {\\n  1395\u2192                        throw new ParsingException(parser.getTokenLocation(), \\\"Unknown key for a START_OBJECT in [retriever].\\\");\\n  1396\u2192                    }\\n  1397\u2192                    retrieverBuilder = RetrieverBuilder.parseTopLevelRetrieverBuilder(\\n  1398\u2192                        parser,\\n  1399\u2192                        new RetrieverParserContext(searchUsage, clusterSupportsFeature)\\n  1400\u2192                    );\\n  1401\u2192                    searchUsage.trackSectionUsage(RETRIEVER.getPreferredName());\\n  1402\u2192                } else if (QUERY_FIELD.match(currentFieldName, parser.getDeprecationHandler())) {\\n  1403\u2192                    if (subSearchSourceBuilders.isEmpty() == false) {\\n  1404\u2192                        throw new IllegalArgumentException(\\n  1405\u2192                            \\\"cannot specify field [\\\" + currentFieldName + \\\"] and field [\\\" + SUB_SEARCHES_FIELD.getPreferredName() + \\\"]\\\"\\n  1406\u2192                        );\\n  1407\u2192                    }\\n  1408\u2192                    QueryBuilder queryBuilder = parseTopLevelQuery(parser, searchUsage::trackQueryUsage);\\n  1409\u2192                    subSearchSourceBuilders.add(new SubSearchSourceBuilder(queryBuilder));\\n  1410\u2192                    searchUsage.trackSectionUsage(QUERY_FIELD.getPreferredName());\\n  1411\u2192                } else if (POST_FILTER_FIELD.match(currentFieldName, parser.getDeprecationHandler())) {\\n  1412\u2192                    postQueryBuilder = parseTopLevelQuery(parser, searchUsage::trackQueryUsage);\\n  1413\u2192                    searchUsage.trackSectionUsage(POST_FILTER_FIELD.getPreferredName());\\n  1414\u2192                } else if (KNN_FIELD.match(currentFieldName, parser.getDeprecationHandler())) {\\n  1415\u2192                    knnBuilders = List.of(KnnSearchBuilder.fromXContent(parser));\\n  1416\u2192                    searchUsage.trackSectionUsage(KNN_FIELD.getPreferredName());\\n  1417\u2192                } else if (RANK_FIELD.match(currentFieldName, parser.getDeprecationHandler())) {\\n  1418\u2192                    if (RANK_SUPPORTED == false) {\\n  1419\u2192                        throwUnknownKey(parser, token, currentFieldName);\\n  1420\u2192                    }\\n  1421\u2192                    if (parser.nextToken() != XContentParser.Token.FIELD_NAME) {\\n  1422\u2192                        throw new ParsingException(\\n  1423\u2192                            parser.getTokenLocation(),\\n  1424\u2192                            \\\"expected a rank name, but found token [\\\" + token + \\\"] for [\\\" + RANK_FIELD.getPreferredName() + \\\"]\\\"\\n  1425\u2192                        );\\n  1426\u2192                    }\\n  1427\u2192                    rankBuilder = parser.namedObject(RankBuilder.class, parser.currentName(), null);\\n  1428\u2192                    if (parser.currentToken() != XContentParser.Token.END_OBJECT) {\\n  1429\u2192                        throw new ParsingException(\\n  1430\u2192                            parser.getTokenLocation(),\\n  1431\u2192                            \\\"expected token '}', but found token [\\\" + token + \\\"] for [\\\" + RANK_FIELD.getPreferredName() + \\\"]\\\"\\n  1432\u2192                        );\\n  1433\u2192                    }\\n  1434\u2192                    parser.nextToken();\\n  1435\u2192                    searchUsage.trackSectionUsage(\\\"rank_\\\" + rankBuilder.getWriteableName());\\n  1436\u2192                } else if (_SOURCE_FIELD.match(currentFieldName, parser.getDeprecationHandler())) {\\n  1437\u2192                    fetchSourceContext = FetchSourceContext.fromXContent(parser);\\n  1438\u2192                    if (fetchSourceContext.fetchSource() == false\\n  1439\u2192                        || fetchSourceContext.includes().length > 0\\n  1440\u2192                        || fetchSourceContext.excludes().length > 0) {\\n  1441\u2192                        searchUsage.trackSectionUsage(_SOURCE_FIELD.getPreferredName());\\n  1442\u2192                    }\\n  1443\u2192                } else if (SCRIPT_FIELDS_FIELD.match(currentFieldName, parser.getDeprecationHandler())) {\\n  1444\u2192                    scriptFields = new ArrayList<>();\\n  1445\u2192                    while ((parser.nextToken()) != XContentParser.Token.END_OBJECT) {\\n  1446\u2192                        scriptFields.add(new ScriptField(parser));\\n  1447\u2192                    }\\n  1448\u2192                    searchUsage.trackSectionUsage(SCRIPT_FIELDS_FIELD.getPreferredName());\\n  1449\u2192                } else if (AGGREGATIONS_FIELD.match(currentFieldName, parser.getDeprecationHandler())\\n  1450\u2192                    || AGGS_FIELD.match(currentFieldName, parser.getDeprecationHandler())) {\\n  1451\u2192                        aggregations = AggregatorFactories.parseAggregators(parser);\\n  1452\u2192                        if (aggregations.count() > 0) {\\n  1453\u2192                            searchUsage.trackSectionUsage(AGGS_FIELD.getPreferredName());\\n  1454\u2192                        }\\n  1455\u2192                    } else if (HIGHLIGHT_FIELD.match(currentFieldName, parser.getDeprecationHandler())) {\\n  1456\u2192                        highlightBuilder = HighlightBuilder.fromXContent(parser);\\n  1457\u2192                        if (highlightBuilder.fields().size() > 0) {\\n  1458\u2192                            searchUsage.trackSectionUsage(HIGHLIGHT_FIELD.getPreferredName());\\n  1459\u2192                        }\\n  1460\u2192                    } else if (SUGGEST_FIELD.match(currentFieldName, parser.getDeprecationHandler())) {\\n  1461\u2192                        suggestBuilder = SuggestBuilder.fromXContent(parser);\\n  1462\u2192                        if (suggestBuilder.getSuggestions().size() > 0) {\\n  1463\u2192                            searchUsage.trackSectionUsage(SUGGEST_FIELD.getPreferredName());\\n  1464\u2192                        }\\n  1465\u2192                    } else if (SORT_FIELD.match(currentFieldName, parser.getDeprecationHandler())) {\\n  1466\u2192                        sorts = new ArrayList<>(SortBuilder.fromXContent(parser));\\n  1467\u2192                    } else if (RESCORE_FIELD.match(currentFieldName, parser.getDeprecationHandler())) {\\n  1468\u2192                        rescoreBuilders = new ArrayList<>();\\n  1469\u2192                        rescoreBuilders.add(RescorerBuilder.parseFromXContent(parser, searchUsage::trackRescorerUsage));\\n  1470\u2192                        searchUsage.trackSectionUsage(RESCORE_FIELD.getPreferredName());\\n  1471\u2192                    } else if (EXT_FIELD.match(currentFieldName, parser.getDeprecationHandler())) {\\n  1472\u2192                        extBuilders = new ArrayList<>();\\n  1473\u2192                        String extSectionName = null;\\n  1474\u2192                        while ((token = parser.nextToken()) != XContentParser.Token.END_OBJECT) {\\n  1475\u2192                            if (token == XContentParser.Token.FIELD_NAME) {\\n  1476\u2192                                extSectionName = parser.currentName();\\n  1477\u2192                            } else {\\n  1478\u2192                                SearchExtBuilder searchExtBuilder = parser.namedObject(SearchExtBuilder.class, extSectionName, null);\\n  1479\u2192                                if (searchExtBuilder.getWriteableName().equals(extSectionName) == false) {\\n  1480\u2192                                    throw new IllegalStateException(\\n  1481\u2192                                        \\\"The parsed [\\\"\\n  1482\u2192                                            + searchExtBuilder.getClass().getName()\\n  1483\u2192                                            + \\\"] object has a different writeable name compared to the name of the section that \\\"\\n  1484\u2192                                            + \\\" it was parsed from: found [\\\"\\n  1485\u2192                                            + searchExtBuilder.getWriteableName()\\n  1486\u2192                                            + \\\"] expected [\\\"\\n  1487\u2192                                            + extSectionName\\n  1488\u2192                                            + \\\"]\\\"\\n  1489\u2192                                    );\\n  1490\u2192                                }\\n  1491\u2192                                extBuilders.add(searchExtBuilder);\\n  1492\u2192                            }\\n  1493\u2192                        }\\n  1494\u2192                        if (extBuilders.size() > 0) {\\n  1495\u2192                            searchUsage.trackSectionUsage(EXT_FIELD.getPreferredName());\\n  1496\u2192                        }\\n  1497\u2192                    } else if (SLICE.match(currentFieldName, parser.getDeprecationHandler())) {\\n  1498\u2192                        sliceBuilder = SliceBuilder.fromXContent(parser);\\n  1499\u2192                        if (sliceBuilder.getField() != null || sliceBuilder.getId() != -1 || sliceBuilder.getMax() != -1) {\\n  1500\u2192                            searchUsage.trackSectionUsage(SLICE.getPreferredName());\\n  1501\u2192                        }\\n  1502\u2192                    } else if (COLLAPSE.match(currentFieldName, parser.getDeprecationHandler())) {\\n  1503\u2192                        collapse = CollapseBuilder.fromXContent(parser);\\n  1504\u2192                        if (collapse.getField() != null) {\\n  1505\u2192                            searchUsage.trackSectionUsage(COLLAPSE.getPreferredName());\\n  1506\u2192                        }\\n  1507\u2192                    } else if (POINT_IN_TIME.match(currentFieldName, parser.getDeprecationHandler())) {\\n  1508\u2192                        pointInTimeBuilder = PointInTimeBuilder.fromXContent(parser);\\n  1509\u2192                        searchUsage.trackSectionUsage(POINT_IN_TIME.getPreferredName());\\n  1510\u2192                    } else if (RUNTIME_MAPPINGS_FIELD.match(currentFieldName, parser.getDeprecationHandler())) {\\n  1511\u2192                        runtimeMappings = parser.map();\\n  1512\u2192                        if (runtimeMappings.size() > 0) {\\n  1513\u2192                            searchUsage.trackSectionUsage(RUNTIME_MAPPINGS_FIELD.getPreferredName());\\n  1514\u2192                        }\\n  1515\u2192                    } else {\\n  1516\u2192                        throw new ParsingException(\\n  1517\u2192                            parser.getTokenLocation(),\\n  1518\u2192                            \\\"Unknown key for a \\\" + token + \\\" in [\\\" + currentFieldName + \\\"].\\\",\\n  1519\u2192                            parser.getTokenLocation()\\n  1520\u2192                        );\\n  1521\u2192                    }\\n  1522\u2192            } else if (token == XContentParser.Token.START_ARRAY) {\\n  1523\u2192                if (STORED_FIELDS_FIELD.match(currentFieldName, parser.getDeprecationHandler())) {\\n  1524\u2192                    storedFieldsContext = StoredFieldsContext.fromXContent(STORED_FIELDS_FIELD.getPreferredName(), parser);\\n  1525\u2192                    if (storedFieldsContext.fetchFields() == false\\n  1526\u2192                        || (storedFieldsContext.fieldNames() != null && storedFieldsContext.fieldNames().size() > 0)) {\\n  1527\u2192                        searchUsage.trackSectionUsage(STORED_FIELDS_FIELD.getPreferredName());\\n  1528\u2192                    }\\n  1529\u2192                } else if (DOCVALUE_FIELDS_FIELD.match(currentFieldName, parser.getDeprecationHandler())) {\\n  1530\u2192                    docValueFields = new ArrayList<>();\\n  1531\u2192                    while ((parser.nextToken()) != XContentParser.Token.END_ARRAY) {\\n  1532\u2192                        docValueFields.add(FieldAndFormat.fromXContent(parser));\\n  1533\u2192                    }\\n  1534\u2192                    if (docValueFields.size() > 0) {\\n  1535\u2192                        searchUsage.trackSectionUsage(DOCVALUE_FIELDS_FIELD.getPreferredName());\\n  1536\u2192                    }\\n  1537\u2192                } else if (FETCH_FIELDS_FIELD.match(currentFieldName, parser.getDeprecationHandler())) {\\n  1538\u2192                    fetchFields = new ArrayList<>();\\n  1539\u2192                    while ((parser.nextToken()) != XContentParser.Token.END_ARRAY) {\\n  1540\u2192                        fetchFields.add(FieldAndFormat.fromXContent(parser));\\n  1541\u2192                    }\\n  1542\u2192                    if (fetchFields.size() > 0) {\\n  1543\u2192                        searchUsage.trackSectionUsage(FETCH_FIELDS_FIELD.getPreferredName());\\n  1544\u2192                    }\\n  1545\u2192                } else if (INDICES_BOOST_FIELD.match(currentFieldName, parser.getDeprecationHandler())) {\\n  1546\u2192                    while ((parser.nextToken()) != XContentParser.Token.END_ARRAY) {\\n  1547\u2192                        indexBoosts.add(new IndexBoost(parser));\\n  1548\u2192                    }\\n  1549\u2192                    if (indexBoosts.size() > 0) {\\n  1550\u2192                        searchUsage.trackSectionUsage(INDICES_BOOST_FIELD.getPreferredName());\\n  1551\u2192                    }\\n  1552\u2192                } else if (SORT_FIELD.match(currentFieldName, parser.getDeprecationHandler())) {\\n  1553\u2192                    sorts = new ArrayList<>(SortBuilder.fromXContent(parser));\\n  1554\u2192                } else if (RESCORE_FIELD.match(currentFieldName, parser.getDeprecationHandler())) {\\n  1555\u2192                    rescoreBuilders = new ArrayList<>();\\n  1556\u2192                    while ((parser.nextToken()) != XContentParser.Token.END_ARRAY) {\\n  1557\u2192                        rescoreBuilders.add(RescorerBuilder.parseFromXContent(parser, searchUsage::trackRescorerUsage));\\n  1558\u2192                    }\\n  1559\u2192                    searchUsage.trackSectionUsage(RESCORE_FIELD.getPreferredName());\\n  1560\u2192                } else if (STATS_FIELD.match(currentFieldName, parser.getDeprecationHandler())) {\\n  1561\u2192                    stats = new ArrayList<>();\\n  1562\u2192                    while ((token = parser.nextToken()) != XContentParser.Token.END_ARRAY) {\\n  1563\u2192                        if (token == XContentParser.Token.VALUE_STRING) {\\n  1564\u2192                            stats.add(parser.text());\\n  1565\u2192                        } else {\\n  1566\u2192                            throw new ParsingException(\\n  1567\u2192                                parser.getTokenLocation(),\\n  1568\u2192                                \\\"Expected [\\\"\\n  1569\u2192                                    + XContentParser.Token.VALUE_STRING\\n  1570\u2192                                    + \\\"] in [\\\"\\n  1571\u2192                                    + currentFieldName\\n  1572\u2192                                    + \\\"] but found [\\\"\\n  1573\u2192                                    + token\\n  1574\u2192                                    + \\\"]\\\",\\n  1575\u2192                                parser.getTokenLocation()\\n  1576\u2192                            );\\n  1577\u2192                        }\\n  1578\u2192                    }\\n  1579\u2192                    if (stats.size() > 0) {\\n  1580\u2192                        searchUsage.trackSectionUsage(STATS_FIELD.getPreferredName());\\n  1581\u2192                    }\\n  1582\u2192                } else if (_SOURCE_FIELD.match(currentFieldName, parser.getDeprecationHandler())) {\\n  1583\u2192                    fetchSourceContext = FetchSourceContext.fromXContent(parser);\\n  1584\u2192                    if (fetchSourceContext.fetchSource() == false\\n  1585\u2192                        || fetchSourceContext.includes().length > 0\\n  1586\u2192                        || fetchSourceContext.excludes().length > 0) {\\n  1587\u2192                        searchUsage.trackSectionUsage(_SOURCE_FIELD.getPreferredName());\\n  1588\u2192                    }\\n  1589\u2192                } else if (SEARCH_AFTER.match(currentFieldName, parser.getDeprecationHandler())) {\\n  1590\u2192                    searchAfterBuilder = SearchAfterBuilder.fromXContent(parser);\\n  1591\u2192                    searchUsage.trackSectionUsage(SEARCH_AFTER.getPreferredName());\\n  1592\u2192                } else if (KNN_FIELD.match(currentFieldName, parser.getDeprecationHandler())) {\\n  1593\u2192                    while ((token = parser.nextToken()) != XContentParser.Token.END_ARRAY) {\\n  1594\u2192                        if (token == XContentParser.Token.START_OBJECT) {\\n  1595\u2192                            knnBuilders.add(KnnSearchBuilder.fromXContent(parser));\\n  1596\u2192                        } else {\\n  1597\u2192                            throw new XContentParseException(\\n  1598\u2192                                parser.getTokenLocation(),\\n  1599\u2192                                \\\"malformed knn format, within the knn search array only objects are allowed; found \\\" + token\\n  1600\u2192                            );\\n  1601\u2192                        }\\n  1602\u2192                    }\\n  1603\u2192                    searchUsage.trackSectionUsage(KNN_FIELD.getPreferredName());\\n  1604\u2192                } else if (SUB_SEARCHES_FIELD.match(currentFieldName, parser.getDeprecationHandler())) {\\n  1605\u2192                    if (RANK_SUPPORTED == false) {\\n  1606\u2192                        throwUnknownKey(parser, token, currentFieldName);\\n  1607\u2192                    }\\n  1608\u2192                    if (subSearchSourceBuilders.isEmpty() == false) {\\n  1609\u2192                        throw new IllegalArgumentException(\\n  1610\u2192                            \\\"cannot specify field [\\\" + currentFieldName + \\\"] and field [\\\" + QUERY_FIELD.getPreferredName() + \\\"]\\\"\\n  1611\u2192                        );\\n  1612\u2192                    }\\n  1613\u2192                    while ((token = parser.nextToken()) != XContentParser.Token.END_ARRAY) {\\n  1614\u2192                        if (token == XContentParser.Token.START_OBJECT) {\\n  1615\u2192                            subSearchSourceBuilders.add(SubSearchSourceBuilder.fromXContent(parser, searchUsage));\\n  1616\u2192                        } else {\\n  1617\u2192                            throw new XContentParseException(\\n  1618\u2192                                parser.getTokenLocation(),\\n  1619\u2192                                \\\"malformed query within the [sub_searches] field; found \\\" + token\\n  1620\u2192                            );\\n  1621\u2192                        }\\n  1622\u2192                    }\\n  1623\u2192                    searchUsage.trackSectionUsage(SUB_SEARCHES_FIELD.getPreferredName());\\n  1624\u2192                } else {\\n  1625\u2192                    throwUnknownKey(parser, token, currentFieldName);\\n  1626\u2192                }\\n  1627\u2192            } else {\\n  1628\u2192                throwUnknownKey(parser, token, currentFieldName);\\n  1629\u2192            }\\n  1630\u2192        }\\n  1631\u2192        if (checkTrailingTokens) {\\n  1632\u2192            token = parser.nextToken();\\n  1633\u2192            if (token != null) {\\n  1634\u2192                throw new ParsingException(parser.getTokenLocation(), \\\"Unexpected token [\\\" + token + \\\"] found after the main object.\\\");\\n  1635\u2192            }\\n  1636\u2192        }\\n  1637\u2192\\n  1638\u2192        knnSearch = knnBuilders.stream().map(knnBuilder -> knnBuilder.build(size())).collect(Collectors.toList());\\n  1639\u2192        searchUsageConsumer.accept(searchUsage);\\n  1640\u2192        return this;\\n  1641\u2192    }\\n  1642\u2192\\n  1643\u2192    private static void throwUnknownKey(XContentParser parser, XContentParser.Token token, String currentFieldName)\\n  1644\u2192        throws ParsingException {\\n  1645\u2192        throw new ParsingException(\\n  1646\u2192            parser.getTokenLocation(),\\n  1647\u2192            \\\"Unknown key for a \\\" + token + \\\" in [\\\" + currentFieldName + \\\"].\\\",\\n  1648\u2192            parser.getTokenLocation()\\n  1649\u2192        );\\n  1650\u2192    }\\n  1651\u2192\\n  1652\u2192    public XContentBuilder innerToXContent(XContentBuilder builder, Params params) throws IOException {\\n  1653\u2192        if (from != -1) {\\n  1654\u2192            builder.field(FROM_FIELD.getPreferredName(), from);\\n  1655\u2192        }\\n  1656\u2192        if (size != -1) {\\n  1657\u2192            builder.field(SIZE_FIELD.getPreferredName(), size);\\n  1658\u2192        }\\n  1659\u2192\\n  1660\u2192        if (timeout != null && timeout.equals(TimeValue.MINUS_ONE) == false) {\\n  1661\u2192            builder.field(TIMEOUT_FIELD.getPreferredName(), timeout.getStringRep());\\n  1662\u2192        }\\n  1663\u2192\\n  1664\u2192        if (terminateAfter != SearchContext.DEFAULT_TERMINATE_AFTER) {\\n  1665\u2192            builder.field(TERMINATE_AFTER_FIELD.getPreferredName(), terminateAfter);\\n  1666\u2192        }\\n  1667\u2192\\n  1668\u2192        if (retrieverBuilder != null) {\\n  1669\u2192            builder.field(RETRIEVER.getPreferredName(), retrieverBuilder);\\n  1670\u2192        }\\n  1671\u2192\\n  1672\u2192        if (subSearchSourceBuilders.isEmpty() == false) {\\n  1673\u2192            if (subSearchSourceBuilders.size() == 1) {\\n  1674\u2192                builder.field(QUERY_FIELD.getPreferredName(), subSearchSourceBuilders.get(0).getQueryBuilder());\\n  1675\u2192            } else {\\n  1676\u2192                builder.xContentList(SUB_SEARCHES_FIELD.getPreferredName(), subSearchSourceBuilders);\\n  1677\u2192            }\\n  1678\u2192        }\\n  1679\u2192\\n  1680\u2192        if (postQueryBuilder != null) {\\n  1681\u2192            builder.field(POST_FILTER_FIELD.getPreferredName(), postQueryBuilder);\\n  1682\u2192        }\\n  1683\u2192\\n  1684\u2192        if (knnSearch.isEmpty() == false) {\\n  1685\u2192            builder.startArray(KNN_FIELD.getPreferredName());\\n  1686\u2192            for (KnnSearchBuilder knnSearchBuilder : knnSearch) {\\n  1687\u2192                builder.startObject();\\n  1688\u2192                knnSearchBuilder.toXContent(builder, params);\\n  1689\u2192                builder.endObject();\\n  1690\u2192            }\\n  1691\u2192            builder.endArray();\\n  1692\u2192        }\\n  1693\u2192\\n  1694\u2192        if (rankBuilder != null) {\\n  1695\u2192            builder.field(RANK_FIELD.getPreferredName(), rankBuilder);\\n  1696\u2192        }\\n  1697\u2192\\n  1698\u2192        if (minScore != null) {\\n  1699\u2192            builder.field(MIN_SCORE_FIELD.getPreferredName(), minScore);\\n  1700\u2192        }\\n  1701\u2192\\n  1702\u2192        if (version != null) {\\n  1703\u2192            builder.field(VERSION_FIELD.getPreferredName(), version);\\n  1704\u2192        }\\n  1705\u2192\\n  1706\u2192        if (seqNoAndPrimaryTerm != null) {\\n  1707\u2192            builder.field(SEQ_NO_PRIMARY_TERM_FIELD.getPreferredName(), seqNoAndPrimaryTerm);\\n  1708\u2192        }\\n  1709\u2192\\n  1710\u2192        if (explain != null) {\\n  1711\u2192            builder.field(EXPLAIN_FIELD.getPreferredName(), explain);\\n  1712\u2192        }\\n  1713\u2192\\n  1714\u2192        if (profile) {\\n  1715\u2192            builder.field(\\\"profile\\\", true);\\n  1716\u2192        }\\n  1717\u2192\\n  1718\u2192        if (fetchSourceContext != null) {\\n  1719\u2192            builder.field(_SOURCE_FIELD.getPreferredName(), fetchSourceContext);\\n  1720\u2192        }\\n  1721\u2192\\n  1722\u2192        if (storedFieldsContext != null) {\\n  1723\u2192            storedFieldsContext.toXContent(STORED_FIELDS_FIELD.getPreferredName(), builder);\\n  1724\u2192        }\\n  1725\u2192\\n  1726\u2192        if (docValueFields != null) {\\n  1727\u2192            builder.startArray(DOCVALUE_FIELDS_FIELD.getPreferredName());\\n  1728\u2192            for (FieldAndFormat docValueField : docValueFields) {\\n  1729\u2192                docValueField.toXContent(builder, params);\\n  1730\u2192            }\\n  1731\u2192            builder.endArray();\\n  1732\u2192        }\\n  1733\u2192\\n  1734\u2192        if (fetchFields != null) {\\n  1735\u2192            builder.startArray(FETCH_FIELDS_FIELD.getPreferredName());\\n  1736\u2192            for (FieldAndFormat docValueField : fetchFields) {\\n  1737\u2192                docValueField.toXContent(builder, params);\\n  1738\u2192            }\\n  1739\u2192            builder.endArray();\\n  1740\u2192        }\\n  1741\u2192\\n  1742\u2192        if (scriptFields != null) {\\n  1743\u2192            builder.startObject(SCRIPT_FIELDS_FIELD.getPreferredName());\\n  1744\u2192            for (ScriptField scriptField : scriptFields) {\\n  1745\u2192                scriptField.toXContent(builder, params);\\n  1746\u2192            }\\n  1747\u2192            builder.endObject();\\n  1748\u2192        }\\n  1749\u2192\\n  1750\u2192        if (sorts != null) {\\n  1751\u2192            builder.startArray(SORT_FIELD.getPreferredName());\\n  1752\u2192            for (SortBuilder<?> sort : sorts) {\\n  1753\u2192                sort.toXContent(builder, params);\\n  1754\u2192            }\\n  1755\u2192            builder.endArray();\\n  1756\u2192        }\\n  1757\u2192\\n  1758\u2192        if (trackScores) {\\n  1759\u2192            builder.field(TRACK_SCORES_FIELD.getPreferredName(), true);\\n  1760\u2192        }\\n  1761\u2192\\n  1762\u2192        if (trackTotalHitsUpTo != null) {\\n  1763\u2192            builder.field(TRACK_TOTAL_HITS_FIELD.getPreferredName(), trackTotalHitsUpTo);\\n  1764\u2192        }\\n  1765\u2192\\n  1766\u2192        if (searchAfterBuilder != null) {\\n  1767\u2192            builder.array(SEARCH_AFTER.getPreferredName(), searchAfterBuilder.getSortValues());\\n  1768\u2192        }\\n  1769\u2192\\n  1770\u2192        if (sliceBuilder != null) {\\n  1771\u2192            builder.field(SLICE.getPreferredName(), sliceBuilder);\\n  1772\u2192        }\\n  1773\u2192\\n  1774\u2192        if (indexBoosts.isEmpty() == false) {\\n  1775\u2192            builder.startArray(INDICES_BOOST_FIELD.getPreferredName());\\n  1776\u2192            for (IndexBoost ib : indexBoosts) {\\n  1777\u2192                builder.startObject();\\n  1778\u2192                builder.field(ib.index, ib.boost);\\n  1779\u2192                builder.endObject();\\n  1780\u2192            }\\n  1781\u2192            builder.endArray();\\n  1782\u2192        }\\n  1783\u2192\\n  1784\u2192        if (aggregations != null) {\\n  1785\u2192            builder.field(AGGREGATIONS_FIELD.getPreferredName(), aggregations);\\n  1786\u2192        }\\n  1787\u2192\\n  1788\u2192        if (highlightBuilder != null) {\\n  1789\u2192            builder.field(HIGHLIGHT_FIELD.getPreferredName(), highlightBuilder);\\n  1790\u2192        }\\n  1791\u2192\\n  1792\u2192        if (suggestBuilder != null) {\\n  1793\u2192            builder.field(SUGGEST_FIELD.getPreferredName(), suggestBuilder);\\n  1794\u2192        }\\n  1795\u2192\\n  1796\u2192        if (rescoreBuilders != null) {\\n  1797\u2192            builder.startArray(RESCORE_FIELD.getPreferredName());\\n  1798\u2192            for (RescorerBuilder<?> rescoreBuilder : rescoreBuilders) {\\n  1799\u2192                rescoreBuilder.toXContent(builder, params);\\n  1800\u2192            }\\n  1801\u2192            builder.endArray();\\n  1802\u2192        }\\n  1803\u2192\\n  1804\u2192        if (stats != null) {\\n  1805\u2192            builder.stringListField(STATS_FIELD.getPreferredName(), stats);\\n  1806\u2192        }\\n  1807\u2192\\n  1808\u2192        if (extBuilders != null && extBuilders.isEmpty() == false) {\\n  1809\u2192            builder.startObject(EXT_FIELD.getPreferredName());\\n  1810\u2192            for (SearchExtBuilder extBuilder : extBuilders) {\\n  1811\u2192                extBuilder.toXContent(builder, params);\\n  1812\u2192            }\\n  1813\u2192            builder.endObject();\\n  1814\u2192        }\\n  1815\u2192\\n  1816\u2192        if (collapse != null) {\\n  1817\u2192            builder.field(COLLAPSE.getPreferredName(), collapse);\\n  1818\u2192        }\\n  1819\u2192        if (pointInTimeBuilder != null) {\\n  1820\u2192            builder.startObject(POINT_IN_TIME.getPreferredName());\\n  1821\u2192            pointInTimeBuilder.toXContent(builder, params);\\n  1822\u2192            builder.endObject();\\n  1823\u2192        }\\n  1824\u2192        if (false == runtimeMappings.isEmpty()) {\\n  1825\u2192            builder.field(RUNTIME_MAPPINGS_FIELD.getPreferredName(), runtimeMappings);\\n  1826\u2192        }\\n  1827\u2192\\n  1828\u2192        return builder;\\n  1829\u2192    }\\n  1830\u2192\\n  1831\u2192    @Override\\n  1832\u2192    public XContentBuilder toXContent(XContentBuilder builder, Params params) throws IOException {\\n  1833\u2192        builder.startObject();\\n  1834\u2192        innerToXContent(builder, params);\\n  1835\u2192        builder.endObject();\\n  1836\u2192        return builder;\\n  1837\u2192    }\\n  1838\u2192\\n  1839\u2192    public static class IndexBoost implements Writeable, ToXContentObject {\\n  1840\u2192        private final String index;\\n  1841\u2192        private final float boost;\\n  1842\u2192\\n  1843\u2192        IndexBoost(String index, float boost) {\\n  1844\u2192            this.index = index;\\n  1845\u2192            this.boost = boost;\\n  1846\u2192        }\\n  1847\u2192\\n  1848\u2192        IndexBoost(StreamInput in) throws IOException {\\n  1849\u2192            index = in.readString();\\n  1850\u2192            boost = in.readFloat();\\n  1851\u2192        }\\n  1852\u2192\\n  1853\u2192        IndexBoost(XContentParser parser) throws IOException {\\n  1854\u2192            XContentParser.Token token = parser.currentToken();\\n  1855\u2192\\n  1856\u2192            if (token == XContentParser.Token.START_OBJECT) {\\n  1857\u2192                token = parser.nextToken();\\n  1858\u2192                if (token == XContentParser.Token.FIELD_NAME) {\\n  1859\u2192                    index = parser.currentName();\\n  1860\u2192                } else {\\n  1861\u2192                    throw new ParsingException(\\n  1862\u2192                        parser.getTokenLocation(),\\n  1863\u2192                        \\\"Expected [\\\" + XContentParser.Token.FIELD_NAME + \\\"] in [\\\" + INDICES_BOOST_FIELD + \\\"] but found [\\\" + token + \\\"]\\\",\\n  1864\u2192                        parser.getTokenLocation()\\n  1865\u2192                    );\\n  1866\u2192                }\\n  1867\u2192                token = parser.nextToken();\\n  1868\u2192                if (token == XContentParser.Token.VALUE_NUMBER) {\\n  1869\u2192                    boost = parser.floatValue();\\n  1870\u2192                } else {\\n  1871\u2192                    throw new ParsingException(\\n  1872\u2192                        parser.getTokenLocation(),\\n  1873\u2192                        \\\"Expected [\\\" + XContentParser.Token.VALUE_NUMBER + \\\"] in [\\\" + INDICES_BOOST_FIELD + \\\"] but found [\\\" + token + \\\"]\\\",\\n  1874\u2192                        parser.getTokenLocation()\\n  1875\u2192                    );\\n  1876\u2192                }\\n  1877\u2192                token = parser.nextToken();\\n  1878\u2192                if (token != XContentParser.Token.END_OBJECT) {\\n  1879\u2192                    throw new ParsingException(\\n  1880\u2192                        parser.getTokenLocation(),\\n  1881\u2192                        \\\"Expected [\\\" + XContentParser.Token.END_OBJECT + \\\"] in [\\\" + INDICES_BOOST_FIELD + \\\"] but found [\\\" + token + \\\"]\\\",\\n  1882\u2192                        parser.getTokenLocation()\\n  1883\u2192                    );\\n  1884\u2192                }\\n  1885\u2192            } else {\\n  1886\u2192                throw new ParsingException(\\n  1887\u2192                    parser.getTokenLocation(),\\n  1888\u2192                    \\\"Expected [\\\" + XContentParser.Token.START_OBJECT + \\\"] in [\\\" + parser.currentName() + \\\"] but found [\\\" + token + \\\"]\\\",\\n  1889\u2192                    parser.getTokenLocation()\\n  1890\u2192                );\\n  1891\u2192            }\\n  1892\u2192        }\\n  1893\u2192\\n  1894\u2192        public String getIndex() {\\n  1895\u2192            return index;\\n  1896\u2192        }\\n  1897\u2192\\n  1898\u2192        public float getBoost() {\\n  1899\u2192            return boost;\\n  1900\u2192        }\\n  1901\u2192\\n  1902\u2192        @Override\\n  1903\u2192        public void writeTo(StreamOutput out) throws IOException {\\n  1904\u2192            out.writeString(index);\\n  1905\u2192            out.writeFloat(boost);\\n  1906\u2192        }\\n  1907\u2192\\n  1908\u2192        @Override\\n  1909\u2192        public XContentBuilder toXContent(XContentBuilder builder, Params params) throws IOException {\\n  1910\u2192            builder.startObject();\\n  1911\u2192            builder.field(index, boost);\\n  1912\u2192            builder.endObject();\\n  1913\u2192            return builder;\\n  1914\u2192        }\\n  1915\u2192\\n  1916\u2192        @Override\\n  1917\u2192        public int hashCode() {\\n  1918\u2192            return Objects.hash(index, boost);\\n  1919\u2192        }\\n  1920\u2192\\n  1921\u2192        @Override\\n  1922\u2192        public boolean equals(Object obj) {\\n  1923\u2192            if (obj == null) {\\n  1924\u2192                return false;\\n  1925\u2192            }\\n  1926\u2192            if (getClass() != obj.getClass()) {\\n  1927\u2192                return false;\\n  1928\u2192            }\\n  1929\u2192            IndexBoost other = (IndexBoost) obj;\\n  1930\u2192            return Objects.equals(index, other.index) && Objects.equals(boost, other.boost);\\n  1931\u2192        }\\n  1932\u2192\\n  1933\u2192    }\\n  1934\u2192\\n  1935\u2192    public static class ScriptField implements Writeable, ToXContentFragment {\\n  1936\u2192\\n  1937\u2192        private final boolean ignoreFailure;\\n  1938\u2192        private final String fieldName;\\n  1939\u2192        private final Script script;\\n  1940\u2192\\n  1941\u2192        public ScriptField(String fieldName, Script script, boolean ignoreFailure) {\\n  1942\u2192            this.fieldName = fieldName;\\n  1943\u2192            this.script = script;\\n  1944\u2192            this.ignoreFailure = ignoreFailure;\\n  1945\u2192        }\\n  1946\u2192\\n  1947\u2192        /**\\n  1948\u2192         * Read from a stream.\\n  1949\u2192         */\\n  1950\u2192        public ScriptField(StreamInput in) throws IOException {\\n  1951\u2192            fieldName = in.readString();\\n  1952\u2192            script = new Script(in);\\n  1953\u2192            ignoreFailure = in.readBoolean();\\n  1954\u2192        }\\n  1955\u2192\\n  1956\u2192        @Override\\n  1957\u2192        public void writeTo(StreamOutput out) throws IOException {\\n  1958\u2192            out.writeString(fieldName);\\n  1959\u2192            script.writeTo(out);\\n  1960\u2192            out.writeBoolean(ignoreFailure);\\n  1961\u2192        }\\n  1962\u2192\\n  1963\u2192        public ScriptField(XContentParser parser) throws IOException {\\n  1964\u2192            boolean ignoreFailure = false;\\n  1965\u2192            String scriptFieldName = parser.currentName();\\n  1966\u2192            Script script = null;\\n  1967\u2192\\n  1968\u2192            XContentParser.Token token;\\n  1969\u2192            token = parser.nextToken();\\n  1970\u2192            if (token == XContentParser.Token.START_OBJECT) {\\n  1971\u2192                String currentFieldName = null;\\n  1972\u2192                while ((token = parser.nextToken()) != XContentParser.Token.END_OBJECT) {\\n  1973\u2192                    if (token == XContentParser.Token.FIELD_NAME) {\\n  1974\u2192                        currentFieldName = parser.currentName();\\n  1975\u2192                    } else if (token.isValue()) {\\n  1976\u2192                        if (SCRIPT_FIELD.match(currentFieldName, parser.getDeprecationHandler())) {\\n  1977\u2192                            script = Script.parse(parser);\\n  1978\u2192                        } else if (IGNORE_FAILURE_FIELD.match(currentFieldName, parser.getDeprecationHandler())) {\\n  1979\u2192                            ignoreFailure = parser.booleanValue();\\n  1980\u2192                        } else {\\n  1981\u2192                            throw new ParsingException(\\n  1982\u2192                                parser.getTokenLocation(),\\n  1983\u2192                                \\\"Unknown key for a \\\" + token + \\\" in [\\\" + currentFieldName + \\\"].\\\",\\n  1984\u2192                                parser.getTokenLocation()\\n  1985\u2192                            );\\n  1986\u2192                        }\\n  1987\u2192                    } else if (token == XContentParser.Token.START_OBJECT) {\\n  1988\u2192                        if (SCRIPT_FIELD.match(currentFieldName, parser.getDeprecationHandler())) {\\n  1989\u2192                            script = Script.parse(parser);\\n  1990\u2192                        } else {\\n  1991\u2192                            throw new ParsingException(\\n  1992\u2192                                parser.getTokenLocation(),\\n  1993\u2192                                \\\"Unknown key for a \\\" + token + \\\" in [\\\" + currentFieldName + \\\"].\\\",\\n  1994\u2192                                parser.getTokenLocation()\\n  1995\u2192                            );\\n  1996\u2192                        }\\n  1997\u2192                    } else {\\n  1998\u2192                        throw new ParsingException(\\n  1999\u2192                            parser.getTokenLocation(),\\n  2000\u2192                            \\\"Unknown key for a \\\" + token + \\\" in [\\\" + currentFieldName + \\\"].\\\",\\n  2001\u2192                            parser.getTokenLocation()\\n  2002\u2192                        );\\n  2003\u2192                    }\\n  2004\u2192                }\\n  2005\u2192                this.ignoreFailure = ignoreFailure;\\n  2006\u2192                this.fieldName = scriptFieldName;\\n  2007\u2192                this.script = script;\\n  2008\u2192            } else {\\n  2009\u2192                throw new ParsingException(\\n  2010\u2192                    parser.getTokenLocation(),\\n  2011\u2192                    \\\"Expected [\\\" + XContentParser.Token.START_OBJECT + \\\"] in [\\\" + parser.currentName() + \\\"] but found [\\\" + token + \\\"]\\\",\\n  2012\u2192                    parser.getTokenLocation()\\n  2013\u2192                );\\n  2014\u2192            }\\n  2015\u2192        }\\n  2016\u2192\\n  2017\u2192        public String fieldName() {\\n  2018\u2192            return fieldName;\\n  2019\u2192        }\\n  2020\u2192\\n  2021\u2192        public Script script() {\\n  2022\u2192            return script;\\n  2023\u2192        }\\n  2024\u2192\\n  2025\u2192        public boolean ignoreFailure() {\\n  2026\u2192            return ignoreFailure;\\n  2027\u2192        }\\n  2028\u2192\\n  2029\u2192        @Override\\n  2030\u2192        public XContentBuilder toXContent(XContentBuilder builder, Params params) throws IOException {\\n  2031\u2192            builder.startObject(fieldName);\\n  2032\u2192            builder.field(SCRIPT_FIELD.getPreferredName(), script);\\n  2033\u2192            builder.field(IGNORE_FAILURE_FIELD.getPreferredName(), ignoreFailure);\\n  2034\u2192            builder.endObject();\\n  2035\u2192            return builder;\\n  2036\u2192        }\\n  2037\u2192\\n  2038\u2192        @Override\\n  2039\u2192        public int hashCode() {\\n  2040\u2192            return Objects.hash(fieldName, script, ignoreFailure);\\n  2041\u2192        }\\n  2042\u2192\\n  2043\u2192        @Override\\n  2044\u2192        public boolean equals(Object obj) {\\n  2045\u2192            if (obj == null) {\\n  2046\u2192                return false;\\n  2047\u2192            }\\n  2048\u2192            if (getClass() != obj.getClass()) {\\n  2049\u2192                return false;\\n  2050\u2192            }\\n  2051\u2192            ScriptField other = (ScriptField) obj;\\n  2052\u2192            return Objects.equals(fieldName, other.fieldName)\\n  2053\u2192                && Objects.equals(script, other.script)\\n  2054\u2192                && Objects.equals(ignoreFailure, other.ignoreFailure);\\n  2055\u2192        }\\n  2056\u2192    }\\n  2057\u2192\\n  2058\u2192    @Override\\n  2059\u2192    public int hashCode() {\\n  2060\u2192        return Objects.hash(\\n  2061\u2192            aggregations,\\n  2062\u2192            explain,\\n  2063\u2192            fetchSourceContext,\\n  2064\u2192            fetchFields,\\n  2065\u2192            docValueFields,\\n  2066\u2192            storedFieldsContext,\\n  2067\u2192            from,\\n  2068\u2192            highlightBuilder,\\n  2069\u2192            indexBoosts,\\n  2070\u2192            minScore,\\n  2071\u2192            subSearchSourceBuilders,\\n  2072\u2192            postQueryBuilder,\\n  2073\u2192            knnSearch,\\n  2074\u2192            rankBuilder,\\n  2075\u2192            rescoreBuilders,\\n  2076\u2192            scriptFields,\\n  2077\u2192            size,\\n  2078\u2192            sorts,\\n  2079\u2192            searchAfterBuilder,\\n  2080\u2192            sliceBuilder,\\n  2081\u2192            stats,\\n  2082\u2192            suggestBuilder,\\n  2083\u2192            terminateAfter,\\n  2084\u2192            timeout,\\n  2085\u2192            trackScores,\\n  2086\u2192            version,\\n  2087\u2192            seqNoAndPrimaryTerm,\\n  2088\u2192            profile,\\n  2089\u2192            extBuilders,\\n  2090\u2192            collapse,\\n  2091\u2192            trackTotalHitsUpTo,\\n  2092\u2192            pointInTimeBuilder,\\n  2093\u2192            runtimeMappings\\n  2094\u2192        );\\n  2095\u2192    }\\n  2096\u2192\\n  2097\u2192    @Override\\n  2098\u2192    public boolean equals(Object obj) {\\n  2099\u2192        if (obj == null) {\\n  2100\u2192            return false;\\n  2101\u2192        }\\n  2102\u2192        if (obj.getClass() != getClass()) {\\n  2103\u2192            return false;\\n  2104\u2192        }\\n  2105\u2192        SearchSourceBuilder other = (SearchSourceBuilder) obj;\\n  2106\u2192        return Objects.equals(aggregations, other.aggregations)\\n  2107\u2192            && Objects.equals(explain, other.explain)\\n  2108\u2192            && Objects.equals(fetchSourceContext, other.fetchSourceContext)\\n  2109\u2192            && Objects.equals(fetchFields, other.fetchFields)\\n  2110\u2192            && Objects.equals(docValueFields, other.docValueFields)\\n  2111\u2192            && Objects.equals(storedFieldsContext, other.storedFieldsContext)\\n  2112\u2192            && Objects.equals(from, other.from)\\n  2113\u2192            && Objects.equals(highlightBuilder, other.highlightBuilder)\\n  2114\u2192            && Objects.equals(indexBoosts, other.indexBoosts)\\n  2115\u2192            && Objects.equals(minScore, other.minScore)\\n  2116\u2192            && Objects.equals(subSearchSourceBuilders, other.subSearchSourceBuilders)\\n  2117\u2192            && Objects.equals(postQueryBuilder, other.postQueryBuilder)\\n  2118\u2192            && Objects.equals(knnSearch, other.knnSearch)\\n  2119\u2192            && Objects.equals(rankBuilder, other.rankBuilder)\\n  2120\u2192            && Objects.equals(rescoreBuilders, other.rescoreBuilders)\\n  2121\u2192            && Objects.equals(scriptFields, other.scriptFields)\\n  2122\u2192            && Objects.equals(size, other.size)\\n  2123\u2192            && Objects.equals(sorts, other.sorts)\\n  2124\u2192            && Objects.equals(searchAfterBuilder, other.searchAfterBuilder)\\n  2125\u2192            && Objects.equals(sliceBuilder, other.sliceBuilder)\\n  2126\u2192            && Objects.equals(stats, other.stats)\\n  2127\u2192            && Objects.equals(suggestBuilder, other.suggestBuilder)\\n  2128\u2192            && Objects.equals(terminateAfter, other.terminateAfter)\\n  2129\u2192            && Objects.equals(timeout, other.timeout)\\n  2130\u2192            && Objects.equals(trackScores, other.trackScores)\\n  2131\u2192            && Objects.equals(version, other.version)\\n  2132\u2192            && Objects.equals(seqNoAndPrimaryTerm, other.seqNoAndPrimaryTerm)\\n  2133\u2192            && Objects.equals(profile, other.profile)\\n  2134\u2192            && Objects.equals(extBuilders, other.extBuilders)\\n  2135\u2192            && Objects.equals(collapse, other.collapse)\\n  2136\u2192            && Objects.equals(trackTotalHitsUpTo, other.trackTotalHitsUpTo)\\n  2137\u2192            && Objects.equals(pointInTimeBuilder, other.pointInTimeBuilder)\\n  2138\u2192            && Objects.equals(runtimeMappings, other.runtimeMappings);\\n  2139\u2192    }\\n  2140\u2192\\n  2141\u2192    @Override\\n  2142\u2192    public String toString() {\\n  2143\u2192        return toString(EMPTY_PARAMS);\\n  2144\u2192    }\\n  2145\u2192\\n  2146\u2192    public String toString(Params params) {\\n  2147\u2192        try {\\n  2148\u2192            return XContentHelper.toXContent(this, XContentType.JSON, params, true).utf8ToString();\\n  2149\u2192        } catch (IOException e) {\\n  2150\u2192            throw new ElasticsearchException(e);\\n  2151\u2192        }\\n  2152\u2192    }\\n  2153\u2192\\n  2154\u2192    public boolean supportsParallelCollection(ToLongFunction<String> fieldCardinality) {\\n  2155\u2192        if (profile) return false;\\n  2156\u2192\\n  2157\u2192        if (sorts != null) {\\n  2158\u2192            // the implicit sorting is by _score, which supports parallel collection\\n  2159\u2192            for (SortBuilder<?> sortBuilder : sorts) {\\n  2160\u2192                if (sortBuilder.supportsParallelCollection() == false) return false;\\n  2161\u2192            }\\n  2162\u2192        }\\n  2163\u2192\\n  2164\u2192        return collapse == null && (aggregations == null || aggregations.supportsParallelCollection(fieldCardinality));\\n  2165\u2192    }\\n  2166\u2192\\n  2167\u2192    private void validate() throws ValidationException {\\n  2168\u2192        var exceptions = validate(null, false, false);\\n  2169\u2192        if (exceptions != null) {\\n  2170\u2192            throw exceptions;\\n  2171\u2192        }\\n  2172\u2192    }\\n  2173\u2192\\n  2174\u2192    public ActionRequestValidationException validate(\\n  2175\u2192        ActionRequestValidationException validationException,\\n  2176\u2192        boolean isScroll,\\n  2177\u2192        boolean allowPartialSearchResults\\n  2178\u2192    ) {\\n  2179\u2192        if (retriever() != null) {\\n  2180\u2192            validationException = retriever().validate(this, validationException, allowPartialSearchResults);\\n  2181\u2192            List<String> specified = new ArrayList<>();\\n  2182\u2192            if (subSearches().isEmpty() == false) {\\n  2183\u2192                specified.add(QUERY_FIELD.getPreferredName());\\n  2184\u2192            }\\n  2185\u2192            if (knnSearch().isEmpty() == false) {\\n  2186\u2192                specified.add(KNN_FIELD.getPreferredName());\\n  2187\u2192            }\\n  2188\u2192            if (searchAfter() != null) {\\n  2189\u2192                specified.add(SEARCH_AFTER.getPreferredName());\\n  2190\u2192            }\\n  2191\u2192            if (terminateAfter() != DEFAULT_TERMINATE_AFTER) {\\n  2192\u2192                specified.add(TERMINATE_AFTER_FIELD.getPreferredName());\\n  2193\u2192            }\\n  2194\u2192            if (sorts() != null) {\\n  2195\u2192                specified.add(SORT_FIELD.getPreferredName());\\n  2196\u2192            }\\n  2197\u2192            if (rankBuilder() != null) {\\n  2198\u2192                specified.add(RANK_FIELD.getPreferredName());\\n  2199\u2192            }\\n  2200\u2192            if (rescores() != null) {\\n  2201\u2192                specified.add(RESCORE_FIELD.getPreferredName());\\n  2202\u2192            }\\n  2203\u2192            if (specified.isEmpty() == false) {\\n  2204\u2192                validationException = addValidationError(\\n  2205\u2192                    \\\"cannot specify [\\\" + RETRIEVER.getPreferredName() + \\\"] and \\\" + specified,\\n  2206\u2192                    validationException\\n  2207\u2192                );\\n  2208\u2192            }\\n  2209\u2192        }\\n  2210\u2192        if (isScroll) {\\n  2211\u2192            if (trackTotalHitsUpTo() != null && trackTotalHitsUpTo() != SearchContext.TRACK_TOTAL_HITS_ACCURATE) {\\n  2212\u2192                validationException = addValidationError(\\n  2213\u2192                    \\\"disabling [track_total_hits] is not allowed in a scroll context\\\",\\n  2214\u2192                    validationException\\n  2215\u2192                );\\n  2216\u2192            }\\n  2217\u2192            if (from() > 0) {\\n  2218\u2192                validationException = addValidationError(\\\"using [from] is not allowed in a scroll context\\\", validationException);\\n  2219\u2192            }\\n  2220\u2192            if (size() == 0) {\\n  2221\u2192                validationException = addValidationError(\\\"[size] cannot be [0] in a scroll context\\\", validationException);\\n  2222\u2192            }\\n  2223\u2192            if (rescores() != null && rescores().isEmpty() == false) {\\n  2224\u2192                validationException = addValidationError(\\\"using [rescore] is not allowed in a scroll context\\\", validationException);\\n  2225\u2192            }\\n  2226\u2192            if (CollectionUtils.isEmpty(searchAfter()) == false) {\\n  2227\u2192                validationException = addValidationError(\\\"[search_after] cannot be used in a scroll context\\\", validationException);\\n  2228\u2192            }\\n  2229\u2192            if (collapse() != null) {\\n  2230\u2192                validationException = addValidationError(\\\"cannot use `collapse` in a scroll context\\\", validationException);\\n  2231\u2192            }\\n  2232\u2192        }\\n  2233\u2192        if (slice() != null) {\\n  2234\u2192            if (pointInTimeBuilder() == null && (isScroll == false)) {\\n  2235\u2192                validationException = addValidationError(\\n  2236\u2192                    \\\"[slice] can only be used with [scroll] or [point-in-time] requests\\\",\\n  2237\u2192                    validationException\\n  2238\u2192                );\\n  2239\u2192            }\\n  2240\u2192        }\\n  2241\u2192        if (from() > 0 && CollectionUtils.isEmpty(searchAfter()) == false) {\\n  2242\u2192            validationException = addValidationError(\\\"[from] parameter must be set to 0 when [search_after] is used\\\", validationException);\\n  2243\u2192        }\\n  2244\u2192        if (storedFields() != null) {\\n  2245\u2192            if (storedFields().fetchFields() == false) {\\n  2246\u2192                if (fetchSource() != null && fetchSource().fetchSource()) {\\n  2247\u2192                    validationException = addValidationError(\\n  2248\u2192                        \\\"[stored_fields] cannot be disabled if [_source] is requested\\\",\\n  2249\u2192                        validationException\\n  2250\u2192                    );\\n  2251\u2192                }\\n  2252\u2192                if (fetchFields() != null) {\\n  2253\u2192                    validationException = addValidationError(\\n  2254\u2192                        \\\"[stored_fields] cannot be disabled when using the [fields] option\\\",\\n  2255\u2192                        validationException\\n  2256\u2192                    );\\n  2257\u2192                }\\n  2258\u2192            }\\n  2259\u2192        }\\n  2260\u2192        if (subSearches().size() >= 2 && rankBuilder() == null) {\\n  2261\u2192            validationException = addValidationError(\\\"[sub_searches] requires [rank]\\\", validationException);\\n  2262\u2192        }\\n  2263\u2192        if (aggregations() != null) {\\n  2264\u2192            validationException = aggregations().validate(validationException);\\n  2265\u2192        }\\n  2266\u2192\\n  2267\u2192        if (rankBuilder() != null) {\\n  2268\u2192            int s = size() == -1 ? SearchService.DEFAULT_SIZE : size();\\n  2269\u2192            if (s == 0) {\\n  2270\u2192                validationException = addValidationError(\\\"[rank] requires [size] greater than [0]\\\", validationException);\\n  2271\u2192            }\\n  2272\u2192            if (s > rankBuilder().rankWindowSize()) {\\n  2273\u2192                validationException = addValidationError(\\n  2274\u2192                    \\\"[rank] requires [rank_window_size: \\\"\\n  2275\u2192                        + rankBuilder().rankWindowSize()\\n  2276\u2192                        + \\\"]\\\"\\n  2277\u2192                        + \\\" be greater than or equal to [size: \\\"\\n  2278\u2192                        + s\\n  2279\u2192                        + \\\"]\\\",\\n  2280\u2192                    validationException\\n  2281\u2192                );\\n  2282\u2192            }\\n  2283\u2192            int queryCount = subSearches().size() + knnSearch().size();\\n  2284\u2192            if (rankBuilder().isCompoundBuilder() && queryCount < 2) {\\n  2285\u2192                validationException = addValidationError(\\n  2286\u2192                    \\\"[rank] requires a minimum of [2] result sets using a combination of sub searches and/or knn searches\\\",\\n  2287\u2192                    validationException\\n  2288\u2192                );\\n  2289\u2192            }\\n  2290\u2192            if (isScroll) {\\n  2291\u2192                validationException = addValidationError(\\\"[rank] cannot be used in a scroll context\\\", validationException);\\n  2292\u2192            }\\n  2293\u2192            if (rescores() != null && rescores().isEmpty() == false) {\\n  2294\u2192                validationException = addValidationError(\\\"[rank] cannot be used with [rescore]\\\", validationException);\\n  2295\u2192            }\\n  2296\u2192\\n  2297\u2192            if (suggest() != null && suggest().getSuggestions().isEmpty() == false) {\\n  2298\u2192                validationException = addValidationError(\\\"[rank] cannot be used with [suggest]\\\", validationException);\\n  2299\u2192            }\\n  2300\u2192        }\\n  2301\u2192\\n  2302\u2192        if (rescores() != null) {\\n  2303\u2192            for (@SuppressWarnings(\\\"rawtypes\\\")\\n  2304\u2192            var rescorer : rescores()) {\\n  2305\u2192                validationException = rescorer.validate(this, validationException);\\n  2306\u2192            }\\n  2307\u2192        }\\n  2308\u2192\\n  2309\u2192        if (pointInTimeBuilder() == null && sorts() != null) {\\n  2310\u2192            for (var sortBuilder : sorts()) {\\n  2311\u2192                if (sortBuilder instanceof FieldSortBuilder fieldSortBuilder\\n  2312\u2192                    && ShardDocSortField.NAME.equals(fieldSortBuilder.getFieldName())) {\\n  2313\u2192                    validationException = addValidationError(\\n  2314\u2192                        \\\"[\\\" + FieldSortBuilder.SHARD_DOC_FIELD_NAME + \\\"] sort field cannot be used without [point in time]\\\",\\n  2315\u2192                        validationException\\n  2316\u2192                    );\\n  2317\u2192                }\\n  2318\u2192            }\\n  2319\u2192        }\\n  2320\u2192        return validationException;\\n  2321\u2192    }\\n  2322\u2192}\\n  2323\u2192\\n\\n<system-reminder>\\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\\n</system-reminder>\\n\"}]},\"parent_tool_use_id\":\"toolu_01Ug4yyFVxfE3Bg3XBr7dBdP\",\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"5d1e21ab-1995-4325-bdcb-f406ea1d33df\"}\n{\"type\":\"assistant\",\"message\":{\"model\":\"claude-haiku-4-5-20251001\",\"id\":\"msg_013QWiRMWbyH3iAgMgXp36Rd\",\"type\":\"message\",\"role\":\"assistant\",\"content\":[{\"type\":\"tool_use\",\"id\":\"toolu_01AFnocDNcSTrwPDZEKYuHET\",\"name\":\"Grep\",\"input\":{\"pattern\":\"SUB_SEARCHES_FIELD|RANK_FIELD\",\"output_mode\":\"files_with_matches\"}}],\"stop_reason\":null,\"stop_sequence\":null,\"usage\":{\"input_tokens\":10436,\"cache_creation_input_tokens\":41873,\"cache_read_input_tokens\":6928,\"cache_creation\":{\"ephemeral_5m_input_tokens\":41873,\"ephemeral_1h_input_tokens\":0},\"output_tokens\":1,\"service_tier\":\"standard\"}},\"parent_tool_use_id\":\"toolu_01Ug4yyFVxfE3Bg3XBr7dBdP\",\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"66a73df7-524b-4299-a07d-8315b3268926\"}\n{\"type\":\"assistant\",\"message\":{\"model\":\"claude-haiku-4-5-20251001\",\"id\":\"msg_013QWiRMWbyH3iAgMgXp36Rd\",\"type\":\"message\",\"role\":\"assistant\",\"content\":[{\"type\":\"tool_use\",\"id\":\"toolu_01VsCCz1ajneUQV39VZJ1EBS\",\"name\":\"Grep\",\"input\":{\"pattern\":\"parseXContent.*sub_searches|parseXContent.*rank\",\"output_mode\":\"files_with_matches\"}}],\"stop_reason\":null,\"stop_sequence\":null,\"usage\":{\"input_tokens\":10436,\"cache_creation_input_tokens\":41873,\"cache_read_input_tokens\":6928,\"cache_creation\":{\"ephemeral_5m_input_tokens\":41873,\"ephemeral_1h_input_tokens\":0},\"output_tokens\":1,\"service_tier\":\"standard\"}},\"parent_tool_use_id\":\"toolu_01Ug4yyFVxfE3Bg3XBr7dBdP\",\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"e9173de8-4327-41f4-9047-65d950bc8081\"}\n{\"type\":\"assistant\",\"message\":{\"model\":\"claude-haiku-4-5-20251001\",\"id\":\"msg_013QWiRMWbyH3iAgMgXp36Rd\",\"type\":\"message\",\"role\":\"assistant\",\"content\":[{\"type\":\"tool_use\",\"id\":\"toolu_01G7AsFz5rstjuyPCyK72HQL\",\"name\":\"Glob\",\"input\":{\"pattern\":\"**/*Rank*.java\",\"path\":\"/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace\"}}],\"stop_reason\":null,\"stop_sequence\":null,\"usage\":{\"input_tokens\":10436,\"cache_creation_input_tokens\":41873,\"cache_read_input_tokens\":6928,\"cache_creation\":{\"ephemeral_5m_input_tokens\":41873,\"ephemeral_1h_input_tokens\":0},\"output_tokens\":1,\"service_tier\":\"standard\"}},\"parent_tool_use_id\":\"toolu_01Ug4yyFVxfE3Bg3XBr7dBdP\",\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"76b9f745-edb6-4d10-a47d-dd2a442fe922\"}\n{\"type\":\"assistant\",\"message\":{\"model\":\"claude-haiku-4-5-20251001\",\"id\":\"msg_013QWiRMWbyH3iAgMgXp36Rd\",\"type\":\"message\",\"role\":\"assistant\",\"content\":[{\"type\":\"tool_use\",\"id\":\"toolu_013rpo6yvPRng9pqsZfqLZgc\",\"name\":\"Glob\",\"input\":{\"pattern\":\"**/*SubSearch*.java\",\"path\":\"/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace\"}}],\"stop_reason\":\"tool_use\",\"stop_sequence\":null,\"usage\":{\"input_tokens\":10436,\"cache_creation_input_tokens\":41873,\"cache_read_input_tokens\":6928,\"cache_creation\":{\"ephemeral_5m_input_tokens\":41873,\"ephemeral_1h_input_tokens\":0},\"output_tokens\":378,\"service_tier\":\"standard\"}},\"parent_tool_use_id\":\"toolu_01Ug4yyFVxfE3Bg3XBr7dBdP\",\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"e34fbb4d-3781-48fd-a5b7-a21646303cfd\"}\n{\"type\":\"user\",\"message\":{\"role\":\"user\",\"content\":[{\"tool_use_id\":\"toolu_01VsCCz1ajneUQV39VZJ1EBS\",\"type\":\"tool_result\",\"content\":\"No files found\"}]},\"parent_tool_use_id\":\"toolu_01Ug4yyFVxfE3Bg3XBr7dBdP\",\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"66cfec90-0a8b-40e5-a61d-d622610fe3bf\"}\n{\"type\":\"user\",\"message\":{\"role\":\"user\",\"content\":[{\"tool_use_id\":\"toolu_01AFnocDNcSTrwPDZEKYuHET\",\"type\":\"tool_result\",\"content\":\"Found 3 files\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/inference/results/RankedDocsResults.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/search/builder/SearchSourceBuilder.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/modules/rank-eval/src/main/java/org/elasticsearch/index/rankeval/MeanReciprocalRank.java\"}]},\"parent_tool_use_id\":\"toolu_01Ug4yyFVxfE3Bg3XBr7dBdP\",\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"d5710420-4c82-4ac7-b4e1-2566280397e2\"}\n{\"type\":\"user\",\"message\":{\"role\":\"user\",\"content\":[{\"tool_use_id\":\"toolu_01G7AsFz5rstjuyPCyK72HQL\",\"type\":\"tool_result\",\"content\":\"/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/modules/mapper-extras/src/internalClusterTest/java/org/elasticsearch/index/mapper/RankFeaturesMapperIntegrationIT.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/modules/mapper-extras/src/main/java/org/elasticsearch/index/mapper/extras/RankFeatureFieldMapper.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/modules/mapper-extras/src/main/java/org/elasticsearch/index/mapper/extras/RankFeatureMetaFieldMapper.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/modules/mapper-extras/src/main/java/org/elasticsearch/index/mapper/extras/RankFeatureQueryBuilder.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/modules/mapper-extras/src/main/java/org/elasticsearch/index/mapper/extras/RankFeaturesFieldMapper.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/modules/mapper-extras/src/test/java/org/elasticsearch/index/mapper/extras/FieldCapsRankFeatureTests.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/modules/mapper-extras/src/test/java/org/elasticsearch/index/mapper/extras/RankFeatureFieldMapperTests.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/modules/mapper-extras/src/test/java/org/elasticsearch/index/mapper/extras/RankFeatureFieldTypeTests.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/modules/mapper-extras/src/test/java/org/elasticsearch/index/mapper/extras/RankFeatureMetaFieldMapperTests.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/modules/mapper-extras/src/test/java/org/elasticsearch/index/mapper/extras/RankFeatureQueryBuilderTests.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/modules/mapper-extras/src/test/java/org/elasticsearch/index/mapper/extras/RankFeaturesFieldMapperTests.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/modules/mapper-extras/src/test/java/org/elasticsearch/index/mapper/extras/RankFeaturesFieldTypeTests.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/modules/rank-eval/src/internalClusterTest/java/org/elasticsearch/index/rankeval/RankEvalRequestIT.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/modules/rank-eval/src/main/java/org/elasticsearch/index/rankeval/ExpectedReciprocalRank.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/modules/rank-eval/src/main/java/org/elasticsearch/index/rankeval/MeanReciprocalRank.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/modules/rank-eval/src/main/java/org/elasticsearch/index/rankeval/RankEvalNamedXContentProvider.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/modules/rank-eval/src/main/java/org/elasticsearch/index/rankeval/RankEvalPlugin.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/modules/rank-eval/src/main/java/org/elasticsearch/index/rankeval/RankEvalRequest.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/modules/rank-eval/src/main/java/org/elasticsearch/index/rankeval/RankEvalRequestBuilder.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/modules/rank-eval/src/main/java/org/elasticsearch/index/rankeval/RankEvalResponse.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/modules/rank-eval/src/main/java/org/elasticsearch/index/rankeval/RankEvalSpec.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/modules/rank-eval/src/main/java/org/elasticsearch/index/rankeval/RestRankEvalAction.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/modules/rank-eval/src/main/java/org/elasticsearch/index/rankeval/TransportRankEvalAction.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/modules/rank-eval/src/test/java/org/elasticsearch/index/rankeval/ExpectedReciprocalRankTests.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/modules/rank-eval/src/test/java/org/elasticsearch/index/rankeval/MeanReciprocalRankTests.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/modules/rank-eval/src/test/java/org/elasticsearch/index/rankeval/RankEvalRequestTests.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/modules/rank-eval/src/test/java/org/elasticsearch/index/rankeval/RankEvalResponseTests.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/modules/rank-eval/src/test/java/org/elasticsearch/index/rankeval/RankEvalSpecTests.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/modules/rank-eval/src/test/java/org/elasticsearch/index/rankeval/TransportRankEvalActionTests.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/modules/rank-eval/src/yamlRestTest/java/org/elasticsearch/index/rankeval/RankEvalYamlIT.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/internalClusterTest/java/org/elasticsearch/search/aggregations/metrics/HDRPercentileRanksIT.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/internalClusterTest/java/org/elasticsearch/search/aggregations/metrics/TDigestPercentileRanksIT.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/internalClusterTest/java/org/elasticsearch/search/rank/FieldBasedRerankerIT.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/internalClusterTest/java/org/elasticsearch/search/rank/MockedRequestActionBasedRerankerIT.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/action/search/RankFeaturePhase.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/search/aggregations/metrics/HDRPercentileRanksAggregator.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/search/aggregations/metrics/InternalHDRPercentileRanks.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/search/aggregations/metrics/InternalTDigestPercentileRanks.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/search/aggregations/metrics/PercentileRanks.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/search/aggregations/metrics/PercentileRanksAggregationBuilder.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/search/aggregations/metrics/PercentileRanksAggregatorFactory.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/search/aggregations/metrics/TDigestPercentileRanksAggregator.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/search/rank/RankBuilder.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/search/rank/RankDoc.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/search/rank/RankDocShardInfo.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/search/rank/RankSearchContext.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/search/rank/RankShardResult.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/search/rank/context/QueryPhaseRankCoordinatorContext.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/search/rank/context/QueryPhaseRankShardContext.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/search/rank/context/RankFeaturePhaseRankCoordinatorContext.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/search/rank/context/RankFeaturePhaseRankShardContext.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/search/rank/feature/RankFeatureDoc.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/search/rank/feature/RankFeatureResult.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/search/rank/feature/RankFeatureShardPhase.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/search/rank/feature/RankFeatureShardRequest.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/search/rank/feature/RankFeatureShardResult.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/search/rank/rerank/RerankingQueryPhaseRankCoordinatorContext.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/search/rank/rerank/RerankingQueryPhaseRankShardContext.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/search/rank/rerank/RerankingRankFeaturePhaseRankShardContext.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/search/retriever/RankDocsRetrieverBuilder.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/search/retriever/rankdoc/RankDocsQuery.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/search/retriever/rankdoc/RankDocsQueryBuilder.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/test/java/org/elasticsearch/action/search/RankFeaturePhaseTests.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/test/java/org/elasticsearch/search/aggregations/metrics/HDRPercentileRanksAggregatorTests.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/test/java/org/elasticsearch/search/aggregations/metrics/InternalHDRPercentilesRanksTests.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/test/java/org/elasticsearch/search/aggregations/metrics/InternalPercentilesRanksTestCase.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/test/java/org/elasticsearch/search/aggregations/metrics/InternalTDigestPercentilesRanksTests.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/test/java/org/elasticsearch/search/aggregations/metrics/PercentileRanksTests.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/test/java/org/elasticsearch/search/aggregations/metrics/TDigestPercentileRanksAggregatorTests.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/test/java/org/elasticsearch/search/rank/AbstractRankDocWireSerializingTestCase.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/test/java/org/elasticsearch/search/rank/RankDocTests.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/test/java/org/elasticsearch/search/rank/RankFeatureShardPhaseTests.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/test/java/org/elasticsearch/search/retriever/RankDocsRetrieverBuilderTests.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/test/java/org/elasticsearch/search/retriever/rankdoc/RankDocsQueryBuilderTests.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/test/framework/src/main/java/org/elasticsearch/indices/CrankyCircuitBreakerService.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/test/framework/src/main/java/org/elasticsearch/search/rank/TestRankBuilder.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/test/framework/src/main/java/org/elasticsearch/search/rank/TestRankShardResult.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/test/framework/src/main/java/org/elasticsearch/search/rank/rerank/AbstractRerankerIT.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/analytics/src/main/java/org/elasticsearch/xpack/analytics/aggregations/metrics/HistoBackedHDRPercentileRanksAggregator.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/analytics/src/main/java/org/elasticsearch/xpack/analytics/aggregations/metrics/HistoBackedTDigestPercentileRanksAggregator.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/analytics/src/test/java/org/elasticsearch/xpack/analytics/aggregations/metrics/HDRPreAggregatedPercentileRanksAggregatorTests.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/analytics/src/test/java/org/elasticsearch/xpack/analytics/aggregations/metrics/TDigestPreAggregatedPercentileRanksAggregatorTests.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/inference/results/RankedDocsResults.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/inference/trainedmodel/LearningToRankConfig.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/inference/trainedmodel/ltr/LearningToRankFeatureExtractorBuilder.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/core/src/test/java/org/elasticsearch/xpack/core/inference/results/RankedDocsResultsTests.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/core/src/test/java/org/elasticsearch/xpack/core/ml/inference/trainedmodel/LearningToRankConfigTests.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/inference/qa/inference-service-tests/src/javaRestTest/java/org/elasticsearch/xpack/inference/RerankingIT.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/inference/qa/test-service-plugin/src/main/java/org/elasticsearch/xpack/inference/mock/TestRerankingServiceExtension.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/inference/src/main/java/org/elasticsearch/xpack/inference/external/action/alibabacloudsearch/AlibabaCloudSearchRerankAction.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/inference/src/main/java/org/elasticsearch/xpack/inference/external/http/sender/AlibabaCloudSearchRerankRequestManager.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/inference/src/main/java/org/elasticsearch/xpack/inference/external/http/sender/CohereRerankRequestManager.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/inference/src/main/java/org/elasticsearch/xpack/inference/external/http/sender/GoogleVertexAiRerankRequestManager.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/inference/src/main/java/org/elasticsearch/xpack/inference/external/request/alibabacloudsearch/AlibabaCloudSearchRerankRequest.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/inference/src/main/java/org/elasticsearch/xpack/inference/external/request/alibabacloudsearch/AlibabaCloudSearchRerankRequestEntity.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/inference/src/main/java/org/elasticsearch/xpack/inference/external/request/cohere/CohereRerankRequest.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/inference/src/main/java/org/elasticsearch/xpack/inference/external/request/cohere/CohereRerankRequestEntity.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/inference/src/main/java/org/elasticsearch/xpack/inference/external/request/googlevertexai/GoogleVertexAiRerankRequest.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/inference/src/main/java/org/elasticsearch/xpack/inference/external/request/googlevertexai/GoogleVertexAiRerankRequestEntity.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/inference/src/main/java/org/elasticsearch/xpack/inference/external/response/alibabacloudsearch/AlibabaCloudSearchRerankResponseEntity.java\\n(Results are truncated. Consider using a more specific path or pattern.)\"}]},\"parent_tool_use_id\":\"toolu_01Ug4yyFVxfE3Bg3XBr7dBdP\",\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"48a44182-e0a4-4e12-9ad2-1ce73bf87f03\"}\n{\"type\":\"user\",\"message\":{\"role\":\"user\",\"content\":[{\"tool_use_id\":\"toolu_013rpo6yvPRng9pqsZfqLZgc\",\"type\":\"tool_result\",\"content\":\"/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/search/builder/SubSearchSourceBuilder.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/search/internal/SubSearchContext.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/test/java/org/elasticsearch/search/builder/SubSearchSourceBuilderTests.java\"}]},\"parent_tool_use_id\":\"toolu_01Ug4yyFVxfE3Bg3XBr7dBdP\",\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"39241643-7960-41f7-a2a2-1dd4814799b9\"}\n{\"type\":\"assistant\",\"message\":{\"model\":\"claude-haiku-4-5-20251001\",\"id\":\"msg_01MGXR4UTSpGopSvZwo3jFqS\",\"type\":\"message\",\"role\":\"assistant\",\"content\":[{\"type\":\"tool_use\",\"id\":\"toolu_01NsmTGWMqDyLhEqgER7Ywbu\",\"name\":\"Read\",\"input\":{\"file_path\":\"/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/search/builder/SubSearchSourceBuilder.java\"}}],\"stop_reason\":null,\"stop_sequence\":null,\"usage\":{\"input_tokens\":6,\"cache_creation_input_tokens\":19550,\"cache_read_input_tokens\":48801,\"cache_creation\":{\"ephemeral_5m_input_tokens\":19550,\"ephemeral_1h_input_tokens\":0},\"output_tokens\":1,\"service_tier\":\"standard\"}},\"parent_tool_use_id\":\"toolu_01Ug4yyFVxfE3Bg3XBr7dBdP\",\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"71652fc8-a3f2-44a0-8bd3-7ce118682ef4\"}\n{\"type\":\"assistant\",\"message\":{\"model\":\"claude-haiku-4-5-20251001\",\"id\":\"msg_01MGXR4UTSpGopSvZwo3jFqS\",\"type\":\"message\",\"role\":\"assistant\",\"content\":[{\"type\":\"tool_use\",\"id\":\"toolu_01SzTuKR1JJEDbJw6YCupwGs\",\"name\":\"Read\",\"input\":{\"file_path\":\"/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/search/rank/RankBuilder.java\"}}],\"stop_reason\":null,\"stop_sequence\":null,\"usage\":{\"input_tokens\":6,\"cache_creation_input_tokens\":19550,\"cache_read_input_tokens\":48801,\"cache_creation\":{\"ephemeral_5m_input_tokens\":19550,\"ephemeral_1h_input_tokens\":0},\"output_tokens\":1,\"service_tier\":\"standard\"}},\"parent_tool_use_id\":\"toolu_01Ug4yyFVxfE3Bg3XBr7dBdP\",\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"c642b9c6-9e6b-4bf7-8f85-f35a3868aa21\"}\n{\"type\":\"assistant\",\"message\":{\"model\":\"claude-haiku-4-5-20251001\",\"id\":\"msg_01MGXR4UTSpGopSvZwo3jFqS\",\"type\":\"message\",\"role\":\"assistant\",\"content\":[{\"type\":\"tool_use\",\"id\":\"toolu_01ScFgU51edAN6XVt19gQazL\",\"name\":\"Grep\",\"input\":{\"pattern\":\"deprecat\",\"type\":\"java\",\"output_mode\":\"files_with_matches\",\"head_limit\":30}}],\"stop_reason\":null,\"stop_sequence\":null,\"usage\":{\"input_tokens\":6,\"cache_creation_input_tokens\":19550,\"cache_read_input_tokens\":48801,\"cache_creation\":{\"ephemeral_5m_input_tokens\":19550,\"ephemeral_1h_input_tokens\":0},\"output_tokens\":1,\"service_tier\":\"standard\"}},\"parent_tool_use_id\":\"toolu_01Ug4yyFVxfE3Bg3XBr7dBdP\",\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"4b44d81a-9900-4d2a-ba05-78fe92386501\"}\n{\"type\":\"user\",\"message\":{\"role\":\"user\",\"content\":[{\"tool_use_id\":\"toolu_01NsmTGWMqDyLhEqgER7Ywbu\",\"type\":\"tool_result\",\"content\":\"     1\u2192/*\\n     2\u2192 * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\\n     3\u2192 * or more contributor license agreements. Licensed under the \\\"Elastic License\\n     4\u2192 * 2.0\\\", the \\\"GNU Affero General Public License v3.0 only\\\", and the \\\"Server Side\\n     5\u2192 * Public License v 1\\\"; you may not use this file except in compliance with, at\\n     6\u2192 * your election, the \\\"Elastic License 2.0\\\", the \\\"GNU Affero General Public\\n     7\u2192 * License v3.0 only\\\", or the \\\"Server Side Public License, v 1\\\".\\n     8\u2192 */\\n     9\u2192\\n    10\u2192package org.elasticsearch.search.builder;\\n    11\u2192\\n    12\u2192import org.apache.lucene.search.Query;\\n    13\u2192import org.elasticsearch.common.io.stream.StreamInput;\\n    14\u2192import org.elasticsearch.common.io.stream.StreamOutput;\\n    15\u2192import org.elasticsearch.common.io.stream.Writeable;\\n    16\u2192import org.elasticsearch.index.query.AbstractQueryBuilder;\\n    17\u2192import org.elasticsearch.index.query.QueryBuilder;\\n    18\u2192import org.elasticsearch.index.query.QueryRewriteContext;\\n    19\u2192import org.elasticsearch.index.query.Rewriteable;\\n    20\u2192import org.elasticsearch.index.query.SearchExecutionContext;\\n    21\u2192import org.elasticsearch.usage.SearchUsage;\\n    22\u2192import org.elasticsearch.xcontent.ConstructingObjectParser;\\n    23\u2192import org.elasticsearch.xcontent.ToXContent;\\n    24\u2192import org.elasticsearch.xcontent.XContentBuilder;\\n    25\u2192import org.elasticsearch.xcontent.XContentParser;\\n    26\u2192\\n    27\u2192import java.io.IOException;\\n    28\u2192import java.util.Objects;\\n    29\u2192\\n    30\u2192import static org.elasticsearch.xcontent.ConstructingObjectParser.constructorArg;\\n    31\u2192\\n    32\u2192/**\\n    33\u2192 * {@code SearchQueryBuilder} is a wrapper class for containing all\\n    34\u2192 * the information required to perform a single search query\\n    35\u2192 * as part of a series of multiple queries for features like ranking.\\n    36\u2192 * It's expected to typically be used as part of a {@link java.util.List}.\\n    37\u2192 */\\n    38\u2192public class SubSearchSourceBuilder implements ToXContent, Writeable, Rewriteable<SubSearchSourceBuilder> {\\n    39\u2192\\n    40\u2192    private static final ConstructingObjectParser<SubSearchSourceBuilder, SearchUsage> PARSER = new ConstructingObjectParser<>(\\n    41\u2192        \\\"sub_search_source_builder\\\",\\n    42\u2192        args -> new SubSearchSourceBuilder((QueryBuilder) args[0])\\n    43\u2192    );\\n    44\u2192\\n    45\u2192    static {\\n    46\u2192        PARSER.declareObject(\\n    47\u2192            constructorArg(),\\n    48\u2192            (p, c) -> AbstractQueryBuilder.parseTopLevelQuery(p, c::trackQueryUsage),\\n    49\u2192            SearchSourceBuilder.QUERY_FIELD\\n    50\u2192        );\\n    51\u2192    }\\n    52\u2192\\n    53\u2192    public static SubSearchSourceBuilder fromXContent(XContentParser parser, SearchUsage searchUsage) throws IOException {\\n    54\u2192        return PARSER.parse(parser, searchUsage);\\n    55\u2192    }\\n    56\u2192\\n    57\u2192    @Override\\n    58\u2192    public XContentBuilder toXContent(XContentBuilder builder, Params params) throws IOException {\\n    59\u2192        builder.startObject();\\n    60\u2192        builder.field(SearchSourceBuilder.QUERY_FIELD.getPreferredName());\\n    61\u2192        queryBuilder.toXContent(builder, params);\\n    62\u2192        builder.endObject();\\n    63\u2192\\n    64\u2192        return builder;\\n    65\u2192    }\\n    66\u2192\\n    67\u2192    @Override\\n    68\u2192    public boolean isFragment() {\\n    69\u2192        return false;\\n    70\u2192    }\\n    71\u2192\\n    72\u2192    private final QueryBuilder queryBuilder;\\n    73\u2192\\n    74\u2192    public SubSearchSourceBuilder(QueryBuilder queryBuilder) {\\n    75\u2192        Objects.requireNonNull(queryBuilder);\\n    76\u2192        this.queryBuilder = queryBuilder;\\n    77\u2192    }\\n    78\u2192\\n    79\u2192    public SubSearchSourceBuilder(StreamInput in) throws IOException {\\n    80\u2192        this.queryBuilder = in.readNamedWriteable(QueryBuilder.class);\\n    81\u2192    }\\n    82\u2192\\n    83\u2192    @Override\\n    84\u2192    public void writeTo(StreamOutput out) throws IOException {\\n    85\u2192        out.writeNamedWriteable(queryBuilder);\\n    86\u2192    }\\n    87\u2192\\n    88\u2192    @Override\\n    89\u2192    public SubSearchSourceBuilder rewrite(QueryRewriteContext ctx) throws IOException {\\n    90\u2192        QueryBuilder rewrittenQueryBuilder = queryBuilder.rewrite(ctx);\\n    91\u2192        return rewrittenQueryBuilder == queryBuilder ? this : new SubSearchSourceBuilder(rewrittenQueryBuilder);\\n    92\u2192    }\\n    93\u2192\\n    94\u2192    public QueryBuilder getQueryBuilder() {\\n    95\u2192        return queryBuilder;\\n    96\u2192    }\\n    97\u2192\\n    98\u2192    public Query toSearchQuery(SearchExecutionContext context) throws IOException {\\n    99\u2192        return queryBuilder.toQuery(context);\\n   100\u2192    }\\n   101\u2192\\n   102\u2192    @Override\\n   103\u2192    public boolean equals(Object o) {\\n   104\u2192        if (this == o) return true;\\n   105\u2192        if (o == null || getClass() != o.getClass()) return false;\\n   106\u2192        SubSearchSourceBuilder that = (SubSearchSourceBuilder) o;\\n   107\u2192        return Objects.equals(queryBuilder, that.queryBuilder);\\n   108\u2192    }\\n   109\u2192\\n   110\u2192    @Override\\n   111\u2192    public int hashCode() {\\n   112\u2192        return Objects.hash(queryBuilder);\\n   113\u2192    }\\n   114\u2192}\\n   115\u2192\\n\\n<system-reminder>\\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\\n</system-reminder>\\n\"}]},\"parent_tool_use_id\":\"toolu_01Ug4yyFVxfE3Bg3XBr7dBdP\",\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"eb0587e6-7f94-4765-820c-90a206e6dc07\"}\n{\"type\":\"user\",\"message\":{\"role\":\"user\",\"content\":[{\"tool_use_id\":\"toolu_01SzTuKR1JJEDbJw6YCupwGs\",\"type\":\"tool_result\",\"content\":\"     1\u2192/*\\n     2\u2192 * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\\n     3\u2192 * or more contributor license agreements. Licensed under the \\\"Elastic License\\n     4\u2192 * 2.0\\\", the \\\"GNU Affero General Public License v3.0 only\\\", and the \\\"Server Side\\n     5\u2192 * Public License v 1\\\"; you may not use this file except in compliance with, at\\n     6\u2192 * your election, the \\\"Elastic License 2.0\\\", the \\\"GNU Affero General Public\\n     7\u2192 * License v3.0 only\\\", or the \\\"Server Side Public License, v 1\\\".\\n     8\u2192 */\\n     9\u2192\\n    10\u2192package org.elasticsearch.search.rank;\\n    11\u2192\\n    12\u2192import org.apache.lucene.search.Explanation;\\n    13\u2192import org.apache.lucene.search.Query;\\n    14\u2192import org.elasticsearch.client.internal.Client;\\n    15\u2192import org.elasticsearch.common.Strings;\\n    16\u2192import org.elasticsearch.common.io.stream.StreamInput;\\n    17\u2192import org.elasticsearch.common.io.stream.StreamOutput;\\n    18\u2192import org.elasticsearch.common.io.stream.VersionedNamedWriteable;\\n    19\u2192import org.elasticsearch.search.SearchService;\\n    20\u2192import org.elasticsearch.search.rank.context.QueryPhaseRankCoordinatorContext;\\n    21\u2192import org.elasticsearch.search.rank.context.QueryPhaseRankShardContext;\\n    22\u2192import org.elasticsearch.search.rank.context.RankFeaturePhaseRankCoordinatorContext;\\n    23\u2192import org.elasticsearch.search.rank.context.RankFeaturePhaseRankShardContext;\\n    24\u2192import org.elasticsearch.xcontent.ParseField;\\n    25\u2192import org.elasticsearch.xcontent.ToXContentObject;\\n    26\u2192import org.elasticsearch.xcontent.XContentBuilder;\\n    27\u2192\\n    28\u2192import java.io.IOException;\\n    29\u2192import java.util.List;\\n    30\u2192import java.util.Objects;\\n    31\u2192\\n    32\u2192/**\\n    33\u2192 * {@code RankBuilder} is used as a base class to manage input, parsing, and subsequent generation of appropriate contexts\\n    34\u2192 * for handling searches that require multiple queries and/or ranking steps for global rank relevance.\\n    35\u2192 */\\n    36\u2192public abstract class RankBuilder implements VersionedNamedWriteable, ToXContentObject {\\n    37\u2192\\n    38\u2192    public static final ParseField RANK_WINDOW_SIZE_FIELD = new ParseField(\\\"rank_window_size\\\");\\n    39\u2192\\n    40\u2192    public static final int DEFAULT_RANK_WINDOW_SIZE = SearchService.DEFAULT_SIZE;\\n    41\u2192\\n    42\u2192    private final int rankWindowSize;\\n    43\u2192\\n    44\u2192    public RankBuilder(int rankWindowSize) {\\n    45\u2192        this.rankWindowSize = rankWindowSize;\\n    46\u2192    }\\n    47\u2192\\n    48\u2192    public RankBuilder(StreamInput in) throws IOException {\\n    49\u2192        rankWindowSize = in.readVInt();\\n    50\u2192    }\\n    51\u2192\\n    52\u2192    public final void writeTo(StreamOutput out) throws IOException {\\n    53\u2192        out.writeVInt(rankWindowSize);\\n    54\u2192        doWriteTo(out);\\n    55\u2192    }\\n    56\u2192\\n    57\u2192    protected abstract void doWriteTo(StreamOutput out) throws IOException;\\n    58\u2192\\n    59\u2192    @Override\\n    60\u2192    public final XContentBuilder toXContent(XContentBuilder builder, Params params) throws IOException {\\n    61\u2192        builder.startObject();\\n    62\u2192        builder.startObject(getWriteableName());\\n    63\u2192        builder.field(RANK_WINDOW_SIZE_FIELD.getPreferredName(), rankWindowSize);\\n    64\u2192        doXContent(builder, params);\\n    65\u2192        builder.endObject();\\n    66\u2192        builder.endObject();\\n    67\u2192        return builder;\\n    68\u2192    }\\n    69\u2192\\n    70\u2192    protected abstract void doXContent(XContentBuilder builder, Params params) throws IOException;\\n    71\u2192\\n    72\u2192    public int rankWindowSize() {\\n    73\u2192        return rankWindowSize;\\n    74\u2192    }\\n    75\u2192\\n    76\u2192    /**\\n    77\u2192     * Specify whether this rank builder is a compound builder or not. A compound builder is a rank builder that requires\\n    78\u2192     * two or more queries to be executed in order to generate the final result.\\n    79\u2192     */\\n    80\u2192    public abstract boolean isCompoundBuilder();\\n    81\u2192\\n    82\u2192    /**\\n    83\u2192     * Generates an {@code Explanation} on how the final score for the provided {@code RankDoc} is computed for the given `RankBuilder`.\\n    84\u2192     * In addition to the base explanation to enrich, we also have access to the query names that were provided in the request,\\n    85\u2192     * so that we can have direct association with the user provided query.\\n    86\u2192     */\\n    87\u2192    public abstract Explanation explainHit(Explanation baseExplanation, RankDoc scoreDoc, List<String> queryNames);\\n    88\u2192\\n    89\u2192    /**\\n    90\u2192     * Generates a context used to execute required searches during the query phase on the shard.\\n    91\u2192     */\\n    92\u2192    public abstract QueryPhaseRankShardContext buildQueryPhaseShardContext(List<Query> queries, int from);\\n    93\u2192\\n    94\u2192    /**\\n    95\u2192     * Generates a context used to be executed on the coordinating node, that would combine all individual shard results.\\n    96\u2192     */\\n    97\u2192    public abstract QueryPhaseRankCoordinatorContext buildQueryPhaseCoordinatorContext(int size, int from);\\n    98\u2192\\n    99\u2192    /**\\n   100\u2192     * Generates a context used to execute the rank feature phase on the shard. This is responsible for retrieving any needed\\n   101\u2192     * feature data, and passing them back to the coordinator through the appropriate {@link  RankShardResult}.\\n   102\u2192     */\\n   103\u2192    public abstract RankFeaturePhaseRankShardContext buildRankFeaturePhaseShardContext();\\n   104\u2192\\n   105\u2192    /**\\n   106\u2192     * Generates a context used to perform global ranking during the RankFeature phase,\\n   107\u2192     * on the coordinator based on all the individual shard results. The output of this will be a `size` ranked list of ordered results,\\n   108\u2192     * which will then be passed to fetch phase.\\n   109\u2192     */\\n   110\u2192    public abstract RankFeaturePhaseRankCoordinatorContext buildRankFeaturePhaseCoordinatorContext(int size, int from, Client client);\\n   111\u2192\\n   112\u2192    @Override\\n   113\u2192    public final boolean equals(Object obj) {\\n   114\u2192        if (this == obj) {\\n   115\u2192            return true;\\n   116\u2192        }\\n   117\u2192        if (obj == null || getClass() != obj.getClass()) {\\n   118\u2192            return false;\\n   119\u2192        }\\n   120\u2192        @SuppressWarnings(\\\"unchecked\\\")\\n   121\u2192        RankBuilder other = (RankBuilder) obj;\\n   122\u2192        return Objects.equals(rankWindowSize, other.rankWindowSize()) && doEquals(other);\\n   123\u2192    }\\n   124\u2192\\n   125\u2192    protected abstract boolean doEquals(RankBuilder other);\\n   126\u2192\\n   127\u2192    @Override\\n   128\u2192    public final int hashCode() {\\n   129\u2192        return Objects.hash(getClass(), rankWindowSize, doHashCode());\\n   130\u2192    }\\n   131\u2192\\n   132\u2192    protected abstract int doHashCode();\\n   133\u2192\\n   134\u2192    @Override\\n   135\u2192    public String toString() {\\n   136\u2192        return Strings.toString(this, true, true);\\n   137\u2192    }\\n   138\u2192}\\n   139\u2192\\n\\n<system-reminder>\\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\\n</system-reminder>\\n\"}]},\"parent_tool_use_id\":\"toolu_01Ug4yyFVxfE3Bg3XBr7dBdP\",\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"2d5543e7-6b44-4be6-905b-52795949629c\"}\n{\"type\":\"user\",\"message\":{\"role\":\"user\",\"content\":[{\"tool_use_id\":\"toolu_01ScFgU51edAN6XVt19gQazL\",\"type\":\"tool_result\",\"content\":\"Found 30 files\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/qa/src/main/java/org/elasticsearch/xpack/test/rest/IndexMappingTemplateAsserter.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/qa/security-setup-password-tests/src/javaRestTest/java/org/elasticsearch/xpack/security/authc/esnative/tool/SetupPasswordToolIT.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/qa/rolling-upgrade/src/test/java/org/elasticsearch/upgrades/MlJobSnapshotUpgradeIT.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/wildcard/src/main/java/org/elasticsearch/xpack/wildcard/mapper/WildcardFieldMapper.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/watcher/src/main/java/org/elasticsearch/xpack/watcher/transform/script/ExecutableScriptTransform.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/watcher/src/main/java/org/elasticsearch/xpack/watcher/support/search/WatcherSearchTemplateRequest.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/watcher/src/main/java/org/elasticsearch/xpack/watcher/rest/action/RestWatcherStatsAction.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/transform/src/test/java/org/elasticsearch/xpack/transform/checkpoint/TimeBasedCheckpointProviderTests.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/transform/src/main/java/org/elasticsearch/xpack/transform/action/TransportUpgradeTransformsAction.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/transform/src/main/java/org/elasticsearch/xpack/transform/TransformClusterStateListener.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/transform/src/main/java/org/elasticsearch/xpack/transform/Transform.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/transform/qa/single-node-tests/src/javaRestTest/java/org/elasticsearch/xpack/transform/integration/TransformAuditorIT.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/text-structure/src/test/java/org/elasticsearch/xpack/textstructure/structurefinder/TimestampFormatFinderTests.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/text-structure/src/main/java/org/elasticsearch/xpack/textstructure/rest/RestFindStructureAction.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/stack/src/test/java/org/elasticsearch/xpack/stack/StackTemplateRegistryTests.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/stack/src/test/java/org/elasticsearch/xpack/stack/LegacyStackTemplateRegistryTests.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/stack/src/main/java/org/elasticsearch/xpack/stack/StackTemplateRegistry.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/stack/src/main/java/org/elasticsearch/xpack/stack/LegacyStackTemplateRegistry.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/sql/src/main/java/org/elasticsearch/xpack/sql/parser/SqlBaseParser.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/sql/src/main/java/org/elasticsearch/xpack/sql/parser/SqlBaseLexer.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/sql/src/main/java/org/elasticsearch/xpack/sql/parser/LogicalPlanBuilder.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/sql/sql-proto/src/main/java/org/elasticsearch/xpack/sql/proto/core/Booleans.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/sql/sql-action/src/test/java/org/elasticsearch/xpack/sql/action/SqlQueryRequestTests.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/sql/sql-action/src/main/java/org/elasticsearch/xpack/sql/action/SqlQueryRequest.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/sql/qa/server/single-node/src/javaRestTest/java/org/elasticsearch/xpack/sql/qa/single_node/RestSqlDeprecationIT.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/sql/qa/server/security/src/test/java/org/elasticsearch/xpack/sql/qa/security/RestSqlSecurityIT.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/sql/qa/jdbc/src/main/java/org/elasticsearch/xpack/sql/qa/jdbc/JdbcWarningsTestCase.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/sql/jdbc/src/main/java/org/elasticsearch/xpack/sql/jdbc/JdbcResultSet.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/spatial/src/test/java/org/elasticsearch/xpack/spatial/index/query/LegacyGeoShapeWithDocValuesQueryTests.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/spatial/src/test/java/org/elasticsearch/xpack/spatial/index/mapper/GeoShapeWithDocValuesFieldMapperTests.java\"}]},\"parent_tool_use_id\":\"toolu_01Ug4yyFVxfE3Bg3XBr7dBdP\",\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"e5f4a6f0-3f46-471c-a83f-83e027a12ff7\"}\n{\"type\":\"assistant\",\"message\":{\"model\":\"claude-haiku-4-5-20251001\",\"id\":\"msg_01Wa5Roi8etyJuuz3LrDLqEq\",\"type\":\"message\",\"role\":\"assistant\",\"content\":[{\"type\":\"tool_use\",\"id\":\"toolu_01NmmpMJL1WQYAKWawSEJGdz\",\"name\":\"Grep\",\"input\":{\"pattern\":\"RestSearch|TransportSearch\",\"type\":\"java\",\"output_mode\":\"files_with_matches\",\"head_limit\":15}}],\"stop_reason\":null,\"stop_sequence\":null,\"usage\":{\"input_tokens\":6,\"cache_creation_input_tokens\":6607,\"cache_read_input_tokens\":68351,\"cache_creation\":{\"ephemeral_5m_input_tokens\":6607,\"ephemeral_1h_input_tokens\":0},\"output_tokens\":1,\"service_tier\":\"standard\"}},\"parent_tool_use_id\":\"toolu_01Ug4yyFVxfE3Bg3XBr7dBdP\",\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"99469310-f16e-4278-aa4e-6c386884552b\"}\n{\"type\":\"assistant\",\"message\":{\"model\":\"claude-haiku-4-5-20251001\",\"id\":\"msg_01Wa5Roi8etyJuuz3LrDLqEq\",\"type\":\"message\",\"role\":\"assistant\",\"content\":[{\"type\":\"tool_use\",\"id\":\"toolu_016S8fHeSrWVzKg8jdpWKYar\",\"name\":\"Grep\",\"input\":{\"pattern\":\"class.*Search.*Action\",\"type\":\"java\",\"output_mode\":\"files_with_matches\",\"head_limit\":10}}],\"stop_reason\":null,\"stop_sequence\":null,\"usage\":{\"input_tokens\":6,\"cache_creation_input_tokens\":6607,\"cache_read_input_tokens\":68351,\"cache_creation\":{\"ephemeral_5m_input_tokens\":6607,\"ephemeral_1h_input_tokens\":0},\"output_tokens\":1,\"service_tier\":\"standard\"}},\"parent_tool_use_id\":\"toolu_01Ug4yyFVxfE3Bg3XBr7dBdP\",\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"fe02d8be-acb9-4440-b80d-783ce1ec1581\"}\n{\"type\":\"user\",\"message\":{\"role\":\"user\",\"content\":[{\"tool_use_id\":\"toolu_01NmmpMJL1WQYAKWawSEJGdz\",\"type\":\"tool_result\",\"content\":\"Found 15 files\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/qa/rolling-upgrade/src/test/java/org/elasticsearch/upgrades/IndexingIT.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/qa/rolling-upgrade-multi-cluster/src/test/java/org/elasticsearch/upgrades/CcrRollingUpgradeIT.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/qa/full-cluster-restart/src/javaRestTest/java/org/elasticsearch/xpack/restart/FullClusterRestartIT.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/watcher/src/test/java/org/elasticsearch/xpack/watcher/execution/TriggeredWatchStoreTests.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/watcher/src/test/java/org/elasticsearch/xpack/watcher/WatcherServiceTests.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/watcher/qa/with-security/src/javaRestTest/java/org/elasticsearch/smoketest/SmokeTestWatcherWithSecurityIT.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/watcher/qa/rest/src/javaRestTest/java/org/elasticsearch/smoketest/SmokeTestWatcherTestSuiteIT.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/transform/src/test/java/org/elasticsearch/xpack/transform/checkpoint/TimeBasedCheckpointProviderTests.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/transform/src/main/java/org/elasticsearch/xpack/transform/transforms/common/AbstractCompositeAggFunction.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/transform/src/main/java/org/elasticsearch/xpack/transform/transforms/ClientTransformIndexer.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/transform/src/main/java/org/elasticsearch/xpack/transform/persistence/IndexBasedTransformConfigManager.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/transform/src/main/java/org/elasticsearch/xpack/transform/checkpoint/TimeBasedCheckpointProvider.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/transform/src/main/java/org/elasticsearch/xpack/transform/action/TransportGetCheckpointAction.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/sql/src/test/java/org/elasticsearch/xpack/sql/analysis/CancellationTests.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/security/src/test/java/org/elasticsearch/xpack/security/transport/ServerTransportFilterTests.java\"}]},\"parent_tool_use_id\":\"toolu_01Ug4yyFVxfE3Bg3XBr7dBdP\",\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"4c8220f6-f45e-4d86-afe5-3074c54f20e7\"}\n{\"type\":\"user\",\"message\":{\"role\":\"user\",\"content\":[{\"tool_use_id\":\"toolu_016S8fHeSrWVzKg8jdpWKYar\",\"type\":\"tool_result\",\"content\":\"Found 10 files\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/sql/src/main/java/org/elasticsearch/xpack/sql/execution/search/Querier.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/sql/src/internalClusterTest/java/org/elasticsearch/xpack/sql/action/AsyncSqlSearchActionIT.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/sql/src/internalClusterTest/java/org/elasticsearch/xpack/sql/action/AbstractSqlBlockingIntegTestCase.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/security/src/internalClusterTest/java/org/elasticsearch/xpack/security/profile/ProfileCancellationIntegTests.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/searchable-snapshots/src/main/java/org/elasticsearch/xpack/searchablesnapshots/rest/RestSearchableSnapshotsStatsAction.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/searchable-snapshots/src/main/java/org/elasticsearch/xpack/searchablesnapshots/rest/RestSearchableSnapshotsNodeCachesStatsAction.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/searchable-snapshots/src/main/java/org/elasticsearch/xpack/searchablesnapshots/rest/RestMountSearchableSnapshotAction.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/searchable-snapshots/src/main/java/org/elasticsearch/xpack/searchablesnapshots/rest/RestClearSearchableSnapshotsCacheAction.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/searchable-snapshots/src/main/java/org/elasticsearch/xpack/searchablesnapshots/action/cache/TransportSearchableSnapshotsNodeCachesStatsAction.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/searchable-snapshots/src/main/java/org/elasticsearch/xpack/searchablesnapshots/action/cache/TransportSearchableSnapshotCacheStoresAction.java\"}]},\"parent_tool_use_id\":\"toolu_01Ug4yyFVxfE3Bg3XBr7dBdP\",\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"c482ec06-1273-4bd3-8b6c-360d7e6c9882\"}\n{\"type\":\"assistant\",\"message\":{\"model\":\"claude-haiku-4-5-20251001\",\"id\":\"msg_01XUCvjpG3ro35mgYmPWiA9i\",\"type\":\"message\",\"role\":\"assistant\",\"content\":[{\"type\":\"tool_use\",\"id\":\"toolu_01LdXSP54M4x5VtXPVRzX3ZL\",\"name\":\"Glob\",\"input\":{\"pattern\":\"**/action/search/Rest*.java\",\"path\":\"/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java\"}}],\"stop_reason\":null,\"stop_sequence\":null,\"usage\":{\"input_tokens\":6,\"cache_creation_input_tokens\":2556,\"cache_read_input_tokens\":74958,\"cache_creation\":{\"ephemeral_5m_input_tokens\":2556,\"ephemeral_1h_input_tokens\":0},\"output_tokens\":1,\"service_tier\":\"standard\"}},\"parent_tool_use_id\":\"toolu_01Ug4yyFVxfE3Bg3XBr7dBdP\",\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"403fb87f-ffc2-4992-82c9-a288b69f4dd4\"}\n{\"type\":\"assistant\",\"message\":{\"model\":\"claude-haiku-4-5-20251001\",\"id\":\"msg_01XUCvjpG3ro35mgYmPWiA9i\",\"type\":\"message\",\"role\":\"assistant\",\"content\":[{\"type\":\"tool_use\",\"id\":\"toolu_0183n2LvWUY4Ckoxx9m2tTyq\",\"name\":\"Glob\",\"input\":{\"pattern\":\"**/action/search/Transport*.java\",\"path\":\"/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java\"}}],\"stop_reason\":null,\"stop_sequence\":null,\"usage\":{\"input_tokens\":6,\"cache_creation_input_tokens\":2556,\"cache_read_input_tokens\":74958,\"cache_creation\":{\"ephemeral_5m_input_tokens\":2556,\"ephemeral_1h_input_tokens\":0},\"output_tokens\":1,\"service_tier\":\"standard\"}},\"parent_tool_use_id\":\"toolu_01Ug4yyFVxfE3Bg3XBr7dBdP\",\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"f48842f2-12c4-44d1-948e-a00448ad94d5\"}\n{\"type\":\"user\",\"message\":{\"role\":\"user\",\"content\":[{\"tool_use_id\":\"toolu_01LdXSP54M4x5VtXPVRzX3ZL\",\"type\":\"tool_result\",\"content\":\"/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/action/search/RestClosePointInTimeAction.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/action/search/RestOpenPointInTimeAction.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/rest/action/search/RestClearScrollAction.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/rest/action/search/RestCountAction.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/rest/action/search/RestExplainAction.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/rest/action/search/RestKnnSearchAction.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/rest/action/search/RestMultiSearchAction.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/rest/action/search/RestSearchAction.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/rest/action/search/RestSearchScrollAction.java\"}]},\"parent_tool_use_id\":\"toolu_01Ug4yyFVxfE3Bg3XBr7dBdP\",\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"5d693b1d-4319-4651-9fa6-b8543a303196\"}\n{\"type\":\"user\",\"message\":{\"role\":\"user\",\"content\":[{\"tool_use_id\":\"toolu_0183n2LvWUY4Ckoxx9m2tTyq\",\"type\":\"tool_result\",\"content\":\"/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/action/search/TransportClearScrollAction.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/action/search/TransportClosePointInTimeAction.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/action/search/TransportMultiSearchAction.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/action/search/TransportOpenPointInTimeAction.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/action/search/TransportSearchAction.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/action/search/TransportSearchHelper.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/action/search/TransportSearchScrollAction.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/action/search/TransportSearchShardsAction.java\"}]},\"parent_tool_use_id\":\"toolu_01Ug4yyFVxfE3Bg3XBr7dBdP\",\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"99a4beb7-38cf-4e8c-9cb7-73b8bc9f1a91\"}\n{\"type\":\"assistant\",\"message\":{\"model\":\"claude-haiku-4-5-20251001\",\"id\":\"msg_01Cj1Xn3awCsnwVXsGJTSr9M\",\"type\":\"message\",\"role\":\"assistant\",\"content\":[{\"type\":\"tool_use\",\"id\":\"toolu_01AGmL3LYrP2b6WuxjYpXoTQ\",\"name\":\"Read\",\"input\":{\"file_path\":\"/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/rest/action/search/RestSearchAction.java\",\"limit\":100}}],\"stop_reason\":null,\"stop_sequence\":null,\"usage\":{\"input_tokens\":6,\"cache_creation_input_tokens\":1630,\"cache_read_input_tokens\":77514,\"cache_creation\":{\"ephemeral_5m_input_tokens\":1630,\"ephemeral_1h_input_tokens\":0},\"output_tokens\":1,\"service_tier\":\"standard\"}},\"parent_tool_use_id\":\"toolu_01Ug4yyFVxfE3Bg3XBr7dBdP\",\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"f62d32ab-3ad6-4565-9901-83a71fcad8da\"}\n{\"type\":\"assistant\",\"message\":{\"model\":\"claude-haiku-4-5-20251001\",\"id\":\"msg_01Cj1Xn3awCsnwVXsGJTSr9M\",\"type\":\"message\",\"role\":\"assistant\",\"content\":[{\"type\":\"tool_use\",\"id\":\"toolu_013WpH64SoneFqqe8Ux6gneK\",\"name\":\"Read\",\"input\":{\"file_path\":\"/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/action/search/SearchRequest.java\",\"limit\":100}}],\"stop_reason\":null,\"stop_sequence\":null,\"usage\":{\"input_tokens\":6,\"cache_creation_input_tokens\":1630,\"cache_read_input_tokens\":77514,\"cache_creation\":{\"ephemeral_5m_input_tokens\":1630,\"ephemeral_1h_input_tokens\":0},\"output_tokens\":1,\"service_tier\":\"standard\"}},\"parent_tool_use_id\":\"toolu_01Ug4yyFVxfE3Bg3XBr7dBdP\",\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"8de72a43-d226-4a57-894c-cb9c2cd01608\"}\n{\"type\":\"user\",\"message\":{\"role\":\"user\",\"content\":[{\"tool_use_id\":\"toolu_01AGmL3LYrP2b6WuxjYpXoTQ\",\"type\":\"tool_result\",\"content\":\"     1\u2192/*\\n     2\u2192 * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\\n     3\u2192 * or more contributor license agreements. Licensed under the \\\"Elastic License\\n     4\u2192 * 2.0\\\", the \\\"GNU Affero General Public License v3.0 only\\\", and the \\\"Server Side\\n     5\u2192 * Public License v 1\\\"; you may not use this file except in compliance with, at\\n     6\u2192 * your election, the \\\"Elastic License 2.0\\\", the \\\"GNU Affero General Public\\n     7\u2192 * License v3.0 only\\\", or the \\\"Server Side Public License, v 1\\\".\\n     8\u2192 */\\n     9\u2192\\n    10\u2192package org.elasticsearch.rest.action.search;\\n    11\u2192\\n    12\u2192import org.elasticsearch.ExceptionsHelper;\\n    13\u2192import org.elasticsearch.action.ActionRequestValidationException;\\n    14\u2192import org.elasticsearch.action.search.SearchRequest;\\n    15\u2192import org.elasticsearch.action.search.TransportSearchAction;\\n    16\u2192import org.elasticsearch.action.support.IndicesOptions;\\n    17\u2192import org.elasticsearch.client.internal.node.NodeClient;\\n    18\u2192import org.elasticsearch.common.Strings;\\n    19\u2192import org.elasticsearch.common.logging.DeprecationLogger;\\n    20\u2192import org.elasticsearch.core.Booleans;\\n    21\u2192import org.elasticsearch.core.Nullable;\\n    22\u2192import org.elasticsearch.features.NodeFeature;\\n    23\u2192import org.elasticsearch.index.query.QueryBuilder;\\n    24\u2192import org.elasticsearch.rest.BaseRestHandler;\\n    25\u2192import org.elasticsearch.rest.RestRequest;\\n    26\u2192import org.elasticsearch.rest.Scope;\\n    27\u2192import org.elasticsearch.rest.ServerlessScope;\\n    28\u2192import org.elasticsearch.rest.action.RestActions;\\n    29\u2192import org.elasticsearch.rest.action.RestCancellableNodeClient;\\n    30\u2192import org.elasticsearch.rest.action.RestRefCountedChunkedToXContentListener;\\n    31\u2192import org.elasticsearch.search.Scroll;\\n    32\u2192import org.elasticsearch.search.SearchService;\\n    33\u2192import org.elasticsearch.search.builder.SearchSourceBuilder;\\n    34\u2192import org.elasticsearch.search.fetch.StoredFieldsContext;\\n    35\u2192import org.elasticsearch.search.fetch.subphase.FetchSourceContext;\\n    36\u2192import org.elasticsearch.search.internal.SearchContext;\\n    37\u2192import org.elasticsearch.search.sort.SortOrder;\\n    38\u2192import org.elasticsearch.search.suggest.SuggestBuilder;\\n    39\u2192import org.elasticsearch.search.suggest.term.TermSuggestionBuilder;\\n    40\u2192import org.elasticsearch.usage.SearchUsageHolder;\\n    41\u2192import org.elasticsearch.xcontent.XContentParser;\\n    42\u2192\\n    43\u2192import java.io.IOException;\\n    44\u2192import java.util.Arrays;\\n    45\u2192import java.util.List;\\n    46\u2192import java.util.Locale;\\n    47\u2192import java.util.Set;\\n    48\u2192import java.util.function.IntConsumer;\\n    49\u2192import java.util.function.Predicate;\\n    50\u2192\\n    51\u2192import static org.elasticsearch.action.ValidateActions.addValidationError;\\n    52\u2192import static org.elasticsearch.core.TimeValue.parseTimeValue;\\n    53\u2192import static org.elasticsearch.rest.RestRequest.Method.GET;\\n    54\u2192import static org.elasticsearch.rest.RestRequest.Method.POST;\\n    55\u2192import static org.elasticsearch.search.suggest.SuggestBuilders.termSuggestion;\\n    56\u2192\\n    57\u2192@ServerlessScope(Scope.PUBLIC)\\n    58\u2192public class RestSearchAction extends BaseRestHandler {\\n    59\u2192    private static final DeprecationLogger deprecationLogger = DeprecationLogger.getLogger(RestSearchAction.class);\\n    60\u2192    public static final String TYPES_DEPRECATION_MESSAGE = \\\"[types removal] Specifying types in search requests is deprecated.\\\";\\n    61\u2192\\n    62\u2192    /**\\n    63\u2192     * Indicates whether hits.total should be rendered as an integer or an object\\n    64\u2192     * in the rest search response.\\n    65\u2192     */\\n    66\u2192    public static final String TOTAL_HITS_AS_INT_PARAM = \\\"rest_total_hits_as_int\\\";\\n    67\u2192    public static final String TYPED_KEYS_PARAM = \\\"typed_keys\\\";\\n    68\u2192    public static final String INCLUDE_NAMED_QUERIES_SCORE_PARAM = \\\"include_named_queries_score\\\";\\n    69\u2192    public static final Set<String> RESPONSE_PARAMS = Set.of(TYPED_KEYS_PARAM, TOTAL_HITS_AS_INT_PARAM, INCLUDE_NAMED_QUERIES_SCORE_PARAM);\\n    70\u2192\\n    71\u2192    private final SearchUsageHolder searchUsageHolder;\\n    72\u2192    private final Predicate<NodeFeature> clusterSupportsFeature;\\n    73\u2192\\n    74\u2192    public RestSearchAction(SearchUsageHolder searchUsageHolder, Predicate<NodeFeature> clusterSupportsFeature) {\\n    75\u2192        this.searchUsageHolder = searchUsageHolder;\\n    76\u2192        this.clusterSupportsFeature = clusterSupportsFeature;\\n    77\u2192    }\\n    78\u2192\\n    79\u2192    @Override\\n    80\u2192    public String getName() {\\n    81\u2192        return \\\"search_action\\\";\\n    82\u2192    }\\n    83\u2192\\n    84\u2192    @Override\\n    85\u2192    public List<Route> routes() {\\n    86\u2192        return List.of(\\n    87\u2192            new Route(GET, \\\"/_search\\\"),\\n    88\u2192            new Route(POST, \\\"/_search\\\"),\\n    89\u2192            new Route(GET, \\\"/{index}/_search\\\"),\\n    90\u2192            new Route(POST, \\\"/{index}/_search\\\")\\n    91\u2192        );\\n    92\u2192    }\\n    93\u2192\\n    94\u2192    @Override\\n    95\u2192    public Set<String> supportedCapabilities() {\\n    96\u2192        return SearchCapabilities.CAPABILITIES;\\n    97\u2192    }\\n    98\u2192\\n    99\u2192    @Override\\n   100\u2192    public RestChannelConsumer prepareRequest(final RestRequest request, final NodeClient client) throws IOException {\\n\\n<system-reminder>\\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\\n</system-reminder>\\n\"}]},\"parent_tool_use_id\":\"toolu_01Ug4yyFVxfE3Bg3XBr7dBdP\",\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"e5b2f788-5c73-4e89-a1f0-62af7fc6c63c\"}\n{\"type\":\"user\",\"message\":{\"role\":\"user\",\"content\":[{\"tool_use_id\":\"toolu_013WpH64SoneFqqe8Ux6gneK\",\"type\":\"tool_result\",\"content\":\"     1\u2192/*\\n     2\u2192 * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\\n     3\u2192 * or more contributor license agreements. Licensed under the \\\"Elastic License\\n     4\u2192 * 2.0\\\", the \\\"GNU Affero General Public License v3.0 only\\\", and the \\\"Server Side\\n     5\u2192 * Public License v 1\\\"; you may not use this file except in compliance with, at\\n     6\u2192 * your election, the \\\"Elastic License 2.0\\\", the \\\"GNU Affero General Public\\n     7\u2192 * License v3.0 only\\\", or the \\\"Server Side Public License, v 1\\\".\\n     8\u2192 */\\n     9\u2192\\n    10\u2192package org.elasticsearch.action.search;\\n    11\u2192\\n    12\u2192import org.elasticsearch.TransportVersions;\\n    13\u2192import org.elasticsearch.Version;\\n    14\u2192import org.elasticsearch.action.ActionRequest;\\n    15\u2192import org.elasticsearch.action.ActionRequestValidationException;\\n    16\u2192import org.elasticsearch.action.IndicesRequest;\\n    17\u2192import org.elasticsearch.action.support.IndicesOptions;\\n    18\u2192import org.elasticsearch.common.Strings;\\n    19\u2192import org.elasticsearch.common.io.stream.StreamInput;\\n    20\u2192import org.elasticsearch.common.io.stream.StreamOutput;\\n    21\u2192import org.elasticsearch.core.Nullable;\\n    22\u2192import org.elasticsearch.core.TimeValue;\\n    23\u2192import org.elasticsearch.index.mapper.SourceLoader;\\n    24\u2192import org.elasticsearch.index.query.QueryRewriteContext;\\n    25\u2192import org.elasticsearch.index.query.Rewriteable;\\n    26\u2192import org.elasticsearch.search.Scroll;\\n    27\u2192import org.elasticsearch.search.builder.PointInTimeBuilder;\\n    28\u2192import org.elasticsearch.search.builder.SearchSourceBuilder;\\n    29\u2192import org.elasticsearch.search.internal.SearchContext;\\n    30\u2192import org.elasticsearch.search.sort.FieldSortBuilder;\\n    31\u2192import org.elasticsearch.search.sort.SortBuilder;\\n    32\u2192import org.elasticsearch.search.sort.SortBuilders;\\n    33\u2192import org.elasticsearch.tasks.TaskId;\\n    34\u2192import org.elasticsearch.xcontent.ToXContent;\\n    35\u2192\\n    36\u2192import java.io.IOException;\\n    37\u2192import java.util.ArrayList;\\n    38\u2192import java.util.Arrays;\\n    39\u2192import java.util.Collections;\\n    40\u2192import java.util.List;\\n    41\u2192import java.util.Map;\\n    42\u2192import java.util.Objects;\\n    43\u2192\\n    44\u2192import static org.elasticsearch.action.ValidateActions.addValidationError;\\n    45\u2192\\n    46\u2192/**\\n    47\u2192 * A request to execute search against one or more indices (or all).\\n    48\u2192 * <p>\\n    49\u2192 * Note, the search {@link #source(org.elasticsearch.search.builder.SearchSourceBuilder)}\\n    50\u2192 * is required. The search source is the different search options, including aggregations and such.\\n    51\u2192 * </p>\\n    52\u2192 *\\n    53\u2192 * @see org.elasticsearch.client.internal.Client#search(SearchRequest)\\n    54\u2192 * @see SearchResponse\\n    55\u2192 */\\n    56\u2192public class SearchRequest extends ActionRequest implements IndicesRequest.Replaceable, Rewriteable<SearchRequest> {\\n    57\u2192\\n    58\u2192    public static final ToXContent.Params FORMAT_PARAMS = new ToXContent.MapParams(Collections.singletonMap(\\\"pretty\\\", \\\"false\\\"));\\n    59\u2192\\n    60\u2192    public static final int DEFAULT_PRE_FILTER_SHARD_SIZE = 128;\\n    61\u2192    public static final int DEFAULT_BATCHED_REDUCE_SIZE = 512;\\n    62\u2192\\n    63\u2192    private static final long DEFAULT_ABSOLUTE_START_MILLIS = -1;\\n    64\u2192\\n    65\u2192    private final String localClusterAlias;\\n    66\u2192    private final long absoluteStartMillis;\\n    67\u2192    private final boolean finalReduce;\\n    68\u2192\\n    69\u2192    private SearchType searchType = SearchType.DEFAULT;\\n    70\u2192\\n    71\u2192    private String[] indices = Strings.EMPTY_ARRAY;\\n    72\u2192\\n    73\u2192    @Nullable\\n    74\u2192    private String routing;\\n    75\u2192    @Nullable\\n    76\u2192    private String preference;\\n    77\u2192\\n    78\u2192    private SearchSourceBuilder source;\\n    79\u2192\\n    80\u2192    private Boolean requestCache;\\n    81\u2192\\n    82\u2192    private Boolean allowPartialSearchResults;\\n    83\u2192\\n    84\u2192    private Scroll scroll;\\n    85\u2192\\n    86\u2192    private int batchedReduceSize = DEFAULT_BATCHED_REDUCE_SIZE;\\n    87\u2192\\n    88\u2192    private int maxConcurrentShardRequests = 0;\\n    89\u2192    public static final int DEFAULT_MAX_CONCURRENT_SHARD_REQUESTS = 5;\\n    90\u2192\\n    91\u2192    private Integer preFilterShardSize;\\n    92\u2192\\n    93\u2192    private boolean ccsMinimizeRoundtrips;\\n    94\u2192\\n    95\u2192    public static final IndicesOptions DEFAULT_INDICES_OPTIONS = IndicesOptions.strictExpandOpenAndForbidClosedIgnoreThrottled();\\n    96\u2192\\n    97\u2192    private IndicesOptions indicesOptions = DEFAULT_INDICES_OPTIONS;\\n    98\u2192\\n    99\u2192    private Map<String, long[]> waitForCheckpoints = Collections.emptyMap();\\n   100\u2192\\n\\n<system-reminder>\\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\\n</system-reminder>\\n\"}]},\"parent_tool_use_id\":\"toolu_01Ug4yyFVxfE3Bg3XBr7dBdP\",\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"7117bc91-3995-4bfa-8803-5e7fb6c4ba89\"}\n{\"type\":\"assistant\",\"message\":{\"model\":\"claude-haiku-4-5-20251001\",\"id\":\"msg_01KkWNugwmtsnNFLWcG8iUNH\",\"type\":\"message\",\"role\":\"assistant\",\"content\":[{\"type\":\"tool_use\",\"id\":\"toolu_018hesXFWxcqnWx2VwtEt4EG\",\"name\":\"Bash\",\"input\":{\"command\":\"find /private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace -type f -name \\\"*.java\\\" -path \\\"*/search/*\\\" | grep -E \\\"(SearchSourceBuilder|RankBuilder|SubSearch)\\\" | head -20\",\"description\":\"List key search API files\"}}],\"stop_reason\":null,\"stop_sequence\":null,\"usage\":{\"input_tokens\":6,\"cache_creation_input_tokens\":3473,\"cache_read_input_tokens\":79144,\"cache_creation\":{\"ephemeral_5m_input_tokens\":3473,\"ephemeral_1h_input_tokens\":0},\"output_tokens\":4,\"service_tier\":\"standard\"}},\"parent_tool_use_id\":\"toolu_01Ug4yyFVxfE3Bg3XBr7dBdP\",\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"b5ba2a97-ce74-4364-ba33-65c973f1b2f3\"}\n{\"type\":\"user\",\"message\":{\"role\":\"user\",\"content\":[{\"tool_use_id\":\"toolu_018hesXFWxcqnWx2VwtEt4EG\",\"type\":\"tool_result\",\"content\":\"/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/test/framework/src/main/java/org/elasticsearch/search/rank/TestRankBuilder.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/test/java/org/elasticsearch/search/builder/SearchSourceBuilderTests.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/test/java/org/elasticsearch/search/builder/SubSearchSourceBuilderTests.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/search/internal/SubSearchContext.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/search/rank/RankBuilder.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/search/builder/SubSearchSourceBuilder.java\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/search/builder/SearchSourceBuilder.java\",\"is_error\":false}]},\"parent_tool_use_id\":\"toolu_01Ug4yyFVxfE3Bg3XBr7dBdP\",\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"bffe1d4b-ca5f-49a1-8017-38f234d5ff4f\"}\n{\"type\":\"user\",\"message\":{\"role\":\"user\",\"content\":[{\"tool_use_id\":\"toolu_01Ug4yyFVxfE3Bg3XBr7dBdP\",\"type\":\"tool_result\",\"content\":[{\"type\":\"text\",\"text\":\"Perfect! Now let me create a comprehensive summary of my findings:\\n\\n## Summary: Search API Files for Deprecation Warning Implementation\\n\\nBased on my thorough search of the codebase, I've identified all the key files where `rank` and `sub_searches` parameters are used in the Elasticsearch Search API. Here are the main files you'll need to modify to add deprecation warnings:\\n\\n### Primary API Files\\n\\n#### 1. **SearchSourceBuilder.java** (Core Parameter Handling)\\n**Path:** `/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/search/builder/SearchSourceBuilder.java`\\n\\nThis is the main file where both `rank` and `sub_searches` parameters are defined and processed. Key sections:\\n\\n- **Line 101:** `SUB_SEARCHES_FIELD = new ParseField(\\\"sub_searches\\\")`\\n- **Line 104:** `RANK_FIELD = new ParseField(\\\"rank\\\")`\\n- **Lines 153, 159:** Field declarations for `subSearchSourceBuilders` and `rankBuilder`\\n- **Lines 431-442:** Methods `subSearches()` and `subSearches(List<SubSearchSourceBuilder>)` - getter and setter\\n- **Lines 477-484:** Methods `rankBuilder()` and `rankBuilder(RankBuilder)` - getter and setter\\n- **Lines 1604-1623:** XContent parsing for `SUB_SEARCHES_FIELD` (START_ARRAY token handling)\\n- **Lines 1417-1435:** XContent parsing for `RANK_FIELD` (START_OBJECT token handling)\\n- **Lines 1672-1678:** XContent serialization of sub_searches and query fields\\n- **Lines 1694-1696:** XContent serialization of rank builder\\n- **Lines 2260-2262:** Validation requiring rank when sub_searches has 2+ entries\\n- **Lines 2267-2300:** Extensive validation logic for rank builder\\n\\n#### 2. **SubSearchSourceBuilder.java** (Sub-searches Implementation)\\n**Path:** `/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/search/builder/SubSearchSourceBuilder.java`\\n\\nThis class wraps individual query builders for multiple searches. Key sections:\\n\\n- **Lines 40-51:** PARSER definition with `QUERY_FIELD` handling\\n- **Lines 53-55:** `fromXContent()` parsing method\\n- **Lines 74-77:** Constructor for creating sub-searches\\n- **Lines 84-86:** Serialization via `writeTo()`\\n\\n#### 3. **RankBuilder.java** (Rank Implementation)\\n**Path:** `/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/search/rank/RankBuilder.java`\\n\\nAbstract base class for rank builders. This file defines the structure for ranking feature support.\\n\\n#### 4. **RestSearchAction.java** (REST Endpoint Handler)\\n**Path:** `/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/rest/action/search/RestSearchAction.java`\\n\\nThis is the REST endpoint handler for search requests. Key sections:\\n\\n- **Line 59:** DeprecationLogger already initialized\\n- **Line 100:** `prepareRequest()` method processes incoming requests\\n- Routes defined at lines 85-92 for /_search endpoints\\n\\n#### 5. **SearchRequest.java** (Search Request Container)\\n**Path:** `/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/action/search/SearchRequest.java`\\n\\nTop-level search request class that contains the SearchSourceBuilder.\\n\\n#### 6. **SearchRequestTests.java** (Test File with Usage Examples)\\n**Path:** `/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/test/java/org/elasticsearch/action/search/SearchRequestTests.java`\\n\\nContains tests that use both parameters. Key test sections:\\n\\n- **Lines 406-416:** Test for `sub_searches` requiring `rank` validation\\n- **Lines 400-416:** Example of multi-query usage\\n\\n### Test Files\\n\\n- **SubSearchSourceBuilderTests.java:** `/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/test/java/org/elasticsearch/search/builder/SubSearchSourceBuilderTests.java`\\n- **SearchSourceBuilderTests.java:** `/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/test/java/org/elasticsearch/search/builder/SearchSourceBuilderTests.java`\\n\\n### YAML Rest Test Files (Usage Examples)\\n\\nThe following files contain practical examples of how `rank` and `sub_searches` are used:\\n\\n- `/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/rank-rrf/src/yamlRestTest/resources/rest-api-spec/test/rrf/100_rank_rrf.yml`\\n- `/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/rank-rrf/src/yamlRestTest/resources/rest-api-spec/test/rrf/150_rank_rrf_pagination.yml`\\n- `/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/x-pack/plugin/rank-rrf/src/yamlRestTest/resources/rest-api-spec/test/rrf/550_rrf_sub_searches_explain.yml`\\n\\n### Key Implementation Points\\n\\n1. **Deprecation Logger Already Present:** `SearchSourceBuilder` already has a `DeprecationLogger` at line 94\\n2. **Parsing Entry Points:**\\n   - `parseXContent()` method in SearchSourceBuilder (lines 1292-1641) handles both parameters\\n3. **XContent Field Definitions:**\\n   - `SUB_SEARCHES_FIELD` (line 101)\\n   - `RANK_FIELD` (line 104)\\n4. **Validation Logic:** Lines 2260-2300 in SearchSourceBuilder handle validation requirements\\n\\n### Recommended Places to Add Deprecation Warnings\\n\\n1. **SearchSourceBuilder.parseXContent()** - Add warnings when parsing SUB_SEARCHES_FIELD (line 1604) and RANK_FIELD (line 1417)\\n2. **SearchSourceBuilder.subSearches(List)** - Add warning when setting sub-searches programmatically (line 431)\\n3. **SearchSourceBuilder.rankBuilder(RankBuilder)** - Add warning when setting rank builder programmatically (line 477)\\n4. **RestSearchAction** - If you want REST-specific warnings during request processing\\n\\nAll files are located in the `/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace` directory structure with proper package organization under `org.elasticsearch` packages.\"}]}]},\"parent_tool_use_id\":null,\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"552162bf-81cf-42ea-922b-ef12f9eb8cdb\"}\n{\"type\":\"assistant\",\"message\":{\"model\":\"claude-sonnet-4-5-20250929\",\"id\":\"msg_018DU3yMgTp9LLj8GfL7g7sh\",\"type\":\"message\",\"role\":\"assistant\",\"content\":[{\"type\":\"text\",\"text\":\"Now let me examine the main SearchSourceBuilder file to understand how to add the deprecation warnings:\"}],\"stop_reason\":null,\"stop_sequence\":null,\"usage\":{\"input_tokens\":4,\"cache_creation_input_tokens\":2241,\"cache_read_input_tokens\":15117,\"cache_creation\":{\"ephemeral_5m_input_tokens\":2241,\"ephemeral_1h_input_tokens\":0},\"output_tokens\":1,\"service_tier\":\"standard\"}},\"parent_tool_use_id\":null,\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"7fb0bdff-495c-43ef-8827-96b8caa6cf6c\"}\n{\"type\":\"assistant\",\"message\":{\"model\":\"claude-sonnet-4-5-20250929\",\"id\":\"msg_018DU3yMgTp9LLj8GfL7g7sh\",\"type\":\"message\",\"role\":\"assistant\",\"content\":[{\"type\":\"tool_use\",\"id\":\"toolu_016r7vgmQEX6RFnVuZZsL4fM\",\"name\":\"Read\",\"input\":{\"file_path\":\"/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/search/builder/SearchSourceBuilder.java\",\"offset\":90,\"limit\":50}}],\"stop_reason\":null,\"stop_sequence\":null,\"usage\":{\"input_tokens\":4,\"cache_creation_input_tokens\":2241,\"cache_read_input_tokens\":15117,\"cache_creation\":{\"ephemeral_5m_input_tokens\":2241,\"ephemeral_1h_input_tokens\":0},\"output_tokens\":1,\"service_tier\":\"standard\"}},\"parent_tool_use_id\":null,\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"0af9d0f2-35a8-48c7-8fbf-6dff4f48b65b\"}\n{\"type\":\"user\",\"message\":{\"role\":\"user\",\"content\":[{\"tool_use_id\":\"toolu_016r7vgmQEX6RFnVuZZsL4fM\",\"type\":\"tool_result\",\"content\":\"    90\u2192 *\\n    91\u2192 * @see SearchRequest#source(SearchSourceBuilder)\\n    92\u2192 */\\n    93\u2192public final class SearchSourceBuilder implements Writeable, ToXContentObject, Rewriteable<SearchSourceBuilder> {\\n    94\u2192    private static final DeprecationLogger deprecationLogger = DeprecationLogger.getLogger(SearchSourceBuilder.class);\\n    95\u2192\\n    96\u2192    public static final ParseField FROM_FIELD = new ParseField(\\\"from\\\");\\n    97\u2192    public static final ParseField SIZE_FIELD = new ParseField(\\\"size\\\");\\n    98\u2192    public static final ParseField TIMEOUT_FIELD = new ParseField(\\\"timeout\\\");\\n    99\u2192    public static final ParseField TERMINATE_AFTER_FIELD = new ParseField(\\\"terminate_after\\\");\\n   100\u2192    public static final ParseField QUERY_FIELD = new ParseField(\\\"query\\\");\\n   101\u2192    public static final ParseField SUB_SEARCHES_FIELD = new ParseField(\\\"sub_searches\\\");\\n   102\u2192    public static final ParseField POST_FILTER_FIELD = new ParseField(\\\"post_filter\\\");\\n   103\u2192    public static final ParseField KNN_FIELD = new ParseField(\\\"knn\\\");\\n   104\u2192    public static final ParseField RANK_FIELD = new ParseField(\\\"rank\\\");\\n   105\u2192    public static final ParseField MIN_SCORE_FIELD = new ParseField(\\\"min_score\\\");\\n   106\u2192    public static final ParseField VERSION_FIELD = new ParseField(\\\"version\\\");\\n   107\u2192    public static final ParseField SEQ_NO_PRIMARY_TERM_FIELD = new ParseField(\\\"seq_no_primary_term\\\");\\n   108\u2192    public static final ParseField EXPLAIN_FIELD = new ParseField(\\\"explain\\\");\\n   109\u2192    public static final ParseField _SOURCE_FIELD = new ParseField(\\\"_source\\\");\\n   110\u2192    public static final ParseField STORED_FIELDS_FIELD = new ParseField(\\\"stored_fields\\\");\\n   111\u2192    public static final ParseField DOCVALUE_FIELDS_FIELD = new ParseField(\\\"docvalue_fields\\\");\\n   112\u2192    public static final ParseField FETCH_FIELDS_FIELD = new ParseField(\\\"fields\\\");\\n   113\u2192    public static final ParseField SCRIPT_FIELDS_FIELD = new ParseField(\\\"script_fields\\\");\\n   114\u2192    public static final ParseField SCRIPT_FIELD = new ParseField(\\\"script\\\");\\n   115\u2192    public static final ParseField IGNORE_FAILURE_FIELD = new ParseField(\\\"ignore_failure\\\");\\n   116\u2192    public static final ParseField SORT_FIELD = new ParseField(\\\"sort\\\");\\n   117\u2192    public static final ParseField TRACK_SCORES_FIELD = new ParseField(\\\"track_scores\\\");\\n   118\u2192    public static final ParseField TRACK_TOTAL_HITS_FIELD = new ParseField(\\\"track_total_hits\\\");\\n   119\u2192    public static final ParseField INDICES_BOOST_FIELD = new ParseField(\\\"indices_boost\\\");\\n   120\u2192    public static final ParseField AGGREGATIONS_FIELD = new ParseField(\\\"aggregations\\\");\\n   121\u2192    public static final ParseField AGGS_FIELD = new ParseField(\\\"aggs\\\");\\n   122\u2192    public static final ParseField HIGHLIGHT_FIELD = new ParseField(\\\"highlight\\\");\\n   123\u2192    public static final ParseField SUGGEST_FIELD = new ParseField(\\\"suggest\\\");\\n   124\u2192    public static final ParseField RESCORE_FIELD = new ParseField(\\\"rescore\\\");\\n   125\u2192    public static final ParseField STATS_FIELD = new ParseField(\\\"stats\\\");\\n   126\u2192    public static final ParseField EXT_FIELD = new ParseField(\\\"ext\\\");\\n   127\u2192    public static final ParseField PROFILE_FIELD = new ParseField(\\\"profile\\\");\\n   128\u2192    public static final ParseField SEARCH_AFTER = new ParseField(\\\"search_after\\\");\\n   129\u2192    public static final ParseField COLLAPSE = new ParseField(\\\"collapse\\\");\\n   130\u2192    public static final ParseField SLICE = new ParseField(\\\"slice\\\");\\n   131\u2192    public static final ParseField POINT_IN_TIME = new ParseField(\\\"pit\\\");\\n   132\u2192    public static final ParseField RUNTIME_MAPPINGS_FIELD = new ParseField(\\\"runtime_mappings\\\");\\n   133\u2192    public static final ParseField RETRIEVER = new ParseField(\\\"retriever\\\");\\n   134\u2192\\n   135\u2192    private static final boolean RANK_SUPPORTED = Booleans.parseBoolean(System.getProperty(\\\"es.search.rank_supported\\\"), true);\\n   136\u2192\\n   137\u2192    /**\\n   138\u2192     * A static factory method to construct a new search source.\\n   139\u2192     */\\n\\n<system-reminder>\\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\\n</system-reminder>\\n\"}]},\"parent_tool_use_id\":null,\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"f0aeda88-697c-428a-9ccb-39f80e9bf07e\"}\n{\"type\":\"assistant\",\"message\":{\"model\":\"claude-sonnet-4-5-20250929\",\"id\":\"msg_01Pbk2ah9s7ae5VNFiJC9Kge\",\"type\":\"message\",\"role\":\"assistant\",\"content\":[{\"type\":\"tool_use\",\"id\":\"toolu_016BLjzMWe1QW6mVnesQiJhi\",\"name\":\"Read\",\"input\":{\"file_path\":\"/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/search/builder/SearchSourceBuilder.java\",\"offset\":1410,\"limit\":40}}],\"stop_reason\":null,\"stop_sequence\":null,\"usage\":{\"input_tokens\":4,\"cache_creation_input_tokens\":1357,\"cache_read_input_tokens\":17358,\"cache_creation\":{\"ephemeral_5m_input_tokens\":1357,\"ephemeral_1h_input_tokens\":0},\"output_tokens\":25,\"service_tier\":\"standard\"}},\"parent_tool_use_id\":null,\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"1b2dc717-4898-4164-8a55-d67bf076ba21\"}\n{\"type\":\"user\",\"message\":{\"role\":\"user\",\"content\":[{\"tool_use_id\":\"toolu_016BLjzMWe1QW6mVnesQiJhi\",\"type\":\"tool_result\",\"content\":\"  1410\u2192                    searchUsage.trackSectionUsage(QUERY_FIELD.getPreferredName());\\n  1411\u2192                } else if (POST_FILTER_FIELD.match(currentFieldName, parser.getDeprecationHandler())) {\\n  1412\u2192                    postQueryBuilder = parseTopLevelQuery(parser, searchUsage::trackQueryUsage);\\n  1413\u2192                    searchUsage.trackSectionUsage(POST_FILTER_FIELD.getPreferredName());\\n  1414\u2192                } else if (KNN_FIELD.match(currentFieldName, parser.getDeprecationHandler())) {\\n  1415\u2192                    knnBuilders = List.of(KnnSearchBuilder.fromXContent(parser));\\n  1416\u2192                    searchUsage.trackSectionUsage(KNN_FIELD.getPreferredName());\\n  1417\u2192                } else if (RANK_FIELD.match(currentFieldName, parser.getDeprecationHandler())) {\\n  1418\u2192                    if (RANK_SUPPORTED == false) {\\n  1419\u2192                        throwUnknownKey(parser, token, currentFieldName);\\n  1420\u2192                    }\\n  1421\u2192                    if (parser.nextToken() != XContentParser.Token.FIELD_NAME) {\\n  1422\u2192                        throw new ParsingException(\\n  1423\u2192                            parser.getTokenLocation(),\\n  1424\u2192                            \\\"expected a rank name, but found token [\\\" + token + \\\"] for [\\\" + RANK_FIELD.getPreferredName() + \\\"]\\\"\\n  1425\u2192                        );\\n  1426\u2192                    }\\n  1427\u2192                    rankBuilder = parser.namedObject(RankBuilder.class, parser.currentName(), null);\\n  1428\u2192                    if (parser.currentToken() != XContentParser.Token.END_OBJECT) {\\n  1429\u2192                        throw new ParsingException(\\n  1430\u2192                            parser.getTokenLocation(),\\n  1431\u2192                            \\\"expected token '}', but found token [\\\" + token + \\\"] for [\\\" + RANK_FIELD.getPreferredName() + \\\"]\\\"\\n  1432\u2192                        );\\n  1433\u2192                    }\\n  1434\u2192                    parser.nextToken();\\n  1435\u2192                    searchUsage.trackSectionUsage(\\\"rank_\\\" + rankBuilder.getWriteableName());\\n  1436\u2192                } else if (_SOURCE_FIELD.match(currentFieldName, parser.getDeprecationHandler())) {\\n  1437\u2192                    fetchSourceContext = FetchSourceContext.fromXContent(parser);\\n  1438\u2192                    if (fetchSourceContext.fetchSource() == false\\n  1439\u2192                        || fetchSourceContext.includes().length > 0\\n  1440\u2192                        || fetchSourceContext.excludes().length > 0) {\\n  1441\u2192                        searchUsage.trackSectionUsage(_SOURCE_FIELD.getPreferredName());\\n  1442\u2192                    }\\n  1443\u2192                } else if (SCRIPT_FIELDS_FIELD.match(currentFieldName, parser.getDeprecationHandler())) {\\n  1444\u2192                    scriptFields = new ArrayList<>();\\n  1445\u2192                    while ((parser.nextToken()) != XContentParser.Token.END_OBJECT) {\\n  1446\u2192                        scriptFields.add(new ScriptField(parser));\\n  1447\u2192                    }\\n  1448\u2192                    searchUsage.trackSectionUsage(SCRIPT_FIELDS_FIELD.getPreferredName());\\n  1449\u2192                } else if (AGGREGATIONS_FIELD.match(currentFieldName, parser.getDeprecationHandler())\\n\\n<system-reminder>\\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\\n</system-reminder>\\n\"}]},\"parent_tool_use_id\":null,\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"f73bf769-3891-4fdf-b787-5ea694c92b5c\"}\n{\"type\":\"assistant\",\"message\":{\"model\":\"claude-sonnet-4-5-20250929\",\"id\":\"msg_01KL2NKiZB4LTgHH918t6L6e\",\"type\":\"message\",\"role\":\"assistant\",\"content\":[{\"type\":\"tool_use\",\"id\":\"toolu_01TqrkUPd728FMDyNLXCRNYs\",\"name\":\"Read\",\"input\":{\"file_path\":\"/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/search/builder/SearchSourceBuilder.java\",\"offset\":1600,\"limit\":40}}],\"stop_reason\":null,\"stop_sequence\":null,\"usage\":{\"input_tokens\":4,\"cache_creation_input_tokens\":1141,\"cache_read_input_tokens\":18715,\"cache_creation\":{\"ephemeral_5m_input_tokens\":1141,\"ephemeral_1h_input_tokens\":0},\"output_tokens\":24,\"service_tier\":\"standard\"}},\"parent_tool_use_id\":null,\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"b557590a-a02e-4dff-9487-1555c942565a\"}\n{\"type\":\"user\",\"message\":{\"role\":\"user\",\"content\":[{\"tool_use_id\":\"toolu_01TqrkUPd728FMDyNLXCRNYs\",\"type\":\"tool_result\",\"content\":\"  1600\u2192                            );\\n  1601\u2192                        }\\n  1602\u2192                    }\\n  1603\u2192                    searchUsage.trackSectionUsage(KNN_FIELD.getPreferredName());\\n  1604\u2192                } else if (SUB_SEARCHES_FIELD.match(currentFieldName, parser.getDeprecationHandler())) {\\n  1605\u2192                    if (RANK_SUPPORTED == false) {\\n  1606\u2192                        throwUnknownKey(parser, token, currentFieldName);\\n  1607\u2192                    }\\n  1608\u2192                    if (subSearchSourceBuilders.isEmpty() == false) {\\n  1609\u2192                        throw new IllegalArgumentException(\\n  1610\u2192                            \\\"cannot specify field [\\\" + currentFieldName + \\\"] and field [\\\" + QUERY_FIELD.getPreferredName() + \\\"]\\\"\\n  1611\u2192                        );\\n  1612\u2192                    }\\n  1613\u2192                    while ((token = parser.nextToken()) != XContentParser.Token.END_ARRAY) {\\n  1614\u2192                        if (token == XContentParser.Token.START_OBJECT) {\\n  1615\u2192                            subSearchSourceBuilders.add(SubSearchSourceBuilder.fromXContent(parser, searchUsage));\\n  1616\u2192                        } else {\\n  1617\u2192                            throw new XContentParseException(\\n  1618\u2192                                parser.getTokenLocation(),\\n  1619\u2192                                \\\"malformed query within the [sub_searches] field; found \\\" + token\\n  1620\u2192                            );\\n  1621\u2192                        }\\n  1622\u2192                    }\\n  1623\u2192                    searchUsage.trackSectionUsage(SUB_SEARCHES_FIELD.getPreferredName());\\n  1624\u2192                } else {\\n  1625\u2192                    throwUnknownKey(parser, token, currentFieldName);\\n  1626\u2192                }\\n  1627\u2192            } else {\\n  1628\u2192                throwUnknownKey(parser, token, currentFieldName);\\n  1629\u2192            }\\n  1630\u2192        }\\n  1631\u2192        if (checkTrailingTokens) {\\n  1632\u2192            token = parser.nextToken();\\n  1633\u2192            if (token != null) {\\n  1634\u2192                throw new ParsingException(parser.getTokenLocation(), \\\"Unexpected token [\\\" + token + \\\"] found after the main object.\\\");\\n  1635\u2192            }\\n  1636\u2192        }\\n  1637\u2192\\n  1638\u2192        knnSearch = knnBuilders.stream().map(knnBuilder -> knnBuilder.build(size())).collect(Collectors.toList());\\n  1639\u2192        searchUsageConsumer.accept(searchUsage);\\n\\n<system-reminder>\\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\\n</system-reminder>\\n\"}]},\"parent_tool_use_id\":null,\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"63d03ddc-9c6f-4a12-be9e-09c6b7b7c38a\"}\n{\"type\":\"assistant\",\"message\":{\"model\":\"claude-sonnet-4-5-20250929\",\"id\":\"msg_01Pmp35ZrJPCaA1dpaKKVuYR\",\"type\":\"message\",\"role\":\"assistant\",\"content\":[{\"type\":\"text\",\"text\":\"Now let me check the setter methods to see where else we need to add warnings:\"}],\"stop_reason\":null,\"stop_sequence\":null,\"usage\":{\"input_tokens\":4,\"cache_creation_input_tokens\":906,\"cache_read_input_tokens\":19856,\"cache_creation\":{\"ephemeral_5m_input_tokens\":906,\"ephemeral_1h_input_tokens\":0},\"output_tokens\":1,\"service_tier\":\"standard\"}},\"parent_tool_use_id\":null,\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"78f37e59-9f4d-410f-bf09-5ae1a556ee6d\"}\n{\"type\":\"assistant\",\"message\":{\"model\":\"claude-sonnet-4-5-20250929\",\"id\":\"msg_01Pmp35ZrJPCaA1dpaKKVuYR\",\"type\":\"message\",\"role\":\"assistant\",\"content\":[{\"type\":\"tool_use\",\"id\":\"toolu_016kWmfExTuN4VmjbLRdSFCz\",\"name\":\"Read\",\"input\":{\"file_path\":\"/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/search/builder/SearchSourceBuilder.java\",\"offset\":425,\"limit\":70}}],\"stop_reason\":null,\"stop_sequence\":null,\"usage\":{\"input_tokens\":4,\"cache_creation_input_tokens\":906,\"cache_read_input_tokens\":19856,\"cache_creation\":{\"ephemeral_5m_input_tokens\":906,\"ephemeral_1h_input_tokens\":0},\"output_tokens\":1,\"service_tier\":\"standard\"}},\"parent_tool_use_id\":null,\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"28e137e9-596c-4fef-8056-77cfc9b581b9\"}\n{\"type\":\"user\",\"message\":{\"role\":\"user\",\"content\":[{\"tool_use_id\":\"toolu_016kWmfExTuN4VmjbLRdSFCz\",\"type\":\"tool_result\",\"content\":\"   425\u2192        }\\n   426\u2192    }\\n   427\u2192\\n   428\u2192    /**\\n   429\u2192     * Sets the sub searches for this request.\\n   430\u2192     */\\n   431\u2192    public SearchSourceBuilder subSearches(List<SubSearchSourceBuilder> subSearchSourceBuilders) {\\n   432\u2192        Objects.requireNonNull(subSearchSourceBuilders);\\n   433\u2192        this.subSearchSourceBuilders = subSearchSourceBuilders;\\n   434\u2192        return this;\\n   435\u2192    }\\n   436\u2192\\n   437\u2192    /**\\n   438\u2192     * Gets the sub searches for this request.\\n   439\u2192     */\\n   440\u2192    public List<SubSearchSourceBuilder> subSearches() {\\n   441\u2192        return subSearchSourceBuilders;\\n   442\u2192    }\\n   443\u2192\\n   444\u2192    /**\\n   445\u2192     * Sets a filter that will be executed after the query has been executed and\\n   446\u2192     * only has affect on the search hits (not aggregations). This filter is\\n   447\u2192     * always executed as last filtering mechanism.\\n   448\u2192     */\\n   449\u2192    public SearchSourceBuilder postFilter(QueryBuilder postFilter) {\\n   450\u2192        this.postQueryBuilder = postFilter;\\n   451\u2192        return this;\\n   452\u2192    }\\n   453\u2192\\n   454\u2192    /**\\n   455\u2192     * Gets the post filter for this request\\n   456\u2192     */\\n   457\u2192    public QueryBuilder postFilter() {\\n   458\u2192        return postQueryBuilder;\\n   459\u2192    }\\n   460\u2192\\n   461\u2192    /**\\n   462\u2192     * Defines a kNN search. If a query is also provided, the kNN hits\\n   463\u2192     * are combined with the query hits.\\n   464\u2192     */\\n   465\u2192    public SearchSourceBuilder knnSearch(List<KnnSearchBuilder> knnSearch) {\\n   466\u2192        this.knnSearch = Objects.requireNonNull(knnSearch);\\n   467\u2192        return this;\\n   468\u2192    }\\n   469\u2192\\n   470\u2192    /**\\n   471\u2192     * An optional kNN search definition.\\n   472\u2192     */\\n   473\u2192    public List<KnnSearchBuilder> knnSearch() {\\n   474\u2192        return Collections.unmodifiableList(knnSearch);\\n   475\u2192    }\\n   476\u2192\\n   477\u2192    public SearchSourceBuilder rankBuilder(RankBuilder rankBuilder) {\\n   478\u2192        this.rankBuilder = rankBuilder;\\n   479\u2192        return this;\\n   480\u2192    }\\n   481\u2192\\n   482\u2192    public RankBuilder rankBuilder() {\\n   483\u2192        return rankBuilder;\\n   484\u2192    }\\n   485\u2192\\n   486\u2192    /**\\n   487\u2192     * From index to start the search from. Defaults to {@code 0}.\\n   488\u2192     * Must be a positive value or 0.\\n   489\u2192     */\\n   490\u2192    public SearchSourceBuilder from(int from) {\\n   491\u2192        if (from < 0) {\\n   492\u2192            throw new IllegalArgumentException(\\\"[from] parameter cannot be negative but was [\\\" + from + \\\"]\\\");\\n   493\u2192        }\\n   494\u2192        this.from = from;\\n\\n<system-reminder>\\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\\n</system-reminder>\\n\"}]},\"parent_tool_use_id\":null,\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"ffd9b967-c3ad-4057-bf92-80089a425c93\"}\n{\"type\":\"assistant\",\"message\":{\"model\":\"claude-sonnet-4-5-20250929\",\"id\":\"msg_01TwPpb8LE9utvvBM7chKX6M\",\"type\":\"message\",\"role\":\"assistant\",\"content\":[{\"type\":\"text\",\"text\":\"Let me look at examples of how deprecation warnings are used elsewhere in the codebase:\"}],\"stop_reason\":null,\"stop_sequence\":null,\"usage\":{\"input_tokens\":3,\"cache_creation_input_tokens\":1104,\"cache_read_input_tokens\":20762,\"cache_creation\":{\"ephemeral_5m_input_tokens\":1104,\"ephemeral_1h_input_tokens\":0},\"output_tokens\":3,\"service_tier\":\"standard\"}},\"parent_tool_use_id\":null,\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"48a743d0-ff71-4339-9629-ebd0f510c9a5\"}\n{\"type\":\"assistant\",\"message\":{\"model\":\"claude-sonnet-4-5-20250929\",\"id\":\"msg_01TwPpb8LE9utvvBM7chKX6M\",\"type\":\"message\",\"role\":\"assistant\",\"content\":[{\"type\":\"tool_use\",\"id\":\"toolu_01EVpQp8LCSYWnFHPAHbvp1P\",\"name\":\"Grep\",\"input\":{\"pattern\":\"deprecationLogger\\\\.(critical|warn)\",\"path\":\"/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/search/builder\",\"output_mode\":\"content\",\"-n\":true,\"-B\":2,\"-A\":2}}],\"stop_reason\":null,\"stop_sequence\":null,\"usage\":{\"input_tokens\":3,\"cache_creation_input_tokens\":1104,\"cache_read_input_tokens\":20762,\"cache_creation\":{\"ephemeral_5m_input_tokens\":1104,\"ephemeral_1h_input_tokens\":0},\"output_tokens\":230,\"service_tier\":\"standard\"}},\"parent_tool_use_id\":null,\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"dba28522-df00-436d-a273-725b727d909c\"}\n{\"type\":\"user\",\"message\":{\"role\":\"user\",\"content\":[{\"tool_use_id\":\"toolu_01EVpQp8LCSYWnFHPAHbvp1P\",\"type\":\"tool_result\",\"content\":\"No matches found\"}]},\"parent_tool_use_id\":null,\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"5d015aa0-5c3d-426c-863d-2b252d862a63\"}\n{\"type\":\"assistant\",\"message\":{\"model\":\"claude-sonnet-4-5-20250929\",\"id\":\"msg_01NJc3X5gh5s8bc9bbrR3baR\",\"type\":\"message\",\"role\":\"assistant\",\"content\":[{\"type\":\"text\",\"text\":\"Let me check a broader area to see how deprecation warnings are typically implemented:\"}],\"stop_reason\":null,\"stop_sequence\":null,\"usage\":{\"input_tokens\":3,\"cache_creation_input_tokens\":245,\"cache_read_input_tokens\":21866,\"cache_creation\":{\"ephemeral_5m_input_tokens\":245,\"ephemeral_1h_input_tokens\":0},\"output_tokens\":5,\"service_tier\":\"standard\"}},\"parent_tool_use_id\":null,\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"b7720336-7071-4f74-a63e-3743f9de6158\"}\n{\"type\":\"assistant\",\"message\":{\"model\":\"claude-sonnet-4-5-20250929\",\"id\":\"msg_01NJc3X5gh5s8bc9bbrR3baR\",\"type\":\"message\",\"role\":\"assistant\",\"content\":[{\"type\":\"tool_use\",\"id\":\"toolu_01JukAo7AZCbdawW2yXu9cdT\",\"name\":\"Grep\",\"input\":{\"pattern\":\"deprecationLogger\\\\.(critical|warn)\",\"path\":\"/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch\",\"output_mode\":\"content\",\"-n\":true,\"head_limit\":20}}],\"stop_reason\":null,\"stop_sequence\":null,\"usage\":{\"input_tokens\":3,\"cache_creation_input_tokens\":245,\"cache_read_input_tokens\":21866,\"cache_creation\":{\"ephemeral_5m_input_tokens\":245,\"ephemeral_1h_input_tokens\":0},\"output_tokens\":5,\"service_tier\":\"standard\"}},\"parent_tool_use_id\":null,\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"bc4ef5f7-d18a-410c-8cb4-d2fee0f73d3c\"}\n{\"type\":\"user\",\"message\":{\"role\":\"user\",\"content\":[{\"tool_use_id\":\"toolu_01JukAo7AZCbdawW2yXu9cdT\",\"type\":\"tool_result\",\"content\":\"/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/node/NodeConstruction.java:433:            deprecationLogger.warn(\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/node/NodeConstruction.java:442:            deprecationLogger.warn(\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/node/NodeConstruction.java:451:            deprecationLogger.warn(\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/ingest/IngestService.java:679:            deprecationLogger.critical(DeprecationCategory.API, \\\"pipeline_name_special_chars\\\", e.getMessage());\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/ingest/ConditionalProcessor.java:44:        deprecationLogger.warn(\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/cluster/metadata/MetadataCreateIndexService.java:205:                deprecationLogger.warn(\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/cluster/metadata/MetadataCreateIndexService.java:432:                    deprecationLogger.warn(\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/cluster/metadata/MetadataCreateIndexService.java:1693:            deprecationLogger.warn(\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/cluster/metadata/MetadataCreateIndexService.java:1705:            deprecationLogger.warn(\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/cluster/metadata/MetadataIndexTemplateService.java:764:                ct -> deprecationLogger.warn(\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/cluster/metadata/MetadataIndexTemplateService.java:787:                p -> deprecationLogger.warn(\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/cluster/metadata/IndexNameExpressionResolver.java:537:            deprecationLogger.warn(\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/rest/action/admin/indices/RestCloseIndexAction.java:58:            deprecationLogger.warn(\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/plugins/PluginsService.java:612:                deprecationLogger.warn(\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/plugins/PluginsService.java:625:                deprecationLogger.warn(\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/indices/analysis/AnalysisModule.java:142:                    deprecationLogger.warn(\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/indices/analysis/AnalysisModule.java:207:                deprecationLogger.warn(\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestClusterRerouteAction.java:102:                    deprecationLogger.critical(DeprecationCategory.API, \\\"cluster-reroute-metric-param\\\", METRIC_DEPRECATION_MESSAGE);\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/index/mapper/ProvidedIdFieldMapper.java:99:                    deprecationLogger.warn(DeprecationCategory.AGGREGATIONS, \\\"id_field_data\\\", ID_FIELD_DATA_DEPRECATION_MESSAGE);\\n/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/action/admin/indices/alias/get/TransportGetAliasesAction.java:180:            deprecationLogger.warn(\"}]},\"parent_tool_use_id\":null,\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"59ea2c4d-a0ec-4f9a-8283-5875f436c251\"}\n{\"type\":\"assistant\",\"message\":{\"model\":\"claude-sonnet-4-5-20250929\",\"id\":\"msg_01XcH2fzVRqropqbn5b6382Y\",\"type\":\"message\",\"role\":\"assistant\",\"content\":[{\"type\":\"text\",\"text\":\"Let me look at one of those examples to understand the pattern:\"}],\"stop_reason\":null,\"stop_sequence\":null,\"usage\":{\"input_tokens\":2,\"cache_creation_input_tokens\":2024,\"cache_read_input_tokens\":22111,\"cache_creation\":{\"ephemeral_5m_input_tokens\":2024,\"ephemeral_1h_input_tokens\":0},\"output_tokens\":3,\"service_tier\":\"standard\"}},\"parent_tool_use_id\":null,\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"54bcc2c9-0def-4ed7-9280-dabc039485c0\"}\n{\"type\":\"assistant\",\"message\":{\"model\":\"claude-sonnet-4-5-20250929\",\"id\":\"msg_01XcH2fzVRqropqbn5b6382Y\",\"type\":\"message\",\"role\":\"assistant\",\"content\":[{\"type\":\"tool_use\",\"id\":\"toolu_015HmnNizogpdh7CQUcnEiPm\",\"name\":\"Read\",\"input\":{\"file_path\":\"/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/ingest/IngestService.java\",\"offset\":675,\"limit\":10}}],\"stop_reason\":null,\"stop_sequence\":null,\"usage\":{\"input_tokens\":2,\"cache_creation_input_tokens\":2024,\"cache_read_input_tokens\":22111,\"cache_creation\":{\"ephemeral_5m_input_tokens\":2024,\"ephemeral_1h_input_tokens\":0},\"output_tokens\":3,\"service_tier\":\"standard\"}},\"parent_tool_use_id\":null,\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"9a4f3731-8b83-446f-88d5-eea066759f39\"}\n{\"type\":\"user\",\"message\":{\"role\":\"user\",\"content\":[{\"tool_use_id\":\"toolu_015HmnNizogpdh7CQUcnEiPm\",\"type\":\"tool_result\",\"content\":\"   675\u2192                    \\\"Pipeline name [\\\" + pipelineName + \\\"] will be disallowed in a future version for the following reason: \\\" + error\\n   676\u2192                )\\n   677\u2192            );\\n   678\u2192        } catch (IllegalArgumentException e) {\\n   679\u2192            deprecationLogger.critical(DeprecationCategory.API, \\\"pipeline_name_special_chars\\\", e.getMessage());\\n   680\u2192        }\\n   681\u2192\\n   682\u2192        Pipeline pipeline = Pipeline.create(pipelineId, pipelineConfig, processorFactories, scriptService);\\n   683\u2192        List<Exception> exceptions = new ArrayList<>();\\n   684\u2192        for (Processor processor : pipeline.flattenAllProcessors()) {\\n\\n<system-reminder>\\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\\n</system-reminder>\\n\"}]},\"parent_tool_use_id\":null,\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"08ffa867-c062-4dcc-9593-33c2465e66ce\"}\n{\"type\":\"assistant\",\"message\":{\"model\":\"claude-sonnet-4-5-20250929\",\"id\":\"msg_01EVdHifLk8bWfWaf843ofaj\",\"type\":\"message\",\"role\":\"assistant\",\"content\":[{\"type\":\"tool_use\",\"id\":\"toolu_01HxR2YUMyRsxdBThUPgw4G2\",\"name\":\"Read\",\"input\":{\"file_path\":\"/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestClusterRerouteAction.java\",\"offset\":95,\"limit\":15}}],\"stop_reason\":null,\"stop_sequence\":null,\"usage\":{\"input_tokens\":2,\"cache_creation_input_tokens\":426,\"cache_read_input_tokens\":24135,\"cache_creation\":{\"ephemeral_5m_input_tokens\":426,\"ephemeral_1h_input_tokens\":0},\"output_tokens\":24,\"service_tier\":\"standard\"}},\"parent_tool_use_id\":null,\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"62001930-80ed-49de-bc86-6c6c34bd02c8\"}\n{\"type\":\"user\",\"message\":{\"role\":\"user\",\"content\":[{\"tool_use_id\":\"toolu_01HxR2YUMyRsxdBThUPgw4G2\",\"type\":\"tool_result\",\"content\":\"    95\u2192            request.params().put(\\\"explain\\\", Boolean.TRUE.toString());\\n    96\u2192        }\\n    97\u2192\\n    98\u2192        switch (request.getRestApiVersion()) {\\n    99\u2192            case V_9 -> {\\n   100\u2192                // always avoid returning the cluster state by forcing `?metric=none`; emit a warning if `?metric` is even present\\n   101\u2192                if (request.hasParam(\\\"metric\\\")) {\\n   102\u2192                    deprecationLogger.critical(DeprecationCategory.API, \\\"cluster-reroute-metric-param\\\", METRIC_DEPRECATION_MESSAGE);\\n   103\u2192                }\\n   104\u2192                request.params().put(\\\"metric\\\", \\\"none\\\");\\n   105\u2192            }\\n   106\u2192            case V_8, V_7 -> {\\n   107\u2192                // by default, return everything but metadata\\n   108\u2192                final String metric = request.param(\\\"metric\\\");\\n   109\u2192                if (metric == null) {\\n\\n<system-reminder>\\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\\n</system-reminder>\\n\"}]},\"parent_tool_use_id\":null,\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"f700147b-2b5c-41d4-9b52-ca98456da978\"}\n{\"type\":\"assistant\",\"message\":{\"model\":\"claude-sonnet-4-5-20250929\",\"id\":\"msg_01CcKbAFBuH79UcHqRp4svKN\",\"type\":\"message\",\"role\":\"assistant\",\"content\":[{\"type\":\"text\",\"text\":\"Now let me check the DeprecationCategory enum to see what categories are available:\"}],\"stop_reason\":null,\"stop_sequence\":null,\"usage\":{\"input_tokens\":1,\"cache_creation_input_tokens\":571,\"cache_read_input_tokens\":24561,\"cache_creation\":{\"ephemeral_5m_input_tokens\":571,\"ephemeral_1h_input_tokens\":0},\"output_tokens\":1,\"service_tier\":\"standard\"}},\"parent_tool_use_id\":null,\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"c438ae7d-771f-4c15-819c-810428972273\"}\n{\"type\":\"assistant\",\"message\":{\"model\":\"claude-sonnet-4-5-20250929\",\"id\":\"msg_01CcKbAFBuH79UcHqRp4svKN\",\"type\":\"message\",\"role\":\"assistant\",\"content\":[{\"type\":\"tool_use\",\"id\":\"toolu_01YcLufz3EpmNkotPhd2kF3h\",\"name\":\"Bash\",\"input\":{\"command\":\"find /private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace -name \\\"DeprecationCategory.java\\\" -type f\",\"description\":\"Find DeprecationCategory file\"}}],\"stop_reason\":null,\"stop_sequence\":null,\"usage\":{\"input_tokens\":1,\"cache_creation_input_tokens\":571,\"cache_read_input_tokens\":24561,\"cache_creation\":{\"ephemeral_5m_input_tokens\":571,\"ephemeral_1h_input_tokens\":0},\"output_tokens\":1,\"service_tier\":\"standard\"}},\"parent_tool_use_id\":null,\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"be63909a-7890-4935-a8b6-a439e59912f2\"}\n{\"type\":\"user\",\"message\":{\"role\":\"user\",\"content\":[{\"tool_use_id\":\"toolu_01YcLufz3EpmNkotPhd2kF3h\",\"type\":\"tool_result\",\"content\":\"/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/common/logging/DeprecationCategory.java\",\"is_error\":false}]},\"parent_tool_use_id\":null,\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"b37ce34d-c532-442e-bd1d-293207a40604\"}\n{\"type\":\"assistant\",\"message\":{\"model\":\"claude-sonnet-4-5-20250929\",\"id\":\"msg_01RhMLqNo5wHRjVPtgvKEUDn\",\"type\":\"message\",\"role\":\"assistant\",\"content\":[{\"type\":\"tool_use\",\"id\":\"toolu_01W5tJdxeNkiex8G4xkLJH7K\",\"name\":\"Read\",\"input\":{\"file_path\":\"/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/common/logging/DeprecationCategory.java\"}}],\"stop_reason\":null,\"stop_sequence\":null,\"usage\":{\"input_tokens\":1,\"cache_creation_input_tokens\":235,\"cache_read_input_tokens\":25132,\"cache_creation\":{\"ephemeral_5m_input_tokens\":235,\"ephemeral_1h_input_tokens\":0},\"output_tokens\":24,\"service_tier\":\"standard\"}},\"parent_tool_use_id\":null,\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"7a3cff8e-4a8d-4177-b0e5-71685613831c\"}\n{\"type\":\"user\",\"message\":{\"role\":\"user\",\"content\":[{\"tool_use_id\":\"toolu_01W5tJdxeNkiex8G4xkLJH7K\",\"type\":\"tool_result\",\"content\":\"     1\u2192/*\\n     2\u2192 * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\\n     3\u2192 * or more contributor license agreements. Licensed under the \\\"Elastic License\\n     4\u2192 * 2.0\\\", the \\\"GNU Affero General Public License v3.0 only\\\", and the \\\"Server Side\\n     5\u2192 * Public License v 1\\\"; you may not use this file except in compliance with, at\\n     6\u2192 * your election, the \\\"Elastic License 2.0\\\", the \\\"GNU Affero General Public\\n     7\u2192 * License v3.0 only\\\", or the \\\"Server Side Public License, v 1\\\".\\n     8\u2192 */\\n     9\u2192\\n    10\u2192package org.elasticsearch.common.logging;\\n    11\u2192\\n    12\u2192/**\\n    13\u2192 * Deprecation log messages are categorised so that consumers of the logs can easily aggregate them.\\n    14\u2192 * <p>\\n    15\u2192 * When categorising a message, you should consider the impact of the work required to mitigate the\\n    16\u2192 * deprecation. For example, a settings change would normally be categorised as {@link #SETTINGS},\\n    17\u2192 * but if the setting in question was related to security configuration, it may be more appropriate\\n    18\u2192 * to categorise the deprecation message as {@link #SECURITY}.\\n    19\u2192 */\\n    20\u2192public enum DeprecationCategory {\\n    21\u2192    AGGREGATIONS,\\n    22\u2192    ANALYSIS,\\n    23\u2192    API,\\n    24\u2192    COMPATIBLE_API,\\n    25\u2192    INDICES,\\n    26\u2192    MAPPINGS,\\n    27\u2192    OTHER,\\n    28\u2192    PARSING,\\n    29\u2192    PLUGINS,\\n    30\u2192    QUERIES,\\n    31\u2192    SCRIPTING,\\n    32\u2192    SECURITY,\\n    33\u2192    SETTINGS,\\n    34\u2192    TEMPLATES\\n    35\u2192}\\n    36\u2192\\n\\n<system-reminder>\\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\\n</system-reminder>\\n\"}]},\"parent_tool_use_id\":null,\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"8b28f01d-fc37-4fbb-8a31-877317e63282\"}\n{\"type\":\"assistant\",\"message\":{\"model\":\"claude-sonnet-4-5-20250929\",\"id\":\"msg_011HEWmZDuiup9CAxJx2gsCg\",\"type\":\"message\",\"role\":\"assistant\",\"content\":[{\"type\":\"text\",\"text\":\"Perfect! Now I understand the pattern. Let me create a task list and make the necessary changes:\"}],\"stop_reason\":null,\"stop_sequence\":null,\"usage\":{\"input_tokens\":0,\"cache_creation_input_tokens\":765,\"cache_read_input_tokens\":25367,\"cache_creation\":{\"ephemeral_5m_input_tokens\":765,\"ephemeral_1h_input_tokens\":0},\"output_tokens\":1,\"service_tier\":\"standard\"}},\"parent_tool_use_id\":null,\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"205410c7-8797-4f31-9538-65db4adc52fb\"}\n{\"type\":\"assistant\",\"message\":{\"model\":\"claude-sonnet-4-5-20250929\",\"id\":\"msg_011HEWmZDuiup9CAxJx2gsCg\",\"type\":\"message\",\"role\":\"assistant\",\"content\":[{\"type\":\"tool_use\",\"id\":\"toolu_01VXZuYdBkzoPMJDKRH7MjEo\",\"name\":\"TodoWrite\",\"input\":{\"todos\":[{\"content\":\"Add deprecation warning for 'rank' field in parseXContent method\",\"activeForm\":\"Adding deprecation warning for 'rank' field in parseXContent method\",\"status\":\"pending\"},{\"content\":\"Add deprecation warning for 'sub_searches' field in parseXContent method\",\"activeForm\":\"Adding deprecation warning for 'sub_searches' field in parseXContent method\",\"status\":\"pending\"},{\"content\":\"Add deprecation warning for rankBuilder setter method\",\"activeForm\":\"Adding deprecation warning for rankBuilder setter method\",\"status\":\"pending\"},{\"content\":\"Add deprecation warning for subSearches setter method\",\"activeForm\":\"Adding deprecation warning for subSearches setter method\",\"status\":\"pending\"}]}}],\"stop_reason\":null,\"stop_sequence\":null,\"usage\":{\"input_tokens\":0,\"cache_creation_input_tokens\":765,\"cache_read_input_tokens\":25367,\"cache_creation\":{\"ephemeral_5m_input_tokens\":765,\"ephemeral_1h_input_tokens\":0},\"output_tokens\":1,\"service_tier\":\"standard\"}},\"parent_tool_use_id\":null,\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"2d949b41-ddcb-433c-96c0-c2a3de281afc\"}\n{\"type\":\"user\",\"message\":{\"role\":\"user\",\"content\":[{\"tool_use_id\":\"toolu_01VXZuYdBkzoPMJDKRH7MjEo\",\"type\":\"tool_result\",\"content\":\"Todos have been modified successfully. Ensure that you continue to use the todo list to track your progress. Please proceed with the current tasks if applicable\"}]},\"parent_tool_use_id\":null,\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"e8025c4f-b89e-4a3a-bfcf-7eadb99fe8ff\"}\n{\"type\":\"assistant\",\"message\":{\"model\":\"claude-sonnet-4-5-20250929\",\"id\":\"msg_01PqGNQYszBeHCwd6bsnPcuT\",\"type\":\"message\",\"role\":\"assistant\",\"content\":[{\"type\":\"text\",\"text\":\"Now let's add the deprecation warnings. I'll start by adding the warning for the `rank` field in the parseXContent method:\"}],\"stop_reason\":null,\"stop_sequence\":null,\"usage\":{\"input_tokens\":0,\"cache_creation_input_tokens\":289,\"cache_read_input_tokens\":26132,\"cache_creation\":{\"ephemeral_5m_input_tokens\":289,\"ephemeral_1h_input_tokens\":0},\"output_tokens\":1,\"service_tier\":\"standard\"}},\"parent_tool_use_id\":null,\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"8962542d-beba-4921-8f9f-54a2ac58c52f\"}\n{\"type\":\"assistant\",\"message\":{\"model\":\"claude-sonnet-4-5-20250929\",\"id\":\"msg_01PqGNQYszBeHCwd6bsnPcuT\",\"type\":\"message\",\"role\":\"assistant\",\"content\":[{\"type\":\"tool_use\",\"id\":\"toolu_01CkqK5TURLLCHLcisP8SUfN\",\"name\":\"TodoWrite\",\"input\":{\"todos\":[{\"content\":\"Add deprecation warning for 'rank' field in parseXContent method\",\"activeForm\":\"Adding deprecation warning for 'rank' field in parseXContent method\",\"status\":\"in_progress\"},{\"content\":\"Add deprecation warning for 'sub_searches' field in parseXContent method\",\"activeForm\":\"Adding deprecation warning for 'sub_searches' field in parseXContent method\",\"status\":\"pending\"},{\"content\":\"Add deprecation warning for rankBuilder setter method\",\"activeForm\":\"Adding deprecation warning for rankBuilder setter method\",\"status\":\"pending\"},{\"content\":\"Add deprecation warning for subSearches setter method\",\"activeForm\":\"Adding deprecation warning for subSearches setter method\",\"status\":\"pending\"}]}}],\"stop_reason\":null,\"stop_sequence\":null,\"usage\":{\"input_tokens\":0,\"cache_creation_input_tokens\":289,\"cache_read_input_tokens\":26132,\"cache_creation\":{\"ephemeral_5m_input_tokens\":289,\"ephemeral_1h_input_tokens\":0},\"output_tokens\":1,\"service_tier\":\"standard\"}},\"parent_tool_use_id\":null,\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"9db1b4f1-3951-471f-953b-ca1bc5f0e0fe\"}\n{\"type\":\"user\",\"message\":{\"role\":\"user\",\"content\":[{\"tool_use_id\":\"toolu_01CkqK5TURLLCHLcisP8SUfN\",\"type\":\"tool_result\",\"content\":\"Todos have been modified successfully. Ensure that you continue to use the todo list to track your progress. Please proceed with the current tasks if applicable\"}]},\"parent_tool_use_id\":null,\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"db5255b6-cf6f-4346-87e2-718200722cba\"}\n{\"type\":\"assistant\",\"message\":{\"model\":\"claude-sonnet-4-5-20250929\",\"id\":\"msg_01EVwdDozNRWUEZBcoPwPVT7\",\"type\":\"message\",\"role\":\"assistant\",\"content\":[{\"type\":\"tool_use\",\"id\":\"toolu_01Es7E74FnBcmL9MPa3gzcvy\",\"name\":\"Edit\",\"input\":{\"file_path\":\"/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/search/builder/SearchSourceBuilder.java\",\"old_string\":\"                } else if (RANK_FIELD.match(currentFieldName, parser.getDeprecationHandler())) {\\n                    if (RANK_SUPPORTED == false) {\\n                        throwUnknownKey(parser, token, currentFieldName);\\n                    }\\n                    if (parser.nextToken() != XContentParser.Token.FIELD_NAME) {\\n                        throw new ParsingException(\\n                            parser.getTokenLocation(),\\n                            \\\"expected a rank name, but found token [\\\" + token + \\\"] for [\\\" + RANK_FIELD.getPreferredName() + \\\"]\\\"\\n                        );\\n                    }\\n                    rankBuilder = parser.namedObject(RankBuilder.class, parser.currentName(), null);\\n                    if (parser.currentToken() != XContentParser.Token.END_OBJECT) {\\n                        throw new ParsingException(\\n                            parser.getTokenLocation(),\\n                            \\\"expected token '}', but found token [\\\" + token + \\\"] for [\\\" + RANK_FIELD.getPreferredName() + \\\"]\\\"\\n                        );\\n                    }\\n                    parser.nextToken();\\n                    searchUsage.trackSectionUsage(\\\"rank_\\\" + rankBuilder.getWriteableName());\",\"new_string\":\"                } else if (RANK_FIELD.match(currentFieldName, parser.getDeprecationHandler())) {\\n                    if (RANK_SUPPORTED == false) {\\n                        throwUnknownKey(parser, token, currentFieldName);\\n                    }\\n                    deprecationLogger.critical(\\n                        DeprecationCategory.API,\\n                        \\\"search_api_rank_field\\\",\\n                        \\\"The [rank] field in the search request body is deprecated and will be removed in a future version. \\\"\\n                            + \\\"Use the [retriever] field instead.\\\"\\n                    );\\n                    if (parser.nextToken() != XContentParser.Token.FIELD_NAME) {\\n                        throw new ParsingException(\\n                            parser.getTokenLocation(),\\n                            \\\"expected a rank name, but found token [\\\" + token + \\\"] for [\\\" + RANK_FIELD.getPreferredName() + \\\"]\\\"\\n                        );\\n                    }\\n                    rankBuilder = parser.namedObject(RankBuilder.class, parser.currentName(), null);\\n                    if (parser.currentToken() != XContentParser.Token.END_OBJECT) {\\n                        throw new ParsingException(\\n                            parser.getTokenLocation(),\\n                            \\\"expected token '}', but found token [\\\" + token + \\\"] for [\\\" + RANK_FIELD.getPreferredName() + \\\"]\\\"\\n                        );\\n                    }\\n                    parser.nextToken();\\n                    searchUsage.trackSectionUsage(\\\"rank_\\\" + rankBuilder.getWriteableName());\"}}],\"stop_reason\":null,\"stop_sequence\":null,\"usage\":{\"input_tokens\":0,\"cache_creation_input_tokens\":300,\"cache_read_input_tokens\":26421,\"cache_creation\":{\"ephemeral_5m_input_tokens\":300,\"ephemeral_1h_input_tokens\":0},\"output_tokens\":25,\"service_tier\":\"standard\"}},\"parent_tool_use_id\":null,\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"4fc81567-d1ca-4d66-9b3a-2d5caa9e7550\"}\n{\"type\":\"user\",\"message\":{\"role\":\"user\",\"content\":[{\"tool_use_id\":\"toolu_01Es7E74FnBcmL9MPa3gzcvy\",\"type\":\"tool_result\",\"content\":\"The file /private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/search/builder/SearchSourceBuilder.java has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\\n  1413\u2192                    searchUsage.trackSectionUsage(POST_FILTER_FIELD.getPreferredName());\\n  1414\u2192                } else if (KNN_FIELD.match(currentFieldName, parser.getDeprecationHandler())) {\\n  1415\u2192                    knnBuilders = List.of(KnnSearchBuilder.fromXContent(parser));\\n  1416\u2192                    searchUsage.trackSectionUsage(KNN_FIELD.getPreferredName());\\n  1417\u2192                } else if (RANK_FIELD.match(currentFieldName, parser.getDeprecationHandler())) {\\n  1418\u2192                    if (RANK_SUPPORTED == false) {\\n  1419\u2192                        throwUnknownKey(parser, token, currentFieldName);\\n  1420\u2192                    }\\n  1421\u2192                    deprecationLogger.critical(\\n  1422\u2192                        DeprecationCategory.API,\\n  1423\u2192                        \\\"search_api_rank_field\\\",\\n  1424\u2192                        \\\"The [rank] field in the search request body is deprecated and will be removed in a future version. \\\"\\n  1425\u2192                            + \\\"Use the [retriever] field instead.\\\"\\n  1426\u2192                    );\\n  1427\u2192                    if (parser.nextToken() != XContentParser.Token.FIELD_NAME) {\\n  1428\u2192                        throw new ParsingException(\\n  1429\u2192                            parser.getTokenLocation(),\\n  1430\u2192                            \\\"expected a rank name, but found token [\\\" + token + \\\"] for [\\\" + RANK_FIELD.getPreferredName() + \\\"]\\\"\\n  1431\u2192                        );\\n  1432\u2192                    }\\n  1433\u2192                    rankBuilder = parser.namedObject(RankBuilder.class, parser.currentName(), null);\\n  1434\u2192                    if (parser.currentToken() != XContentParser.Token.END_OBJECT) {\\n  1435\u2192                        throw new ParsingException(\\n  1436\u2192                            parser.getTokenLocation(),\\n  1437\u2192                            \\\"expected token '}', but found token [\\\" + token + \\\"] for [\\\" + RANK_FIELD.getPreferredName() + \\\"]\\\"\\n  1438\u2192                        );\\n  1439\u2192                    }\\n  1440\u2192                    parser.nextToken();\\n  1441\u2192                    searchUsage.trackSectionUsage(\\\"rank_\\\" + rankBuilder.getWriteableName());\\n  1442\u2192                } else if (_SOURCE_FIELD.match(currentFieldName, parser.getDeprecationHandler())) {\\n  1443\u2192                    fetchSourceContext = FetchSourceContext.fromXContent(parser);\\n  1444\u2192                    if (fetchSourceContext.fetchSource() == false\\n  1445\u2192                        || fetchSourceContext.includes().length > 0\"}]},\"parent_tool_use_id\":null,\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"a9499d46-3a70-455f-9c20-77fb2ea8cb1f\"}\n{\"type\":\"assistant\",\"message\":{\"model\":\"claude-sonnet-4-5-20250929\",\"id\":\"msg_01BeUar7nGneFEPQCbSVQ52C\",\"type\":\"message\",\"role\":\"assistant\",\"content\":[{\"type\":\"tool_use\",\"id\":\"toolu_01L6EYv7ijbxhjp2cXWMucjR\",\"name\":\"TodoWrite\",\"input\":{\"todos\":[{\"content\":\"Add deprecation warning for 'rank' field in parseXContent method\",\"activeForm\":\"Adding deprecation warning for 'rank' field in parseXContent method\",\"status\":\"completed\"},{\"content\":\"Add deprecation warning for 'sub_searches' field in parseXContent method\",\"activeForm\":\"Adding deprecation warning for 'sub_searches' field in parseXContent method\",\"status\":\"in_progress\"},{\"content\":\"Add deprecation warning for rankBuilder setter method\",\"activeForm\":\"Adding deprecation warning for rankBuilder setter method\",\"status\":\"pending\"},{\"content\":\"Add deprecation warning for subSearches setter method\",\"activeForm\":\"Adding deprecation warning for subSearches setter method\",\"status\":\"pending\"}]}}],\"stop_reason\":null,\"stop_sequence\":null,\"usage\":{\"input_tokens\":0,\"cache_creation_input_tokens\":1613,\"cache_read_input_tokens\":26721,\"cache_creation\":{\"ephemeral_5m_input_tokens\":1613,\"ephemeral_1h_input_tokens\":0},\"output_tokens\":26,\"service_tier\":\"standard\"}},\"parent_tool_use_id\":null,\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"af0f607d-6237-4cb2-8773-7eb4dfd64599\"}\n{\"type\":\"user\",\"message\":{\"role\":\"user\",\"content\":[{\"tool_use_id\":\"toolu_01L6EYv7ijbxhjp2cXWMucjR\",\"type\":\"tool_result\",\"content\":\"Todos have been modified successfully. Ensure that you continue to use the todo list to track your progress. Please proceed with the current tasks if applicable\"}]},\"parent_tool_use_id\":null,\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"b0b0bfae-f4d2-4a60-b552-5efee0af25dd\"}\n{\"type\":\"assistant\",\"message\":{\"model\":\"claude-sonnet-4-5-20250929\",\"id\":\"msg_016nL7KLUZURrNbMxRnT71HH\",\"type\":\"message\",\"role\":\"assistant\",\"content\":[{\"type\":\"text\",\"text\":\"Now let's add the deprecation warning for the `sub_searches` field:\"}],\"stop_reason\":null,\"stop_sequence\":null,\"usage\":{\"input_tokens\":0,\"cache_creation_input_tokens\":270,\"cache_read_input_tokens\":28334,\"cache_creation\":{\"ephemeral_5m_input_tokens\":270,\"ephemeral_1h_input_tokens\":0},\"output_tokens\":1,\"service_tier\":\"standard\"}},\"parent_tool_use_id\":null,\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"1e2f8656-1553-41bd-a205-3e3eba9c8fa2\"}\n{\"type\":\"assistant\",\"message\":{\"model\":\"claude-sonnet-4-5-20250929\",\"id\":\"msg_016nL7KLUZURrNbMxRnT71HH\",\"type\":\"message\",\"role\":\"assistant\",\"content\":[{\"type\":\"tool_use\",\"id\":\"toolu_01Fw4VPRySyokmGHBr4y8Vvc\",\"name\":\"Edit\",\"input\":{\"file_path\":\"/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/search/builder/SearchSourceBuilder.java\",\"old_string\":\"                } else if (SUB_SEARCHES_FIELD.match(currentFieldName, parser.getDeprecationHandler())) {\\n                    if (RANK_SUPPORTED == false) {\\n                        throwUnknownKey(parser, token, currentFieldName);\\n                    }\\n                    if (subSearchSourceBuilders.isEmpty() == false) {\\n                        throw new IllegalArgumentException(\\n                            \\\"cannot specify field [\\\" + currentFieldName + \\\"] and field [\\\" + QUERY_FIELD.getPreferredName() + \\\"]\\\"\\n                        );\\n                    }\\n                    while ((token = parser.nextToken()) != XContentParser.Token.END_ARRAY) {\\n                        if (token == XContentParser.Token.START_OBJECT) {\\n                            subSearchSourceBuilders.add(SubSearchSourceBuilder.fromXContent(parser, searchUsage));\\n                        } else {\\n                            throw new XContentParseException(\\n                                parser.getTokenLocation(),\\n                                \\\"malformed query within the [sub_searches] field; found \\\" + token\\n                            );\\n                        }\\n                    }\\n                    searchUsage.trackSectionUsage(SUB_SEARCHES_FIELD.getPreferredName());\",\"new_string\":\"                } else if (SUB_SEARCHES_FIELD.match(currentFieldName, parser.getDeprecationHandler())) {\\n                    if (RANK_SUPPORTED == false) {\\n                        throwUnknownKey(parser, token, currentFieldName);\\n                    }\\n                    deprecationLogger.critical(\\n                        DeprecationCategory.API,\\n                        \\\"search_api_sub_searches_field\\\",\\n                        \\\"The [sub_searches] field in the search request body is deprecated and will be removed in a future version. \\\"\\n                            + \\\"Use the [retriever] field instead.\\\"\\n                    );\\n                    if (subSearchSourceBuilders.isEmpty() == false) {\\n                        throw new IllegalArgumentException(\\n                            \\\"cannot specify field [\\\" + currentFieldName + \\\"] and field [\\\" + QUERY_FIELD.getPreferredName() + \\\"]\\\"\\n                        );\\n                    }\\n                    while ((token = parser.nextToken()) != XContentParser.Token.END_ARRAY) {\\n                        if (token == XContentParser.Token.START_OBJECT) {\\n                            subSearchSourceBuilders.add(SubSearchSourceBuilder.fromXContent(parser, searchUsage));\\n                        } else {\\n                            throw new XContentParseException(\\n                                parser.getTokenLocation(),\\n                                \\\"malformed query within the [sub_searches] field; found \\\" + token\\n                            );\\n                        }\\n                    }\\n                    searchUsage.trackSectionUsage(SUB_SEARCHES_FIELD.getPreferredName());\"}}],\"stop_reason\":null,\"stop_sequence\":null,\"usage\":{\"input_tokens\":0,\"cache_creation_input_tokens\":270,\"cache_read_input_tokens\":28334,\"cache_creation\":{\"ephemeral_5m_input_tokens\":270,\"ephemeral_1h_input_tokens\":0},\"output_tokens\":1,\"service_tier\":\"standard\"}},\"parent_tool_use_id\":null,\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"a60e7fb2-acd6-4892-aa61-86de0bf07428\"}\n{\"type\":\"user\",\"message\":{\"role\":\"user\",\"content\":[{\"tool_use_id\":\"toolu_01Fw4VPRySyokmGHBr4y8Vvc\",\"type\":\"tool_result\",\"content\":\"The file /private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/search/builder/SearchSourceBuilder.java has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\\n  1606\u2192                            );\\n  1607\u2192                        }\\n  1608\u2192                    }\\n  1609\u2192                    searchUsage.trackSectionUsage(KNN_FIELD.getPreferredName());\\n  1610\u2192                } else if (SUB_SEARCHES_FIELD.match(currentFieldName, parser.getDeprecationHandler())) {\\n  1611\u2192                    if (RANK_SUPPORTED == false) {\\n  1612\u2192                        throwUnknownKey(parser, token, currentFieldName);\\n  1613\u2192                    }\\n  1614\u2192                    deprecationLogger.critical(\\n  1615\u2192                        DeprecationCategory.API,\\n  1616\u2192                        \\\"search_api_sub_searches_field\\\",\\n  1617\u2192                        \\\"The [sub_searches] field in the search request body is deprecated and will be removed in a future version. \\\"\\n  1618\u2192                            + \\\"Use the [retriever] field instead.\\\"\\n  1619\u2192                    );\\n  1620\u2192                    if (subSearchSourceBuilders.isEmpty() == false) {\\n  1621\u2192                        throw new IllegalArgumentException(\\n  1622\u2192                            \\\"cannot specify field [\\\" + currentFieldName + \\\"] and field [\\\" + QUERY_FIELD.getPreferredName() + \\\"]\\\"\\n  1623\u2192                        );\\n  1624\u2192                    }\\n  1625\u2192                    while ((token = parser.nextToken()) != XContentParser.Token.END_ARRAY) {\\n  1626\u2192                        if (token == XContentParser.Token.START_OBJECT) {\\n  1627\u2192                            subSearchSourceBuilders.add(SubSearchSourceBuilder.fromXContent(parser, searchUsage));\\n  1628\u2192                        } else {\\n  1629\u2192                            throw new XContentParseException(\\n  1630\u2192                                parser.getTokenLocation(),\\n  1631\u2192                                \\\"malformed query within the [sub_searches] field; found \\\" + token\\n  1632\u2192                            );\\n  1633\u2192                        }\\n  1634\u2192                    }\\n  1635\u2192                    searchUsage.trackSectionUsage(SUB_SEARCHES_FIELD.getPreferredName());\\n  1636\u2192                } else {\\n  1637\u2192                    throwUnknownKey(parser, token, currentFieldName);\\n  1638\u2192                }\\n  1639\u2192            } else {\"}]},\"parent_tool_use_id\":null,\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"351f1e80-5835-4d86-9ae5-59dac663592d\"}\n{\"type\":\"assistant\",\"message\":{\"model\":\"claude-sonnet-4-5-20250929\",\"id\":\"msg_01EheND4aUMHWeb6JoccfypX\",\"type\":\"message\",\"role\":\"assistant\",\"content\":[{\"type\":\"tool_use\",\"id\":\"toolu_01JSq9QM3wGHLxCmVUeJjSna\",\"name\":\"TodoWrite\",\"input\":{\"todos\":[{\"content\":\"Add deprecation warning for 'rank' field in parseXContent method\",\"activeForm\":\"Adding deprecation warning for 'rank' field in parseXContent method\",\"status\":\"completed\"},{\"content\":\"Add deprecation warning for 'sub_searches' field in parseXContent method\",\"activeForm\":\"Adding deprecation warning for 'sub_searches' field in parseXContent method\",\"status\":\"completed\"},{\"content\":\"Add deprecation warning for rankBuilder setter method\",\"activeForm\":\"Adding deprecation warning for rankBuilder setter method\",\"status\":\"in_progress\"},{\"content\":\"Add deprecation warning for subSearches setter method\",\"activeForm\":\"Adding deprecation warning for subSearches setter method\",\"status\":\"pending\"}]}}],\"stop_reason\":null,\"stop_sequence\":null,\"usage\":{\"input_tokens\":0,\"cache_creation_input_tokens\":1519,\"cache_read_input_tokens\":28604,\"cache_creation\":{\"ephemeral_5m_input_tokens\":1519,\"ephemeral_1h_input_tokens\":0},\"output_tokens\":228,\"service_tier\":\"standard\"}},\"parent_tool_use_id\":null,\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"57d1ae6f-cd26-4362-aa79-38ca2350e243\"}\n{\"type\":\"user\",\"message\":{\"role\":\"user\",\"content\":[{\"tool_use_id\":\"toolu_01JSq9QM3wGHLxCmVUeJjSna\",\"type\":\"tool_result\",\"content\":\"Todos have been modified successfully. Ensure that you continue to use the todo list to track your progress. Please proceed with the current tasks if applicable\"}]},\"parent_tool_use_id\":null,\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"0a610cd9-6753-4e5e-9245-ce4f1b362aed\"}\n{\"type\":\"assistant\",\"message\":{\"model\":\"claude-sonnet-4-5-20250929\",\"id\":\"msg_01DGmZ1GZ19n88WM4MqBYiM7\",\"type\":\"message\",\"role\":\"assistant\",\"content\":[{\"type\":\"text\",\"text\":\"Now let's add the deprecation warning for the `rankBuilder` setter method:\"}],\"stop_reason\":null,\"stop_sequence\":null,\"usage\":{\"input_tokens\":0,\"cache_creation_input_tokens\":270,\"cache_read_input_tokens\":30123,\"cache_creation\":{\"ephemeral_5m_input_tokens\":270,\"ephemeral_1h_input_tokens\":0},\"output_tokens\":1,\"service_tier\":\"standard\"}},\"parent_tool_use_id\":null,\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"52b7d5a8-c6ce-48aa-a435-13093c49ed36\"}\n{\"type\":\"assistant\",\"message\":{\"model\":\"claude-sonnet-4-5-20250929\",\"id\":\"msg_01DGmZ1GZ19n88WM4MqBYiM7\",\"type\":\"message\",\"role\":\"assistant\",\"content\":[{\"type\":\"tool_use\",\"id\":\"toolu_01WzEzCzWECvmxiVqGCLM5rB\",\"name\":\"Edit\",\"input\":{\"file_path\":\"/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/search/builder/SearchSourceBuilder.java\",\"old_string\":\"    public SearchSourceBuilder rankBuilder(RankBuilder rankBuilder) {\\n        this.rankBuilder = rankBuilder;\\n        return this;\\n    }\",\"new_string\":\"    public SearchSourceBuilder rankBuilder(RankBuilder rankBuilder) {\\n        deprecationLogger.critical(\\n            DeprecationCategory.API,\\n            \\\"search_api_rank_field\\\",\\n            \\\"The [rank] field in the search request body is deprecated and will be removed in a future version. \\\"\\n                + \\\"Use the [retriever] field instead.\\\"\\n        );\\n        this.rankBuilder = rankBuilder;\\n        return this;\\n    }\"}}],\"stop_reason\":null,\"stop_sequence\":null,\"usage\":{\"input_tokens\":0,\"cache_creation_input_tokens\":270,\"cache_read_input_tokens\":30123,\"cache_creation\":{\"ephemeral_5m_input_tokens\":270,\"ephemeral_1h_input_tokens\":0},\"output_tokens\":1,\"service_tier\":\"standard\"}},\"parent_tool_use_id\":null,\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"0a8a1c11-a170-4f58-93c8-65941a18ea24\"}\n{\"type\":\"user\",\"message\":{\"role\":\"user\",\"content\":[{\"tool_use_id\":\"toolu_01WzEzCzWECvmxiVqGCLM5rB\",\"type\":\"tool_result\",\"content\":\"The file /private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/search/builder/SearchSourceBuilder.java has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\\n   473\u2192    public List<KnnSearchBuilder> knnSearch() {\\n   474\u2192        return Collections.unmodifiableList(knnSearch);\\n   475\u2192    }\\n   476\u2192\\n   477\u2192    public SearchSourceBuilder rankBuilder(RankBuilder rankBuilder) {\\n   478\u2192        deprecationLogger.critical(\\n   479\u2192            DeprecationCategory.API,\\n   480\u2192            \\\"search_api_rank_field\\\",\\n   481\u2192            \\\"The [rank] field in the search request body is deprecated and will be removed in a future version. \\\"\\n   482\u2192                + \\\"Use the [retriever] field instead.\\\"\\n   483\u2192        );\\n   484\u2192        this.rankBuilder = rankBuilder;\\n   485\u2192        return this;\\n   486\u2192    }\\n   487\u2192\\n   488\u2192    public RankBuilder rankBuilder() {\\n   489\u2192        return rankBuilder;\\n   490\u2192    }\"}]},\"parent_tool_use_id\":null,\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"fd6dcad8-e78b-4918-a1b9-1c25f5ba54ec\"}\n{\"type\":\"assistant\",\"message\":{\"model\":\"claude-sonnet-4-5-20250929\",\"id\":\"msg_01UbxegBoHTsAvPqeJk3xESv\",\"type\":\"message\",\"role\":\"assistant\",\"content\":[{\"type\":\"tool_use\",\"id\":\"toolu_016kDcsijD2Aj4tFq7TmX1qE\",\"name\":\"TodoWrite\",\"input\":{\"todos\":[{\"content\":\"Add deprecation warning for 'rank' field in parseXContent method\",\"activeForm\":\"Adding deprecation warning for 'rank' field in parseXContent method\",\"status\":\"completed\"},{\"content\":\"Add deprecation warning for 'sub_searches' field in parseXContent method\",\"activeForm\":\"Adding deprecation warning for 'sub_searches' field in parseXContent method\",\"status\":\"completed\"},{\"content\":\"Add deprecation warning for rankBuilder setter method\",\"activeForm\":\"Adding deprecation warning for rankBuilder setter method\",\"status\":\"completed\"},{\"content\":\"Add deprecation warning for subSearches setter method\",\"activeForm\":\"Adding deprecation warning for subSearches setter method\",\"status\":\"in_progress\"}]}}],\"stop_reason\":null,\"stop_sequence\":null,\"usage\":{\"input_tokens\":0,\"cache_creation_input_tokens\":627,\"cache_read_input_tokens\":30393,\"cache_creation\":{\"ephemeral_5m_input_tokens\":627,\"ephemeral_1h_input_tokens\":0},\"output_tokens\":25,\"service_tier\":\"standard\"}},\"parent_tool_use_id\":null,\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"935dc5be-87db-4cce-a252-245e93e23342\"}\n{\"type\":\"user\",\"message\":{\"role\":\"user\",\"content\":[{\"tool_use_id\":\"toolu_016kDcsijD2Aj4tFq7TmX1qE\",\"type\":\"tool_result\",\"content\":\"Todos have been modified successfully. Ensure that you continue to use the todo list to track your progress. Please proceed with the current tasks if applicable\"}]},\"parent_tool_use_id\":null,\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"2c9b1bf1-7888-4d59-9963-dd1d457b1284\"}\n{\"type\":\"assistant\",\"message\":{\"model\":\"claude-sonnet-4-5-20250929\",\"id\":\"msg_019G6kw5VqcK7FbSpErttYdJ\",\"type\":\"message\",\"role\":\"assistant\",\"content\":[{\"type\":\"text\",\"text\":\"Now let's add the deprecation warning for the `subSearches` setter method:\"}],\"stop_reason\":null,\"stop_sequence\":null,\"usage\":{\"input_tokens\":0,\"cache_creation_input_tokens\":270,\"cache_read_input_tokens\":31020,\"cache_creation\":{\"ephemeral_5m_input_tokens\":270,\"ephemeral_1h_input_tokens\":0},\"output_tokens\":1,\"service_tier\":\"standard\"}},\"parent_tool_use_id\":null,\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"48901f19-18eb-4020-a877-398dfba176c6\"}\n{\"type\":\"assistant\",\"message\":{\"model\":\"claude-sonnet-4-5-20250929\",\"id\":\"msg_019G6kw5VqcK7FbSpErttYdJ\",\"type\":\"message\",\"role\":\"assistant\",\"content\":[{\"type\":\"tool_use\",\"id\":\"toolu_01B1ndWhyVjL92ZtWrt1fyrD\",\"name\":\"Edit\",\"input\":{\"file_path\":\"/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/search/builder/SearchSourceBuilder.java\",\"old_string\":\"    /**\\n     * Sets the sub searches for this request.\\n     */\\n    public SearchSourceBuilder subSearches(List<SubSearchSourceBuilder> subSearchSourceBuilders) {\\n        Objects.requireNonNull(subSearchSourceBuilders);\\n        this.subSearchSourceBuilders = subSearchSourceBuilders;\\n        return this;\\n    }\",\"new_string\":\"    /**\\n     * Sets the sub searches for this request.\\n     */\\n    public SearchSourceBuilder subSearches(List<SubSearchSourceBuilder> subSearchSourceBuilders) {\\n        deprecationLogger.critical(\\n            DeprecationCategory.API,\\n            \\\"search_api_sub_searches_field\\\",\\n            \\\"The [sub_searches] field in the search request body is deprecated and will be removed in a future version. \\\"\\n                + \\\"Use the [retriever] field instead.\\\"\\n        );\\n        Objects.requireNonNull(subSearchSourceBuilders);\\n        this.subSearchSourceBuilders = subSearchSourceBuilders;\\n        return this;\\n    }\"}}],\"stop_reason\":null,\"stop_sequence\":null,\"usage\":{\"input_tokens\":0,\"cache_creation_input_tokens\":270,\"cache_read_input_tokens\":31020,\"cache_creation\":{\"ephemeral_5m_input_tokens\":270,\"ephemeral_1h_input_tokens\":0},\"output_tokens\":1,\"service_tier\":\"standard\"}},\"parent_tool_use_id\":null,\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"a02c44e6-3fe0-40b6-b335-705c3bef8fc3\"}\n{\"type\":\"user\",\"message\":{\"role\":\"user\",\"content\":[{\"tool_use_id\":\"toolu_01B1ndWhyVjL92ZtWrt1fyrD\",\"type\":\"tool_result\",\"content\":\"The file /private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/search/builder/SearchSourceBuilder.java has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\\n   424\u2192            return boolQueryBuilder;\\n   425\u2192        }\\n   426\u2192    }\\n   427\u2192\\n   428\u2192    /**\\n   429\u2192     * Sets the sub searches for this request.\\n   430\u2192     */\\n   431\u2192    public SearchSourceBuilder subSearches(List<SubSearchSourceBuilder> subSearchSourceBuilders) {\\n   432\u2192        deprecationLogger.critical(\\n   433\u2192            DeprecationCategory.API,\\n   434\u2192            \\\"search_api_sub_searches_field\\\",\\n   435\u2192            \\\"The [sub_searches] field in the search request body is deprecated and will be removed in a future version. \\\"\\n   436\u2192                + \\\"Use the [retriever] field instead.\\\"\\n   437\u2192        );\\n   438\u2192        Objects.requireNonNull(subSearchSourceBuilders);\\n   439\u2192        this.subSearchSourceBuilders = subSearchSourceBuilders;\\n   440\u2192        return this;\\n   441\u2192    }\\n   442\u2192\\n   443\u2192    /**\\n   444\u2192     * Gets the sub searches for this request.\\n   445\u2192     */\"}]},\"parent_tool_use_id\":null,\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"c4d927f5-525c-4124-b4b4-a65711423003\"}\n{\"type\":\"assistant\",\"message\":{\"model\":\"claude-sonnet-4-5-20250929\",\"id\":\"msg_01Fz38wdYBQ8gCZbNce8a9uh\",\"type\":\"message\",\"role\":\"assistant\",\"content\":[{\"type\":\"tool_use\",\"id\":\"toolu_01E2CxYWC3AEG1MwzBd1CHXD\",\"name\":\"TodoWrite\",\"input\":{\"todos\":[{\"content\":\"Add deprecation warning for 'rank' field in parseXContent method\",\"activeForm\":\"Adding deprecation warning for 'rank' field in parseXContent method\",\"status\":\"completed\"},{\"content\":\"Add deprecation warning for 'sub_searches' field in parseXContent method\",\"activeForm\":\"Adding deprecation warning for 'sub_searches' field in parseXContent method\",\"status\":\"completed\"},{\"content\":\"Add deprecation warning for rankBuilder setter method\",\"activeForm\":\"Adding deprecation warning for rankBuilder setter method\",\"status\":\"completed\"},{\"content\":\"Add deprecation warning for subSearches setter method\",\"activeForm\":\"Adding deprecation warning for subSearches setter method\",\"status\":\"completed\"}]}}],\"stop_reason\":null,\"stop_sequence\":null,\"usage\":{\"input_tokens\":0,\"cache_creation_input_tokens\":765,\"cache_read_input_tokens\":31290,\"cache_creation\":{\"ephemeral_5m_input_tokens\":765,\"ephemeral_1h_input_tokens\":0},\"output_tokens\":26,\"service_tier\":\"standard\"}},\"parent_tool_use_id\":null,\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"fc449cce-9298-40c1-9e06-f9fe89295e04\"}\n{\"type\":\"user\",\"message\":{\"role\":\"user\",\"content\":[{\"tool_use_id\":\"toolu_01E2CxYWC3AEG1MwzBd1CHXD\",\"type\":\"tool_result\",\"content\":\"Todos have been modified successfully. Ensure that you continue to use the todo list to track your progress. Please proceed with the current tasks if applicable\"}]},\"parent_tool_use_id\":null,\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"cabf7ef7-fe1f-4f43-9cf0-299feec3e7e3\"}\n{\"type\":\"assistant\",\"message\":{\"model\":\"claude-sonnet-4-5-20250929\",\"id\":\"msg_01BC5iWozXYAJf8Uvf7mpVzL\",\"type\":\"message\",\"role\":\"assistant\",\"content\":[{\"type\":\"text\",\"text\":\"Perfect! Now let's verify our changes by reading the modified sections:\"}],\"stop_reason\":null,\"stop_sequence\":null,\"usage\":{\"input_tokens\":0,\"cache_creation_input_tokens\":268,\"cache_read_input_tokens\":32055,\"cache_creation\":{\"ephemeral_5m_input_tokens\":268,\"ephemeral_1h_input_tokens\":0},\"output_tokens\":1,\"service_tier\":\"standard\"}},\"parent_tool_use_id\":null,\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"60fa26e7-4540-4777-a08f-27f86358d73c\"}\n{\"type\":\"assistant\",\"message\":{\"model\":\"claude-sonnet-4-5-20250929\",\"id\":\"msg_01BC5iWozXYAJf8Uvf7mpVzL\",\"type\":\"message\",\"role\":\"assistant\",\"content\":[{\"type\":\"tool_use\",\"id\":\"toolu_01MyDvV5VLwnqx8nCQaGesny\",\"name\":\"Bash\",\"input\":{\"command\":\"grep -n \\\"deprecationLogger.critical\\\" server/src/main/java/org/elasticsearch/search/builder/SearchSourceBuilder.java\",\"description\":\"Verify deprecation warnings added\"}}],\"stop_reason\":null,\"stop_sequence\":null,\"usage\":{\"input_tokens\":0,\"cache_creation_input_tokens\":268,\"cache_read_input_tokens\":32055,\"cache_creation\":{\"ephemeral_5m_input_tokens\":268,\"ephemeral_1h_input_tokens\":0},\"output_tokens\":167,\"service_tier\":\"standard\"}},\"parent_tool_use_id\":null,\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"c94bb68d-293a-416c-aba0-56c973336189\"}\n{\"type\":\"user\",\"message\":{\"role\":\"user\",\"content\":[{\"tool_use_id\":\"toolu_01MyDvV5VLwnqx8nCQaGesny\",\"type\":\"tool_result\",\"content\":\"432:        deprecationLogger.critical(\\n484:        deprecationLogger.critical(\\n1433:                    deprecationLogger.critical(\\n1626:                    deprecationLogger.critical(\",\"is_error\":false}]},\"parent_tool_use_id\":null,\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"36041df6-fe03-44db-bbf2-06a3c8d35417\"}\n{\"type\":\"assistant\",\"message\":{\"model\":\"claude-sonnet-4-5-20250929\",\"id\":\"msg_01N5c4Msy2zMcN1aQyTc3ky8\",\"type\":\"message\",\"role\":\"assistant\",\"content\":[{\"type\":\"text\",\"text\":\"Excellent! Let me verify the complete implementation by checking the context around each warning:\"}],\"stop_reason\":null,\"stop_sequence\":null,\"usage\":{\"input_tokens\":0,\"cache_creation_input_tokens\":174,\"cache_read_input_tokens\":32323,\"cache_creation\":{\"ephemeral_5m_input_tokens\":174,\"ephemeral_1h_input_tokens\":0},\"output_tokens\":2,\"service_tier\":\"standard\"}},\"parent_tool_use_id\":null,\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"e6d98e2c-736a-4ac6-bfab-3709e97450f8\"}\n{\"type\":\"assistant\",\"message\":{\"model\":\"claude-sonnet-4-5-20250929\",\"id\":\"msg_01N5c4Msy2zMcN1aQyTc3ky8\",\"type\":\"message\",\"role\":\"assistant\",\"content\":[{\"type\":\"tool_use\",\"id\":\"toolu_01TZ5rWefGo4yA5N4ANQ1uuj\",\"name\":\"Read\",\"input\":{\"file_path\":\"/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/search/builder/SearchSourceBuilder.java\",\"offset\":428,\"limit\":20}}],\"stop_reason\":null,\"stop_sequence\":null,\"usage\":{\"input_tokens\":0,\"cache_creation_input_tokens\":174,\"cache_read_input_tokens\":32323,\"cache_creation\":{\"ephemeral_5m_input_tokens\":174,\"ephemeral_1h_input_tokens\":0},\"output_tokens\":2,\"service_tier\":\"standard\"}},\"parent_tool_use_id\":null,\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"ab972954-76ad-48b5-b534-5e3624af9bad\"}\n{\"type\":\"user\",\"message\":{\"role\":\"user\",\"content\":[{\"tool_use_id\":\"toolu_01TZ5rWefGo4yA5N4ANQ1uuj\",\"type\":\"tool_result\",\"content\":\"   428\u2192    /**\\n   429\u2192     * Sets the sub searches for this request.\\n   430\u2192     */\\n   431\u2192    public SearchSourceBuilder subSearches(List<SubSearchSourceBuilder> subSearchSourceBuilders) {\\n   432\u2192        deprecationLogger.critical(\\n   433\u2192            DeprecationCategory.API,\\n   434\u2192            \\\"search_api_sub_searches_field\\\",\\n   435\u2192            \\\"The [sub_searches] field in the search request body is deprecated and will be removed in a future version. \\\"\\n   436\u2192                + \\\"Use the [retriever] field instead.\\\"\\n   437\u2192        );\\n   438\u2192        Objects.requireNonNull(subSearchSourceBuilders);\\n   439\u2192        this.subSearchSourceBuilders = subSearchSourceBuilders;\\n   440\u2192        return this;\\n   441\u2192    }\\n   442\u2192\\n   443\u2192    /**\\n   444\u2192     * Gets the sub searches for this request.\\n   445\u2192     */\\n   446\u2192    public List<SubSearchSourceBuilder> subSearches() {\\n   447\u2192        return subSearchSourceBuilders;\\n\\n<system-reminder>\\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\\n</system-reminder>\\n\"}]},\"parent_tool_use_id\":null,\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"4ad149cf-38ac-4c2d-b472-031ba2a5f78d\"}\n{\"type\":\"assistant\",\"message\":{\"model\":\"claude-sonnet-4-5-20250929\",\"id\":\"msg_01QWQr5RYcFrCyZNLc5ffHFd\",\"type\":\"message\",\"role\":\"assistant\",\"content\":[{\"type\":\"tool_use\",\"id\":\"toolu_01MYGq48uTmYrn1A6M1Tq4wF\",\"name\":\"Read\",\"input\":{\"file_path\":\"/private/var/folders/1t/tn_3vh3x0nv_snwb7xrv97th0000gn/T/tmpekheuqkd/workspace/server/src/main/java/org/elasticsearch/search/builder/SearchSourceBuilder.java\",\"offset\":477,\"limit\":15}}],\"stop_reason\":null,\"stop_sequence\":null,\"usage\":{\"input_tokens\":0,\"cache_creation_input_tokens\":519,\"cache_read_input_tokens\":32497,\"cache_creation\":{\"ephemeral_5m_input_tokens\":519,\"ephemeral_1h_input_tokens\":0},\"output_tokens\":24,\"service_tier\":\"standard\"}},\"parent_tool_use_id\":null,\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"8062e22d-05f4-422c-8066-e77ad0493c54\"}\n{\"type\":\"user\",\"message\":{\"role\":\"user\",\"content\":[{\"tool_use_id\":\"toolu_01MYGq48uTmYrn1A6M1Tq4wF\",\"type\":\"tool_result\",\"content\":\"   477\u2192     * An optional kNN search definition.\\n   478\u2192     */\\n   479\u2192    public List<KnnSearchBuilder> knnSearch() {\\n   480\u2192        return Collections.unmodifiableList(knnSearch);\\n   481\u2192    }\\n   482\u2192\\n   483\u2192    public SearchSourceBuilder rankBuilder(RankBuilder rankBuilder) {\\n   484\u2192        deprecationLogger.critical(\\n   485\u2192            DeprecationCategory.API,\\n   486\u2192            \\\"search_api_rank_field\\\",\\n   487\u2192            \\\"The [rank] field in the search request body is deprecated and will be removed in a future version. \\\"\\n   488\u2192                + \\\"Use the [retriever] field instead.\\\"\\n   489\u2192        );\\n   490\u2192        this.rankBuilder = rankBuilder;\\n   491\u2192        return this;\\n\\n<system-reminder>\\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\\n</system-reminder>\\n\"}]},\"parent_tool_use_id\":null,\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"8bee662e-4eee-47e5-b731-8b4acbd80e79\"}\n{\"type\":\"assistant\",\"message\":{\"model\":\"claude-sonnet-4-5-20250929\",\"id\":\"msg_01MuL7NzVdqrcAGzdDyTmWUq\",\"type\":\"message\",\"role\":\"assistant\",\"content\":[{\"type\":\"text\",\"text\":\"Perfect! All the deprecation warnings have been successfully added. Let me create a summary of the changes made:\\n\\n## Summary\\n\\nI've successfully added deprecation warnings for the `rank` and `sub_searches` elements in the Search API. The changes were made to the `SearchSourceBuilder.java` file in four locations:\\n\\n### Changes Made:\\n\\n1. **`rank` field parsing (line 1433)**: Added deprecation warning in the `parseXContent` method when the `RANK_FIELD` is encountered during XContent parsing.\\n\\n2. **`sub_searches` field parsing (line 1626)**: Added deprecation warning in the `parseXContent` method when the `SUB_SEARCHES_FIELD` is encountered during XContent parsing.\\n\\n3. **`rankBuilder` setter method (line 484)**: Added deprecation warning in the `rankBuilder(RankBuilder)` setter method for programmatic API usage.\\n\\n4. **`subSearches` setter method (line 432)**: Added deprecation warning in the `subSearches(List<SubSearchSourceBuilder>)` setter method for programmatic API usage.\\n\\n### Deprecation Details:\\n\\n- **Category**: `DeprecationCategory.API`\\n- **Message**: Both warnings indicate that the respective fields are deprecated and will be removed in a future version, recommending users to use the `[retriever]` field instead.\\n- **Log Level**: `critical` - ensures these deprecation warnings are prominently logged\\n- **Unique Keys**: \\n  - `search_api_rank_field` for rank-related warnings\\n  - `search_api_sub_searches_field` for sub_searches-related warnings\\n\\nThe warnings will now be triggered whenever users:\\n- Use `rank` or `sub_searches` in their search request JSON/XContent\\n- Programmatically call the setter methods `rankBuilder()` or `subSearches()` via the Java API\\n\\nThese changes ensure users are properly notified about the deprecation of these features, guiding them to migrate to the newer `retriever` field as documented.\"}],\"stop_reason\":null,\"stop_sequence\":null,\"usage\":{\"input_tokens\":0,\"cache_creation_input_tokens\":438,\"cache_read_input_tokens\":33016,\"cache_creation\":{\"ephemeral_5m_input_tokens\":438,\"ephemeral_1h_input_tokens\":0},\"output_tokens\":1,\"service_tier\":\"standard\"}},\"parent_tool_use_id\":null,\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"uuid\":\"e8a934ce-a22d-4d96-8336-3be67495da5c\"}\n{\"type\":\"result\",\"subtype\":\"success\",\"is_error\":false,\"duration_ms\":177581,\"duration_api_ms\":179241,\"num_turns\":63,\"result\":\"Perfect! All the deprecation warnings have been successfully added. Let me create a summary of the changes made:\\n\\n## Summary\\n\\nI've successfully added deprecation warnings for the `rank` and `sub_searches` elements in the Search API. The changes were made to the `SearchSourceBuilder.java` file in four locations:\\n\\n### Changes Made:\\n\\n1. **`rank` field parsing (line 1433)**: Added deprecation warning in the `parseXContent` method when the `RANK_FIELD` is encountered during XContent parsing.\\n\\n2. **`sub_searches` field parsing (line 1626)**: Added deprecation warning in the `parseXContent` method when the `SUB_SEARCHES_FIELD` is encountered during XContent parsing.\\n\\n3. **`rankBuilder` setter method (line 484)**: Added deprecation warning in the `rankBuilder(RankBuilder)` setter method for programmatic API usage.\\n\\n4. **`subSearches` setter method (line 432)**: Added deprecation warning in the `subSearches(List<SubSearchSourceBuilder>)` setter method for programmatic API usage.\\n\\n### Deprecation Details:\\n\\n- **Category**: `DeprecationCategory.API`\\n- **Message**: Both warnings indicate that the respective fields are deprecated and will be removed in a future version, recommending users to use the `[retriever]` field instead.\\n- **Log Level**: `critical` - ensures these deprecation warnings are prominently logged\\n- **Unique Keys**: \\n  - `search_api_rank_field` for rank-related warnings\\n  - `search_api_sub_searches_field` for sub_searches-related warnings\\n\\nThe warnings will now be triggered whenever users:\\n- Use `rank` or `sub_searches` in their search request JSON/XContent\\n- Programmatically call the setter methods `rankBuilder()` or `subSearches()` via the Java API\\n\\nThese changes ensure users are properly notified about the deprecation of these features, guiding them to migrate to the newer `retriever` field as documented.\",\"session_id\":\"d38de5e7-a8e6-4471-a515-6bdd971aa562\",\"total_cost_usd\":0.55622005,\"usage\":{\"input_tokens\":30,\"cache_creation_input_tokens\":21013,\"cache_read_input_tokens\":636350,\"output_tokens\":6748,\"server_tool_use\":{\"web_search_requests\":0},\"service_tier\":\"standard\",\"cache_creation\":{\"ephemeral_1h_input_tokens\":0,\"ephemeral_5m_input_tokens\":21013}},\"modelUsage\":{\"claude-haiku-4-5-20251001\":{\"inputTokens\":10918,\"outputTokens\":4541,\"cacheReadInputTokens\":443933,\"cacheCreationInputTokens\":83292,\"webSearchRequests\":0,\"costUSD\":0.1821313,\"contextWindow\":200000},\"claude-sonnet-4-5-20250929\":{\"inputTokens\":450,\"outputTokens\":115,\"cacheReadInputTokens\":0,\"cacheCreationInputTokens\":0,\"webSearchRequests\":0,\"costUSD\":0.003075,\"contextWindow\":200000},\"claude-sonnet-4-5\":{\"inputTokens\":30,\"outputTokens\":6748,\"cacheReadInputTokens\":636350,\"cacheCreationInputTokens\":21013,\"webSearchRequests\":0,\"costUSD\":0.3710137499999999,\"contextWindow\":200000}},\"permission_denials\":[],\"uuid\":\"c3ba0499-9353-432d-a143-1c2eb0b130b1\"}\n", "stderr": "", "returncode": 0}
