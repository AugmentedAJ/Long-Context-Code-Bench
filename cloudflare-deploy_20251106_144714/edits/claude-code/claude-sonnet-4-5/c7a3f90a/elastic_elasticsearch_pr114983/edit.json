{
  "repo_url": "https://github.com/elastic/elasticsearch.git",
  "pr_number": 114983,
  "base_commit": "8e26d18029b66de8e6fa65b6fa1de350ac6ed498",
  "runner": "claude-code",
  "model": "claude-sonnet-4-5",
  "timeout_s": 1200,
  "status": "success",
  "elapsed_ms": 117817,
  "patch_unified": "diff --git a/server/src/main/java/org/elasticsearch/search/retriever/CompoundRetrieverBuilder.java b/server/src/main/java/org/elasticsearch/search/retriever/CompoundRetrieverBuilder.java\nindex e994c55e..a6cd6315 100644\n--- a/server/src/main/java/org/elasticsearch/search/retriever/CompoundRetrieverBuilder.java\n+++ b/server/src/main/java/org/elasticsearch/search/retriever/CompoundRetrieverBuilder.java\n@@ -216,9 +216,6 @@ public abstract class CompoundRetrieverBuilder<T extends CompoundRetrieverBuilde\n             .trackTotalHits(false)\n             .storedFields(new StoredFieldsContext(false))\n             .size(rankWindowSize);\n-        if (preFilterQueryBuilders.isEmpty() == false) {\n-            retrieverBuilder.getPreFilterQueryBuilders().addAll(preFilterQueryBuilders);\n-        }\n         retrieverBuilder.extractToSearchSourceBuilder(sourceBuilder, true);\n \n         // apply the pre-filters\ndiff --git a/x-pack/plugin/inference/src/main/java/org/elasticsearch/xpack/inference/rank/textsimilarity/TextSimilarityRankRetrieverBuilder.java b/x-pack/plugin/inference/src/main/java/org/elasticsearch/xpack/inference/rank/textsimilarity/TextSimilarityRankRetrieverBuilder.java\nindex 8bccf6e7..4d2132dc 100644\n--- a/x-pack/plugin/inference/src/main/java/org/elasticsearch/xpack/inference/rank/textsimilarity/TextSimilarityRankRetrieverBuilder.java\n+++ b/x-pack/plugin/inference/src/main/java/org/elasticsearch/xpack/inference/rank/textsimilarity/TextSimilarityRankRetrieverBuilder.java\n@@ -158,33 +158,9 @@ public class TextSimilarityRankRetrieverBuilder extends CompoundRetrieverBuilder\n         return textSimilarityRankDocs;\n     }\n \n-    @Override\n-    public QueryBuilder explainQuery() {\n-        // the original matching set of the TextSimilarityRank retriever is specified by its nested retriever\n-        return new RankDocsQueryBuilder(rankDocs, new QueryBuilder[] { innerRetrievers.getFirst().retriever().explainQuery() }, true);\n-    }\n-\n     @Override\n     protected SearchSourceBuilder createSearchSourceBuilder(PointInTimeBuilder pit, RetrieverBuilder retrieverBuilder) {\n-        var sourceBuilder = new SearchSourceBuilder().pointInTimeBuilder(pit)\n-            .trackTotalHits(false)\n-            .storedFields(new StoredFieldsContext(false))\n-            .size(rankWindowSize);\n-        if (preFilterQueryBuilders.isEmpty() == false) {\n-            retrieverBuilder.getPreFilterQueryBuilders().addAll(preFilterQueryBuilders);\n-        }\n-        retrieverBuilder.extractToSearchSourceBuilder(sourceBuilder, true);\n-\n-        // apply the pre-filters\n-        if (preFilterQueryBuilders.size() > 0) {\n-            QueryBuilder query = sourceBuilder.query();\n-            BoolQueryBuilder newQuery = new BoolQueryBuilder();\n-            if (query != null) {\n-                newQuery.must(query);\n-            }\n-            preFilterQueryBuilders.forEach(newQuery::filter);\n-            sourceBuilder.query(newQuery);\n-        }\n+        var sourceBuilder = super.createSearchSourceBuilder(pit, retrieverBuilder);\n         sourceBuilder.rankBuilder(\n             new TextSimilarityRankBuilder(this.field, this.inferenceId, this.inferenceText, this.rankWindowSize, this.minScore)\n         );",
  "logs_path": "claude-code/claude-sonnet-4-5/c7a3f90a/elastic_elasticsearch_pr114983/logs.jsonl",
  "errors": [],
  "edit_run_id": "c7a3f90a",
  "test_label": "v0"
}