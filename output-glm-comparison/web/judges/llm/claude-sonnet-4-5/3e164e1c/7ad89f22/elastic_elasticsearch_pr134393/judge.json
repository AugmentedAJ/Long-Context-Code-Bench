{
  "repo_url": "https://github.com/elastic/elasticsearch.git",
  "pr_number": 134393,
  "base_commit": "7d0ee1a56dbe93fafb200da390fbdc491dae81dd",
  "head_commit": "82b652cb1587ad3864ca18e12f14f8cb635a5d9a",
  "judge_mode": "llm",
  "judge_model": "claude-sonnet-4-5",
  "scores": {
    "correctness": -0.3,
    "completeness": -0.5,
    "code_reuse": -0.6,
    "best_practices": -0.4,
    "unsolicited_docs": 0.0
  },
  "aggregate": -0.36,
  "rationale": "The agent's approach differs fundamentally from the ground truth. Ground truth extracts the plan string conditionally (only when needed for DEBUG logging or profiling) and creates a separate addCompletionInfo() method to avoid closing over the PhysicalPlan. Agent instead unconditionally extracts localPlan.toString() before creating the listener, which still creates a memory issue since toString() is always called regardless of whether it's needed. The ground truth's key insight is to defer toString() until after checking if it's needed (needPlanString flag), avoiding the expensive operation when DEBUG is off and profiling is disabled. Agent also extracts output attributes in two other locations (mainPlan, physicalPlan) which weren't part of the ground truth and adds unsolicited comments. The agent misses the core refactoring (addCompletionInfo method) that properly solves the memory problem by avoiding closure over the plan object. Ground truth also includes unrelated changes (removing SET_COMMAND capability, fixing SVG files, removing assumeTrue calls in tests) that agent completely omits, though these appear to be part of a larger PR rather than the specific memory fix.",
  "edit_run_id": "7ad89f22",
  "judge_run_id": "3e164e1c",
  "ground_truth_patch": "diff --git a/docs/reference/query-languages/esql/images/functions/decay.svg b/docs/reference/query-languages/esql/images/functions/decay.svg\nindex 03973b34d27..176ef68b5b7 100644\n--- a/docs/reference/query-languages/esql/images/functions/decay.svg\n+++ b/docs/reference/query-languages/esql/images/functions/decay.svg\n@@ -1 +1 @@\n-<svg version=\"1.1\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" xmlns=\"http://www.w3.org/2000/svg\" width=\"736\" height=\"61\" viewbox=\"0 0 736 61\"><defs><style type=\"text/css\">.c{fill:none;stroke:#222222;}.k{fill:#000000;font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace;font-size:20px;}.s{fill:#e4f4ff;stroke:#222222;}.syn{fill:#8D8D8D;font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace;font-size:20px;}</style></defs><path class=\"c\" d=\"M0 31h5m80 0h10m32 0h10m80 0h10m32 0h10m92 0h10m32 0h10m80 0h30m32 0h10m104 0h20m-181 0q5 0 5 5v10q0 5 5 5h156q5 0 5-5v-10q0-5 5-5m5 0h10m32 0h5\"/><rect class=\"s\" x=\"5\" y=\"5\" width=\"80\" height=\"36\"/><text class=\"k\" x=\"15\" y=\"31\">DECAY</text><rect class=\"s\" x=\"95\" y=\"5\" width=\"32\" height=\"36\" rx=\"7\"/><text class=\"syn\" x=\"105\" y=\"31\">(</text><rect class=\"s\" x=\"137\" y=\"5\" width=\"80\" height=\"36\" rx=\"7\"/><text class=\"k\" x=\"147\" y=\"31\">value</text><rect class=\"s\" x=\"227\" y=\"5\" width=\"32\" height=\"36\" rx=\"7\"/><text class=\"syn\" x=\"237\" y=\"31\">,</text><rect class=\"s\" x=\"269\" y=\"5\" width=\"92\" height=\"36\" rx=\"7\"/><text class=\"k\" x=\"279\" y=\"31\">origin</text><rect class=\"s\" x=\"371\" y=\"5\" width=\"32\" height=\"36\" rx=\"7\"/><text class=\"syn\" x=\"381\" y=\"31\">,</text><rect class=\"s\" x=\"413\" y=\"5\" width=\"80\" height=\"36\" rx=\"7\"/><text class=\"k\" x=\"423\" y=\"31\">scale</text><rect class=\"s\" x=\"523\" y=\"5\" width=\"32\" height=\"36\" rx=\"7\"/><text class=\"syn\" x=\"533\" y=\"31\">,</text><rect class=\"s\" x=\"565\" y=\"5\" width=\"104\" height=\"36\" rx=\"7\"/><text class=\"k\" x=\"575\" y=\"31\">options</text><rect class=\"s\" x=\"699\" y=\"5\" width=\"32\" height=\"36\" rx=\"7\"/><text class=\"syn\" x=\"709\" y=\"31\">)</text></svg>\n\\ No newline at end of file\n+<svg version=\"1.1\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" xmlns=\"http://www.w3.org/2000/svg\" width=\"736\" height=\"61\" viewbox=\"0 0 736 61\"><defs><style type=\"text/css\">.c{fill:none;stroke:#222222;}.k{fill:#000000;font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace;font-size:20px;}.s{fill:#e4f4ff;stroke:#222222;}.syn{fill:#8D8D8D;font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace;font-size:20px;}</style></defs><path class=\"c\" d=\"M0 31h5m80 0h10m32 0h10m80 0h10m32 0h10m92 0h10m32 0h10m80 0h10m32 0h30m104 0h20m-139 0q5 0 5 5v10q0 5 5 5h114q5 0 5-5v-10q0-5 5-5m5 0h10m32 0h5\"/><rect class=\"s\" x=\"5\" y=\"5\" width=\"80\" height=\"36\"/><text class=\"k\" x=\"15\" y=\"31\">DECAY</text><rect class=\"s\" x=\"95\" y=\"5\" width=\"32\" height=\"36\" rx=\"7\"/><text class=\"syn\" x=\"105\" y=\"31\">(</text><rect class=\"s\" x=\"137\" y=\"5\" width=\"80\" height=\"36\" rx=\"7\"/><text class=\"k\" x=\"147\" y=\"31\">value</text><rect class=\"s\" x=\"227\" y=\"5\" width=\"32\" height=\"36\" rx=\"7\"/><text class=\"syn\" x=\"237\" y=\"31\">,</text><rect class=\"s\" x=\"269\" y=\"5\" width=\"92\" height=\"36\" rx=\"7\"/><text class=\"k\" x=\"279\" y=\"31\">origin</text><rect class=\"s\" x=\"371\" y=\"5\" width=\"32\" height=\"36\" rx=\"7\"/><text class=\"syn\" x=\"381\" y=\"31\">,</text><rect class=\"s\" x=\"413\" y=\"5\" width=\"80\" height=\"36\" rx=\"7\"/><text class=\"k\" x=\"423\" y=\"31\">scale</text><rect class=\"s\" x=\"503\" y=\"5\" width=\"32\" height=\"36\" rx=\"7\"/><text class=\"syn\" x=\"513\" y=\"31\">,</text><rect class=\"s\" x=\"565\" y=\"5\" width=\"104\" height=\"36\" rx=\"7\"/><text class=\"k\" x=\"575\" y=\"31\">options</text><rect class=\"s\" x=\"699\" y=\"5\" width=\"32\" height=\"36\" rx=\"7\"/><text class=\"syn\" x=\"709\" y=\"31\">)</text></svg>\n\\ No newline at end of file\ndiff --git a/docs/reference/query-languages/esql/images/functions/knn.svg b/docs/reference/query-languages/esql/images/functions/knn.svg\nindex 326dd00a409..aefae347603 100644\n--- a/docs/reference/query-languages/esql/images/functions/knn.svg\n+++ b/docs/reference/query-languages/esql/images/functions/knn.svg\n@@ -1 +1 @@\n-<svg version=\"1.1\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" xmlns=\"http://www.w3.org/2000/svg\" width=\"568\" height=\"61\" viewbox=\"0 0 568 61\"><defs><style type=\"text/css\">.c{fill:none;stroke:#222222;}.k{fill:#000000;font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace;font-size:20px;}.s{fill:#e4f4ff;stroke:#222222;}.syn{fill:#8D8D8D;font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace;font-size:20px;}</style></defs><path class=\"c\" d=\"M0 31h5m56 0h10m32 0h10m80 0h10m32 0h10m80 0h30m32 0h10m104 0h20m-181 0q5 0 5 5v10q0 5 5 5h156q5 0 5-5v-10q0-5 5-5m5 0h10m32 0h5\"/><rect class=\"s\" x=\"5\" y=\"5\" width=\"56\" height=\"36\"/><text class=\"k\" x=\"15\" y=\"31\">KNN</text><rect class=\"s\" x=\"71\" y=\"5\" width=\"32\" height=\"36\" rx=\"7\"/><text class=\"syn\" x=\"81\" y=\"31\">(</text><rect class=\"s\" x=\"113\" y=\"5\" width=\"80\" height=\"36\" rx=\"7\"/><text class=\"k\" x=\"123\" y=\"31\">field</text><rect class=\"s\" x=\"203\" y=\"5\" width=\"32\" height=\"36\" rx=\"7\"/><text class=\"syn\" x=\"213\" y=\"31\">,</text><rect class=\"s\" x=\"245\" y=\"5\" width=\"80\" height=\"36\" rx=\"7\"/><text class=\"k\" x=\"255\" y=\"31\">query</text><rect class=\"s\" x=\"355\" y=\"5\" width=\"32\" height=\"36\" rx=\"7\"/><text class=\"syn\" x=\"365\" y=\"31\">,</text><rect class=\"s\" x=\"397\" y=\"5\" width=\"104\" height=\"36\" rx=\"7\"/><text class=\"k\" x=\"407\" y=\"31\">options</text><rect class=\"s\" x=\"531\" y=\"5\" width=\"32\" height=\"36\" rx=\"7\"/><text class=\"syn\" x=\"541\" y=\"31\">)</text></svg>\n\\ No newline at end of file\n+<svg version=\"1.1\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" xmlns=\"http://www.w3.org/2000/svg\" width=\"568\" height=\"61\" viewbox=\"0 0 568 61\"><defs><style type=\"text/css\">.c{fill:none;stroke:#222222;}.k{fill:#000000;font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace;font-size:20px;}.s{fill:#e4f4ff;stroke:#222222;}.syn{fill:#8D8D8D;font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace;font-size:20px;}</style></defs><path class=\"c\" d=\"M0 31h5m56 0h10m32 0h10m80 0h10m32 0h10m80 0h10m32 0h30m104 0h20m-139 0q5 0 5 5v10q0 5 5 5h114q5 0 5-5v-10q0-5 5-5m5 0h10m32 0h5\"/><rect class=\"s\" x=\"5\" y=\"5\" width=\"56\" height=\"36\"/><text class=\"k\" x=\"15\" y=\"31\">KNN</text><rect class=\"s\" x=\"71\" y=\"5\" width=\"32\" height=\"36\" rx=\"7\"/><text class=\"syn\" x=\"81\" y=\"31\">(</text><rect class=\"s\" x=\"113\" y=\"5\" width=\"80\" height=\"36\" rx=\"7\"/><text class=\"k\" x=\"123\" y=\"31\">field</text><rect class=\"s\" x=\"203\" y=\"5\" width=\"32\" height=\"36\" rx=\"7\"/><text class=\"syn\" x=\"213\" y=\"31\">,</text><rect class=\"s\" x=\"245\" y=\"5\" width=\"80\" height=\"36\" rx=\"7\"/><text class=\"k\" x=\"255\" y=\"31\">query</text><rect class=\"s\" x=\"335\" y=\"5\" width=\"32\" height=\"36\" rx=\"7\"/><text class=\"syn\" x=\"345\" y=\"31\">,</text><rect class=\"s\" x=\"397\" y=\"5\" width=\"104\" height=\"36\" rx=\"7\"/><text class=\"k\" x=\"407\" y=\"31\">options</text><rect class=\"s\" x=\"531\" y=\"5\" width=\"32\" height=\"36\" rx=\"7\"/><text class=\"syn\" x=\"541\" y=\"31\">)</text></svg>\ndiff --git a/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/action/EsqlCapabilities.java b/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/action/EsqlCapabilities.java\nindex ffa28db2fa7..d9c096ab8a8 100644\n--- a/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/action/EsqlCapabilities.java\n+++ b/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/action/EsqlCapabilities.java\n@@ -1329,11 +1329,6 @@ public class EsqlCapabilities {\n          */\n         FIX_MV_EXPAND_INCONSISTENT_COLUMN_ORDER,\n \n-        /**\n-         * Support for the SET command.\n-         */\n-        SET_COMMAND(Build.current().isSnapshot()),\n-\n         /**\n          * (Re)Added EXPLAIN command\n          */\ndiff --git a/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/plugin/ComputeService.java b/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/plugin/ComputeService.java\nindex dddb41e9510..257b8db73f5 100644\n--- a/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/plugin/ComputeService.java\n+++ b/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/plugin/ComputeService.java\n@@ -19,6 +19,7 @@ import org.elasticsearch.common.util.BigArrays;\n import org.elasticsearch.common.util.concurrent.RunOnce;\n import org.elasticsearch.compute.data.BlockFactory;\n import org.elasticsearch.compute.data.Page;\n+import org.elasticsearch.compute.operator.Driver;\n import org.elasticsearch.compute.operator.DriverCompletionInfo;\n import org.elasticsearch.compute.operator.DriverTaskRunner;\n import org.elasticsearch.compute.operator.FailureCollector;\n@@ -658,31 +659,7 @@ public class ComputeService {\n                 throw new IllegalStateException(\"no drivers created\");\n             }\n             LOGGER.debug(\"using {} drivers\", drivers.size());\n-            ActionListener<Void> driverListener = listener.map(ignored -> {\n-                if (LOGGER.isDebugEnabled()) {\n-                    LOGGER.debug(\n-                        \"finished {}\",\n-                        DriverCompletionInfo.includingProfiles(\n-                            drivers,\n-                            context.description(),\n-                            clusterService.getClusterName().value(),\n-                            transportService.getLocalNode().getName(),\n-                            localPlan.toString()\n-                        )\n-                    );\n-                }\n-                if (context.configuration().profile()) {\n-                    return DriverCompletionInfo.includingProfiles(\n-                        drivers,\n-                        context.description(),\n-                        clusterService.getClusterName().value(),\n-                        transportService.getLocalNode().getName(),\n-                        localPlan.toString()\n-                    );\n-                } else {\n-                    return DriverCompletionInfo.excludingProfiles(drivers);\n-                }\n-            });\n+            ActionListener<Void> driverListener = addCompletionInfo(listener, drivers, context, localPlan);\n             driverRunner.executeDrivers(\n                 task,\n                 drivers,\n@@ -694,6 +671,50 @@ public class ComputeService {\n         }\n     }\n \n+    ActionListener<Void> addCompletionInfo(\n+        ActionListener<DriverCompletionInfo> listener,\n+        List<Driver> drivers,\n+        ComputeContext context,\n+        PhysicalPlan localPlan\n+    ) {\n+        /*\n+         * We *really* don't want to close over the localPlan because it can\n+         * be quite large, and it isn't tracked.\n+         */\n+        boolean needPlanString = LOGGER.isDebugEnabled() || context.configuration().profile();\n+        String planString = needPlanString ? localPlan.toString() : null;\n+        return listener.map(ignored -> {\n+            if (LOGGER.isDebugEnabled()) {\n+                LOGGER.debug(\n+                    \"finished {}\",\n+                    DriverCompletionInfo.includingProfiles(\n+                        drivers,\n+                        context.description(),\n+                        clusterService.getClusterName().value(),\n+                        transportService.getLocalNode().getName(),\n+                        planString\n+                    )\n+                );\n+                /*\n+                 * planString *might* be null if we *just* set DEBUG to *after*\n+                 * we built the listener but before we got here. That's something\n+                 * we can live with.\n+                 */\n+            }\n+            if (context.configuration().profile()) {\n+                return DriverCompletionInfo.includingProfiles(\n+                    drivers,\n+                    context.description(),\n+                    clusterService.getClusterName().value(),\n+                    transportService.getLocalNode().getName(),\n+                    planString\n+                );\n+            } else {\n+                return DriverCompletionInfo.excludingProfiles(drivers);\n+            }\n+        });\n+    }\n+\n     static PhysicalPlan reductionPlan(ExchangeSinkExec plan, boolean enable) {\n         PhysicalPlan reducePlan = new ExchangeSourceExec(plan.source(), plan.output(), plan.isIntermediateAgg());\n         if (enable) {\ndiff --git a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/analysis/ParsingTests.java b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/analysis/ParsingTests.java\nindex 927872ab23c..aa9501f998d 100644\n--- a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/analysis/ParsingTests.java\n+++ b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/analysis/ParsingTests.java\n@@ -213,7 +213,6 @@ public class ParsingTests extends ESTestCase {\n     }\n \n     public void testSet() {\n-        assumeTrue(\"SET command available in snapshot only\", EsqlCapabilities.Cap.SET_COMMAND.isEnabled());\n         EsqlStatement query = parse(\"SET foo = \\\"bar\\\"; row a = 1\", new QueryParams());\n         assertThat(query.plan(), is(instanceOf(Row.class)));\n         assertThat(query.settings().size(), is(1));\n@@ -233,7 +232,6 @@ public class ParsingTests extends ESTestCase {\n     }\n \n     public void testSetWithTripleQuotes() {\n-        assumeTrue(\"SET command available in snapshot only\", EsqlCapabilities.Cap.SET_COMMAND.isEnabled());\n         EsqlStatement query = parse(\"SET foo = \\\"\\\"\\\"bar\\\"baz\\\"\\\"\\\"; row a = 1\", new QueryParams());\n         assertThat(query.plan(), is(instanceOf(Row.class)));\n         assertThat(query.settings().size(), is(1));\n@@ -251,7 +249,6 @@ public class ParsingTests extends ESTestCase {\n     }\n \n     public void testMultipleSet() {\n-        assumeTrue(\"SET command available in snapshot only\", EsqlCapabilities.Cap.SET_COMMAND.isEnabled());\n         EsqlStatement query = parse(\n             \"SET foo = \\\"bar\\\"; SET bar = 2; SET foo = \\\"baz\\\"; SET x = 3.5; SET y = false; SET z = null; row a = 1\",\n             new QueryParams()\n@@ -268,7 +265,6 @@ public class ParsingTests extends ESTestCase {\n     }\n \n     public void testSetArrays() {\n-        assumeTrue(\"SET command available in snapshot only\", EsqlCapabilities.Cap.SET_COMMAND.isEnabled());\n         EsqlStatement query = parse(\"SET foo = [\\\"bar\\\", \\\"baz\\\"]; SET bar = [1, 2, 3]; row a = 1\", new QueryParams());\n         assertThat(query.plan(), is(instanceOf(Row.class)));\n         assertThat(query.settings().size(), is(2));\n@@ -278,7 +274,6 @@ public class ParsingTests extends ESTestCase {\n     }\n \n     public void testSetWithNamedParams() {\n-        assumeTrue(\"SET command available in snapshot only\", EsqlCapabilities.Cap.SET_COMMAND.isEnabled());\n         EsqlStatement query = parse(\n             \"SET foo = \\\"bar\\\"; SET bar = ?a; SET foo = \\\"baz\\\"; SET x = ?x; row a = 1\",\n             new QueryParams(\n@@ -298,7 +293,6 @@ public class ParsingTests extends ESTestCase {\n     }\n \n     public void testSetWithPositionalParams() {\n-        assumeTrue(\"SET command available in snapshot only\", EsqlCapabilities.Cap.SET_COMMAND.isEnabled());\n         EsqlStatement query = parse(\n             \"SET foo = \\\"bar\\\"; SET bar = ?; SET foo = \\\"baz\\\"; SET x = ?; row a = ?\",\n             new QueryParams(\ndiff --git a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/analysis/VerifierTests.java b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/analysis/VerifierTests.java\nindex 3b884921d05..cbbbe7bbece 100644\n--- a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/analysis/VerifierTests.java\n+++ b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/analysis/VerifierTests.java\n@@ -2069,8 +2069,6 @@ public class VerifierTests extends ESTestCase {\n     }\n \n     public void testCategorizeWithInlineStats() {\n-        assumeTrue(\"CATEGORIZE must be enabled\", EsqlCapabilities.Cap.CATEGORIZE_V6.isEnabled());\n-        assumeTrue(\"INLINESTATS must be enabled\", EsqlCapabilities.Cap.INLINESTATS_V11.isEnabled());\n         assertEquals(\n             \"1:37: CATEGORIZE [CATEGORIZE(last_name, { \\\"similarity_threshold\\\": 1 })] is not yet supported with \"\n                 + \"INLINESTATS [INLINESTATS COUNT(*) BY CATEGORIZE(last_name, { \\\"similarity_threshold\\\": 1 })]\",\ndiff --git a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/score/DecayTests.java b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/score/DecayTests.java\nindex c68896b1388..fda42d74a0e 100644\n--- a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/score/DecayTests.java\n+++ b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/scalar/score/DecayTests.java\n@@ -13,7 +13,6 @@ import com.carrotsearch.randomizedtesting.annotations.ParametersFactory;\n import org.elasticsearch.common.geo.GeoPoint;\n import org.elasticsearch.common.unit.DistanceUnit;\n import org.elasticsearch.script.ScoreScriptUtils;\n-import org.elasticsearch.xpack.esql.action.EsqlCapabilities;\n import org.elasticsearch.xpack.esql.core.expression.Expression;\n import org.elasticsearch.xpack.esql.core.expression.Literal;\n import org.elasticsearch.xpack.esql.core.expression.MapExpression;\n@@ -21,7 +20,6 @@ import org.elasticsearch.xpack.esql.core.tree.Source;\n import org.elasticsearch.xpack.esql.core.type.DataType;\n import org.elasticsearch.xpack.esql.expression.function.AbstractScalarFunctionTestCase;\n import org.elasticsearch.xpack.esql.expression.function.TestCaseSupplier;\n-import org.junit.BeforeClass;\n \n import java.time.Duration;\n import java.time.Instant;\n@@ -46,11 +44,6 @@ public class DecayTests extends AbstractScalarFunctionTestCase {\n         this.testCase = testCaseSupplier.get();\n     }\n \n-    @BeforeClass\n-    public static void checkCapability() {\n-        assumeTrue(\"Decay function tests require the DECAY_FUNCTION capability\", EsqlCapabilities.Cap.DECAY_FUNCTION.isEnabled());\n-    }\n-\n     @ParametersFactory\n     public static Iterable<Object[]> parameters() {\n         List<TestCaseSupplier> testCaseSuppliers = new ArrayList<>();\ndiff --git a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/optimizer/OptimizerVerificationTests.java b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/optimizer/OptimizerVerificationTests.java\nindex df7940b0d9f..4e1ba546361 100644\n--- a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/optimizer/OptimizerVerificationTests.java\n+++ b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/optimizer/OptimizerVerificationTests.java\n@@ -431,7 +431,6 @@ public class OptimizerVerificationTests extends AbstractLogicalPlanOptimizerTest\n     }\n \n     public void testDanglingOrderByInInlineStats() {\n-        assumeTrue(\"INLINESTATS must be enabled\", EsqlCapabilities.Cap.INLINESTATS_V11.isEnabled());\n         var analyzer = AnalyzerTestUtils.analyzer(loadMapping(\"mapping-default.json\", \"test\"));\n \n         var err = error(\"\"\"\ndiff --git a/x-pack/plugin/src/yamlRestTest/resources/rest-api-spec/test/esql/60_usage.yml b/x-pack/plugin/src/yamlRestTest/resources/rest-api-spec/test/esql/60_usage.yml\nindex 670caf440f8..5f247067571 100644\n--- a/x-pack/plugin/src/yamlRestTest/resources/rest-api-spec/test/esql/60_usage.yml\n+++ b/x-pack/plugin/src/yamlRestTest/resources/rest-api-spec/test/esql/60_usage.yml\n@@ -225,7 +225,7 @@ setup:\n   - gt: {esql.functions.to_long: $functions_to_long}\n   - match: {esql.functions.coalesce: $functions_coalesce}\n   - gt: {esql.functions.categorize: $functions_categorize}\n-  - length: {esql.functions: 144} # check the \"sister\" test above for a likely update to the same esql.functions length check\n+  - length: {esql.functions: 142} # check the \"sister\" test above for a likely update to the same esql.functions length check\n \n ---\n took:"
}