{
  "repo_url": "https://github.com/elastic/elasticsearch.git",
  "pr_number": 134932,
  "base_commit": "2c656cc5c7861d982378f7c61898529fd40c68a9",
  "head_commit": "da5c975cbe26a6df0906c5d9ce2232518b878759",
  "judge_mode": "llm",
  "judge_model": "claude-sonnet-4-5",
  "scores": {
    "correctness": -0.9,
    "completeness": -0.9,
    "code_reuse": 0.0,
    "best_practices": 0.0,
    "unsolicited_docs": 1.0
  },
  "aggregate": -0.16,
  "rationale": "The agent made only a single change to EsqlCapabilities.java, making INLINESTATS_SUPPORTS_REMOTE depend on EsqlPlugin.INLINESTATS_FEATURE_FLAG. However, this is incorrectâ€”the ground truth shows it should depend on INLINESTATS_V11.enabled. The agent's change references a non-existent or incorrect constant. Additionally, the ground truth includes many other critical changes: modifications to TransportDataStreamsStatsAction.java (changing allSearchableShards to allShards, removing an assertion), updates to RoutingTable.java (removing allSearchableShards method), test configuration changes in 120_data_streams_stats.yml (adding replica settings, adjusting shard counts), and multiple other files. The agent completed less than 10% of the required work and the single change it made uses the wrong dependency constant, making it functionally incorrect.",
  "edit_run_id": "24634b85",
  "judge_run_id": "3e164e1c",
  "ground_truth_patch": "diff --git a/modules/data-streams/src/main/java/org/elasticsearch/datastreams/action/TransportDataStreamsStatsAction.java b/modules/data-streams/src/main/java/org/elasticsearch/datastreams/action/TransportDataStreamsStatsAction.java\nindex e4e942ca79e..adcd597324d 100644\n--- a/modules/data-streams/src/main/java/org/elasticsearch/datastreams/action/TransportDataStreamsStatsAction.java\n+++ b/modules/data-streams/src/main/java/org/elasticsearch/datastreams/action/TransportDataStreamsStatsAction.java\n@@ -106,7 +106,7 @@ public class TransportDataStreamsStatsAction extends TransportBroadcastByNodeAct\n \n     @Override\n     protected ShardsIterator shards(ClusterState clusterState, DataStreamsStatsAction.Request request, String[] concreteIndices) {\n-        return clusterState.routingTable(projectResolver.getProjectId()).allSearchableShards(concreteIndices);\n+        return clusterState.routingTable(projectResolver.getProjectId()).allShards(concreteIndices);\n     }\n \n     @Override\n@@ -117,7 +117,6 @@ public class TransportDataStreamsStatsAction extends TransportBroadcastByNodeAct\n         ActionListener<DataStreamsStatsAction.DataStreamShardStats> listener\n     ) {\n         ActionListener.completeWith(listener, () -> {\n-            assert shardRouting.isSearchable() : \"shard routing is not searchable: \" + shardRouting;\n             IndexService indexService = indicesService.indexServiceSafe(shardRouting.shardId().getIndex());\n             IndexShard indexShard = indexService.getShard(shardRouting.shardId().id());\n             StoreStats storeStats = indexShard.storeStats();\ndiff --git a/modules/data-streams/src/yamlRestTest/resources/rest-api-spec/test/data_stream/120_data_streams_stats.yml b/modules/data-streams/src/yamlRestTest/resources/rest-api-spec/test/data_stream/120_data_streams_stats.yml\nindex b57369ef728..e60741c63af 100644\n--- a/modules/data-streams/src/yamlRestTest/resources/rest-api-spec/test/data_stream/120_data_streams_stats.yml\n+++ b/modules/data-streams/src/yamlRestTest/resources/rest-api-spec/test/data_stream/120_data_streams_stats.yml\n@@ -8,6 +8,9 @@ setup:\n         name: my-template1\n         body:\n           index_patterns: [simple-data-stream1]\n+          template:\n+            settings:\n+              index.number_of_replicas: 0\n           data_stream: {}\n   - do:\n       allowed_warnings:\n@@ -16,6 +19,9 @@ setup:\n         name: my-template2\n         body:\n           index_patterns: [simple-data-stream2]\n+          template:\n+            settings:\n+              index.number_of_replicas: 0\n           data_stream: {}\n \n ---\n@@ -45,10 +51,6 @@ setup:\n       indices.rollover:\n         alias: \"simple-data-stream1\"\n \n-  - do:\n-      cluster.health:\n-        wait_for_no_initializing_shards: true\n-\n   - do:\n       indices.data_streams_stats: {}\n   - match: { data_stream_count: 1 }\n@@ -193,8 +195,8 @@ setup:\n \n   - do:\n       indices.data_streams_stats: {}\n-  - match: { _shards.total: 6 }\n-  - match: { _shards.successful: 6 }\n+  - match: { _shards.total: 3 }\n+  - match: { _shards.successful: 3 }\n   - match: { _shards.failed: 0 }\n   - match: { data_stream_count: 2 }\n   - match: { backing_indices: 3 }\ndiff --git a/muted-tests.yml b/muted-tests.yml\nindex 66e522b5da5..26c41192967 100644\n--- a/muted-tests.yml\n+++ b/muted-tests.yml\n@@ -543,6 +543,9 @@ tests:\n - class: org.elasticsearch.discovery.DiscoveryDisruptionIT\n   method: testElectMasterWithLatestVersion\n   issue: https://github.com/elastic/elasticsearch/issues/134748\n+- class: org.elasticsearch.xpack.esql.qa.single_node.GenerativeIT\n+  method: test\n+  issue: https://github.com/elastic/elasticsearch/issues/134407\n - class: org.elasticsearch.compute.lucene.TimeSeriesSourceOperatorTests\n   method: testSliceIndex\n   issue: https://github.com/elastic/elasticsearch/issues/134808\ndiff --git a/server/src/main/java/org/elasticsearch/cluster/routing/RoutingTable.java b/server/src/main/java/org/elasticsearch/cluster/routing/RoutingTable.java\nindex ade8008d6a1..fe5fd14ce9f 100644\n--- a/server/src/main/java/org/elasticsearch/cluster/routing/RoutingTable.java\n+++ b/server/src/main/java/org/elasticsearch/cluster/routing/RoutingTable.java\n@@ -242,13 +242,6 @@ public class RoutingTable implements Iterable<IndexRoutingTable>, Diffable<Routi\n         return allShardsSatisfyingPredicate(indices, Predicates.always(), false);\n     }\n \n-    /**\n-     * Returns an iterator over all shard routing entries that are searchable (i.e., on a node that can service searches).\n-     */\n-    public ShardsIterator allSearchableShards(String[] indices) {\n-        return allShardsSatisfyingPredicate(indices, ShardRouting::isSearchable, false);\n-    }\n-\n     public ShardsIterator allActiveShards(String[] indices) {\n         return allShardsSatisfyingPredicate(indices, ShardRouting::active, false);\n     }\ndiff --git a/server/src/test/java/org/elasticsearch/index/engine/ThreadPoolMergeExecutorServiceDiskSpaceTests.java b/server/src/test/java/org/elasticsearch/index/engine/ThreadPoolMergeExecutorServiceDiskSpaceTests.java\nindex ffcd58a57c9..cc8d56c2fb3 100644\n--- a/server/src/test/java/org/elasticsearch/index/engine/ThreadPoolMergeExecutorServiceDiskSpaceTests.java\n+++ b/server/src/test/java/org/elasticsearch/index/engine/ThreadPoolMergeExecutorServiceDiskSpaceTests.java\n@@ -83,7 +83,7 @@ public class ThreadPoolMergeExecutorServiceDiskSpaceTests extends ESTestCase {\n         // use 2 data paths\n         String[] paths = new String[] { path.resolve(aPathPart).toString(), path.resolve(bPathPart).toString() };\n         // some tests hold one merge thread blocked, and need at least one other runnable\n-        mergeExecutorThreadCount = randomIntBetween(2, 8);\n+        mergeExecutorThreadCount = randomIntBetween(2, 9);\n         Settings.Builder settingsBuilder = Settings.builder()\n             .put(Environment.PATH_HOME_SETTING.getKey(), path)\n             .putList(Environment.PATH_DATA_SETTING.getKey(), paths)\ndiff --git a/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/action/EsqlCapabilities.java b/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/action/EsqlCapabilities.java\nindex 4de0c461b09..e216c1f80ae 100644\n--- a/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/action/EsqlCapabilities.java\n+++ b/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/action/EsqlCapabilities.java\n@@ -1505,7 +1505,7 @@ public class EsqlCapabilities {\n         ABSENT_OVER_TIME(Build.current().isSnapshot()),\n \n         /** INLINESTATS supports remote indices */\n-        INLINESTATS_SUPPORTS_REMOTE;\n+        INLINESTATS_SUPPORTS_REMOTE(INLINESTATS_V11.enabled);\n \n         private final boolean enabled;\n "
}