{
  "repo_url": "https://github.com/elastic/elasticsearch.git",
  "pr_number": 4466,
  "base_commit": "f4bf0d5112b5c6f29b651586d72c3972db5a2834",
  "head_commit": "8d4be46e5931f3fc1723768276eaa54ffbe11dde",
  "judge_mode": "llm",
  "judge_model": "claude-sonnet-4-5",
  "scores": {
    "correctness": -0.8,
    "completeness": -0.3,
    "code_reuse": -0.5,
    "best_practices": -0.7,
    "unsolicited_docs": 1.0
  },
  "aggregate": -0.25999999999999995,
  "rationale": "The agent's implementation has a critical correctness flaw: it calls `toLowerCase()` multiple times on the full string in each condition, which is inefficient and could cause issues with locale-sensitive conversions. The ground truth extracts the last two characters once and converts them using `Locale.ROOT` to avoid locale-dependent behavior. The agent only handles two-letter suffixes (kb, mb, gb) case-insensitively but leaves single-letter suffixes (k, m, g) as separate OR conditions, failing to make them truly case-insensitive in a unified way. The ground truth imports `java.util.Locale` and uses a more robust approach. The agent's test is more comprehensive in testing mixed-case combinations but doesn't include the edge case tests (empty string, unit-only string) that the ground truth provides. The agent also doesn't import ElasticSearchParseException as the ground truth does. The approach is less efficient (multiple toLowerCase calls vs. one) and doesn't follow the locale-safety best practice.",
  "edit_run_id": "24634b85",
  "judge_run_id": "3e164e1c",
  "ground_truth_patch": "diff --git a/src/main/java/org/elasticsearch/common/unit/ByteSizeValue.java b/src/main/java/org/elasticsearch/common/unit/ByteSizeValue.java\nindex 0c4e9b167be..8184c71364e 100644\n--- a/src/main/java/org/elasticsearch/common/unit/ByteSizeValue.java\n+++ b/src/main/java/org/elasticsearch/common/unit/ByteSizeValue.java\n@@ -28,6 +28,7 @@ import org.elasticsearch.common.io.stream.Streamable;\n \n import java.io.IOException;\n import java.io.Serializable;\n+import java.util.Locale;\n \n /**\n  *\n@@ -143,19 +144,20 @@ public class ByteSizeValue implements Serializable, Streamable {\n         }\n         long bytes;\n         try {\n-            if (sValue.endsWith(\"k\") || sValue.endsWith(\"K\")) {\n+            String lastTwoChars = sValue.substring(sValue.length() - Math.min(2, sValue.length())).toLowerCase(Locale.ROOT);\n+            if (lastTwoChars.endsWith(\"k\")) {\n                 bytes = (long) (Double.parseDouble(sValue.substring(0, sValue.length() - 1)) * ByteSizeUnit.C1);\n-            } else if (sValue.endsWith(\"kb\")) {\n+            } else if (lastTwoChars.endsWith(\"kb\")) {\n                 bytes = (long) (Double.parseDouble(sValue.substring(0, sValue.length() - 2)) * ByteSizeUnit.C1);\n-            } else if (sValue.endsWith(\"m\") || sValue.endsWith(\"M\")) {\n+            } else if (lastTwoChars.endsWith(\"m\")) {\n                 bytes = (long) (Double.parseDouble(sValue.substring(0, sValue.length() - 1)) * ByteSizeUnit.C2);\n-            } else if (sValue.endsWith(\"mb\")) {\n+            } else if (lastTwoChars.endsWith(\"mb\")) {\n                 bytes = (long) (Double.parseDouble(sValue.substring(0, sValue.length() - 2)) * ByteSizeUnit.C2);\n-            } else if (sValue.endsWith(\"g\") || sValue.endsWith(\"G\")) {\n+            } else if (lastTwoChars.endsWith(\"g\")) {\n                 bytes = (long) (Double.parseDouble(sValue.substring(0, sValue.length() - 1)) * ByteSizeUnit.C3);\n-            } else if (sValue.endsWith(\"gb\")) {\n+            } else if (lastTwoChars.endsWith(\"gb\")) {\n                 bytes = (long) (Double.parseDouble(sValue.substring(0, sValue.length() - 2)) * ByteSizeUnit.C3);\n-            } else if (sValue.endsWith(\"b\")) {\n+            } else if (lastTwoChars.endsWith(\"b\")) {\n                 bytes = Long.parseLong(sValue.substring(0, sValue.length() - 1));\n             } else {\n                 bytes = Long.parseLong(sValue);\ndiff --git a/src/test/java/org/elasticsearch/common/unit/ByteSizeValueTests.java b/src/test/java/org/elasticsearch/common/unit/ByteSizeValueTests.java\nindex 17d6437b923..b4377a65cd5 100644\n--- a/src/test/java/org/elasticsearch/common/unit/ByteSizeValueTests.java\n+++ b/src/test/java/org/elasticsearch/common/unit/ByteSizeValueTests.java\n@@ -19,6 +19,7 @@\n \n package org.elasticsearch.common.unit;\n \n+import org.elasticsearch.ElasticSearchParseException;\n import org.elasticsearch.test.ElasticsearchTestCase;\n import org.hamcrest.MatcherAssert;\n import org.junit.Test;\n@@ -53,4 +54,26 @@ public class ByteSizeValueTests extends ElasticsearchTestCase {\n         assertThat(\"1.5gb\", is(new ByteSizeValue((long) (1024 * 1.5), ByteSizeUnit.MB).toString()));\n         assertThat(\"1536gb\", is(new ByteSizeValue((long) (1024 * 1.5), ByteSizeUnit.GB).toString()));\n     }\n+\n+    @Test\n+    public void testParsing() {\n+        assertThat(ByteSizeValue.parseBytesSizeValue(\"12gb\").toString(), is(\"12gb\"));\n+        assertThat(ByteSizeValue.parseBytesSizeValue(\"12G\").toString(), is(\"12gb\"));\n+        assertThat(ByteSizeValue.parseBytesSizeValue(\"12GB\").toString(), is(\"12gb\"));\n+        assertThat(ByteSizeValue.parseBytesSizeValue(\"12M\").toString(), is(\"12mb\"));\n+        assertThat(ByteSizeValue.parseBytesSizeValue(\"1b\").toString(), is(\"1b\"));\n+        assertThat(ByteSizeValue.parseBytesSizeValue(\"23kb\").toString(), is(\"23kb\"));\n+        assertThat(ByteSizeValue.parseBytesSizeValue(\"23k\").toString(), is(\"23kb\"));\n+        assertThat(ByteSizeValue.parseBytesSizeValue(\"23\").toString(), is(\"23b\"));\n+    }\n+\n+    @Test(expected = ElasticSearchParseException.class)\n+    public void testFailOnEmptyParsing() {\n+        assertThat(ByteSizeValue.parseBytesSizeValue(\"\").toString(), is(\"23kb\"));\n+    }\n+\n+    @Test(expected = ElasticSearchParseException.class)\n+    public void testFailOnEmptyNumberParsing() {\n+        assertThat(ByteSizeValue.parseBytesSizeValue(\"g\").toString(), is(\"23b\"));\n+    }\n }"
}