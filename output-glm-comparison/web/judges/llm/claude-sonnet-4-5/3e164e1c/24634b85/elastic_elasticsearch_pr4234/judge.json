{
  "repo_url": "https://github.com/elastic/elasticsearch.git",
  "pr_number": 4234,
  "base_commit": "7d3b78c29327a1774695c4567bab0c40e7b97b6a",
  "head_commit": "c4f3da2b9d6294a1871a87b3e489f9896b95f72e",
  "judge_mode": "llm",
  "judge_model": "claude-sonnet-4-5",
  "scores": {
    "correctness": -0.3,
    "completeness": -0.7,
    "code_reuse": -0.5,
    "best_practices": -0.2,
    "unsolicited_docs": 1.0
  },
  "aggregate": -0.13999999999999999,
  "rationale": "The agent's implementation has several issues compared to ground truth: (1) Correctness: Uses inline validation instead of extracted helper method, and uses `nodes.get(nodeId)` instead of `nodes.dataNodes().keys().contains(nodeId)`, which may check all nodes rather than just data nodes as required by the error message context. (2) Completeness: Missing the required test file changes entirely (SearchPreferenceTests.java), which is a major omission - no test was added to verify the new error handling behavior. (3) Code Reuse: Duplicates validation logic inline for both `_prefer_node` and `_only_node` cases instead of extracting to a reusable helper method like `ensureNodeIdExists()`. (4) Best Practices: Inline comments are unnecessary and the error message format differs slightly from ground truth. Also added validation to `_prefer_node` which was not requested in the task (only `_only_node` was mentioned). (5) Unsolicited Docs: No unsolicited documentation added.",
  "edit_run_id": "24634b85",
  "judge_run_id": "3e164e1c",
  "ground_truth_patch": "diff --git a/src/main/java/org/elasticsearch/cluster/routing/operation/plain/PlainOperationRouting.java b/src/main/java/org/elasticsearch/cluster/routing/operation/plain/PlainOperationRouting.java\nindex 3b5376ae799..61f61cd7b0c 100644\n--- a/src/main/java/org/elasticsearch/cluster/routing/operation/plain/PlainOperationRouting.java\n+++ b/src/main/java/org/elasticsearch/cluster/routing/operation/plain/PlainOperationRouting.java\n@@ -219,7 +219,9 @@ public class PlainOperationRouting extends AbstractComponent implements Operatio\n                 return indexShard.onlyNodeActiveInitializingShardsIt(localNodeId);\n             }\n             if (preference.startsWith(\"_only_node:\")) {\n-                return indexShard.onlyNodeActiveInitializingShardsIt(preference.substring(\"_only_node:\".length()));\n+                String nodeId = preference.substring(\"_only_node:\".length());\n+                ensureNodeIdExists(nodes, nodeId);\n+                return indexShard.onlyNodeActiveInitializingShardsIt(nodeId);\n             }\n         }\n         // if not, then use it as the index\n@@ -284,4 +286,10 @@ public class PlainOperationRouting extends AbstractComponent implements Operatio\n         }\n         return hashFunction.hash(type, id);\n     }\n+\n+    private void ensureNodeIdExists(DiscoveryNodes nodes, String nodeId) {\n+        if (!nodes.dataNodes().keys().contains(nodeId)) {\n+            throw new ElasticSearchIllegalArgumentException(\"No data node with id[\" + nodeId + \"] found\");\n+        }\n+    }\n }\ndiff --git a/src/test/java/org/elasticsearch/search/preference/SearchPreferenceTests.java b/src/test/java/org/elasticsearch/search/preference/SearchPreferenceTests.java\nindex 870303dff7b..2a0448b8b3e 100644\n--- a/src/test/java/org/elasticsearch/search/preference/SearchPreferenceTests.java\n+++ b/src/test/java/org/elasticsearch/search/preference/SearchPreferenceTests.java\n@@ -19,6 +19,7 @@\n \n package org.elasticsearch.search.preference;\n \n+import org.elasticsearch.ElasticSearchIllegalArgumentException;\n import org.elasticsearch.action.admin.cluster.health.ClusterHealthStatus;\n import org.elasticsearch.action.search.SearchResponse;\n import org.elasticsearch.action.search.SearchType;\n@@ -96,4 +97,12 @@ public class SearchPreferenceTests extends ElasticsearchIntegrationTest {\n         searchResponse = client().prepareSearch().setQuery(matchAllQuery()).setPreference(\"1234\").execute().actionGet();\n         assertThat(searchResponse.getHits().totalHits(), equalTo(1l));\n     }\n+\n+    @Test (expected = ElasticSearchIllegalArgumentException.class)\n+    public void testThatSpecifyingNonExistingNodesReturnsUsefulError() throws Exception {\n+        createIndex(\"test\");\n+        ensureGreen();\n+\n+        client().prepareSearch().setQuery(matchAllQuery()).setPreference(\"_only_node:DOES-NOT-EXIST\").execute().actionGet();\n+    }\n }"
}