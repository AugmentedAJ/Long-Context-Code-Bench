{
  "repo_url": "https://github.com/elastic/elasticsearch.git",
  "pr_number": 4466,
  "base_commit": "f4bf0d5112b5c6f29b651586d72c3972db5a2834",
  "head_commit": "8d4be46e5931f3fc1723768276eaa54ffbe11dde",
  "judge_mode": "llm",
  "judge_model": "claude-sonnet-4-5",
  "scores": {
    "correctness": -0.3,
    "completeness": 0.0,
    "code_reuse": 0.0,
    "best_practices": -0.5,
    "unsolicited_docs": 1.0
  },
  "aggregate": 0.039999999999999994,
  "rationale": "The agent's implementation has a critical correctness issue: it uses `sValue.toLowerCase()` without specifying a Locale, which can cause problems in Turkish and other locales where 'I'.toLowerCase() != 'i'. The ground truth explicitly uses `Locale.ROOT` to avoid this. Additionally, the agent doesn't import `java.util.Locale` as the ground truth does. The agent also misses the ground truth's optimization of extracting only the last two characters (`lastTwoChars`) instead of converting the entire string to lowercase, which is more efficient. However, the agent does implement the core functionality (case-insensitive parsing) and adds comprehensive tests. The tests are actually more thorough than ground truth (testing more case combinations), but they use `.bytes()` comparison instead of `.toString()` like ground truth, and don't include the error-case tests (empty string, unit without number) that ground truth has. Overall: correctness is impacted by the locale bug (-0.3), completeness is roughly equal (0.0), code_reuse is similar (0.0), best practices is worse due to the locale issue and less efficient string conversion (-0.5), and no unsolicited docs (1.0).",
  "edit_run_id": "8d6f99fc",
  "judge_run_id": "3e164e1c",
  "ground_truth_patch": "diff --git a/src/main/java/org/elasticsearch/common/unit/ByteSizeValue.java b/src/main/java/org/elasticsearch/common/unit/ByteSizeValue.java\nindex 0c4e9b167be..8184c71364e 100644\n--- a/src/main/java/org/elasticsearch/common/unit/ByteSizeValue.java\n+++ b/src/main/java/org/elasticsearch/common/unit/ByteSizeValue.java\n@@ -28,6 +28,7 @@ import org.elasticsearch.common.io.stream.Streamable;\n \n import java.io.IOException;\n import java.io.Serializable;\n+import java.util.Locale;\n \n /**\n  *\n@@ -143,19 +144,20 @@ public class ByteSizeValue implements Serializable, Streamable {\n         }\n         long bytes;\n         try {\n-            if (sValue.endsWith(\"k\") || sValue.endsWith(\"K\")) {\n+            String lastTwoChars = sValue.substring(sValue.length() - Math.min(2, sValue.length())).toLowerCase(Locale.ROOT);\n+            if (lastTwoChars.endsWith(\"k\")) {\n                 bytes = (long) (Double.parseDouble(sValue.substring(0, sValue.length() - 1)) * ByteSizeUnit.C1);\n-            } else if (sValue.endsWith(\"kb\")) {\n+            } else if (lastTwoChars.endsWith(\"kb\")) {\n                 bytes = (long) (Double.parseDouble(sValue.substring(0, sValue.length() - 2)) * ByteSizeUnit.C1);\n-            } else if (sValue.endsWith(\"m\") || sValue.endsWith(\"M\")) {\n+            } else if (lastTwoChars.endsWith(\"m\")) {\n                 bytes = (long) (Double.parseDouble(sValue.substring(0, sValue.length() - 1)) * ByteSizeUnit.C2);\n-            } else if (sValue.endsWith(\"mb\")) {\n+            } else if (lastTwoChars.endsWith(\"mb\")) {\n                 bytes = (long) (Double.parseDouble(sValue.substring(0, sValue.length() - 2)) * ByteSizeUnit.C2);\n-            } else if (sValue.endsWith(\"g\") || sValue.endsWith(\"G\")) {\n+            } else if (lastTwoChars.endsWith(\"g\")) {\n                 bytes = (long) (Double.parseDouble(sValue.substring(0, sValue.length() - 1)) * ByteSizeUnit.C3);\n-            } else if (sValue.endsWith(\"gb\")) {\n+            } else if (lastTwoChars.endsWith(\"gb\")) {\n                 bytes = (long) (Double.parseDouble(sValue.substring(0, sValue.length() - 2)) * ByteSizeUnit.C3);\n-            } else if (sValue.endsWith(\"b\")) {\n+            } else if (lastTwoChars.endsWith(\"b\")) {\n                 bytes = Long.parseLong(sValue.substring(0, sValue.length() - 1));\n             } else {\n                 bytes = Long.parseLong(sValue);\ndiff --git a/src/test/java/org/elasticsearch/common/unit/ByteSizeValueTests.java b/src/test/java/org/elasticsearch/common/unit/ByteSizeValueTests.java\nindex 17d6437b923..b4377a65cd5 100644\n--- a/src/test/java/org/elasticsearch/common/unit/ByteSizeValueTests.java\n+++ b/src/test/java/org/elasticsearch/common/unit/ByteSizeValueTests.java\n@@ -19,6 +19,7 @@\n \n package org.elasticsearch.common.unit;\n \n+import org.elasticsearch.ElasticSearchParseException;\n import org.elasticsearch.test.ElasticsearchTestCase;\n import org.hamcrest.MatcherAssert;\n import org.junit.Test;\n@@ -53,4 +54,26 @@ public class ByteSizeValueTests extends ElasticsearchTestCase {\n         assertThat(\"1.5gb\", is(new ByteSizeValue((long) (1024 * 1.5), ByteSizeUnit.MB).toString()));\n         assertThat(\"1536gb\", is(new ByteSizeValue((long) (1024 * 1.5), ByteSizeUnit.GB).toString()));\n     }\n+\n+    @Test\n+    public void testParsing() {\n+        assertThat(ByteSizeValue.parseBytesSizeValue(\"12gb\").toString(), is(\"12gb\"));\n+        assertThat(ByteSizeValue.parseBytesSizeValue(\"12G\").toString(), is(\"12gb\"));\n+        assertThat(ByteSizeValue.parseBytesSizeValue(\"12GB\").toString(), is(\"12gb\"));\n+        assertThat(ByteSizeValue.parseBytesSizeValue(\"12M\").toString(), is(\"12mb\"));\n+        assertThat(ByteSizeValue.parseBytesSizeValue(\"1b\").toString(), is(\"1b\"));\n+        assertThat(ByteSizeValue.parseBytesSizeValue(\"23kb\").toString(), is(\"23kb\"));\n+        assertThat(ByteSizeValue.parseBytesSizeValue(\"23k\").toString(), is(\"23kb\"));\n+        assertThat(ByteSizeValue.parseBytesSizeValue(\"23\").toString(), is(\"23b\"));\n+    }\n+\n+    @Test(expected = ElasticSearchParseException.class)\n+    public void testFailOnEmptyParsing() {\n+        assertThat(ByteSizeValue.parseBytesSizeValue(\"\").toString(), is(\"23kb\"));\n+    }\n+\n+    @Test(expected = ElasticSearchParseException.class)\n+    public void testFailOnEmptyNumberParsing() {\n+        assertThat(ByteSizeValue.parseBytesSizeValue(\"g\").toString(), is(\"23b\"));\n+    }\n }"
}