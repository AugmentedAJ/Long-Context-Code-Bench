{
  "repo_url": "https://github.com/elastic/elasticsearch.git",
  "pr_number": 3947,
  "base_commit": "e79f714b4b066f9238ff6313aad9a854c37a8c3d",
  "head_commit": "f9154de04f576077d879a777a5587661cf1e094d",
  "judge_mode": "llm",
  "judge_model": "claude-sonnet-4-5",
  "scores": {
    "correctness": 0.0,
    "completeness": -0.3,
    "code_reuse": 0.0,
    "best_practices": -0.2,
    "unsolicited_docs": 1.0
  },
  "aggregate": 0.1,
  "rationale": "Correctness: The agent correctly validates number types and rejects floats/doubles, achieving the core functionality. Both approaches work, though the ground truth uses positive checking (LONG/INT) while the agent uses negative checking (FLOAT/DOUBLE). Completeness: Major penalty because the agent added tests in CompletionFieldMapperTests.java (a unit test file) instead of CompletionSuggestSearchTests.java (the integration test file used in ground truth). The ground truth test actually indexes a document and catches MapperParsingException, while the agent's tests only parse documents at the mapper level. This is a significant difference in test coverage and location. Code Reuse: Both solutions appropriately use parser.numberType() without unnecessary duplication. Best Practices: Minor penalty for not importing NumberType statically as ground truth does, and for less informative error messages (ground truth includes the actual value '2.5' in the message via parser.numberValue(), while agent uses generic text). The agent also doesn't update the existing error message format to include brackets around the weight value as ground truth does. Unsolicited Docs: No documentation added.",
  "edit_run_id": "8d6f99fc",
  "judge_run_id": "3e164e1c",
  "ground_truth_patch": "diff --git a/src/main/java/org/elasticsearch/index/mapper/core/CompletionFieldMapper.java b/src/main/java/org/elasticsearch/index/mapper/core/CompletionFieldMapper.java\nindex bc4c09706ed..3507eb4e92d 100644\n--- a/src/main/java/org/elasticsearch/index/mapper/core/CompletionFieldMapper.java\n+++ b/src/main/java/org/elasticsearch/index/mapper/core/CompletionFieldMapper.java\n@@ -45,6 +45,8 @@ import java.util.Locale;\n import java.util.Map;\n import java.util.Set;\n \n+import static org.elasticsearch.common.xcontent.XContentParser.NumberType;\n+\n /**\n  *\n  */\n@@ -248,9 +250,13 @@ public class CompletionFieldMapper extends AbstractFieldMapper<String> {\n                     }\n                 } else if (token == XContentParser.Token.VALUE_NUMBER) {\n                     if (Fields.CONTENT_FIELD_NAME_WEIGHT.equals(currentFieldName)) {\n+                        NumberType numberType = parser.numberType();\n+                        if (NumberType.LONG != numberType && NumberType.INT != numberType) {\n+                            throw new ElasticSearchIllegalArgumentException(\"Weight must be an integer, but was [\" + parser.numberValue() + \"]\");\n+                        }\n                         weight = parser.longValue(); // always parse a long to make sure we don't get the overflow value\n                         if (weight < 0 || weight > Integer.MAX_VALUE) {\n-                            throw new ElasticSearchIllegalArgumentException(\"Weight must be in the interval [0..2147483647] but was \" + weight);\n+                            throw new ElasticSearchIllegalArgumentException(\"Weight must be in the interval [0..2147483647], but was [\" + weight + \"]\");\n                         }\n                     }\n                 } else if (token == XContentParser.Token.START_ARRAY) {\ndiff --git a/src/test/java/org/elasticsearch/search/suggest/CompletionSuggestSearchTests.java b/src/test/java/org/elasticsearch/search/suggest/CompletionSuggestSearchTests.java\nindex db4e0bc0193..0285a270223 100644\n--- a/src/test/java/org/elasticsearch/search/suggest/CompletionSuggestSearchTests.java\n+++ b/src/test/java/org/elasticsearch/search/suggest/CompletionSuggestSearchTests.java\n@@ -20,6 +20,7 @@ package org.elasticsearch.search.suggest;\n \n import com.carrotsearch.randomizedtesting.generators.RandomStrings;\n import com.google.common.collect.Lists;\n+import org.elasticsearch.ExceptionsHelper;\n import org.elasticsearch.action.admin.cluster.health.ClusterHealthStatus;\n import org.elasticsearch.action.admin.indices.mapping.put.PutMappingResponse;\n import org.elasticsearch.action.admin.indices.optimize.OptimizeResponse;\n@@ -120,6 +121,23 @@ public class CompletionSuggestSearchTests extends AbstractIntegrationTest {\n         assertSuggestions(\"the\", \"the\", \"The the\", \"The Verve\", \"The Prodigy\");\n     }\n \n+    @Test\n+    public void testThatWeightMustBeAnInteger() throws Exception {\n+        createIndexAndMapping();\n+\n+        try {\n+            client().prepareIndex(INDEX, TYPE, \"1\").setSource(jsonBuilder()\n+                    .startObject().startObject(FIELD)\n+                    .startArray(\"input\").value(\"sth\").endArray()\n+                    .field(\"weight\", 2.5)\n+                    .endObject().endObject()\n+            ).get();\n+            fail(\"Indexing with a float weight was successful, but should not be\");\n+        } catch (MapperParsingException e) {\n+            assertThat(ExceptionsHelper.detailedMessage(e), containsString(\"2.5\"));\n+        }\n+    }\n+\n     @Test\n     public void testThatInputCanBeAStringInsteadOfAnArray() throws Exception {\n         createIndexAndMapping();"
}