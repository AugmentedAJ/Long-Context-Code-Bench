{
  "repo_url": "https://github.com/elastic/elasticsearch.git",
  "pr_number": 134296,
  "base_commit": "df8cedf9920c8bf710221ca8579bb90f64d4faa0",
  "head_commit": "5f30c5ee0990fa6e906a188b51cf29de81e65c5a",
  "judge_mode": "llm",
  "judge_model": "claude-sonnet-4-5",
  "scores": {
    "correctness": -0.3,
    "completeness": -0.6,
    "code_reuse": 0.0,
    "best_practices": -0.5,
    "unsolicited_docs": 1.0
  },
  "aggregate": -0.07999999999999999,
  "rationale": "The agent made the core timestamp formatting changes in HttpStats.java using timestampFieldsFromUnixEpochMillis, which correctly addresses the human-readable format requirement. However, it suffers from several critical issues: (1) Missing constant definitions - the ground truth adds CLIENT_OPENED_TIME, CLIENT_CLOSED_TIME, and CLIENT_LAST_REQUEST_TIME constants to the Fields inner class, but the agent uses hardcoded string literals ('opened_time', 'closed_time', 'last_request_time') instead, violating the existing pattern where all field names are defined as constants; (2) Missing interface change - the ground truth changes ClientStats from implementing ToXContentFragment to ToXContentObject, which is a semantically important change that the agent omitted; (3) Missing test coverage - the ground truth adds a comprehensive testToXContent() test method to verify the human-readable timestamp formatting works correctly, which the agent completely omitted; (4) Missing changelog entry - the ground truth includes a changelog file (docs/changelog/134296.yaml) documenting the enhancement, which the agent did not create. The agent's approach works functionally for the timestamp formatting but represents incomplete implementation with poor adherence to the codebase's existing patterns.",
  "edit_run_id": "8d6f99fc",
  "judge_run_id": "3e164e1c",
  "ground_truth_patch": "diff --git a/docs/changelog/134296.yaml b/docs/changelog/134296.yaml\nnew file mode 100644\nindex 00000000000..b7ac7ea6bfd\n--- /dev/null\n+++ b/docs/changelog/134296.yaml\n@@ -0,0 +1,5 @@\n+pr: 134296\n+summary: Add human-readable HTTP client stats\n+area: Network\n+type: enhancement\n+issues: []\ndiff --git a/server/src/main/java/org/elasticsearch/http/HttpStats.java b/server/src/main/java/org/elasticsearch/http/HttpStats.java\nindex d4df9c8f59a..f9ccc4f90b7 100644\n--- a/server/src/main/java/org/elasticsearch/http/HttpStats.java\n+++ b/server/src/main/java/org/elasticsearch/http/HttpStats.java\n@@ -15,7 +15,7 @@ import org.elasticsearch.common.io.stream.StreamOutput;\n import org.elasticsearch.common.io.stream.Writeable;\n import org.elasticsearch.common.xcontent.ChunkedToXContent;\n import org.elasticsearch.xcontent.ToXContent;\n-import org.elasticsearch.xcontent.ToXContentFragment;\n+import org.elasticsearch.xcontent.ToXContentObject;\n import org.elasticsearch.xcontent.XContentBuilder;\n \n import java.io.IOException;\n@@ -89,8 +89,11 @@ public record HttpStats(long serverOpen, long totalOpen, List<ClientStats> clien\n         static final String CLIENT_LOCAL_ADDRESS = \"local_address\";\n         static final String CLIENT_REMOTE_ADDRESS = \"remote_address\";\n         static final String CLIENT_LAST_URI = \"last_uri\";\n+        static final String CLIENT_OPENED_TIME = \"opened_time\";\n         static final String CLIENT_OPENED_TIME_MILLIS = \"opened_time_millis\";\n+        static final String CLIENT_CLOSED_TIME = \"closed_time\";\n         static final String CLIENT_CLOSED_TIME_MILLIS = \"closed_time_millis\";\n+        static final String CLIENT_LAST_REQUEST_TIME = \"last_request_time\";\n         static final String CLIENT_LAST_REQUEST_TIME_MILLIS = \"last_request_time_millis\";\n         static final String CLIENT_REQUEST_COUNT = \"request_count\";\n         static final String CLIENT_REQUEST_SIZE_BYTES = \"request_size_bytes\";\n@@ -136,7 +139,7 @@ public record HttpStats(long serverOpen, long totalOpen, List<ClientStats> clien\n         long lastRequestTimeMillis,\n         long requestCount,\n         long requestSizeBytes\n-    ) implements Writeable, ToXContentFragment {\n+    ) implements Writeable, ToXContentObject {\n \n         public static final long NOT_CLOSED = -1L;\n \n@@ -179,11 +182,15 @@ public record HttpStats(long serverOpen, long totalOpen, List<ClientStats> clien\n             if (opaqueId != null) {\n                 builder.field(Fields.CLIENT_OPAQUE_ID, opaqueId);\n             }\n-            builder.field(Fields.CLIENT_OPENED_TIME_MILLIS, openedTimeMillis);\n+            builder.timestampFieldsFromUnixEpochMillis(Fields.CLIENT_OPENED_TIME_MILLIS, Fields.CLIENT_OPENED_TIME, openedTimeMillis);\n             if (closedTimeMillis != NOT_CLOSED) {\n-                builder.field(Fields.CLIENT_CLOSED_TIME_MILLIS, closedTimeMillis);\n+                builder.timestampFieldsFromUnixEpochMillis(Fields.CLIENT_CLOSED_TIME_MILLIS, Fields.CLIENT_CLOSED_TIME, closedTimeMillis);\n             }\n-            builder.field(Fields.CLIENT_LAST_REQUEST_TIME_MILLIS, lastRequestTimeMillis);\n+            builder.timestampFieldsFromUnixEpochMillis(\n+                Fields.CLIENT_LAST_REQUEST_TIME_MILLIS,\n+                Fields.CLIENT_LAST_REQUEST_TIME,\n+                lastRequestTimeMillis\n+            );\n             builder.field(Fields.CLIENT_REQUEST_COUNT, requestCount);\n             builder.field(Fields.CLIENT_REQUEST_SIZE_BYTES, requestSizeBytes);\n             builder.endObject();\ndiff --git a/server/src/test/java/org/elasticsearch/http/HttpClientStatsTrackerTests.java b/server/src/test/java/org/elasticsearch/http/HttpClientStatsTrackerTests.java\nindex a1129e4a717..d3a2e12c5aa 100644\n--- a/server/src/test/java/org/elasticsearch/http/HttpClientStatsTrackerTests.java\n+++ b/server/src/test/java/org/elasticsearch/http/HttpClientStatsTrackerTests.java\n@@ -9,11 +9,14 @@\n \n package org.elasticsearch.http;\n \n+import org.elasticsearch.common.Strings;\n import org.elasticsearch.common.bytes.BytesArray;\n+import org.elasticsearch.common.bytes.BytesReference;\n import org.elasticsearch.common.network.NetworkAddress;\n import org.elasticsearch.common.settings.ClusterSettings;\n import org.elasticsearch.common.settings.Settings;\n import org.elasticsearch.common.util.Maps;\n+import org.elasticsearch.common.xcontent.XContentHelper;\n import org.elasticsearch.core.TimeValue;\n import org.elasticsearch.node.Node;\n import org.elasticsearch.rest.RestRequest;\n@@ -22,8 +25,13 @@ import org.elasticsearch.test.ESTestCase;\n import org.elasticsearch.test.rest.FakeRestRequest;\n import org.elasticsearch.threadpool.DefaultBuiltInExecutorBuilders;\n import org.elasticsearch.threadpool.ThreadPool;\n+import org.elasticsearch.xcontent.ToXContent;\n+import org.elasticsearch.xcontent.XContentFactory;\n+import org.elasticsearch.xcontent.XContentType;\n \n+import java.io.IOException;\n import java.net.InetSocketAddress;\n+import java.time.Instant;\n import java.util.HashMap;\n import java.util.List;\n import java.util.Map;\n@@ -379,6 +387,55 @@ public class HttpClientStatsTrackerTests extends ESTestCase {\n         }\n     }\n \n+    public void testToXContent() throws IOException {\n+        final var clientStats = new HttpStats.ClientStats(\n+            randomNonNegativeInt(),\n+            randomIdentifier(),\n+            randomIdentifier(),\n+            randomIdentifier(),\n+            randomIdentifier(),\n+            randomIdentifier(),\n+            randomIdentifier(),\n+            randomLongBetween(1, Long.MAX_VALUE),\n+            randomLongBetween(1, Long.MAX_VALUE),\n+            randomLongBetween(1, Long.MAX_VALUE),\n+            randomNonNegativeLong(),\n+            randomNonNegativeLong()\n+        );\n+        final var description = Strings.toString(clientStats, false, true);\n+        logger.info(\"description: {}\", description);\n+\n+        final Map<String, Object> xcontentMap;\n+        try (var builder = XContentFactory.jsonBuilder()) {\n+            builder.humanReadable(true).value(clientStats, ToXContent.EMPTY_PARAMS);\n+            xcontentMap = XContentHelper.convertToMap(BytesReference.bytes(builder), false, XContentType.JSON).v2();\n+        }\n+\n+        assertEquals(description, clientStats.id(), xcontentMap.get(\"id\"));\n+        assertEquals(description, clientStats.agent(), xcontentMap.get(\"agent\"));\n+        assertEquals(description, clientStats.localAddress(), xcontentMap.get(\"local_address\"));\n+        assertEquals(description, clientStats.remoteAddress(), xcontentMap.get(\"remote_address\"));\n+        assertEquals(description, clientStats.lastUri(), xcontentMap.get(\"last_uri\"));\n+        assertEquals(description, clientStats.forwardedFor(), xcontentMap.get(\"x_forwarded_for\"));\n+        assertEquals(description, clientStats.opaqueId(), xcontentMap.get(\"x_opaque_id\"));\n+\n+        assertEquals(description, clientStats.openedTimeMillis(), xcontentMap.get(\"opened_time_millis\"));\n+        assertEquals(description, Instant.ofEpochMilli(clientStats.openedTimeMillis()).toString(), xcontentMap.get(\"opened_time\"));\n+\n+        assertEquals(description, clientStats.closedTimeMillis(), xcontentMap.get(\"closed_time_millis\"));\n+        assertEquals(description, Instant.ofEpochMilli(clientStats.closedTimeMillis()).toString(), xcontentMap.get(\"closed_time\"));\n+\n+        assertEquals(description, clientStats.lastRequestTimeMillis(), xcontentMap.get(\"last_request_time_millis\"));\n+        assertEquals(\n+            description,\n+            Instant.ofEpochMilli(clientStats.lastRequestTimeMillis()).toString(),\n+            xcontentMap.get(\"last_request_time\")\n+        );\n+\n+        assertEquals(description, clientStats.requestCount(), (long) xcontentMap.get(\"request_count\"));\n+        assertEquals(description, clientStats.requestSizeBytes(), (long) xcontentMap.get(\"request_size_bytes\"));\n+    }\n+\n     private Map<String, String> getRelevantHeaders(HttpRequest httpRequest) {\n         final Map<String, String> headers = Maps.newMapWithExpectedSize(4);\n         final String[] relevantHeaderNames = new String[] { \"user-agent\", \"x-elastic-product-origin\", \"x-forwarded-for\", \"x-opaque-id\" };"
}