{
  "repo_url": "https://github.com/elastic/elasticsearch.git",
  "pr_number": 4155,
  "base_commit": "16ee74268240118c59b64ea3ee2ee854c7566505",
  "head_commit": "1e06c76467b16b4c673dbac2cc0d567d396f010b",
  "judge_mode": "llm",
  "judge_model": "claude-sonnet-4-5",
  "scores": {
    "correctness": -0.3,
    "completeness": -0.4,
    "code_reuse": 0.0,
    "best_practices": -0.2,
    "unsolicited_docs": 1.0
  },
  "aggregate": 0.020000000000000018,
  "rationale": "The agent's solution partially addresses the semaphore leak but has significant deficiencies compared to ground truth. Correctness: The agent wraps client.bulk() in try-catch and releases the semaphore on exception, which handles the immediate problem, but misses critical details: (1) doesn't use the success flag pattern to ensure semaphore release only when client.bulk() throws (ground truth ensures callbacks handle release on success), (2) doesn't handle Thread.interrupted() call for InterruptedException, (3) doesn't restructure the code to move listener.beforeBulk() inside the try block as ground truth does. Completeness: Missing the success flag pattern, Thread.interrupted() call, and the code restructuring that moves beforeBulk inside try block. The agent's approach is simpler but less robust - it catches all exceptions from client.bulk() but doesn't distinguish between setup failure and callback failure as cleanly as ground truth. Code Reuse: Both solutions modify similar amounts of code. Best Practices: Ground truth's success flag pattern is a more idiomatic Java approach for ensuring cleanup only on specific failure paths, while the agent's catch-all Exception handler is less precise. The agent also doesn't restore interrupt status. No unsolicited documentation added.",
  "edit_run_id": "8d6f99fc",
  "judge_run_id": "3e164e1c",
  "ground_truth_patch": "diff --git a/src/main/java/org/elasticsearch/action/bulk/BulkProcessor.java b/src/main/java/org/elasticsearch/action/bulk/BulkProcessor.java\nindex b8fb83a02c8..a850cfc2ae0 100644\n--- a/src/main/java/org/elasticsearch/action/bulk/BulkProcessor.java\n+++ b/src/main/java/org/elasticsearch/action/bulk/BulkProcessor.java\n@@ -276,32 +276,39 @@ public class BulkProcessor {\n                 listener.afterBulk(executionId, bulkRequest, e);\n             }\n         } else {\n+            boolean success = false;\n             try {\n                 semaphore.acquire();\n+                listener.beforeBulk(executionId, bulkRequest);\n+                client.bulk(bulkRequest, new ActionListener<BulkResponse>() {\n+                    @Override\n+                    public void onResponse(BulkResponse response) {\n+                        try {\n+                            listener.afterBulk(executionId, bulkRequest, response);\n+                        } finally {\n+                            semaphore.release();\n+                        }\n+                    }\n+\n+                    @Override\n+                    public void onFailure(Throwable e) {\n+                        try {\n+                            listener.afterBulk(executionId, bulkRequest, e);\n+                        } finally {\n+                            semaphore.release();\n+                        }\n+                    }\n+                });\n+                success = true;\n             } catch (InterruptedException e) {\n+                Thread.interrupted();\n                 listener.afterBulk(executionId, bulkRequest, e);\n-                return;\n+            } finally {\n+                 if (!success) {  // if we fail on client.bulk() release the semaphore\n+                     semaphore.release();\n+                 }\n             }\n-            listener.beforeBulk(executionId, bulkRequest);\n-            client.bulk(bulkRequest, new ActionListener<BulkResponse>() {\n-                @Override\n-                public void onResponse(BulkResponse response) {\n-                    try {\n-                        listener.afterBulk(executionId, bulkRequest, response);\n-                    } finally {\n-                        semaphore.release();\n-                    }\n-                }\n \n-                @Override\n-                public void onFailure(Throwable e) {\n-                    try {\n-                        listener.afterBulk(executionId, bulkRequest, e);\n-                    } finally {\n-                        semaphore.release();\n-                    }\n-                }\n-            });\n         }\n     }\n "
}