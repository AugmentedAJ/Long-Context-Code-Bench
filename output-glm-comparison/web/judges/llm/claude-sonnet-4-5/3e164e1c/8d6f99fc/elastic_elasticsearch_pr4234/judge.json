{
  "repo_url": "https://github.com/elastic/elasticsearch.git",
  "pr_number": 4234,
  "base_commit": "7d3b78c29327a1774695c4567bab0c40e7b97b6a",
  "head_commit": "c4f3da2b9d6294a1871a87b3e489f9896b95f72e",
  "judge_mode": "llm",
  "judge_model": "claude-sonnet-4-5",
  "scores": {
    "correctness": -1.0,
    "completeness": -1.0,
    "code_reuse": 0.0,
    "best_practices": 0.0,
    "unsolicited_docs": 0.0
  },
  "aggregate": -0.4,
  "rationale": "The agent produced an empty diff with no changes whatsoever. The task required adding validation in PlainOperationRouting.java to throw ElasticSearchIllegalArgumentException when a non-existing node ID is specified with _only_node preference, plus a corresponding test in SearchPreferenceTests.java. The ground truth adds an ensureNodeIdExists() method, modifies the preference handling logic, and includes a test case. The agent implemented none of these changes, resulting in complete failure on correctness and completeness. Code reuse, best practices, and unsolicited docs are scored neutrally (0.0) since no code was written.",
  "edit_run_id": "8d6f99fc",
  "judge_run_id": "3e164e1c",
  "ground_truth_patch": "diff --git a/src/main/java/org/elasticsearch/cluster/routing/operation/plain/PlainOperationRouting.java b/src/main/java/org/elasticsearch/cluster/routing/operation/plain/PlainOperationRouting.java\nindex 3b5376ae799..61f61cd7b0c 100644\n--- a/src/main/java/org/elasticsearch/cluster/routing/operation/plain/PlainOperationRouting.java\n+++ b/src/main/java/org/elasticsearch/cluster/routing/operation/plain/PlainOperationRouting.java\n@@ -219,7 +219,9 @@ public class PlainOperationRouting extends AbstractComponent implements Operatio\n                 return indexShard.onlyNodeActiveInitializingShardsIt(localNodeId);\n             }\n             if (preference.startsWith(\"_only_node:\")) {\n-                return indexShard.onlyNodeActiveInitializingShardsIt(preference.substring(\"_only_node:\".length()));\n+                String nodeId = preference.substring(\"_only_node:\".length());\n+                ensureNodeIdExists(nodes, nodeId);\n+                return indexShard.onlyNodeActiveInitializingShardsIt(nodeId);\n             }\n         }\n         // if not, then use it as the index\n@@ -284,4 +286,10 @@ public class PlainOperationRouting extends AbstractComponent implements Operatio\n         }\n         return hashFunction.hash(type, id);\n     }\n+\n+    private void ensureNodeIdExists(DiscoveryNodes nodes, String nodeId) {\n+        if (!nodes.dataNodes().keys().contains(nodeId)) {\n+            throw new ElasticSearchIllegalArgumentException(\"No data node with id[\" + nodeId + \"] found\");\n+        }\n+    }\n }\ndiff --git a/src/test/java/org/elasticsearch/search/preference/SearchPreferenceTests.java b/src/test/java/org/elasticsearch/search/preference/SearchPreferenceTests.java\nindex 870303dff7b..2a0448b8b3e 100644\n--- a/src/test/java/org/elasticsearch/search/preference/SearchPreferenceTests.java\n+++ b/src/test/java/org/elasticsearch/search/preference/SearchPreferenceTests.java\n@@ -19,6 +19,7 @@\n \n package org.elasticsearch.search.preference;\n \n+import org.elasticsearch.ElasticSearchIllegalArgumentException;\n import org.elasticsearch.action.admin.cluster.health.ClusterHealthStatus;\n import org.elasticsearch.action.search.SearchResponse;\n import org.elasticsearch.action.search.SearchType;\n@@ -96,4 +97,12 @@ public class SearchPreferenceTests extends ElasticsearchIntegrationTest {\n         searchResponse = client().prepareSearch().setQuery(matchAllQuery()).setPreference(\"1234\").execute().actionGet();\n         assertThat(searchResponse.getHits().totalHits(), equalTo(1l));\n     }\n+\n+    @Test (expected = ElasticSearchIllegalArgumentException.class)\n+    public void testThatSpecifyingNonExistingNodesReturnsUsefulError() throws Exception {\n+        createIndex(\"test\");\n+        ensureGreen();\n+\n+        client().prepareSearch().setQuery(matchAllQuery()).setPreference(\"_only_node:DOES-NOT-EXIST\").execute().actionGet();\n+    }\n }"
}