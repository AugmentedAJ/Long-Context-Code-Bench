{
  "repo_url": "https://github.com/elastic/elasticsearch.git",
  "pr_number": 134369,
  "base_commit": "20d6049c7f1068af75dd34270f7b74cf1f76991c",
  "head_commit": "9e4a37bd47e7c4300d36a401aab9b2f326f8715f",
  "judge_mode": "llm",
  "judge_model": "claude-sonnet-4-5",
  "scores": {
    "correctness": 0.1,
    "completeness": 0.0,
    "code_reuse": 0.0,
    "best_practices": 0.2,
    "unsolicited_docs": 1.0
  },
  "aggregate": 0.26,
  "rationale": "The agent successfully changed all BiConsumer<ClusterState, Metadata.Builder> signatures to BiConsumer<ClusterState, ProjectMetadata.Builder> in both RestoreService.java and TransportPutFollowAction.java, matching the ground truth. The agent also correctly updated all lambda parameter names (mdBuilder -> projectBuilder) and removed the redundant 'final ProjectMetadata.Builder projectBuilder = mdBuilder.getProject(projectId);' line in TransportPutFollowAction.java. However, the agent added an assertion statement ('assert projectMetadataBuilder != null : ...') in RestoreService.java:1589-1590 that is not present in the ground truth. While this assertion is defensive programming and not harmful, it represents an unsolicited addition. The agent also introduced an intermediate variable 'final ProjectMetadata.Builder projectMetadataBuilder' where the ground truth uses inline chaining 'mdBuilder.getProject(projectId)'. These differences are minor and don't affect correctness but represent a slight deviation from the ground truth's more concise approach. All functional changes are correct and complete.",
  "edit_run_id": "fd5b3480",
  "judge_run_id": "3e164e1c",
  "ground_truth_patch": "diff --git a/server/src/main/java/org/elasticsearch/snapshots/RestoreService.java b/server/src/main/java/org/elasticsearch/snapshots/RestoreService.java\nindex 1be7411bcca..5e7287f9b88 100644\n--- a/server/src/main/java/org/elasticsearch/snapshots/RestoreService.java\n+++ b/server/src/main/java/org/elasticsearch/snapshots/RestoreService.java\n@@ -267,14 +267,14 @@ public final class RestoreService implements ClusterStateApplier {\n      * @param projectId project for the restore\n      * @param request  restore request\n      * @param listener restore listener\n-     * @param updater  handler that allows callers to make modifications to {@link Metadata}\n+     * @param updater  handler that allows callers to make modifications to {@link ProjectMetadata}\n      *                 in the same cluster state update as the restore operation\n      */\n     public void restoreSnapshot(\n         final ProjectId projectId,\n         final RestoreSnapshotRequest request,\n         final ActionListener<RestoreCompletionResponse> listener,\n-        final BiConsumer<ClusterState, Metadata.Builder> updater\n+        final BiConsumer<ClusterState, ProjectMetadata.Builder> updater\n     ) {\n         assert Repository.assertSnapshotMetaThread();\n \n@@ -368,8 +368,8 @@ public final class RestoreService implements ClusterStateApplier {\n      * @param repository     the repository to restore from\n      * @param request        restore request\n      * @param repositoryData current repository data for the repository to restore from\n-     * @param updater        handler that allows callers to make modifications to {@link Metadata} in the same cluster state update as the\n-     *                       restore operation\n+     * @param updater        handler that allows callers to make modifications to {@link ProjectMetadata} in the same cluster state update\n+     *                       as the restore operation\n      * @param listener       listener to resolve once restore has been started\n      * @throws IOException   on failure to load metadata from the repository\n      */\n@@ -378,7 +378,7 @@ public final class RestoreService implements ClusterStateApplier {\n         Repository repository,\n         RestoreSnapshotRequest request,\n         RepositoryData repositoryData,\n-        BiConsumer<ClusterState, Metadata.Builder> updater,\n+        BiConsumer<ClusterState, ProjectMetadata.Builder> updater,\n         ActionListener<RestoreCompletionResponse> listener\n     ) throws IOException {\n         assert Repository.assertSnapshotMetaThread();\n@@ -1371,7 +1371,7 @@ public final class RestoreService implements ClusterStateApplier {\n \n         private final Collection<DataStream> dataStreamsToRestore;\n \n-        private final BiConsumer<ClusterState, Metadata.Builder> updater;\n+        private final BiConsumer<ClusterState, ProjectMetadata.Builder> updater;\n \n         private final AllocationActionListener<RestoreCompletionResponse> listener;\n         private final Settings settings;\n@@ -1387,7 +1387,7 @@ public final class RestoreService implements ClusterStateApplier {\n             SnapshotInfo snapshotInfo,\n             Metadata metadata,\n             Collection<DataStream> dataStreamsToRestore,\n-            BiConsumer<ClusterState, Metadata.Builder> updater,\n+            BiConsumer<ClusterState, ProjectMetadata.Builder> updater,\n             Settings settings,\n             ActionListener<RestoreCompletionResponse> listener\n         ) {\n@@ -1586,7 +1586,7 @@ public final class RestoreService implements ClusterStateApplier {\n                 );\n             }\n \n-            updater.accept(currentState, mdBuilder);\n+            updater.accept(currentState, mdBuilder.getProject(projectId));\n             final ClusterState updatedClusterState = builder.metadata(mdBuilder)\n                 .blocks(blocks)\n                 .putRoutingTable(projectId, rtBuilder.build())\ndiff --git a/x-pack/plugin/ccr/src/main/java/org/elasticsearch/xpack/ccr/action/TransportPutFollowAction.java b/x-pack/plugin/ccr/src/main/java/org/elasticsearch/xpack/ccr/action/TransportPutFollowAction.java\nindex 27a910fa6e8..d8493a69c03 100644\n--- a/x-pack/plugin/ccr/src/main/java/org/elasticsearch/xpack/ccr/action/TransportPutFollowAction.java\n+++ b/x-pack/plugin/ccr/src/main/java/org/elasticsearch/xpack/ccr/action/TransportPutFollowAction.java\n@@ -212,16 +212,16 @@ public final class TransportPutFollowAction extends TransportMasterNodeAction<Pu\n             description = \"CCR may not be in scope for multi-project though we haven't made the decision explicitly yet. See also ES-12139\"\n         )\n         final ProjectId projectId = ProjectId.DEFAULT;\n-        final BiConsumer<ClusterState, Metadata.Builder> updater;\n+        final BiConsumer<ClusterState, ProjectMetadata.Builder> updater;\n         if (remoteDataStream == null) {\n             // If the index we're following is not part of a data stream, start the\n             // restoration of the index normally.\n-            updater = (clusterState, mdBuilder) -> {};\n+            updater = (clusterState, projectBuilder) -> {};\n         } else {\n             String followerIndexName = request.getFollowerIndex();\n             // This method is used to update the metadata in the same cluster state\n             // update as the snapshot is restored.\n-            updater = (currentState, mdBuilder) -> {\n+            updater = (currentState, projectBuilder) -> {\n                 final String localDataStreamName;\n \n                 // If we have been given a data stream name, use that name for the local\n@@ -234,7 +234,6 @@ public final class TransportPutFollowAction extends TransportMasterNodeAction<Pu\n                     // There was no specified name, use the original data stream name.\n                     localDataStreamName = remoteDataStream.getName();\n                 }\n-                final ProjectMetadata.Builder projectBuilder = mdBuilder.getProject(projectId);\n                 final DataStream localDataStream = projectBuilder.dataStream(localDataStreamName);\n                 final Index followerIndex = projectBuilder.get(followerIndexName).getIndex();\n                 assert followerIndex != null : \"expected followerIndex \" + followerIndexName + \" to exist in the state, but it did not\";"
}