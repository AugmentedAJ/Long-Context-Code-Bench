{
  "repo_url": "https://github.com/elastic/elasticsearch.git",
  "pr_number": 3947,
  "base_commit": "e79f714b4b066f9238ff6313aad9a854c37a8c3d",
  "head_commit": "f9154de04f576077d879a777a5587661cf1e094d",
  "judge_mode": "llm",
  "judge_model": "claude-sonnet-4-5",
  "scores": {
    "correctness": 0.0,
    "completeness": -0.1,
    "code_reuse": 0.0,
    "best_practices": -0.1,
    "unsolicited_docs": 1.0
  },
  "aggregate": 0.16,
  "rationale": "The agent correctly implements the core validation logic to reject float weights in CompletionFieldMapper.java, checking numberType and throwing an appropriate exception. However, there are minor differences: (1) The agent doesn't add the static import for NumberType at the top of the file (uses fully qualified name instead), (2) The error message differs slightly ('must be an integer but was a float' vs 'must be an integer, but was [2.5]'), and (3) Most notably, the agent adds the test to CompletionFieldMapperTests.java instead of CompletionSuggestSearchTests.java as in ground truth. While the test validates the same behavior, placing it in a different file represents a deviation from the expected integration test location. The ground truth also includes a minor formatting change to the existing error message (adding comma and brackets) that the agent omits. These are relatively minor issues but represent deviations from the expected implementation.",
  "edit_run_id": "fd5b3480",
  "judge_run_id": "3e164e1c",
  "ground_truth_patch": "diff --git a/src/main/java/org/elasticsearch/index/mapper/core/CompletionFieldMapper.java b/src/main/java/org/elasticsearch/index/mapper/core/CompletionFieldMapper.java\nindex bc4c09706ed..3507eb4e92d 100644\n--- a/src/main/java/org/elasticsearch/index/mapper/core/CompletionFieldMapper.java\n+++ b/src/main/java/org/elasticsearch/index/mapper/core/CompletionFieldMapper.java\n@@ -45,6 +45,8 @@ import java.util.Locale;\n import java.util.Map;\n import java.util.Set;\n \n+import static org.elasticsearch.common.xcontent.XContentParser.NumberType;\n+\n /**\n  *\n  */\n@@ -248,9 +250,13 @@ public class CompletionFieldMapper extends AbstractFieldMapper<String> {\n                     }\n                 } else if (token == XContentParser.Token.VALUE_NUMBER) {\n                     if (Fields.CONTENT_FIELD_NAME_WEIGHT.equals(currentFieldName)) {\n+                        NumberType numberType = parser.numberType();\n+                        if (NumberType.LONG != numberType && NumberType.INT != numberType) {\n+                            throw new ElasticSearchIllegalArgumentException(\"Weight must be an integer, but was [\" + parser.numberValue() + \"]\");\n+                        }\n                         weight = parser.longValue(); // always parse a long to make sure we don't get the overflow value\n                         if (weight < 0 || weight > Integer.MAX_VALUE) {\n-                            throw new ElasticSearchIllegalArgumentException(\"Weight must be in the interval [0..2147483647] but was \" + weight);\n+                            throw new ElasticSearchIllegalArgumentException(\"Weight must be in the interval [0..2147483647], but was [\" + weight + \"]\");\n                         }\n                     }\n                 } else if (token == XContentParser.Token.START_ARRAY) {\ndiff --git a/src/test/java/org/elasticsearch/search/suggest/CompletionSuggestSearchTests.java b/src/test/java/org/elasticsearch/search/suggest/CompletionSuggestSearchTests.java\nindex db4e0bc0193..0285a270223 100644\n--- a/src/test/java/org/elasticsearch/search/suggest/CompletionSuggestSearchTests.java\n+++ b/src/test/java/org/elasticsearch/search/suggest/CompletionSuggestSearchTests.java\n@@ -20,6 +20,7 @@ package org.elasticsearch.search.suggest;\n \n import com.carrotsearch.randomizedtesting.generators.RandomStrings;\n import com.google.common.collect.Lists;\n+import org.elasticsearch.ExceptionsHelper;\n import org.elasticsearch.action.admin.cluster.health.ClusterHealthStatus;\n import org.elasticsearch.action.admin.indices.mapping.put.PutMappingResponse;\n import org.elasticsearch.action.admin.indices.optimize.OptimizeResponse;\n@@ -120,6 +121,23 @@ public class CompletionSuggestSearchTests extends AbstractIntegrationTest {\n         assertSuggestions(\"the\", \"the\", \"The the\", \"The Verve\", \"The Prodigy\");\n     }\n \n+    @Test\n+    public void testThatWeightMustBeAnInteger() throws Exception {\n+        createIndexAndMapping();\n+\n+        try {\n+            client().prepareIndex(INDEX, TYPE, \"1\").setSource(jsonBuilder()\n+                    .startObject().startObject(FIELD)\n+                    .startArray(\"input\").value(\"sth\").endArray()\n+                    .field(\"weight\", 2.5)\n+                    .endObject().endObject()\n+            ).get();\n+            fail(\"Indexing with a float weight was successful, but should not be\");\n+        } catch (MapperParsingException e) {\n+            assertThat(ExceptionsHelper.detailedMessage(e), containsString(\"2.5\"));\n+        }\n+    }\n+\n     @Test\n     public void testThatInputCanBeAStringInsteadOfAnArray() throws Exception {\n         createIndexAndMapping();"
}