{
  "repo_url": "https://github.com/elastic/elasticsearch.git",
  "pr_number": 4234,
  "base_commit": "7d3b78c29327a1774695c4567bab0c40e7b97b6a",
  "head_commit": "c4f3da2b9d6294a1871a87b3e489f9896b95f72e",
  "judge_mode": "llm",
  "judge_model": "claude-sonnet-4-5",
  "scores": {
    "correctness": 0.0,
    "completeness": 0.0,
    "code_reuse": 0.8,
    "best_practices": 0.3,
    "unsolicited_docs": 1.0
  },
  "aggregate": 0.42000000000000004,
  "rationale": "Correctness: The agent's implementation correctly validates node existence and throws an appropriate exception with a clear error message, achieving the task's goal of replacing the generic SearchPhaseExecutionException with a useful error. However, the validation approach differs: the agent uses `nodes.nodeExists(nodeId)` inline vs. ground truth's `ensureNodeIdExists()` helper that checks `nodes.dataNodes().keys().contains(nodeId)`. Both should work correctly for the stated goal. Score: 0.0 (human level).\n\nCompleteness: Both diffs modify PlainOperationRouting.java to add validation and SearchPreferenceTests.java to add a test case. The agent's test is more robust (uses try-catch with explicit assertions and fail()) compared to ground truth's @Test(expected=...) annotation. Both achieve the required functionality. Score: 0.0 (human level).\n\nCode Reuse: The agent inlines the validation check rather than extracting it to a helper method. While the ground truth creates `ensureNodeIdExists()`, the agent's inline approach with `nodes.nodeExists()` is simpler and leverages existing API methods more directly, avoiding an extra method for a single-use validation. The agent also imports UUIDs for test data generation, showing good use of existing utilities. Score: 0.8 (better reuse of existing APIs).\n\nBest Practices: The agent uses `final` keyword for nodeId (good immutability practice), provides a more descriptive error message, and writes a more explicit test with better assertion coverage. However, ground truth's extracted helper method follows the separation of concerns principle better. The agent's test practices (explicit try-catch, fail(), multiple assertions) are superior to the simple @Test(expected=...) pattern. Score: 0.3 (slightly better).\n\nUnsolicited Docs: No documentation files or comments were added beyond what was necessary. Score: 1.0.",
  "edit_run_id": "fd5b3480",
  "judge_run_id": "3e164e1c",
  "ground_truth_patch": "diff --git a/src/main/java/org/elasticsearch/cluster/routing/operation/plain/PlainOperationRouting.java b/src/main/java/org/elasticsearch/cluster/routing/operation/plain/PlainOperationRouting.java\nindex 3b5376ae799..61f61cd7b0c 100644\n--- a/src/main/java/org/elasticsearch/cluster/routing/operation/plain/PlainOperationRouting.java\n+++ b/src/main/java/org/elasticsearch/cluster/routing/operation/plain/PlainOperationRouting.java\n@@ -219,7 +219,9 @@ public class PlainOperationRouting extends AbstractComponent implements Operatio\n                 return indexShard.onlyNodeActiveInitializingShardsIt(localNodeId);\n             }\n             if (preference.startsWith(\"_only_node:\")) {\n-                return indexShard.onlyNodeActiveInitializingShardsIt(preference.substring(\"_only_node:\".length()));\n+                String nodeId = preference.substring(\"_only_node:\".length());\n+                ensureNodeIdExists(nodes, nodeId);\n+                return indexShard.onlyNodeActiveInitializingShardsIt(nodeId);\n             }\n         }\n         // if not, then use it as the index\n@@ -284,4 +286,10 @@ public class PlainOperationRouting extends AbstractComponent implements Operatio\n         }\n         return hashFunction.hash(type, id);\n     }\n+\n+    private void ensureNodeIdExists(DiscoveryNodes nodes, String nodeId) {\n+        if (!nodes.dataNodes().keys().contains(nodeId)) {\n+            throw new ElasticSearchIllegalArgumentException(\"No data node with id[\" + nodeId + \"] found\");\n+        }\n+    }\n }\ndiff --git a/src/test/java/org/elasticsearch/search/preference/SearchPreferenceTests.java b/src/test/java/org/elasticsearch/search/preference/SearchPreferenceTests.java\nindex 870303dff7b..2a0448b8b3e 100644\n--- a/src/test/java/org/elasticsearch/search/preference/SearchPreferenceTests.java\n+++ b/src/test/java/org/elasticsearch/search/preference/SearchPreferenceTests.java\n@@ -19,6 +19,7 @@\n \n package org.elasticsearch.search.preference;\n \n+import org.elasticsearch.ElasticSearchIllegalArgumentException;\n import org.elasticsearch.action.admin.cluster.health.ClusterHealthStatus;\n import org.elasticsearch.action.search.SearchResponse;\n import org.elasticsearch.action.search.SearchType;\n@@ -96,4 +97,12 @@ public class SearchPreferenceTests extends ElasticsearchIntegrationTest {\n         searchResponse = client().prepareSearch().setQuery(matchAllQuery()).setPreference(\"1234\").execute().actionGet();\n         assertThat(searchResponse.getHits().totalHits(), equalTo(1l));\n     }\n+\n+    @Test (expected = ElasticSearchIllegalArgumentException.class)\n+    public void testThatSpecifyingNonExistingNodesReturnsUsefulError() throws Exception {\n+        createIndex(\"test\");\n+        ensureGreen();\n+\n+        client().prepareSearch().setQuery(matchAllQuery()).setPreference(\"_only_node:DOES-NOT-EXIST\").execute().actionGet();\n+    }\n }"
}