{
  "repo_url": "https://github.com/elastic/elasticsearch.git",
  "pr_number": 4155,
  "base_commit": "16ee74268240118c59b64ea3ee2ee854c7566505",
  "head_commit": "1e06c76467b16b4c673dbac2cc0d567d396f010b",
  "judge_mode": "llm",
  "judge_model": "claude-sonnet-4-5",
  "scores": {
    "correctness": -0.3,
    "completeness": -0.4,
    "code_reuse": 0.0,
    "best_practices": -0.2,
    "unsolicited_docs": 1.0
  },
  "aggregate": 0.020000000000000018,
  "rationale": "The agent's solution addresses the core issue of releasing the semaphore when client.bulk() throws synchronously by wrapping it in a try-catch block. However, it has several significant deficiencies compared to the ground truth: (1) It doesn't restructure the code with a 'success' flag pattern, which is more robust for handling multiple failure points; (2) It moves listener.beforeBulk() outside the try block, meaning if client.bulk() throws, the semaphore is released but the exception path differs from ground truth; (3) It doesn't add Thread.interrupted() call in the InterruptedException handler; (4) The ground truth's approach of checking success in finally is cleaner and handles edge cases better (e.g., if client.bulk throws before ActionListener is registered). The agent's solution works for the basic case but is less comprehensive and robust than the ground truth's restructuring.",
  "edit_run_id": "6bf04592",
  "judge_run_id": "609ef74e",
  "ground_truth_patch": "diff --git a/src/main/java/org/elasticsearch/action/bulk/BulkProcessor.java b/src/main/java/org/elasticsearch/action/bulk/BulkProcessor.java\nindex b8fb83a02c80..a850cfc2ae0c 100644\n--- a/src/main/java/org/elasticsearch/action/bulk/BulkProcessor.java\n+++ b/src/main/java/org/elasticsearch/action/bulk/BulkProcessor.java\n@@ -276,32 +276,39 @@ public class BulkProcessor {\n                 listener.afterBulk(executionId, bulkRequest, e);\n             }\n         } else {\n+            boolean success = false;\n             try {\n                 semaphore.acquire();\n+                listener.beforeBulk(executionId, bulkRequest);\n+                client.bulk(bulkRequest, new ActionListener<BulkResponse>() {\n+                    @Override\n+                    public void onResponse(BulkResponse response) {\n+                        try {\n+                            listener.afterBulk(executionId, bulkRequest, response);\n+                        } finally {\n+                            semaphore.release();\n+                        }\n+                    }\n+\n+                    @Override\n+                    public void onFailure(Throwable e) {\n+                        try {\n+                            listener.afterBulk(executionId, bulkRequest, e);\n+                        } finally {\n+                            semaphore.release();\n+                        }\n+                    }\n+                });\n+                success = true;\n             } catch (InterruptedException e) {\n+                Thread.interrupted();\n                 listener.afterBulk(executionId, bulkRequest, e);\n-                return;\n+            } finally {\n+                 if (!success) {  // if we fail on client.bulk() release the semaphore\n+                     semaphore.release();\n+                 }\n             }\n-            listener.beforeBulk(executionId, bulkRequest);\n-            client.bulk(bulkRequest, new ActionListener<BulkResponse>() {\n-                @Override\n-                public void onResponse(BulkResponse response) {\n-                    try {\n-                        listener.afterBulk(executionId, bulkRequest, response);\n-                    } finally {\n-                        semaphore.release();\n-                    }\n-                }\n \n-                @Override\n-                public void onFailure(Throwable e) {\n-                    try {\n-                        listener.afterBulk(executionId, bulkRequest, e);\n-                    } finally {\n-                        semaphore.release();\n-                    }\n-                }\n-            });\n         }\n     }\n "
}