{
  "repo_url": "https://github.com/elastic/elasticsearch.git",
  "pr_number": 3947,
  "base_commit": "e79f714b4b066f9238ff6313aad9a854c37a8c3d",
  "head_commit": "f9154de04f576077d879a777a5587661cf1e094d",
  "judge_mode": "llm",
  "judge_model": "claude-sonnet-4-5",
  "scores": {
    "correctness": 0.0,
    "completeness": -0.1,
    "code_reuse": 0.0,
    "best_practices": -0.2,
    "unsolicited_docs": 1.0
  },
  "aggregate": 0.13999999999999999,
  "rationale": "The agent correctly implements the core fix by checking numberType and rejecting floats/doubles in CompletionFieldMapper.java. However, there are several differences from ground truth: (1) The agent uses FLOAT/DOUBLE check instead of inverting the logic to check for LONG/INT, which is semantically equivalent but slightly different in approach. (2) The agent adds tests to CompletionFieldMapperTests.java instead of CompletionSuggestSearchTests.java - while functional, this is a different test location that may not exercise the full integration path. (3) The agent doesn't include the static import cleanup or the minor error message formatting improvements from ground truth. (4) The test in ground truth uses ExceptionsHelper.detailedMessage() and a more realistic integration test with actual indexing, while the agent's test is more unit-focused with direct mapper parsing. The agent's error message is also slightly different ('Weight must be an integer value, but was a floating-point number' vs 'Weight must be an integer, but was'). Overall, the fix works but has minor completeness gaps and style differences.",
  "edit_run_id": "6bf04592",
  "judge_run_id": "609ef74e",
  "ground_truth_patch": "diff --git a/src/main/java/org/elasticsearch/index/mapper/core/CompletionFieldMapper.java b/src/main/java/org/elasticsearch/index/mapper/core/CompletionFieldMapper.java\nindex bc4c09706ed1..3507eb4e92d8 100644\n--- a/src/main/java/org/elasticsearch/index/mapper/core/CompletionFieldMapper.java\n+++ b/src/main/java/org/elasticsearch/index/mapper/core/CompletionFieldMapper.java\n@@ -45,6 +45,8 @@ import java.util.Locale;\n import java.util.Map;\n import java.util.Set;\n \n+import static org.elasticsearch.common.xcontent.XContentParser.NumberType;\n+\n /**\n  *\n  */\n@@ -248,9 +250,13 @@ public class CompletionFieldMapper extends AbstractFieldMapper<String> {\n                     }\n                 } else if (token == XContentParser.Token.VALUE_NUMBER) {\n                     if (Fields.CONTENT_FIELD_NAME_WEIGHT.equals(currentFieldName)) {\n+                        NumberType numberType = parser.numberType();\n+                        if (NumberType.LONG != numberType && NumberType.INT != numberType) {\n+                            throw new ElasticSearchIllegalArgumentException(\"Weight must be an integer, but was [\" + parser.numberValue() + \"]\");\n+                        }\n                         weight = parser.longValue(); // always parse a long to make sure we don't get the overflow value\n                         if (weight < 0 || weight > Integer.MAX_VALUE) {\n-                            throw new ElasticSearchIllegalArgumentException(\"Weight must be in the interval [0..2147483647] but was \" + weight);\n+                            throw new ElasticSearchIllegalArgumentException(\"Weight must be in the interval [0..2147483647], but was [\" + weight + \"]\");\n                         }\n                     }\n                 } else if (token == XContentParser.Token.START_ARRAY) {\ndiff --git a/src/test/java/org/elasticsearch/search/suggest/CompletionSuggestSearchTests.java b/src/test/java/org/elasticsearch/search/suggest/CompletionSuggestSearchTests.java\nindex db4e0bc01939..0285a2702238 100644\n--- a/src/test/java/org/elasticsearch/search/suggest/CompletionSuggestSearchTests.java\n+++ b/src/test/java/org/elasticsearch/search/suggest/CompletionSuggestSearchTests.java\n@@ -20,6 +20,7 @@ package org.elasticsearch.search.suggest;\n \n import com.carrotsearch.randomizedtesting.generators.RandomStrings;\n import com.google.common.collect.Lists;\n+import org.elasticsearch.ExceptionsHelper;\n import org.elasticsearch.action.admin.cluster.health.ClusterHealthStatus;\n import org.elasticsearch.action.admin.indices.mapping.put.PutMappingResponse;\n import org.elasticsearch.action.admin.indices.optimize.OptimizeResponse;\n@@ -120,6 +121,23 @@ public class CompletionSuggestSearchTests extends AbstractIntegrationTest {\n         assertSuggestions(\"the\", \"the\", \"The the\", \"The Verve\", \"The Prodigy\");\n     }\n \n+    @Test\n+    public void testThatWeightMustBeAnInteger() throws Exception {\n+        createIndexAndMapping();\n+\n+        try {\n+            client().prepareIndex(INDEX, TYPE, \"1\").setSource(jsonBuilder()\n+                    .startObject().startObject(FIELD)\n+                    .startArray(\"input\").value(\"sth\").endArray()\n+                    .field(\"weight\", 2.5)\n+                    .endObject().endObject()\n+            ).get();\n+            fail(\"Indexing with a float weight was successful, but should not be\");\n+        } catch (MapperParsingException e) {\n+            assertThat(ExceptionsHelper.detailedMessage(e), containsString(\"2.5\"));\n+        }\n+    }\n+\n     @Test\n     public void testThatInputCanBeAStringInsteadOfAnArray() throws Exception {\n         createIndexAndMapping();"
}