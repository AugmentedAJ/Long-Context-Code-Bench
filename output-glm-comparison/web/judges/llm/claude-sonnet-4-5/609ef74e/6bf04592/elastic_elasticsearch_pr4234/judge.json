{
  "repo_url": "https://github.com/elastic/elasticsearch.git",
  "pr_number": 4234,
  "base_commit": "7d3b78c29327a1774695c4567bab0c40e7b97b6a",
  "head_commit": "c4f3da2b9d6294a1871a87b3e489f9896b95f72e",
  "judge_mode": "llm",
  "judge_model": "claude-sonnet-4-5",
  "scores": {
    "correctness": -0.4,
    "completeness": -0.3,
    "code_reuse": -0.2,
    "best_practices": -0.5,
    "unsolicited_docs": 1.0
  },
  "aggregate": -0.07999999999999999,
  "rationale": "The agent's solution has several critical issues: (1) It introduces a non-existent NoSuchNodeException class that doesn't exist in the codebase, breaking compilation. The ground truth uses the existing ElasticSearchIllegalArgumentException. (2) The validation logic uses nodes.get(nodeId) which checks all nodes, while the ground truth correctly validates against nodes.dataNodes().keys() to ensure only data nodes are checked. (3) The agent added a helper method ensureNodeIdExists in ground truth but the agent inlined the validation, missing the cleaner abstraction. (4) The test is overly complex with unnecessary indexing and uses a try-catch pattern instead of the simpler @Test(expected=...) annotation used in ground truth. (5) The agent made an unsolicited change to pom.xml (Java 1.6 to 1.8), which was not requested and violates the 'avoid over-engineering' principle. The error message quality differs: ground truth provides 'No data node with id[X] found' while the agent relies on NoSuchNodeException's default message format.",
  "edit_run_id": "6bf04592",
  "judge_run_id": "609ef74e",
  "ground_truth_patch": "diff --git a/src/main/java/org/elasticsearch/cluster/routing/operation/plain/PlainOperationRouting.java b/src/main/java/org/elasticsearch/cluster/routing/operation/plain/PlainOperationRouting.java\nindex 3b5376ae799a..61f61cd7b0c8 100644\n--- a/src/main/java/org/elasticsearch/cluster/routing/operation/plain/PlainOperationRouting.java\n+++ b/src/main/java/org/elasticsearch/cluster/routing/operation/plain/PlainOperationRouting.java\n@@ -219,7 +219,9 @@ public class PlainOperationRouting extends AbstractComponent implements Operatio\n                 return indexShard.onlyNodeActiveInitializingShardsIt(localNodeId);\n             }\n             if (preference.startsWith(\"_only_node:\")) {\n-                return indexShard.onlyNodeActiveInitializingShardsIt(preference.substring(\"_only_node:\".length()));\n+                String nodeId = preference.substring(\"_only_node:\".length());\n+                ensureNodeIdExists(nodes, nodeId);\n+                return indexShard.onlyNodeActiveInitializingShardsIt(nodeId);\n             }\n         }\n         // if not, then use it as the index\n@@ -284,4 +286,10 @@ public class PlainOperationRouting extends AbstractComponent implements Operatio\n         }\n         return hashFunction.hash(type, id);\n     }\n+\n+    private void ensureNodeIdExists(DiscoveryNodes nodes, String nodeId) {\n+        if (!nodes.dataNodes().keys().contains(nodeId)) {\n+            throw new ElasticSearchIllegalArgumentException(\"No data node with id[\" + nodeId + \"] found\");\n+        }\n+    }\n }\ndiff --git a/src/test/java/org/elasticsearch/search/preference/SearchPreferenceTests.java b/src/test/java/org/elasticsearch/search/preference/SearchPreferenceTests.java\nindex 870303dff7be..2a0448b8b3e7 100644\n--- a/src/test/java/org/elasticsearch/search/preference/SearchPreferenceTests.java\n+++ b/src/test/java/org/elasticsearch/search/preference/SearchPreferenceTests.java\n@@ -19,6 +19,7 @@\n \n package org.elasticsearch.search.preference;\n \n+import org.elasticsearch.ElasticSearchIllegalArgumentException;\n import org.elasticsearch.action.admin.cluster.health.ClusterHealthStatus;\n import org.elasticsearch.action.search.SearchResponse;\n import org.elasticsearch.action.search.SearchType;\n@@ -96,4 +97,12 @@ public class SearchPreferenceTests extends ElasticsearchIntegrationTest {\n         searchResponse = client().prepareSearch().setQuery(matchAllQuery()).setPreference(\"1234\").execute().actionGet();\n         assertThat(searchResponse.getHits().totalHits(), equalTo(1l));\n     }\n+\n+    @Test (expected = ElasticSearchIllegalArgumentException.class)\n+    public void testThatSpecifyingNonExistingNodesReturnsUsefulError() throws Exception {\n+        createIndex(\"test\");\n+        ensureGreen();\n+\n+        client().prepareSearch().setQuery(matchAllQuery()).setPreference(\"_only_node:DOES-NOT-EXIST\").execute().actionGet();\n+    }\n }"
}