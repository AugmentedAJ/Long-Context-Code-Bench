{
  "repo_url": "https://github.com/elastic/elasticsearch.git",
  "pr_number": 134296,
  "base_commit": "df8cedf9920c8bf710221ca8579bb90f64d4faa0",
  "runner": "codex",
  "model": "gpt-5.1-codex",
  "timeout_s": 10800,
  "status": "success",
  "elapsed_ms": 258234,
  "patch_unified": "diff --git a/server/src/main/java/org/elasticsearch/http/HttpStats.java b/server/src/main/java/org/elasticsearch/http/HttpStats.java\nindex d4df9c8f..89f51c92 100644\n--- a/server/src/main/java/org/elasticsearch/http/HttpStats.java\n+++ b/server/src/main/java/org/elasticsearch/http/HttpStats.java\n@@ -90,8 +90,11 @@ public record HttpStats(long serverOpen, long totalOpen, List<ClientStats> clien\n         static final String CLIENT_REMOTE_ADDRESS = \"remote_address\";\n         static final String CLIENT_LAST_URI = \"last_uri\";\n         static final String CLIENT_OPENED_TIME_MILLIS = \"opened_time_millis\";\n+        static final String CLIENT_OPENED_TIME = \"opened_time\";\n         static final String CLIENT_CLOSED_TIME_MILLIS = \"closed_time_millis\";\n+        static final String CLIENT_CLOSED_TIME = \"closed_time\";\n         static final String CLIENT_LAST_REQUEST_TIME_MILLIS = \"last_request_time_millis\";\n+        static final String CLIENT_LAST_REQUEST_TIME = \"last_request_time\";\n         static final String CLIENT_REQUEST_COUNT = \"request_count\";\n         static final String CLIENT_REQUEST_SIZE_BYTES = \"request_size_bytes\";\n         static final String CLIENT_FORWARDED_FOR = \"x_forwarded_for\";\n@@ -179,11 +182,27 @@ public record HttpStats(long serverOpen, long totalOpen, List<ClientStats> clien\n             if (opaqueId != null) {\n                 builder.field(Fields.CLIENT_OPAQUE_ID, opaqueId);\n             }\n-            builder.field(Fields.CLIENT_OPENED_TIME_MILLIS, openedTimeMillis);\n+            builder.timestampFieldsFromUnixEpochMillis(\n+                Fields.CLIENT_OPENED_TIME_MILLIS,\n+                Fields.CLIENT_OPENED_TIME,\n+                openedTimeMillis\n+            );\n             if (closedTimeMillis != NOT_CLOSED) {\n-                builder.field(Fields.CLIENT_CLOSED_TIME_MILLIS, closedTimeMillis);\n+                builder.timestampFieldsFromUnixEpochMillis(\n+                    Fields.CLIENT_CLOSED_TIME_MILLIS,\n+                    Fields.CLIENT_CLOSED_TIME,\n+                    closedTimeMillis\n+                );\n+            }\n+            if (lastRequestTimeMillis >= 0) {\n+                builder.timestampFieldsFromUnixEpochMillis(\n+                    Fields.CLIENT_LAST_REQUEST_TIME_MILLIS,\n+                    Fields.CLIENT_LAST_REQUEST_TIME,\n+                    lastRequestTimeMillis\n+                );\n+            } else {\n+                builder.field(Fields.CLIENT_LAST_REQUEST_TIME_MILLIS, lastRequestTimeMillis);\n             }\n-            builder.field(Fields.CLIENT_LAST_REQUEST_TIME_MILLIS, lastRequestTimeMillis);\n             builder.field(Fields.CLIENT_REQUEST_COUNT, requestCount);\n             builder.field(Fields.CLIENT_REQUEST_SIZE_BYTES, requestSizeBytes);\n             builder.endObject();\ndiff --git a/server/src/test/java/org/elasticsearch/http/HttpStatsTests.java b/server/src/test/java/org/elasticsearch/http/HttpStatsTests.java\nindex f5271ce2..2753fb36 100644\n--- a/server/src/test/java/org/elasticsearch/http/HttpStatsTests.java\n+++ b/server/src/test/java/org/elasticsearch/http/HttpStatsTests.java\n@@ -11,9 +11,13 @@ package org.elasticsearch.http;\n \n import org.elasticsearch.common.Strings;\n import org.elasticsearch.common.unit.ByteSizeUnit;\n+import org.elasticsearch.common.xcontent.XContentElasticsearchExtension;\n import org.elasticsearch.core.Tuple;\n import org.elasticsearch.test.ESTestCase;\n+import org.elasticsearch.xcontent.json.JsonXContent;\n \n+import java.io.IOException;\n+import java.time.Instant;\n import java.util.HashMap;\n import java.util.List;\n import java.util.Map;\n@@ -75,6 +79,58 @@ public class HttpStatsTests extends ESTestCase {\n         );\n     }\n \n+    public void testClientStatsIncludeHumanReadableTimestamps() throws IOException {\n+        final long openedTime = 1_696_000_000_000L;\n+        final long closedTime = openedTime + 1_000L;\n+        final long lastRequestTime = closedTime + 500L;\n+\n+        final Map<String, Object> client = serializeClient(new HttpStats.ClientStats(\n+            7,\n+            \"agent\",\n+            \"local\",\n+            \"remote\",\n+            \"/_path\",\n+            \"forwarded\",\n+            \"opaque\",\n+            openedTime,\n+            closedTime,\n+            lastRequestTime,\n+            10,\n+            20\n+        ));\n+\n+        assertThat(client.get(\"opened_time\"), equalTo(formatMillis(openedTime)));\n+        assertThat(((Number) client.get(\"opened_time_millis\")).longValue(), equalTo(openedTime));\n+        assertThat(client.get(\"closed_time\"), equalTo(formatMillis(closedTime)));\n+        assertThat(((Number) client.get(\"closed_time_millis\")).longValue(), equalTo(closedTime));\n+        assertThat(client.get(\"last_request_time\"), equalTo(formatMillis(lastRequestTime)));\n+        assertThat(((Number) client.get(\"last_request_time_millis\")).longValue(), equalTo(lastRequestTime));\n+    }\n+\n+    public void testClientStatsSkipHumanReadableWhenNoLastRequest() throws IOException {\n+        final long openedTime = 1_696_000_000_000L;\n+\n+        final Map<String, Object> client = serializeClient(new HttpStats.ClientStats(\n+            11,\n+            null,\n+            null,\n+            null,\n+            null,\n+            null,\n+            null,\n+            openedTime,\n+            HttpStats.ClientStats.NOT_CLOSED,\n+            -1L,\n+            0L,\n+            0L\n+        ));\n+\n+        assertThat(client.get(\"opened_time\"), equalTo(formatMillis(openedTime)));\n+        assertThat(client.containsKey(\"closed_time\"), equalTo(false));\n+        assertThat(client.containsKey(\"last_request_time\"), equalTo(false));\n+        assertThat(((Number) client.get(\"last_request_time_millis\")).longValue(), equalTo(-1L));\n+    }\n+\n     public static HttpStats randomHttpStats() {\n         return new HttpStats(\n             randomLongBetween(0, Long.MAX_VALUE),\n@@ -112,4 +168,20 @@ public class HttpStatsTests extends ESTestCase {\n             IntStream.range(0, 18).mapToLong(i -> randomLongBetween(0, 42)).toArray()\n         );\n     }\n+\n+    @SuppressWarnings(\"unchecked\")\n+    private Map<String, Object> serializeClient(HttpStats.ClientStats clientStats) throws IOException {\n+        final HttpStats httpStats = new HttpStats(0, 0, List.of(clientStats), Map.of());\n+        try (var parser = createParser(JsonXContent.jsonXContent, Strings.toString(httpStats, false, true))) {\n+            Map<String, Object> serialized = parser.mapOrdered();\n+            Map<String, Object> http = (Map<String, Object>) serialized.get(\"http\");\n+            List<Map<String, Object>> clients = (List<Map<String, Object>>) http.get(\"clients\");\n+            assertThat(clients, hasSize(1));\n+            return clients.get(0);\n+        }\n+    }\n+\n+    private static String formatMillis(long millis) {\n+        return XContentElasticsearchExtension.DEFAULT_FORMATTER.format(Instant.ofEpochMilli(millis));\n+    }\n }",
  "logs_path": "codex/gpt-5.1-codex/b8978668/elastic_elasticsearch_pr134296/logs.jsonl",
  "errors": [],
  "edit_run_id": "fd5b3480",
  "test_label": "v1-agent-comparison"
}