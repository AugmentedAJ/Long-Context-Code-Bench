{
  "repo_url": "https://github.com/elastic/elasticsearch.git",
  "pr_number": 1616,
  "base_commit": "56a9c66df183ea4e9e2cfb8861877283d4048304",
  "runner": "codex",
  "model": "gpt-5.1-codex",
  "timeout_s": 10800,
  "status": "success",
  "elapsed_ms": 135938,
  "patch_unified": "diff --git a/src/main/java/org/elasticsearch/index/mapper/internal/TTLFieldMapper.java b/src/main/java/org/elasticsearch/index/mapper/internal/TTLFieldMapper.java\nindex aa179f1..d9f672e 100644\n--- a/src/main/java/org/elasticsearch/index/mapper/internal/TTLFieldMapper.java\n+++ b/src/main/java/org/elasticsearch/index/mapper/internal/TTLFieldMapper.java\n@@ -182,6 +182,7 @@ public class TTLFieldMapper extends LongFieldMapper implements InternalMapper, R\n             long ttl = context.sourceToParse().ttl();\n             if (ttl <= 0 && defaultTTL > 0) { // no ttl provided so we use the default value\n                 ttl = defaultTTL;\n+                context.sourceToParse().ttl(ttl);\n             }\n             if (ttl > 0) { // a ttl has been provided either externally or in the _source\n                 long timestamp = context.sourceToParse().timestamp();\ndiff --git a/src/test/java/org/elasticsearch/test/unit/index/mapper/ttl/TTLMappingTests.java b/src/test/java/org/elasticsearch/test/unit/index/mapper/ttl/TTLMappingTests.java\nindex e3c02f6..f613f68 100644\n--- a/src/test/java/org/elasticsearch/test/unit/index/mapper/ttl/TTLMappingTests.java\n+++ b/src/test/java/org/elasticsearch/test/unit/index/mapper/ttl/TTLMappingTests.java\n@@ -21,6 +21,7 @@\n package org.elasticsearch.test.unit.index.mapper.ttl;\n \n import org.apache.lucene.document.Field;\n+import org.elasticsearch.common.unit.TimeValue;\n import org.elasticsearch.common.xcontent.XContentFactory;\n import org.elasticsearch.index.mapper.DocumentMapper;\n import org.elasticsearch.test.unit.index.mapper.MapperTests;\n@@ -88,4 +89,24 @@ public class TTLMappingTests {\n         assertThat(docMapper.TTLFieldMapper().store(), equalTo(Field.Store.NO));\n         assertThat(docMapper.TTLFieldMapper().index(), equalTo(Field.Index.NO));\n     }\n-}\n\\ No newline at end of file\n+\n+    @Test\n+    public void testDefaultTTLIsAppliedWhenNotProvided() throws Exception {\n+        long defaultTTL = TimeValue.timeValueHours(1).millis();\n+        String mapping = XContentFactory.jsonBuilder().startObject().startObject(\"type\")\n+                .startObject(\"_ttl\")\n+                .field(\"enabled\", \"yes\")\n+                .field(\"default\", \"1h\")\n+                .endObject()\n+                .endObject().endObject().string();\n+        DocumentMapper docMapper = MapperTests.newParser().parse(mapping);\n+        byte[] source = XContentFactory.jsonBuilder()\n+                .startObject()\n+                .field(\"field\", \"value\")\n+                .endObject()\n+                .copiedBytes();\n+        ParsedDocument doc = docMapper.parse(SourceToParse.source(source).type(\"type\").id(\"1\").timestamp(System.currentTimeMillis()));\n+\n+        assertThat(doc.ttl(), equalTo(defaultTTL));\n+    }\n+}",
  "logs_path": "codex/gpt-5.1-codex/b8978668/elastic_elasticsearch_pr1616/logs.jsonl",
  "errors": [],
  "edit_run_id": "fd5b3480",
  "test_label": "v1-agent-comparison"
}