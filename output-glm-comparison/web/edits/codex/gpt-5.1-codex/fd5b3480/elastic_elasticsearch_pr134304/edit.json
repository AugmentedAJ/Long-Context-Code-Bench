{
  "repo_url": "https://github.com/elastic/elasticsearch.git",
  "pr_number": 134304,
  "base_commit": "016ca188aa79c8e5cc0f453513376fe61115940a",
  "runner": "codex",
  "model": "gpt-5.1-codex",
  "timeout_s": 10800,
  "status": "success",
  "elapsed_ms": 64348,
  "patch_unified": "diff --git a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/optimizer/rules/logical/local/IgnoreNullMetricsTests.java b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/optimizer/rules/logical/local/IgnoreNullMetricsTests.java\nindex 5faa73b3..3ca5cddb 100644\n--- a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/optimizer/rules/logical/local/IgnoreNullMetricsTests.java\n+++ b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/optimizer/rules/logical/local/IgnoreNullMetricsTests.java\n@@ -10,6 +10,7 @@ package org.elasticsearch.xpack.esql.optimizer.rules.logical.local;\n import org.elasticsearch.index.IndexMode;\n import org.elasticsearch.test.ESTestCase;\n import org.elasticsearch.xpack.esql.EsqlTestUtils;\n+import org.elasticsearch.xpack.esql.action.EsqlCapabilities;\n import org.elasticsearch.xpack.esql.analysis.Analyzer;\n import org.elasticsearch.xpack.esql.analysis.AnalyzerContext;\n import org.elasticsearch.xpack.esql.analysis.AnalyzerTestUtils;\n@@ -45,6 +46,7 @@ import static org.elasticsearch.xpack.esql.EsqlTestUtils.as;\n import static org.elasticsearch.xpack.esql.EsqlTestUtils.emptyInferenceResolution;\n import static org.elasticsearch.xpack.esql.EsqlTestUtils.unboundLogicalOptimizerContext;\n import static org.elasticsearch.xpack.esql.analysis.AnalyzerTestUtils.defaultLookupResolution;\n+import static org.junit.Assume.assumeTrue;\n \n /**\n  * Tests for the {@link IgnoreNullMetrics} transformation rule.  Like most rule tests, this runs the entire analysis chain.\n@@ -114,7 +116,12 @@ public class IgnoreNullMetricsTests extends ESTestCase {\n         return localPlan(plan(query), TEST_SEARCH_STATS);\n     }\n \n+    private static void assumeMetricsCommandEnabled() {\n+        assumeTrue(\"requires metrics command\", EsqlCapabilities.Cap.METRICS_COMMAND.isEnabled());\n+    }\n+\n     public void testSimple() {\n+        assumeMetricsCommandEnabled();\n         LogicalPlan actual = localPlan(\"\"\"\n             TS test\n             | STATS max(max_over_time(metric_1))\n@@ -144,6 +151,7 @@ public class IgnoreNullMetricsTests extends ESTestCase {\n     }\n \n     public void testDimensionsAreNotFiltered() {\n+        assumeMetricsCommandEnabled();\n \n         LogicalPlan actual = localPlan(\"\"\"\n             TS test\n@@ -161,6 +169,7 @@ public class IgnoreNullMetricsTests extends ESTestCase {\n     }\n \n     public void testFiltersAreJoinedWithOr() {\n+        assumeMetricsCommandEnabled();\n \n         LogicalPlan actual = localPlan(\"\"\"\n             TS test\n@@ -195,6 +204,7 @@ public class IgnoreNullMetricsTests extends ESTestCase {\n     }\n \n     public void testSkipCoalescedMetrics() {\n+        assumeMetricsCommandEnabled();\n         // Note: this test is passing because the reference attribute metric_2 in the stats block does not inherit the\n         // metric property from the original field.\n         LogicalPlan actual = localPlan(\"\"\"\n@@ -218,6 +228,7 @@ public class IgnoreNullMetricsTests extends ESTestCase {\n      * check that stats blocks after the first are not sourced for adding metrics to the filter\n      */\n     public void testMultipleStats() {\n+        assumeMetricsCommandEnabled();\n         LogicalPlan actual = localPlan(\"\"\"\n             TS test\n             | STATS m = max(max_over_time(metric_1))",
  "logs_path": "codex/gpt-5.1-codex/93548e0a/elastic_elasticsearch_pr134304/logs.jsonl",
  "errors": [],
  "edit_run_id": "fd5b3480",
  "test_label": "v1-agent-comparison"
}