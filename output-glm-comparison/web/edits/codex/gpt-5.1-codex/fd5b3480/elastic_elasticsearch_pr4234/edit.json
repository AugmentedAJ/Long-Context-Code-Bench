{
  "repo_url": "https://github.com/elastic/elasticsearch.git",
  "pr_number": 4234,
  "base_commit": "7d3b78c29327a1774695c4567bab0c40e7b97b6a",
  "runner": "codex",
  "model": "gpt-5.1-codex",
  "timeout_s": 10800,
  "status": "success",
  "elapsed_ms": 173072,
  "patch_unified": "diff --git a/src/main/java/org/elasticsearch/cluster/routing/operation/plain/PlainOperationRouting.java b/src/main/java/org/elasticsearch/cluster/routing/operation/plain/PlainOperationRouting.java\nindex 3b5376a..7be754e 100644\n--- a/src/main/java/org/elasticsearch/cluster/routing/operation/plain/PlainOperationRouting.java\n+++ b/src/main/java/org/elasticsearch/cluster/routing/operation/plain/PlainOperationRouting.java\n@@ -219,7 +219,11 @@ public class PlainOperationRouting extends AbstractComponent implements Operatio\n                 return indexShard.onlyNodeActiveInitializingShardsIt(localNodeId);\n             }\n             if (preference.startsWith(\"_only_node:\")) {\n-                return indexShard.onlyNodeActiveInitializingShardsIt(preference.substring(\"_only_node:\".length()));\n+                final String nodeId = preference.substring(\"_only_node:\".length());\n+                if (!nodes.nodeExists(nodeId)) {\n+                    throw new ElasticSearchIllegalArgumentException(\"No node available for _only_node preference [\" + nodeId + \"]\");\n+                }\n+                return indexShard.onlyNodeActiveInitializingShardsIt(nodeId);\n             }\n         }\n         // if not, then use it as the index\ndiff --git a/src/test/java/org/elasticsearch/search/preference/SearchPreferenceTests.java b/src/test/java/org/elasticsearch/search/preference/SearchPreferenceTests.java\nindex 870303d..d5912aa 100644\n--- a/src/test/java/org/elasticsearch/search/preference/SearchPreferenceTests.java\n+++ b/src/test/java/org/elasticsearch/search/preference/SearchPreferenceTests.java\n@@ -19,11 +19,13 @@\n \n package org.elasticsearch.search.preference;\n \n+import org.elasticsearch.ElasticSearchIllegalArgumentException;\n import org.elasticsearch.action.admin.cluster.health.ClusterHealthStatus;\n import org.elasticsearch.action.search.SearchResponse;\n import org.elasticsearch.action.search.SearchType;\n import org.elasticsearch.client.Client;\n import org.elasticsearch.common.Priority;\n+import org.elasticsearch.common.UUIDs;\n import org.elasticsearch.rest.RestStatus;\n import org.elasticsearch.test.ElasticsearchIntegrationTest;\n import org.junit.Test;\n@@ -31,6 +33,7 @@ import org.junit.Test;\n import static org.elasticsearch.common.settings.ImmutableSettings.settingsBuilder;\n import static org.elasticsearch.index.query.QueryBuilders.matchAllQuery;\n import static org.hamcrest.Matchers.*;\n+import static org.junit.Assert.fail;\n \n public class SearchPreferenceTests extends ElasticsearchIntegrationTest {\n \n@@ -96,4 +99,19 @@ public class SearchPreferenceTests extends ElasticsearchIntegrationTest {\n         searchResponse = client().prepareSearch().setQuery(matchAllQuery()).setPreference(\"1234\").execute().actionGet();\n         assertThat(searchResponse.getHits().totalHits(), equalTo(1l));\n     }\n+\n+    @Test\n+    public void testOnlyNodePreferenceWithUnknownNode() throws Exception {\n+        createIndex(\"test\");\n+        ensureGreen();\n+\n+        String missingNode = UUIDs.randomBase64UUID();\n+        try {\n+            client().prepareSearch(\"test\").setPreference(\"_only_node:\" + missingNode).execute().actionGet();\n+            fail(\"search request should fail when _only_node targets unknown node\");\n+        } catch (ElasticSearchIllegalArgumentException e) {\n+            assertThat(e.getMessage(), containsString(\"No node available for _only_node preference\"));\n+            assertThat(e.getMessage(), containsString(missingNode));\n+        }\n+    }\n }",
  "logs_path": "codex/gpt-5.1-codex/b8978668/elastic_elasticsearch_pr4234/logs.jsonl",
  "errors": [],
  "edit_run_id": "fd5b3480",
  "test_label": "v1-agent-comparison"
}