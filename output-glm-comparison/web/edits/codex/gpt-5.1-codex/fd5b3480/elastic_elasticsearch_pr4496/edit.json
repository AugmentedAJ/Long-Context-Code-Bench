{
  "repo_url": "https://github.com/elastic/elasticsearch.git",
  "pr_number": 4496,
  "base_commit": "5a02ec86a8f76c02304b015035c4cffac4474395",
  "runner": "codex",
  "model": "gpt-5.1-codex",
  "timeout_s": 10800,
  "status": "success",
  "elapsed_ms": 128703,
  "patch_unified": "diff --git a/src/main/java/org/elasticsearch/common/joda/DateMathParser.java b/src/main/java/org/elasticsearch/common/joda/DateMathParser.java\nindex 3e9fec3..2dde91f 100644\n--- a/src/main/java/org/elasticsearch/common/joda/DateMathParser.java\n+++ b/src/main/java/org/elasticsearch/common/joda/DateMathParser.java\n@@ -198,7 +198,20 @@ public class DateMathParser {\n \n     private long parseStringValue(String value) {\n         try {\n-            return dateTimeFormatter.parser().parseMillis(value);\n+            MutableDateTime dateTime = new MutableDateTime(1970, 1, 1, 0, 0, 0, 0, DateTimeZone.UTC);\n+            int location = dateTimeFormatter.parser().parseInto(dateTime, value, 0);\n+            if (location == value.length()) {\n+                return dateTime.getMillis();\n+            }\n+            if (location <= 0 || dateTime.getYear() > 5000) {\n+                try {\n+                    long time = Long.parseLong(value);\n+                    return timeUnit.toMillis(time);\n+                } catch (NumberFormatException e1) {\n+                    throw new ElasticSearchParseException(\"failed to parse date field [\" + value + \"], tried both date format [\" + dateTimeFormatter.format() + \"], and timestamp number\");\n+                }\n+            }\n+            return dateTime.getMillis();\n         } catch (RuntimeException e) {\n             try {\n                 long time = Long.parseLong(value);\ndiff --git a/src/test/java/org/elasticsearch/common/joda/DateMathParserTests.java b/src/test/java/org/elasticsearch/common/joda/DateMathParserTests.java\nindex 0a0418a..bd436df 100644\n--- a/src/test/java/org/elasticsearch/common/joda/DateMathParserTests.java\n+++ b/src/test/java/org/elasticsearch/common/joda/DateMathParserTests.java\n@@ -1,6 +1,8 @@\n package org.elasticsearch.common.joda;\n \n import org.elasticsearch.test.ElasticsearchTestCase;\n+import org.joda.time.DateTime;\n+import org.joda.time.DateTimeZone;\n import org.junit.Test;\n \n import java.util.concurrent.TimeUnit;\n@@ -44,4 +46,15 @@ public class DateMathParserTests extends ElasticsearchTestCase {\n         assertThat(parser.parse(\"2013-03-03||/y\", 0), equalTo(parser.parse(\"2013-01-01\", 0)));\n         assertThat(parser.parseRoundCeil(\"2013-03-03||/y\", 0), equalTo(parser.parse(\"2014-01-01\", 0)));\n     }\n+\n+    @Test\n+    public void partialDateDefaultsTo1970() {\n+        DateMathParser monthDayParser = new DateMathParser(Joda.forPattern(\"yyyy/MM/dd||MM/dd\"), TimeUnit.MILLISECONDS);\n+        long expectedMonthDay = new DateTime(1970, 3, 5, 0, 0, 0, 0, DateTimeZone.UTC).getMillis();\n+        assertThat(monthDayParser.parse(\"03/05\", 0), equalTo(expectedMonthDay));\n+\n+        DateMathParser timeParser = new DateMathParser(Joda.forPattern(\"HH:mm:ss\"), TimeUnit.MILLISECONDS);\n+        long expectedTime = new DateTime(1970, 1, 1, 10, 12, 55, 0, DateTimeZone.UTC).getMillis();\n+        assertThat(timeParser.parse(\"10:12:55\", 0), equalTo(expectedTime));\n+    }\n }",
  "logs_path": "codex/gpt-5.1-codex/b8978668/elastic_elasticsearch_pr4496/logs.jsonl",
  "errors": [],
  "edit_run_id": "fd5b3480",
  "test_label": "v1-agent-comparison"
}