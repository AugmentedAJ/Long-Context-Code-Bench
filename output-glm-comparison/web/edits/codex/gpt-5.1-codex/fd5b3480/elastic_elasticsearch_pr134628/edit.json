{
  "repo_url": "https://github.com/elastic/elasticsearch.git",
  "pr_number": 134628,
  "base_commit": "630d52976d3fb951f6ea52a3d0e5fb492921df87",
  "runner": "codex",
  "model": "gpt-5.1-codex",
  "timeout_s": 10800,
  "status": "success",
  "elapsed_ms": 63481,
  "patch_unified": "diff --git a/server/src/main/java/org/elasticsearch/search/aggregations/bucket/filter/QueryToFilterAdapter.java b/server/src/main/java/org/elasticsearch/search/aggregations/bucket/filter/QueryToFilterAdapter.java\nindex 9c6f7ddd..151bb9c9 100644\n--- a/server/src/main/java/org/elasticsearch/search/aggregations/bucket/filter/QueryToFilterAdapter.java\n+++ b/server/src/main/java/org/elasticsearch/search/aggregations/bucket/filter/QueryToFilterAdapter.java\n@@ -51,14 +51,14 @@ public class QueryToFilterAdapter {\n         // Wrapping with a ConstantScoreQuery enables a few more rewrite\n         // rules as of Lucene 9.2\n         query = searcher.rewrite(new ConstantScoreQuery(query));\n-        if (query instanceof ConstantScoreQuery) {\n+        if (query instanceof ConstantScoreQuery constantScoreQuery) {\n             /*\n              * Unwrap constant score because it gets in the way of us\n              * understanding what the queries are trying to do and we\n              * don't use the score at all anyway. Effectively we always\n              * run in constant score mode.\n              */\n-            query = ((ConstantScoreQuery) query).getQuery();\n+            query = constantScoreQuery.getQuery();\n         }\n         return new QueryToFilterAdapter(searcher, key, query);\n     }\n@@ -132,8 +132,9 @@ public class QueryToFilterAdapter {\n         extraQuery = searcher().rewrite(new ConstantScoreQuery(extraQuery));\n         Query unwrappedExtraQuery = unwrap(extraQuery);\n         Query unwrappedQuery = unwrap(query);\n-        if (unwrappedQuery instanceof PointRangeQuery && unwrappedExtraQuery instanceof PointRangeQuery) {\n-            Query merged = MergedPointRangeQuery.merge((PointRangeQuery) unwrappedQuery, (PointRangeQuery) unwrappedExtraQuery);\n+        if (unwrappedQuery instanceof PointRangeQuery pointRangeQuery\n+            && unwrappedExtraQuery instanceof PointRangeQuery extraPointRangeQuery) {\n+            Query merged = MergedPointRangeQuery.merge(pointRangeQuery, extraPointRangeQuery);\n             if (merged != null) {\n                 // Should we rewrap here?\n                 return new QueryToFilterAdapter(searcher(), key(), merged);\n@@ -143,8 +144,8 @@ public class QueryToFilterAdapter {\n         builder.add(query, BooleanClause.Occur.FILTER);\n         builder.add(extraQuery, BooleanClause.Occur.FILTER);\n         Query rewrittenUnion = searcher().rewrite(new ConstantScoreQuery(builder.build()));\n-        if (rewrittenUnion instanceof ConstantScoreQuery) {\n-            rewrittenUnion = ((ConstantScoreQuery) rewrittenUnion).getQuery();\n+        if (rewrittenUnion instanceof ConstantScoreQuery constantScoreQuery) {\n+            rewrittenUnion = constantScoreQuery.getQuery();\n         }\n         // This union is inefficient if Lucene cannot merge clauses of the boolean query through a rewrite.\n         final boolean inefficientUnion = rewrittenUnion instanceof BooleanQuery;\n@@ -157,16 +158,16 @@ public class QueryToFilterAdapter {\n \n     private static Query unwrap(Query query) {\n         while (true) {\n-            if (query instanceof ConstantScoreQuery) {\n-                query = ((ConstantScoreQuery) query).getQuery();\n+            if (query instanceof ConstantScoreQuery constantScoreQuery) {\n+                query = constantScoreQuery.getQuery();\n                 continue;\n             }\n-            if (query instanceof IndexSortSortedNumericDocValuesRangeQuery) {\n-                query = ((IndexSortSortedNumericDocValuesRangeQuery) query).getFallbackQuery();\n+            if (query instanceof IndexSortSortedNumericDocValuesRangeQuery indexSortSortedNumericDocValuesRangeQuery) {\n+                query = indexSortSortedNumericDocValuesRangeQuery.getFallbackQuery();\n                 continue;\n             }\n-            if (query instanceof IndexOrDocValuesQuery) {\n-                query = ((IndexOrDocValuesQuery) query).getIndexQuery();\n+            if (query instanceof IndexOrDocValuesQuery indexOrDocValuesQuery) {\n+                query = indexOrDocValuesQuery.getIndexQuery();\n                 continue;\n             }\n             return query;",
  "logs_path": "codex/gpt-5.1-codex/b8978668/elastic_elasticsearch_pr134628/logs.jsonl",
  "errors": [],
  "edit_run_id": "fd5b3480",
  "test_label": "v1-agent-comparison"
}