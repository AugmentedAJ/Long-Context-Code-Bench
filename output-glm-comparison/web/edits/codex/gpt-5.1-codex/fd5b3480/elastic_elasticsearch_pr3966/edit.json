{
  "repo_url": "https://github.com/elastic/elasticsearch.git",
  "pr_number": 3966,
  "base_commit": "c9dab6991eff5c01c7b0c36aecaf0f061267e030",
  "runner": "codex",
  "model": "gpt-5.1-codex",
  "timeout_s": 10800,
  "status": "success",
  "elapsed_ms": 478560,
  "patch_unified": "diff --git a/src/main/java/org/elasticsearch/index/analysis/AnalysisService.java b/src/main/java/org/elasticsearch/index/analysis/AnalysisService.java\nindex 7698020..426e976 100644\n--- a/src/main/java/org/elasticsearch/index/analysis/AnalysisService.java\n+++ b/src/main/java/org/elasticsearch/index/analysis/AnalysisService.java\n@@ -22,6 +22,8 @@ package org.elasticsearch.index.analysis;\n import com.google.common.collect.ImmutableMap;\n import org.apache.lucene.analysis.Analyzer;\n import org.elasticsearch.ElasticSearchIllegalArgumentException;\n+import org.elasticsearch.Version;\n+import org.elasticsearch.cluster.metadata.IndexMetaData;\n import org.elasticsearch.common.Nullable;\n import org.elasticsearch.common.Strings;\n import org.elasticsearch.common.component.CloseableComponent;\n@@ -64,6 +66,8 @@ public class AnalysisService extends AbstractIndexComponent implements Closeable\n                            @Nullable Map<String, TokenFilterFactoryFactory> tokenFilterFactoryFactories) {\n         super(index, indexSettings);\n \n+        final Version indexCreatedVersion = indexSettings.getAsVersion(IndexMetaData.SETTING_VERSION_CREATED, Version.CURRENT);\n+\n         Map<String, TokenizerFactory> tokenizers = newHashMap();\n         if (tokenizerFactoryFactories != null) {\n             Map<String, Settings> tokenizersSettings = indexSettings.getGroups(\"index.analysis.tokenizer\");\n@@ -177,24 +181,23 @@ public class AnalysisService extends AbstractIndexComponent implements Closeable\n                 AnalyzerProviderFactory analyzerFactoryFactory = entry.getValue();\n \n                 Settings analyzerSettings = analyzersSettings.get(analyzerName);\n-                if (analyzerSettings == null) {\n-                    analyzerSettings = ImmutableSettings.Builder.EMPTY_SETTINGS;\n-                }\n+                analyzerSettings = analyzerSettingsWithVersion(analyzerSettings, indexCreatedVersion);\n \n                 AnalyzerProvider analyzerFactory = analyzerFactoryFactory.create(analyzerName, analyzerSettings);\n                 analyzerProviders.put(analyzerName, analyzerFactory);\n             }\n         }\n         if (indicesAnalysisService != null) {\n+            final Settings defaultAnalyzerSettings = analyzerSettingsWithVersion(ImmutableSettings.Builder.EMPTY_SETTINGS, indexCreatedVersion);\n             for (Map.Entry<String, PreBuiltAnalyzerProviderFactory> entry : indicesAnalysisService.analyzerProviderFactories().entrySet()) {\n                 String name = entry.getKey();\n                 if (!analyzerProviders.containsKey(name)) {\n-                    analyzerProviders.put(name, entry.getValue().create(name, ImmutableSettings.Builder.EMPTY_SETTINGS));\n+                    analyzerProviders.put(name, entry.getValue().create(name, defaultAnalyzerSettings));\n                 }\n                 name = Strings.toCamelCase(entry.getKey());\n                 if (!name.equals(entry.getKey())) {\n                     if (!analyzerProviders.containsKey(name)) {\n-                        analyzerProviders.put(name, entry.getValue().create(name, ImmutableSettings.Builder.EMPTY_SETTINGS));\n+                        analyzerProviders.put(name, entry.getValue().create(name, defaultAnalyzerSettings));\n                     }\n                 }\n             }\n@@ -300,4 +303,14 @@ public class AnalysisService extends AbstractIndexComponent implements Closeable\n     public TokenFilterFactory tokenFilter(String name) {\n         return tokenFilters.get(name);\n     }\n+\n+    private Settings analyzerSettingsWithVersion(Settings analyzerSettings, Version indexCreatedVersion) {\n+        if (analyzerSettings == null) {\n+            analyzerSettings = ImmutableSettings.Builder.EMPTY_SETTINGS;\n+        }\n+        if (analyzerSettings.get(IndexMetaData.SETTING_VERSION_CREATED) != null) {\n+            return analyzerSettings;\n+        }\n+        return ImmutableSettings.settingsBuilder().put(analyzerSettings).put(IndexMetaData.SETTING_VERSION_CREATED, indexCreatedVersion).build();\n+    }\n }\ndiff --git a/src/main/java/org/elasticsearch/index/analysis/PreBuiltAnalyzerProviderFactory.java b/src/main/java/org/elasticsearch/index/analysis/PreBuiltAnalyzerProviderFactory.java\nindex 1cf698d..874df7c 100644\n--- a/src/main/java/org/elasticsearch/index/analysis/PreBuiltAnalyzerProviderFactory.java\n+++ b/src/main/java/org/elasticsearch/index/analysis/PreBuiltAnalyzerProviderFactory.java\n@@ -20,13 +20,27 @@\n package org.elasticsearch.index.analysis;\n \n import org.apache.lucene.analysis.Analyzer;\n+import org.apache.lucene.util.Version;\n+import org.elasticsearch.cluster.metadata.IndexMetaData;\n+import org.elasticsearch.common.lucene.Lucene;\n import org.elasticsearch.common.settings.Settings;\n+import org.elasticsearch.common.util.concurrent.ConcurrentCollections;\n+\n+import java.util.concurrent.ConcurrentMap;\n \n /**\n  *\n  */\n public class PreBuiltAnalyzerProviderFactory implements AnalyzerProviderFactory {\n \n+    public static interface AnalyzerFactory {\n+        Analyzer create(Version version);\n+    }\n+\n+    private final String name;\n+    private final AnalyzerScope scope;\n+    private final AnalyzerFactory analyzerFactory;\n+    private final ConcurrentMap<Version, PreBuiltAnalyzerProvider> cachedAnalyzers;\n     private final PreBuiltAnalyzerProvider analyzerProvider;\n \n     public PreBuiltAnalyzerProviderFactory(String name, AnalyzerScope scope, Analyzer analyzer) {\n@@ -34,15 +48,61 @@ public class PreBuiltAnalyzerProviderFactory implements AnalyzerProviderFactory\n     }\n \n     public PreBuiltAnalyzerProviderFactory(PreBuiltAnalyzerProvider analyzerProvider) {\n+        this.name = analyzerProvider.name();\n+        this.scope = analyzerProvider.scope();\n+        this.analyzerFactory = null;\n+        this.cachedAnalyzers = null;\n         this.analyzerProvider = analyzerProvider;\n     }\n \n+    public PreBuiltAnalyzerProviderFactory(String name, AnalyzerScope scope, AnalyzerFactory analyzerFactory) {\n+        this.name = name;\n+        this.scope = scope;\n+        this.analyzerFactory = analyzerFactory;\n+        this.cachedAnalyzers = ConcurrentCollections.newConcurrentMap();\n+        this.analyzerProvider = null;\n+    }\n+\n     @Override\n     public AnalyzerProvider create(String name, Settings settings) {\n-        return analyzerProvider;\n+        if (analyzerFactory == null) {\n+            return analyzerProvider;\n+        }\n+        org.elasticsearch.Version indexVersion = org.elasticsearch.Version.CURRENT;\n+        if (settings != null) {\n+            indexVersion = settings.getAsVersion(IndexMetaData.SETTING_VERSION_CREATED, org.elasticsearch.Version.CURRENT);\n+        }\n+        return cachedAnalyzer(indexVersion.luceneVersion);\n     }\n \n     public Analyzer analyzer() {\n-        return analyzerProvider.get();\n+        if (analyzerFactory == null) {\n+            return analyzerProvider.get();\n+        }\n+        return cachedAnalyzer(Lucene.ANALYZER_VERSION).get();\n+    }\n+\n+    public void close() {\n+        if (analyzerFactory == null) {\n+            if (analyzerProvider != null) {\n+                analyzerProvider.get().close();\n+            }\n+            return;\n+        }\n+        for (PreBuiltAnalyzerProvider provider : cachedAnalyzers.values()) {\n+            provider.get().close();\n+        }\n+    }\n+\n+    private PreBuiltAnalyzerProvider cachedAnalyzer(Version version) {\n+        PreBuiltAnalyzerProvider provider = cachedAnalyzers.get(version);\n+        if (provider == null) {\n+            provider = new PreBuiltAnalyzerProvider(name, scope, analyzerFactory.create(version));\n+            PreBuiltAnalyzerProvider existing = cachedAnalyzers.putIfAbsent(version, provider);\n+            if (existing != null) {\n+                provider = existing;\n+            }\n+        }\n+        return provider;\n     }\n }\ndiff --git a/src/main/java/org/elasticsearch/indices/analysis/IndicesAnalysisService.java b/src/main/java/org/elasticsearch/indices/analysis/IndicesAnalysisService.java\nindex 6b52755..1f38c35 100644\n--- a/src/main/java/org/elasticsearch/indices/analysis/IndicesAnalysisService.java\n+++ b/src/main/java/org/elasticsearch/indices/analysis/IndicesAnalysisService.java\n@@ -82,6 +82,7 @@ import org.apache.lucene.analysis.th.ThaiAnalyzer;\n import org.apache.lucene.analysis.tr.TurkishAnalyzer;\n import org.apache.lucene.analysis.util.ElisionFilter;\n import org.apache.lucene.analysis.util.CharArraySet;\n+import org.apache.lucene.util.Version;\n import org.elasticsearch.common.component.AbstractComponent;\n import org.elasticsearch.common.inject.Inject;\n import org.elasticsearch.common.lucene.Lucene;\n@@ -114,52 +115,257 @@ public class IndicesAnalysisService extends AbstractComponent {\n     public IndicesAnalysisService(Settings settings) {\n         super(settings);\n \n-        StandardAnalyzer standardAnalyzer = new StandardAnalyzer(Lucene.ANALYZER_VERSION);\n+        PreBuiltAnalyzerProviderFactory.AnalyzerFactory standardAnalyzer = new PreBuiltAnalyzerProviderFactory.AnalyzerFactory() {\n+            @Override\n+            public Analyzer create(Version version) {\n+                return new StandardAnalyzer(version);\n+            }\n+        };\n         analyzerProviderFactories.put(\"default\", new PreBuiltAnalyzerProviderFactory(\"default\", AnalyzerScope.INDICES, standardAnalyzer));\n         analyzerProviderFactories.put(\"standard\", new PreBuiltAnalyzerProviderFactory(\"standard\", AnalyzerScope.INDICES, standardAnalyzer));\n-        analyzerProviderFactories.put(\"keyword\", new PreBuiltAnalyzerProviderFactory(\"keyword\", AnalyzerScope.INDICES, new KeywordAnalyzer()));\n-        analyzerProviderFactories.put(\"stop\", new PreBuiltAnalyzerProviderFactory(\"stop\", AnalyzerScope.INDICES, new StopAnalyzer(Lucene.ANALYZER_VERSION)));\n-        analyzerProviderFactories.put(\"whitespace\", new PreBuiltAnalyzerProviderFactory(\"whitespace\", AnalyzerScope.INDICES, new WhitespaceAnalyzer(Lucene.ANALYZER_VERSION)));\n-        analyzerProviderFactories.put(\"simple\", new PreBuiltAnalyzerProviderFactory(\"simple\", AnalyzerScope.INDICES, new SimpleAnalyzer(Lucene.ANALYZER_VERSION)));\n-        analyzerProviderFactories.put(\"classic\", new PreBuiltAnalyzerProviderFactory(\"classic\", AnalyzerScope.INDICES, new ClassicAnalyzer(Lucene.ANALYZER_VERSION)));\n-\n-        // extended ones\n-        analyzerProviderFactories.put(\"pattern\", new PreBuiltAnalyzerProviderFactory(\"pattern\", AnalyzerScope.INDICES, new PatternAnalyzer(Lucene.ANALYZER_VERSION, Regex.compile(\"\\\\W+\" /*PatternAnalyzer.NON_WORD_PATTERN*/, null), true, StopAnalyzer.ENGLISH_STOP_WORDS_SET)));\n-        analyzerProviderFactories.put(\"snowball\", new PreBuiltAnalyzerProviderFactory(\"snowball\", AnalyzerScope.INDICES, new SnowballAnalyzer(Lucene.ANALYZER_VERSION, \"English\", StopAnalyzer.ENGLISH_STOP_WORDS_SET)));\n-        analyzerProviderFactories.put(\"standard_html_strip\", new PreBuiltAnalyzerProviderFactory(\"standard_html_strip\", AnalyzerScope.INDICES, new StandardHtmlStripAnalyzer(Lucene.ANALYZER_VERSION)));\n-\n-        analyzerProviderFactories.put(\"arabic\", new PreBuiltAnalyzerProviderFactory(\"arabic\", AnalyzerScope.INDICES, new ArabicAnalyzer(Lucene.ANALYZER_VERSION)));\n-        analyzerProviderFactories.put(\"armenian\", new PreBuiltAnalyzerProviderFactory(\"armenian\", AnalyzerScope.INDICES, new ArmenianAnalyzer(Lucene.ANALYZER_VERSION)));\n-        analyzerProviderFactories.put(\"basque\", new PreBuiltAnalyzerProviderFactory(\"basque\", AnalyzerScope.INDICES, new BasqueAnalyzer(Lucene.ANALYZER_VERSION)));\n-        analyzerProviderFactories.put(\"brazilian\", new PreBuiltAnalyzerProviderFactory(\"brazilian\", AnalyzerScope.INDICES, new BrazilianAnalyzer(Lucene.ANALYZER_VERSION)));\n-        analyzerProviderFactories.put(\"bulgarian\", new PreBuiltAnalyzerProviderFactory(\"bulgarian\", AnalyzerScope.INDICES, new BulgarianAnalyzer(Lucene.ANALYZER_VERSION)));\n-        analyzerProviderFactories.put(\"catalan\", new PreBuiltAnalyzerProviderFactory(\"catalan\", AnalyzerScope.INDICES, new CatalanAnalyzer(Lucene.ANALYZER_VERSION)));\n-        analyzerProviderFactories.put(\"chinese\", new PreBuiltAnalyzerProviderFactory(\"chinese\", AnalyzerScope.INDICES, new ChineseAnalyzer()));\n-        analyzerProviderFactories.put(\"cjk\", new PreBuiltAnalyzerProviderFactory(\"cjk\", AnalyzerScope.INDICES, new CJKAnalyzer(Lucene.ANALYZER_VERSION)));\n-        analyzerProviderFactories.put(\"czech\", new PreBuiltAnalyzerProviderFactory(\"czech\", AnalyzerScope.INDICES, new CzechAnalyzer(Lucene.ANALYZER_VERSION)));\n-        analyzerProviderFactories.put(\"dutch\", new PreBuiltAnalyzerProviderFactory(\"dutch\", AnalyzerScope.INDICES, new DutchAnalyzer(Lucene.ANALYZER_VERSION)));\n-        analyzerProviderFactories.put(\"danish\", new PreBuiltAnalyzerProviderFactory(\"danish\", AnalyzerScope.INDICES, new DanishAnalyzer(Lucene.ANALYZER_VERSION)));\n-        analyzerProviderFactories.put(\"english\", new PreBuiltAnalyzerProviderFactory(\"english\", AnalyzerScope.INDICES, new EnglishAnalyzer(Lucene.ANALYZER_VERSION)));\n-        analyzerProviderFactories.put(\"finnish\", new PreBuiltAnalyzerProviderFactory(\"finnish\", AnalyzerScope.INDICES, new FinnishAnalyzer(Lucene.ANALYZER_VERSION)));\n-        analyzerProviderFactories.put(\"french\", new PreBuiltAnalyzerProviderFactory(\"french\", AnalyzerScope.INDICES, new FrenchAnalyzer(Lucene.ANALYZER_VERSION)));\n-        analyzerProviderFactories.put(\"galician\", new PreBuiltAnalyzerProviderFactory(\"galician\", AnalyzerScope.INDICES, new GalicianAnalyzer(Lucene.ANALYZER_VERSION)));\n-        analyzerProviderFactories.put(\"german\", new PreBuiltAnalyzerProviderFactory(\"german\", AnalyzerScope.INDICES, new GermanAnalyzer(Lucene.ANALYZER_VERSION)));\n-        analyzerProviderFactories.put(\"greek\", new PreBuiltAnalyzerProviderFactory(\"greek\", AnalyzerScope.INDICES, new GreekAnalyzer(Lucene.ANALYZER_VERSION)));\n-        analyzerProviderFactories.put(\"hindi\", new PreBuiltAnalyzerProviderFactory(\"hindi\", AnalyzerScope.INDICES, new HindiAnalyzer(Lucene.ANALYZER_VERSION)));\n-        analyzerProviderFactories.put(\"hungarian\", new PreBuiltAnalyzerProviderFactory(\"hungarian\", AnalyzerScope.INDICES, new HungarianAnalyzer(Lucene.ANALYZER_VERSION)));\n-        analyzerProviderFactories.put(\"indonesian\", new PreBuiltAnalyzerProviderFactory(\"indonesian\", AnalyzerScope.INDICES, new IndonesianAnalyzer(Lucene.ANALYZER_VERSION)));\n-        analyzerProviderFactories.put(\"irish\", new PreBuiltAnalyzerProviderFactory(\"irish\", AnalyzerScope.INDICES, new IrishAnalyzer(Lucene.ANALYZER_VERSION)));\n-        analyzerProviderFactories.put(\"italian\", new PreBuiltAnalyzerProviderFactory(\"italian\", AnalyzerScope.INDICES, new ItalianAnalyzer(Lucene.ANALYZER_VERSION)));\n-        analyzerProviderFactories.put(\"latvian\", new PreBuiltAnalyzerProviderFactory(\"latvian\", AnalyzerScope.INDICES, new LatvianAnalyzer(Lucene.ANALYZER_VERSION)));\n-        analyzerProviderFactories.put(\"norwegian\", new PreBuiltAnalyzerProviderFactory(\"norwegian\", AnalyzerScope.INDICES, new NorwegianAnalyzer(Lucene.ANALYZER_VERSION)));\n-        analyzerProviderFactories.put(\"persian\", new PreBuiltAnalyzerProviderFactory(\"persian\", AnalyzerScope.INDICES, new PersianAnalyzer(Lucene.ANALYZER_VERSION)));\n-        analyzerProviderFactories.put(\"portuguese\", new PreBuiltAnalyzerProviderFactory(\"portuguese\", AnalyzerScope.INDICES, new PortugueseAnalyzer(Lucene.ANALYZER_VERSION)));\n-        analyzerProviderFactories.put(\"romanian\", new PreBuiltAnalyzerProviderFactory(\"romanian\", AnalyzerScope.INDICES, new RomanianAnalyzer(Lucene.ANALYZER_VERSION)));\n-        analyzerProviderFactories.put(\"russian\", new PreBuiltAnalyzerProviderFactory(\"russian\", AnalyzerScope.INDICES, new RussianAnalyzer(Lucene.ANALYZER_VERSION)));\n-        analyzerProviderFactories.put(\"spanish\", new PreBuiltAnalyzerProviderFactory(\"spanish\", AnalyzerScope.INDICES, new SpanishAnalyzer(Lucene.ANALYZER_VERSION)));\n-        analyzerProviderFactories.put(\"swedish\", new PreBuiltAnalyzerProviderFactory(\"swedish\", AnalyzerScope.INDICES, new SwedishAnalyzer(Lucene.ANALYZER_VERSION)));\n-        analyzerProviderFactories.put(\"turkish\", new PreBuiltAnalyzerProviderFactory(\"turkish\", AnalyzerScope.INDICES, new TurkishAnalyzer(Lucene.ANALYZER_VERSION)));\n-        analyzerProviderFactories.put(\"thai\", new PreBuiltAnalyzerProviderFactory(\"thai\", AnalyzerScope.INDICES, new ThaiAnalyzer(Lucene.ANALYZER_VERSION)));\n+        analyzerProviderFactories.put(\"keyword\", new PreBuiltAnalyzerProviderFactory(\"keyword\", AnalyzerScope.INDICES, new PreBuiltAnalyzerProviderFactory.AnalyzerFactory() {\n+            @Override\n+            public Analyzer create(Version version) {\n+                return new KeywordAnalyzer();\n+            }\n+        }));\n+        analyzerProviderFactories.put(\"stop\", new PreBuiltAnalyzerProviderFactory(\"stop\", AnalyzerScope.INDICES, new PreBuiltAnalyzerProviderFactory.AnalyzerFactory() {\n+            @Override\n+            public Analyzer create(Version version) {\n+                return new StopAnalyzer(version);\n+            }\n+        }));\n+        analyzerProviderFactories.put(\"whitespace\", new PreBuiltAnalyzerProviderFactory(\"whitespace\", AnalyzerScope.INDICES, new PreBuiltAnalyzerProviderFactory.AnalyzerFactory() {\n+            @Override\n+            public Analyzer create(Version version) {\n+                return new WhitespaceAnalyzer(version);\n+            }\n+        }));\n+        analyzerProviderFactories.put(\"simple\", new PreBuiltAnalyzerProviderFactory(\"simple\", AnalyzerScope.INDICES, new PreBuiltAnalyzerProviderFactory.AnalyzerFactory() {\n+            @Override\n+            public Analyzer create(Version version) {\n+                return new SimpleAnalyzer(version);\n+            }\n+        }));\n+        analyzerProviderFactories.put(\"classic\", new PreBuiltAnalyzerProviderFactory(\"classic\", AnalyzerScope.INDICES, new PreBuiltAnalyzerProviderFactory.AnalyzerFactory() {\n+            @Override\n+            public Analyzer create(Version version) {\n+                return new ClassicAnalyzer(version);\n+            }\n+        }));\n+\n+        final java.util.regex.Pattern pattern = Regex.compile(\"\\\\W+\" /*PatternAnalyzer.NON_WORD_PATTERN*/, null);\n+        analyzerProviderFactories.put(\"pattern\", new PreBuiltAnalyzerProviderFactory(\"pattern\", AnalyzerScope.INDICES, new PreBuiltAnalyzerProviderFactory.AnalyzerFactory() {\n+            @Override\n+            public Analyzer create(Version version) {\n+                return new PatternAnalyzer(version, pattern, true, StopAnalyzer.ENGLISH_STOP_WORDS_SET);\n+            }\n+        }));\n+        analyzerProviderFactories.put(\"snowball\", new PreBuiltAnalyzerProviderFactory(\"snowball\", AnalyzerScope.INDICES, new PreBuiltAnalyzerProviderFactory.AnalyzerFactory() {\n+            @Override\n+            public Analyzer create(Version version) {\n+                return new SnowballAnalyzer(version, \"English\", StopAnalyzer.ENGLISH_STOP_WORDS_SET);\n+            }\n+        }));\n+        analyzerProviderFactories.put(\"standard_html_strip\", new PreBuiltAnalyzerProviderFactory(\"standard_html_strip\", AnalyzerScope.INDICES, new PreBuiltAnalyzerProviderFactory.AnalyzerFactory() {\n+            @Override\n+            public Analyzer create(Version version) {\n+                return new StandardHtmlStripAnalyzer(version);\n+            }\n+        }));\n+\n+        analyzerProviderFactories.put(\"arabic\", new PreBuiltAnalyzerProviderFactory(\"arabic\", AnalyzerScope.INDICES, new PreBuiltAnalyzerProviderFactory.AnalyzerFactory() {\n+            @Override\n+            public Analyzer create(Version version) {\n+                return new ArabicAnalyzer(version);\n+            }\n+        }));\n+        analyzerProviderFactories.put(\"armenian\", new PreBuiltAnalyzerProviderFactory(\"armenian\", AnalyzerScope.INDICES, new PreBuiltAnalyzerProviderFactory.AnalyzerFactory() {\n+            @Override\n+            public Analyzer create(Version version) {\n+                return new ArmenianAnalyzer(version);\n+            }\n+        }));\n+        analyzerProviderFactories.put(\"basque\", new PreBuiltAnalyzerProviderFactory(\"basque\", AnalyzerScope.INDICES, new PreBuiltAnalyzerProviderFactory.AnalyzerFactory() {\n+            @Override\n+            public Analyzer create(Version version) {\n+                return new BasqueAnalyzer(version);\n+            }\n+        }));\n+        analyzerProviderFactories.put(\"brazilian\", new PreBuiltAnalyzerProviderFactory(\"brazilian\", AnalyzerScope.INDICES, new PreBuiltAnalyzerProviderFactory.AnalyzerFactory() {\n+            @Override\n+            public Analyzer create(Version version) {\n+                return new BrazilianAnalyzer(version);\n+            }\n+        }));\n+        analyzerProviderFactories.put(\"bulgarian\", new PreBuiltAnalyzerProviderFactory(\"bulgarian\", AnalyzerScope.INDICES, new PreBuiltAnalyzerProviderFactory.AnalyzerFactory() {\n+            @Override\n+            public Analyzer create(Version version) {\n+                return new BulgarianAnalyzer(version);\n+            }\n+        }));\n+        analyzerProviderFactories.put(\"catalan\", new PreBuiltAnalyzerProviderFactory(\"catalan\", AnalyzerScope.INDICES, new PreBuiltAnalyzerProviderFactory.AnalyzerFactory() {\n+            @Override\n+            public Analyzer create(Version version) {\n+                return new CatalanAnalyzer(version);\n+            }\n+        }));\n+        analyzerProviderFactories.put(\"chinese\", new PreBuiltAnalyzerProviderFactory(\"chinese\", AnalyzerScope.INDICES, new PreBuiltAnalyzerProviderFactory.AnalyzerFactory() {\n+            @Override\n+            public Analyzer create(Version version) {\n+                return new ChineseAnalyzer();\n+            }\n+        }));\n+        analyzerProviderFactories.put(\"cjk\", new PreBuiltAnalyzerProviderFactory(\"cjk\", AnalyzerScope.INDICES, new PreBuiltAnalyzerProviderFactory.AnalyzerFactory() {\n+            @Override\n+            public Analyzer create(Version version) {\n+                return new CJKAnalyzer(version);\n+            }\n+        }));\n+        analyzerProviderFactories.put(\"czech\", new PreBuiltAnalyzerProviderFactory(\"czech\", AnalyzerScope.INDICES, new PreBuiltAnalyzerProviderFactory.AnalyzerFactory() {\n+            @Override\n+            public Analyzer create(Version version) {\n+                return new CzechAnalyzer(version);\n+            }\n+        }));\n+        analyzerProviderFactories.put(\"dutch\", new PreBuiltAnalyzerProviderFactory(\"dutch\", AnalyzerScope.INDICES, new PreBuiltAnalyzerProviderFactory.AnalyzerFactory() {\n+            @Override\n+            public Analyzer create(Version version) {\n+                return new DutchAnalyzer(version);\n+            }\n+        }));\n+        analyzerProviderFactories.put(\"danish\", new PreBuiltAnalyzerProviderFactory(\"danish\", AnalyzerScope.INDICES, new PreBuiltAnalyzerProviderFactory.AnalyzerFactory() {\n+            @Override\n+            public Analyzer create(Version version) {\n+                return new DanishAnalyzer(version);\n+            }\n+        }));\n+        analyzerProviderFactories.put(\"english\", new PreBuiltAnalyzerProviderFactory(\"english\", AnalyzerScope.INDICES, new PreBuiltAnalyzerProviderFactory.AnalyzerFactory() {\n+            @Override\n+            public Analyzer create(Version version) {\n+                return new EnglishAnalyzer(version);\n+            }\n+        }));\n+        analyzerProviderFactories.put(\"finnish\", new PreBuiltAnalyzerProviderFactory(\"finnish\", AnalyzerScope.INDICES, new PreBuiltAnalyzerProviderFactory.AnalyzerFactory() {\n+            @Override\n+            public Analyzer create(Version version) {\n+                return new FinnishAnalyzer(version);\n+            }\n+        }));\n+        analyzerProviderFactories.put(\"french\", new PreBuiltAnalyzerProviderFactory(\"french\", AnalyzerScope.INDICES, new PreBuiltAnalyzerProviderFactory.AnalyzerFactory() {\n+            @Override\n+            public Analyzer create(Version version) {\n+                return new FrenchAnalyzer(version);\n+            }\n+        }));\n+        analyzerProviderFactories.put(\"galician\", new PreBuiltAnalyzerProviderFactory(\"galician\", AnalyzerScope.INDICES, new PreBuiltAnalyzerProviderFactory.AnalyzerFactory() {\n+            @Override\n+            public Analyzer create(Version version) {\n+                return new GalicianAnalyzer(version);\n+            }\n+        }));\n+        analyzerProviderFactories.put(\"german\", new PreBuiltAnalyzerProviderFactory(\"german\", AnalyzerScope.INDICES, new PreBuiltAnalyzerProviderFactory.AnalyzerFactory() {\n+            @Override\n+            public Analyzer create(Version version) {\n+                return new GermanAnalyzer(version);\n+            }\n+        }));\n+        analyzerProviderFactories.put(\"greek\", new PreBuiltAnalyzerProviderFactory(\"greek\", AnalyzerScope.INDICES, new PreBuiltAnalyzerProviderFactory.AnalyzerFactory() {\n+            @Override\n+            public Analyzer create(Version version) {\n+                return new GreekAnalyzer(version);\n+            }\n+        }));\n+        analyzerProviderFactories.put(\"hindi\", new PreBuiltAnalyzerProviderFactory(\"hindi\", AnalyzerScope.INDICES, new PreBuiltAnalyzerProviderFactory.AnalyzerFactory() {\n+            @Override\n+            public Analyzer create(Version version) {\n+                return new HindiAnalyzer(version);\n+            }\n+        }));\n+        analyzerProviderFactories.put(\"hungarian\", new PreBuiltAnalyzerProviderFactory(\"hungarian\", AnalyzerScope.INDICES, new PreBuiltAnalyzerProviderFactory.AnalyzerFactory() {\n+            @Override\n+            public Analyzer create(Version version) {\n+                return new HungarianAnalyzer(version);\n+            }\n+        }));\n+        analyzerProviderFactories.put(\"indonesian\", new PreBuiltAnalyzerProviderFactory(\"indonesian\", AnalyzerScope.INDICES, new PreBuiltAnalyzerProviderFactory.AnalyzerFactory() {\n+            @Override\n+            public Analyzer create(Version version) {\n+                return new IndonesianAnalyzer(version);\n+            }\n+        }));\n+        analyzerProviderFactories.put(\"irish\", new PreBuiltAnalyzerProviderFactory(\"irish\", AnalyzerScope.INDICES, new PreBuiltAnalyzerProviderFactory.AnalyzerFactory() {\n+            @Override\n+            public Analyzer create(Version version) {\n+                return new IrishAnalyzer(version);\n+            }\n+        }));\n+        analyzerProviderFactories.put(\"italian\", new PreBuiltAnalyzerProviderFactory(\"italian\", AnalyzerScope.INDICES, new PreBuiltAnalyzerProviderFactory.AnalyzerFactory() {\n+            @Override\n+            public Analyzer create(Version version) {\n+                return new ItalianAnalyzer(version);\n+            }\n+        }));\n+        analyzerProviderFactories.put(\"latvian\", new PreBuiltAnalyzerProviderFactory(\"latvian\", AnalyzerScope.INDICES, new PreBuiltAnalyzerProviderFactory.AnalyzerFactory() {\n+            @Override\n+            public Analyzer create(Version version) {\n+                return new LatvianAnalyzer(version);\n+            }\n+        }));\n+        analyzerProviderFactories.put(\"norwegian\", new PreBuiltAnalyzerProviderFactory(\"norwegian\", AnalyzerScope.INDICES, new PreBuiltAnalyzerProviderFactory.AnalyzerFactory() {\n+            @Override\n+            public Analyzer create(Version version) {\n+                return new NorwegianAnalyzer(version);\n+            }\n+        }));\n+        analyzerProviderFactories.put(\"persian\", new PreBuiltAnalyzerProviderFactory(\"persian\", AnalyzerScope.INDICES, new PreBuiltAnalyzerProviderFactory.AnalyzerFactory() {\n+            @Override\n+            public Analyzer create(Version version) {\n+                return new PersianAnalyzer(version);\n+            }\n+        }));\n+        analyzerProviderFactories.put(\"portuguese\", new PreBuiltAnalyzerProviderFactory(\"portuguese\", AnalyzerScope.INDICES, new PreBuiltAnalyzerProviderFactory.AnalyzerFactory() {\n+            @Override\n+            public Analyzer create(Version version) {\n+                return new PortugueseAnalyzer(version);\n+            }\n+        }));\n+        analyzerProviderFactories.put(\"romanian\", new PreBuiltAnalyzerProviderFactory(\"romanian\", AnalyzerScope.INDICES, new PreBuiltAnalyzerProviderFactory.AnalyzerFactory() {\n+            @Override\n+            public Analyzer create(Version version) {\n+                return new RomanianAnalyzer(version);\n+            }\n+        }));\n+        analyzerProviderFactories.put(\"russian\", new PreBuiltAnalyzerProviderFactory(\"russian\", AnalyzerScope.INDICES, new PreBuiltAnalyzerProviderFactory.AnalyzerFactory() {\n+            @Override\n+            public Analyzer create(Version version) {\n+                return new RussianAnalyzer(version);\n+            }\n+        }));\n+        analyzerProviderFactories.put(\"spanish\", new PreBuiltAnalyzerProviderFactory(\"spanish\", AnalyzerScope.INDICES, new PreBuiltAnalyzerProviderFactory.AnalyzerFactory() {\n+            @Override\n+            public Analyzer create(Version version) {\n+                return new SpanishAnalyzer(version);\n+            }\n+        }));\n+        analyzerProviderFactories.put(\"swedish\", new PreBuiltAnalyzerProviderFactory(\"swedish\", AnalyzerScope.INDICES, new PreBuiltAnalyzerProviderFactory.AnalyzerFactory() {\n+            @Override\n+            public Analyzer create(Version version) {\n+                return new SwedishAnalyzer(version);\n+            }\n+        }));\n+        analyzerProviderFactories.put(\"turkish\", new PreBuiltAnalyzerProviderFactory(\"turkish\", AnalyzerScope.INDICES, new PreBuiltAnalyzerProviderFactory.AnalyzerFactory() {\n+            @Override\n+            public Analyzer create(Version version) {\n+                return new TurkishAnalyzer(version);\n+            }\n+        }));\n+        analyzerProviderFactories.put(\"thai\", new PreBuiltAnalyzerProviderFactory(\"thai\", AnalyzerScope.INDICES, new PreBuiltAnalyzerProviderFactory.AnalyzerFactory() {\n+            @Override\n+            public Analyzer create(Version version) {\n+                return new ThaiAnalyzer(version);\n+            }\n+        }));\n \n         // Base Tokenizers\n         tokenizerFactories.put(\"standard\", new PreBuiltTokenizerFactoryFactory(new TokenizerFactory() {\n@@ -785,7 +991,7 @@ public class IndicesAnalysisService extends AbstractComponent {\n     public void close() {\n         for (PreBuiltAnalyzerProviderFactory analyzerProviderFactory : analyzerProviderFactories.values()) {\n             try {\n-                analyzerProviderFactory.analyzer().close();\n+                analyzerProviderFactory.close();\n             } catch (Exception e) {\n                 // ignore\n             }",
  "logs_path": "codex/gpt-5.1-codex/b8978668/elastic_elasticsearch_pr3966/logs.jsonl",
  "errors": [],
  "edit_run_id": "fd5b3480",
  "test_label": "v1-agent-comparison"
}