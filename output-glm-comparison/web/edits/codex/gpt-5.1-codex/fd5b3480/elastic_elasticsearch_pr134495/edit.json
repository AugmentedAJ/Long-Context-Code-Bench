{
  "repo_url": "https://github.com/elastic/elasticsearch.git",
  "pr_number": 134495,
  "base_commit": "36181aa6f726d08d5c9c779f2d6e99b732de0ccc",
  "runner": "codex",
  "model": "gpt-5.1-codex",
  "timeout_s": 10800,
  "status": "success",
  "elapsed_ms": 500190,
  "patch_unified": "diff --git a/x-pack/plugin/esql/src/internalClusterTest/java/org/elasticsearch/xpack/esql/action/AbstractCrossClusterTestCase.java b/x-pack/plugin/esql/src/internalClusterTest/java/org/elasticsearch/xpack/esql/action/AbstractCrossClusterTestCase.java\nindex a724483e..0f432a5c 100644\n--- a/x-pack/plugin/esql/src/internalClusterTest/java/org/elasticsearch/xpack/esql/action/AbstractCrossClusterTestCase.java\n+++ b/x-pack/plugin/esql/src/internalClusterTest/java/org/elasticsearch/xpack/esql/action/AbstractCrossClusterTestCase.java\n@@ -20,6 +20,7 @@ import org.elasticsearch.common.settings.Settings;\n import org.elasticsearch.common.util.concurrent.EsRejectedExecutionException;\n import org.elasticsearch.compute.operator.DriverTaskRunner;\n import org.elasticsearch.compute.operator.exchange.ExchangeService;\n+import org.elasticsearch.core.Nullable;\n import org.elasticsearch.core.TimeValue;\n import org.elasticsearch.plugins.Plugin;\n import org.elasticsearch.tasks.TaskInfo;\n@@ -48,6 +49,7 @@ import static org.elasticsearch.test.hamcrest.ElasticsearchAssertions.assertAcke\n import static org.hamcrest.Matchers.aMapWithSize;\n import static org.hamcrest.Matchers.equalTo;\n import static org.hamcrest.Matchers.greaterThanOrEqualTo;\n+import static org.hamcrest.Matchers.lessThanOrEqualTo;\n \n public abstract class AbstractCrossClusterTestCase extends AbstractMultiClustersTestCase {\n     protected static final String REMOTE_CLUSTER_1 = \"cluster-a\";\n@@ -141,6 +143,59 @@ public abstract class AbstractCrossClusterTestCase extends AbstractMultiClusters\n         assertThat(cluster.getFailures().size(), equalTo(0));\n     }\n \n+    protected long assertExecutionInfoBasics(EsqlExecutionInfo executionInfo, boolean isCrossCluster, @Nullable Set<String> expectedAliases) {\n+        assertNotNull(executionInfo);\n+        assertThat(executionInfo.isCrossClusterSearch(), equalTo(isCrossCluster));\n+        long overallTookMillis = executionInfo.overallTook().millis();\n+        assertThat(overallTookMillis, greaterThanOrEqualTo(0L));\n+        if (expectedAliases != null) {\n+            assertThat(executionInfo.clusterAliases(), equalTo(expectedAliases));\n+        }\n+        return overallTookMillis;\n+    }\n+\n+    protected void assertSuccessfulCluster(\n+        EsqlExecutionInfo executionInfo,\n+        String clusterAlias,\n+        String indexExpression,\n+        int numShards,\n+        @Nullable Long overallTookMillis\n+    ) {\n+        assertSuccessfulCluster(executionInfo.getCluster(clusterAlias), indexExpression, numShards, overallTookMillis);\n+    }\n+\n+    protected void assertSuccessfulCluster(\n+        EsqlExecutionInfo.Cluster cluster,\n+        String indexExpression,\n+        int numShards,\n+        @Nullable Long overallTookMillis\n+    ) {\n+        assertThat(cluster.getIndexExpression(), equalTo(indexExpression));\n+        assertClusterInfoSuccess(cluster, numShards);\n+        assertThat(cluster.getTook().millis(), greaterThanOrEqualTo(0L));\n+        if (overallTookMillis != null) {\n+            assertThat(cluster.getTook().millis(), lessThanOrEqualTo(overallTookMillis));\n+        }\n+    }\n+\n+    protected void assertSkippedCluster(EsqlExecutionInfo executionInfo, String clusterAlias, String indexExpression, long overallTookMillis) {\n+        EsqlExecutionInfo.Cluster cluster = executionInfo.getCluster(clusterAlias);\n+        assertThat(cluster.getIndexExpression(), equalTo(indexExpression));\n+        assertThat(cluster.getStatus(), equalTo(EsqlExecutionInfo.Cluster.Status.SKIPPED));\n+        assertThat(cluster.getTotalShards(), equalTo(0));\n+        assertThat(cluster.getSuccessfulShards(), equalTo(0));\n+        assertThat(cluster.getSkippedShards(), equalTo(0));\n+        assertThat(cluster.getFailedShards(), equalTo(0));\n+        assertThat(cluster.getTook().millis(), greaterThanOrEqualTo(0L));\n+        assertThat(cluster.getTook().millis(), lessThanOrEqualTo(overallTookMillis));\n+    }\n+\n+    protected void assertPartialCluster(EsqlExecutionInfo executionInfo, String clusterAlias, String indexExpression) {\n+        EsqlExecutionInfo.Cluster cluster = executionInfo.getCluster(clusterAlias);\n+        assertThat(cluster.getIndexExpression(), equalTo(indexExpression));\n+        assertThat(cluster.getStatus(), equalTo(EsqlExecutionInfo.Cluster.Status.PARTIAL));\n+    }\n+\n     protected static void assertClusterMetadataInResponse(EsqlQueryResponse resp, boolean responseExpectMeta, int numClusters) {\n         try {\n             final Map<String, Object> esqlResponseAsMap = XContentTestUtils.convertToMap(resp);\ndiff --git a/x-pack/plugin/esql/src/internalClusterTest/java/org/elasticsearch/xpack/esql/action/CrossClusterAsyncQueryIT.java b/x-pack/plugin/esql/src/internalClusterTest/java/org/elasticsearch/xpack/esql/action/CrossClusterAsyncQueryIT.java\nindex cb404c0c..2f5de815 100644\n--- a/x-pack/plugin/esql/src/internalClusterTest/java/org/elasticsearch/xpack/esql/action/CrossClusterAsyncQueryIT.java\n+++ b/x-pack/plugin/esql/src/internalClusterTest/java/org/elasticsearch/xpack/esql/action/CrossClusterAsyncQueryIT.java\n@@ -158,28 +158,17 @@ public class CrossClusterAsyncQueryIT extends AbstractCrossClusterTestCase {\n                 assertThat(resp.columns(), hasItem(new ColumnInfoImpl(\"v\", \"long\", null)));\n                 assertThat(resp.values().hasNext(), is(false));  // values should be empty list\n \n-                assertNotNull(executionInfo);\n-                assertThat(executionInfo.isCrossClusterSearch(), is(true));\n-                long overallTookMillis = executionInfo.overallTook().millis();\n-                assertThat(overallTookMillis, greaterThanOrEqualTo(0L));\n+                long overallTookMillis = assertExecutionInfoBasics(\n+                    executionInfo,\n+                    true,\n+                    Set.of(LOCAL_CLUSTER, REMOTE_CLUSTER_1, REMOTE_CLUSTER_2)\n+                );\n                 assertThat(executionInfo.includeCCSMetadata(), equalTo(responseExpectMeta));\n-                assertThat(executionInfo.clusterAliases(), equalTo(Set.of(LOCAL_CLUSTER, REMOTE_CLUSTER_1, REMOTE_CLUSTER_2)));\n                 assertThat(executionInfo.isPartial(), equalTo(false));\n \n-                EsqlExecutionInfo.Cluster remoteCluster = executionInfo.getCluster(REMOTE_CLUSTER_1);\n-                assertThat(remoteCluster.getTook().millis(), lessThanOrEqualTo(overallTookMillis));\n-                assertThat(remoteCluster.getIndexExpression(), equalTo(\"logs*\"));\n-                assertClusterInfoSuccess(remoteCluster, 0);\n-\n-                EsqlExecutionInfo.Cluster remote2Cluster = executionInfo.getCluster(REMOTE_CLUSTER_2);\n-                assertClusterInfoSuccess(remote2Cluster, 0);\n-                assertThat(remote2Cluster.getIndexExpression(), equalTo(\"logs*\"));\n-                assertThat(remote2Cluster.getTook().millis(), lessThanOrEqualTo(overallTookMillis));\n-\n-                EsqlExecutionInfo.Cluster localCluster = executionInfo.getCluster(LOCAL_CLUSTER);\n-                assertClusterInfoSuccess(localCluster, 0);\n-                assertThat(localCluster.getIndexExpression(), equalTo(\"logs*\"));\n-                assertThat(localCluster.getTook().millis(), lessThanOrEqualTo(overallTookMillis));\n+                assertSuccessfulCluster(executionInfo, REMOTE_CLUSTER_1, \"logs*\", 0, overallTookMillis);\n+                assertSuccessfulCluster(executionInfo, REMOTE_CLUSTER_2, \"logs*\", 0, overallTookMillis);\n+                assertSuccessfulCluster(executionInfo, LOCAL_CLUSTER, \"logs*\", 0, overallTookMillis);\n \n                 assertClusterMetadataInResponse(resp, responseExpectMeta, 3);\n             }\ndiff --git a/x-pack/plugin/esql/src/internalClusterTest/java/org/elasticsearch/xpack/esql/action/CrossClusterAsyncQueryStopIT.java b/x-pack/plugin/esql/src/internalClusterTest/java/org/elasticsearch/xpack/esql/action/CrossClusterAsyncQueryStopIT.java\nindex a866b604..f2e5f283 100644\n--- a/x-pack/plugin/esql/src/internalClusterTest/java/org/elasticsearch/xpack/esql/action/CrossClusterAsyncQueryStopIT.java\n+++ b/x-pack/plugin/esql/src/internalClusterTest/java/org/elasticsearch/xpack/esql/action/CrossClusterAsyncQueryStopIT.java\n@@ -100,24 +100,16 @@ public class CrossClusterAsyncQueryStopIT extends AbstractCrossClusterTestCase {\n                 assertThat(row.next(), equalTo(330L));\n \n                 EsqlExecutionInfo executionInfo = asyncResponse.getExecutionInfo();\n-                assertNotNull(executionInfo);\n-                assertThat(executionInfo.isCrossClusterSearch(), is(true));\n-                long overallTookMillis = executionInfo.overallTook().millis();\n-                assertThat(overallTookMillis, greaterThanOrEqualTo(0L));\n-                assertThat(executionInfo.clusterAliases(), equalTo(Set.of(LOCAL_CLUSTER, REMOTE_CLUSTER_1, REMOTE_CLUSTER_2)));\n+                long overallTookMillis = assertExecutionInfoBasics(\n+                    executionInfo,\n+                    true,\n+                    Set.of(LOCAL_CLUSTER, REMOTE_CLUSTER_1, REMOTE_CLUSTER_2)\n+                );\n                 assertThat(executionInfo.isPartial(), equalTo(true));\n \n-                EsqlExecutionInfo.Cluster remoteCluster = executionInfo.getCluster(REMOTE_CLUSTER_1);\n-                assertThat(remoteCluster.getIndexExpression(), equalTo(\"logs-*\"));\n-                assertClusterInfoSuccess(remoteCluster, remote1NumShards);\n-\n-                EsqlExecutionInfo.Cluster remote2Cluster = executionInfo.getCluster(REMOTE_CLUSTER_2);\n-                assertThat(remote2Cluster.getIndexExpression(), equalTo(\"blocking\"));\n-                assertThat(remote2Cluster.getStatus(), equalTo(EsqlExecutionInfo.Cluster.Status.PARTIAL));\n-\n-                EsqlExecutionInfo.Cluster localCluster = executionInfo.getCluster(LOCAL_CLUSTER);\n-                assertThat(localCluster.getIndexExpression(), equalTo(\"logs-*\"));\n-                assertClusterInfoSuccess(localCluster, localNumShards);\n+                assertSuccessfulCluster(executionInfo, REMOTE_CLUSTER_1, \"logs-*\", remote1NumShards, overallTookMillis);\n+                assertPartialCluster(executionInfo, REMOTE_CLUSTER_2, \"blocking\");\n+                assertSuccessfulCluster(executionInfo, LOCAL_CLUSTER, \"logs-*\", localNumShards, overallTookMillis);\n \n                 assertClusterMetadataInResponse(asyncResponse, responseExpectMeta, 3);\n             }\n@@ -198,24 +190,16 @@ public class CrossClusterAsyncQueryStopIT extends AbstractCrossClusterTestCase {\n                 assertThat(row.next(), equalTo(570L));\n \n                 EsqlExecutionInfo executionInfo = asyncResponse.getExecutionInfo();\n-                assertNotNull(executionInfo);\n-                assertThat(executionInfo.isCrossClusterSearch(), is(true));\n-                long overallTookMillis = executionInfo.overallTook().millis();\n-                assertThat(overallTookMillis, greaterThanOrEqualTo(0L));\n-                assertThat(executionInfo.clusterAliases(), equalTo(Set.of(LOCAL_CLUSTER, REMOTE_CLUSTER_1, REMOTE_CLUSTER_2)));\n+                long overallTookMillis = assertExecutionInfoBasics(\n+                    executionInfo,\n+                    true,\n+                    Set.of(LOCAL_CLUSTER, REMOTE_CLUSTER_1, REMOTE_CLUSTER_2)\n+                );\n                 assertThat(executionInfo.isPartial(), equalTo(true));\n \n-                EsqlExecutionInfo.Cluster remoteCluster = executionInfo.getCluster(REMOTE_CLUSTER_1);\n-                assertThat(remoteCluster.getIndexExpression(), equalTo(\"logs-*\"));\n-                assertClusterInfoSuccess(remoteCluster, remote1NumShards);\n-\n-                EsqlExecutionInfo.Cluster remote2Cluster = executionInfo.getCluster(REMOTE_CLUSTER_2);\n-                assertThat(remote2Cluster.getIndexExpression(), equalTo(\"logs-*\"));\n-                assertClusterInfoSuccess(remote2Cluster, remote2NumShards);\n-\n-                EsqlExecutionInfo.Cluster localCluster = executionInfo.getCluster(LOCAL_CLUSTER);\n-                assertThat(localCluster.getIndexExpression(), equalTo(\"blocking\"));\n-                assertThat(localCluster.getStatus(), equalTo(EsqlExecutionInfo.Cluster.Status.PARTIAL));\n+                assertSuccessfulCluster(executionInfo, REMOTE_CLUSTER_1, \"logs-*\", remote1NumShards, overallTookMillis);\n+                assertSuccessfulCluster(executionInfo, REMOTE_CLUSTER_2, \"logs-*\", remote2NumShards, overallTookMillis);\n+                assertPartialCluster(executionInfo, LOCAL_CLUSTER, \"blocking\");\n \n                 assertClusterMetadataInResponse(asyncResponse, responseExpectMeta, 3);\n             }\ndiff --git a/x-pack/plugin/esql/src/internalClusterTest/java/org/elasticsearch/xpack/esql/action/CrossClusterQueryIT.java b/x-pack/plugin/esql/src/internalClusterTest/java/org/elasticsearch/xpack/esql/action/CrossClusterQueryIT.java\nindex b4a5c82f..229f66f6 100644\n--- a/x-pack/plugin/esql/src/internalClusterTest/java/org/elasticsearch/xpack/esql/action/CrossClusterQueryIT.java\n+++ b/x-pack/plugin/esql/src/internalClusterTest/java/org/elasticsearch/xpack/esql/action/CrossClusterQueryIT.java\n@@ -77,33 +77,11 @@ public class CrossClusterQueryIT extends AbstractCrossClusterTestCase {\n             assertThat(values.get(0), equalTo(List.of(330L)));\n \n             EsqlExecutionInfo executionInfo = resp.getExecutionInfo();\n-            assertNotNull(executionInfo);\n-            assertThat(executionInfo.isCrossClusterSearch(), is(true));\n-            long overallTookMillis = executionInfo.overallTook().millis();\n-            assertThat(overallTookMillis, greaterThanOrEqualTo(0L));\n+            long overallTookMillis = assertExecutionInfoBasics(executionInfo, true, Set.of(REMOTE_CLUSTER_1, LOCAL_CLUSTER));\n             assertThat(executionInfo.includeCCSMetadata(), equalTo(responseExpectMeta));\n \n-            assertThat(executionInfo.clusterAliases(), equalTo(Set.of(REMOTE_CLUSTER_1, LOCAL_CLUSTER)));\n-\n-            EsqlExecutionInfo.Cluster remoteCluster = executionInfo.getCluster(REMOTE_CLUSTER_1);\n-            assertThat(remoteCluster.getIndexExpression(), equalTo(\"logs-*\"));\n-            assertThat(remoteCluster.getStatus(), equalTo(EsqlExecutionInfo.Cluster.Status.SUCCESSFUL));\n-            assertThat(remoteCluster.getTook().millis(), greaterThanOrEqualTo(0L));\n-            assertThat(remoteCluster.getTook().millis(), lessThanOrEqualTo(overallTookMillis));\n-            assertThat(remoteCluster.getTotalShards(), equalTo(remoteNumShards));\n-            assertThat(remoteCluster.getSuccessfulShards(), equalTo(remoteNumShards));\n-            assertThat(remoteCluster.getSkippedShards(), equalTo(0));\n-            assertThat(remoteCluster.getFailedShards(), equalTo(0));\n-\n-            EsqlExecutionInfo.Cluster localCluster = executionInfo.getCluster(LOCAL_CLUSTER);\n-            assertThat(localCluster.getIndexExpression(), equalTo(\"logs-*\"));\n-            assertThat(localCluster.getStatus(), equalTo(EsqlExecutionInfo.Cluster.Status.SUCCESSFUL));\n-            assertThat(localCluster.getTook().millis(), greaterThanOrEqualTo(0L));\n-            assertThat(localCluster.getTook().millis(), lessThanOrEqualTo(overallTookMillis));\n-            assertThat(localCluster.getTotalShards(), equalTo(localNumShards));\n-            assertThat(localCluster.getSuccessfulShards(), equalTo(localNumShards));\n-            assertThat(localCluster.getSkippedShards(), equalTo(0));\n-            assertThat(localCluster.getFailedShards(), equalTo(0));\n+            assertSuccessfulCluster(executionInfo, REMOTE_CLUSTER_1, \"logs-*\", remoteNumShards, overallTookMillis);\n+            assertSuccessfulCluster(executionInfo, LOCAL_CLUSTER, \"logs-*\", localNumShards, overallTookMillis);\n \n             // ensure that the _clusters metadata is present only if requested\n             assertClusterMetadataInResponse(resp, responseExpectMeta);\n@@ -116,33 +94,11 @@ public class CrossClusterQueryIT extends AbstractCrossClusterTestCase {\n             assertThat(values.get(1), equalTo(List.of(\"remote\")));\n \n             EsqlExecutionInfo executionInfo = resp.getExecutionInfo();\n-            assertNotNull(executionInfo);\n-            assertThat(executionInfo.isCrossClusterSearch(), is(true));\n-            long overallTookMillis = executionInfo.overallTook().millis();\n-            assertThat(overallTookMillis, greaterThanOrEqualTo(0L));\n+            long overallTookMillis = assertExecutionInfoBasics(executionInfo, true, Set.of(REMOTE_CLUSTER_1, LOCAL_CLUSTER));\n             assertThat(executionInfo.includeCCSMetadata(), equalTo(responseExpectMeta));\n \n-            assertThat(executionInfo.clusterAliases(), equalTo(Set.of(REMOTE_CLUSTER_1, LOCAL_CLUSTER)));\n-\n-            EsqlExecutionInfo.Cluster remoteCluster = executionInfo.getCluster(REMOTE_CLUSTER_1);\n-            assertThat(remoteCluster.getIndexExpression(), equalTo(\"logs-*\"));\n-            assertThat(remoteCluster.getStatus(), equalTo(EsqlExecutionInfo.Cluster.Status.SUCCESSFUL));\n-            assertThat(remoteCluster.getTook().millis(), greaterThanOrEqualTo(0L));\n-            assertThat(remoteCluster.getTook().millis(), lessThanOrEqualTo(overallTookMillis));\n-            assertThat(remoteCluster.getTotalShards(), equalTo(remoteNumShards));\n-            assertThat(remoteCluster.getSuccessfulShards(), equalTo(remoteNumShards));\n-            assertThat(remoteCluster.getSkippedShards(), equalTo(0));\n-            assertThat(remoteCluster.getFailedShards(), equalTo(0));\n-\n-            EsqlExecutionInfo.Cluster localCluster = executionInfo.getCluster(LOCAL_CLUSTER);\n-            assertThat(localCluster.getIndexExpression(), equalTo(\"logs-*\"));\n-            assertThat(localCluster.getStatus(), equalTo(EsqlExecutionInfo.Cluster.Status.SUCCESSFUL));\n-            assertThat(localCluster.getTook().millis(), greaterThanOrEqualTo(0L));\n-            assertThat(localCluster.getTook().millis(), lessThanOrEqualTo(overallTookMillis));\n-            assertThat(localCluster.getTotalShards(), equalTo(localNumShards));\n-            assertThat(localCluster.getSuccessfulShards(), equalTo(localNumShards));\n-            assertThat(localCluster.getSkippedShards(), equalTo(0));\n-            assertThat(localCluster.getFailedShards(), equalTo(0));\n+            assertSuccessfulCluster(executionInfo, REMOTE_CLUSTER_1, \"logs-*\", remoteNumShards, overallTookMillis);\n+            assertSuccessfulCluster(executionInfo, LOCAL_CLUSTER, \"logs-*\", localNumShards, overallTookMillis);\n \n             // ensure that the _clusters metadata is present only if requested\n             assertClusterMetadataInResponse(resp, responseExpectMeta);\n@@ -522,12 +478,8 @@ public class CrossClusterQueryIT extends AbstractCrossClusterTestCase {\n             assertThat(values, hasSize(1));\n             assertThat(values.get(0), equalTo(List.of(45L)));\n \n-            assertNotNull(executionInfo);\n-            assertThat(executionInfo.clusterAliases(), equalTo(Set.of(LOCAL_CLUSTER)));\n-            assertThat(executionInfo.isCrossClusterSearch(), is(false));\n+            assertExecutionInfoBasics(executionInfo, false, Set.of(LOCAL_CLUSTER));\n             assertThat(executionInfo.includeCCSMetadata(), equalTo(responseExpectMeta));\n-            // since this not a CCS, only the overall took time in the EsqlExecutionInfo matters\n-            assertThat(executionInfo.overallTook().millis(), greaterThanOrEqualTo(0L));\n         }\n \n         // skip_un must be true for the next test or it will fail on \"cluster-a:no_such_index*\" with a\n@@ -546,31 +498,12 @@ public class CrossClusterQueryIT extends AbstractCrossClusterTestCase {\n             assertThat(values, hasSize(1));\n             assertThat(values.get(0), equalTo(List.of(45L)));\n \n-            assertNotNull(executionInfo);\n-            assertThat(executionInfo.isCrossClusterSearch(), is(true));\n-            assertThat(executionInfo.overallTook().millis(), greaterThanOrEqualTo(0L));\n+            long overallTookMillis = assertExecutionInfoBasics(executionInfo, true, Set.of(REMOTE_CLUSTER_1, LOCAL_CLUSTER));\n             assertThat(executionInfo.includeCCSMetadata(), equalTo(responseExpectMeta));\n             assertThat(executionInfo.isPartial(), equalTo(false));\n \n-            assertThat(executionInfo.clusterAliases(), equalTo(Set.of(REMOTE_CLUSTER_1, LOCAL_CLUSTER)));\n-\n-            EsqlExecutionInfo.Cluster remoteCluster = executionInfo.getCluster(REMOTE_CLUSTER_1);\n-            assertThat(remoteCluster.getIndexExpression(), equalTo(\"no_such_index*\"));\n-            assertThat(remoteCluster.getStatus(), equalTo(EsqlExecutionInfo.Cluster.Status.SUCCESSFUL));\n-            assertThat(remoteCluster.getTook().millis(), greaterThanOrEqualTo(0L));\n-            assertThat(remoteCluster.getTotalShards(), equalTo(0));\n-            assertThat(remoteCluster.getSuccessfulShards(), equalTo(0));\n-            assertThat(remoteCluster.getSkippedShards(), equalTo(0));\n-            assertThat(remoteCluster.getFailedShards(), equalTo(0));\n-\n-            EsqlExecutionInfo.Cluster localCluster = executionInfo.getCluster(LOCAL_CLUSTER);\n-            assertThat(localCluster.getIndexExpression(), equalTo(\"logs-*,no_such_index*\"));\n-            assertThat(localCluster.getStatus(), equalTo(EsqlExecutionInfo.Cluster.Status.SUCCESSFUL));\n-            assertThat(localCluster.getTook().millis(), greaterThanOrEqualTo(0L));\n-            assertThat(localCluster.getTotalShards(), equalTo(localNumShards));\n-            assertThat(localCluster.getSuccessfulShards(), equalTo(localNumShards));\n-            assertThat(localCluster.getSkippedShards(), equalTo(0));\n-            assertThat(localCluster.getFailedShards(), equalTo(0));\n+            assertSuccessfulCluster(executionInfo, REMOTE_CLUSTER_1, \"no_such_index*\", 0, overallTookMillis);\n+            assertSuccessfulCluster(executionInfo, LOCAL_CLUSTER, \"logs-*,no_such_index*\", localNumShards, overallTookMillis);\n         } finally {\n             clearSkipUnavailable();\n         }\n@@ -594,41 +527,18 @@ public class CrossClusterQueryIT extends AbstractCrossClusterTestCase {\n         // Ensure non-cross cluster queries have overall took time\n         try (EsqlQueryResponse resp = runQuery(\"FROM logs* | LIMIT 0\", requestIncludeMeta)) {\n             EsqlExecutionInfo executionInfo = resp.getExecutionInfo();\n-            assertNotNull(executionInfo);\n-            assertThat(executionInfo.isCrossClusterSearch(), is(false));\n-            assertThat(executionInfo.overallTook().millis(), greaterThanOrEqualTo(0L));\n+            assertExecutionInfoBasics(executionInfo, false, null);\n         }\n \n         // ensure cross-cluster searches have overall took time and correct per-cluster details in EsqlExecutionInfo\n         try (EsqlQueryResponse resp = runQuery(\"FROM logs*,cluster-a:* | LIMIT 0\", requestIncludeMeta)) {\n             EsqlExecutionInfo executionInfo = resp.getExecutionInfo();\n-            assertNotNull(executionInfo);\n-            assertThat(executionInfo.isCrossClusterSearch(), is(true));\n-            long overallTookMillis = executionInfo.overallTook().millis();\n-            assertThat(overallTookMillis, greaterThanOrEqualTo(0L));\n+            long overallTookMillis = assertExecutionInfoBasics(executionInfo, true, Set.of(REMOTE_CLUSTER_1, LOCAL_CLUSTER));\n             assertThat(executionInfo.includeCCSMetadata(), equalTo(responseExpectMeta));\n             assertThat(executionInfo.isPartial(), equalTo(false));\n-            assertThat(executionInfo.clusterAliases(), equalTo(Set.of(REMOTE_CLUSTER_1, LOCAL_CLUSTER)));\n \n-            EsqlExecutionInfo.Cluster remoteCluster = executionInfo.getCluster(REMOTE_CLUSTER_1);\n-            assertThat(remoteCluster.getIndexExpression(), equalTo(\"*\"));\n-            assertThat(remoteCluster.getStatus(), equalTo(EsqlExecutionInfo.Cluster.Status.SUCCESSFUL));\n-            assertThat(remoteCluster.getTook().millis(), greaterThanOrEqualTo(0L));\n-            assertThat(remoteCluster.getTook().millis(), lessThanOrEqualTo(overallTookMillis));\n-            assertThat(remoteCluster.getTotalShards(), equalTo(0));\n-            assertThat(remoteCluster.getSuccessfulShards(), equalTo(0));\n-            assertThat(remoteCluster.getSkippedShards(), equalTo(0));\n-            assertThat(remoteCluster.getFailedShards(), equalTo(0));\n-\n-            EsqlExecutionInfo.Cluster localCluster = executionInfo.getCluster(LOCAL_CLUSTER);\n-            assertThat(localCluster.getIndexExpression(), equalTo(\"logs*\"));\n-            assertThat(localCluster.getStatus(), equalTo(EsqlExecutionInfo.Cluster.Status.SUCCESSFUL));\n-            assertThat(localCluster.getTook().millis(), greaterThanOrEqualTo(0L));\n-            assertThat(localCluster.getTook().millis(), lessThanOrEqualTo(overallTookMillis));\n-            assertThat(remoteCluster.getTotalShards(), equalTo(0));\n-            assertThat(remoteCluster.getSuccessfulShards(), equalTo(0));\n-            assertThat(remoteCluster.getSkippedShards(), equalTo(0));\n-            assertThat(remoteCluster.getFailedShards(), equalTo(0));\n+            assertSuccessfulCluster(executionInfo, REMOTE_CLUSTER_1, \"*\", 0, overallTookMillis);\n+            assertSuccessfulCluster(executionInfo, LOCAL_CLUSTER, \"logs*\", 0, overallTookMillis);\n         }\n     }\n \ndiff --git a/x-pack/plugin/esql/src/internalClusterTest/java/org/elasticsearch/xpack/esql/action/CrossClusterQueryUnavailableRemotesIT.java b/x-pack/plugin/esql/src/internalClusterTest/java/org/elasticsearch/xpack/esql/action/CrossClusterQueryUnavailableRemotesIT.java\nindex 667ac234..a0edae39 100644\n--- a/x-pack/plugin/esql/src/internalClusterTest/java/org/elasticsearch/xpack/esql/action/CrossClusterQueryUnavailableRemotesIT.java\n+++ b/x-pack/plugin/esql/src/internalClusterTest/java/org/elasticsearch/xpack/esql/action/CrossClusterQueryUnavailableRemotesIT.java\n@@ -52,44 +52,17 @@ public class CrossClusterQueryUnavailableRemotesIT extends AbstractCrossClusterT\n                 assertThat(values.get(0), equalTo(List.of(330L)));\n \n                 EsqlExecutionInfo executionInfo = resp.getExecutionInfo();\n-                assertNotNull(executionInfo);\n-                assertThat(executionInfo.isCrossClusterSearch(), is(true));\n-                long overallTookMillis = executionInfo.overallTook().millis();\n-                assertThat(overallTookMillis, greaterThanOrEqualTo(0L));\n+                long overallTookMillis = assertExecutionInfoBasics(\n+                    executionInfo,\n+                    true,\n+                    Set.of(REMOTE_CLUSTER_1, REMOTE_CLUSTER_2, LOCAL_CLUSTER)\n+                );\n                 assertThat(executionInfo.includeCCSMetadata(), equalTo(responseExpectMeta));\n                 assertThat(executionInfo.isPartial(), equalTo(true));\n \n-                assertThat(executionInfo.clusterAliases(), equalTo(Set.of(REMOTE_CLUSTER_1, REMOTE_CLUSTER_2, LOCAL_CLUSTER)));\n-\n-                EsqlExecutionInfo.Cluster remote1Cluster = executionInfo.getCluster(REMOTE_CLUSTER_1);\n-                assertThat(remote1Cluster.getIndexExpression(), equalTo(\"logs-*\"));\n-                assertThat(remote1Cluster.getStatus(), equalTo(EsqlExecutionInfo.Cluster.Status.SKIPPED));\n-                assertThat(remote1Cluster.getTook().millis(), greaterThanOrEqualTo(0L));\n-                assertThat(remote1Cluster.getTook().millis(), lessThanOrEqualTo(overallTookMillis));\n-                assertThat(remote1Cluster.getTotalShards(), equalTo(0));\n-                assertThat(remote1Cluster.getSuccessfulShards(), equalTo(0));\n-                assertThat(remote1Cluster.getSkippedShards(), equalTo(0));\n-                assertThat(remote1Cluster.getFailedShards(), equalTo(0));\n-\n-                EsqlExecutionInfo.Cluster remote2Cluster = executionInfo.getCluster(REMOTE_CLUSTER_2);\n-                assertThat(remote2Cluster.getIndexExpression(), equalTo(\"logs-*\"));\n-                assertThat(remote2Cluster.getStatus(), equalTo(EsqlExecutionInfo.Cluster.Status.SUCCESSFUL));\n-                assertThat(remote2Cluster.getTook().millis(), greaterThanOrEqualTo(0L));\n-                assertThat(remote2Cluster.getTook().millis(), lessThanOrEqualTo(overallTookMillis));\n-                assertThat(remote2Cluster.getTotalShards(), equalTo(remote2NumShards));\n-                assertThat(remote2Cluster.getSuccessfulShards(), equalTo(remote2NumShards));\n-                assertThat(remote2Cluster.getSkippedShards(), equalTo(0));\n-                assertThat(remote2Cluster.getFailedShards(), equalTo(0));\n-\n-                EsqlExecutionInfo.Cluster localCluster = executionInfo.getCluster(LOCAL_CLUSTER);\n-                assertThat(localCluster.getIndexExpression(), equalTo(\"logs-*\"));\n-                assertThat(localCluster.getStatus(), equalTo(EsqlExecutionInfo.Cluster.Status.SUCCESSFUL));\n-                assertThat(localCluster.getTook().millis(), greaterThanOrEqualTo(0L));\n-                assertThat(localCluster.getTook().millis(), lessThanOrEqualTo(overallTookMillis));\n-                assertThat(localCluster.getTotalShards(), equalTo(localNumShards));\n-                assertThat(localCluster.getSuccessfulShards(), equalTo(localNumShards));\n-                assertThat(localCluster.getSkippedShards(), equalTo(0));\n-                assertThat(localCluster.getFailedShards(), equalTo(0));\n+                assertSkippedCluster(executionInfo, REMOTE_CLUSTER_1, \"logs-*\", overallTookMillis);\n+                assertSuccessfulCluster(executionInfo, REMOTE_CLUSTER_2, \"logs-*\", remote2NumShards, overallTookMillis);\n+                assertSuccessfulCluster(executionInfo, LOCAL_CLUSTER, \"logs-*\", localNumShards, overallTookMillis);\n \n                 // ensure that the _clusters metadata is present only if requested\n                 assertClusterMetadataInResponse(resp, responseExpectMeta, numClusters);\n@@ -105,45 +78,17 @@ public class CrossClusterQueryUnavailableRemotesIT extends AbstractCrossClusterT\n                 assertThat(values, hasSize(0));\n \n                 EsqlExecutionInfo executionInfo = resp.getExecutionInfo();\n-                assertNotNull(executionInfo);\n-                assertThat(executionInfo.isCrossClusterSearch(), is(true));\n-                long overallTookMillis = executionInfo.overallTook().millis();\n-                assertThat(overallTookMillis, greaterThanOrEqualTo(0L));\n+                long overallTookMillis = assertExecutionInfoBasics(\n+                    executionInfo,\n+                    true,\n+                    Set.of(REMOTE_CLUSTER_1, REMOTE_CLUSTER_2, LOCAL_CLUSTER)\n+                );\n                 assertThat(executionInfo.includeCCSMetadata(), equalTo(responseExpectMeta));\n                 assertThat(executionInfo.isPartial(), equalTo(true));\n \n-                assertThat(executionInfo.clusterAliases(), equalTo(Set.of(REMOTE_CLUSTER_1, REMOTE_CLUSTER_2, LOCAL_CLUSTER)));\n-\n-                EsqlExecutionInfo.Cluster remote1Cluster = executionInfo.getCluster(REMOTE_CLUSTER_1);\n-                assertThat(remote1Cluster.getIndexExpression(), equalTo(\"logs-*\"));\n-                assertThat(remote1Cluster.getStatus(), equalTo(EsqlExecutionInfo.Cluster.Status.SKIPPED));\n-                assertThat(remote1Cluster.getTook().millis(), greaterThanOrEqualTo(0L));\n-                assertThat(remote1Cluster.getTook().millis(), lessThanOrEqualTo(overallTookMillis));\n-                assertThat(remote1Cluster.getTotalShards(), equalTo(0));\n-                assertThat(remote1Cluster.getSuccessfulShards(), equalTo(0));\n-                assertThat(remote1Cluster.getSkippedShards(), equalTo(0));\n-                assertThat(remote1Cluster.getFailedShards(), equalTo(0));\n-\n-                EsqlExecutionInfo.Cluster remote2Cluster = executionInfo.getCluster(REMOTE_CLUSTER_2);\n-                assertThat(remote2Cluster.getIndexExpression(), equalTo(\"nomatch*\"));\n-                assertThat(remote2Cluster.getStatus(), equalTo(EsqlExecutionInfo.Cluster.Status.SKIPPED));\n-                assertThat(remote2Cluster.getTook().millis(), greaterThanOrEqualTo(0L));\n-                assertThat(remote2Cluster.getTook().millis(), lessThanOrEqualTo(overallTookMillis));\n-                assertThat(remote2Cluster.getTotalShards(), equalTo(0));\n-                assertThat(remote2Cluster.getSuccessfulShards(), equalTo(0));\n-                assertThat(remote2Cluster.getSkippedShards(), equalTo(0));\n-                assertThat(remote2Cluster.getFailedShards(), equalTo(0));\n-\n-                EsqlExecutionInfo.Cluster localCluster = executionInfo.getCluster(LOCAL_CLUSTER);\n-                assertThat(localCluster.getIndexExpression(), equalTo(\"nomatch*\"));\n-                // local cluster should never be marked as SKIPPED\n-                assertThat(localCluster.getStatus(), equalTo(EsqlExecutionInfo.Cluster.Status.SUCCESSFUL));\n-                assertThat(localCluster.getTook().millis(), greaterThanOrEqualTo(0L));\n-                assertThat(localCluster.getTook().millis(), lessThanOrEqualTo(overallTookMillis));\n-                assertThat(localCluster.getTotalShards(), equalTo(0));\n-                assertThat(localCluster.getSuccessfulShards(), equalTo(0));\n-                assertThat(localCluster.getSkippedShards(), equalTo(0));\n-                assertThat(localCluster.getFailedShards(), equalTo(0));\n+                assertSkippedCluster(executionInfo, REMOTE_CLUSTER_1, \"logs-*\", overallTookMillis);\n+                assertSkippedCluster(executionInfo, REMOTE_CLUSTER_2, \"nomatch*\", overallTookMillis);\n+                assertSuccessfulCluster(executionInfo, LOCAL_CLUSTER, \"nomatch*\", 0, overallTookMillis);\n \n                 // ensure that the _clusters metadata is present only if requested\n                 assertClusterMetadataInResponse(resp, responseExpectMeta, numClusters);\n@@ -158,44 +103,17 @@ public class CrossClusterQueryUnavailableRemotesIT extends AbstractCrossClusterT\n                 assertThat(values.get(0), equalTo(List.of(45L)));\n \n                 EsqlExecutionInfo executionInfo = resp.getExecutionInfo();\n-                assertNotNull(executionInfo);\n-                assertThat(executionInfo.isCrossClusterSearch(), is(true));\n-                long overallTookMillis = executionInfo.overallTook().millis();\n-                assertThat(overallTookMillis, greaterThanOrEqualTo(0L));\n+                long overallTookMillis = assertExecutionInfoBasics(\n+                    executionInfo,\n+                    true,\n+                    Set.of(REMOTE_CLUSTER_1, REMOTE_CLUSTER_2, LOCAL_CLUSTER)\n+                );\n                 assertThat(executionInfo.includeCCSMetadata(), equalTo(responseExpectMeta));\n                 assertThat(executionInfo.isPartial(), equalTo(true));\n \n-                assertThat(executionInfo.clusterAliases(), equalTo(Set.of(REMOTE_CLUSTER_1, REMOTE_CLUSTER_2, LOCAL_CLUSTER)));\n-\n-                EsqlExecutionInfo.Cluster remote1Cluster = executionInfo.getCluster(REMOTE_CLUSTER_1);\n-                assertThat(remote1Cluster.getIndexExpression(), equalTo(\"logs-*\"));\n-                assertThat(remote1Cluster.getStatus(), equalTo(EsqlExecutionInfo.Cluster.Status.SKIPPED));\n-                assertThat(remote1Cluster.getTook().millis(), greaterThanOrEqualTo(0L));\n-                assertThat(remote1Cluster.getTook().millis(), lessThanOrEqualTo(overallTookMillis));\n-                assertThat(remote1Cluster.getTotalShards(), equalTo(0));\n-                assertThat(remote1Cluster.getSuccessfulShards(), equalTo(0));\n-                assertThat(remote1Cluster.getSkippedShards(), equalTo(0));\n-                assertThat(remote1Cluster.getFailedShards(), equalTo(0));\n-\n-                EsqlExecutionInfo.Cluster remote2Cluster = executionInfo.getCluster(REMOTE_CLUSTER_2);\n-                assertThat(remote2Cluster.getIndexExpression(), equalTo(\"logs-*\"));\n-                assertThat(remote2Cluster.getStatus(), equalTo(EsqlExecutionInfo.Cluster.Status.SKIPPED));\n-                assertThat(remote2Cluster.getTook().millis(), greaterThanOrEqualTo(0L));\n-                assertThat(remote2Cluster.getTook().millis(), lessThanOrEqualTo(overallTookMillis));\n-                assertThat(remote2Cluster.getTotalShards(), equalTo(0));\n-                assertThat(remote2Cluster.getSuccessfulShards(), equalTo(0));\n-                assertThat(remote2Cluster.getSkippedShards(), equalTo(0));\n-                assertThat(remote2Cluster.getFailedShards(), equalTo(0));\n-\n-                EsqlExecutionInfo.Cluster localCluster = executionInfo.getCluster(LOCAL_CLUSTER);\n-                assertThat(localCluster.getIndexExpression(), equalTo(\"logs-*\"));\n-                assertThat(localCluster.getStatus(), equalTo(EsqlExecutionInfo.Cluster.Status.SUCCESSFUL));\n-                assertThat(localCluster.getTook().millis(), greaterThanOrEqualTo(0L));\n-                assertThat(localCluster.getTook().millis(), lessThanOrEqualTo(overallTookMillis));\n-                assertThat(localCluster.getTotalShards(), equalTo(localNumShards));\n-                assertThat(localCluster.getSuccessfulShards(), equalTo(localNumShards));\n-                assertThat(localCluster.getSkippedShards(), equalTo(0));\n-                assertThat(localCluster.getFailedShards(), equalTo(0));\n+                assertSkippedCluster(executionInfo, REMOTE_CLUSTER_1, \"logs-*\", overallTookMillis);\n+                assertSkippedCluster(executionInfo, REMOTE_CLUSTER_2, \"logs-*\", overallTookMillis);\n+                assertSuccessfulCluster(executionInfo, LOCAL_CLUSTER, \"logs-*\", localNumShards, overallTookMillis);\n \n                 // ensure that the _clusters metadata is present only if requested\n                 assertClusterMetadataInResponse(resp, responseExpectMeta, numClusters);",
  "logs_path": "codex/gpt-5.1-codex/b8978668/elastic_elasticsearch_pr134495/logs.jsonl",
  "errors": [],
  "edit_run_id": "fd5b3480",
  "test_label": "v1-agent-comparison"
}