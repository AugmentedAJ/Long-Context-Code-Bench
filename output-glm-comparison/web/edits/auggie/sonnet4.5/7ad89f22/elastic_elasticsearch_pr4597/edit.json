{
  "repo_url": "https://github.com/elastic/elasticsearch.git",
  "pr_number": 4597,
  "base_commit": "2a73cf4f823e113926232864b8c7468f9103f88a",
  "runner": "auggie",
  "model": "sonnet4.5",
  "timeout_s": 1800,
  "status": "success",
  "elapsed_ms": 152631,
  "patch_unified": "diff --git a/src/main/java/org/elasticsearch/common/geo/GeoDistance.java b/src/main/java/org/elasticsearch/common/geo/GeoDistance.java\nindex 6e49621..bf94196 100644\n--- a/src/main/java/org/elasticsearch/common/geo/GeoDistance.java\n+++ b/src/main/java/org/elasticsearch/common/geo/GeoDistance.java\n@@ -74,23 +74,27 @@ public enum GeoDistance {\n         }\n     },\n     /**\n-     * Calculates distance as points on a globe.\n+     * Calculates distance as points on a globe using the Haversine formula.\n+     * The Haversine formula is more accurate than the spherical law of cosines,\n+     * especially for small distances, as it avoids numerical instability.\n      */\n     ARC() {\n         @Override\n         public double calculate(double sourceLatitude, double sourceLongitude, double targetLatitude, double targetLongitude, DistanceUnit unit) {\n-            double longitudeDifference = targetLongitude - sourceLongitude;\n-            double a = Math.toRadians(90D - sourceLatitude);\n-            double c = Math.toRadians(90D - targetLatitude);\n-            double factor = (Math.cos(a) * Math.cos(c)) + (Math.sin(a) * Math.sin(c) * Math.cos(Math.toRadians(longitudeDifference)));\n-\n-            if (factor < -1D) {\n-                return unit.fromMeters(Math.PI * GeoUtils.EARTH_MEAN_RADIUS);\n-            } else if (factor >= 1D) {\n-                return 0;\n-            } else {\n-                return unit.fromMeters(Math.acos(factor) * GeoUtils.EARTH_MEAN_RADIUS);\n-            }\n+            // Convert latitude and longitude differences to radians\n+            double lat1 = Math.toRadians(sourceLatitude);\n+            double lat2 = Math.toRadians(targetLatitude);\n+            double deltaLat = Math.toRadians(targetLatitude - sourceLatitude);\n+            double deltaLon = Math.toRadians(targetLongitude - sourceLongitude);\n+\n+            // Haversine formula\n+            double a = Math.sin(deltaLat / 2) * Math.sin(deltaLat / 2) +\n+                       Math.cos(lat1) * Math.cos(lat2) *\n+                       Math.sin(deltaLon / 2) * Math.sin(deltaLon / 2);\n+\n+            double c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n+\n+            return unit.fromMeters(c * GeoUtils.EARTH_MEAN_RADIUS);\n         }\n \n         @Override",
  "logs_path": "auggie/sonnet4.5/7ad89f22/elastic_elasticsearch_pr4597/logs.jsonl",
  "errors": [],
  "edit_run_id": "7ad89f22",
  "test_label": "v1-rollouts-1-3-sonnet4.5"
}