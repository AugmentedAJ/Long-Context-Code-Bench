{
  "repo_url": "https://github.com/elastic/elasticsearch.git",
  "pr_number": 4427,
  "base_commit": "f0e1f9215b1864d21214c1b44d7d127580d8950a",
  "runner": "auggie",
  "model": "sonnet4.5",
  "timeout_s": 1800,
  "status": "success",
  "elapsed_ms": 187272,
  "patch_unified": "diff --git a/src/main/java/org/elasticsearch/index/fielddata/AbstractIndexFieldData.java b/src/main/java/org/elasticsearch/index/fielddata/AbstractIndexFieldData.java\nindex 3deaad3..ce73dd0 100644\n--- a/src/main/java/org/elasticsearch/index/fielddata/AbstractIndexFieldData.java\n+++ b/src/main/java/org/elasticsearch/index/fielddata/AbstractIndexFieldData.java\n@@ -9,14 +9,11 @@ import org.elasticsearch.index.Index;\n import org.elasticsearch.index.mapper.FieldMapper;\n import org.elasticsearch.index.settings.IndexSettings;\n \n-import java.util.concurrent.atomic.AtomicLong;\n-\n /**\n  */\n public abstract class AbstractIndexFieldData<FD extends AtomicFieldData> extends AbstractIndexComponent implements IndexFieldData<FD> {\n \n     private final FieldMapper.Names fieldNames;\n-    private final AtomicLong highestUniqueValuesCount = new AtomicLong();\n     protected final FieldDataType fieldDataType;\n     protected final IndexFieldDataCache cache;\n \n@@ -42,16 +39,10 @@ public abstract class AbstractIndexFieldData<FD extends AtomicFieldData> extends\n         cache.clear(reader);\n     }\n \n-    @Override\n-    public long getHighestNumberOfSeenUniqueValues() {\n-        return highestUniqueValuesCount.get();\n-    }\n-\n     @Override\n     public final FD load(AtomicReaderContext context) {\n         try {\n             FD fd = cache.load(context, this);\n-            updateHighestSeenValuesCount(fd.getNumberUniqueValues());\n             return fd;\n         } catch (Throwable e) {\n             if (e instanceof ElasticSearchException) {\n@@ -62,13 +53,4 @@ public abstract class AbstractIndexFieldData<FD extends AtomicFieldData> extends\n         }\n     }\n \n-    private void updateHighestSeenValuesCount(long newValuesCount) {\n-        long current;\n-        do {\n-            if ((current = highestUniqueValuesCount.get()) >= newValuesCount) {\n-                break;\n-            }\n-        } while (!highestUniqueValuesCount.compareAndSet(current, newValuesCount));\n-    }\n-\n }\ndiff --git a/src/main/java/org/elasticsearch/index/fielddata/IndexFieldData.java b/src/main/java/org/elasticsearch/index/fielddata/IndexFieldData.java\nindex 90cf52c..c527d9c 100644\n--- a/src/main/java/org/elasticsearch/index/fielddata/IndexFieldData.java\n+++ b/src/main/java/org/elasticsearch/index/fielddata/IndexFieldData.java\n@@ -81,11 +81,6 @@ public interface IndexFieldData<FD extends AtomicFieldData> extends IndexCompone\n \n     void clear(IndexReader reader);\n \n-    /**\n-     * Returns the highest ever seen uniqiue values in an atomic reader.\n-     */\n-    long getHighestNumberOfSeenUniqueValues();\n-\n     // we need this extended source we we have custom comparators to reuse our field data\n     // in this case, we need to reduce type that will be used when search results are reduced\n     // on another node (we don't have the custom source them...)\ndiff --git a/src/main/java/org/elasticsearch/index/fielddata/plain/DocValuesIndexFieldData.java b/src/main/java/org/elasticsearch/index/fielddata/plain/DocValuesIndexFieldData.java\nindex c0ee85a..3673e7c 100644\n--- a/src/main/java/org/elasticsearch/index/fielddata/plain/DocValuesIndexFieldData.java\n+++ b/src/main/java/org/elasticsearch/index/fielddata/plain/DocValuesIndexFieldData.java\n@@ -35,12 +35,10 @@ import org.elasticsearch.index.mapper.internal.UidFieldMapper;\n \n import java.util.Map;\n import java.util.Set;\n-import java.util.concurrent.atomic.AtomicLong;\n \n /** {@link IndexFieldData} impl based on Lucene's doc values. Caching is done on the Lucene side. */\n public abstract class DocValuesIndexFieldData {\n \n-    private final AtomicLong maxUniqueValueCount;\n     protected final Index index;\n     protected final Names fieldNames;\n \n@@ -48,7 +46,6 @@ public abstract class DocValuesIndexFieldData {\n         super();\n         this.index = index;\n         this.fieldNames = fieldNames;\n-        maxUniqueValueCount = new AtomicLong();\n     }\n \n     public final Names getFieldNames() {\n@@ -67,19 +64,6 @@ public abstract class DocValuesIndexFieldData {\n         return index;\n     }\n \n-    public final long getHighestNumberOfSeenUniqueValues() {\n-        return maxUniqueValueCount.get();\n-    }\n-\n-    void updateMaxUniqueValueCount(long uniqueValueCount) {\n-        while (true) {\n-            final long current = maxUniqueValueCount.get();\n-            if (current >= uniqueValueCount || maxUniqueValueCount.compareAndSet(current, uniqueValueCount)) {\n-                break;\n-            }\n-        }\n-    }\n-\n     public static class Builder implements IndexFieldData.Builder {\n \n         private static final Set<String> BINARY_INDEX_FIELD_NAMES = ImmutableSet.of(UidFieldMapper.NAME, IdFieldMapper.NAME);\ndiff --git a/src/main/java/org/elasticsearch/index/fielddata/plain/SortedSetDVBytesIndexFieldData.java b/src/main/java/org/elasticsearch/index/fielddata/plain/SortedSetDVBytesIndexFieldData.java\nindex d79c101..bf74f6c 100644\n--- a/src/main/java/org/elasticsearch/index/fielddata/plain/SortedSetDVBytesIndexFieldData.java\n+++ b/src/main/java/org/elasticsearch/index/fielddata/plain/SortedSetDVBytesIndexFieldData.java\n@@ -43,9 +43,7 @@ public class SortedSetDVBytesIndexFieldData extends DocValuesIndexFieldData impl\n \n     @Override\n     public SortedSetDVBytesAtomicFieldData load(AtomicReaderContext context) {\n-        final SortedSetDVBytesAtomicFieldData atomicFieldData = new SortedSetDVBytesAtomicFieldData(context.reader(), fieldNames.indexName());\n-        updateMaxUniqueValueCount(atomicFieldData.getNumberUniqueValues());\n-        return atomicFieldData;\n+        return new SortedSetDVBytesAtomicFieldData(context.reader(), fieldNames.indexName());\n     }\n \n     @Override\ndiff --git a/src/main/java/org/elasticsearch/index/fielddata/plain/SortedSetDVNumericIndexFieldData.java b/src/main/java/org/elasticsearch/index/fielddata/plain/SortedSetDVNumericIndexFieldData.java\nindex dc183a1..21616b4 100644\n--- a/src/main/java/org/elasticsearch/index/fielddata/plain/SortedSetDVNumericIndexFieldData.java\n+++ b/src/main/java/org/elasticsearch/index/fielddata/plain/SortedSetDVNumericIndexFieldData.java\n@@ -154,9 +154,7 @@ public class SortedSetDVNumericIndexFieldData extends DocValuesIndexFieldData im\n \n     @Override\n     public SortedSetDVNumericAtomicFieldData load(AtomicReaderContext context) {\n-        final SortedSetDVNumericAtomicFieldData atomicFieldData = new SortedSetDVNumericAtomicFieldData(context.reader(), fieldNames.indexName(), numericType);\n-        updateMaxUniqueValueCount(atomicFieldData.getNumberUniqueValues());\n-        return atomicFieldData;\n+        return new SortedSetDVNumericAtomicFieldData(context.reader(), fieldNames.indexName(), numericType);\n     }\n \n     @Override\ndiff --git a/src/test/java/org/elasticsearch/index/fielddata/NoOrdinalsStringFieldDataTests.java b/src/test/java/org/elasticsearch/index/fielddata/NoOrdinalsStringFieldDataTests.java\nindex d7ec3bb..6de1077 100644\n--- a/src/test/java/org/elasticsearch/index/fielddata/NoOrdinalsStringFieldDataTests.java\n+++ b/src/test/java/org/elasticsearch/index/fielddata/NoOrdinalsStringFieldDataTests.java\n@@ -76,11 +76,6 @@ public class NoOrdinalsStringFieldDataTests extends PagedBytesStringFieldDataTes\n                 in.clear(reader);\n             }\n \n-            @Override\n-            public long getHighestNumberOfSeenUniqueValues() {\n-                return in.getHighestNumberOfSeenUniqueValues();\n-            }\n-\n         };\n     }\n ",
  "logs_path": "auggie/sonnet4.5/7ad89f22/elastic_elasticsearch_pr4427/logs.jsonl",
  "errors": [],
  "edit_run_id": "7ad89f22",
  "test_label": "v1-rollouts-1-3-sonnet4.5"
}