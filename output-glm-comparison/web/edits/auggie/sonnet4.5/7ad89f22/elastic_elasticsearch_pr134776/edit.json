{
  "repo_url": "https://github.com/elastic/elasticsearch.git",
  "pr_number": 134776,
  "base_commit": "2ea81d0548b2a25633ffe948cd9304a2c0c59563",
  "runner": "auggie",
  "model": "sonnet4.5",
  "timeout_s": 1800,
  "status": "success",
  "elapsed_ms": 194586,
  "patch_unified": "diff --git a/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/security/authc/Authentication.java b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/security/authc/Authentication.java\nindex ac543c4f..e2955b22 100644\n--- a/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/security/authc/Authentication.java\n+++ b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/security/authc/Authentication.java\n@@ -1376,26 +1376,40 @@ public final class Authentication implements ToXContentObject {\n         return authentication;\n     }\n \n-    public static Authentication newCloudAccessTokenAuthentication(\n+    /**\n+     * Creates a cloud authentication with the specified authentication type and realm reference.\n+     * This unified method supports both User (TOKEN) and API Key authentication types for cloud-managed credentials.\n+     *\n+     * @param authResult The authentication result containing the user and metadata\n+     * @param realmRef The realm reference for the authentication\n+     * @param authenticationType The type of authentication (TOKEN or API_KEY)\n+     * @return A new Authentication instance\n+     */\n+    public static Authentication newCloudAuthentication(\n         AuthenticationResult<User> authResult,\n-        Authentication.RealmRef realmRef\n+        Authentication.RealmRef realmRef,\n+        AuthenticationType authenticationType\n     ) {\n-        assert authResult.isAuthenticated() : \"cloud access token authn result must be successful\";\n+        assert authResult.isAuthenticated() : \"cloud authentication result must be successful\";\n+        assert authenticationType == AuthenticationType.TOKEN || authenticationType == AuthenticationType.API_KEY\n+            : \"cloud authentication type must be either TOKEN or API_KEY\";\n         final User user = authResult.getValue();\n         return new Authentication(\n             new Subject(user, realmRef, TransportVersion.current(), authResult.getMetadata()),\n-            AuthenticationType.TOKEN\n+            authenticationType\n         );\n     }\n \n+    public static Authentication newCloudAccessTokenAuthentication(\n+        AuthenticationResult<User> authResult,\n+        Authentication.RealmRef realmRef\n+    ) {\n+        return newCloudAuthentication(authResult, realmRef, AuthenticationType.TOKEN);\n+    }\n+\n     public static Authentication newCloudApiKeyAuthentication(AuthenticationResult<User> authResult, String nodeName) {\n-        assert authResult.isAuthenticated() : \"cloud API Key authn result must be successful\";\n-        final User apiKeyUser = authResult.getValue();\n         final Authentication.RealmRef authenticatedBy = newCloudApiKeyRealmRef(nodeName);\n-        return new Authentication(\n-            new Subject(apiKeyUser, authenticatedBy, TransportVersion.current(), authResult.getMetadata()),\n-            AuthenticationType.API_KEY\n-        );\n+        return newCloudAuthentication(authResult, authenticatedBy, AuthenticationType.API_KEY);\n     }\n \n     public static Authentication newApiKeyAuthentication(AuthenticationResult<User> authResult, String nodeName) {",
  "logs_path": "auggie/sonnet4.5/7ad89f22/elastic_elasticsearch_pr134776/logs.jsonl",
  "errors": [],
  "edit_run_id": "7ad89f22",
  "test_label": "v1-rollouts-1-3-sonnet4.5"
}