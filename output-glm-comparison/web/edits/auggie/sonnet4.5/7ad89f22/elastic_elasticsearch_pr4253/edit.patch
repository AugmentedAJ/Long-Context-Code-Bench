diff --git a/src/main/java/org/apache/lucene/search/suggest/analyzing/XAnalyzingSuggester.java b/src/main/java/org/apache/lucene/search/suggest/analyzing/XAnalyzingSuggester.java
index f107d17..a0aba74 100644
--- a/src/main/java/org/apache/lucene/search/suggest/analyzing/XAnalyzingSuggester.java
+++ b/src/main/java/org/apache/lucene/search/suggest/analyzing/XAnalyzingSuggester.java
@@ -165,6 +165,9 @@ public class XAnalyzingSuggester extends Lookup {
   /** Whether position holes should appear in the automaton. */
   private boolean preservePositionIncrements;
 
+  /** Number of entries the lookup was built with */
+  private long count = 0;
+
   /**
    * Calls {@link #XAnalyzingSuggester(Analyzer,Analyzer,int,int,int,FST,boolean,int)
    * AnalyzingSuggester(analyzer, analyzer, EXACT_FIRST |
@@ -240,6 +243,11 @@ public class XAnalyzingSuggester extends Lookup {
     return fst == null ? 0 : fst.sizeInBytes();
   }
 
+  @Override
+  public long getCount() {
+    return count;
+  }
+
   private static void copyDestTransitions(State from, State to, List<Transition> transitions) {
     if (to.isAccept()) {
       from.setAccept(true);
@@ -409,11 +417,13 @@ public class XAnalyzingSuggester extends Lookup {
     try {
       ByteArrayDataOutput output = new ByteArrayDataOutput(buffer);
       BytesRef surfaceForm;
+      count = 0;
 
       while ((surfaceForm = iterator.next()) != null) {
         Set<IntsRef> paths = toFiniteStrings(surfaceForm, ts2a);
-        
+
         maxAnalyzedPathsForOneInput = Math.max(maxAnalyzedPathsForOneInput, paths.size());
+        count++;
 
         for (IntsRef path : paths) {
 
@@ -592,6 +602,7 @@ public class XAnalyzingSuggester extends Lookup {
       fst.save(dataOut);
       dataOut.writeVInt(maxAnalyzedPathsForOneInput);
       dataOut.writeByte((byte) (hasPayloads ? 1 : 0));
+      dataOut.writeVLong(count);
     } finally {
       IOUtils.close(output);
     }
@@ -605,6 +616,12 @@ public class XAnalyzingSuggester extends Lookup {
       this.fst = new FST<Pair<Long,BytesRef>>(dataIn, new PairOutputs<Long,BytesRef>(PositiveIntOutputs.getSingleton(), ByteSequenceOutputs.getSingleton()));
       maxAnalyzedPathsForOneInput = dataIn.readVInt();
       hasPayloads = dataIn.readByte() == 1;
+      // Backwards compatibility: only read count if available
+      try {
+        count = dataIn.readVLong();
+      } catch (Exception e) {
+        count = 0;
+      }
     } finally {
       IOUtils.close(input);
     }
diff --git a/src/main/java/org/apache/lucene/search/suggest/analyzing/XFuzzySuggester.java b/src/main/java/org/apache/lucene/search/suggest/analyzing/XFuzzySuggester.java
index 4ea297c..f77eeb2 100644
--- a/src/main/java/org/apache/lucene/search/suggest/analyzing/XFuzzySuggester.java
+++ b/src/main/java/org/apache/lucene/search/suggest/analyzing/XFuzzySuggester.java
@@ -219,7 +219,7 @@ public final class XFuzzySuggester extends XAnalyzingSuggester {
             // TODO: we could call toLevenshteinAutomata() before det?
             // this only happens if you have multiple paths anyway (e.g. synonyms)
             BasicOperations.determinize(a);
-
+            // This automaton should not blow up during determinize:
             return a;
         }
     }
diff --git a/src/main/java/org/elasticsearch/search/suggest/completion/Completion090PostingsFormat.java b/src/main/java/org/elasticsearch/search/suggest/completion/Completion090PostingsFormat.java
index 646d1b5..95c7036 100644
--- a/src/main/java/org/elasticsearch/search/suggest/completion/Completion090PostingsFormat.java
+++ b/src/main/java/org/elasticsearch/search/suggest/completion/Completion090PostingsFormat.java
@@ -55,6 +55,8 @@ public class Completion090PostingsFormat extends PostingsFormat {
 
     public static final String CODEC_NAME = "completion090";
     public static final int SUGGEST_CODEC_VERSION = 1;
+    public static final int SUGGEST_VERSION_START = 1;
+    public static final int SUGGEST_VERSION_CURRENT = 1;
     public static final String EXTENSION = "cmp";
 
     private final static ESLogger logger = Loggers.getLogger(Completion090PostingsFormat.class);
@@ -211,7 +213,7 @@ public class Completion090PostingsFormat extends PostingsFormat {
         public CompletionFieldsProducer(SegmentReadState state) throws IOException {
             String suggestFSTFile = IndexFileNames.segmentFileName(state.segmentInfo.name, state.segmentSuffix, EXTENSION);
             IndexInput input = state.directory.openInput(suggestFSTFile, state.context);
-            CodecUtil.checkHeader(input, CODEC_NAME, SUGGEST_CODEC_VERSION, SUGGEST_CODEC_VERSION);
+            int version = CodecUtil.checkHeader(input, CODEC_NAME, SUGGEST_VERSION_START, SUGGEST_VERSION_CURRENT);
             boolean success = false;
             try {
                 PostingsFormat delegatePostingsFormat = PostingsFormat.forName(input.readString());