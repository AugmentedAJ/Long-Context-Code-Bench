{
  "repo_url": "https://github.com/elastic/elasticsearch.git",
  "pr_number": 4425,
  "base_commit": "be860c8004d18cb9bfb24e7cc3abcbee212e622d",
  "runner": "auggie",
  "model": "sonnet4.5",
  "timeout_s": 1800,
  "status": "success",
  "elapsed_ms": 292926,
  "patch_unified": "diff --git a/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/create/CreateSnapshotRequest.java b/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/create/CreateSnapshotRequest.java\nindex 6d24d9d..cf636ab 100644\n--- a/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/create/CreateSnapshotRequest.java\n+++ b/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/create/CreateSnapshotRequest.java\n@@ -30,6 +30,7 @@ import org.elasticsearch.common.io.stream.StreamInput;\n import org.elasticsearch.common.io.stream.StreamOutput;\n import org.elasticsearch.common.settings.ImmutableSettings;\n import org.elasticsearch.common.settings.Settings;\n+import org.elasticsearch.common.settings.loader.SettingsLoader;\n import org.elasticsearch.common.xcontent.XContentBuilder;\n import org.elasticsearch.common.xcontent.XContentFactory;\n import org.elasticsearch.common.xcontent.XContentType;\n@@ -283,13 +284,7 @@ public class CreateSnapshotRequest extends MasterNodeOperationRequest<CreateSnap\n      * @return this request\n      */\n     public CreateSnapshotRequest settings(Map<String, Object> source) {\n-        try {\n-            XContentBuilder builder = XContentFactory.contentBuilder(XContentType.JSON);\n-            builder.map(source);\n-            settings(builder.string());\n-        } catch (IOException e) {\n-            throw new ElasticSearchGenerationException(\"Failed to generate [\" + source + \"]\", e);\n-        }\n+        this.settings = ImmutableSettings.settingsBuilder().put(SettingsLoader.Helper.loadNestedFromMap(source)).build();\n         return this;\n     }\n \ndiff --git a/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/restore/RestoreSnapshotRequest.java b/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/restore/RestoreSnapshotRequest.java\nindex 696bcd1..2b07252 100644\n--- a/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/restore/RestoreSnapshotRequest.java\n+++ b/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/restore/RestoreSnapshotRequest.java\n@@ -30,6 +30,7 @@ import org.elasticsearch.common.io.stream.StreamInput;\n import org.elasticsearch.common.io.stream.StreamOutput;\n import org.elasticsearch.common.settings.ImmutableSettings;\n import org.elasticsearch.common.settings.Settings;\n+import org.elasticsearch.common.settings.loader.SettingsLoader;\n import org.elasticsearch.common.xcontent.XContentBuilder;\n import org.elasticsearch.common.xcontent.XContentFactory;\n import org.elasticsearch.common.xcontent.XContentType;\n@@ -317,13 +318,7 @@ public class RestoreSnapshotRequest extends MasterNodeOperationRequest<RestoreSn\n      * @return this request\n      */\n     public RestoreSnapshotRequest settings(Map<String, Object> source) {\n-        try {\n-            XContentBuilder builder = XContentFactory.contentBuilder(XContentType.JSON);\n-            builder.map(source);\n-            settings(builder.string());\n-        } catch (IOException e) {\n-            throw new ElasticSearchGenerationException(\"Failed to generate [\" + source + \"]\", e);\n-        }\n+        this.settings = ImmutableSettings.settingsBuilder().put(SettingsLoader.Helper.loadNestedFromMap(source)).build();\n         return this;\n     }\n \ndiff --git a/src/main/java/org/elasticsearch/action/admin/indices/create/CreateIndexRequest.java b/src/main/java/org/elasticsearch/action/admin/indices/create/CreateIndexRequest.java\nindex 9814efc..cef2032 100644\n--- a/src/main/java/org/elasticsearch/action/admin/indices/create/CreateIndexRequest.java\n+++ b/src/main/java/org/elasticsearch/action/admin/indices/create/CreateIndexRequest.java\n@@ -35,6 +35,7 @@ import org.elasticsearch.common.io.stream.StreamInput;\n import org.elasticsearch.common.io.stream.StreamOutput;\n import org.elasticsearch.common.settings.ImmutableSettings;\n import org.elasticsearch.common.settings.Settings;\n+import org.elasticsearch.common.settings.loader.SettingsLoader;\n import org.elasticsearch.common.unit.TimeValue;\n import org.elasticsearch.common.xcontent.XContentBuilder;\n import org.elasticsearch.common.xcontent.XContentFactory;\n@@ -174,13 +175,7 @@ public class CreateIndexRequest extends MasterNodeOperationRequest<CreateIndexRe\n      * The settings to crete the index with (either json/yaml/properties format)\n      */\n     public CreateIndexRequest settings(Map source) {\n-        try {\n-            XContentBuilder builder = XContentFactory.contentBuilder(XContentType.JSON);\n-            builder.map(source);\n-            settings(builder.string());\n-        } catch (IOException e) {\n-            throw new ElasticSearchGenerationException(\"Failed to generate [\" + source + \"]\", e);\n-        }\n+        this.settings = ImmutableSettings.settingsBuilder().put(SettingsLoader.Helper.loadNestedFromMap(source)).build();\n         return this;\n     }\n \ndiff --git a/src/main/java/org/elasticsearch/action/admin/indices/settings/UpdateSettingsRequest.java b/src/main/java/org/elasticsearch/action/admin/indices/settings/UpdateSettingsRequest.java\nindex d32459c..e976864 100644\n--- a/src/main/java/org/elasticsearch/action/admin/indices/settings/UpdateSettingsRequest.java\n+++ b/src/main/java/org/elasticsearch/action/admin/indices/settings/UpdateSettingsRequest.java\n@@ -27,6 +27,7 @@ import org.elasticsearch.common.io.stream.StreamInput;\n import org.elasticsearch.common.io.stream.StreamOutput;\n import org.elasticsearch.common.settings.ImmutableSettings;\n import org.elasticsearch.common.settings.Settings;\n+import org.elasticsearch.common.settings.loader.SettingsLoader;\n import org.elasticsearch.common.xcontent.XContentBuilder;\n import org.elasticsearch.common.xcontent.XContentFactory;\n import org.elasticsearch.common.xcontent.XContentType;\n@@ -120,13 +121,7 @@ public class UpdateSettingsRequest extends AcknowledgedRequest<UpdateSettingsReq\n      */\n     @SuppressWarnings(\"unchecked\")\n     public UpdateSettingsRequest settings(Map source) {\n-        try {\n-            XContentBuilder builder = XContentFactory.contentBuilder(XContentType.JSON);\n-            builder.map(source);\n-            settings(builder.string());\n-        } catch (IOException e) {\n-            throw new ElasticSearchGenerationException(\"Failed to generate [\" + source + \"]\", e);\n-        }\n+        this.settings = ImmutableSettings.settingsBuilder().put(SettingsLoader.Helper.loadNestedFromMap(source)).build();\n         return this;\n     }\n \ndiff --git a/src/main/java/org/elasticsearch/action/admin/indices/template/put/PutIndexTemplateRequest.java b/src/main/java/org/elasticsearch/action/admin/indices/template/put/PutIndexTemplateRequest.java\nindex ea50b30..5af9cbb 100644\n--- a/src/main/java/org/elasticsearch/action/admin/indices/template/put/PutIndexTemplateRequest.java\n+++ b/src/main/java/org/elasticsearch/action/admin/indices/template/put/PutIndexTemplateRequest.java\n@@ -33,6 +33,7 @@ import org.elasticsearch.common.io.stream.StreamInput;\n import org.elasticsearch.common.io.stream.StreamOutput;\n import org.elasticsearch.common.settings.ImmutableSettings;\n import org.elasticsearch.common.settings.Settings;\n+import org.elasticsearch.common.settings.loader.SettingsLoader;\n import org.elasticsearch.common.xcontent.XContentBuilder;\n import org.elasticsearch.common.xcontent.XContentFactory;\n import org.elasticsearch.common.xcontent.XContentType;\n@@ -165,13 +166,7 @@ public class PutIndexTemplateRequest extends MasterNodeOperationRequest<PutIndex\n      * The settings to crete the index template with (either json/yaml/properties format).\n      */\n     public PutIndexTemplateRequest settings(Map<String, Object> source) {\n-        try {\n-            XContentBuilder builder = XContentFactory.contentBuilder(XContentType.JSON);\n-            builder.map(source);\n-            settings(builder.string());\n-        } catch (IOException e) {\n-            throw new ElasticSearchGenerationException(\"Failed to generate [\" + source + \"]\", e);\n-        }\n+        this.settings = ImmutableSettings.settingsBuilder().put(SettingsLoader.Helper.loadNestedFromMap(source)).build();\n         return this;\n     }\n \ndiff --git a/src/test/java/org/elasticsearch/indices/template/IndexTemplateFileLoadingTests.java b/src/test/java/org/elasticsearch/indices/template/IndexTemplateFileLoadingTests.java\nindex 606d78d..cc758dd 100644\n--- a/src/test/java/org/elasticsearch/indices/template/IndexTemplateFileLoadingTests.java\n+++ b/src/test/java/org/elasticsearch/indices/template/IndexTemplateFileLoadingTests.java\n@@ -59,6 +59,10 @@ public class IndexTemplateFileLoadingTests extends ElasticsearchIntegrationTest\n             File dst = new File(templatesDir, \"template.json\");\n             String template = Streams.copyToStringFromClasspath(\"/org/elasticsearch/indices/template/template.json\");\n             Files.write(template, dst, Charsets.UTF_8);\n+\n+            File dst2 = new File(templatesDir, \"template_without_prefix.json\");\n+            String template2 = Streams.copyToStringFromClasspath(\"/org/elasticsearch/indices/template/template_without_prefix.json\");\n+            Files.write(template2, dst2, Charsets.UTF_8);\n         } catch (Exception e) {\n             throw new RuntimeException(e);\n         }\n@@ -75,4 +79,14 @@ public class IndexTemplateFileLoadingTests extends ElasticsearchIntegrationTest\n         assertThat(stateResponse.getState().getMetaData().indices().get(\"foobar\").getNumberOfShards(), is(10));\n         assertThat(stateResponse.getState().getMetaData().indices().get(\"foobar\").getNumberOfReplicas(), is(0));\n     }\n+\n+    @Test\n+    public void testThatLoadingTemplateWithoutIndexPrefixFromFileWorks() throws Exception {\n+        createIndex(\"barbaz\");\n+        ensureYellow(); // ensuring yellow so the test fails faster if the template cannot be loaded\n+\n+        ClusterStateResponse stateResponse = client().admin().cluster().prepareState().setFilterIndices(\"barbaz\").get();\n+        assertThat(stateResponse.getState().getMetaData().indices().get(\"barbaz\").getNumberOfShards(), is(5));\n+        assertThat(stateResponse.getState().getMetaData().indices().get(\"barbaz\").getNumberOfReplicas(), is(1));\n+    }\n }",
  "logs_path": "auggie/sonnet4.5/7ad89f22/elastic_elasticsearch_pr4425/logs.jsonl",
  "errors": [],
  "edit_run_id": "7ad89f22",
  "test_label": "v1-rollouts-1-3-sonnet4.5"
}