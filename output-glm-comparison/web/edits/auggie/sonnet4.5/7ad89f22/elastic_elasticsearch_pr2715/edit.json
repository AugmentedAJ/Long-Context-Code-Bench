{
  "repo_url": "https://github.com/elastic/elasticsearch.git",
  "pr_number": 2715,
  "base_commit": "b03f3fcd6c504bfc8a5054a3e81c88930f38b5cd",
  "runner": "auggie",
  "model": "sonnet4.5",
  "timeout_s": 1800,
  "status": "success",
  "elapsed_ms": 201811,
  "patch_unified": "diff --git a/src/main/java/org/elasticsearch/index/mapper/internal/IdFieldMapper.java b/src/main/java/org/elasticsearch/index/mapper/internal/IdFieldMapper.java\nindex 3391561..460dc58 100644\n--- a/src/main/java/org/elasticsearch/index/mapper/internal/IdFieldMapper.java\n+++ b/src/main/java/org/elasticsearch/index/mapper/internal/IdFieldMapper.java\n@@ -295,24 +295,32 @@ public class IdFieldMapper extends AbstractFieldMapper<String> implements Intern\n     @Override\n     protected Field parseCreateField(ParseContext context) throws IOException {\n         XContentParser parser = context.parser();\n-        if (parser.currentName() != null && parser.currentName().equals(Defaults.NAME) && parser.currentToken().isValue()) {\n-            // we are in the parse Phase\n-            String id = parser.text();\n-            if (context.id() != null && !context.id().equals(id)) {\n-                throw new MapperParsingException(\"Provided id [\" + context.id() + \"] does not match the content one [\" + id + \"]\");\n+        if (parser.currentName() != null && parser.currentName().equals(Defaults.NAME)) {\n+            XContentParser.Token token = parser.currentToken();\n+            if (token == XContentParser.Token.START_ARRAY) {\n+                throw new MapperParsingException(\"Field [\" + Defaults.NAME + \"] does not support arrays\");\n             }\n-            context.id(id);\n-            if (!fieldType.indexed() && !fieldType.stored()) {\n-                return null;\n+            if (token == XContentParser.Token.START_OBJECT) {\n+                throw new MapperParsingException(\"Field [\" + Defaults.NAME + \"] does not support objects\");\n             }\n-            return new Field(names.indexName(), context.id(), fieldType);\n-        } else {\n-            // we are in the pre/post parse phase\n-            if (!fieldType.indexed() && !fieldType.stored()) {\n-                return null;\n+            if (token.isValue()) {\n+                // we are in the parse Phase\n+                String id = parser.text();\n+                if (context.id() != null && !context.id().equals(id)) {\n+                    throw new MapperParsingException(\"Provided id [\" + context.id() + \"] does not match the content one [\" + id + \"]\");\n+                }\n+                context.id(id);\n+                if (!fieldType.indexed() && !fieldType.stored()) {\n+                    return null;\n+                }\n+                return new Field(names.indexName(), context.id(), fieldType);\n             }\n-            return new Field(names.indexName(), context.id(), fieldType);\n         }\n+        // we are in the pre/post parse phase\n+        if (!fieldType.indexed() && !fieldType.stored()) {\n+            return null;\n+        }\n+        return new Field(names.indexName(), context.id(), fieldType);\n     }\n \n     @Override\ndiff --git a/src/test/java/org/elasticsearch/test/unit/index/mapper/id/IdMappingTests.java b/src/test/java/org/elasticsearch/test/unit/index/mapper/id/IdMappingTests.java\nindex 34e1846..6774b4e 100644\n--- a/src/test/java/org/elasticsearch/test/unit/index/mapper/id/IdMappingTests.java\n+++ b/src/test/java/org/elasticsearch/test/unit/index/mapper/id/IdMappingTests.java\n@@ -115,4 +115,45 @@ public class IdMappingTests {\n \n         assertThat(serialized_id_mapping, equalTo(expected_id_mapping));\n     }\n+\n+    @Test\n+    public void testIdAsArray() throws Exception {\n+        String mapping = XContentFactory.jsonBuilder().startObject().startObject(\"type\")\n+                .endObject().endObject().string();\n+        DocumentMapper docMapper = MapperTests.newParser().parse(mapping);\n+\n+        try {\n+            docMapper.parse(\"type\", null, XContentFactory.jsonBuilder()\n+                    .startObject()\n+                    .startArray(\"_id\")\n+                    .value(\"1\")\n+                    .value(\"2\")\n+                    .endArray()\n+                    .endObject()\n+                    .bytes());\n+            assert false : \"Expected MapperParsingException\";\n+        } catch (MapperParsingException e) {\n+            assertThat(e.getMessage(), equalTo(\"Field [_id] does not support arrays\"));\n+        }\n+    }\n+\n+    @Test\n+    public void testIdAsObject() throws Exception {\n+        String mapping = XContentFactory.jsonBuilder().startObject().startObject(\"type\")\n+                .endObject().endObject().string();\n+        DocumentMapper docMapper = MapperTests.newParser().parse(mapping);\n+\n+        try {\n+            docMapper.parse(\"type\", null, XContentFactory.jsonBuilder()\n+                    .startObject()\n+                    .startObject(\"_id\")\n+                    .field(\"value\", \"1\")\n+                    .endObject()\n+                    .endObject()\n+                    .bytes());\n+            assert false : \"Expected MapperParsingException\";\n+        } catch (MapperParsingException e) {\n+            assertThat(e.getMessage(), equalTo(\"Field [_id] does not support objects\"));\n+        }\n+    }\n }",
  "logs_path": "auggie/sonnet4.5/7ad89f22/elastic_elasticsearch_pr2715/logs.jsonl",
  "errors": [],
  "edit_run_id": "7ad89f22",
  "test_label": "v1-rollouts-1-3-sonnet4.5"
}