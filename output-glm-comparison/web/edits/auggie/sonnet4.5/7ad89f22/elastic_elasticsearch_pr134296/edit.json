{
  "repo_url": "https://github.com/elastic/elasticsearch.git",
  "pr_number": 134296,
  "base_commit": "df8cedf9920c8bf710221ca8579bb90f64d4faa0",
  "runner": "auggie",
  "model": "sonnet4.5",
  "timeout_s": 1800,
  "status": "success",
  "elapsed_ms": 215331,
  "patch_unified": "diff --git a/rest-api-spec/src/yamlRestTest/resources/rest-api-spec/test/nodes.stats/11_indices_metrics.yml b/rest-api-spec/src/yamlRestTest/resources/rest-api-spec/test/nodes.stats/11_indices_metrics.yml\nindex 372b9a94..14b5c873 100644\n--- a/rest-api-spec/src/yamlRestTest/resources/rest-api-spec/test/nodes.stats/11_indices_metrics.yml\n+++ b/rest-api-spec/src/yamlRestTest/resources/rest-api-spec/test/nodes.stats/11_indices_metrics.yml\n@@ -325,6 +325,29 @@\n   # values for clients.0.closed_time_millis, clients.0.x_forwarded_for, and clients.0.x_opaque_id are often\n   # null and cannot be tested here\n \n+---\n+\"Metric - http with human readable timestamps\":\n+  - requires:\n+      test_runner_features: [arbitrary_key]\n+      cluster_features: [\"gte_v7.13.0\"]\n+      reason: \"HTTP client stats added in 7.13.0\"\n+  - do:\n+      nodes.info: {}\n+  - set:\n+      nodes._arbitrary_key_: node_id\n+\n+  - do:\n+      nodes.stats: { metric: http, human: true }\n+\n+  - is_true:  nodes.$node_id\n+  - is_true:  nodes.$node_id.http.clients\n+  - gte: { nodes.$node_id.http.clients.0.id: 1 }\n+  # With human=true, should have both millis and human-readable timestamp fields\n+  - gte: { nodes.$node_id.http.clients.0.opened_time_millis: 1614028911317 }\n+  - match: { nodes.$node_id.http.clients.0.opened_time: \"/\\\\d{4}-\\\\d{2}-\\\\d{2}T\\\\d{2}:\\\\d{2}:\\\\d{2}\\\\.\\\\d{3}Z/\" }\n+  - gte: { nodes.$node_id.http.clients.0.last_request_time_millis: 1614028911317 }\n+  - match: { nodes.$node_id.http.clients.0.last_request_time: \"/\\\\d{4}-\\\\d{2}-\\\\d{2}T\\\\d{2}:\\\\d{2}:\\\\d{2}\\\\.\\\\d{3}Z/\" }\n+\n ---\n \"Metric - blank for indices shard_stats\":\n   - requires:\ndiff --git a/server/src/main/java/org/elasticsearch/http/HttpStats.java b/server/src/main/java/org/elasticsearch/http/HttpStats.java\nindex d4df9c8f..2a62b664 100644\n--- a/server/src/main/java/org/elasticsearch/http/HttpStats.java\n+++ b/server/src/main/java/org/elasticsearch/http/HttpStats.java\n@@ -90,8 +90,11 @@ public record HttpStats(long serverOpen, long totalOpen, List<ClientStats> clien\n         static final String CLIENT_REMOTE_ADDRESS = \"remote_address\";\n         static final String CLIENT_LAST_URI = \"last_uri\";\n         static final String CLIENT_OPENED_TIME_MILLIS = \"opened_time_millis\";\n+        static final String CLIENT_OPENED_TIME = \"opened_time\";\n         static final String CLIENT_CLOSED_TIME_MILLIS = \"closed_time_millis\";\n+        static final String CLIENT_CLOSED_TIME = \"closed_time\";\n         static final String CLIENT_LAST_REQUEST_TIME_MILLIS = \"last_request_time_millis\";\n+        static final String CLIENT_LAST_REQUEST_TIME = \"last_request_time\";\n         static final String CLIENT_REQUEST_COUNT = \"request_count\";\n         static final String CLIENT_REQUEST_SIZE_BYTES = \"request_size_bytes\";\n         static final String CLIENT_FORWARDED_FOR = \"x_forwarded_for\";\n@@ -179,11 +182,23 @@ public record HttpStats(long serverOpen, long totalOpen, List<ClientStats> clien\n             if (opaqueId != null) {\n                 builder.field(Fields.CLIENT_OPAQUE_ID, opaqueId);\n             }\n-            builder.field(Fields.CLIENT_OPENED_TIME_MILLIS, openedTimeMillis);\n+            builder.timestampFieldsFromUnixEpochMillis(\n+                Fields.CLIENT_OPENED_TIME_MILLIS,\n+                Fields.CLIENT_OPENED_TIME,\n+                openedTimeMillis\n+            );\n             if (closedTimeMillis != NOT_CLOSED) {\n-                builder.field(Fields.CLIENT_CLOSED_TIME_MILLIS, closedTimeMillis);\n+                builder.timestampFieldsFromUnixEpochMillis(\n+                    Fields.CLIENT_CLOSED_TIME_MILLIS,\n+                    Fields.CLIENT_CLOSED_TIME,\n+                    closedTimeMillis\n+                );\n             }\n-            builder.field(Fields.CLIENT_LAST_REQUEST_TIME_MILLIS, lastRequestTimeMillis);\n+            builder.timestampFieldsFromUnixEpochMillis(\n+                Fields.CLIENT_LAST_REQUEST_TIME_MILLIS,\n+                Fields.CLIENT_LAST_REQUEST_TIME,\n+                lastRequestTimeMillis\n+            );\n             builder.field(Fields.CLIENT_REQUEST_COUNT, requestCount);\n             builder.field(Fields.CLIENT_REQUEST_SIZE_BYTES, requestSizeBytes);\n             builder.endObject();\ndiff --git a/server/src/test/java/org/elasticsearch/http/HttpStatsTests.java b/server/src/test/java/org/elasticsearch/http/HttpStatsTests.java\nindex f5271ce2..1ebb97c1 100644\n--- a/server/src/test/java/org/elasticsearch/http/HttpStatsTests.java\n+++ b/server/src/test/java/org/elasticsearch/http/HttpStatsTests.java\n@@ -13,6 +13,9 @@ import org.elasticsearch.common.Strings;\n import org.elasticsearch.common.unit.ByteSizeUnit;\n import org.elasticsearch.core.Tuple;\n import org.elasticsearch.test.ESTestCase;\n+import org.elasticsearch.xcontent.ToXContent;\n+import org.elasticsearch.xcontent.XContentBuilder;\n+import org.elasticsearch.xcontent.XContentFactory;\n \n import java.util.HashMap;\n import java.util.List;\n@@ -20,8 +23,10 @@ import java.util.Map;\n import java.util.stream.IntStream;\n import java.util.stream.Stream;\n \n+import static org.hamcrest.Matchers.containsString;\n import static org.hamcrest.Matchers.equalTo;\n import static org.hamcrest.Matchers.hasSize;\n+import static org.hamcrest.Matchers.not;\n \n public class HttpStatsTests extends ESTestCase {\n \n@@ -75,6 +80,54 @@ public class HttpStatsTests extends ESTestCase {\n         );\n     }\n \n+    public void testClientStatsHumanReadableTimestamps() throws Exception {\n+        final long openedTimeMillis = 1614028911317L;\n+        final long closedTimeMillis = 1614028921317L;\n+        final long lastRequestTimeMillis = 1614028920000L;\n+\n+        final HttpStats.ClientStats clientStats = new HttpStats.ClientStats(\n+            1,\n+            \"test-agent\",\n+            \"127.0.0.1:9200\",\n+            \"127.0.0.1:54321\",\n+            \"/test/uri\",\n+            null,\n+            null,\n+            openedTimeMillis,\n+            closedTimeMillis,\n+            lastRequestTimeMillis,\n+            5,\n+            1024\n+        );\n+\n+        // Test without human-readable flag\n+        XContentBuilder builder = XContentFactory.jsonBuilder();\n+        builder.humanReadable(false);\n+        clientStats.toXContent(builder, ToXContent.EMPTY_PARAMS);\n+        String json = Strings.toString(builder);\n+\n+        assertThat(json, containsString(\"\\\"opened_time_millis\\\":\" + openedTimeMillis));\n+        assertThat(json, containsString(\"\\\"closed_time_millis\\\":\" + closedTimeMillis));\n+        assertThat(json, containsString(\"\\\"last_request_time_millis\\\":\" + lastRequestTimeMillis));\n+        assertThat(json, not(containsString(\"\\\"opened_time\\\"\")));\n+        assertThat(json, not(containsString(\"\\\"closed_time\\\"\")));\n+        assertThat(json, not(containsString(\"\\\"last_request_time\\\"\")));\n+\n+        // Test with human-readable flag\n+        builder = XContentFactory.jsonBuilder();\n+        builder.humanReadable(true);\n+        clientStats.toXContent(builder, ToXContent.EMPTY_PARAMS);\n+        json = Strings.toString(builder);\n+\n+        assertThat(json, containsString(\"\\\"opened_time_millis\\\":\" + openedTimeMillis));\n+        assertThat(json, containsString(\"\\\"closed_time_millis\\\":\" + closedTimeMillis));\n+        assertThat(json, containsString(\"\\\"last_request_time_millis\\\":\" + lastRequestTimeMillis));\n+        // Should also contain human-readable timestamps in ISO 8601 format\n+        assertThat(json, containsString(\"\\\"opened_time\\\":\\\"2021-02-23T00:01:51.317Z\\\"\"));\n+        assertThat(json, containsString(\"\\\"closed_time\\\":\\\"2021-02-23T00:02:01.317Z\\\"\"));\n+        assertThat(json, containsString(\"\\\"last_request_time\\\":\\\"2021-02-23T00:02:00.000Z\\\"\"));\n+    }\n+\n     public static HttpStats randomHttpStats() {\n         return new HttpStats(\n             randomLongBetween(0, Long.MAX_VALUE),",
  "logs_path": "auggie/sonnet4.5/7ad89f22/elastic_elasticsearch_pr134296/logs.jsonl",
  "errors": [],
  "edit_run_id": "7ad89f22",
  "test_label": "v1-rollouts-1-3-sonnet4.5"
}