{
  "repo_url": "https://github.com/elastic/elasticsearch.git",
  "pr_number": 3947,
  "base_commit": "e79f714b4b066f9238ff6313aad9a854c37a8c3d",
  "runner": "auggie",
  "model": "sonnet4.5",
  "timeout_s": 1800,
  "status": "success",
  "elapsed_ms": 171713,
  "patch_unified": "diff --git a/src/main/java/org/elasticsearch/index/mapper/core/CompletionFieldMapper.java b/src/main/java/org/elasticsearch/index/mapper/core/CompletionFieldMapper.java\nindex bc4c097..76e8da1 100644\n--- a/src/main/java/org/elasticsearch/index/mapper/core/CompletionFieldMapper.java\n+++ b/src/main/java/org/elasticsearch/index/mapper/core/CompletionFieldMapper.java\n@@ -29,6 +29,7 @@ import org.elasticsearch.ElasticSearchIllegalArgumentException;\n import org.elasticsearch.common.xcontent.XContentBuilder;\n import org.elasticsearch.common.xcontent.XContentFactory;\n import org.elasticsearch.common.xcontent.XContentParser;\n+import org.elasticsearch.common.xcontent.XContentParser.NumberType;\n import org.elasticsearch.index.analysis.NamedAnalyzer;\n import org.elasticsearch.index.codec.postingsformat.PostingsFormatProvider;\n import org.elasticsearch.index.fielddata.FieldDataType;\n@@ -248,6 +249,10 @@ public class CompletionFieldMapper extends AbstractFieldMapper<String> {\n                     }\n                 } else if (token == XContentParser.Token.VALUE_NUMBER) {\n                     if (Fields.CONTENT_FIELD_NAME_WEIGHT.equals(currentFieldName)) {\n+                        NumberType numberType = parser.numberType();\n+                        if (numberType == NumberType.FLOAT || numberType == NumberType.DOUBLE) {\n+                            throw new ElasticSearchIllegalArgumentException(\"Weight must be an integer, but was [\" + parser.numberValue() + \"]\");\n+                        }\n                         weight = parser.longValue(); // always parse a long to make sure we don't get the overflow value\n                         if (weight < 0 || weight > Integer.MAX_VALUE) {\n                             throw new ElasticSearchIllegalArgumentException(\"Weight must be in the interval [0..2147483647] but was \" + weight);\ndiff --git a/src/test/java/org/elasticsearch/search/suggest/CompletionSuggestSearchTests.java b/src/test/java/org/elasticsearch/search/suggest/CompletionSuggestSearchTests.java\nindex db4e0bc..5473a0b 100644\n--- a/src/test/java/org/elasticsearch/search/suggest/CompletionSuggestSearchTests.java\n+++ b/src/test/java/org/elasticsearch/search/suggest/CompletionSuggestSearchTests.java\n@@ -617,6 +617,17 @@ public class CompletionSuggestSearchTests extends AbstractIntegrationTest {\n                 .endObject().endObject()).get();\n     }\n \n+    @Test(expected = MapperParsingException.class)\n+    public void testThatFloatWeightsAreRejected() throws Exception {\n+        createIndexAndMapping();\n+\n+        client().prepareIndex(INDEX, TYPE, \"1\").setSource(jsonBuilder()\n+                .startObject().startObject(FIELD)\n+                .startArray(\"input\").value(\"Nirvana\").endArray()\n+                .field(\"weight\", 2.5)\n+                .endObject().endObject()).get();\n+    }\n+\n \n     public void assertSuggestions(String suggestion, String... suggestions) {\n         String suggestionName = RandomStrings.randomAsciiOfLength(new Random(), 10);",
  "logs_path": "auggie/sonnet4.5/7ad89f22/elastic_elasticsearch_pr3947/logs.jsonl",
  "errors": [],
  "edit_run_id": "7ad89f22",
  "test_label": "v1-rollouts-1-3-sonnet4.5"
}