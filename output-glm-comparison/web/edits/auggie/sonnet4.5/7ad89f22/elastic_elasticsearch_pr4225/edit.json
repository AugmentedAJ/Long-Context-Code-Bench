{
  "repo_url": "https://github.com/elastic/elasticsearch.git",
  "pr_number": 4225,
  "base_commit": "81e13a870b112ad2921e1627bb3aabab48bf763c",
  "runner": "auggie",
  "model": "sonnet4.5",
  "timeout_s": 1800,
  "status": "success",
  "elapsed_ms": 181929,
  "patch_unified": "diff --git a/src/main/java/org/elasticsearch/common/geo/GeoDistance.java b/src/main/java/org/elasticsearch/common/geo/GeoDistance.java\nindex 0ded558..109869a 100644\n--- a/src/main/java/org/elasticsearch/common/geo/GeoDistance.java\n+++ b/src/main/java/org/elasticsearch/common/geo/GeoDistance.java\n@@ -19,6 +19,7 @@\n \n package org.elasticsearch.common.geo;\n \n+import org.apache.lucene.util.SloppyMath;\n import org.elasticsearch.ElasticSearchIllegalArgumentException;\n import org.elasticsearch.common.unit.DistanceUnit;\n \n@@ -75,18 +76,10 @@ public enum GeoDistance {\n     ARC() {\n         @Override\n         public double calculate(double sourceLatitude, double sourceLongitude, double targetLatitude, double targetLongitude, DistanceUnit unit) {\n-            double longitudeDifference = targetLongitude - sourceLongitude;\n-            double a = Math.toRadians(90D - sourceLatitude);\n-            double c = Math.toRadians(90D - targetLatitude);\n-            double factor = (Math.cos(a) * Math.cos(c)) + (Math.sin(a) * Math.sin(c) * Math.cos(Math.toRadians(longitudeDifference)));\n-\n-            if (factor < -1D) {\n-                return Math.PI * unit.getEarthRadius();\n-            } else if (factor >= 1D) {\n-                return 0;\n-            } else {\n-                return Math.acos(factor) * unit.getEarthRadius();\n-            }\n+            // Use Lucene's SloppyMath which returns distance in kilometers\n+            double distanceInKm = SloppyMath.haversin(sourceLatitude, sourceLongitude, targetLatitude, targetLongitude);\n+            // Convert from kilometers to the requested unit\n+            return DistanceUnit.KILOMETERS.convert(distanceInKm, unit);\n         }\n \n         @Override\n@@ -293,34 +286,20 @@ public enum GeoDistance {\n \n         private final double sourceLatitude;\n         private final double sourceLongitude;\n-        private final double earthRadius;\n-\n-        private final double a;\n-        private final double sinA;\n-        private final double cosA;\n+        private final DistanceUnit unit;\n \n         public ArcFixedSourceDistance(double sourceLatitude, double sourceLongitude, DistanceUnit unit) {\n             this.sourceLatitude = sourceLatitude;\n             this.sourceLongitude = sourceLongitude;\n-            this.earthRadius = unit.getEarthRadius();\n-            this.a = Math.toRadians(90D - sourceLatitude);\n-            this.sinA = Math.sin(a);\n-            this.cosA = Math.cos(a);\n+            this.unit = unit;\n         }\n \n         @Override\n         public double calculate(double targetLatitude, double targetLongitude) {\n-            double longitudeDifference = targetLongitude - sourceLongitude;\n-            double c = Math.toRadians(90D - targetLatitude);\n-            double factor = (cosA * Math.cos(c)) + (sinA * Math.sin(c) * Math.cos(Math.toRadians(longitudeDifference)));\n-\n-            if (factor < -1D) {\n-                return Math.PI * earthRadius;\n-            } else if (factor >= 1D) {\n-                return 0;\n-            } else {\n-                return Math.acos(factor) * earthRadius;\n-            }\n+            // Use Lucene's SloppyMath which returns distance in kilometers\n+            double distanceInKm = SloppyMath.haversin(sourceLatitude, sourceLongitude, targetLatitude, targetLongitude);\n+            // Convert from kilometers to the requested unit\n+            return DistanceUnit.KILOMETERS.convert(distanceInKm, unit);\n         }\n     }\n }",
  "logs_path": "auggie/sonnet4.5/7ad89f22/elastic_elasticsearch_pr4225/logs.jsonl",
  "errors": [],
  "edit_run_id": "7ad89f22",
  "test_label": "v1-rollouts-1-3-sonnet4.5"
}