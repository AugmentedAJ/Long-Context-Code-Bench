{
  "repo_url": "https://github.com/elastic/elasticsearch.git",
  "pr_number": 134506,
  "base_commit": "e5559ef012c066ddfe75ccbc3961d7923e92af3b",
  "runner": "claude-code",
  "model": "claude-sonnet-4-5",
  "timeout_s": 1800,
  "status": "success",
  "elapsed_ms": 176238,
  "patch_unified": "diff --git a/server/src/main/java/org/elasticsearch/TransportVersion.java b/server/src/main/java/org/elasticsearch/TransportVersion.java\nindex f130f7d6..b7e32505 100644\n--- a/server/src/main/java/org/elasticsearch/TransportVersion.java\n+++ b/server/src/main/java/org/elasticsearch/TransportVersion.java\n@@ -239,11 +239,110 @@ public record TransportVersion(String name, int id, TransportVersion nextPatchVe\n     public static TransportVersion fromName(String name) {\n         TransportVersion known = VersionsHolder.ALL_VERSIONS_BY_NAME.get(name);\n         if (known == null) {\n-            throw new IllegalStateException(\"unknown transport version [\" + name + \"]\");\n+            String suggestions = findSimilarVersionNames(name, 3);\n+            String message = \"unknown transport version [\" + name + \"]\";\n+            if (suggestions.isEmpty() == false) {\n+                message += \". Did you mean: \" + suggestions + \"?\";\n+            }\n+            throw new IllegalStateException(message);\n         }\n         return known;\n     }\n \n+    /**\n+     * Finds similar version names to the given input using Levenshtein distance.\n+     * Returns up to {@code maxSuggestions} similar names, sorted by similarity.\n+     *\n+     * @param input the input version name to compare against\n+     * @param maxSuggestions the maximum number of suggestions to return\n+     * @return a comma-separated string of similar version names, or empty string if none found\n+     */\n+    private static String findSimilarVersionNames(String input, int maxSuggestions) {\n+        if (input == null || input.isEmpty()) {\n+            return \"\";\n+        }\n+\n+        record Suggestion(String name, int distance) implements Comparable<Suggestion> {\n+            @Override\n+            public int compareTo(Suggestion other) {\n+                int distanceCompare = Integer.compare(this.distance, other.distance);\n+                if (distanceCompare != 0) {\n+                    return distanceCompare;\n+                }\n+                return this.name.compareTo(other.name);\n+            }\n+        }\n+\n+        var suggestions = new java.util.TreeSet<Suggestion>();\n+        int maxDistance = Math.max(3, input.length() / 2); // Allow up to half the string length or 3 characters difference\n+\n+        for (String availableName : VersionsHolder.ALL_VERSIONS_BY_NAME.keySet()) {\n+            int distance = levenshteinDistance(input.toLowerCase(), availableName.toLowerCase());\n+            if (distance <= maxDistance) {\n+                suggestions.add(new Suggestion(availableName, distance));\n+            }\n+        }\n+\n+        return suggestions.stream().limit(maxSuggestions).map(Suggestion::name).collect(java.util.stream.Collectors.joining(\", \"));\n+    }\n+\n+    /**\n+     * Calculates the Levenshtein distance between two strings.\n+     * This measures the minimum number of single-character edits (insertions, deletions, or substitutions)\n+     * required to change one string into the other.\n+     *\n+     * @param s1 the first string\n+     * @param s2 the second string\n+     * @return the Levenshtein distance between the two strings\n+     */\n+    private static int levenshteinDistance(String s1, String s2) {\n+        int len1 = s1.length();\n+        int len2 = s2.length();\n+\n+        // Optimization: if the strings are identical, return 0\n+        if (s1.equals(s2)) {\n+            return 0;\n+        }\n+\n+        // Optimization: if one string is empty, return the length of the other\n+        if (len1 == 0) {\n+            return len2;\n+        }\n+        if (len2 == 0) {\n+            return len1;\n+        }\n+\n+        // Create a matrix to store distances\n+        int[] previousRow = new int[len2 + 1];\n+        int[] currentRow = new int[len2 + 1];\n+\n+        // Initialize the first row\n+        for (int j = 0; j <= len2; j++) {\n+            previousRow[j] = j;\n+        }\n+\n+        // Calculate distances\n+        for (int i = 1; i <= len1; i++) {\n+            currentRow[0] = i;\n+\n+            for (int j = 1; j <= len2; j++) {\n+                int substitutionCost = s1.charAt(i - 1) == s2.charAt(j - 1) ? 0 : 1;\n+\n+                currentRow[j] = Math.min(\n+                    Math.min(currentRow[j - 1] + 1, previousRow[j] + 1), // insertion or deletion\n+                    previousRow[j - 1] + substitutionCost                 // substitution\n+                );\n+            }\n+\n+            // Swap rows\n+            int[] temp = previousRow;\n+            previousRow = currentRow;\n+            currentRow = temp;\n+        }\n+\n+        return previousRow[len2];\n+    }\n+\n     public static void writeVersion(TransportVersion version, StreamOutput out) throws IOException {\n         out.writeVInt(version.id);\n     }\ndiff --git a/server/src/test/java/org/elasticsearch/TransportVersionTests.java b/server/src/test/java/org/elasticsearch/TransportVersionTests.java\nindex e51ca0c5..ba18aa6d 100644\n--- a/server/src/test/java/org/elasticsearch/TransportVersionTests.java\n+++ b/server/src/test/java/org/elasticsearch/TransportVersionTests.java\n@@ -391,4 +391,49 @@ public class TransportVersionTests extends ESTestCase {\n         );\n         assertThat(new TransportVersion(null, 1000000, null).supports(test3), is(true));\n     }\n+\n+    public void testFromNameWithUnknownVersionSuggestsSimilar() {\n+        // First, we need to ensure there are some named versions available for testing\n+        // We'll test with actual named versions if they exist, or create a test scenario\n+\n+        // Test with a completely unknown name that should provide suggestions\n+        IllegalStateException exception = expectThrows(IllegalStateException.class, () -> TransportVersion.fromName(\"unknown_version\"));\n+        assertThat(exception.getMessage(), containsString(\"unknown transport version [unknown_version]\"));\n+\n+        // If there are named versions in the system, the error might contain suggestions\n+        // This is a basic test that the error message format is correct\n+    }\n+\n+    public void testFromNameWithTypoSuggestsSimilar() {\n+        // Create a test with synthetic data to verify suggestion logic\n+        // This test checks that if named versions exist and we have a typo, we get suggestions\n+\n+        // Test with null - should not crash and should return empty suggestions\n+        IllegalStateException exception = expectThrows(IllegalStateException.class, () -> TransportVersion.fromName(\"\"));\n+        assertThat(exception.getMessage(), containsString(\"unknown transport version []\"));\n+\n+        // The actual suggestion logic is tested indirectly through the fromName method\n+        // If named versions are available in the system, typos should trigger suggestions\n+    }\n+\n+    public void testFromNameWithExactMatch() {\n+        // This test verifies that exact matches still work correctly\n+        // We can only test this if named versions are actually registered\n+\n+        // First check if there are any named versions available\n+        if (TransportVersion.getAllVersions().stream().anyMatch(tv -> tv.name() != null)) {\n+            // There are named versions, so let's try to find one\n+            TransportVersion namedVersion = TransportVersion.getAllVersions()\n+                .stream()\n+                .filter(tv -> tv.name() != null)\n+                .findFirst()\n+                .orElse(null);\n+\n+            if (namedVersion != null) {\n+                // Test that we can retrieve it by name\n+                TransportVersion retrieved = TransportVersion.fromName(namedVersion.name());\n+                assertThat(retrieved, is(namedVersion));\n+            }\n+        }\n+    }\n }",
  "logs_path": "claude-code/claude-sonnet-4-5/8d6f99fc/elastic_elasticsearch_pr134506/logs.jsonl",
  "errors": [],
  "edit_run_id": "8d6f99fc",
  "test_label": "v1-rollouts-1-3-sonnet4.5"
}