{
  "repo_url": "https://github.com/elastic/elasticsearch.git",
  "pr_number": 4229,
  "base_commit": "0ec3eaf53d470a309d3976c7f6798f578bd668d5",
  "runner": "claude-code",
  "model": "claude-sonnet-4-5",
  "timeout_s": 1800,
  "status": "success",
  "elapsed_ms": 248908,
  "patch_unified": "diff --git a/src/main/java/org/elasticsearch/action/admin/indices/mapping/put/PutMappingRequest.java b/src/main/java/org/elasticsearch/action/admin/indices/mapping/put/PutMappingRequest.java\nindex 9eb3352..8f786f7 100644\n--- a/src/main/java/org/elasticsearch/action/admin/indices/mapping/put/PutMappingRequest.java\n+++ b/src/main/java/org/elasticsearch/action/admin/indices/mapping/put/PutMappingRequest.java\n@@ -23,7 +23,7 @@ import com.carrotsearch.hppc.ObjectOpenHashSet;\n import org.elasticsearch.ElasticSearchGenerationException;\n import org.elasticsearch.ElasticSearchIllegalArgumentException;\n import org.elasticsearch.action.ActionRequestValidationException;\n-import org.elasticsearch.action.support.master.MasterNodeOperationRequest;\n+import org.elasticsearch.action.support.master.AcknowledgedRequest;\n import org.elasticsearch.common.Strings;\n import org.elasticsearch.common.io.stream.StreamInput;\n import org.elasticsearch.common.io.stream.StreamOutput;\n@@ -34,10 +34,8 @@ import org.elasticsearch.common.xcontent.XContentType;\n \n import java.io.IOException;\n import java.util.Map;\n-import java.util.concurrent.TimeUnit;\n \n import static org.elasticsearch.action.ValidateActions.addValidationError;\n-import static org.elasticsearch.common.unit.TimeValue.readTimeValue;\n \n /**\n  * Puts mapping definition registered under a specific type into one or more indices. Best created with\n@@ -51,7 +49,7 @@ import static org.elasticsearch.common.unit.TimeValue.readTimeValue;\n  * @see org.elasticsearch.client.IndicesAdminClient#putMapping(PutMappingRequest)\n  * @see PutMappingResponse\n  */\n-public class PutMappingRequest extends MasterNodeOperationRequest<PutMappingRequest> {\n+public class PutMappingRequest extends AcknowledgedRequest<PutMappingRequest> {\n \n     private static ObjectOpenHashSet<String> RESERVED_FIELDS = ObjectOpenHashSet.from(\n             \"_uid\", \"_id\", \"_type\", \"_source\",  \"_all\", \"_analyzer\", \"_boost\", \"_parent\", \"_routing\", \"_index\",\n@@ -64,8 +62,6 @@ public class PutMappingRequest extends MasterNodeOperationRequest<PutMappingRequ\n \n     private String source;\n \n-    private TimeValue timeout = new TimeValue(10, TimeUnit.SECONDS);\n-\n     private boolean ignoreConflicts = false;\n \n     PutMappingRequest() {\n@@ -224,30 +220,6 @@ public class PutMappingRequest extends MasterNodeOperationRequest<PutMappingRequ\n         return this;\n     }\n \n-    /**\n-     * Timeout to wait till the put mapping gets acknowledged of all current cluster nodes. Defaults to\n-     * <tt>10s</tt>.\n-     */\n-    TimeValue timeout() {\n-        return timeout;\n-    }\n-\n-    /**\n-     * Timeout to wait till the put mapping gets acknowledged of all current cluster nodes. Defaults to\n-     * <tt>10s</tt>.\n-     */\n-    public PutMappingRequest timeout(TimeValue timeout) {\n-        this.timeout = timeout;\n-        return this;\n-    }\n-\n-    /**\n-     * Timeout to wait till the put mapping gets acknowledged of all current cluster nodes. Defaults to\n-     * <tt>10s</tt>.\n-     */\n-    public PutMappingRequest timeout(String timeout) {\n-        return timeout(TimeValue.parseTimeValue(timeout, null));\n-    }\n \n     /**\n      * If there is already a mapping definition registered against the type, then it will be merged. If there are\n@@ -274,7 +246,7 @@ public class PutMappingRequest extends MasterNodeOperationRequest<PutMappingRequ\n         indices = in.readStringArray();\n         type = in.readOptionalString();\n         source = in.readString();\n-        timeout = readTimeValue(in);\n+        readTimeout(in);\n         ignoreConflicts = in.readBoolean();\n     }\n \n@@ -284,7 +256,7 @@ public class PutMappingRequest extends MasterNodeOperationRequest<PutMappingRequ\n         out.writeStringArrayNullable(indices);\n         out.writeOptionalString(type);\n         out.writeString(source);\n-        timeout.writeTo(out);\n+        writeTimeout(out);\n         out.writeBoolean(ignoreConflicts);\n     }\n }\ndiff --git a/src/main/java/org/elasticsearch/action/admin/indices/mapping/put/PutMappingRequestBuilder.java b/src/main/java/org/elasticsearch/action/admin/indices/mapping/put/PutMappingRequestBuilder.java\nindex e93ca84..592e87c 100644\n--- a/src/main/java/org/elasticsearch/action/admin/indices/mapping/put/PutMappingRequestBuilder.java\n+++ b/src/main/java/org/elasticsearch/action/admin/indices/mapping/put/PutMappingRequestBuilder.java\n@@ -20,10 +20,9 @@\n package org.elasticsearch.action.admin.indices.mapping.put;\n \n import org.elasticsearch.action.ActionListener;\n-import org.elasticsearch.action.support.master.MasterNodeOperationRequestBuilder;\n+import org.elasticsearch.action.support.master.AcknowledgedRequestBuilder;\n import org.elasticsearch.client.IndicesAdminClient;\n import org.elasticsearch.client.internal.InternalIndicesAdminClient;\n-import org.elasticsearch.common.unit.TimeValue;\n import org.elasticsearch.common.xcontent.XContentBuilder;\n \n import java.util.Map;\n@@ -31,7 +30,7 @@ import java.util.Map;\n /**\n  *\n  */\n-public class PutMappingRequestBuilder extends MasterNodeOperationRequestBuilder<PutMappingRequest, PutMappingResponse, PutMappingRequestBuilder> {\n+public class PutMappingRequestBuilder extends AcknowledgedRequestBuilder<PutMappingRequest, PutMappingResponse, PutMappingRequestBuilder> {\n \n     public PutMappingRequestBuilder(IndicesAdminClient indicesClient) {\n         super((InternalIndicesAdminClient) indicesClient, new PutMappingRequest());\n@@ -83,24 +82,6 @@ public class PutMappingRequestBuilder extends MasterNodeOperationRequestBuilder<\n         return this;\n     }\n \n-    /**\n-     * Timeout to wait till the put mapping gets acknowledged of all current cluster nodes. Defaults to\n-     * <tt>10s</tt>.\n-     */\n-    public PutMappingRequestBuilder setTimeout(TimeValue timeout) {\n-        request.timeout(timeout);\n-        return this;\n-    }\n-\n-    /**\n-     * Timeout to wait till the put mapping gets acknowledged of all current cluster nodes. Defaults to\n-     * <tt>10s</tt>.\n-     */\n-    public PutMappingRequestBuilder setTimeout(String timeout) {\n-        request.timeout(timeout);\n-        return this;\n-    }\n-\n     /**\n      * If there is already a mapping definition registered against the type, then it will be merged. If there are\n      * elements that can't be merged are detected, the request will be rejected unless the\ndiff --git a/src/main/java/org/elasticsearch/action/admin/indices/mapping/put/PutMappingResponse.java b/src/main/java/org/elasticsearch/action/admin/indices/mapping/put/PutMappingResponse.java\nindex 58edc44..3316086 100644\n--- a/src/main/java/org/elasticsearch/action/admin/indices/mapping/put/PutMappingResponse.java\n+++ b/src/main/java/org/elasticsearch/action/admin/indices/mapping/put/PutMappingResponse.java\n@@ -19,7 +19,7 @@\n \n package org.elasticsearch.action.admin.indices.mapping.put;\n \n-import org.elasticsearch.action.ActionResponse;\n+import org.elasticsearch.action.support.master.AcknowledgedResponse;\n import org.elasticsearch.common.io.stream.StreamInput;\n import org.elasticsearch.common.io.stream.StreamOutput;\n \n@@ -28,35 +28,25 @@ import java.io.IOException;\n /**\n  * The response of put mapping operation.\n  */\n-public class PutMappingResponse extends ActionResponse {\n-\n-    private boolean acknowledged;\n+public class PutMappingResponse extends AcknowledgedResponse {\n \n     PutMappingResponse() {\n \n     }\n \n     PutMappingResponse(boolean acknowledged) {\n-        this.acknowledged = acknowledged;\n-    }\n-\n-    /**\n-     * Has the put mapping creation been acknowledged by all current cluster nodes within the\n-     * provided {@link PutMappingRequest#timeout(org.elasticsearch.common.unit.TimeValue)}.\n-     */\n-    public boolean isAcknowledged() {\n-        return acknowledged;\n+        super(acknowledged);\n     }\n \n     @Override\n     public void readFrom(StreamInput in) throws IOException {\n         super.readFrom(in);\n-        acknowledged = in.readBoolean();\n+        readAcknowledged(in);\n     }\n \n     @Override\n     public void writeTo(StreamOutput out) throws IOException {\n         super.writeTo(out);\n-        out.writeBoolean(acknowledged);\n+        writeAcknowledged(out);\n     }\n }\ndiff --git a/src/main/java/org/elasticsearch/rest/action/admin/indices/mapping/put/RestPutMappingAction.java b/src/main/java/org/elasticsearch/rest/action/admin/indices/mapping/put/RestPutMappingAction.java\nindex bd05b43..bd53efe 100644\n--- a/src/main/java/org/elasticsearch/rest/action/admin/indices/mapping/put/RestPutMappingAction.java\n+++ b/src/main/java/org/elasticsearch/rest/action/admin/indices/mapping/put/RestPutMappingAction.java\n@@ -19,24 +19,18 @@\n \n package org.elasticsearch.rest.action.admin.indices.mapping.put;\n \n-import org.elasticsearch.action.ActionListener;\n import org.elasticsearch.action.admin.indices.mapping.put.PutMappingRequest;\n import org.elasticsearch.action.admin.indices.mapping.put.PutMappingResponse;\n import org.elasticsearch.client.Client;\n import org.elasticsearch.common.Strings;\n import org.elasticsearch.common.inject.Inject;\n import org.elasticsearch.common.settings.Settings;\n-import org.elasticsearch.common.xcontent.XContentBuilder;\n import org.elasticsearch.rest.*;\n-import org.elasticsearch.rest.action.support.RestXContentBuilder;\n-\n-import java.io.IOException;\n \n import static org.elasticsearch.client.Requests.putMappingRequest;\n import static org.elasticsearch.common.unit.TimeValue.timeValueSeconds;\n import static org.elasticsearch.rest.RestRequest.Method.POST;\n import static org.elasticsearch.rest.RestRequest.Method.PUT;\n-import static org.elasticsearch.rest.RestStatus.OK;\n \n /**\n  *\n@@ -62,29 +56,6 @@ public class RestPutMappingAction extends BaseRestHandler {\n         putMappingRequest.timeout(request.paramAsTime(\"timeout\", timeValueSeconds(10)));\n         putMappingRequest.ignoreConflicts(request.paramAsBoolean(\"ignore_conflicts\", putMappingRequest.ignoreConflicts()));\n         putMappingRequest.masterNodeTimeout(request.paramAsTime(\"master_timeout\", putMappingRequest.masterNodeTimeout()));\n-        client.admin().indices().putMapping(putMappingRequest, new ActionListener<PutMappingResponse>() {\n-            @Override\n-            public void onResponse(PutMappingResponse response) {\n-                try {\n-                    XContentBuilder builder = RestXContentBuilder.restContentBuilder(request);\n-                    builder.startObject()\n-                            .field(\"ok\", true)\n-                            .field(\"acknowledged\", response.isAcknowledged());\n-                    builder.endObject();\n-                    channel.sendResponse(new XContentRestResponse(request, OK, builder));\n-                } catch (IOException e) {\n-                    onFailure(e);\n-                }\n-            }\n-\n-            @Override\n-            public void onFailure(Throwable e) {\n-                try {\n-                    channel.sendResponse(new XContentThrowableRestResponse(request, e));\n-                } catch (IOException e1) {\n-                    logger.error(\"Failed to send failure response\", e1);\n-                }\n-            }\n-        });\n+        client.admin().indices().putMapping(putMappingRequest, new AcknowledgedRestResponseActionListener<PutMappingResponse>(request, channel, logger));\n     }\n }",
  "logs_path": "claude-code/claude-sonnet-4-5/8d6f99fc/elastic_elasticsearch_pr4229/logs.jsonl",
  "errors": [],
  "edit_run_id": "8d6f99fc",
  "test_label": "v1-rollouts-1-3-sonnet4.5"
}