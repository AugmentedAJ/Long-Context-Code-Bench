{
  "repo_url": "https://github.com/elastic/elasticsearch.git",
  "pr_number": 4122,
  "base_commit": "6f286c338207f2a333294e9e576d0f1319981148",
  "runner": "claude-code",
  "model": "claude-sonnet-4-5",
  "timeout_s": 1800,
  "status": "success",
  "elapsed_ms": 184923,
  "patch_unified": "diff --git a/src/main/java/org/elasticsearch/search/highlight/PostingsHighlighter.java b/src/main/java/org/elasticsearch/search/highlight/PostingsHighlighter.java\nindex 796cf88..a626ca8 100644\n--- a/src/main/java/org/elasticsearch/search/highlight/PostingsHighlighter.java\n+++ b/src/main/java/org/elasticsearch/search/highlight/PostingsHighlighter.java\n@@ -36,6 +36,9 @@ import org.apache.lucene.util.CollectionUtil;\n import org.apache.lucene.util.UnicodeUtil;\n import org.elasticsearch.ElasticSearchIllegalArgumentException;\n import org.elasticsearch.common.Strings;\n+import org.elasticsearch.common.lucene.search.XFilteredQuery;\n+import org.elasticsearch.common.lucene.search.function.FiltersFunctionScoreQuery;\n+import org.elasticsearch.common.lucene.search.function.FunctionScoreQuery;\n import org.elasticsearch.common.text.StringText;\n import org.elasticsearch.index.mapper.FieldMapper;\n import org.elasticsearch.search.fetch.FetchPhaseExecutionException;\n@@ -190,11 +193,29 @@ public class PostingsHighlighter implements Highlighter {\n     }\n \n     private static SortedSet<Term> extractTerms(Query query) {\n+        // Unwrap wrapper queries to get to the actual query\n+        query = unwrapQuery(query);\n         SortedSet<Term> queryTerms = new TreeSet<Term>();\n         query.extractTerms(queryTerms);\n         return queryTerms;\n     }\n \n+    private static Query unwrapQuery(Query query) {\n+        // Recursively unwrap queries that don't properly delegate extractTerms\n+        while (true) {\n+            if (query instanceof FunctionScoreQuery) {\n+                query = ((FunctionScoreQuery) query).getSubQuery();\n+            } else if (query instanceof FiltersFunctionScoreQuery) {\n+                query = ((FiltersFunctionScoreQuery) query).getSubQuery();\n+            } else if (query instanceof XFilteredQuery) {\n+                query = ((XFilteredQuery) query).getQuery();\n+            } else {\n+                break;\n+            }\n+        }\n+        return query;\n+    }\n+\n     private static BytesRef[] filterTerms(SortedSet<Term> queryTerms, String field, boolean requireFieldMatch) {\n         SortedSet<Term> fieldTerms;\n         if (requireFieldMatch) {",
  "logs_path": "claude-code/claude-sonnet-4-5/8d6f99fc/elastic_elasticsearch_pr4122/logs.jsonl",
  "errors": [],
  "edit_run_id": "8d6f99fc",
  "test_label": "v1-rollouts-1-3-sonnet4.5"
}