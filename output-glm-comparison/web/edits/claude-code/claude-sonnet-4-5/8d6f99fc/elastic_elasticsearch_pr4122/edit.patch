diff --git a/src/main/java/org/elasticsearch/search/highlight/PostingsHighlighter.java b/src/main/java/org/elasticsearch/search/highlight/PostingsHighlighter.java
index 796cf88..a626ca8 100644
--- a/src/main/java/org/elasticsearch/search/highlight/PostingsHighlighter.java
+++ b/src/main/java/org/elasticsearch/search/highlight/PostingsHighlighter.java
@@ -36,6 +36,9 @@ import org.apache.lucene.util.CollectionUtil;
 import org.apache.lucene.util.UnicodeUtil;
 import org.elasticsearch.ElasticSearchIllegalArgumentException;
 import org.elasticsearch.common.Strings;
+import org.elasticsearch.common.lucene.search.XFilteredQuery;
+import org.elasticsearch.common.lucene.search.function.FiltersFunctionScoreQuery;
+import org.elasticsearch.common.lucene.search.function.FunctionScoreQuery;
 import org.elasticsearch.common.text.StringText;
 import org.elasticsearch.index.mapper.FieldMapper;
 import org.elasticsearch.search.fetch.FetchPhaseExecutionException;
@@ -190,11 +193,29 @@ public class PostingsHighlighter implements Highlighter {
     }
 
     private static SortedSet<Term> extractTerms(Query query) {
+        // Unwrap wrapper queries to get to the actual query
+        query = unwrapQuery(query);
         SortedSet<Term> queryTerms = new TreeSet<Term>();
         query.extractTerms(queryTerms);
         return queryTerms;
     }
 
+    private static Query unwrapQuery(Query query) {
+        // Recursively unwrap queries that don't properly delegate extractTerms
+        while (true) {
+            if (query instanceof FunctionScoreQuery) {
+                query = ((FunctionScoreQuery) query).getSubQuery();
+            } else if (query instanceof FiltersFunctionScoreQuery) {
+                query = ((FiltersFunctionScoreQuery) query).getSubQuery();
+            } else if (query instanceof XFilteredQuery) {
+                query = ((XFilteredQuery) query).getQuery();
+            } else {
+                break;
+            }
+        }
+        return query;
+    }
+
     private static BytesRef[] filterTerms(SortedSet<Term> queryTerms, String field, boolean requireFieldMatch) {
         SortedSet<Term> fieldTerms;
         if (requireFieldMatch) {