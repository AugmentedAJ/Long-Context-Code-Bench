{
  "repo_url": "https://github.com/elastic/elasticsearch.git",
  "pr_number": 1609,
  "base_commit": "0530115f62fc2128196fc0f3e39af4d4d1a2aea5",
  "runner": "claude-code",
  "model": "claude-sonnet-4-5",
  "timeout_s": 1800,
  "status": "success",
  "elapsed_ms": 238993,
  "patch_unified": "diff --git a/src/main/java/org/elasticsearch/action/update/TransportUpdateAction.java b/src/main/java/org/elasticsearch/action/update/TransportUpdateAction.java\nindex ae9eea7..8c18754 100644\n--- a/src/main/java/org/elasticsearch/action/update/TransportUpdateAction.java\n+++ b/src/main/java/org/elasticsearch/action/update/TransportUpdateAction.java\n@@ -208,20 +208,20 @@ public class TransportUpdateAction extends TransportInstanceSingleOperationActio\n             }\n         }\n \n-        // TODO percolate?\n-\n         // TODO: external version type, does it make sense here? does not seem like it...\n \n         if (operation == null || \"index\".equals(operation)) {\n             IndexRequest indexRequest = Requests.indexRequest(request.index()).type(request.type()).id(request.id()).routing(routing).parent(parent)\n                     .source(source, sourceAndContent.v1())\n                     .version(getResult.version()).replicationType(request.replicationType()).consistencyLevel(request.consistencyLevel())\n-                    .timestamp(timestamp).ttl(ttl);\n+                    .timestamp(timestamp).ttl(ttl)\n+                    .percolate(request.percolate());\n             indexRequest.operationThreaded(false);\n             indexAction.execute(indexRequest, new ActionListener<IndexResponse>() {\n                 @Override\n                 public void onResponse(IndexResponse response) {\n                     UpdateResponse update = new UpdateResponse(response.index(), response.type(), response.id(), response.version());\n+                    update.matches(response.matches());\n                     listener.onResponse(update);\n                 }\n \ndiff --git a/src/main/java/org/elasticsearch/action/update/UpdateRequest.java b/src/main/java/org/elasticsearch/action/update/UpdateRequest.java\nindex 05e39ce..792465c 100644\n--- a/src/main/java/org/elasticsearch/action/update/UpdateRequest.java\n+++ b/src/main/java/org/elasticsearch/action/update/UpdateRequest.java\n@@ -51,6 +51,8 @@ public class UpdateRequest extends InstanceShardOperationRequest {\n \n     int retryOnConflict = 0;\n \n+    private String percolate;\n+\n     private ReplicationType replicationType = ReplicationType.DEFAULT;\n     private WriteConsistencyLevel consistencyLevel = WriteConsistencyLevel.DEFAULT;\n \n@@ -239,6 +241,18 @@ public class UpdateRequest extends InstanceShardOperationRequest {\n         return this.retryOnConflict;\n     }\n \n+    /**\n+     * Percolate parameter. If set, will run percolation on the updated document.\n+     */\n+    public UpdateRequest percolate(String percolate) {\n+        this.percolate = percolate;\n+        return this;\n+    }\n+\n+    public String percolate() {\n+        return this.percolate;\n+    }\n+\n     /**\n      * A timeout to wait if the index operation can't be performed immediately. Defaults to <tt>1m</tt>.\n      */\n@@ -297,6 +311,9 @@ public class UpdateRequest extends InstanceShardOperationRequest {\n         }\n         scriptParams = in.readMap();\n         retryOnConflict = in.readVInt();\n+        if (in.readBoolean()) {\n+            percolate = in.readUTF();\n+        }\n     }\n \n     @Override\n@@ -321,5 +338,11 @@ public class UpdateRequest extends InstanceShardOperationRequest {\n         }\n         out.writeMap(scriptParams);\n         out.writeVInt(retryOnConflict);\n+        if (percolate == null) {\n+            out.writeBoolean(false);\n+        } else {\n+            out.writeBoolean(true);\n+            out.writeUTF(percolate);\n+        }\n     }\n }\ndiff --git a/src/main/java/org/elasticsearch/action/update/UpdateResponse.java b/src/main/java/org/elasticsearch/action/update/UpdateResponse.java\nindex f4a41dd..d7c973b 100644\n--- a/src/main/java/org/elasticsearch/action/update/UpdateResponse.java\n+++ b/src/main/java/org/elasticsearch/action/update/UpdateResponse.java\n@@ -24,6 +24,8 @@ import org.elasticsearch.common.io.stream.StreamInput;\n import org.elasticsearch.common.io.stream.StreamOutput;\n \n import java.io.IOException;\n+import java.util.ArrayList;\n+import java.util.List;\n \n /**\n  */\n@@ -37,6 +39,8 @@ public class UpdateResponse implements ActionResponse {\n \n     private long version;\n \n+    private List<String> matches;\n+\n     public UpdateResponse() {\n \n     }\n@@ -104,12 +108,40 @@ public class UpdateResponse implements ActionResponse {\n         return version();\n     }\n \n+    /**\n+     * The percolate queries that matched with the document.\n+     */\n+    public List<String> matches() {\n+        return this.matches;\n+    }\n+\n+    /**\n+     * The percolate queries that matched with the document.\n+     */\n+    public List<String> getMatches() {\n+        return this.matches;\n+    }\n+\n+    /**\n+     * The percolate queries that matched with the document.\n+     */\n+    public void matches(List<String> matches) {\n+        this.matches = matches;\n+    }\n+\n     @Override\n     public void readFrom(StreamInput in) throws IOException {\n         index = in.readUTF();\n         id = in.readUTF();\n         type = in.readUTF();\n         version = in.readLong();\n+        if (in.readBoolean()) {\n+            int size = in.readVInt();\n+            matches = new ArrayList<String>(size);\n+            for (int i = 0; i < size; i++) {\n+                matches.add(in.readUTF());\n+            }\n+        }\n     }\n \n     @Override\n@@ -118,5 +150,14 @@ public class UpdateResponse implements ActionResponse {\n         out.writeUTF(id);\n         out.writeUTF(type);\n         out.writeLong(version);\n+        if (matches == null) {\n+            out.writeBoolean(false);\n+        } else {\n+            out.writeBoolean(true);\n+            out.writeVInt(matches.size());\n+            for (String match : matches) {\n+                out.writeUTF(match);\n+            }\n+        }\n     }\n }\ndiff --git a/src/main/java/org/elasticsearch/rest/action/update/RestUpdateAction.java b/src/main/java/org/elasticsearch/rest/action/update/RestUpdateAction.java\nindex e6bef60..ac8ba98 100644\n--- a/src/main/java/org/elasticsearch/rest/action/update/RestUpdateAction.java\n+++ b/src/main/java/org/elasticsearch/rest/action/update/RestUpdateAction.java\n@@ -75,6 +75,7 @@ public class RestUpdateAction extends BaseRestHandler {\n             }\n         }\n         updateRequest.retryOnConflict(request.paramAsInt(\"retry_on_conflict\", updateRequest.retryOnConflict()));\n+        updateRequest.percolate(request.param(\"percolate\"));\n \n         // see if we have it in the body\n         if (request.hasContent()) {\n@@ -114,6 +115,13 @@ public class RestUpdateAction extends BaseRestHandler {\n                             .field(Fields._TYPE, response.type())\n                             .field(Fields._ID, response.id())\n                             .field(Fields._VERSION, response.version());\n+                    if (response.matches() != null) {\n+                        builder.startArray(Fields.MATCHES);\n+                        for (String match : response.matches()) {\n+                            builder.value(match);\n+                        }\n+                        builder.endArray();\n+                    }\n                     builder.endObject();\n                     RestStatus status = OK;\n                     if (response.version() == 1) {\n@@ -142,5 +150,6 @@ public class RestUpdateAction extends BaseRestHandler {\n         static final XContentBuilderString _TYPE = new XContentBuilderString(\"_type\");\n         static final XContentBuilderString _ID = new XContentBuilderString(\"_id\");\n         static final XContentBuilderString _VERSION = new XContentBuilderString(\"_version\");\n+        static final XContentBuilderString MATCHES = new XContentBuilderString(\"matches\");\n     }\n }",
  "logs_path": "claude-code/claude-sonnet-4-5/8d6f99fc/elastic_elasticsearch_pr1609/logs.jsonl",
  "errors": [],
  "edit_run_id": "8d6f99fc",
  "test_label": "v1-rollouts-1-3-sonnet4.5"
}