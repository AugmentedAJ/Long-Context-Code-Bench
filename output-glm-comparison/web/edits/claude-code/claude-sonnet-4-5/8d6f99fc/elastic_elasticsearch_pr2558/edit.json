{
  "repo_url": "https://github.com/elastic/elasticsearch.git",
  "pr_number": 2558,
  "base_commit": "2eb09e6b1abceb316c789f173988ac733a55dc8b",
  "runner": "claude-code",
  "model": "claude-sonnet-4-5",
  "timeout_s": 1800,
  "status": "success",
  "elapsed_ms": 122453,
  "patch_unified": "diff --git a/src/main/java/org/elasticsearch/cluster/routing/allocation/allocator/ShardsAllocatorModule.java b/src/main/java/org/elasticsearch/cluster/routing/allocation/allocator/ShardsAllocatorModule.java\nindex a3d8da2..871d1f0 100644\n--- a/src/main/java/org/elasticsearch/cluster/routing/allocation/allocator/ShardsAllocatorModule.java\n+++ b/src/main/java/org/elasticsearch/cluster/routing/allocation/allocator/ShardsAllocatorModule.java\n@@ -27,6 +27,8 @@ import org.elasticsearch.gateway.none.NoneGatewayAllocator;\n  */\n public class ShardsAllocatorModule extends AbstractModule {\n \n+    public static final String SHARDS_ALLOCATOR_TYPE_KEY = \"cluster.routing.allocation.type\";\n+\n     private Settings settings;\n \n     private Class<? extends ShardsAllocator> shardsAllocator;\n@@ -48,6 +50,23 @@ public class ShardsAllocatorModule extends AbstractModule {\n     @Override\n     protected void configure() {\n         bind(GatewayAllocator.class).to(gatewayAllocator).asEagerSingleton();\n-        bind(ShardsAllocator.class).to(shardsAllocator == null ? BalancedShardsAllocator.class : shardsAllocator).asEagerSingleton();\n+        bind(ShardsAllocator.class).to(shardsAllocator == null ? resolveShardsAllocator(settings) : shardsAllocator).asEagerSingleton();\n+    }\n+\n+    private Class<? extends ShardsAllocator> resolveShardsAllocator(Settings settings) {\n+        String allocatorType = settings.get(SHARDS_ALLOCATOR_TYPE_KEY, \"balanced\");\n+\n+        if (\"balanced\".equals(allocatorType)) {\n+            return BalancedShardsAllocator.class;\n+        } else if (\"even_shard\".equals(allocatorType)) {\n+            return EvenShardsCountAllocator.class;\n+        } else {\n+            // Try to resolve as a fully qualified class name\n+            try {\n+                return (Class<? extends ShardsAllocator>) settings.getAsClass(SHARDS_ALLOCATOR_TYPE_KEY, BalancedShardsAllocator.class, \"org.elasticsearch.cluster.routing.allocation.allocator.\", \"ShardsAllocator\");\n+            } catch (Exception e) {\n+                throw new IllegalArgumentException(\"Unknown ShardsAllocator type [\" + allocatorType + \"]\");\n+            }\n+        }\n     }\n }\ndiff --git a/src/main/java/org/elasticsearch/cluster/routing/allocation/allocator/ShardsAllocators.java b/src/main/java/org/elasticsearch/cluster/routing/allocation/allocator/ShardsAllocators.java\nindex 9efcf7e..70d23b2 100644\n--- a/src/main/java/org/elasticsearch/cluster/routing/allocation/allocator/ShardsAllocators.java\n+++ b/src/main/java/org/elasticsearch/cluster/routing/allocation/allocator/ShardsAllocators.java\n@@ -45,7 +45,30 @@ public class ShardsAllocators extends AbstractComponent implements ShardsAllocat\n     }\n \n     public ShardsAllocators(Settings settings) {\n-      this(settings, new NoneGatewayAllocator(), new BalancedShardsAllocator(settings));\n+      this(settings, new NoneGatewayAllocator(), createDefaultAllocator(settings));\n+    }\n+\n+    private static ShardsAllocator createDefaultAllocator(Settings settings) {\n+        String allocatorType = settings.get(ShardsAllocatorModule.SHARDS_ALLOCATOR_TYPE_KEY, \"balanced\");\n+\n+        if (\"balanced\".equals(allocatorType)) {\n+            return new BalancedShardsAllocator(settings);\n+        } else if (\"even_shard\".equals(allocatorType)) {\n+            return new EvenShardsCountAllocator(settings);\n+        } else {\n+            // Try to resolve as a fully qualified class name\n+            try {\n+                Class<? extends ShardsAllocator> allocatorClass = settings.getAsClass(\n+                    ShardsAllocatorModule.SHARDS_ALLOCATOR_TYPE_KEY,\n+                    BalancedShardsAllocator.class,\n+                    \"org.elasticsearch.cluster.routing.allocation.allocator.\",\n+                    \"ShardsAllocator\"\n+                );\n+                return allocatorClass.getConstructor(Settings.class).newInstance(settings);\n+            } catch (Exception e) {\n+                throw new IllegalArgumentException(\"Failed to create ShardsAllocator of type [\" + allocatorType + \"]\", e);\n+            }\n+        }\n     }\n \n     @Inject",
  "logs_path": "claude-code/claude-sonnet-4-5/8d6f99fc/elastic_elasticsearch_pr2558/logs.jsonl",
  "errors": [],
  "edit_run_id": "8d6f99fc",
  "test_label": "v1-rollouts-1-3-sonnet4.5"
}