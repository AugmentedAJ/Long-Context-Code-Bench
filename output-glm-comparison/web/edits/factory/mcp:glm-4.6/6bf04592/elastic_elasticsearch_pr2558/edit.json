{
  "repo_url": "https://github.com/elastic/elasticsearch.git",
  "pr_number": 2558,
  "base_commit": "2eb09e6b1abceb316c789f173988ac733a55dc8b",
  "runner": "factory",
  "model": "mcp:glm-4.6",
  "timeout_s": 1800,
  "status": "success",
  "elapsed_ms": 370317,
  "patch_unified": "diff --git a/pom.xml b/pom.xml\nindex a3053ca..884719f 100644\n--- a/pom.xml\n+++ b/pom.xml\n@@ -297,8 +297,8 @@\n                 <artifactId>maven-compiler-plugin</artifactId>\n                 <version>2.3.2</version>\n                 <configuration>\n-                    <source>1.6</source>\n-                    <target>1.6</target>\n+                    <source>1.7</source>\n+                    <target>1.7</target>\n                 </configuration>\n             </plugin>\n             <plugin>\ndiff --git a/src/main/java/org/elasticsearch/cluster/routing/allocation/allocator/ShardsAllocatorModule.java b/src/main/java/org/elasticsearch/cluster/routing/allocation/allocator/ShardsAllocatorModule.java\nindex a3d8da2..3834918 100644\n--- a/src/main/java/org/elasticsearch/cluster/routing/allocation/allocator/ShardsAllocatorModule.java\n+++ b/src/main/java/org/elasticsearch/cluster/routing/allocation/allocator/ShardsAllocatorModule.java\n@@ -27,6 +27,8 @@ import org.elasticsearch.gateway.none.NoneGatewayAllocator;\n  */\n public class ShardsAllocatorModule extends AbstractModule {\n \n+    public static final String SHARDS_ALLOCATOR_TYPE_SETTING = \"cluster.routing.allocation.type\";\n+\n     private Settings settings;\n \n     private Class<? extends ShardsAllocator> shardsAllocator;\n@@ -48,6 +50,29 @@ public class ShardsAllocatorModule extends AbstractModule {\n     @Override\n     protected void configure() {\n         bind(GatewayAllocator.class).to(gatewayAllocator).asEagerSingleton();\n-        bind(ShardsAllocator.class).to(shardsAllocator == null ? BalancedShardsAllocator.class : shardsAllocator).asEagerSingleton();\n+        \n+        // If a specific allocator was set via setShardsAllocator, use it\n+        // Otherwise, check settings for the allocator type\n+        // Default to BalancedShardsAllocator if not specified\n+        Class<? extends ShardsAllocator> allocatorClass = shardsAllocator;\n+        if (allocatorClass == null) {\n+            String allocatorType = settings.get(SHARDS_ALLOCATOR_TYPE_SETTING, \"balanced\");\n+            if (\"even_shard_count\".equalsIgnoreCase(allocatorType)) {\n+                allocatorClass = EvenShardsCountAllocator.class;\n+            } else if (\"balanced\".equalsIgnoreCase(allocatorType)) {\n+                allocatorClass = BalancedShardsAllocator.class;\n+            } else {\n+                // Try to load the class by name\n+                try {\n+                    allocatorClass = (Class<? extends ShardsAllocator>) Class.forName(allocatorType);\n+                } catch (ClassNotFoundException e) {\n+                    throw new IllegalArgumentException(\"Unknown shards allocator type [\" + allocatorType + \"]\", e);\n+                } catch (ClassCastException e) {\n+                    throw new IllegalArgumentException(\"Shards allocator type [\" + allocatorType + \"] is not a valid ShardsAllocator implementation\", e);\n+                }\n+            }\n+        }\n+        \n+        bind(ShardsAllocator.class).to(allocatorClass).asEagerSingleton();\n     }\n }",
  "logs_path": "factory/mcp:glm-4.6/6bf04592/elastic_elasticsearch_pr2558/logs.jsonl",
  "errors": [],
  "edit_run_id": "6bf04592",
  "test_label": "v1-mcp"
}