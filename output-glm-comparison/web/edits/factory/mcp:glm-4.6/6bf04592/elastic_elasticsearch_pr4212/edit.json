{
  "repo_url": "https://github.com/elastic/elasticsearch.git",
  "pr_number": 4212,
  "base_commit": "22852d8040df7c789e0cdbb32d33ef1e5cc76435",
  "runner": "factory",
  "model": "mcp:glm-4.6",
  "timeout_s": 1800,
  "status": "success",
  "elapsed_ms": 506611,
  "patch_unified": "diff --git a/src/main/java/org/elasticsearch/action/admin/cluster/repositories/delete/TransportDeleteRepositoryAction.java b/src/main/java/org/elasticsearch/action/admin/cluster/repositories/delete/TransportDeleteRepositoryAction.java\nindex 1245ec3..b35790a 100644\n--- a/src/main/java/org/elasticsearch/action/admin/cluster/repositories/delete/TransportDeleteRepositoryAction.java\n+++ b/src/main/java/org/elasticsearch/action/admin/cluster/repositories/delete/TransportDeleteRepositoryAction.java\n@@ -28,6 +28,8 @@ import org.elasticsearch.cluster.block.ClusterBlockException;\n import org.elasticsearch.cluster.block.ClusterBlockLevel;\n import org.elasticsearch.common.inject.Inject;\n import org.elasticsearch.common.settings.Settings;\n+import org.elasticsearch.repositories.RepositoryInUseException;\n+import org.elasticsearch.repositories.RepositoryValidator;\n import org.elasticsearch.repositories.RepositoriesService;\n import org.elasticsearch.threadpool.ThreadPool;\n import org.elasticsearch.transport.TransportService;\n@@ -73,6 +75,9 @@ public class TransportDeleteRepositoryAction extends TransportMasterNodeOperatio\n \n     @Override\n     protected void masterOperation(final DeleteRepositoryRequest request, ClusterState state, final ActionListener<DeleteRepositoryResponse> listener) throws ElasticSearchException {\n+        // Validate that the repository is not currently in use by snapshot or restore operations\n+        RepositoryValidator.validateRepositoryNotInUse(request.name(), state);\n+        \n         repositoriesService.unregisterRepository(\n                 new RepositoriesService.UnregisterRepositoryRequest(\"delete_repository [\" + request.name() + \"]\", request.name())\n                         .masterNodeTimeout(request.masterNodeTimeout()).ackTimeout(request.timeout()),\ndiff --git a/src/main/java/org/elasticsearch/action/admin/cluster/repositories/put/TransportPutRepositoryAction.java b/src/main/java/org/elasticsearch/action/admin/cluster/repositories/put/TransportPutRepositoryAction.java\nindex 1720ac6..c6e51e3 100644\n--- a/src/main/java/org/elasticsearch/action/admin/cluster/repositories/put/TransportPutRepositoryAction.java\n+++ b/src/main/java/org/elasticsearch/action/admin/cluster/repositories/put/TransportPutRepositoryAction.java\n@@ -26,8 +26,12 @@ import org.elasticsearch.cluster.ClusterService;\n import org.elasticsearch.cluster.ClusterState;\n import org.elasticsearch.cluster.block.ClusterBlockException;\n import org.elasticsearch.cluster.block.ClusterBlockLevel;\n+import org.elasticsearch.cluster.metadata.RepositoriesMetaData;\n+import org.elasticsearch.cluster.metadata.RepositoryMetaData;\n import org.elasticsearch.common.inject.Inject;\n import org.elasticsearch.common.settings.Settings;\n+import org.elasticsearch.repositories.RepositoryInUseException;\n+import org.elasticsearch.repositories.RepositoryValidator;\n import org.elasticsearch.repositories.RepositoriesService;\n import org.elasticsearch.threadpool.ThreadPool;\n import org.elasticsearch.transport.TransportService;\n@@ -73,6 +77,17 @@ public class TransportPutRepositoryAction extends TransportMasterNodeOperationAc\n \n     @Override\n     protected void masterOperation(final PutRepositoryRequest request, ClusterState state, final ActionListener<PutRepositoryResponse> listener) throws ElasticSearchException {\n+        // Validate that the repository is not currently in use by snapshot or restore operations\n+        // Only check if the repository already exists (modifying existing repository)\n+        if (state.metaData().custom(RepositoriesMetaData.TYPE) != null) {\n+            RepositoriesMetaData repositoriesMetaData = state.metaData().custom(RepositoriesMetaData.TYPE);\n+            for (RepositoryMetaData repositoryMetaData : repositoriesMetaData.repositories()) {\n+                if (repositoryMetaData.name().equals(request.name())) {\n+                    RepositoryValidator.validateRepositoryNotInUse(request.name(), state);\n+                    break;\n+                }\n+            }\n+        }\n \n         repositoriesService.registerRepository(new RepositoriesService.RegisterRepositoryRequest(\"put_repository [\" + request.name() + \"]\", request.name(), request.type())\n                 .settings(request.settings())",
  "logs_path": "factory/mcp:glm-4.6/6bf04592/elastic_elasticsearch_pr4212/logs.jsonl",
  "errors": [],
  "edit_run_id": "6bf04592",
  "test_label": "v1-mcp"
}