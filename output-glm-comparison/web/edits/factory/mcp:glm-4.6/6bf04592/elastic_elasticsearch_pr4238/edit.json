{
  "repo_url": "https://github.com/elastic/elasticsearch.git",
  "pr_number": 4238,
  "base_commit": "8e17d636ef441a9be80977d34acfaabc12982eb7",
  "runner": "factory",
  "model": "mcp:glm-4.6",
  "timeout_s": 1800,
  "status": "success",
  "elapsed_ms": 529813,
  "patch_unified": "diff --git a/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/ThrottlingAllocationDecider.java b/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/ThrottlingAllocationDecider.java\nindex 8af6d85..3f10018 100644\n--- a/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/ThrottlingAllocationDecider.java\n+++ b/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/ThrottlingAllocationDecider.java\n@@ -77,12 +77,16 @@ public class ThrottlingAllocationDecider extends AllocationDecider {\n             assert shardRouting.unassigned() || shardRouting.active();\n             if (shardRouting.unassigned()) {\n                 // primary is unassigned, means we are going to do recovery from gateway\n-                // count *just the primary* currently doing recovery on the node and check against concurrent_recoveries\n+                // count *just the primary* currently doing recovery from gateway on the node and check against concurrent_recoveries\n+                // Note: we exclude RELOCATING primaries and relocating target primaries since they are not recovering from gateway\n                 int primariesInRecovery = 0;\n                 List<MutableShardRouting> shards = node.shards();\n                 for (int i = 0; i < shards.size(); i++) {\n                     MutableShardRouting shard = shards.get(i);\n-                    if (shard.state() == ShardRoutingState.INITIALIZING && shard.primary()) {\n+                    // Only count primaries that are INITIALIZING (recovering from gateway)\n+                    // Exclude RELOCATING primaries and also exclude primaries that are targets of relocation\n+                    // (identified by having a relocatingNodeId) as they are not recovering from gateway\n+                    if (shard.state() == ShardRoutingState.INITIALIZING && shard.primary() && shard.relocatingNodeId() == null) {\n                         primariesInRecovery++;\n                     }\n                 }",
  "logs_path": "factory/mcp:glm-4.6/6bf04592/elastic_elasticsearch_pr4238/logs.jsonl",
  "errors": [],
  "edit_run_id": "6bf04592",
  "test_label": "v1-mcp"
}