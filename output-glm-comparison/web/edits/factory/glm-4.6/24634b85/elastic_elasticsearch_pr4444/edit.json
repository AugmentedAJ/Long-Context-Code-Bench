{
  "repo_url": "https://github.com/elastic/elasticsearch.git",
  "pr_number": 4444,
  "base_commit": "8f85d63b679b4996a2eeadba0af65caeb97e047d",
  "runner": "factory",
  "model": "glm-4.6",
  "timeout_s": 1800,
  "status": "success",
  "elapsed_ms": 139319,
  "patch_unified": "diff --git a/src/main/java/org/elasticsearch/common/util/concurrent/EsThreadPoolExecutor.java b/src/main/java/org/elasticsearch/common/util/concurrent/EsThreadPoolExecutor.java\nindex 86301ec..ea86ce6 100644\n--- a/src/main/java/org/elasticsearch/common/util/concurrent/EsThreadPoolExecutor.java\n+++ b/src/main/java/org/elasticsearch/common/util/concurrent/EsThreadPoolExecutor.java\n@@ -44,15 +44,35 @@ public class EsThreadPoolExecutor extends ThreadPoolExecutor {\n     }\n \n     public void shutdown(ShutdownListener listener) {\n+        // Check and set listener without holding monitor to avoid deadlock\n+        // where shutdown() acquires mainLock while terminated() tries to get monitor\n+        if (listener == null) {\n+            throw new IllegalArgumentException(\"listener cannot be null\");\n+        }\n+        \n         synchronized (monitor) {\n             if (this.listener != null) {\n                 throw new ElasticSearchIllegalStateException(\"Shutdown was already called on this thread pool\");\n             }\n-            if (isTerminated()) {\n-                listener.onTerminated();\n-            } else {\n+            if (!isTerminated()) {\n                 this.listener = listener;\n             }\n+        }\n+        \n+        // Call shutdown outside the synchronized block to avoid deadlock\n+        if (isTerminated()) {\n+            // If already terminated, call listener directly\n+            synchronized (monitor) {\n+                // Double-check in case another thread terminated while we were not synchronized\n+                if (this.listener != null) {\n+                    try {\n+                        listener.onTerminated();\n+                    } finally {\n+                        this.listener = null;\n+                    }\n+                }\n+            }\n+        } else {\n             shutdown();\n         }\n     }",
  "logs_path": "factory/glm-4.6/24634b85/elastic_elasticsearch_pr4444/logs.jsonl",
  "errors": [],
  "edit_run_id": "24634b85",
  "test_label": null
}