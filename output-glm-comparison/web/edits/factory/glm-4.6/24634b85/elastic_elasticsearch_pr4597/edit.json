{
  "repo_url": "https://github.com/elastic/elasticsearch.git",
  "pr_number": 4597,
  "base_commit": "2a73cf4f823e113926232864b8c7468f9103f88a",
  "runner": "factory",
  "model": "glm-4.6",
  "timeout_s": 1800,
  "status": "success",
  "elapsed_ms": 65936,
  "patch_unified": "diff --git a/src/main/java/org/elasticsearch/common/geo/GeoDistance.java b/src/main/java/org/elasticsearch/common/geo/GeoDistance.java\nindex 6e49621..e133913 100644\n--- a/src/main/java/org/elasticsearch/common/geo/GeoDistance.java\n+++ b/src/main/java/org/elasticsearch/common/geo/GeoDistance.java\n@@ -79,18 +79,23 @@ public enum GeoDistance {\n     ARC() {\n         @Override\n         public double calculate(double sourceLatitude, double sourceLongitude, double targetLatitude, double targetLongitude, DistanceUnit unit) {\n-            double longitudeDifference = targetLongitude - sourceLongitude;\n-            double a = Math.toRadians(90D - sourceLatitude);\n-            double c = Math.toRadians(90D - targetLatitude);\n-            double factor = (Math.cos(a) * Math.cos(c)) + (Math.sin(a) * Math.sin(c) * Math.cos(Math.toRadians(longitudeDifference)));\n-\n-            if (factor < -1D) {\n-                return unit.fromMeters(Math.PI * GeoUtils.EARTH_MEAN_RADIUS);\n-            } else if (factor >= 1D) {\n-                return 0;\n-            } else {\n-                return unit.fromMeters(Math.acos(factor) * GeoUtils.EARTH_MEAN_RADIUS);\n-            }\n+            // Convert to radians\n+            double sourceLatRad = Math.toRadians(sourceLatitude);\n+            double sourceLonRad = Math.toRadians(sourceLongitude);\n+            double targetLatRad = Math.toRadians(targetLatitude);\n+            double targetLonRad = Math.toRadians(targetLongitude);\n+            \n+            // Haversine formula\n+            double deltaLatRad = targetLatRad - sourceLatRad;\n+            double deltaLonRad = targetLonRad - sourceLonRad;\n+            \n+            double a = Math.sin(deltaLatRad / 2) * Math.sin(deltaLatRad / 2) +\n+                       Math.cos(sourceLatRad) * Math.cos(targetLatRad) *\n+                       Math.sin(deltaLonRad / 2) * Math.sin(deltaLonRad / 2);\n+            \n+            double c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n+            \n+            return unit.fromMeters(c * GeoUtils.EARTH_MEAN_RADIUS);\n         }\n \n         @Override",
  "logs_path": "factory/glm-4.6/24634b85/elastic_elasticsearch_pr4597/logs.jsonl",
  "errors": [],
  "edit_run_id": "24634b85",
  "test_label": null
}