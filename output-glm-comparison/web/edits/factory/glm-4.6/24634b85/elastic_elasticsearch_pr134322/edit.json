{
  "repo_url": "https://github.com/elastic/elasticsearch.git",
  "pr_number": 134322,
  "base_commit": "6350fe4900f86dbbc6e21d2406e5eb0e49135ee7",
  "runner": "factory",
  "model": "glm-4.6",
  "timeout_s": 1800,
  "status": "success",
  "elapsed_ms": 214905,
  "patch_unified": "diff --git a/x-pack/plugin/esql/compute/src/main/java/org/elasticsearch/compute/lucene/LuceneTopNSourceOperator.java b/x-pack/plugin/esql/compute/src/main/java/org/elasticsearch/compute/lucene/LuceneTopNSourceOperator.java\nindex 1b16610b..76d147de 100644\n--- a/x-pack/plugin/esql/compute/src/main/java/org/elasticsearch/compute/lucene/LuceneTopNSourceOperator.java\n+++ b/x-pack/plugin/esql/compute/src/main/java/org/elasticsearch/compute/lucene/LuceneTopNSourceOperator.java\n@@ -425,67 +425,5 @@ public final class LuceneTopNSourceOperator extends LuceneOperator {\n         return new ScoringPerShardCollector(context, new TopFieldCollectorManager(sort, limit, null, 0).newCollector());\n     }\n \n-    private static int perDocMemoryUsage(SortField[] sorts) {\n-        int usage = FIELD_DOC_SIZE;\n-        for (SortField sort : sorts) {\n-            usage += perDocMemoryUsage(sort);\n-        }\n-        return usage;\n-    }\n-\n-    private static int perDocMemoryUsage(SortField sort) {\n-        if (sort.getType() == SortField.Type.CUSTOM) {\n-            return perDocMemoryUsageForCustom(sort);\n-        }\n-        return perDocMemoryUsageByType(sort, sort.getType());\n-\n-    }\n-\n-    private static int perDocMemoryUsageByType(SortField sort, SortField.Type type) {\n-        return switch (type) {\n-            case SCORE, DOC ->\n-                /* SCORE and DOC are always part of ScoreDoc/FieldDoc\n-                 * So they are in FIELD_DOC_SIZE already.\n-                 * And they can't be removed. */\n-                0;\n-            case DOUBLE, LONG ->\n-                // 8 for the long, 8 for the long copied to the topDoc.\n-                16;\n-            case INT, FLOAT ->\n-                // 4 for the int, 8 boxed object copied to topDoc.\n-                12;\n-            case STRING ->\n-                /* `keyword`-like fields. Compares ordinals when possible, otherwise\n-                 * the strings. Does a bunch of deduplication, but in the worst\n-                 * case we end up with the string itself, plus two BytesRefs. Let's\n-                 * presume short-ish strings. */\n-                1024;\n-            case STRING_VAL ->\n-                /* Other string fields. Compares the string itself. Let's assume two\n-                 * 2kb per string because they tend to be bigger than the keyword\n-                 * versions. */\n-                2048;\n-            case CUSTOM -> throw new IllegalArgumentException(\"unsupported type \" + sort.getClass() + \": \" + sort);\n-            case REWRITEABLE -> {\n-                assert false : \"rewriteable  \" + sort.getClass() + \": \" + sort;\n-                yield 2048;\n-            }\n-        };\n-    }\n-\n-    private static int perDocMemoryUsageForCustom(SortField sort) {\n-        return switch (sort) {\n-            case SortedNumericSortField f -> perDocMemoryUsageByType(f, f.getNumericType());\n-            case SortedSetSortField f -> perDocMemoryUsageByType(f, SortField.Type.STRING);\n-            default -> {\n-                if (sort.getClass().getName().equals(\"org.apache.lucene.document.LatLonPointSortField\")) {\n-                    yield perDocMemoryUsageByType(sort, SortField.Type.DOUBLE);\n-                }\n-                assert false : \"unknown type \" + sort.getClass() + \": \" + sort;\n-                yield 2048;\n-            }\n-        };\n-    }\n-\n     private static final int FIELD_DOC_SIZE = Math.toIntExact(RamUsageEstimator.shallowSizeOf(FieldDoc.class));\n }",
  "logs_path": "factory/glm-4.6/24634b85/elastic_elasticsearch_pr134322/logs.jsonl",
  "errors": [],
  "edit_run_id": "24634b85",
  "test_label": null
}