{
  "repo_url": "https://github.com/elastic/elasticsearch.git",
  "pr_number": 2715,
  "base_commit": "b03f3fcd6c504bfc8a5054a3e81c88930f38b5cd",
  "runner": "factory",
  "model": "glm-4.6",
  "timeout_s": 1800,
  "status": "success",
  "elapsed_ms": 69038,
  "patch_unified": "diff --git a/src/main/java/org/elasticsearch/index/mapper/internal/IdFieldMapper.java b/src/main/java/org/elasticsearch/index/mapper/internal/IdFieldMapper.java\nindex 3391561..422b50d 100644\n--- a/src/main/java/org/elasticsearch/index/mapper/internal/IdFieldMapper.java\n+++ b/src/main/java/org/elasticsearch/index/mapper/internal/IdFieldMapper.java\n@@ -295,24 +295,36 @@ public class IdFieldMapper extends AbstractFieldMapper<String> implements Intern\n     @Override\n     protected Field parseCreateField(ParseContext context) throws IOException {\n         XContentParser parser = context.parser();\n-        if (parser.currentName() != null && parser.currentName().equals(Defaults.NAME) && parser.currentToken().isValue()) {\n-            // we are in the parse Phase\n-            String id = parser.text();\n-            if (context.id() != null && !context.id().equals(id)) {\n-                throw new MapperParsingException(\"Provided id [\" + context.id() + \"] does not match the content one [\" + id + \"]\");\n+        if (parser.currentName() != null && parser.currentName().equals(Defaults.NAME)) {\n+            XContentParser.Token token = parser.currentToken();\n+            \n+            // Check if the id token is an array or object\n+            if (token == XContentParser.Token.START_ARRAY) {\n+                throw new MapperParsingException(\"Id field cannot be an array, found [\" + token + \"]\");\n             }\n-            context.id(id);\n-            if (!fieldType.indexed() && !fieldType.stored()) {\n-                return null;\n+            if (token == XContentParser.Token.START_OBJECT) {\n+                throw new MapperParsingException(\"Id field cannot be an object, found [\" + token + \"]\");\n             }\n-            return new Field(names.indexName(), context.id(), fieldType);\n-        } else {\n-            // we are in the pre/post parse phase\n-            if (!fieldType.indexed() && !fieldType.stored()) {\n-                return null;\n+            \n+            if (token.isValue()) {\n+                // we are in the parse Phase\n+                String id = parser.text();\n+                if (context.id() != null && !context.id().equals(id)) {\n+                    throw new MapperParsingException(\"Provided id [\" + context.id() + \"] does not match the content one [\" + id + \"]\");\n+                }\n+                context.id(id);\n+                if (!fieldType.indexed() && !fieldType.stored()) {\n+                    return null;\n+                }\n+                return new Field(names.indexName(), context.id(), fieldType);\n             }\n-            return new Field(names.indexName(), context.id(), fieldType);\n         }\n+        \n+        // we are in the pre/post parse phase\n+        if (!fieldType.indexed() && !fieldType.stored()) {\n+            return null;\n+        }\n+        return new Field(names.indexName(), context.id(), fieldType);\n     }\n \n     @Override\ndiff --git a/src/test/java/org/elasticsearch/test/unit/index/mapper/id/IdMappingTests.java b/src/test/java/org/elasticsearch/test/unit/index/mapper/id/IdMappingTests.java\nindex 34e1846..a7ef8ec 100644\n--- a/src/test/java/org/elasticsearch/test/unit/index/mapper/id/IdMappingTests.java\n+++ b/src/test/java/org/elasticsearch/test/unit/index/mapper/id/IdMappingTests.java\n@@ -115,4 +115,42 @@ public class IdMappingTests {\n \n         assertThat(serialized_id_mapping, equalTo(expected_id_mapping));\n     }\n+\n+    @Test\n+    public void testIdAsArrayShouldThrowException() throws Exception {\n+        String mapping = XContentFactory.jsonBuilder().startObject().startObject(\"type\")\n+                .endObject().endObject().string();\n+        DocumentMapper docMapper = MapperTests.newParser().parse(mapping);\n+\n+        try {\n+            docMapper.parse(\"type\", null, XContentFactory.jsonBuilder()\n+                    .startObject()\n+                    .field(\"_id\", new String[]{\"1\", \"2\"})\n+                    .endObject()\n+                    .bytes());\n+            assert false : \"Expected MapperParsingException for array id\";\n+        } catch (MapperParsingException e) {\n+            assertThat(e.getMessage(), containsString(\"Id field cannot be an array\"));\n+        }\n+    }\n+\n+    @Test\n+    public void testIdAsObjectShouldThrowException() throws Exception {\n+        String mapping = XContentFactory.jsonBuilder().startObject().startObject(\"type\")\n+                .endObject().endObject().string();\n+        DocumentMapper docMapper = MapperTests.newParser().parse(mapping);\n+\n+        try {\n+            docMapper.parse(\"type\", null, XContentFactory.jsonBuilder()\n+                    .startObject()\n+                    .startObject(\"_id\")\n+                    .field(\"nested\", \"value\")\n+                    .endObject()\n+                    .endObject()\n+                    .bytes());\n+            assert false : \"Expected MapperParsingException for object id\";\n+        } catch (MapperParsingException e) {\n+            assertThat(e.getMessage(), containsString(\"Id field cannot be an object\"));\n+        }\n+    }\n }",
  "logs_path": "factory/glm-4.6/24634b85/elastic_elasticsearch_pr2715/logs.jsonl",
  "errors": [],
  "edit_run_id": "24634b85",
  "test_label": null
}