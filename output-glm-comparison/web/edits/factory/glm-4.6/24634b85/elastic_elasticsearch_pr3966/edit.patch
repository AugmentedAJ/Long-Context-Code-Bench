diff --git a/src/main/java/org/elasticsearch/index/analysis/AnalysisService.java b/src/main/java/org/elasticsearch/index/analysis/AnalysisService.java
index 7698020..f868392 100644
--- a/src/main/java/org/elasticsearch/index/analysis/AnalysisService.java
+++ b/src/main/java/org/elasticsearch/index/analysis/AnalysisService.java
@@ -189,12 +189,26 @@ public class AnalysisService extends AbstractIndexComponent implements Closeable
             for (Map.Entry<String, PreBuiltAnalyzerProviderFactory> entry : indicesAnalysisService.analyzerProviderFactories().entrySet()) {
                 String name = entry.getKey();
                 if (!analyzerProviders.containsKey(name)) {
-                    analyzerProviders.put(name, entry.getValue().create(name, ImmutableSettings.Builder.EMPTY_SETTINGS));
+                    PreBuiltAnalyzerProviderFactory factory = entry.getValue();
+                    // Try version-aware creation first
+                    try {
+                        analyzerProviders.put(name, factory.create(index, indexSettings, name));
+                    } catch (UnsupportedOperationException e) {
+                        // Fall back to legacy creation for backward compatibility
+                        analyzerProviders.put(name, factory.create(name, ImmutableSettings.Builder.EMPTY_SETTINGS));
+                    }
                 }
                 name = Strings.toCamelCase(entry.getKey());
                 if (!name.equals(entry.getKey())) {
                     if (!analyzerProviders.containsKey(name)) {
-                        analyzerProviders.put(name, entry.getValue().create(name, ImmutableSettings.Builder.EMPTY_SETTINGS));
+                        PreBuiltAnalyzerProviderFactory factory = entry.getValue();
+                        // Try version-aware creation first
+                        try {
+                            analyzerProviders.put(name, factory.create(index, indexSettings, name));
+                        } catch (UnsupportedOperationException e) {
+                            // Fall back to legacy creation for backward compatibility
+                            analyzerProviders.put(name, factory.create(name, ImmutableSettings.Builder.EMPTY_SETTINGS));
+                        }
                     }
                 }
             }
diff --git a/src/main/java/org/elasticsearch/index/analysis/PreBuiltAnalyzerProvider.java b/src/main/java/org/elasticsearch/index/analysis/PreBuiltAnalyzerProvider.java
index 406670c..3167bdf 100644
--- a/src/main/java/org/elasticsearch/index/analysis/PreBuiltAnalyzerProvider.java
+++ b/src/main/java/org/elasticsearch/index/analysis/PreBuiltAnalyzerProvider.java
@@ -20,18 +20,28 @@
 package org.elasticsearch.index.analysis;
 
 import org.apache.lucene.analysis.Analyzer;
+import org.elasticsearch.index.Index;
+import org.elasticsearch.index.settings.IndexSettings;
+import org.elasticsearch.common.settings.Settings;
 
 /**
  *
  */
-public class PreBuiltAnalyzerProvider implements AnalyzerProvider<NamedAnalyzer> {
+public class PreBuiltAnalyzerProvider extends AbstractIndexAnalyzerProvider<NamedAnalyzer> {
 
     private final NamedAnalyzer analyzer;
 
-    public PreBuiltAnalyzerProvider(String name, AnalyzerScope scope, Analyzer analyzer) {
+    public PreBuiltAnalyzerProvider(Index index, @IndexSettings Settings indexSettings, String name, Analyzer analyzer) {
+        super(index, indexSettings, name, Settings.EMPTY);
         // we create the named analyzer here so the resources associated with it will be shared
         // and we won't wrap a shared analyzer with named analyzer each time causing the resources
         // to not be shared...
+        this.analyzer = new NamedAnalyzer(name, scope(), analyzer);
+    }
+
+    // Legacy constructor for backward compatibility
+    public PreBuiltAnalyzerProvider(String name, AnalyzerScope scope, Analyzer analyzer) {
+        super(null, null, name, Settings.EMPTY);
         this.analyzer = new NamedAnalyzer(name, scope, analyzer);
     }
 
diff --git a/src/main/java/org/elasticsearch/index/analysis/PreBuiltAnalyzerProviderFactory.java b/src/main/java/org/elasticsearch/index/analysis/PreBuiltAnalyzerProviderFactory.java
index 1cf698d..27fe13c 100644
--- a/src/main/java/org/elasticsearch/index/analysis/PreBuiltAnalyzerProviderFactory.java
+++ b/src/main/java/org/elasticsearch/index/analysis/PreBuiltAnalyzerProviderFactory.java
@@ -21,6 +21,8 @@ package org.elasticsearch.index.analysis;
 
 import org.apache.lucene.analysis.Analyzer;
 import org.elasticsearch.common.settings.Settings;
+import org.elasticsearch.index.Index;
+import org.elasticsearch.index.settings.IndexSettings;
 
 /**
  *
@@ -28,6 +30,7 @@ import org.elasticsearch.common.settings.Settings;
 public class PreBuiltAnalyzerProviderFactory implements AnalyzerProviderFactory {
 
     private final PreBuiltAnalyzerProvider analyzerProvider;
+    private final Analyzer analyzer;  // Store the actual analyzer for version-aware creation
 
     public PreBuiltAnalyzerProviderFactory(String name, AnalyzerScope scope, Analyzer analyzer) {
         this(new PreBuiltAnalyzerProvider(name, scope, analyzer));
@@ -35,14 +38,34 @@ public class PreBuiltAnalyzerProviderFactory implements AnalyzerProviderFactory
 
     public PreBuiltAnalyzerProviderFactory(PreBuiltAnalyzerProvider analyzerProvider) {
         this.analyzerProvider = analyzerProvider;
+        this.analyzer = analyzerProvider.get();
+    }
+
+    // Constructor for version-aware creation
+    public PreBuiltAnalyzerProviderFactory(String name, Analyzer analyzer) {
+        this.analyzer = analyzer;
+        this.analyzerProvider = null;  // Will be created in create() method
     }
 
     @Override
     public AnalyzerProvider create(String name, Settings settings) {
-        return analyzerProvider;
+        if (analyzerProvider != null) {
+            // Legacy behavior - return the pre-built provider
+            return analyzerProvider;
+        }
+        
+        // Version-aware creation - extract version from settings and create provider with index context
+        // This will be handled by AnalysisService when it calls create() with proper index context
+        throw new UnsupportedOperationException(
+            "Version-aware creation of PreBuiltAnalyzerProvider requires AnalysisService to use create(Index, Settings, String)");
+    }
+
+    // Version-aware create method that takes index context
+    public AnalyzerProvider create(Index index, @IndexSettings Settings indexSettings, String name) {
+        return new PreBuiltAnalyzerProvider(index, indexSettings, name, analyzer);
     }
 
     public Analyzer analyzer() {
-        return analyzerProvider.get();
+        return analyzerProvider != null ? analyzerProvider.get() : analyzer;
     }
 }
diff --git a/src/main/java/org/elasticsearch/index/analysis/PreBuiltCharFilterFactoryFactory.java b/src/main/java/org/elasticsearch/index/analysis/PreBuiltCharFilterFactoryFactory.java
index 091dc1c..492c544 100644
--- a/src/main/java/org/elasticsearch/index/analysis/PreBuiltCharFilterFactoryFactory.java
+++ b/src/main/java/org/elasticsearch/index/analysis/PreBuiltCharFilterFactoryFactory.java
@@ -20,6 +20,8 @@
 package org.elasticsearch.index.analysis;
 
 import org.elasticsearch.common.settings.Settings;
+import org.elasticsearch.index.Index;
+import org.elasticsearch.index.settings.IndexSettings;
 
 public class PreBuiltCharFilterFactoryFactory implements CharFilterFactoryFactory {
 
@@ -33,4 +35,11 @@ public class PreBuiltCharFilterFactoryFactory implements CharFilterFactoryFactor
     public CharFilterFactory create(String name, Settings settings) {
         return charFilterFactory;
     }
+
+    // Version-aware create method that takes index context
+    public CharFilterFactory create(String name, Index index, @IndexSettings Settings indexSettings, Settings settings) {
+        // For now, char filter factories don't typically need versioning, but we provide this interface
+        // for consistency and future extensibility
+        return charFilterFactory;
+    }
 }
\ No newline at end of file
diff --git a/src/main/java/org/elasticsearch/index/analysis/PreBuiltTokenFilterFactoryFactory.java b/src/main/java/org/elasticsearch/index/analysis/PreBuiltTokenFilterFactoryFactory.java
index 8677a44..ec6aea5 100644
--- a/src/main/java/org/elasticsearch/index/analysis/PreBuiltTokenFilterFactoryFactory.java
+++ b/src/main/java/org/elasticsearch/index/analysis/PreBuiltTokenFilterFactoryFactory.java
@@ -20,6 +20,8 @@
 package org.elasticsearch.index.analysis;
 
 import org.elasticsearch.common.settings.Settings;
+import org.elasticsearch.index.Index;
+import org.elasticsearch.index.settings.IndexSettings;
 
 public class PreBuiltTokenFilterFactoryFactory implements TokenFilterFactoryFactory {
 
@@ -33,4 +35,11 @@ public class PreBuiltTokenFilterFactoryFactory implements TokenFilterFactoryFact
     public TokenFilterFactory create(String name, Settings settings) {
         return tokenFilterFactory;
     }
+
+    // Version-aware create method that takes index context
+    public TokenFilterFactory create(String name, Index index, @IndexSettings Settings indexSettings, Settings settings) {
+        // For now, token filter factories don't typically need versioning, but we provide this interface
+        // for consistency and future extensibility
+        return tokenFilterFactory;
+    }
 }
\ No newline at end of file
diff --git a/src/main/java/org/elasticsearch/index/analysis/PreBuiltTokenizerFactoryFactory.java b/src/main/java/org/elasticsearch/index/analysis/PreBuiltTokenizerFactoryFactory.java
index 1d70411..1c3efea 100644
--- a/src/main/java/org/elasticsearch/index/analysis/PreBuiltTokenizerFactoryFactory.java
+++ b/src/main/java/org/elasticsearch/index/analysis/PreBuiltTokenizerFactoryFactory.java
@@ -20,6 +20,8 @@
 package org.elasticsearch.index.analysis;
 
 import org.elasticsearch.common.settings.Settings;
+import org.elasticsearch.index.Index;
+import org.elasticsearch.index.settings.IndexSettings;
 
 public class PreBuiltTokenizerFactoryFactory implements TokenizerFactoryFactory {
 
@@ -33,4 +35,11 @@ public class PreBuiltTokenizerFactoryFactory implements TokenizerFactoryFactory
     public TokenizerFactory create(String name, Settings settings) {
         return tokenizerFactory;
     }
+
+    // Version-aware create method that takes index context
+    public TokenizerFactory create(String name, Index index, @IndexSettings Settings indexSettings, Settings settings) {
+        // For now, tokenizer factories don't typically need versioning, but we provide this interface
+        // for consistency and future extensibility
+        return tokenizerFactory;
+    }
 }
\ No newline at end of file
diff --git a/src/main/java/org/elasticsearch/indices/analysis/IndicesAnalysisService.java b/src/main/java/org/elasticsearch/indices/analysis/IndicesAnalysisService.java
index 6b52755..08e4f0c 100644
--- a/src/main/java/org/elasticsearch/indices/analysis/IndicesAnalysisService.java
+++ b/src/main/java/org/elasticsearch/indices/analysis/IndicesAnalysisService.java
@@ -114,6 +114,8 @@ public class IndicesAnalysisService extends AbstractComponent {
     public IndicesAnalysisService(Settings settings) {
         super(settings);
 
+        // PreBuiltAnalyzerProviderFactory will be used to create version-aware analyzer providers
+        // The actual version will be determined when the provider is instantiated with index context
         StandardAnalyzer standardAnalyzer = new StandardAnalyzer(Lucene.ANALYZER_VERSION);
         analyzerProviderFactories.put("default", new PreBuiltAnalyzerProviderFactory("default", AnalyzerScope.INDICES, standardAnalyzer));
         analyzerProviderFactories.put("standard", new PreBuiltAnalyzerProviderFactory("standard", AnalyzerScope.INDICES, standardAnalyzer));