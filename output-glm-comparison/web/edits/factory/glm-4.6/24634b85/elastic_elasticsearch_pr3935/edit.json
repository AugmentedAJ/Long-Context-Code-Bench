{
  "repo_url": "https://github.com/elastic/elasticsearch.git",
  "pr_number": 3935,
  "base_commit": "60550e4cc27bd11488540d911081794d69434478",
  "runner": "factory",
  "model": "glm-4.6",
  "timeout_s": 1800,
  "status": "success",
  "elapsed_ms": 91626,
  "patch_unified": "diff --git a/src/main/java/org/elasticsearch/cluster/settings/ClusterDynamicSettingsModule.java b/src/main/java/org/elasticsearch/cluster/settings/ClusterDynamicSettingsModule.java\nindex 0f9d106..3c1f0a5 100644\n--- a/src/main/java/org/elasticsearch/cluster/settings/ClusterDynamicSettingsModule.java\n+++ b/src/main/java/org/elasticsearch/cluster/settings/ClusterDynamicSettingsModule.java\n@@ -39,7 +39,7 @@ public class ClusterDynamicSettingsModule extends AbstractModule {\n \n     public ClusterDynamicSettingsModule() {\n         clusterDynamicSettings = new DynamicSettings();\n-        clusterDynamicSettings.addDynamicSetting(AwarenessAllocationDecider.CLUSTER_ROUTING_ALLOCATION_AWARENESS_ATTRIBUTES);\n+        clusterDynamicSettings.addDynamicSetting(AwarenessAllocationDecider.CLUSTER_ROUTING_ALLOCATION_AWARENESS_ATTRIBUTES, Validator.EMPTY_OR_NON_EMPTY);\n         clusterDynamicSettings.addDynamicSetting(AwarenessAllocationDecider.CLUSTER_ROUTING_ALLOCATION_AWARENESS_FORCE_GROUP + \"*\");\n         clusterDynamicSettings.addDynamicSetting(BalancedShardsAllocator.SETTING_INDEX_BALANCE_FACTOR, Validator.FLOAT);\n         clusterDynamicSettings.addDynamicSetting(BalancedShardsAllocator.SETTING_PRIMARY_BALANCE_FACTOR, Validator.FLOAT);\ndiff --git a/src/main/java/org/elasticsearch/cluster/settings/Validator.java b/src/main/java/org/elasticsearch/cluster/settings/Validator.java\nindex 3534e2a..f2a7e17 100644\n--- a/src/main/java/org/elasticsearch/cluster/settings/Validator.java\n+++ b/src/main/java/org/elasticsearch/cluster/settings/Validator.java\n@@ -195,4 +195,19 @@ public interface Validator {\n             return \"cannot parse value [\" + value + \"] as a boolean\";\n         }\n     };\n+    \n+    /**\n+     * Validator that allows empty strings (for resetting settings) or any non-empty value.\n+     * This is useful for settings that can be reset to their default by passing an empty string.\n+     */\n+    public static final Validator EMPTY_OR_NON_EMPTY = new Validator() {\n+        @Override\n+        public String validate(String setting, String value) {\n+            // Allow empty strings for resetting, or any non-empty value\n+            if (value == null) {\n+                return \"value cannot be null\";\n+            }\n+            return null; // always valid\n+        }\n+    };\n }\ndiff --git a/src/test/java/org/elasticsearch/cluster/settings/ClusterSettingsTests.java b/src/test/java/org/elasticsearch/cluster/settings/ClusterSettingsTests.java\nindex a94a7f3..5d8a57b 100644\n--- a/src/test/java/org/elasticsearch/cluster/settings/ClusterSettingsTests.java\n+++ b/src/test/java/org/elasticsearch/cluster/settings/ClusterSettingsTests.java\n@@ -21,6 +21,7 @@ package org.elasticsearch.cluster.settings;\n \n import org.elasticsearch.action.admin.cluster.settings.ClusterUpdateSettingsResponse;\n import org.elasticsearch.client.Client;\n+import org.elasticsearch.cluster.routing.allocation.decider.AwarenessAllocationDecider;\n import org.elasticsearch.cluster.routing.allocation.decider.DisableAllocationDecider;\n import org.elasticsearch.common.settings.ImmutableSettings;\n import org.elasticsearch.common.settings.Settings;\n@@ -119,4 +120,33 @@ public class ClusterSettingsTests extends ElasticsearchTestCase {\n         node2.stop();\n     }\n \n+    @Test\n+    public void testAwarenessAttributesResetWithEmptyString() {\n+        Node node1 = NodeBuilder.nodeBuilder().node();\n+        node1.start();\n+        Client client = node1.client();\n+\n+        // First, set awareness attributes to a non-empty value\n+        String key = AwarenessAllocationDecider.CLUSTER_ROUTING_ALLOCATION_AWARENESS_ATTRIBUTES;\n+        String value = \"rack_id,zone\";\n+\n+        ClusterUpdateSettingsResponse response1 = client.admin().cluster()\n+                .prepareUpdateSettings()\n+                .setTransientSettings(ImmutableSettings.builder().put(key, value).build())\n+                .get();\n+\n+        assertThat(response1.getTransientSettings().get(key), notNullValue());\n+\n+        // Now, try to reset using an empty string - this should be allowed with our new validator\n+        ClusterUpdateSettingsResponse response2 = client.admin().cluster()\n+                .prepareUpdateSettings()\n+                .setTransientSettings(ImmutableSettings.builder().put(key, \"\").build())\n+                .get();\n+\n+        // The empty string should be accepted and stored, indicating the setting can be reset\n+        assertThat(response2.getTransientSettings().get(key), notNullValue());\n+\n+        node1.stop();\n+    }\n+\n }",
  "logs_path": "factory/glm-4.6/24634b85/elastic_elasticsearch_pr3935/logs.jsonl",
  "errors": [],
  "edit_run_id": "24634b85",
  "test_label": null
}