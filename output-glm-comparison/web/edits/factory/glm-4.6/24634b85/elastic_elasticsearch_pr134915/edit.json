{
  "repo_url": "https://github.com/elastic/elasticsearch.git",
  "pr_number": 134915,
  "base_commit": "dd4b8d96484bc1b0f86d7b006d79cac5916b3f45",
  "runner": "factory",
  "model": "glm-4.6",
  "timeout_s": 1800,
  "status": "success",
  "elapsed_ms": 255547,
  "patch_unified": "diff --git a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/optimizer/LogicalPlanOptimizerTests.java b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/optimizer/LogicalPlanOptimizerTests.java\nindex 1a181fe8..c438c7f1 100644\n--- a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/optimizer/LogicalPlanOptimizerTests.java\n+++ b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/optimizer/LogicalPlanOptimizerTests.java\n@@ -5729,9 +5729,7 @@ public class LogicalPlanOptimizerTests extends AbstractLogicalPlanOptimizerTests\n             FROM test\n             | INLINESTATS c = COUNT(salary) by emp_no % 2\n             \"\"\";\n-        if (releaseBuildForInlinestats(query)) {\n-            return;\n-        }\n+        assumeTrue(\"INLINESTATS V11 required\", EsqlCapabilities.Cap.INLINESTATS_V11.isEnabled());\n         var plan = optimizedPlan(query);\n         var limit = as(plan, Limit.class); // TODO: this needs to go\n         var inline = as(limit.child(), InlineJoin.class);\n@@ -5771,9 +5769,7 @@ public class LogicalPlanOptimizerTests extends AbstractLogicalPlanOptimizerTests\n             | KEEP x, emp_no\n             | LIMIT 1\n             \"\"\";\n-        if (releaseBuildForInlinestats(query)) {\n-            return;\n-        }\n+        assumeTrue(\"INLINESTATS V11 required\", EsqlCapabilities.Cap.INLINESTATS_V11.isEnabled());\n         var plan = optimizedPlan(query);\n \n         var project = as(plan, Project.class);\n@@ -5804,9 +5800,7 @@ public class LogicalPlanOptimizerTests extends AbstractLogicalPlanOptimizerTests\n             | SORT emp_no\n             | LIMIT 5\n             \"\"\";\n-        if (releaseBuildForInlinestats(query)) {\n-            return;\n-        }\n+        assumeTrue(\"INLINESTATS V11 required\", EsqlCapabilities.Cap.INLINESTATS_V11.isEnabled());\n         var plan = optimizedPlan(query);\n \n         var project = as(plan, EsqlProject.class);\n@@ -5847,9 +5841,7 @@ public class LogicalPlanOptimizerTests extends AbstractLogicalPlanOptimizerTests\n             | KEEP x, emp_no\n             | LIMIT 1\n             \"\"\";\n-        if (releaseBuildForInlinestats(query)) {\n-            return;\n-        }\n+        assumeTrue(\"INLINESTATS V11 required\", EsqlCapabilities.Cap.INLINESTATS_V11.isEnabled());\n         var plan = optimizedPlan(query);\n \n         var project = as(plan, Project.class);\n@@ -5876,9 +5868,7 @@ public class LogicalPlanOptimizerTests extends AbstractLogicalPlanOptimizerTests\n             | KEEP x, a, emp_no\n             | LIMIT 1\n             \"\"\";\n-        if (releaseBuildForInlinestats(query)) {\n-            return;\n-        }\n+        assumeTrue(\"INLINESTATS V11 required\", EsqlCapabilities.Cap.INLINESTATS_V11.isEnabled());\n         var plan = optimizedPlan(query);\n \n         var project = as(plan, Project.class);\n@@ -5905,9 +5895,7 @@ public class LogicalPlanOptimizerTests extends AbstractLogicalPlanOptimizerTests\n             | KEEP x, a, emp_no\n             | LIMIT 1\n             \"\"\";\n-        if (releaseBuildForInlinestats(query)) {\n-            return;\n-        }\n+        assumeTrue(\"INLINESTATS V11 required\", EsqlCapabilities.Cap.INLINESTATS_V11.isEnabled());\n         var plan = optimizedPlan(query);\n \n         var project = as(plan, Project.class);\n@@ -5956,9 +5944,7 @@ public class LogicalPlanOptimizerTests extends AbstractLogicalPlanOptimizerTests\n             | KEEP emp_no, salaryK, count, min\n             | LIMIT 5\n             \"\"\";\n-        if (releaseBuildForInlinestats(query)) {\n-            return;\n-        }\n+        assumeTrue(\"INLINESTATS V11 required\", EsqlCapabilities.Cap.INLINESTATS_V11.isEnabled());\n         var plan = optimizedPlan(query);\n \n         var employeesFields = List.of(\n@@ -6025,9 +6011,7 @@ public class LogicalPlanOptimizerTests extends AbstractLogicalPlanOptimizerTests\n             | KEEP emp_no\n             | LIMIT 5\n             \"\"\";\n-        if (releaseBuildForInlinestats(query)) {\n-            return;\n-        }\n+        assumeTrue(\"INLINESTATS V11 required\", EsqlCapabilities.Cap.INLINESTATS_V11.isEnabled());\n         var plan = optimizedPlan(query);\n \n         var project = as(plan, EsqlProject.class);\n@@ -6066,9 +6050,7 @@ public class LogicalPlanOptimizerTests extends AbstractLogicalPlanOptimizerTests\n             | KEEP emp_no\n             | LIMIT 5\n             \"\"\";\n-        if (releaseBuildForInlinestats(query)) {\n-            return;\n-        }\n+        assumeTrue(\"INLINESTATS V11 required\", EsqlCapabilities.Cap.INLINESTATS_V11.isEnabled());\n         var plan = optimizedPlan(query);\n \n         var project = as(plan, Project.class);\n@@ -6107,9 +6089,7 @@ public class LogicalPlanOptimizerTests extends AbstractLogicalPlanOptimizerTests\n             | KEEP avg, decades\n             \"\"\";\n \n-        if (releaseBuildForInlinestats(query)) {\n-            return;\n-        }\n+        assumeTrue(\"INLINESTATS V11 required\", EsqlCapabilities.Cap.INLINESTATS_V11.isEnabled());\n         var plan = optimizedPlan(query);\n \n         var project = as(plan, Project.class);\n@@ -6150,9 +6130,7 @@ public class LogicalPlanOptimizerTests extends AbstractLogicalPlanOptimizerTests\n             | KEEP avg, decades, avgavg\n             \"\"\";\n \n-        if (releaseBuildForInlinestats(query)) {\n-            return;\n-        }\n+        assumeTrue(\"INLINESTATS V11 required\", EsqlCapabilities.Cap.INLINESTATS_V11.isEnabled());\n         var plan = optimizedPlan(query);\n \n         var project = as(plan, EsqlProject.class);\n@@ -6200,9 +6178,7 @@ public class LogicalPlanOptimizerTests extends AbstractLogicalPlanOptimizerTests\n             | LIMIT 5\n             \"\"\";\n         assumeTrue(\"Requires LOOKUP JOIN\", EsqlCapabilities.Cap.JOIN_LOOKUP_V12.isEnabled());\n-        if (releaseBuildForInlinestats(query)) {\n-            return;\n-        }\n+        assumeTrue(\"INLINESTATS V11 required\", EsqlCapabilities.Cap.INLINESTATS_V11.isEnabled());\n \n         var plan = planAirports(query);\n         var project = as(plan, Project.class);\n@@ -6240,9 +6216,7 @@ public class LogicalPlanOptimizerTests extends AbstractLogicalPlanOptimizerTests\n             | KEEP avg, emp_no, first_name\n             | LIMIT 10\n             \"\"\";\n-        if (releaseBuildForInlinestats(query)) {\n-            return;\n-        }\n+        assumeTrue(\"INLINESTATS V11 required\", EsqlCapabilities.Cap.INLINESTATS_V11.isEnabled());\n         var plan = optimizedPlan(query);\n \n         var esqlProject = as(plan, EsqlProject.class);\n@@ -6275,9 +6249,7 @@ public class LogicalPlanOptimizerTests extends AbstractLogicalPlanOptimizerTests\n             | INLINESTATS sum = SUM(salaryK) BY gender\n             | KEEP emp_no\n             \"\"\";\n-        if (releaseBuildForInlinestats(query)) {\n-            return;\n-        }\n+        assumeTrue(\"INLINESTATS V11 required\", EsqlCapabilities.Cap.INLINESTATS_V11.isEnabled());\n         var plan = optimizedPlan(query);\n \n         var esqlProject = as(plan, EsqlProject.class);\n@@ -6313,9 +6285,7 @@ public class LogicalPlanOptimizerTests extends AbstractLogicalPlanOptimizerTests\n             | LIMIT 2\n             | KEEP a\n             \"\"\";\n-        if (releaseBuildForInlinestats(query)) {\n-            return;\n-        }\n+        assumeTrue(\"INLINESTATS V11 required\", EsqlCapabilities.Cap.INLINESTATS_V11.isEnabled());\n         var plan = optimizedPlan(query);\n \n         var project = as(plan, EsqlProject.class);\n@@ -6351,9 +6321,7 @@ public class LogicalPlanOptimizerTests extends AbstractLogicalPlanOptimizerTests\n             | LIMIT 1\n             | STATS v = VALUES(max_lang)\n             \"\"\";\n-        if (releaseBuildForInlinestats(query)) {\n-            return;\n-        }\n+        assumeTrue(\"INLINESTATS V11 required\", EsqlCapabilities.Cap.INLINESTATS_V11.isEnabled());\n         var plan = optimizedPlan(query);\n \n         var limit = asLimit(plan, 10000, false);\ndiff --git a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/optimizer/rules/logical/ReplaceStatsFilteredAggWithEvalTests.java b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/optimizer/rules/logical/ReplaceStatsFilteredAggWithEvalTests.java\nindex 92d5cd6f..21259835 100644\n--- a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/optimizer/rules/logical/ReplaceStatsFilteredAggWithEvalTests.java\n+++ b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/optimizer/rules/logical/ReplaceStatsFilteredAggWithEvalTests.java\n@@ -32,7 +32,9 @@ import static org.elasticsearch.test.MapMatcher.assertMap;\n import static org.elasticsearch.xpack.esql.EsqlTestUtils.as;\n import static org.elasticsearch.xpack.esql.core.type.DataType.INTEGER;\n import static org.elasticsearch.xpack.esql.core.type.DataType.LONG;\n+import org.elasticsearch.xpack.esql.action.EsqlCapabilities;\n import static org.elasticsearch.xpack.esql.optimizer.LogicalPlanOptimizerTests.releaseBuildForInlinestats;\n+import static org.junit.Assume.assumeTrue;\n import static org.hamcrest.Matchers.contains;\n import static org.hamcrest.Matchers.containsString;\n import static org.hamcrest.Matchers.is;\n@@ -396,9 +398,7 @@ public class ReplaceStatsFilteredAggWithEvalTests extends AbstractLogicalPlanOpt\n             FROM test\n             | INLINESTATS sum(salary) where false\n             \"\"\";\n-        if (releaseBuildForInlinestats(query)) {\n-            return;\n-        }\n+        assumeTrue(\"INLINESTATS V11 required\", EsqlCapabilities.Cap.INLINESTATS_V11.isEnabled());\n         var plan = plan(query);\n         var project = as(plan, Project.class);\n         assertMap(\n@@ -439,9 +439,7 @@ public class ReplaceStatsFilteredAggWithEvalTests extends AbstractLogicalPlanOpt\n             FROM test\n             | INLINESTATS sum(salary) + 1 where false\n             \"\"\";\n-        if (releaseBuildForInlinestats(query)) {\n-            return;\n-        }\n+        assumeTrue(\"INLINESTATS V11 required\", EsqlCapabilities.Cap.INLINESTATS_V11.isEnabled());\n         var plan = plan(query);\n         var project = as(plan, Project.class);\n         assertMap(\n@@ -488,9 +486,7 @@ public class ReplaceStatsFilteredAggWithEvalTests extends AbstractLogicalPlanOpt\n                     sum(salary) + 2\n               BY emp_no\n             \"\"\";\n-        if (releaseBuildForInlinestats(query)) {\n-            return;\n-        }\n+        assumeTrue(\"INLINESTATS V11 required\", EsqlCapabilities.Cap.INLINESTATS_V11.isEnabled());\n         var plan = plan(query);\n         var limit = as(plan, Limit.class);\n         var ij = as(limit.child(), InlineJoin.class);\n@@ -544,9 +540,7 @@ public class ReplaceStatsFilteredAggWithEvalTests extends AbstractLogicalPlanOpt\n                     sum(salary) + 2 where null,\n                     sum(salary) + 4 where not true\n             \"\"\";\n-        if (releaseBuildForInlinestats(query)) {\n-            return;\n-        }\n+        assumeTrue(\"INLINESTATS V11 required\", EsqlCapabilities.Cap.INLINESTATS_V11.isEnabled());\n         var plan = plan(query);\n         var limit = as(plan, Limit.class);\n         var ij = as(limit.child(), InlineJoin.class);\n@@ -595,9 +589,7 @@ public class ReplaceStatsFilteredAggWithEvalTests extends AbstractLogicalPlanOpt\n             | KEEP emp_no, salary\n             | INLINESTATS count(salary) where not true\n             \"\"\";\n-        if (releaseBuildForInlinestats(query)) {\n-            return;\n-        }\n+        assumeTrue(\"INLINESTATS V11 required\", EsqlCapabilities.Cap.INLINESTATS_V11.isEnabled());\n         var plan = plan(query);\n         var project = as(plan, EsqlProject.class);\n         assertThat(Expressions.names(project.projections()), contains(\"emp_no\", \"salary\", \"count(salary) where not true\"));\n@@ -627,9 +619,7 @@ public class ReplaceStatsFilteredAggWithEvalTests extends AbstractLogicalPlanOpt\n             | KEEP emp_no, salary, gender\n             | INLINESTATS m1 = count(salary) WHERE not false\n             \"\"\";\n-        if (releaseBuildForInlinestats(query)) {\n-            return;\n-        }\n+        assumeTrue(\"INLINESTATS V11 required\", EsqlCapabilities.Cap.INLINESTATS_V11.isEnabled());\n         var plan = plan(query);\n         var limit = as(plan, Limit.class);\n         var ij = as(limit.child(), InlineJoin.class);\n@@ -660,9 +650,7 @@ public class ReplaceStatsFilteredAggWithEvalTests extends AbstractLogicalPlanOpt\n             | KEEP salary\n             | INLINESTATS count(salary) where false\n             \"\"\";\n-        if (releaseBuildForInlinestats(query)) {\n-            return;\n-        }\n+        assumeTrue(\"INLINESTATS V11 required\", EsqlCapabilities.Cap.INLINESTATS_V11.isEnabled());\n         var plan = plan(query);\n         var project = as(plan, EsqlProject.class);\n         assertThat(Expressions.names(project.projections()), contains(\"salary\", \"count(salary) where false\"));\n@@ -690,9 +678,7 @@ public class ReplaceStatsFilteredAggWithEvalTests extends AbstractLogicalPlanOpt\n             | KEEP salary\n             | INLINESTATS count_distinct(salary + 2) + 3 where false\n             \"\"\";\n-        if (releaseBuildForInlinestats(query)) {\n-            return;\n-        }\n+        assumeTrue(\"INLINESTATS V11 required\", EsqlCapabilities.Cap.INLINESTATS_V11.isEnabled());\n         var plan = plan(query);\n         var project = as(plan, EsqlProject.class);\n         assertThat(Expressions.names(project.projections()), contains(\"salary\", \"count_distinct(salary + 2) + 3 where false\"));\n@@ -727,9 +713,7 @@ public class ReplaceStatsFilteredAggWithEvalTests extends AbstractLogicalPlanOpt\n                     min_a = min(salary) WHERE to_string(null) == \"abc\"\n               BY emp_no\n             \"\"\";\n-        if (releaseBuildForInlinestats(query)) {\n-            return;\n-        }\n+        assumeTrue(\"INLINESTATS V11 required\", EsqlCapabilities.Cap.INLINESTATS_V11.isEnabled());\n         var plan = plan(query);\n         var limit = as(plan, Limit.class);\n         var ij = as(limit.child(), InlineJoin.class);\n@@ -778,9 +762,7 @@ public class ReplaceStatsFilteredAggWithEvalTests extends AbstractLogicalPlanOpt\n                 | INLINESTATS count = count(*) WHERE false\n                 | INLINESTATS cc = count_distinct(emp_no) WHERE false\n             \"\"\";\n-        if (releaseBuildForInlinestats(query)) {\n-            return;\n-        }\n+        assumeTrue(\"INLINESTATS V11 required\", EsqlCapabilities.Cap.INLINESTATS_V11.isEnabled());\n         var plan = plan(query);\n         var project = as(plan, EsqlProject.class);\n         assertThat(Expressions.names(project.projections()), contains(\"emp_no\", \"count\", \"cc\"));",
  "logs_path": "factory/glm-4.6/24634b85/elastic_elasticsearch_pr134915/logs.jsonl",
  "errors": [],
  "edit_run_id": "24634b85",
  "test_label": null
}