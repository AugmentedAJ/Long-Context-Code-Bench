{
  "repo_url": "https://github.com/elastic/elasticsearch.git",
  "pr_number": 2558,
  "base_commit": "2eb09e6b1abceb316c789f173988ac733a55dc8b",
  "runner": "factory",
  "model": "glm-4.6",
  "timeout_s": 1800,
  "status": "success",
  "elapsed_ms": 84423,
  "patch_unified": "diff --git a/config/elasticsearch.yml b/config/elasticsearch.yml\nindex 5eeab76..550a234 100644\n--- a/config/elasticsearch.yml\n+++ b/config/elasticsearch.yml\n@@ -290,6 +290,33 @@\n # indices.recovery.concurrent_streams: 5\n \n \n+################################## Shard Allocation ###########################\n+\n+# Set the type of shard allocator to use. Available types are:\n+# - balanced (default): Balances shards across nodes based on multiple weight factors\n+# - even_shard_count: Ensures each node has approximately the same number of shards\n+# - Fully qualified class name: Custom allocator implementation class name\n+#\n+# cluster.routing.allocation.allocator.type: balanced\n+\n+# The following settings apply to the balanced allocator:\n+# The shard balance defines the weight factor for shards allocated on a node\n+#\n+# cluster.routing.allocation.balance.shard: 0.45\n+#\n+# The index balance defines a factor to the number of shards per index allocated on a specific node\n+#\n+# cluster.routing.allocation.balance.index: 0.5\n+#\n+# The primary balance defines a weight factor for the number of primaries of a specific index allocated on a node\n+#\n+# cluster.routing.allocation.balance.primary: 0.05\n+#\n+# A threshold to set the minimal optimization value of operations that should be performed\n+#\n+# cluster.routing.allocation.balance.threshold: 1.0\n+\n+\n ################################## Discovery ##################################\n \n # Discovery infrastructure ensures nodes can be found within a cluster\ndiff --git a/src/main/java/org/elasticsearch/cluster/routing/allocation/allocator/ShardsAllocatorModule.java b/src/main/java/org/elasticsearch/cluster/routing/allocation/allocator/ShardsAllocatorModule.java\nindex a3d8da2..b11c27e 100644\n--- a/src/main/java/org/elasticsearch/cluster/routing/allocation/allocator/ShardsAllocatorModule.java\n+++ b/src/main/java/org/elasticsearch/cluster/routing/allocation/allocator/ShardsAllocatorModule.java\n@@ -19,6 +19,7 @@\n \n package org.elasticsearch.cluster.routing.allocation.allocator;\n \n+import org.elasticsearch.ElasticSearchIllegalArgumentException;\n import org.elasticsearch.common.inject.AbstractModule;\n import org.elasticsearch.common.settings.Settings;\n import org.elasticsearch.gateway.none.NoneGatewayAllocator;\n@@ -27,6 +28,8 @@ import org.elasticsearch.gateway.none.NoneGatewayAllocator;\n  */\n public class ShardsAllocatorModule extends AbstractModule {\n \n+    public static final String SETTING_ALLOCATOR_TYPE = \"cluster.routing.allocation.allocator.type\";\n+    \n     private Settings settings;\n \n     private Class<? extends ShardsAllocator> shardsAllocator;\n@@ -48,6 +51,31 @@ public class ShardsAllocatorModule extends AbstractModule {\n     @Override\n     protected void configure() {\n         bind(GatewayAllocator.class).to(gatewayAllocator).asEagerSingleton();\n-        bind(ShardsAllocator.class).to(shardsAllocator == null ? BalancedShardsAllocator.class : shardsAllocator).asEagerSingleton();\n+        \n+        // Determine which allocator to use based on settings or explicit configuration\n+        Class<? extends ShardsAllocator> allocatorClass = shardsAllocator;\n+        if (allocatorClass == null) {\n+            String allocatorType = settings.get(SETTING_ALLOCATOR_TYPE, \"balanced\");\n+            if (\"balanced\".equalsIgnoreCase(allocatorType)) {\n+                allocatorClass = BalancedShardsAllocator.class;\n+            } else if (\"even_shard_count\".equalsIgnoreCase(allocatorType)) {\n+                allocatorClass = EvenShardsCountAllocator.class;\n+            } else {\n+                try {\n+                    // Try to load the allocator class by fully qualified name\n+                   Class<?> clazz = Class.forName(allocatorType);\n+                    if (ShardsAllocator.class.isAssignableFrom(clazz)) {\n+                        allocatorClass = (Class<? extends ShardsAllocator>) clazz;\n+                    } else {\n+                        throw new ElasticSearchIllegalArgumentException(\"Class \" + allocatorType + \" is not a ShardsAllocator\");\n+                    }\n+                } catch (ClassNotFoundException e) {\n+                    throw new ElasticSearchIllegalArgumentException(\"Unknown ShardsAllocator type: \" + allocatorType + \n+                            \". Available types are: balanced, even_shard_count, or fully qualified class name\", e);\n+                }\n+            }\n+        }\n+        \n+        bind(ShardsAllocator.class).to(allocatorClass).asEagerSingleton();\n     }\n }",
  "logs_path": "factory/glm-4.6/24634b85/elastic_elasticsearch_pr2558/logs.jsonl",
  "errors": [],
  "edit_run_id": "24634b85",
  "test_label": null
}