{
  "repo_url": "https://github.com/elastic/elasticsearch.git",
  "pr_number": 4212,
  "base_commit": "22852d8040df7c789e0cdbb32d33ef1e5cc76435",
  "runner": "factory",
  "model": "glm-4.6",
  "timeout_s": 1800,
  "status": "success",
  "elapsed_ms": 107517,
  "patch_unified": "diff --git a/src/main/java/org/elasticsearch/repositories/RepositoriesService.java b/src/main/java/org/elasticsearch/repositories/RepositoriesService.java\nindex 0f9d59d..451f886 100644\n--- a/src/main/java/org/elasticsearch/repositories/RepositoriesService.java\n+++ b/src/main/java/org/elasticsearch/repositories/RepositoriesService.java\n@@ -57,6 +57,8 @@ public class RepositoriesService extends AbstractComponent implements ClusterSta\n \n     private final ClusterService clusterService;\n \n+    private final RepositoryUsageValidator usageValidator;\n+\n     private volatile ImmutableMap<String, RepositoryHolder> repositories = ImmutableMap.of();\n \n     @Inject\n@@ -65,6 +67,7 @@ public class RepositoriesService extends AbstractComponent implements ClusterSta\n         this.typesRegistry = typesRegistry;\n         this.injector = injector;\n         this.clusterService = clusterService;\n+        this.usageValidator = new RepositoryUsageValidator(settings, clusterService);\n         // Doesn't make sense to maintain repositories on non-master and non-data nodes\n         // Nothing happens there anyway\n         if (DiscoveryNode.dataNode(settings) || DiscoveryNode.masterNode(settings)) {\n@@ -82,6 +85,13 @@ public class RepositoriesService extends AbstractComponent implements ClusterSta\n      * @param listener register repository listener\n      */\n     public void registerRepository(final RegisterRepositoryRequest request, final ActionListener<RegisterRepositoryResponse> listener) {\n+        // Check if repository is being updated and is currently in use\n+        RepositoriesMetaData repositories = clusterService.state().getMetaData().custom(RepositoriesMetaData.TYPE);\n+        if (repositories != null && repositories.repository(request.name) != null) {\n+            // Repository exists and is being updated - check if it's in use\n+            usageValidator.validateRepositoryModification(request.name);\n+        }\n+        \n         final RepositoryMetaData newRepositoryMetaData = new RepositoryMetaData(request.name, request.type, request.settings);\n \n         clusterService.submitStateUpdateTask(request.cause, new AckedClusterStateUpdateTask() {\n@@ -169,6 +179,9 @@ public class RepositoriesService extends AbstractComponent implements ClusterSta\n      * @param listener unregister repository listener\n      */\n     public void unregisterRepository(final UnregisterRepositoryRequest request, final ActionListener<UnregisterRepositoryResponse> listener) {\n+        // Check if repository is currently in use before attempting to delete\n+        usageValidator.validateRepositoryModification(request.name);\n+        \n         clusterService.submitStateUpdateTask(request.cause, new AckedClusterStateUpdateTask() {\n             @Override\n             public ClusterState execute(ClusterState currentState) {",
  "logs_path": "factory/glm-4.6/24634b85/elastic_elasticsearch_pr4212/logs.jsonl",
  "errors": [],
  "edit_run_id": "24634b85",
  "test_label": null
}