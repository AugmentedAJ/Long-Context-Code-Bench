{
  "dataset_version": "v0",
  "repo_url": "https://github.com/elastic/elasticsearch.git",
  "pr_number": 114911,
  "base_commit": "f6a1e36d6be56a5d480765ad2d5f72f4adcaef5b",
  "head_commit": "d95609c4fca7f356a7e7ab808ce8d9caa4f0cac1",
  "task_instructions": "You are working on a codebase. Your task is to make the necessary code changes to accomplish the following:\n\nEnhance empty queue conditional in slicing logic\n\nWith recent changes in Lucene 9.12 around not forking execution when not necessary (see https://github.com/apache/lucene/pull/13472), we have removed the search worker thread pool in #111099. The worker thread pool had unlimited queue, and we feared that we couuld have much more queueing on the search thread pool if we execute segment level searches on the same thread pool as the shard level searches, because every shard search would take up to a thread per slice when executing the query phase.\r\n\r\nWe have then introduced an additional conditional to stop parallelizing when there is a queue. That is perhaps a bit extreme, as it's a decision made when creating the searcher, while a queue may no longer be there once the search is executing. This has caused some benchmarks regressions, given that having a queue may be a transient scenario, especially with short-lived segment searches being queued up. We may end up disabling inter-segment concurrency more aggressively than we would want, penalizing requests that do benefit from concurrency. At the same time, we do want to have some kind of protection against rejections of shard searches that would be caused by excessive slicing. When the queue is above a certain size, we can turn off the slicing and effectively disable inter-segment concurrency. With this commit we set that threshold to be the number of threads in the search pool.\n\nPlease make all necessary code changes to complete this task.",
  "stats": {
    "files_changed": 2,
    "lines_added": 148,
    "lines_deleted": 63,
    "total_diff_hunks": 10,
    "context_size_bytes": 77844,
    "truncated": false
  },
  "synthesized_task_instructions": "Update the empty queue conditional in the slicing logic to check if queue size is less than or equal to the maximum pool size instead of checking if the queue is empty",
  "synthesis_model": "auggie/claude-sonnet-4.5",
  "synthesis_timestamp": "2025-10-30T16:55:57.953214Z"
}